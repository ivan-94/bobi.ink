---
title: 'å‰ç«¯å›½é™…åŒ–ï¼šè¯­è¨€åŒ…ç¯‡'
date: 2023/8/8
categories: å‰ç«¯
---

<br>


![Untitled](%E5%89%8D%E7%AB%AF%E5%9B%BD%E9%99%85%E5%8C%96%EF%BC%9A%E8%AF%AD%E8%A8%80%E5%8C%85%E7%AF%87%200f049c986a414a98a2c51a739f9a7378/Untitled.png)

åˆå¼€äº†ä¸ªæ–°å‘ï¼Œæ¥è®²è®²å‰ç«¯å›½é™…åŒ–ã€‚

å¼€ç¯‡ä¹‹å‰ï¼Œè¯»è€…éœ€è¦åŒºåˆ†å¥½`å›½é™…åŒ–`(i18n - internationalization)å’Œ`æœ¬åœ°åŒ–`(l10n - localization) ï¼Œ å®ƒä»¬æ˜¯ç›¸äº’å…³è”ä½†åˆä¸åŒçš„æ¦‚å¿µï¼š

1. å›½é™…åŒ–ï¼ˆi18nï¼‰ï¼šè¿™æ˜¯ä¸€ä¸ªè®¾è®¡å’Œå¼€å‘è¿‡ç¨‹ï¼Œç¡®ä¿äº§å“ï¼ˆå¦‚è½¯ä»¶ã€ç½‘ç«™æˆ–åº”ç”¨ï¼‰èƒ½å¤Ÿåœ¨ä¸åšä»»ä½•ä¿®æ”¹çš„æƒ…å†µä¸‹é€‚åº”ä¸åŒçš„è¯­è¨€å’Œåœ°åŒºã€‚è¿™æ¶‰åŠåˆ°ä»ä¸€å¼€å§‹å°±é¢„ç•™ç©ºé—´ç”¨äºæ–‡æœ¬æ‰©å±•ï¼Œç¡®ä¿æ—¥æœŸå’Œæ—¶é—´æ ¼å¼å¯ä»¥æ ¹æ®åœ°åŒºå˜åŒ–ï¼Œä»¥åŠç¡®ä¿ä»£ç å¯ä»¥å¤„ç†ä¸åŒçš„å­—ç¬¦é›†å’Œå†™ä½œç³»ç»Ÿç­‰ã€‚
2. æœ¬åœ°åŒ–ï¼ˆL10nï¼‰ï¼šè¿™æ˜¯å°†äº§å“æˆ–å†…å®¹é€‚åº”åˆ°ç‰¹å®šå¸‚åœºçš„è¿‡ç¨‹ã€‚è¿™å¯èƒ½åŒ…æ‹¬å°†æ–‡æœ¬ç¿»è¯‘æˆæœ¬åœ°è¯­è¨€ï¼Œè°ƒæ•´å›¾åƒå’Œè‰²å½©ä»¥é€‚åº”æœ¬åœ°æ–‡åŒ–ï¼Œä»¥åŠä¿®æ”¹æ—¥æœŸã€ç”µè¯å·ç å’Œåœ°å€æ ¼å¼ç­‰ã€‚æœ¬åœ°åŒ–å¯èƒ½è¿˜éœ€è¦è€ƒè™‘æœ¬åœ°æ³•è§„å’Œå•†ä¸šä¹ æƒ¯ã€‚

ç®€å•æ¥è¯´ï¼Œå›½é™…åŒ–æ˜¯åˆ›å»ºä¸€ä¸ªå¯ä»¥è½»æ˜“æœ¬åœ°åŒ–çš„äº§å“çš„è¿‡ç¨‹ï¼Œè€Œæœ¬åœ°åŒ–æ˜¯å°†äº§å“è°ƒæ•´ä»¥é€‚åº”ç‰¹å®šåœ°åŒºçš„è¿‡ç¨‹ã€‚ä¸¤è€…åœ¨å®é™…äº§å“ä¸­çš„è¾¹ç•Œå¯èƒ½æ¯”æ²¡æœ‰é‚£ä¹ˆæ¸…æ™°ï¼Œè€Œæ˜¯ç›¸è¾…ç›¸æˆï¼Œé€šå¸¸åœ¨å¤§çš„å›½é™…åŒ–åŸºåº§ä¸Šè¿›ä¸€æ­¥è¿›è¡Œæœ¬åœ°åŒ–,ã€‚

å›½é™…åŒ–çš„æ¶‰åŠé¢éå¸¸å¹¿ï¼Œæ¯”å¦‚è¯­è¨€ã€æ–‡å­—ç¼–ç ã€æ—¶åŒºã€ä¹¦å†™ä¹ æƒ¯ã€å•å¤æ•°ã€æ ‡ç‚¹ç¬¦å·ã€æ—¶é—´æ ¼å¼ã€è´§å¸æ ¼å¼ã€è®¡é‡å•ä½â€¦   

å¼ºçƒˆæ¨èè¯»è€…è¯»ä¸€ä¸‹ [åŸºç¡€è®¾è®¡ä¸“æ  - From.RED](https://www.zhihu.com/column/txtwork) è¿™ä¸ªä¸“æ ï¼Œè¿™é‡Œé¢ä¸€ç³»åˆ—çš„å›½é™…åŒ–/æœ¬åœ°åŒ–çš„æ–‡ç« éƒ½éå¸¸èµï¼š

- [ä¸ºå…¨çƒè®¾è®¡ï¼Œå›½é™…åŒ–ä¸æœ¬åœ°åŒ–æ¢ç´¢ï¼šå¿«é€Ÿå…¥é—¨](https://zhuanlan.zhihu.com/p/29759116)
- [ä¸ºå…¨çƒè®¾è®¡ï¼Œå›½é™…åŒ–ä¸æœ¬åœ°åŒ–æ¢ç´¢ï¼šå›½é™…åŒ–è®¾è®¡](https://zhuanlan.zhihu.com/p/29780850)
- [ä¸ºå…¨çƒè®¾è®¡ï¼Œå›½é™…åŒ–ä¸æœ¬åœ°åŒ–æ¢ç´¢ï¼šæœ¬åœ°åŒ–è®¾è®¡](https://zhuanlan.zhihu.com/p/31025276)

å®é™…ä¸Šç¬”è€…ä¹Ÿä¸æ˜¯ç‰¹åˆ«ä¸“ä¸šï¼Œè¿™ç³»åˆ—æ–‡ç« ä»…æ˜¯æˆ‘çš„ä¸€äº›æŠ€æœ¯å®è·µæ€»ç»“ã€‚ä½œä¸ºå¼€ç¯‡ï¼Œæˆ‘ä»¬å…ˆèŠä¸€èŠä¸€äº›æ¯”è¾ƒåŸºç¡€çš„è¯é¢˜ï¼šå‰ç«¯è¯­è¨€åŒ…çš„ç®¡ç†ã€‚

å¯¹äºè¯­è¨€åŒ…çš„ç®¡ç†ï¼Œæˆ‘ä»¬å¤§æ¦‚ç‡ä¼šé‡åˆ°ä»¥ä¸‹é—®é¢˜ï¼š

- è¯­è¨€åŒ…åº”è¯¥æ”¾åœ¨å“ªä¸ªç›®å½•ï¼Ÿ
- å…¨å±€ä½¿ç”¨ä¸€ä¸ªè¯­è¨€åŒ…ï¼Œè¿˜æ˜¯åˆ†æ¨¡å—ï¼Ÿ
- å¦‚æœæ˜¯åˆ†æ¨¡å—çš„è¯ï¼Ÿç²’åº¦æ€ä¹ˆæŠŠæ¡?
- æ€ä¹ˆå®ç°æŒ‰éœ€åŠ è½½ï¼ŸWeb ç«¯ï¼Ÿå°ç¨‹åºç«¯ï¼Ÿ
- å¦‚æœåˆ†æ¨¡å—ç»„ç»‡ï¼Œç¢ç‰‡åŒ–çš„è¯­è¨€åŒ…ä¼šä¸ä¼šå¯¼è‡´å¤šä¸ªè¯·æ±‚ï¼Ÿ
- å¦‚ä½•ç®¡ç†å’Œåˆ†æè¯­è¨€åŒ…çš„ä½¿ç”¨ï¼Ÿ
- è¿˜æœ‰å“ªäº›å»ºè®®ï¼Ÿ

å¦‚æœè¿›ä¸€æ­¥å½’çº³ï¼Œè¿™äº›é—®é¢˜åˆå¯ä»¥åˆ†ä¸ºä¸‰å¤§ç±»ï¼š

# 1. ç»„ç»‡è¯­è¨€åŒ…

## 1.1 æ”¾åœ¨å“ªä¸ªç›®å½•ä¸‹ï¼Ÿ

é€šå¸¸æ”¾åœ¨ `locales`  æˆ–è€… `i18n` ç›®å½•ä¸‹ã€‚æ¯”å¦‚ï¼š

```bash
/src
  /locales
    zh.json
    zh-Hant.json
    en.json
    th.json
```

æˆ‘ä»¬å›¢é˜Ÿçš„è§„èŒƒæ˜¯ä½¿ç”¨ `*.tr` æ¥ä½œä¸ºè¯­è¨€åŒ…ï¼Œä¾‹å¦‚ï¼š

```bash
/src
  /locales
    zh.tr
    zh-Hant.tr
    en.tr
    th.tr
```

`tr` å³ `translate` çš„ç¼©å†™ï¼Œ è¿™ä¹ˆåšçš„ç›®çš„ä¸»è¦ä¸ºäº†å’Œ `json` æ–‡ä»¶åŒºåˆ†å¼€ï¼Œæ–¹ä¾¿åé¢çš„æ„å»ºå·¥å…·è¯†åˆ«ã€‚

å½“ç„¶è¿˜æœ‰å…¶ä»–æ‰‹æ®µå¯ä»¥å®ç°ï¼Œä½†åœ¨æœ¬ç¯‡æ–‡ç« ä¸­æˆ‘ä»¬ç»Ÿä¸€çº¦å®šä½¿ç”¨ `.tr` ä½œä¸ºè¯­è¨€åŒ…æ–‡ä»¶ã€‚

> ğŸ’¡Â VSCode ä¸­åŠ ä¸Šä»¥ä¸‹é…ç½®ï¼Œå¯ä»¥å°† tr æ–‡ä»¶è¯†åˆ«ä¸º `JSON`:
> 
> 
> ```json
> // .vscode/settings.json
> {
>   "files.associations": {
>     "*.tr": "json"
>   },
> }
> ```
> 

## 1.2 å…¨å±€ä½¿ç”¨ä¸€ä¸ªè¯­è¨€åŒ…ï¼Œè¿˜æ˜¯åˆ†æ¨¡å—ï¼Ÿ

æˆ‘ä»¬æ¨è`æŒ‰ç…§ä¸šåŠ¡æ¥èšåˆ'å®ç°'`ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸åº”è¯¥å°†æ‰€æœ‰çš„è¯­è¨€åŒ…ä¸€è‚¡è„‘æ”¾åœ¨ä¸€èµ·ï¼Œé™¤éä½ çš„é¡¹ç›®æ¯”è¾ƒç®€å•ã€‚æ¢å¥è¯è¯´ï¼Œåº”è¯¥éµå¾ª`å°±è¿‘åŸåˆ™`ï¼ŒGlobal is Evilã€‚

æ¯”å¦‚ MonoRepo é¡¹ç›®ï¼š

```bash
packages
  â”œâ”€â”€ pkgA
  |   â””â”€â”€ i18n
  |       â”œâ”€â”€ en.tr
  |       â”œâ”€â”€ zh.tr
  |       â””â”€â”€ ...
  â”œâ”€â”€ pkgB
  |   â””â”€â”€ i18n
  |       â”œâ”€â”€ en.tr
  |       â”œâ”€â”€ zh.tr
  |       â””â”€â”€ ...
  â””â”€â”€ ...
```

**åˆ†æ¨¡å—çš„å¥½å¤„æ˜¯ç»´æŠ¤èµ·æ¥ç›¸å¯¹å®¹æ˜“ï¼Œå°¤å…¶æ˜¯åæœŸè¿ç§»å’Œé‡æ„æ—¶ã€‚å¦å¤–ä¸€ä¸ªå¥½å¤„æ˜¯å¯ä»¥æ ¹æ®æ¨¡å—æŒ‰éœ€åŠ è½½ã€‚**

## 1.3 å¦‚æœæ˜¯åˆ†æ¨¡å—çš„è¯ï¼Ÿç²’åº¦æ€ä¹ˆæŠŠæ¡?

ä¸ºäº†å¹³è¡¡åŠ è½½é€Ÿåº¦ã€å¯ç»´æŠ¤æ€§ï¼Œç¿»è¯‘æ–‡ä»¶ä¸èƒ½è¿‡å°ã€ä¹Ÿä¸èƒ½è¿‡å¤§ã€‚é€šå¸¸æŒ‰ç…§`ä¸šåŠ¡æ¨¡å—`çš„ç²’åº¦æ¥åˆ’åˆ†ã€‚**ä¸šåŠ¡æ¨¡å—æ˜¯ç”±ä¸€ä¸ªæˆ–å¤šä¸ªé¡µé¢ç»„æˆçš„å®Œæ•´çš„åŠŸèƒ½ã€‚**

![å›¾ç‰‡æ¥æº: [https://time.geekbang.org/column/intro/100037301](https://time.geekbang.org/column/intro/100037301)](%E5%89%8D%E7%AB%AF%E5%9B%BD%E9%99%85%E5%8C%96%EF%BC%9A%E8%AF%AD%E8%A8%80%E5%8C%85%E7%AF%87%200f049c986a414a98a2c51a739f9a7378/Untitled%201.png)

å›¾ç‰‡æ¥æº: [https://time.geekbang.org/column/intro/100037301](https://time.geekbang.org/column/intro/100037301)

å¦‚æœæŒ‰ç…§ DDD çš„è¯´æ³•ï¼Œä¸šåŠ¡æ¨¡å—å¯ä»¥æ˜¯ä¸€ä¸ª`å­åŸŸ`ã€ç”šè‡³æ›´å°ç²’åº¦çš„`èšåˆ`ã€‚æ€»ä¹‹è¿™ä¸ªä¸šåŠ¡æ¨¡å—æœ‰ä»¥ä¸‹ç‰¹å¾ï¼š

- è‡ªåŒ…å«ã€‚è‡ªç»™è‡ªè¶³å®ç°ä¸€ä¸ªå®Œæ•´çš„åŠŸèƒ½é—­ç¯
- é«˜èšåˆã€‚å¯¹å¤–éƒ¨ä¾èµ–è¾ƒå°‘ã€‚

è¯»è€…ä¹Ÿä¸ç”¨è¿‡äºçº ç»“ï¼Œå®é™…åœ¨ä¸šåŠ¡å¼€å‘æ—¶ï¼Œéšç€å¯¹éœ€æ±‚äº†è§£çš„æ·±å…¥ï¼Œä½ ä¼šæ‘¸ç´¢åˆ°å®ƒä»¬çš„è¾¹ç•Œï¼Œæˆ–è€…ä½ ä¹Ÿå¯ä»¥ä»å…¶ä»–åœ°æ–¹å€Ÿé‰´ï¼Œæ¯”å¦‚åç«¯æœåŠ¡çš„åˆ’åˆ†ã€äº§å“éœ€æ±‚ç»“æ„çš„åˆ’åˆ†ç­‰ç­‰ã€‚

ä»ä»£ç çš„å®ç°å±‚é¢æ¥çœ‹ï¼Œä½ ä¹Ÿå¯ä»¥è®¤ä¸º`ä¸šåŠ¡æ¨¡å—`ç­‰åŒäº MonoRepo çš„ä¸€ä¸ª`å­é¡¹ç›®`ã€‚å°½ç®¡å­é¡¹ç›®å†…éƒ¨å¯èƒ½ä¼šç»§ç»­æ‹†åˆ†ã€‚

---

# 2. è¯­è¨€åŒ…åŠ è½½

## 2.1 æ€ä¹ˆå®ç°æŒ‰éœ€åŠ è½½ï¼ŸWeb ç«¯ï¼Ÿå°ç¨‹åºç«¯ï¼Ÿ

**åœ¨ Web ç«¯**ï¼Œé€šå¸¸é€šè¿‡`åŠ¨æ€å¯¼å…¥`(Dynamic Import) å®ç°ï¼Œ ä¾‹å¦‚ï¼š

```jsx
registerBundles({
  zh: () => import('./zh.tr'),
  en: () => import('./en.tr'),
  'zh-Hant': () => import('./zh-Hant.tr'),
  th: () => import('./th.tr'),
});
```

åœ¨ Webpack ä¸­æ— æ³•è¯†åˆ« tr æ‰©å±•åï¼Œæˆ‘ä»¬æ‰©å±•ä¸€ä¸‹ï¼š

```jsx
// webpack chain
chain.module.rule('translate').test(/\.tr$/).use('json').loader('json-loader').end();
```

ä½¿ç”¨ `json-loader` æ¥å¤„ç† tr æ–‡ä»¶ã€‚

**å°ç¨‹åºç«¯å‘¢ï¼Ÿ**

å°ç¨‹åºç«¯ä¸æ”¯æŒ`åŠ¨æ€æ‰§è¡Œä»£ç `, æ‰€ä»¥æ— æ³•ä½¿ç”¨`åŠ¨æ€å¯¼å…¥`ï¼Œ è§£å†³åŠæ³•å°±æ˜¯ä½œä¸ºé™æ€èµ„æºæå–å‡ºå»ï¼Œæ‰˜ç®¡åˆ°`é™æ€èµ„æºæœåŠ¡å™¨` æˆ– `CDN`ä¸­ï¼Œè¿œç¨‹åŠ è½½:

![Untitled](%E5%89%8D%E7%AB%AF%E5%9B%BD%E9%99%85%E5%8C%96%EF%BC%9A%E8%AF%AD%E8%A8%80%E5%8C%85%E7%AF%87%200f049c986a414a98a2c51a739f9a7378/Untitled%202.png)

ä»¥ `Taro` é…ç½®ä¸ºä¾‹

```jsx
// Webpack 5
const generator = {
  filename: fileLoaderOptions.name,
  publicPath: fileLoaderOptions.publicPath,
  outputPath: fileLoaderOptions.outputPath,
};

ctx.modifyWebpackChain(({ chain }) => {
  // ç¿»è¯‘æ–‡ä»¶æå–
  const translation = chain.module.rule('translation').test(/\.tr$/);

  if (process.env.NODE_ENV === 'development') {
    // ğŸ”´ å¼€å‘ç¯å¢ƒä½¿ç”¨ JSON å¼•ç”¨
    translation.type('json').end();
  } else {
    // ğŸ”´ ç”Ÿäº§ç¯å¢ƒ ä½¿ç”¨ â€™file-loaderâ€˜ æå–åˆ° CDN æœåŠ¡å™¨
    translation.type('asset/resource').set('generator', generator).end();

    // æ”¯æŒ import xx from './test.json?extra' æ¨¡å¼, å¼ºåˆ¶æå–
    chain.module.rule('extra').resourceQuery(/extra/).type('asset/resource').set('generator', generator).end();
  }
})
```

å¯¹äºå¼€å‘ç¯å¢ƒï¼Œæ²¿ç”¨ json-loader çš„æ–¹å¼å¤„ç†ï¼Œç”Ÿäº§ç¯å¢ƒåˆ™è¿›è¡Œ[èµ„æºæå–](https://webpack.js.org/guides/asset-modules/)(ç­‰ä»· Webpack 4 çš„ url-loaderã€file-loader)ã€‚

å°ç¨‹åºè¯­è¨€åŒ…å£°æ˜ï¼š

```jsx
registerBundles({
  zh: require('@wakeapp/login-sdk/i18n/zh.tr'),
  'zh-Hant': require('@wakeapp/login-sdk/i18n/zh-Hant.tr'),
  en: require('@wakeapp/login-sdk/i18n/en.tr'),
  th: require('@wakeapp/login-sdk/i18n/th.tr'),
});
```

åŒæ ·çš„æ€è·¯ä¹Ÿå¯ä»¥ç”¨äºå°ç¨‹åºçš„å…¶ä»–é™æ€èµ„æºã€æ¯”å¦‚å›¾ç‰‡ã€è§†é¢‘ã€å­—ä½“ç­‰ã€‚

## 2.2 å¦‚æœåˆ†æ¨¡å—ç»„ç»‡ï¼Œç¢ç‰‡åŒ–çš„è¯­è¨€åŒ…ä¼šä¸ä¼šå¯¼è‡´å¤šä¸ªè¯·æ±‚ï¼Ÿ

![Untitled](%E5%89%8D%E7%AB%AF%E5%9B%BD%E9%99%85%E5%8C%96%EF%BC%9A%E8%AF%AD%E8%A8%80%E5%8C%85%E7%AF%87%200f049c986a414a98a2c51a739f9a7378/Untitled%203.png)

ä¸€ä¸ªå±å±±é¡¹ç›®å¯èƒ½ä¼šæœ‰å¾ˆå¤šè¯­è¨€åŒ…ã€‚å¦‚æœä¸å¹²é¢„ï¼Œå°±ä¼šæœ‰å¾ˆå¤šç¢ç‰‡åŒ–çš„è¯·æ±‚, åœ¨ä¸æ”¯æŒ HTTP 2.0 çš„ç¯å¢ƒï¼Œè¿™äº›è¯·æ±‚ä¼šå¯¹é¡µé¢æ€§èƒ½é€ æˆè¾ƒå¤§çš„å½±å“ï¼Œæ€ä¹ˆä¼˜åŒ–åŠ è½½å‘¢ï¼Ÿ

åœ¨ Web ç«¯ï¼Œå¯ä»¥åˆ©ç”¨ `[splitChunks](https://webpack.js.org/plugins/split-chunks-plugin/#root)` å¯¹è¯­è¨€åŒ…è¿›è¡Œåˆå¹¶ï¼š

```tsx
const TRANSLATE_FILE_REG = /([^./]*)\.tr$/;

function getLocale(request: string) {
  return request.match(TRANSLATE_FILE_REG)?.[1];
}    

// ... çœç•¥éƒ¨åˆ†ä»£ç 

    // ç¿»è¯‘æ–‡ä»¶èµ„æºåˆå¹¶, é¿å…ç¢ç‰‡åŒ–, å¯¼è‡´å¹¶å‘è¯·æ±‚æ•°é‡è¿‡å¤š
    if (process.env.NODE_ENV === 'production') {
      const splitChunks = chain.optimization.get('splitChunks');
      if (splitChunks == null) {
        // å·²ç¦ç”¨
        return;
      }

      const translateMerge = {
        // åªé’ˆå¯¹å¼‚æ­¥æ¨¡å—
        chunks: 'async',
        test: /\.tr$/,
        // ğŸ”´ æœ€å¤§å°ºå¯¸
        maxSize: 200 * 1024,
        name: (module: { rawRequest: string }) => {
          const request = module.rawRequest;
          if (request == null) {
            throw new Error(`[vue-cli-plugin-i18n]: failed to get locale from ${request}`);
          }
          // ğŸ”´ æŒ‰ locale ä½œä¸º key è¿›è¡Œåˆå¹¶
          return `${getLocale(request)}-tr`;
        },
        // å¼ºåˆ¶æ‰§è¡Œ
        enforce: true,
      };

      chain.optimization.splitChunks({
        ...splitChunks,
        cacheGroups: {
          ...splitChunks.cacheGroups,
          translateMerge,
        },
      });
    }
```

ä¸Šé¢çš„ä»£ç å°±æ˜¯ä½¿ç”¨ splitChunks å¯¹ç›¸åŒ Locale çš„è¯­è¨€åŒ…è¿›è¡Œåˆå¹¶ï¼Œæœ€å¤§ä½“ç§¯ä¸è¶…è¿‡ 200kbã€‚

å°ç¨‹åºç«¯æš‚æ—¶ä¸æ”¯æŒè¿™ç§æ–¹å¼ã€‚å¯ä»¥é€šè¿‡å…¶ä»–æ‰‹æ®µæ¥å¼¥è¡¥ï¼Œæ¯”å¦‚äººå·¥é¿å…ç¢ç‰‡åŒ–ã€ç¼“å­˜åˆ°æœ¬åœ°å­˜å‚¨ç­‰ç­‰ã€‚

## 2.3 registerBundles æ€ä¹ˆå®ç°ï¼Ÿ

`registerBundles` è´Ÿè´£å¯¹è¯­è¨€åŒ…è¿›è¡Œæ³¨å†Œã€åŠ è½½ã€åˆå¹¶ã€æ¿€æ´»ç­‰æ“ä½œï¼š

![Untitled](%E5%89%8D%E7%AB%AF%E5%9B%BD%E9%99%85%E5%8C%96%EF%BC%9A%E8%AF%AD%E8%A8%80%E5%8C%85%E7%AF%87%200f049c986a414a98a2c51a739f9a7378/Untitled%204.png)

- è°ƒç”¨ `registerBundles` ä¼šå°†ç›¸å…³è¯­è¨€åŒ…æ³¨å†Œåˆ°`èµ„æºè¡¨`ï¼ˆResoucesï¼‰ä¸­ã€‚å®ƒå¯ä»¥æ¥æ”¶å¯¹è±¡ã€HTTP é“¾æ¥ã€Promise ç­‰
- å…·ä½“è¦åŠ è½½å“ªä¸ªè¯­è¨€åŒ…ç”± i18n åº“é€šçŸ¥ã€‚i18n åº“ä¼ å…¥ä¸€ä¸ª `Locale chain`, è¿™æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ã€‚è¡¨ç¤ºçš„æ˜¯ i18n åº“çš„`è¯­è¨€å›é€€é“¾æ¡`ï¼Œ æˆ–è€…è¯´ i18n åº“å°±æ˜¯æŒ‰ç…§è¿™ä¸ªé¡ºåºåˆ°è¯­è¨€åŒ…ä¸­æŸ¥æ‰¾ keyï¼Œæ¯”å¦‚å½“å‰ locale æ˜¯ '`zh-Hant-HK`â€™ï¼Œ é‚£ä¹ˆ Locale chain å°±æ˜¯  `['zh-Hant-HK', 'zh-Hant', 'zh']`
- æ¥ç€æ ¹æ® `Locale chain` è®¡ç®—å‡ºéœ€è¦åŠ è½½çš„è¯­è¨€åŒ…ã€‚
- æ ¹æ®èµ„æºçš„ç±»å‹é€‰æ‹©ä¸åŒçš„`Loader`(åŠ è½½å™¨)è¿›è¡Œå¤„ç†ã€‚æ¯”å¦‚ `HTTP Loader`ã€`Promise Loader`
- å½“æ‰€æœ‰è¯­è¨€åŒ…åŠ è½½å°±ç»ªåï¼Œå°†æ‰€æœ‰ç»“æœåˆå¹¶æˆä¸€æ£µæ ‘ï¼Œè¿”å›ç»™ i18nã€‚åˆå¹¶æ—¶å¯ä»¥æœ‰ä¼˜å…ˆçº§ï¼Œæ¯”å¦‚æŸäº›è¯­è¨€åŒ…ä»åç«¯æœåŠ¡ä¸­è·å–ï¼Œæˆ‘ä»¬å¸Œæœ›å®ƒèƒ½è¦†ç›–å…¶ä»–è¯­è¨€åŒ…ï¼Œä¼˜å…ˆå±•ç¤ºã€‚

æ¥çœ‹ä¸€ä¸‹å…·ä½“ä»£ç ï¼š

```tsx
export class BundleRegister {
  private executing = false;

  private resources: { [locale: string]: Set<I18nBundle> } = {};

  private layerLinks: { [locale: string]: LayerLink } = {};

  /**
   * ç¼“å­˜èµ„æºçš„å±‚çº§
   */
  private resourceLayer: Map<I18nBundle, number> = new Map();

  private pendingQueue = new PromiseQueue<void>();

  constructor(
    private registerBundle: (locale: string, bundle: Record<string, any>) => void,
    private getLocaleChain: () => string[],
    private onBundleChange: () => void
  ) {}

  /**
   * åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ­£åœ¨åŠ è½½ä¸­çš„è¯­è¨€åŒ…
   */
  hasPendingBundle() {}

  /**
   * è°ƒåº¦è¯­è¨€åŒ…åŠ è½½å’Œåˆå¹¶
   */
  async schedulerMerge(): Promise<void> {}

  /**
   * æ³¨å†Œè¯­è¨€åŒ…
   */
  registerBundles = async (bundles: { [locale: string]: I18nBundle }, layer: number = 10): Promise<void> => {};
}
```

æ•´ä¸ªç±»çš„ç»“æ„å¦‚ä¸Šï¼Œæ„é€ å‡½æ•°éœ€è¦ä¼ å…¥ä¸‰ä¸ªé’©å­ï¼š

- registerBundleã€‚ BundleRegister é€šè¿‡å®ƒå‘  i18n åº“æäº¤è¯­è¨€åŒ…(message)
- getLocaleChainã€‚å‘ i18n è·å– local chain
- onBundleChangeã€‚è¯­è¨€åŒ…å˜åŠ¨äº‹ä»¶é€šçŸ¥

çœ‹ä¸‹åœ¨ vue-i18n(9+) ä¸‹æ€ä¹ˆå¯¹æ¥ï¼š

```tsx
 // ğŸ”´ åˆå§‹åŒ–
 const bundleRegister = new BundleRegister(
    (loc, bundle) => {
      // ğŸ”´ æäº¤è¯­è¨€åŒ…
      const initialMessages = messages?.[loc];
      let cloneBundle = bundle;

      // æ‹·è´
      if (initialMessages) {
        cloneBundle = merge({}, initialMessages, cloneBundle);
      }

      vueI18nInstance.setLocaleMessage(loc, cloneBundle);
    },
    // ğŸ”´ è·å– Local chain
    getFallbackLocaleChain,
    () => {
      eventBus.emit(EVENT_MESSAGE_CHANGE);
    }
  );

  // ğŸ”´ ç›‘å¬è¯­è¨€å˜åŠ¨å¹¶è§¦å‘ BundlerRegister åŠ è½½
  watch(
    () => unref(vueI18nInstance.locale),
    loc => {
      // æ£€æŸ¥æ˜¯å¦é€šè¿‡ setLocale è°ƒç”¨
      if (!SET_LOCALE_CONTEXT) {
        console.error(`[i18n] ç¦æ­¢ç›´æ¥è®¾ç½® .locale æ¥è®¾ç½®å½“å‰è¯­è¨€ï¼Œ å¿…é¡»ä½¿ç”¨ setLocale()`);
      }

      eventBus.emit(EVENT_LOCALE_CHANGE, loc);
      bundleRegister.schedulerMerge();
    },
    { flush: 'sync' }
  );
```

è¿”å›æ¥çœ‹æ³¨å†Œç»†èŠ‚ã€‚`registerBundles` å°±æ˜¯æ³¨å†Œè¯­è¨€åŒ…ï¼Œè¿‡ç¨‹å¾ˆç®€å•ï¼š

```tsx
/**
   * æ³¨å†Œè¯­è¨€åŒ…
   */
  registerBundles = async (bundles: { [locale: string]: I18nBundle }, layer: number = 10): Promise<void> => {
    let dirty = false;
    Object.keys(bundles).forEach(k => {
      const normalizedKey = k.toLowerCase();
      // ç™»è®°åˆ°èµ„æºè¡¨
      const list = (this.resources[normalizedKey] ??= new Set());
      const bundle = bundles[k];

      const add = (b: I18nBundle) => {
        if (!list.has(b)) {
          list.add(b);
          this.resourceLayer.set(b, layer);
          dirty = true;
        }
      };

      if (Array.isArray(bundle)) {
        for (const child of bundle) {
          add(child);
        }
      } else {
        add(bundle);
      }
    });

    if (dirty) {
      // ğŸ”´ ç«‹å³è°ƒåº¦åŠ è½½
      return await this.schedulerMerge();
    }
  };
```

ç›¸å¯¹æ¯”è¾ƒå¤æ‚çš„æ˜¯ `scheduleMerge`ï¼Œä½†ä¹Ÿä¸éš¾ç†è§£ï¼š

```tsx
  async schedulerMerge(): Promise<void> {
    // ğŸ”´ æ‰§è¡Œä¸­ï¼Œä¸éœ€è¦é‡æ–°å‘èµ·
    if (this.executing) {
      return await this.pendingQueue.push();
    }

    let queue = this.pendingQueue;

    try {
      this.executing = true;

      // ğŸ”´ ç­‰å¾…æ›´å¤š bundle æ’å…¥ï¼Œæ‰¹é‡æ‰§è¡Œ
      await Promise.resolve();

      // ğŸ”´ ä¸‹ä¸€æ‰¹æ‰§è¡Œ
      this.pendingQueue = new PromiseQueue();

      // ğŸ”´ åŠ è½½å½“å‰è¯­è¨€
      const localeChain = this.getLocaleChain();
      
      // ğŸ”´ å·²ç»åŠ è½½çš„è¯­è¨€
      let messages: { [locale: string]: Record<string, any>[] } = {};
      let task: Promise<void>[] = [];
      
      // ğŸ”´ éå† localeChain
      for (const locale of localeChain) {
        const resource = this.resources[locale.toLowerCase()];

        if (resource == null) {
          continue;
        }

        for (const bundle of resource.values()) {
          // ğŸ”´ è·³è¿‡å·²ç»åŠ è½½
          if (isLoaded(bundle)) {
            continue;
          }
          // ğŸ”´ layer è¡¨ç¤ºè¯­è¨€åŒ…çš„åˆ†å±‚ï¼Œæˆ–è€…è¯´åˆå¹¶çš„ä¼˜å…ˆçº§ï¼Œ å±‚æ•°è¶Šä½ä¼˜å…ˆçº§è¶Šé«˜
          const layer = this.resourceLayer.get(bundle) ?? DEFAULT_LAYER;

          if (typeof bundle === 'function') {
            // ğŸ”´ å¼‚æ­¥åŠ è½½å‡½æ•°
            task.push(
              (async () => {
                const loadedBundle = await asyncModuleLoader(bundle as I18nAsyncBundle);
                if (loadedBundle) {
                  this.setLayer(loadedBundle, layer);
                  console.debug(`[i18n] bundle loaded: `, bundle);
                  (messages[locale] ??= []).push(loadedBundle);
                }
              })()
            );
          } else if (typeof bundle === 'string') {
            // ğŸ”´ http é“¾æ¥
            task.push(
              (async () => {
                const loadedBundle = await httpLoader(bundle);

                if (loadedBundle) {
                  this.setLayer(loadedBundle, layer);
                  console.debug(`[i18n] bundle loaded: `, bundle);
                  (messages[locale] ??= []).push(loadedBundle);
                }
              })()
            );
          } else {
            // ğŸ”´ ç›´æ¥å°±æ˜¯è¯­è¨€åŒ…å¯¹è±¡
            this.setLayer(bundle, layer);
            (messages[locale] ??= []).push(bundle);
          }

          setLoaded(bundle);
        }
      }

      // ğŸ”´ å¹¶å‘åŠ è½½
      if (task.length) {
        try {
          await Promise.all(task);
        } catch (err) {
          console.warn(`[i18n] åŠ è½½è¯­è¨€åŒ…å¤±è´¥:`, err);
        }
      }

      const messageKeys = Object.keys(messages);

      // ğŸ”´ æ¥ä¸‹æ¥å°±æ˜¯å°† messages åˆå¹¶æˆä¸€æ£µæ ‘
      if (messageKeys.length) {
        const messageToUpdate: { [locale: string]: LayerLink } = {};

        for (const locale of messageKeys) {
          // ğŸ”´ LayerLink å­˜å‚¨äº†æ‰€æœ‰å·²ç»åŠ è½½çš„è¯­è¨€åŒ…å’Œä»–çš„åˆ†å±‚ä¿¡æ¯
          const layerLink = (this.layerLinks[locale] ??= new LayerLink());

          for (const bundle of messages[locale]) {
            const layer = this.getLayer(bundle);

            layerLink.assignLayer(layer, bundle);
          }

          messageToUpdate[locale] = layerLink;
        }

        // ğŸ”´ è§¦å‘æ›´æ–°
        for (const locale in messageToUpdate) {
          this.registerBundle(locale, messageToUpdate[locale].flattenLayer());
        }

        this.onBundleChange();
      }
    } catch (err) {
      console.error(`[i18n] è¯­è¨€åŒ…åŠ è½½å¤±è´¥`, err);
    } finally {
      this.executing = false;
      queue.flushResolve();

      // ğŸ”´ åˆ¤æ–­æ˜¯å¦æœ‰æ–°çš„ bundle åŠ è¿›æ¥ï¼Œéœ€è¦ç»§ç»­è°ƒåº¦åŠ è½½
      if (this.hasUnloadedBundle()) {
        // ç»§ç»­è°ƒåº¦
        this.schedulerMerge();
      } else {
        // æ²¡æœ‰äº†ï¼Œæ¸…ç©ºé˜Ÿåˆ—ä¸éœ€è¦ç»§ç»­ç­‰å¾…äº†
        this.pendingQueue.flushResolve();
      }
    }
  }
```

è¿™å°±æ˜¯ä¸€ä¸ªå…¸å‹çš„å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œçš„è°ƒåº¦è¿‡ç¨‹ã€‚ç›¸å…³çš„[æºç å¯ä»¥çœ‹è¿™é‡Œ](https://github.com/wakeadmin/tools/tree/main/packages/i18n-shared)

# 3. è¯­è¨€åŒ…ç®¡ç†

## 3.1 å¦‚ä½•ç®¡ç†å’Œåˆ†æè¯­è¨€åŒ…çš„ä½¿ç”¨ï¼Ÿ

é‚£ä¹ˆå¦‚ä½•æé«˜å‰ç«¯å›½é™…åŒ–çš„å¼€å‘ä½“éªŒå‘¢ï¼Ÿæ¯”å¦‚ï¼š

- èƒ½å¤Ÿåœ¨ç¼–è¾‘å™¨å›æ˜¾ key å¯¹åº”çš„ä¸­æ–‡
- èƒ½å¤Ÿç‚¹å‡»è·³è½¬åˆ° key å®šä¹‰çš„è¯­è¨€åŒ…
- èƒ½å¤Ÿåˆ†æè¯­è¨€åŒ…æ˜¯å¦è¢«å¼•ç”¨ã€æœ‰æ²¡æœ‰é‡å¤ã€ç¼ºè¯‘çš„æƒ…å†µ
- æ”¯æŒ key é‡å‘½å(é‡æ„)
- èƒ½è‡ªåŠ¨å‘ç°æ–‡æœ¬ç¡¬ç¼–ç ï¼Œå¹¶æ”¯æŒæå–
- æ”¯æŒæœºå™¨ç¿»è¯‘
- æä¾›ååŒç¿»è¯‘â€¦.

![Untitled](%E5%89%8D%E7%AB%AF%E5%9B%BD%E9%99%85%E5%8C%96%EF%BC%9A%E8%AF%AD%E8%A8%80%E5%8C%85%E7%AF%87%200f049c986a414a98a2c51a739f9a7378/Untitled%205.png)

ğŸ‰ è¿˜çœŸæœ‰è¿™ä¹ˆä¸€ä¸ªç¥å™¨å¯ä»¥æ»¡è¶³ä¸Šé¢æ‰€æœ‰éœ€æ±‚ï¼Œé‚£å°±æ˜¯ VSCode çš„ ****[i18n Ally](https://marketplace.visualstudio.com/items?itemName=lokalise.i18n-ally)** æ’ä»¶(è¿˜æ˜¯ [antfu](http://antfu.me) å¤§ç¥å¼€å‘çš„, é¡¶ç¤¼è†œæ‹œ)ï¼

![Untitled](%E5%89%8D%E7%AB%AF%E5%9B%BD%E9%99%85%E5%8C%96%EF%BC%9A%E8%AF%AD%E8%A8%80%E5%8C%85%E7%AF%87%200f049c986a414a98a2c51a739f9a7378/Untitled%206.png)

å®‰è£…äº† ****[i18n Ally](https://marketplace.visualstudio.com/items?itemName=lokalise.i18n-ally)**  åï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹æ˜¯èƒ½å¼€ç®±å³ç”¨ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›ä½ å¯èƒ½éœ€è¦è°ƒæ•´çš„å¸¸è§é…ç½®é¡¹ï¼š

1. ä½¿ç”¨çš„æ¡†æ¶ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œi18n ally ä¼šåˆ†æé¡¹ç›®æ ¹ç›®å½•ä¸‹çš„ package.json, ç¡®å®šä½ ä½¿ç”¨çš„ i18n æ¡†æ¶ï¼Œå®ƒæ”¯æŒäº†å¾ˆå¤šå¸¸è§çš„ i18n åº“ï¼Œæ¯”å¦‚ `vue-i18n`, `react-i18next`ã€‚
    
    *ğŸ’¡Â å¦‚æœæ— æ³•ä½ å‘ç° i18n ally æ’ä»¶æ²¡æœ‰å¯ç”¨ï¼Œé‚£å¤§æ¦‚ç‡å°±æ˜¯å®ƒæ£€æµ‹å¤±è´¥äº†, å¯ä»¥åœ¨ `OUTPUT` Panel ä¸‹çœ‹çš„æ—¥å¿—ï¼š*
    
    ![Untitled](%E5%89%8D%E7%AB%AF%E5%9B%BD%E9%99%85%E5%8C%96%EF%BC%9A%E8%AF%AD%E8%A8%80%E5%8C%85%E7%AF%87%200f049c986a414a98a2c51a739f9a7378/Untitled%207.png)
    
    è§£å†³åŠæ³•å°±æ˜¯æ˜¾å¼å‘Šè¯‰å®ƒï¼š
    
    ```json
    // .vscode/setting.json
    {
      "i18n-ally.enabledFrameworks": ["react-i18next"]
    }
    ```
    

1. è‡ªå®šä¹‰è¯­è¨€åŒ…æ£€æŸ¥ç›®å½•ã€‚
    
    ```json
    // .vscode/setting.json
    {
      // æ”¯æŒåœ¨æ‰€æœ‰åµŒå¥—çš„ localesã€i18n ç›®å½•ä¸‹å‘ç°è¯­è¨€åŒ…
      "i18n-ally.localesPaths": ["**/locales", "**/i18n"],
    }
    ```
    
2. è¯­è¨€åŒ…é…ç½®
    
    æˆ‘ä»¬ä¸Šæ–‡ä½¿ç”¨çš„æ˜¯ `.tr` æ‰©å±•åï¼Œ i18n ally å¹¶ä¸èƒ½è¯†åˆ«å®ƒï¼Œæˆ‘ä»¬é€šè¿‡ä¸‹é¢çš„é…ç½®æ¥å‘Šè¯‰å®ƒå¦‚ä½•å¤„ç† tr æ–‡ä»¶ï¼š
    
    ```json
    // .vscode/setting.json
    {
      // è¯­è¨€åŒ…çš„å‘½åè§„åˆ™
      "i18n-ally.pathMatcher": "{locale}.tr",
      // è¯­è¨€åŒ…çš„ parser
      "i18n-ally.parsers.extendFileExtensions": {
        "tr": "json"
      },
    }
    ```
    
3. å…¶ä»–å¸¸è§é…ç½®
    
    ```json
    {
      // æºè¯­è¨€ã€‚ä¸»è¦ä¼šå½±å“ç¿»è¯‘ï¼Œå³ä»¥å“ªä¸ªè¯­è¨€ä¸ºæºè¯­è¨€ç¿»è¯‘åˆ°å…¶ä»–è¯­ç§ã€‚ä¸­æ–‡å¼€å‘è€…é€šå¸¸è®¾ç½®ä¸ºä¸­æ–‡
      "i18n-ally.sourceLanguage": "zh",
      // åœ¨ç¼–è¾‘å™¨å†…è”æç¤ºçš„è¯­ç§
      "i18n-ally.displayLanguage": "zh",
      // è¯­è¨€åŒ…çš„ç»„ç»‡å½¢å¼ï¼Œnested è¡¨ç¤ºåµŒå¥—å¯¹è±¡æ¨¡å¼
      "i18n-ally.keystyle": "nested"
    }
    ```
    

æ›´å¤šçš„é…ç½®å¯ä»¥çœ‹å®ƒçš„[æ–‡æ¡£](https://github.com/lokalise/i18n-ally/wiki)ã€‚

## 3.2 è¿˜æœ‰å“ªäº›å»ºè®®ï¼Ÿ

### 3.2.1 ç»Ÿä¸€è¯­è¨€æ ‡ç­¾

å¤šè¯­è¨€çš„è¯­è¨€æ ‡ç­¾é€šå¸¸éµå¾ª [BCP 47](https://en.wikipedia.org/wiki/IETF_language_tag)ï¼Œ è¿™æ˜¯ç”±äº’è”ç½‘å·¥ç¨‹ä»»åŠ¡ç»„ï¼ˆIETFï¼‰å‘å¸ƒçš„ä¸€ç§è¯­è¨€æ ‡ç­¾è§„èŒƒï¼Œç”¨äºå”¯ä¸€æ ‡è¯†å„ç§è¯­è¨€ã€‚æ ¼å¼ä¸º `lng-(script)-(Region åŒºåŸŸ)-(Variant å˜ä½“)`ï¼Œä¾‹å¦‚ zh-Hans-CNã€en-USã€zh-Hant ç­‰ç­‰ã€‚

å› ä¸ºè¯­è¨€æ ‡ç­¾å½¢å¼å¤šç§å¤šæ ·ï¼Œè€Œä¸”ä¸åŒçš„ç¯å¢ƒç»™å‡ºçš„ç»“æœå¯èƒ½éƒ½ä¸å¤ªä¸€æ ·ï¼Œæ‰€ä»¥å»ºè®®å¼€å‘è€…åœ¨ç»´æŠ¤è¯­è¨€åŒ…æ—¶ç»Ÿä¸€ä½¿ç”¨è¯­è¨€æ ‡ç­¾ï¼Œå¹¶ä¸”å‰åç«¯ä¿æŒç»Ÿä¸€ã€‚

ä»¥æˆ‘ä»¬å›¢é˜Ÿä¸ºä¾‹ï¼š

```json
en é»˜è®¤è‹±æ–‡
zh é»˜è®¤ç®€ä½“ä¸­æ–‡
zh-Hant é»˜è®¤ç¹ä½“
th é»˜è®¤æ³°æ–‡
```

åŒæ—¶ç»´æŠ¤ä¸€äº›è¯­è¨€æ ‡ç­¾çš„æ˜ å°„è§„åˆ™ï¼š

```json
{
  'zh-TW': 'zh-Hant-TW',
  'zh-HK': 'zh-Hant-HK',
  'zh-MO': 'zh-Hant-MO'
}
```

ä½ ä¼šå‘ç°æˆ‘ä»¬ä½¿ç”¨çš„ enã€zhã€zh-Hantã€th è¿™äº›è¯­è¨€æ ‡ç­¾éƒ½æ˜¯ `lng-(script)` å½¢å¼ï¼Œè¿™æ ·å…œåº•/å‘½ä¸­æ•ˆæœä¼šå¥½ç‚¹ã€‚

ä¸¾ä¸ªä¾‹å­ `zh-Hant-TW` çš„ `Locale chain` æ˜¯ `['zh-Hant-TW', 'zh-Hant', 'zh']` ,  ä¼šå›é€€åŠ è½½ `zh-Hant` å’Œ `zh` è¯­è¨€åŒ…ã€‚ å¦‚æœæœ‰æœä¸€æ—¥ï¼Œéœ€è¦å¯¹ TW åœ°åŒºåšç‰¹æ®Šçš„é€‚é…ï¼Œæˆ‘ä»¬å†åˆ›å»ºä¸€ä¸ªæ›´å…·ä½“ `zh-Hant-TW` è¯­è¨€åŒ…å°±è¡Œäº†ã€‚

### 3.2.2 ä½¿ç”¨åµŒå¥—å‘½åç©ºé—´æ¥ç»„ç»‡è¯­è¨€åŒ…

å»ºè®®ä»¥`ä¸šåŠ¡æ¨¡å—`æˆ–è€…`å›¢é˜Ÿå`ç§°æ¥ä½œä¸º`å‘½åç©ºé—´`,  é¿å…ç›´æ¥å°† key æš´éœ²åˆ°å…¨å±€ã€‚

```json
{
  "rule": {
    "deleteRuleTips": "åˆ é™¤è§„åˆ™åæ— æ³•æ¢å¤ï¼Œç¡®å®šåˆ é™¤ï¼Ÿ",
    "newRule": "æ–°å»ºè§„åˆ™",
    "pointRule": "ç§¯åˆ†è§„åˆ™",
    "tiedRule": "ç­‰çº§è§„åˆ™"
  }
}
```

**ä¸‹ä¸€ç¯‡ï¼Œæˆ‘ä»¬ä»‹ç»å¤šè¯­è¨€çš„ç¿»è¯‘é—®é¢˜ï¼Œæ•¬è¯·æœŸå¾…ï¼ï¼**

# æ‰©å±•é˜…è¯»

- [å¦‚ä½•è®ºè¿°è®¾è®¡çš„å…¨çƒåŒ–ä¸æœ¬åœŸåŒ–çš„å…³ç³»ï¼Ÿ](https://www.zhihu.com/question/51158638/answer/2378431663)
- [ä¸ºå…¨çƒè®¾è®¡ï¼Œå›½é™…åŒ–ä¸æœ¬åœ°åŒ–æ¢ç´¢ï¼šå¿«é€Ÿå…¥é—¨](https://zhuanlan.zhihu.com/p/29759116)