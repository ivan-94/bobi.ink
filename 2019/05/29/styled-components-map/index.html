<!DOCTYPE html>
<html lang=zh>
<head><meta name="generator" content="Hexo 3.8.0">
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="description" content="在React 组件设计实践总结 03 - 样式的管理一文中吹了一波 styled-components 后，本文想深入来了解一下 styled-components 的原理. 如果你对 styled-components 还不了解，建议先阅读一下官方文档或前面的文章.  本文基于 styled-components v4.13 版本  目录   从 Tagged Template Literals">
<meta name="keywords" content="Blog,FrontEnd,React,Javascript,Typescript">
<meta property="og:type" content="article">
<meta property="og:title" content="深入浅出 标签模板字符串 和 💅styled-components 💅">
<meta property="og:url" content="https://bobi.ink/2019/05/29/styled-components-map/index.html">
<meta property="og:site_name" content="Bobi.ink">
<meta property="og:description" content="在React 组件设计实践总结 03 - 样式的管理一文中吹了一波 styled-components 后，本文想深入来了解一下 styled-components 的原理. 如果你对 styled-components 还不了解，建议先阅读一下官方文档或前面的文章.  本文基于 styled-components v4.13 版本  目录   从 Tagged Template Literals">
<meta property="og:locale" content="zh">
<meta property="og:image" content="https://bobi.ink/images/06/styled-sample.png">
<meta property="og:image" content="https://bobi.ink/images/06/tag-template.png">
<meta property="og:image" content="https://bobi.ink/images/06/tag-template-pros.png">
<meta property="og:image" content="https://bobi.ink/images/06/htm.png">
<meta property="og:image" content="https://bobi.ink/images/06/jest.png">
<meta property="og:image" content="https://bobi.ink/images/06/styled-code.png">
<meta property="og:image" content="https://bobi.ink/images/06/css.png">
<meta property="og:image" content="https://bobi.ink/images/06/css-code.png">
<meta property="og:image" content="https://bobi.ink/images/06/flatten-code.png">
<meta property="og:image" content="https://bobi.ink/images/06/flatten.png">
<meta property="og:image" content="https://bobi.ink/images/06/create-component.png">
<meta property="og:image" content="https://bobi.ink/images/06/StyledComponent.png">
<meta property="og:image" content="https://bobi.ink/images/06/ComponentStyle.png">
<meta property="og:image" content="https://bobi.ink/images/06/StyleSheet.png">
<meta property="og:image" content="https://bobi.ink/images/06/makeTag.png">
<meta property="og:image" content="https://bobi.ink/images/06/process.png">
<meta property="og:updated_time" content="2023-06-01T09:55:14.330Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="深入浅出 标签模板字符串 和 💅styled-components 💅">
<meta name="twitter:description" content="在React 组件设计实践总结 03 - 样式的管理一文中吹了一波 styled-components 后，本文想深入来了解一下 styled-components 的原理. 如果你对 styled-components 还不了解，建议先阅读一下官方文档或前面的文章.  本文基于 styled-components v4.13 版本  目录   从 Tagged Template Literals">
<meta name="twitter:image" content="https://bobi.ink/images/06/styled-sample.png">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>深入浅出 标签模板字符串 和 💅styled-components 💅</title>
    <!-- styles -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- rss -->
    
    
</head>

<body>
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Blogs</a></li>
         
          <li><a href="http://github.com/ivan-94">Projects</a></li>
        
      </ul>
    </span>
    <br>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2019/06/02/preact-map/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/2019/05/26/vue-cli-map/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://bobi.ink/2019/05/29/styled-components-map/"><i class="fa fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=https://bobi.ink/2019/05/29/styled-components-map/&text=深入浅出 标签模板字符串 和 💅styled-components 💅"><i class="fa fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://bobi.ink/2019/05/29/styled-components-map/&title=深入浅出 标签模板字符串 和 💅styled-components 💅"><i class="fa fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://bobi.ink/2019/05/29/styled-components-map/&is_video=false&description=深入浅出 标签模板字符串 和 💅styled-components 💅"><i class="fa fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=深入浅出 标签模板字符串 和 💅styled-components 💅&body=Check out this article: https://bobi.ink/2019/05/29/styled-components-map/"><i class="fa fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=https://bobi.ink/2019/05/29/styled-components-map/&title=深入浅出 标签模板字符串 和 💅styled-components 💅"><i class="fa fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=https://bobi.ink/2019/05/29/styled-components-map/&title=深入浅出 标签模板字符串 和 💅styled-components 💅"><i class="fa fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://bobi.ink/2019/05/29/styled-components-map/&title=深入浅出 标签模板字符串 和 💅styled-components 💅"><i class="fa fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=https://bobi.ink/2019/05/29/styled-components-map/&title=深入浅出 标签模板字符串 和 💅styled-components 💅"><i class="fa fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=https://bobi.ink/2019/05/29/styled-components-map/&name=深入浅出 标签模板字符串 和 💅styled-components 💅&description="><i class="fa fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#从-tagged-template-literals-说起"><span class="toc-number">1.</span> <span class="toc-text">从 Tagged Template Literals 说起</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#源码导读"><span class="toc-number">2.</span> <span class="toc-text">源码导读</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-处理标签模板字面量"><span class="toc-number">2.1.</span> <span class="toc-text">1. 处理标签模板字面量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-react-组件的封装"><span class="toc-number">2.2.</span> <span class="toc-text">2. React 组件的封装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-样式和类名的生成"><span class="toc-number">2.3.</span> <span class="toc-text">3. 样式和类名的生成</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-dom-层操作"><span class="toc-number">2.4.</span> <span class="toc-text">4. DOM 层操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-总结"><span class="toc-number">2.5.</span> <span class="toc-text">5. 总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#技术地图"><span class="toc-number">3.</span> <span class="toc-text">技术地图</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index width mx-auto px2 my4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        深入浅出 标签模板字符串 和 💅styled-components 💅
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">Bobi.ink</span>
      </span>
      
    <div class="postdate">
        <time datetime="2019-05-28T16:00:00.000Z" itemprop="datePublished">2019-05-29</time>
    </div>


      

    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <p>在<a href="https://juejin.im/post/5cdad9c7f265da039b08915d" target="_blank" rel="noopener">React 组件设计实践总结 03 - 样式的管理</a>一文中吹了一波 <a href="https://www.styled-components.com" target="_blank" rel="noopener">styled-components</a> 后，本文想深入来了解一下 styled-components 的原理. 如果你对 styled-components 还不了解，建议先阅读一下官方<a href="http://styled-components.com" target="_blank" rel="noopener">文档</a>或前面的文章.</p>
<blockquote>
<p>本文基于 styled-components v4.13 版本</p>
</blockquote>
<p><strong>目录</strong></p>
<!-- TOC -->
<ul>
<li><a href="#从-tagged-template-literals-说起">从 Tagged Template Literals 说起</a></li>
<li><a href="#源码导读">源码导读</a><ul>
<li><a href="#1-处理标签模板字面量">1. 处理标签模板字面量</a></li>
<li><a href="#2-react-组件的封装">2. React 组件的封装</a></li>
<li><a href="#3-样式和类名的生成">3. 样式和类名的生成</a></li>
<li><a href="#4-dom-层操作">4. DOM 层操作</a></li>
<li><a href="#5-总结">5. 总结</a></li>
</ul>
</li>
<li><a href="#技术地图">技术地图</a></li>
</ul>
<!-- /TOC -->
<p><br></p>
<hr>
<p><br></p>
<h2 id="从-tagged-template-literals-说起"><a href="#从-tagged-template-literals-说起" class="headerlink" title="从 Tagged Template Literals 说起"></a>从 Tagged Template Literals 说起</h2><p><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals" target="_blank" rel="noopener"><strong>标签模板字面量(Tagged Template Literals)</strong></a>是 ES6 新增的特性，它允许你<strong>自定义字符串的内插(interpolation)规则</strong>, styled-components 正是基于这个特性构建:</p>
<center><br>  <img src="/images/06/styled-sample.png" width="400"><br></center>

<p>它的原理非常简单，所有静态字符串会被拆分出来合并成为数组, 作为第一个参数传入到目标函数，而内插(interpolation)表达式的值则会作为 rest 参数传入:</p>
<center><br>  <img src="/images/06/tag-template.png" width="400"><br></center>

<p><strong>标签模板字面量相比普通的模板字面量更加灵活. 普通模板字符串会将所有内插值转换为字符串，而<code>标签模板字面量</code>则由你自己来控制</strong>:</p>
<center><br>  <img src="/images/06/tag-template-pros.png" width="600"><br></center>

<p>因为标签模板字符串简洁的语法和灵活性，它比较适用于作为<code>DSL</code>, 不需要在语言层面进行支持，比如前阵子<a href="https://github.com/preactjs/preact" target="_blank" rel="noopener">preact</a>作者开发的<a href="https://github.com/developit/htm" target="_blank" rel="noopener">htm</a>, 口号就是”取代 JSX，而且不需要编译器支持”, 通过这种方式是可以优雅地实现<a href="https://juejin.im/post/5ceacf09e51d454f73356cc4" target="_blank" rel="noopener">‘你的网站或许不需要前端构建’</a>.</p>
<center><br>  <img src="/images/06/htm.png" width="700"><br></center>

<p>另一个典型的例子就是 <code>jest</code> 的<a href="https://jestjs.io/docs/en/api#testeachtable-name-fn-timeout" target="_blank" rel="noopener"><code>表格测试</code></a>, 这样形式可读性更高:</p>
<center><br>  <img src="/images/06/jest.png" width="700"><br></center>

<p>标签模板字面量的脑洞还在继续，比如可以用来写 markdown，再生成 react 组件。限于篇幅就不啰嗦了</p>
<p>扩展:</p>
<ul>
<li><a href="https://mxstbr.blog/2016/11/styled-components-magic-explained/" target="_blank" rel="noopener">The magic behind 💅 styled-components</a></li>
</ul>
<p><br></p>
<hr>
<p><br></p>
<h2 id="源码导读"><a href="#源码导读" class="headerlink" title="源码导读"></a>源码导读</h2><p>现在来看一下 styled-components 的实现。为了行文简洁，我们只关心 styled-components 的核心逻辑，所以我对源代码进行了大量的简化，比如忽略掉服务端渲染、ReactNative 实现、babel 插件等等.</p>
<h3 id="1-处理标签模板字面量"><a href="#1-处理标签模板字面量" class="headerlink" title="1. 处理标签模板字面量"></a>1. 处理标签模板字面量</h3><p>先从 <code>styled</code> 构造函数看起:</p>
<center><br>  <img src="/images/06/styled-code.png" width="500"><br></center>

<p>styled 构造函数接收一个包装组件 target，而标签模板字面量则由<a href="https://www.styled-components.com/docs/api#css" target="_blank" rel="noopener"><code>css</code></a>函数进行处理的. 这个函数在 styled-components 中非常常用，类似于 <code>SCSS</code> 的 <code>mixin</code> 角色. <code>css</code> 函数会标签模板字面量规范化, 例如:</p>
<center><br>  <img src="/images/06/css.png" width="750"><br></center>

<p> css 实现也非常简单:</p>
<center><br>  <img src="/images/06/css-code.png" width="700"><br></center>

<p><code>interleave</code>函数将将静态字符串数组和内插值’拉链式‘交叉合并为单个数组, 比如[1, 2] + [a, b]会合并为[1, a, 2, b]</p>
<p>关键在于如何将数组进行扁平化, 这个由 <code>flatten</code> 函数实现. flatten 函数会将嵌套的 css(数组形式)递归 concat 在一起，将 StyledComponent 组件转换为类名引用、还有处理 keyframe 等等. 最终剩下静态字符串和函数, 输出结果如上所示。</p>
<p><strong>实际上 styled-components 会进行两次 flatten，第一次 flatten 将能够静态化的都转换成字符串，将嵌套的 css 结构打平, 只剩下一些函数，这些函数只能在运行时(比如在组件渲染时)执行；第二次是在运行时，拿到函数的运行上下文(props、theme 等等)后, 执行所有函数，将函数的执行结果进行递归合并，最终生成的是一个纯字符串数组</strong>. 对于标签模板字面量的处理大概都是这个过程. 看看 flatten 的实现:</p>
<center><br>  <img src="/images/06/flatten-code.png" width="700"><br></center>

<p>总结一下标签模板字面量的处理流程大概是这样子:</p>
<center><br><img src="/images/06/flatten.png" width="700"><br></center>

<p><br></p>
<hr>
<p><br></p>
<h3 id="2-react-组件的封装"><a href="#2-react-组件的封装" class="headerlink" title="2. React 组件的封装"></a>2. React 组件的封装</h3><p>现在看看如何构造出 React 组件。styled-components 通过 createStyledComponent 高阶组件将组件封装为 StyledComponent 组件:</p>
<center><br><img src="/images/06/create-component.png" width="800"><br></center>

<p>createStyledComponent 是一个典型的高阶组件，它在执行期间会生成一个唯一的组件 id 和创建<code>ComponentStyle</code>对象. ComponentStyle 对象用于维护 css 函数生成的 cssRules, 在运行时(组件渲染时)得到执行的上下文后生成最终的样式和类名。</p>
<p>再来看看 StyledComponent 的实现, StyledComponent 在组件渲染时，将当前的 props+theme 作为 context 传递给 ComponentStyle，生成类名.</p>
<center><br><img src="/images/06/StyledComponent.png" width="800"><br></center>

<p><br></p>
<hr>
<p><br></p>
<h3 id="3-样式和类名的生成"><a href="#3-样式和类名的生成" class="headerlink" title="3. 样式和类名的生成"></a>3. 样式和类名的生成</h3><p>上面看到 StyleComponent 通过 ComponentStyle 类来构造样式表并生成类名, ComponentStyle 拿到 context 后，再次调用 flatten 将 css rule 扁平化，得到一个纯字符串数组。通过使用 hash 算法生成类名, 并使用stylis 对样式进行预处理. 最后通过 StyleSheet 对象将样式规则插入到 DOM 中</p>
<center><br><img src="/images/06/ComponentStyle.png" width="800"><br></center>

<p><a href="https://github.com/thysultan/stylis.js/blob/master/README.md" target="_blank" rel="noopener">stylis</a>是一个 3kb 的轻量的 CSS 预处理器, styled-components 所有的 CSS 特性都依赖于它， 例如嵌套规则(<code>a {&amp;:hover{}}</code>)、厂商前缀、压缩等等.</p>
<p><br></p>
<hr>
<p><br></p>
<h3 id="4-dom-层操作"><a href="#4-dom-层操作" class="headerlink" title="4. DOM 层操作"></a>4. DOM 层操作</h3><p>现在来看一下 StyleSheet, StyleSheet 负责收集所有组件的样式规则，并插入到 DOM 中</p>
<center><br><img src="/images/06/StyleSheet.png" width="800"><br></center>

<p>看看简化版的 makeTag</p>
<center><br><img src="/images/06/makeTag.png" width="800"><br></center>

<p><br></p>
<hr>
<p><br></p>
<h3 id="5-总结"><a href="#5-总结" class="headerlink" title="5. 总结"></a>5. 总结</h3><p>代码可能看晕了，通过流程图来梳理一下过程.</p>
<blockquote>
<p>上一篇文章<a href="https://juejin.im/post/5cedb26451882566477b7235" target="_blank" rel="noopener">技术地图 - vue-cli</a>一点代码也没有罗列，只有一个流程图, 读者可能一下子就傻眼了, 不知道在说些什么; 而且这个流程图太大，在移动端不好阅读. 这期稍微改进一下，新增’源码导读‘一节，代码表达能力毫无疑问是胜于流程图的，但是代码相对比较细节琐碎，所以第一是将代码进行简化，留下核心的逻辑，第二是使用流程图表示大概的程序流程，以及流程主体之间的关系.</p>
</blockquote>
<p><img src="/images/06/process.png" alt></p>
<p><br></p>
<p>如上图 styled-components 主要有四个核心对象:</p>
<ul>
<li><strong>WrappedComponent</strong>: 这是 createStyledComponent 创建的包装组件，这个组件保存的被包装的 target、并生成组件 id 和 ComponentStyle 对象</li>
<li><strong>StyledComponent</strong>: 这是样式组件，在它 render 时会将 props 作为 context 传递给 ComponentStyle，并生成类名</li>
<li><strong>ComponentStyle</strong>: 负责生成最终的样式表和唯一的类名，并调用 StyleSheet 将生成的样表注入到文档中</li>
<li><strong>StyleSheet</strong>: 负责管理已生成的样式表, 并注入到文档中</li>
</ul>
<p><br></p>
<p><strong>styled-components 性能优化建议</strong></p>
<p>styled-components 每次渲染都会重新计算 cssRule，并进行 hash 计算出 className，如果已经对应的 className 还没插入到样式表中，则使用 stylis 进行预处理，并插入到样式表中; </p>
<p>另外 styled-components 对静态 cssRule(没有任何内插函数)进行了优化，它们不会监听 ThemeContext 变化, 且在渲染时不会重新计算。</p>
<p>通过这些规则可以得出以下性能优化的建议:</p>
<ul>
<li><strong>静态化的 cssRule 性能是最好的</strong></li>
<li><p><strong>降低 StyledComponent 状态复杂度</strong>. styled-components 并不会对已有的不变的样式规则进行复用，一旦状态变化 styled-component 会生成一个全新的样式规则和类名. 这是最简单的一种实现, 避免了样式复用的复杂性，同时保持样式的隔离性, 问题就是会产生样式冗余。 例如</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const Foo = styled.div&lt;&#123; active: boolean &#125;&gt;`</span><br><span class="line">  color: red;</span><br><span class="line">  background: $&#123;props =&gt; (props.active ? &apos;blue&apos; : &apos;red&apos;)&#125;;</span><br><span class="line">`;</span><br></pre></td></tr></table></figure>
<p>active 切换之间会生成两个类名:</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.cQAOKL</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">  <span class="attribute">background</span>: red;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.kklCtT</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: red;</span><br><span class="line">  <span class="attribute">background</span>: blue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果把 StyledComponent 看做是一个状态机，那么 styled-components 可能会为每一个可能的状态生成独立的样式. 如果 StyledComponent 样式很多, 而且状态比较复杂，那么会生成很多冗余的样式.</p>
</li>
<li><p>❌ <strong>不要用于动画</strong>。上面了解到 styled-component 会为每个状态生成一个样式表. 动画一般会有很多中间值，在短时间内进行变化，如果动画值通过props传入该StyledComponent来应用样式，这样会生成很多样式，性能非常差:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const Bar = styled.div&lt;&#123; width: boolean &#125;&gt;`</span><br><span class="line">  color: red;</span><br><span class="line">  // 千万别这么干</span><br><span class="line">  width: $&#123;props =&gt; props.width&#125;;</span><br><span class="line">`;</span><br></pre></td></tr></table></figure>
<p>这种动画场景最好使用 style 内联样式来做</p>
</li>
</ul>
<p><br></p>
<p>OK, 行文结束。styled-components 不过如此是吧？</p>
<p><br></p>
<hr>
<p><br></p>
<h2 id="技术地图"><a href="#技术地图" class="headerlink" title="技术地图"></a>技术地图</h2><ul>
<li><strong>CSS 相关</strong><ul>
<li>@emotion/unitless 判断属性值是否需要单位</li>
<li>css-to-react-native 将 css 转换为 ReactNative style 属性</li>
<li>✨<a href="https://www.npmjs.com/package/bundlesize" target="_blank" rel="noopener">stylis</a> 轻量的 CSS 预处理器</li>
</ul>
</li>
<li><strong>React 相关</strong><ul>
<li>@emotion/is-prop-valid 判断是否是合法的 DOM 属性</li>
<li><a href="https://www.npmjs.com/package/hoist-non-react-statics" target="_blank" rel="noopener">hoist-non-react-statics</a> 提升React组件的静态属性，用于高阶组件场景</li>
<li>✨<a href="https://www.npmjs.com/package/react-is" target="_blank" rel="noopener">react-is</a>: 判断各种 React 组件类型</li>
<li><a href="https://github.com/lelandrichardson/react-primitives#readme" target="_blank" rel="noopener">react-primitives</a> 这是一个有意思的库，这个库试图围绕着构建 React 应用提出一套理想的原语，通俗的说就是通过它可以导入不同平台的组件。</li>
<li><a href="https://github.com/ryanseddon/react-frame-component" target="_blank" rel="noopener">react-frame-component</a> 将react渲染到iframe中。也是一个比较有意思的库</li>
<li><a href="https://www.npmjs.com/package/react-live" target="_blank" rel="noopener">react-live</a> react实时编辑器和展示，主要用于文档</li>
</ul>
</li>
<li><strong>构建相关</strong><ul>
<li><a href="https://github.com/siddharthkp/bundlesize#readme" target="_blank" rel="noopener">bundlesize</a> 检查包大小</li>
<li><a href="https://github.com/codemod-js/codemod/blob/master/packages/cli/README.md" target="_blank" rel="noopener">codemod</a> 使用babel-plugin来重写Javascript或Typescript代码， 一般用于制作升级脚本</li>
<li>✨<a href="https://github.com/developit/microbundle" target="_blank" rel="noopener">microbundle</a> 一个零配置的打包器，基于Rollup，可以用于库的打包和开发, preact作者开发必属精品</li>
</ul>
</li>
</ul>

  </div>
</article>

    <div class="blog-post-comments">
        <div id="disqus_thread">
            <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        </div>
    </div>



    </div>
    
      <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Blogs</a></li>
         
          <li><a href="http://github.com/ivan-94">Projects</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#从-tagged-template-literals-说起"><span class="toc-number">1.</span> <span class="toc-text">从 Tagged Template Literals 说起</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#源码导读"><span class="toc-number">2.</span> <span class="toc-text">源码导读</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-处理标签模板字面量"><span class="toc-number">2.1.</span> <span class="toc-text">1. 处理标签模板字面量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-react-组件的封装"><span class="toc-number">2.2.</span> <span class="toc-text">2. React 组件的封装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-样式和类名的生成"><span class="toc-number">2.3.</span> <span class="toc-text">3. 样式和类名的生成</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-dom-层操作"><span class="toc-number">2.4.</span> <span class="toc-text">4. DOM 层操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-总结"><span class="toc-number">2.5.</span> <span class="toc-text">5. 总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#技术地图"><span class="toc-number">3.</span> <span class="toc-text">技术地图</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://bobi.ink/2019/05/29/styled-components-map/"><i class="fa fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=https://bobi.ink/2019/05/29/styled-components-map/&text=深入浅出 标签模板字符串 和 💅styled-components 💅"><i class="fa fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://bobi.ink/2019/05/29/styled-components-map/&title=深入浅出 标签模板字符串 和 💅styled-components 💅"><i class="fa fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://bobi.ink/2019/05/29/styled-components-map/&is_video=false&description=深入浅出 标签模板字符串 和 💅styled-components 💅"><i class="fa fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=深入浅出 标签模板字符串 和 💅styled-components 💅&body=Check out this article: https://bobi.ink/2019/05/29/styled-components-map/"><i class="fa fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=https://bobi.ink/2019/05/29/styled-components-map/&title=深入浅出 标签模板字符串 和 💅styled-components 💅"><i class="fa fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=https://bobi.ink/2019/05/29/styled-components-map/&title=深入浅出 标签模板字符串 和 💅styled-components 💅"><i class="fa fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://bobi.ink/2019/05/29/styled-components-map/&title=深入浅出 标签模板字符串 和 💅styled-components 💅"><i class="fa fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=https://bobi.ink/2019/05/29/styled-components-map/&title=深入浅出 标签模板字符串 和 💅styled-components 💅"><i class="fa fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=https://bobi.ink/2019/05/29/styled-components-map/&name=深入浅出 标签模板字符串 和 💅styled-components 💅&description="><i class="fa fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
      <ul>
        <li id="toc"><a class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa fa-list fa-lg" aria-hidden="true"></i> TOC</a></li>
        <li id="share"><a class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa fa-share-alt fa-lg" aria-hidden="true"></i> Share</a></li>
        <li id="top" style="display:none"><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a></li>
        <li id="menu"><a class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa fa-bars fa-lg" aria-hidden="true"></i> Menu</a></li>
      </ul>
    </div>

  </div>
</div>

    
    <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2023 Ivan
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Blogs</a></li>
         
          <li><a href="http://github.com/ivan-94">Projects</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

</body>
</html>
<!-- styles -->
<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
<link rel="stylesheet" href="/lib/meslo-LG/styles.css">
<link rel="stylesheet" href="/lib/justified-gallery/justifiedGallery.min.css">

<!-- jquery -->
<script src="/lib/jquery/jquery.min.js"></script>
<script src="/lib/justified-gallery/jquery.justifiedGallery.min.js"></script>
<script src="/js/main.js"></script>


    <!-- Google Analytics -->
    <script type="text/javascript">
        (function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-44571525-2', 'auto');
        ga('send', 'pageview');
    </script>


    <!-- Disqus Comments -->
    <script type="text/javascript">
        var disqus_shortname = 'bobi-ink';

        (function(){
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        }());
    </script>


