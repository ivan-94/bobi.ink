<!DOCTYPE html>
<html lang=zh>
<head><meta name="generator" content="Hexo 3.8.0">
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="description" content="ä¸Šç¯‡æ–‡ç« ä»‹ç»äº† Suspense, é‚£ä¹ˆè¿™ç¯‡æ–‡ç« å°±è®²è®²å®ƒçš„å¥½æ­æ¡£ useTransitionã€‚å¦‚æœä½ æ˜¯ React çš„ç²‰ä¸ï¼Œè¿™ä¸¤ç¯‡æ–‡ç« ä¸€å®šä¸èƒ½é”™è¿‡ã€‚ æˆ‘ä»¬çŸ¥é“ React å†…éƒ¨åšäº†ç¿»å¤©è¦†åœ°çš„ä¼˜åŒ–ï¼Œå¤–éƒ¨ä¹Ÿæä¾›äº†ä¸€äº›ç´§å‡‘çš„æ–° APIï¼Œè¿™äº› API ä¸»è¦ç”¨æ¥ä¼˜åŒ–ç”¨æˆ·ä½“éªŒã€‚React å®˜æ–¹ç”¨ä¸€ç¯‡å¾ˆé•¿çš„æ–‡æ¡£ã€ŠConcurrent UI Patterns ã€‹ ä¸“é—¨æ¥ä»‹ç»è¿™ä¸€æ–¹é¢çš„åŠ¨æœºå’Œåˆ›é€ ï¼Œå…¶ä¸­çš„ä¸»è§’å°±æ˜¯ u">
<meta name="keywords" content="Blog,FrontEnd,React,Javascript,Typescript">
<meta property="og:type" content="article">
<meta property="og:title" content="React Concurrent æ¨¡å¼æŠ¢å…ˆé¢„è§ˆä¸‹ç¯‡: useTransition çš„å¹³è¡Œä¸–ç•Œ">
<meta property="og:url" content="https://bobi.ink/2019/10/28/concurrent-mode-transition/index.html">
<meta property="og:site_name" content="Bobi.ink">
<meta property="og:description" content="ä¸Šç¯‡æ–‡ç« ä»‹ç»äº† Suspense, é‚£ä¹ˆè¿™ç¯‡æ–‡ç« å°±è®²è®²å®ƒçš„å¥½æ­æ¡£ useTransitionã€‚å¦‚æœä½ æ˜¯ React çš„ç²‰ä¸ï¼Œè¿™ä¸¤ç¯‡æ–‡ç« ä¸€å®šä¸èƒ½é”™è¿‡ã€‚ æˆ‘ä»¬çŸ¥é“ React å†…éƒ¨åšäº†ç¿»å¤©è¦†åœ°çš„ä¼˜åŒ–ï¼Œå¤–éƒ¨ä¹Ÿæä¾›äº†ä¸€äº›ç´§å‡‘çš„æ–° APIï¼Œè¿™äº› API ä¸»è¦ç”¨æ¥ä¼˜åŒ–ç”¨æˆ·ä½“éªŒã€‚React å®˜æ–¹ç”¨ä¸€ç¯‡å¾ˆé•¿çš„æ–‡æ¡£ã€ŠConcurrent UI Patterns ã€‹ ä¸“é—¨æ¥ä»‹ç»è¿™ä¸€æ–¹é¢çš„åŠ¨æœºå’Œåˆ›é€ ï¼Œå…¶ä¸­çš„ä¸»è§’å°±æ˜¯ u">
<meta property="og:locale" content="zh">
<meta property="og:image" content="https://bobi.ink/images/concurrent-mode/suspense-branch.png">
<meta property="og:image" content="https://bobi.ink/images/concurrent-mode/component-state.png">
<meta property="og:image" content="https://bobi.ink/images/concurrent-mode/browser.gif">
<meta property="og:image" content="https://bobi.ink/images/concurrent-mode/github.gif">
<meta property="og:image" content="https://bobi.ink/images/concurrent-mode/page-state.png">
<meta property="og:image" content="https://bobi.ink/images/concurrent-mode/demo1.gif">
<meta property="og:image" content="https://bobi.ink/images/concurrent-mode/demo2.gif">
<meta property="og:image" content="https://bobi.ink/images/concurrent-mode/test1.gif">
<meta property="og:image" content="https://bobi.ink/images/concurrent-mode/test2.gif">
<meta property="og:image" content="https://bobi.ink/images/concurrent-mode/test3.gif">
<meta property="og:image" content="https://bobi.ink/images/concurrent-mode/test4-1.gif">
<meta property="og:image" content="https://bobi.ink/images/concurrent-mode/test4-2.gif">
<meta property="og:image" content="https://bobi.ink/images/concurrent-mode/test4-3.gif">
<meta property="og:image" content="https://bobi.ink/images/concurrent-mode/test5.gif">
<meta property="og:image" content="https://bobi.ink/images/concurrent-mode/hyhs.png">
<meta property="og:image" content="https://bobi.ink/images/sponsor.jpg">
<meta property="og:updated_time" content="2023-06-01T09:55:14.328Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="React Concurrent æ¨¡å¼æŠ¢å…ˆé¢„è§ˆä¸‹ç¯‡: useTransition çš„å¹³è¡Œä¸–ç•Œ">
<meta name="twitter:description" content="ä¸Šç¯‡æ–‡ç« ä»‹ç»äº† Suspense, é‚£ä¹ˆè¿™ç¯‡æ–‡ç« å°±è®²è®²å®ƒçš„å¥½æ­æ¡£ useTransitionã€‚å¦‚æœä½ æ˜¯ React çš„ç²‰ä¸ï¼Œè¿™ä¸¤ç¯‡æ–‡ç« ä¸€å®šä¸èƒ½é”™è¿‡ã€‚ æˆ‘ä»¬çŸ¥é“ React å†…éƒ¨åšäº†ç¿»å¤©è¦†åœ°çš„ä¼˜åŒ–ï¼Œå¤–éƒ¨ä¹Ÿæä¾›äº†ä¸€äº›ç´§å‡‘çš„æ–° APIï¼Œè¿™äº› API ä¸»è¦ç”¨æ¥ä¼˜åŒ–ç”¨æˆ·ä½“éªŒã€‚React å®˜æ–¹ç”¨ä¸€ç¯‡å¾ˆé•¿çš„æ–‡æ¡£ã€ŠConcurrent UI Patterns ã€‹ ä¸“é—¨æ¥ä»‹ç»è¿™ä¸€æ–¹é¢çš„åŠ¨æœºå’Œåˆ›é€ ï¼Œå…¶ä¸­çš„ä¸»è§’å°±æ˜¯ u">
<meta name="twitter:image" content="https://bobi.ink/images/concurrent-mode/suspense-branch.png">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>React Concurrent æ¨¡å¼æŠ¢å…ˆé¢„è§ˆä¸‹ç¯‡: useTransition çš„å¹³è¡Œä¸–ç•Œ</title>
    <!-- styles -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- rss -->
    
    
</head>

<body>
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Blogs</a></li>
         
          <li><a href="http://github.com/ivan-94">Projects</a></li>
        
      </ul>
    </span>
    <br>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2019/11/04/react-composition/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/2019/10/26/concurrent-mode-suspense/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://bobi.ink/2019/10/28/concurrent-mode-transition/"><i class="fa fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=https://bobi.ink/2019/10/28/concurrent-mode-transition/&text=React Concurrent æ¨¡å¼æŠ¢å…ˆé¢„è§ˆä¸‹ç¯‡: useTransition çš„å¹³è¡Œä¸–ç•Œ"><i class="fa fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://bobi.ink/2019/10/28/concurrent-mode-transition/&title=React Concurrent æ¨¡å¼æŠ¢å…ˆé¢„è§ˆä¸‹ç¯‡: useTransition çš„å¹³è¡Œä¸–ç•Œ"><i class="fa fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://bobi.ink/2019/10/28/concurrent-mode-transition/&is_video=false&description=React Concurrent æ¨¡å¼æŠ¢å…ˆé¢„è§ˆä¸‹ç¯‡: useTransition çš„å¹³è¡Œä¸–ç•Œ"><i class="fa fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=React Concurrent æ¨¡å¼æŠ¢å…ˆé¢„è§ˆä¸‹ç¯‡: useTransition çš„å¹³è¡Œä¸–ç•Œ&body=Check out this article: https://bobi.ink/2019/10/28/concurrent-mode-transition/"><i class="fa fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=https://bobi.ink/2019/10/28/concurrent-mode-transition/&title=React Concurrent æ¨¡å¼æŠ¢å…ˆé¢„è§ˆä¸‹ç¯‡: useTransition çš„å¹³è¡Œä¸–ç•Œ"><i class="fa fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=https://bobi.ink/2019/10/28/concurrent-mode-transition/&title=React Concurrent æ¨¡å¼æŠ¢å…ˆé¢„è§ˆä¸‹ç¯‡: useTransition çš„å¹³è¡Œä¸–ç•Œ"><i class="fa fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://bobi.ink/2019/10/28/concurrent-mode-transition/&title=React Concurrent æ¨¡å¼æŠ¢å…ˆé¢„è§ˆä¸‹ç¯‡: useTransition çš„å¹³è¡Œä¸–ç•Œ"><i class="fa fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=https://bobi.ink/2019/10/28/concurrent-mode-transition/&title=React Concurrent æ¨¡å¼æŠ¢å…ˆé¢„è§ˆä¸‹ç¯‡: useTransition çš„å¹³è¡Œä¸–ç•Œ"><i class="fa fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=https://bobi.ink/2019/10/28/concurrent-mode-transition/&name=React Concurrent æ¨¡å¼æŠ¢å…ˆé¢„è§ˆä¸‹ç¯‡: useTransition çš„å¹³è¡Œä¸–ç•Œ&description="><i class="fa fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#åº”ç”¨åœºæ™¯æ˜¯ä»€ä¹ˆï¼Ÿ"><span class="toc-number">1.</span> <span class="toc-text">åº”ç”¨åœºæ™¯æ˜¯ä»€ä¹ˆï¼Ÿ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#usetransition-ç™»åœº"><span class="toc-number">2.</span> <span class="toc-text">useTransition ç™»åœº</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#usetransition-åŸç†åˆæ¢"><span class="toc-number">3.</span> <span class="toc-text">useTransition åŸç†åˆæ¢</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1ï¸âƒ£-åˆ©ç”¨-starttransition-æ¥è¿è¡Œä½ä¼˜å…ˆçº§ä»»åŠ¡"><span class="toc-number">3.1.</span> <span class="toc-text">1ï¸âƒ£ åˆ©ç”¨ startTransition æ¥è¿è¡Œä½ä¼˜å…ˆçº§ä»»åŠ¡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2ï¸âƒ£-starttransition-æ›´æ–°è§¦å‘-suspense"><span class="toc-number">3.2.</span> <span class="toc-text">2ï¸âƒ£ startTransition æ›´æ–°è§¦å‘ Suspense</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3ï¸âƒ£-å°†-tick-æ›´æ–°æåˆ°-starttransition-ä½œç”¨åŸŸå¤–"><span class="toc-number">3.3.</span> <span class="toc-text">3ï¸âƒ£ å°† tick æ›´æ–°æåˆ° startTransition ä½œç”¨åŸŸå¤–</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4ï¸âƒ£-åµŒå¥—suspense"><span class="toc-number">3.4.</span> <span class="toc-text">4ï¸âƒ£ åµŒå¥—Suspense</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5ï¸âƒ£-å¯ä»¥å’Œ-mobx-å’Œ-redux-é…åˆä½¿ç”¨å—"><span class="toc-number">3.5.</span> <span class="toc-text">5ï¸âƒ£ å¯ä»¥å’Œ Mobx å’Œ Redux é…åˆä½¿ç”¨å—?</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#é‚£-usedeferedvalue-å‘¢ï¼Ÿ"><span class="toc-number">4.</span> <span class="toc-text">é‚£ useDeferedValue å‘¢ï¼Ÿ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#æ€»ç»“"><span class="toc-number">5.</span> <span class="toc-text">æ€»ç»“</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#å‚è€ƒèµ„æ–™"><span class="toc-number">6.</span> <span class="toc-text">å‚è€ƒèµ„æ–™</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index width mx-auto px2 my4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        React Concurrent æ¨¡å¼æŠ¢å…ˆé¢„è§ˆä¸‹ç¯‡: useTransition çš„å¹³è¡Œä¸–ç•Œ
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">Bobi.ink</span>
      </span>
      
    <div class="postdate">
        <time datetime="2019-10-27T16:00:00.000Z" itemprop="datePublished">2019-10-28</time>
    </div>


      

    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <p>ä¸Šç¯‡æ–‡ç« ä»‹ç»äº† <a href="https://juejin.im/post/5db65d87518825648f2ef899" target="_blank" rel="noopener"><code>Suspense</code></a>, é‚£ä¹ˆè¿™ç¯‡æ–‡ç« å°±è®²è®²å®ƒçš„å¥½æ­æ¡£ <a href="https://reactjs.org/docs/concurrent-mode-reference.html#usetransition" target="_blank" rel="noopener"><code>useTransition</code></a>ã€‚å¦‚æœä½ æ˜¯ React çš„ç²‰ä¸ï¼Œè¿™ä¸¤ç¯‡æ–‡ç« ä¸€å®šä¸èƒ½é”™è¿‡ã€‚</p>
<p>æˆ‘ä»¬çŸ¥é“ React å†…éƒ¨åšäº†ç¿»å¤©è¦†åœ°çš„ä¼˜åŒ–ï¼Œå¤–éƒ¨ä¹Ÿæä¾›äº†ä¸€äº›ç´§å‡‘çš„æ–° APIï¼Œ<strong>è¿™äº› API ä¸»è¦ç”¨æ¥ä¼˜åŒ–ç”¨æˆ·ä½“éªŒ</strong>ã€‚React å®˜æ–¹ç”¨ä¸€ç¯‡å¾ˆé•¿çš„æ–‡æ¡£<a href="https://reactjs.org/docs/concurrent-mode-patterns.html" target="_blank" rel="noopener">ã€ŠConcurrent UI Patterns ã€‹</a> ä¸“é—¨æ¥ä»‹ç»è¿™ä¸€æ–¹é¢çš„åŠ¨æœºå’Œåˆ›é€ ï¼Œå…¶ä¸­çš„ä¸»è§’å°±æ˜¯ <code>useTransition</code>ã€‚</p>
<p><br></p>
<p><strong>ç›¸å…³æ–‡ç« </strong></p>
<ul>
<li><a href="https://juejin.im/post/5dadc6045188255a270a0f85" target="_blank" rel="noopener">è¿™å¯èƒ½æ˜¯æœ€é€šä¿—çš„ React Fiber(æ—¶é—´åˆ†ç‰‡) æ‰“å¼€æ–¹å¼</a> ğŸ”¥å…ˆå…¥ä¸ªé—¨</li>
<li><a href="https://juejin.im/post/5db65d87518825648f2ef899" target="_blank" rel="noopener">React Concurrent æ¨¡å¼æŠ¢å…ˆé¢„è§ˆä¸Šç¯‡: Suspense the world</a> ä¸Šç¯‡</li>
</ul>
<p><br><br><br></p>
<p><strong>æœ¬æ–‡å¤§çº²</strong></p>
<!-- TOC -->
<ul>
<li><a href="#åº”ç”¨åœºæ™¯æ˜¯ä»€ä¹ˆ">åº”ç”¨åœºæ™¯æ˜¯ä»€ä¹ˆï¼Ÿ</a></li>
<li><a href="#usetransition-ç™»åœº">useTransition ç™»åœº</a></li>
<li><a href="#usetransition-åŸç†åˆæ¢">useTransition åŸç†åˆæ¢</a><ul>
<li><a href="#1ï¸âƒ£-åˆ©ç”¨-starttransition-æ¥è¿è¡Œä½ä¼˜å…ˆçº§ä»»åŠ¡"><strong>1ï¸âƒ£ åˆ©ç”¨ startTransition æ¥è¿è¡Œä½ä¼˜å…ˆçº§ä»»åŠ¡</strong></a></li>
<li><a href="#2ï¸âƒ£-starttransition-æ›´æ–°è§¦å‘-suspense"><strong>2ï¸âƒ£ startTransition æ›´æ–°è§¦å‘ Suspense</strong></a></li>
<li><a href="#3ï¸âƒ£-å°†-tick-æ›´æ–°æåˆ°-starttransition-ä½œç”¨åŸŸå¤–"><strong>3ï¸âƒ£ å°† tick æ›´æ–°æåˆ° startTransition ä½œç”¨åŸŸå¤–</strong></a></li>
<li><a href="#4ï¸âƒ£-åµŒå¥—suspense"><strong>4ï¸âƒ£ åµŒå¥—Suspense</strong></a></li>
<li><a href="#5ï¸âƒ£-å¯ä»¥å’Œ-mobx-å’Œ-redux-é…åˆä½¿ç”¨å—"><strong>5ï¸âƒ£ å¯ä»¥å’Œ Mobx å’Œ Redux é…åˆä½¿ç”¨å—?</strong></a></li>
</ul>
</li>
<li><a href="#é‚£-usedeferedvalue-å‘¢">é‚£ useDeferedValue å‘¢ï¼Ÿ</a></li>
<li><a href="#æ€»ç»“">æ€»ç»“</a></li>
<li><a href="#å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</a></li>
</ul>
<!-- /TOC -->
<p><br></p>
<p>React ç”¨â€™<strong>å¹³è¡Œå®‡å®™</strong>â€˜æ¥æ¯”å–»è¿™ä¸ª useTransition è¿™ä¸ª APIã€‚Whatï¼Ÿ</p>
<p>ç”¨ Git åˆ†æ”¯æ¥æ¯”å–»ä¼šæ›´å¥½ç†è§£ä¸€ç‚¹, å¦‚ä¸‹å›¾ï¼ŒReact å¯ä»¥ä»å½“å‰è§†å›¾(å¯ä»¥è§†ä½œ <code>Master</code>) åˆ†æ”¯ä¸­ <code>Fork</code> å‡ºæ¥ä¸€ä¸ªæ–°çš„åˆ†æ”¯(å°šä¸”ç§°ä¸º <code>Pending</code>)ï¼Œåœ¨è¿™ä¸ªæ–°åˆ†æ”¯ä¸Šè¿›è¡Œæ›´æ–°ï¼ŒåŒæ—¶ <code>Master</code> ä¿æŒå“åº”å’Œæ›´æ–°ï¼Œè¿™ä¸¤ä¸ªåˆ†æ”¯å°±åƒâ€™å¹³è¡Œå®‡å®™â€™ï¼Œä¸¤è€…äº’ä¸å¹²æ‰°ã€‚å½“ <code>Pending</code> åˆ†æ”¯å‡†å¤‡â€™å¦¥å½“â€™ï¼Œå†åˆå¹¶(æäº¤)åˆ° <code>Master</code>åˆ†æ”¯ã€‚</p>
<p><img src="/images/concurrent-mode/suspense-branch.png" alt></p>
<p><br></p>
<p><code>useTransition</code> å°±åƒä¸€ä¸ªæ—¶å…‰éš§é“, è®©ç»„ä»¶è¿›å…¥ä¸€ä¸ªå¹³è¡Œå®‡å®™ï¼Œåœ¨è¿™ä¸ªå¹³è¡Œå®‡å®™ä¸­ç­‰å¾…<code>å¼‚æ­¥çŠ¶æ€</code>(å¼‚æ­¥è¯·æ±‚ã€å»¶æ—¶ã€whatever)å°±ç»ªã€‚å½“ç„¶ç»„ä»¶ä¹Ÿä¸èƒ½æ— é™æœŸå¾…åœ¨å¹³è¡Œå®‡å®™ï¼Œ<code>useTranstion</code> å¯ä»¥é…ç½®è¶…æ—¶æ—¶é—´ï¼Œå¦‚æœè¶…æ—¶äº†ï¼Œå°±ç®—<code>å¼‚æ­¥çŠ¶æ€</code>æœªå°±ç»ªä¹Ÿä¼šè¢«å¼ºåˆ¶æ‹‰å›ç°å®ä¸–ç•Œã€‚å›åˆ°ç°å®ä¸–ç•Œåï¼ŒReact ä¼šç«‹å³å¯¹ç»„ä»¶ Pengding çš„å˜æ›´è¿›è¡Œåˆå¹¶ï¼Œå‘ˆç°åœ¨ç”¨æˆ·é¢å‰ã€‚</p>
<p>å› æ­¤ï¼Œä½ å¯ä»¥è®¤ä¸ºåœ¨Concurrent æ¨¡å¼ä¸‹ï¼Œ React ç»„ä»¶æœ‰ä¸‰ç§çŠ¶æ€:</p>
<p><img src="/images/concurrent-mode/component-state.png" alt></p>
<p><br></p>
<ul>
<li><strong>Normal</strong> - æ­£å¸¸çŠ¶æ€ä¸‹çš„ç»„ä»¶</li>
<li><strong>Suspense</strong> - å› å¼‚æ­¥çŠ¶æ€è€ŒæŒ‚èµ·çš„ç»„ä»¶</li>
<li><strong>Pending</strong> - è¿›å…¥å¹³è¡Œå®‡å®™çš„ç»„ä»¶ã€‚å¯¹åº”çš„ä¹Ÿæœ‰ Pending çš„â€™çŠ¶æ€å˜æ›´â€™ï¼Œè¿™äº›å˜æ›´ React ä¸ä¼šç«‹å³æäº¤åˆ°ç”¨æˆ·ç•Œé¢ï¼Œè€Œæ˜¯ç¼“å­˜ç€ï¼Œç­‰å¾… Suspense å°±ç»ªæˆ–è¶…æ—¶ã€‚</li>
</ul>
<p>ä½ å¯èƒ½è¿˜ä¸å¤ªèƒ½ç†è§£, æ²¡å…³ç³»ï¼Œç»§ç»­å¾€ä¸‹è¯»ã€‚</p>
<p><br><br><br></p>
<h2 id="åº”ç”¨åœºæ™¯æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#åº”ç”¨åœºæ™¯æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="åº”ç”¨åœºæ™¯æ˜¯ä»€ä¹ˆï¼Ÿ"></a>åº”ç”¨åœºæ™¯æ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>â€˜å¹³è¡Œå®‡å®™â€™æœ‰ä»€ä¹ˆç”¨ï¼Ÿ æˆ‘ä»¬ä¸è®²ä»£ç æˆ–è€…æ¶æ„å±‚æ¬¡çš„ä¸œè¥¿ã€‚å•ä» <code>UI</code> ä¸Šçœ‹ï¼š <strong>åœ¨æŸäº› UI äº¤äº’åœºæ™¯ï¼Œæˆ‘ä»¬å¹¶ä¸æƒ³é©¬ä¸Šå°†å˜æ›´ç«‹å³åº”ç”¨åˆ°é¡µé¢ä¸Š</strong>ã€‚</p>
<p><strong>ğŸ”´æ¯”å¦‚ä½ ä»ä¸€ä¸ªé¡µé¢åˆ‡æ¢åˆ°å¦ä¸€ä¸ªé¡µé¢ï¼Œæ–°é¡µé¢å¯èƒ½éœ€è¦ä¸€äº›æ—¶é—´æ‰èƒ½åŠ è½½å®Œæˆï¼Œå…¶å®æˆ‘ä»¬æ›´ä¹äºç¨å¾®åœç•™åœ¨ä¸Šä¸€ä¸ªé¡µé¢ï¼Œä¿æŒä¸€äº›æ“ä½œå“åº”, æ¯”å¦‚æˆ‘ä»¬å¯ä»¥å–æ¶ˆï¼Œæˆ–è€…è¿›è¡Œå…¶ä»–æ“ä½œï¼Œè€Œç»™æˆ‘çœ‹ä¸€ä¸ªä»€ä¹ˆéƒ½æ²¡æœ‰çš„ç©ºç™½é¡µé¢æˆ–è€…ç©ºè½¬åŠ è½½çŠ¶æ€ç¬¦, æ„Ÿè§‰åœ¨åšæ— è°“çš„ç­‰å¾…</strong>ã€‚</p>
<p>è¿™ç§äº¤äº’åœºæ™¯å…¶å®éå¸¸å¸¸è§ï¼Œçœ¼å‰çš„ä¾‹å­å°±æ˜¯æµè§ˆå™¨ï¼š</p>
<p><br></p>
<p><img src="/images/concurrent-mode/browser.gif" alt><br><i>å‡è£…æˆ‘è¦ä¹°ä¸ª AirPods</i></p>
<p><br></p>
<p>è¿˜æœ‰æˆ‘ä»¬å¸¸ç”¨çš„ Github:</p>
<p><img src="/images/concurrent-mode/github.gif" alt><br><i>å›½å¤–æŸè‘—åäº¤å‹ç½‘ç«™</i></p>
<p><br></p>
<p>æ¯”å¦‚æˆ‘æƒ³ç‚¹å‡»ä¹°ä¸ª <code>AirPods</code>ï¼Œæµè§ˆå™¨ä¼šåœç•™åœ¨ä¸Šä¸€ä¸ªé¡µé¢ï¼Œç›´åˆ°ä¸‹ä¸€ä¸ªé¡µé¢çš„è¯·æ±‚è·å¾—å“åº”æˆ–è€…è¶…æ—¶ã€‚å¦å¤–æµè§ˆå™¨ä¼šé€šè¿‡åœ°å€æ çš„åŠ è½½æŒ‡ç¤ºç¬¦æç¤ºè¯·æ±‚æƒ…å†µã€‚è¿™ç§äº¤äº’è®¾è®¡ï¼Œæ¯”ç›´æ¥åˆ‡æ¢è¿‡å»ï¼Œå±•ç¤ºä¸€ä¸ªç©ºç™½çš„é¡µé¢è¦å¥½å¾—å¤š. é¡µé¢å¯ä»¥ä¿æŒç”¨æˆ·å“åº”, ä¹Ÿå¯ä»¥éšæ—¶å–æ¶ˆè¯·æ±‚ï¼Œä¿ç•™åœ¨åŸæ¥çš„é¡µé¢ã€‚</p>
<blockquote>
<p>å½“ç„¶, Tab åˆ‡æ¢æ—¶å¦å¤–ä¸€ç§äº¤äº’åœºæ™¯ï¼Œæˆ‘ä»¬å¸Œæœ›å®ƒé©¬ä¸Šåˆ‡æ¢è¿‡å», å¦åˆ™ç”¨æˆ·ä¼šè§‰å¾—ç‚¹å‡»ä¸èµ·ä½œç”¨ã€‚</p>
</blockquote>
<p>â€˜å¹³è¡Œå®‡å®™â€™ï¼Œè¿˜æœ‰ä¸€ä¸ªå¥½å¤„: <strong>ğŸ”´æˆ‘ä»¬å‡è®¾å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œæ•°æ®è¯·æ±‚éƒ½æ˜¯éå¸¸å¿«çš„ï¼Œè¿™æ—¶å€™å…¶å®æ²¡æœ‰å¿…è¦å±•ç¤ºåŠ è½½çŠ¶æ€ï¼Œè¿™ä¼šå¯¼è‡´é¡µé¢é—ªçƒå’ŒæŠ–åŠ¨ã€‚å…¶å®é€šè¿‡çŸ­æš‚çš„å»¶æ—¶ï¼Œå¯ä»¥æ¥å‡å°‘åŠ è½½çŠ¶æ€çš„å±•ç¤ºé¢‘ç‡</strong>ã€‚</p>
<p>å¦å¤–ï¼Œ<strong>ğŸ”´useTransition ä¹Ÿå¯ä»¥ç”¨äºåŒ…è£¹ä½ä¼˜å…ˆçº§æ›´æ–°</strong>ã€‚ ä»ç›®å‰çš„æƒ…å†µçœ‹ï¼ŒReact å¹¶æ²¡æœ‰æ„æ„¿æš´éœ²è¿‡å¤šçš„ Concurrent æ¨¡å¼çš„åº•å±‚ç»†èŠ‚ã€‚å¦‚æœä½ è¦è°ƒåº¦ä½ä¼˜å…ˆçº§çš„æ›´æ–°ï¼Œåªèƒ½ä½¿ç”¨ useTransitionã€‚</p>
<p><br><br><br></p>
<h2 id="usetransition-ç™»åœº"><a href="#usetransition-ç™»åœº" class="headerlink" title="useTransition ç™»åœº"></a>useTransition ç™»åœº</h2><p><img src="/images/concurrent-mode/page-state.png" alt></p>
<p><br></p>
<p>å¦‚ä¸Šå›¾ï¼Œæˆ‘ä»¬å…ˆæŒ‰ç…§ React å®˜æ–¹æ–‡æ¡£çš„æè¿°æ¥å®šä¹‰é¡µé¢çš„å„ç§çŠ¶æ€ã€‚<strong>å®ƒæåˆ°é¡µé¢åŠ è½½æœ‰ä»¥ä¸‹ä¸‰ä¸ªé˜¶æ®µ</strong>:</p>
<p><strong>â‘  è¿‡æ¸¡é˜¶æ®µ(Transition)</strong></p>
<p>æŒ‡çš„æ˜¯é¡µé¢æœªå°±ç»ªï¼Œç­‰å¾…åŠ è½½å…³é”®æ•°æ®çš„é˜¶æ®µã€‚æŒ‰ç…§ä¸åŒçš„å±•ç¤ºç­–ç•¥ï¼Œé¡µé¢å¯ä»¥æœ‰ä»¥ä¸‹ä¸¤ç§çŠ¶æ€ï¼š</p>
<ul>
<li><p><strong>âš›ï¸é€€åŒ–(Receded)</strong>ã€‚é©¬ä¸Šå°†é¡µé¢åˆ‡æ¢è¿‡å»ï¼Œå±•ç¤ºä¸€ä¸ªå¤§å¤§çš„åŠ è½½æŒ‡ç¤ºå™¨æˆ–è€…ç©ºç™½é¡µé¢ã€‚â€™é€€åŒ–â€™æ˜¯ä»€ä¹ˆæ„æ€? æŒ‰ç…§ React çš„è¯´æ³•æ˜¯ï¼Œé¡µé¢åŸæœ¬æœ‰å†…å®¹ï¼Œç°åœ¨å˜ä¸ºæ— å†…å®¹çŠ¶æ€ï¼Œè¿™æ˜¯ä¸€ç§é€€åŒ–ï¼Œæˆ–è€…è¯´å†å²çš„â€™é€€æ­¥â€™ã€‚</p>
</li>
<li><p><strong>âš›ï¸å¾…å®š(Pending)</strong>ã€‚è¿™æ˜¯ <code>useTransition</code> è¦è¾¾åˆ°çš„çŠ¶æ€ï¼Œå³åœç•™åœ¨å½“å‰é¡µé¢ï¼Œè®©å½“å‰é¡µé¢ä¿æŒå“åº”ã€‚åœ¨<strong>å…³é”®æ•°æ®å‡†å¤‡å°±ç»ª</strong>æ—¶è¿›å…¥ <code>Skeleton</code>(éª¨æ¶å±) çŠ¶æ€ï¼Œ äº¦æˆ–è€…ç­‰å¾…è¶…æ—¶å›é€€åˆ° <code>Receded</code> çŠ¶æ€ã€‚</p>
</li>
</ul>
<p><br></p>
<p><strong>â‘¡ åŠ è½½é˜¶æ®µ(Loading)</strong></p>
<p>æŒ‡çš„æ˜¯<code>å…³é”®æ•°æ®</code>å·²ç»å‡†å¤‡å°±ç»ªï¼Œå¯ä»¥å¼€å§‹å±•ç¤ºé¡µé¢çš„éª¨æ¶æˆ–è€…æ¡†æ¶éƒ¨åˆ†ã€‚è¿™ä¸ªé˜¶æ®µæœ‰ä¸€ä¸ªçŠ¶æ€:</p>
<ul>
<li><strong>âš›ï¸éª¨æ¶(Skeleton)</strong>ã€‚å…³é”®æ•°æ®å·²ç»åŠ è½½å®Œæ¯•ï¼Œé¡µé¢å±•ç¤ºäº†ä¸»ä½“çš„æ¡†æ¶ã€‚</li>
</ul>
<p><br></p>
<p><strong>â‘¢å°±ç»ªé˜¶æ®µ(Done)</strong>ã€‚</p>
<p>æŒ‡çš„æ˜¯é¡µé¢å®Œå…¨åŠ è½½å®Œæ¯•ã€‚è¿™ä¸ªé˜¶æ®µæœ‰ä¸€ä¸ªçŠ¶æ€:</p>
<ul>
<li><strong>âš›ï¸å®Œæˆ(Complete)</strong> é¡µé¢å®Œå…¨å‘ˆç°</li>
</ul>
<p><br><br><br></p>
<p>ä¼ ç»Ÿçš„ React ä¸­ï¼Œå½“æˆ‘ä»¬å˜æ›´çŠ¶æ€è¿›å…¥ä¸€ä¸ªæ–°å±å¹•æ—¶ï¼Œç»å†çš„æ˜¯ <strong>ğŸ”´<code>Receded</code> -&gt; <code>Skeleton</code> -&gt; <code>Complete</code></strong> è·¯å¾„ã€‚åœ¨æ­¤ä¹‹å‰è¦å®ç° <strong>ğŸ”´<code>Pending</code> -&gt; <code>Skeleton</code> -&gt; <code>Complete</code></strong> è¿™ç§åŠ è½½è·¯å¾„æ¯”è¾ƒå›°éš¾ã€‚ <code>useTransition</code> å¯ä»¥æ”¹å˜è¿™ä¸ªå±€é¢ã€‚</p>
<p><br></p>
<p>æ¥ä¸‹æ¥ç®€å•æ¨¡æ‹Ÿä¸€ä¸ªé¡µé¢åˆ‡æ¢ï¼Œå…ˆæ¥çœ‹é»˜è®¤æƒ…å†µä¸‹æ˜¯å¦‚ä½•åŠ è½½çš„:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">A</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">"letter"</span>&gt;</span>A<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">B</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// âš›ï¸ å»¶è¿ŸåŠ è½½2sï¼Œæ¨¡æ‹Ÿå¼‚æ­¥æ•°æ®è¯·æ±‚</span></span><br><span class="line">  delay(<span class="string">"B"</span>, <span class="number">2000</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">"letter"</span>&gt;</span>B<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">C</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// âš›ï¸ å»¶è¿ŸåŠ è½½4sï¼Œæ¨¡æ‹Ÿå¼‚æ­¥æ•°æ®è¯·æ±‚</span></span><br><span class="line">  delay(<span class="string">"C"</span>, <span class="number">4000</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">"letter"</span>&gt;</span>C<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é¡µé¢1</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Page1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">A</span> /&gt;</span>;</span></span><br><span class="line"><span class="xml">&#125;</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">// é¡µé¢2</span></span><br><span class="line"><span class="xml">function Page2() &#123;</span></span><br><span class="line"><span class="xml">  return (</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">B</span> /&gt;</span></span></span><br><span class="line">      &lt;Suspense fallback=&#123;&lt;div&gt;Loading... C&lt;/div&gt;&#125;&gt;</span><br><span class="line">        &lt;C /&gt;</span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">Suspense</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/&gt;</span></span></span><br><span class="line"><span class="xml">  );</span></span><br><span class="line"><span class="xml">&#125;</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">function App() &#123;</span></span><br><span class="line"><span class="xml">  const [showPage2, setShowPage2] = useState(false);</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">  // ç‚¹å‡»åˆ‡æ¢åˆ°é¡µé¢2</span></span><br><span class="line"><span class="xml">  const handleClick = () =&gt;  setShowPage2(true)</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">  return (</span></span><br><span class="line">    &lt;div className="App"&gt;</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;button onClick=&#123;handleClick&#125;&gt;åˆ‡æ¢&lt;/button&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">      &lt;div className="page"&gt;</span><br><span class="line">        &lt;Suspense fallback=&#123;&lt;div&gt;Loading ...&lt;/div&gt;&#125;&gt;</span><br><span class="line">          &#123;!showPage2 ? &lt;Page1 /&gt; : &lt;Page2 /&gt;&#125;</span><br><span class="line">        &lt;/Suspense&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">  );</span></span><br><span class="line"><span class="xml">&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p>çœ‹ä¸€ä¸‹è¿è¡Œæ•ˆæœ:</p>
<p><img src="/images/concurrent-mode/demo1.gif" alt></p>
<p>ç‚¹å‡»åˆ‡æ¢åï¼Œæˆ‘ä»¬ä¼šé©¬ä¸Šçœ‹åˆ°ä¸€ä¸ªå¤§å¤§çš„ <code>Loading...</code>ï¼Œæ¥ç€ 2s å B åŠ è½½å®Œæ¯•ï¼Œå†ç­‰å¾… 2s å C åŠ è½½å®Œæ¯•ã€‚è¿™ä¸ªè¿‡ç¨‹å°±æ˜¯ <strong><code>Receded</code> -&gt; <code>Skeleton</code> -&gt; <code>Complete</code></strong></p>
<p><br></p>
<p>ç°åœ¨æœ‰è¯· useTransition éš†é‡ç™»åœº ğŸ‰ï¼Œåªéœ€å¯¹ä¸Šé¢çš„ä»£ç è¿›è¡Œçš„ç®€å•æ”¹é€ ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// âš›ï¸ å¯¼å…¥ useTransition</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; Suspense, useState, useTransition &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [showPage2, setShowPage2] = useState(<span class="literal">false</span>);</span><br><span class="line">  <span class="comment">// âš›ï¸ useTransition æ¥æ”¶ä¸€ä¸ªè¶…æ—¶æ—¶é—´ï¼Œè¿”å›ä¸€ä¸ªstartTransition å‡½æ•°ï¼Œä»¥åŠä¸€ä¸ª pending</span></span><br><span class="line">  <span class="keyword">const</span> [startTransition, pending] = useTransition(&#123; <span class="attr">timeoutMs</span>: <span class="number">10000</span> &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> handleClick = <span class="function"><span class="params">()</span> =&gt;</span></span><br><span class="line">    <span class="comment">// âš›ï¸ å°†å¯èƒ½è§¦å‘ Suspense æŒ‚èµ·çš„çŠ¶æ€å˜æ›´åŒ…è£¹åœ¨ startTransition ä¸­</span></span><br><span class="line">    startTransition(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      setShowPage2(<span class="literal">true</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div className=<span class="string">"App"</span>&gt;</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;button onClick=&#123;handleClick&#125;&gt;åˆ‡æ¢&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">        &#123;/</span>* âš›ï¸ pending è¡¨ç¤ºå¤„äºå¾…å®šçŠ¶æ€, ä½ å¯ä»¥è¿›è¡Œä¸€äº›è½»å¾®çš„æç¤º *<span class="regexp">/&#125;</span></span><br><span class="line"><span class="regexp">        &#123;pending &amp;&amp; &lt;span&gt;åˆ‡æ¢ä¸­...&lt;/</span>span&gt;&#125;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;div className="page"&gt;</span></span><br><span class="line"><span class="regexp">        &lt;Suspense fallback=&#123;&lt;div&gt;Loading ...&lt;/</span>div&gt;&#125;&gt;</span><br><span class="line">          &#123;!showPage2 ? <span class="xml"><span class="tag">&lt;<span class="name">Page1</span> /&gt;</span> : <span class="tag">&lt;<span class="name">Page2</span> /&gt;</span>&#125;</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">Suspense</span>&gt;</span></span></span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br></p>
<p>useTransition Hook çš„APIæ¯”è¾ƒç®€æ´ï¼Œæœ‰4ä¸ªéœ€è¦å…³é”®çš„ç‚¹:</p>
<ul>
<li><p><code>timeoutMs</code>, è¡¨ç¤ºåˆ‡æ¢çš„è¶…æ—¶æ—¶é—´(æœ€é•¿åœ¨å¹³è¡Œå®‡å®™å­˜åœ¨çš„æ—¶é—´)ï¼ŒuseTransition ä¼šè®© React ä¿æŒåœ¨å½“å‰é¡µé¢ï¼Œç›´åˆ°è¢«è§¦å‘ Suspense å°±ç»ªæˆ–è€…è¶…æ—¶ã€‚</p>
</li>
<li><p><code>startTransition</code>, å°†å¯èƒ½è§¦å‘é¡µé¢åˆ‡æ¢(ä¸¥æ ¼è¯´æ˜¯è§¦å‘ Suspense æŒ‚èµ·)çš„çŠ¶æ€å˜æ›´åŒ…è£¹åœ¨ <code>startTransition</code> ä¸‹ï¼Œå®é™…ä¸Š startTransition æä¾›äº†ä¸€ä¸ªâ€™æ›´æ–°çš„ä¸Šä¸‹æ–‡â€™ã€‚ ä¸‹ä¸€èŠ‚æˆ‘ä»¬ä¼šæ·±å…¥æ¢ç´¢è¿™é‡Œé¢çš„ç»†èŠ‚</p>
</li>
<li><p><code>pending</code>, è¡¨ç¤ºæ­£å¤„äºå¾…å®šçŠ¶æ€ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ªçŠ¶æ€å€¼ï¼Œé€‚å½“åœ°ç»™ç”¨æˆ·ä¸€ä¸‹æç¤ºã€‚</p>
</li>
<li><p><code>Suspense</code>, useTransition å®ç°è¿‡æ¸¡çŠ¶æ€å¿…é¡»å’Œ Suspense é…åˆï¼Œä¹Ÿå°±æ˜¯ <code>startTransition</code> ä¸­çš„æ›´æ–°å¿…é¡»è§¦å‘ä»»æ„ä¸€ä¸ª Suspense æŒ‚èµ·ã€‚</p>
</li>
</ul>
<p><br></p>
<p>çœ‹ä¸€ä¸‹å®é™…çš„è¿è¡Œæ•ˆæœå§ï¼</p>
<p><img src="/images/concurrent-mode/demo2.gif" alt></p>
<p><br></p>
<blockquote>
<p>å¯ä»¥åœ¨è¿™ä¸ª <a href="https://codesandbox.io/s/usetransition-y74ry?fontsize=14" target="_blank" rel="noopener">CodeSandbox</a> æŸ¥çœ‹è¿è¡Œæ•ˆæœ</p>
</blockquote>
<p>è¿™ä¸ªæ•ˆæœå®Œå…¨è·Ÿæœ¬èŠ‚å¼€å§‹çš„â€™ç¬¬ä¸€å¼ å›¾â€™ä¸€æ ·: React ä¼šä¿ç•™åœ¨å½“å‰é¡µé¢ï¼Œ<code>pending</code> å˜ä¸ºäº†trueï¼Œæ¥ç€ B å…ˆå°±ç»ªï¼Œç•Œé¢é©¬ä¸Šåˆ‡æ¢è¿‡å»ã€‚æ•´ä¸ªè¿‡ç¨‹ç¬¦åˆ <strong><code>Pending</code> -&gt; <code>Skeleton</code> -&gt; <code>Complete</code></strong> çš„è·¯å¾„ã€‚</p>
<p><code>startTransition</code> ä¸­çš„<code>å˜æ›´</code>ä¸€æ—¦è§¦å‘ <code>Suspense</code>ï¼ŒReact å°±ä¼šå°†<code>å˜æ›´</code>æ ‡è®°çš„ Pending çŠ¶æ€, Reactä¼šå»¶å â€™æäº¤â€˜ è¿™äº›å˜æ›´ã€‚æ‰€ä»¥<strong>å®é™…ä¸Šå¹¶æ²¡æœ‰å¼€å¤´è¯´çš„å¹³è¡Œå®‡å®™, é‚£ä¹ˆé«˜å¤§ä¸Šå’Œç¥å¥‡ï¼ŒReact åªä¸è¿‡æ˜¯å»¶åäº†è¿™äº›å˜æ›´çš„æäº¤ã€‚æˆ‘ä»¬ç•Œé¢ä¸Šçœ‹åˆ°çš„åªä¸è¿‡æ˜¯æ—§çš„æˆ–è€…æœªè¢« Pending çš„çŠ¶æ€ï¼ŒReact åœ¨åå°è¿›è¡Œäº†é¢„æ¸²æŸ“</strong>ã€‚</p>
<p>æ³¨æ„ï¼ŒReact åªæ˜¯æš‚æ—¶æ²¡æœ‰æäº¤è¿™äº›å˜æ›´ï¼Œä¸è¯´æ˜ React â€™å¡æ­»äº†â€˜ï¼Œå¤„äºPending çŠ¶æ€çš„ç»„ä»¶è¿˜ä¼šæ¥æ”¶ç”¨æˆ·çš„å“åº”ï¼Œè¿›è¡Œæ–°çš„çŠ¶æ€å˜æ›´ï¼Œæ–°çš„çŠ¶æ€æ›´æ–°ä¹Ÿå¯ä»¥è¦†ç›–æˆ–ç»ˆæ­¢ Pending çŠ¶æ€ã€‚</p>
<p><br></p>
<p>æ€»ç»“ä¸€ä¸‹è¿›å…¥å’Œé€€å‡º Pending çŠ¶æ€çš„æ¡ä»¶:</p>
<ul>
<li><strong>è¿›å…¥Pending</strong> çŠ¶æ€é¦–å…ˆéœ€è¦å°† <code>çŠ¶æ€å˜æ›´</code> åŒ…è£¹åœ¨ <code>startTransition</code> ä¸‹ï¼Œä¸”è¿™äº›æ›´æ–°ä¼šè§¦å‘ Suspense æŒ‚èµ·</li>
<li><strong>é€€å‡º Pending</strong> çŠ¶æ€æœ‰ä¸‰ç§æ–¹å¼: â‘  Suspense å°±ç»ªï¼›â‘¡ è¶…æ—¶ï¼›â‘¢ è¢«æ–°çš„çŠ¶æ€æ›´æ–°è¦†ç›–æˆ–è€…ç»ˆæ­¢</li>
</ul>
<p><br><br><br></p>
<h2 id="usetransition-åŸç†åˆæ¢"><a href="#usetransition-åŸç†åˆæ¢" class="headerlink" title="useTransition åŸç†åˆæ¢"></a>useTransition åŸç†åˆæ¢</h2><p>è¿™ä¸€èŠ‚ï¼Œæˆ‘ä»¬æ·±å…¥æ¢ç´¢ä¸€ä¸‹ useTransitionï¼Œä½†æ˜¯æ–¹å¼ä¸æ˜¯å»æŠ˜è…¾æºç ï¼Œè€Œæ˜¯æŠŠå®ƒå½“æˆä¸€ä¸ªé»‘ç›’ï¼Œé€šè¿‡å‡ ä¸ªå®éªŒæ¥åŠ æ·±ä½ å¯¹ useTransition çš„ç†è§£ã€‚</p>
<p>useTransition çš„å‰èº«æ˜¯ <code>withSuspenseConfig</code>, <a href="https://github.com/sebmarkbage" target="_blank" rel="noopener">Sebmarkbage</a> åœ¨ä»Šå¹´äº”æœˆä»½æçš„ä¸€ä¸ª<a href="https://github.com/facebook/react/pull/15593" target="_blank" rel="noopener">PR</a> ä¸­å¼•è¿›äº†å®ƒã€‚</p>
<p>ä»å‘½åä¸Šçœ‹ï¼Œå®ƒä¸è¿‡æ˜¯æƒ³é…ç½®ä¸€ä¸‹ Suspenseã€‚ æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡æœ€æ–°çš„æºç éªŒè¯è¿™ä¸€ç‚¹ã€‚ useTransition çš„å·¥ä½œâ€™çœ‹ä¼¼â€™éå¸¸ç®€å•:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">updateTransition</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  config: SuspenseConfig | void | null,</span></span></span><br><span class="line">): [(() =&gt; void) =&gt; void, boolean] &#123;</span><br><span class="line">  <span class="keyword">const</span> [isPending, setPending] = updateState(<span class="literal">false</span>); <span class="comment">// ç›¸å½“äºuseState</span></span><br><span class="line">  <span class="keyword">const</span> startTransition = updateCallback(             <span class="comment">// ç›¸å½“äºuseCallback</span></span><br><span class="line">    callback =&gt; &#123;</span><br><span class="line">      setPending(<span class="literal">true</span>); <span class="comment">// è®¾ç½® pending ä¸º true</span></span><br><span class="line">      <span class="comment">// ä»¥ä½ä¼˜å…ˆçº§è°ƒåº¦æ‰§è¡Œ</span></span><br><span class="line">      Scheduler.unstable_next(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// âš›ï¸ è®¾ç½®suspenseConfig</span></span><br><span class="line">        <span class="keyword">const</span> previousConfig = ReactCurrentBatchConfig.suspense;</span><br><span class="line">        ReactCurrentBatchConfig.suspense = config === <span class="literal">undefined</span> ? <span class="literal">null</span> : config;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="comment">// è¿˜åŸ pending</span></span><br><span class="line">          setPending(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">          <span class="comment">// æ‰§è¡Œä½ çš„å›è°ƒ</span></span><br><span class="line">          callback();</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">          <span class="comment">// âš›ï¸ è¿˜åŸsuspenseConfig</span></span><br><span class="line">          ReactCurrentBatchConfig.suspense = previousConfig;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br><span class="line">    [config, isPending],</span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">return</span> [startTransition, isPending];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br></p>
<p>çœ‹ä¼¼å¾ˆæ™®é€šï¼Œè¦ç‚¹åœ¨å“ªï¼ŸSebmarkbage åœ¨ä¸Šè¿°çš„ PR ä¸­ä¹ŸæåŠäº†ä¸€äº›ä¿¡æ¯ã€‚</p>
<ul>
<li><p>startTransition ä¸€å¼€å§‹æ‰§è¡Œå°±å°† pending è®¾ç½®ä¸ºtrueã€‚æ¥ç€ä½¿ç”¨ <code>unstable_next</code> æ‰§è¡Œå›è°ƒ, <strong>unstable_next å¯ä»¥é™ä½æ›´æ–°çš„ä¼˜å…ˆçº§</strong>ã€‚ä¹Ÿå°±æ˜¯è¯´ unstable_next å›è°ƒä¸­è§¦å‘çš„â€™å˜æ›´â€˜ä¼˜å…ˆçº§ä¼šæ¯”è¾ƒä½ï¼Œå®ƒä¼šè®©ä½ä¸ºé«˜ä¼˜å…ˆçº§çš„æ›´æ–°ï¼Œæˆ–è€…å½“å‰äº‹åŠ¡ç¹å¿™æ—¶ï¼Œè°ƒåº¦åˆ°ä¸‹ä¸€ç©ºé—²æœŸå†åº”ç”¨ï¼Œä½†ä¹Ÿå¯èƒ½é©¬ä¸Šå°±è¢«åº”ç”¨ã€‚</p>
</li>
<li><p>è¦ç‚¹æ˜¯ <code>ReactCurrentBatchConfig.suspense</code> çš„é…ç½®, è¿™é‡Œé¢ä¼šé…ç½® Suspense çš„è¶…æ—¶æ—¶é—´ã€‚<strong>å®ƒè¡¨æ˜è¿™ä¸ªåŒºé—´è§¦å‘çš„å˜æ›´éƒ½è¢«å…³è”è¯¥ <code>suspenseConfig</code></strong>, è¿™äº›å˜æ›´ä¼šæ ¹æ® suspenseConfig æ¥è®¡ç®—è‡ªå·±çš„ <code>expiredTime</code>(å¯ä»¥è§†ä½œâ€˜ä¼˜å…ˆçº§â€™)ã€‚æˆ‘ä»¬æš‚ä¸”å°†è¿™äº›å…³è”äº† suspenseConfig çš„å˜æ›´ç§°ä¸º <code>Pending å˜æ›´</code>.</p>
</li>
<li><p><code>Pending å˜æ›´</code> è§¦å‘çš„é‡æ–°æ¸²æŸ“(Render)ä¹Ÿä¼šå…³è”è¯¥ <code>suspenseConfig</code>ã€‚å¦‚æœåœ¨æ¸²æŸ“æœŸé—´è§¦å‘äº† Suspenseï¼Œé‚£ä¹ˆ<code>Pending å˜æ›´</code> å°±ä¼šè¢«å»¶è¿Ÿæäº¤(commit)ï¼Œå®ƒä»¬ä¼šç¼“å­˜åœ¨å†…å­˜ä¸­, ç­‰åˆ° Suspense è¶…æ—¶æˆ–è€…å°±ç»ª, æŠ‘æˆ–è¢«å…¶ä»–æ›´æ–°è¦†ç›–, æ‰å¼ºåˆ¶æäº¤åˆ°ç”¨æˆ·ç•Œé¢ã€‚</p>
</li>
<li><p><code>Pending å˜æ›´</code> åªæ˜¯è¢«å»¶è¿Ÿæäº¤äº†ï¼Œä½†æ˜¯ä¸ä¼šå½±å“æœ€ç»ˆæ•°æ®å’Œè§†å›¾çš„ä¸€è‡´æ€§ã€‚React ä¼šåœ¨å†…å­˜ä¸­é‡æ–°æ¸²æŸ“ï¼Œåªæ˜¯ä¸æäº¤åˆ°ç”¨æˆ·ç•Œé¢è€Œå·²ã€‚</p>
</li>
</ul>
<p><br></p>
<p>React å†…éƒ¨çš„å®ç°å¤ªè¿‡å¤æ‚ï¼Œæˆ‘å‘ç°å»æŒ–å®ƒæˆ–è€…ç”¨æ–‡å­—è¡¨è¾¾å‡ºæ¥æˆæœ¬éƒ½å¾ˆé«˜ã€‚å› æ­¤æ¢ä¸€ç§æ–¹å¼ï¼Œé€šè¿‡å®éªŒ(é»‘ç›’)æ–¹å¼æ¥äº†è§£å®ƒçš„è¡Œä¸ºï¼š</p>
<blockquote>
<p>è¿™äº›å®éªŒä»£ç åœ¨è¿™ä¸ª <a href="https://codesandbox.io/s/react-use-transition-tests-kg8rc?fontsize=14" target="_blank" rel="noopener">CodeSandbox</a> ä¸­</p>
</blockquote>
<p><br></p>
<h3 id="1ï¸âƒ£-åˆ©ç”¨-starttransition-æ¥è¿è¡Œä½ä¼˜å…ˆçº§ä»»åŠ¡"><a href="#1ï¸âƒ£-åˆ©ç”¨-starttransition-æ¥è¿è¡Œä½ä¼˜å…ˆçº§ä»»åŠ¡" class="headerlink" title="1ï¸âƒ£ åˆ©ç”¨ startTransition æ¥è¿è¡Œä½ä¼˜å…ˆçº§ä»»åŠ¡"></a><strong>1ï¸âƒ£ åˆ©ç”¨ startTransition æ¥è¿è¡Œä½ä¼˜å…ˆçº§ä»»åŠ¡</strong></h3><p>è¿™ä¸ªå®éªŒä¸»è¦ç”¨äºéªŒè¯ <code>unstable_next</code>, å®ƒä¼šè®©é™ä½æ›´æ–°çš„ä¼˜å…ˆçº§ã€‚é€šè¿‡ä¸‹é¢çš„å®éªŒæˆ‘ä»¬ä¼šè§‚å¯Ÿåˆ°: é€šè¿‡<code>startTransition</code> åŒ…è£¹çš„å˜æ›´åœ¨ä»»åŠ¡ç¹å¿™çš„æƒ…å†µä¼šç¨å¾®å»¶åæ›´æ–°ï¼Œä½†æ˜¯æœ€ç»ˆçŠ¶æ€æ˜¯ä¸€è‡´çš„ã€‚</p>
<p>å®éªŒä»£ç :</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = useState(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> [tick, setTick] = useState(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> [startTransition, pending] = useTransition(&#123; <span class="attr">timeoutMs</span>: <span class="number">10000</span> &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> handleClick = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// âš›ï¸ åŒæ­¥æ›´æ–°</span></span><br><span class="line">    setCount(count + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    startTransition(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// âš›ï¸ ä½ä¼˜å…ˆçº§æ›´æ–° tick</span></span><br><span class="line">      setTick(<span class="function"><span class="params">t</span> =&gt;</span> t + <span class="number">1</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div className=<span class="string">"App"</span>&gt;</span><br><span class="line">      &lt;h1&gt;Hello useTransition&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">      &lt;div&gt;</span></span><br><span class="line"><span class="regexp">        &lt;button onClick=&#123;handleClick&#125;&gt;ADD + 1&lt;/</span>button&gt;</span><br><span class="line">        &#123;pending &amp;&amp; <span class="xml"><span class="tag">&lt;<span class="name">span</span>&gt;</span>pending<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span>&#125;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;div&gt;Count: &#123;count&#125;&lt;/</span>div&gt;</span><br><span class="line">      &#123;<span class="comment">/* âš›ï¸ è¿™æ˜¯ä¸€ä¸ªå¤æ‚çš„ç»„ä»¶ï¼Œæ¸²æŸ“éœ€è¦ä¸€ç‚¹æ—¶é—´ï¼Œæ¨¡æ‹Ÿç¹å¿™çš„æƒ…å†µ */</span>&#125;</span><br><span class="line">      &lt;ComplexComponent value=&#123;tick&#125; /&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p>å®éªŒç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="/images/concurrent-mode/test1.gif" alt></p>
<p><br></p>
<p>åœ¨è¿ç»­ç‚¹å‡»çš„æƒ…å†µä¸‹ï¼Œ<code>ComplexComponent</code> çš„æ›´æ–°ä¼šæ˜æ˜¾æ»åï¼Œè¿™æ˜¯å› ä¸º tick å˜æ›´ä¼šè¢«å»¶åå’Œåˆå¹¶ï¼Œä½†æ˜¯æœ€åå®ƒä»¬çš„ç»“æœæ˜¯ä¸€è‡´çš„.</p>
<p><br><br><br></p>
<h3 id="2ï¸âƒ£-starttransition-æ›´æ–°è§¦å‘-suspense"><a href="#2ï¸âƒ£-starttransition-æ›´æ–°è§¦å‘-suspense" class="headerlink" title="2ï¸âƒ£ startTransition æ›´æ–°è§¦å‘ Suspense"></a><strong>2ï¸âƒ£ startTransition æ›´æ–°è§¦å‘ Suspense</strong></h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = useState(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> [tick, setTick] = useState(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> [startTransition, pending] = useTransition(&#123; <span class="attr">timeoutMs</span>: <span class="number">10000</span> &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> handleClick = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    startTransition(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      setCount(<span class="function"><span class="params">c</span> =&gt;</span> c + <span class="number">1</span>);</span><br><span class="line">      setTick(<span class="function"><span class="params">c</span> =&gt;</span> c + <span class="number">1</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div className=<span class="string">"App"</span>&gt;</span><br><span class="line">      &lt;h1&gt;Hello useTransition &#123;tick&#125;&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">      &lt;div&gt;</span></span><br><span class="line"><span class="regexp">        &lt;button onClick=&#123;handleClick&#125;&gt;ADD + 1&lt;/</span>button&gt;</span><br><span class="line">        &#123;pending &amp;&amp; <span class="xml"><span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">"pending"</span>&gt;</span>pending<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span>&#125;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;Tick /</span>&gt;</span><br><span class="line">      &lt;SuspenseBoundary id=&#123;count&#125; /&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">const SuspenseBoundary = (&#123; id &#125;) =&gt; &#123;</span></span><br><span class="line"><span class="regexp">  return (</span></span><br><span class="line"><span class="regexp">    &lt;Suspense fallback="Loading..."&gt;</span></span><br><span class="line"><span class="regexp">      &#123;/</span>* è¿™é‡Œä¼šæŠ›å‡ºä¸€ä¸ª<span class="built_in">Promise</span>å¼‚å¸¸ï¼Œ<span class="number">3</span>s å resolved *<span class="regexp">/&#125;</span></span><br><span class="line"><span class="regexp">      &lt;ComponentThatThrowPromise id=&#123;id&#125; /</span>&gt;</span><br><span class="line">    &lt;<span class="regexp">/Suspense&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/ Tick ç»„ä»¶æ¯ç§’é€’å¢ä¸€æ¬¡</span></span><br><span class="line"><span class="regexp">const Tick = (&#123; duration = 1000 &#125;) =&gt; &#123;</span></span><br><span class="line"><span class="regexp">  const [tick, setTick] = useState(0);</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  useEffect(() =&gt; &#123;</span></span><br><span class="line"><span class="regexp">    const t = setInterval(() =&gt; &#123;</span></span><br><span class="line"><span class="regexp">      setTick(tick =&gt; tick + 1);</span></span><br><span class="line"><span class="regexp">    &#125;, duration);</span></span><br><span class="line"><span class="regexp">    return () =&gt; clearInterval(t);</span></span><br><span class="line"><span class="regexp">  &#125;, [duration]);</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">  return &lt;div className="tick"&gt;tick: &#123;tick&#125;&lt;/</span>div&gt;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><img src="/images/concurrent-mode/test2.gif" alt></p>
<p>å½“æˆ‘ä»¬ç‚¹å‡»æŒ‰é’®æ—¶ä¼šé€’å¢ count å’Œ tick, count ä¼šä¼ é€’ç»™ SuspenseBoundaryï¼Œä»è€Œè§¦å‘ Suspenseã€‚</p>
<p>é€šè¿‡ä¸Šé¢çš„ç»“æœå¯ä»¥çŸ¥é“ï¼Œåœ¨ startTransition ä¸­è¿›è¡Œäº†å˜æ›´(æºå¸¦suspenseConfig), å¯¹åº”çš„é‡æ–°æ¸²æŸ“è§¦å‘äº† Suspenseï¼Œæ‰€ä»¥è¿›å…¥äº†PendingçŠ¶æ€ï¼Œå®ƒä»¬æ¸²æŸ“ç»“æœä¸ä¼šè¢«ç«‹å³â€˜æäº¤â€™ï¼Œé¡µé¢è¿˜æ˜¯ä¿æŒåœ¨åŸæ¥çš„çŠ¶æ€ã€‚</p>
<p>å¦å¤–ä½ ä¼šå‘ç° App ç»„ä»¶çš„ tick è·Ÿ SuspenseBoundary ä¸€æ ·ä¹Ÿä¼šè¢«â€˜åœæ­¢â€™(çœ‹Hello Transition åé¢çš„tick)ï¼Œå› ä¸º tick å˜æ›´ä¹Ÿå…³è”äº†suspenseConfigã€‚</p>
<p>è€Œ Tick ç»„ä»¶åˆ™æ¯ä¸€ç§’é€’å¢ä¸€æ¬¡ï¼Œä¸ä¼šè¢«é˜»å¡ã€‚</p>
<p>è¿™å°±è¯´æ˜äº†ä¸€æ—¦è§¦å‘äº†Suspenseï¼Œåªè¦å…³è”äº† suspenseConfig çš„å˜æ›´å°±ä¼šè¢«â€˜æš‚åœâ€™æäº¤ã€‚</p>
<p><br><br><br></p>
<h3 id="3ï¸âƒ£-å°†-tick-æ›´æ–°æåˆ°-starttransition-ä½œç”¨åŸŸå¤–"><a href="#3ï¸âƒ£-å°†-tick-æ›´æ–°æåˆ°-starttransition-ä½œç”¨åŸŸå¤–" class="headerlink" title="3ï¸âƒ£ å°† tick æ›´æ–°æåˆ° startTransition ä½œç”¨åŸŸå¤–"></a><strong>3ï¸âƒ£ å°† tick æ›´æ–°æåˆ° startTransition ä½œç”¨åŸŸå¤–</strong></h3><p>åœ¨ 2ï¸âƒ£ çš„åŸºç¡€ä¸Šï¼Œå°† setTick æåˆ° startTransition ä½œç”¨åŸŸå¤–:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = useState(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> [tick, setTick] = useState(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">const</span> [startTransition, pending] = useTransition(&#123; <span class="attr">timeoutMs</span>: <span class="number">10000</span> &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"App rendering with"</span>, count, tick, pending);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> handleClick = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    setTick(<span class="function"><span class="params">c</span> =&gt;</span> c + <span class="number">1</span>);</span><br><span class="line">    startTransition(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      setCount(<span class="function"><span class="params">c</span> =&gt;</span> c + <span class="number">1</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> handleAddTick = <span class="function"><span class="params">()</span> =&gt;</span> setTick(<span class="function"><span class="params">c</span> =&gt;</span> c + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"App committed with"</span>, count, tick, pending);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div className=<span class="string">"App"</span>&gt;</span><br><span class="line">      &lt;h1&gt;Hello useTransition &#123;tick&#125;&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">      &lt;div&gt;</span></span><br><span class="line"><span class="regexp">        &lt;button onClick=&#123;handleClick&#125;&gt;ADD + 1&lt;/</span>button&gt;</span><br><span class="line">        &lt;button onClick=&#123;handleAddTick&#125;&gt;Tick + <span class="number">1</span>&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">        &#123;pending &amp;&amp; &lt;span className="pending"&gt;pending&lt;/</span>span&gt;&#125;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;Tick /</span>&gt;</span><br><span class="line">      &lt;SuspenseBoundary id=&#123;count&#125; /&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>
<p><img src="/images/concurrent-mode/test3.gif" alt></p>
<p><br></p>
<p>ç°åœ¨ tick ä¼šè¢«ç«‹å³æ›´æ–°ï¼Œè€Œ SuspenseBoundary è¿˜ä¼šæŒ‚åœ¨ pending çŠ¶æ€ã€‚</p>
<p>æˆ‘ä»¬æ‰“å¼€æ§åˆ¶å°çœ‹ä¸€ä¸‹ï¼Œè¾“å‡ºæƒ…å†µ:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">App rendering with 1 2 true   # pending è¢«è®¾ç½®ä¸ºtrue, count è¿™æ˜¯æ—¶å€™æ˜¯ 1ï¼Œ è€Œ tick æ˜¯ 2</span><br><span class="line">App rendering with 1 2 true</span><br><span class="line">read  1</span><br><span class="line">App committed with 1 2 true    # è¿›å…¥Pending çŠ¶æ€ä¹‹å‰çš„ä¸€æ¬¡æäº¤ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œå¼€å§‹å±•ç¤º pending æŒ‡ç¤ºç¬¦</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¸‹é¢ Tick æ›´æ–°äº†ä¸‰æ¬¡(3s)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æˆ‘ä»¬æ³¨æ„åˆ°ï¼Œæ¯ä¸€æ¬¡ React éƒ½ä¼šé‡æ–°æ¸²æŸ“ä¸€ä¸‹ App ç»„ä»¶ï¼Œå³ <span class="string">'ping'</span> ä¸€ä¸‹å¤„äº Pending çŠ¶æ€çš„ç»„ä»¶, æ£€æŸ¥ä¸€ä¸‹æ˜¯å¦â€˜å°±ç»ªâ€™(æ²¡æœ‰è§¦å‘Suspense)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¦‚æœè¿˜è§¦å‘ Suspense, è¯´æ˜è¿˜è¦ç»§ç»­ç­‰å¾…ï¼Œè¿™äº›é‡æ–°æ¸²æŸ“çš„ç»“æœä¸ä¼šè¢«æäº¤</span></span><br><span class="line"></span><br><span class="line">App rendering with 2 2 false # ping, è¿™é‡Œcountå˜æˆäº†2ï¼Œä¸” pending å˜æˆäº† false</span><br><span class="line">App rendering with 2 2 false # ä½†æ˜¯ React åœ¨å†…å­˜ä¸­æ¸²æŸ“å®ƒä»¬ï¼Œæˆ‘ä»¬çœ‹ä¸åˆ°</span><br><span class="line">read  2</span><br><span class="line"></span><br><span class="line">Tick rendering with 76        # Tick é‡æ–°æ¸²æŸ“</span><br><span class="line">Tick rendering with 76</span><br><span class="line">Tick committed with 76        # æäº¤ Tick æ›´æ–°ï¼Œåˆ·æ–°åˆ°ç•Œé¢ä¸Š</span><br><span class="line">App rendering with 2 2 false  # ping è¿˜æ˜¯æ²¡æœ‰å°±ç»ªï¼Œç»§ç»­ pending</span><br><span class="line">App rendering with 2 2 false</span><br><span class="line">read  2</span><br><span class="line"></span><br><span class="line">Tick rendering with 77</span><br><span class="line">Tick rendering with 77</span><br><span class="line">Tick committed with 77</span><br><span class="line">App rendering with 2 2 false # ping</span><br><span class="line">App rendering with 2 2 false</span><br><span class="line">read  2</span><br><span class="line"></span><br><span class="line">Tick rendering with 78</span><br><span class="line">Tick rendering with 78</span><br><span class="line">Tick committed with 78</span><br><span class="line">App rendering with 2 2 false # ping</span><br><span class="line">App rendering with 2 2 false</span><br><span class="line">read  2</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Ok, Promise å·²ç»å°±ç»ªäº†ï¼Œè¿™æ—¶å€™å†ä¸€æ¬¡é‡æ–°æ¸²æŸ“ App</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> è¿™æ¬¡æ²¡æœ‰è§¦å‘ Suspenseï¼ŒReact ä¼šé©¬ä¸Šæäº¤ç”¨æˆ·ç•Œé¢</span></span><br><span class="line">App rendering with 2 2 false</span><br><span class="line">App rendering with 2 2 false</span><br><span class="line">read  2</span><br><span class="line">App committed with 2 2 false</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡ä¸Šé¢çš„æ—¥å¿—ï¼Œæˆ‘ä»¬å¯ä»¥æ¸…æ™°åœ°ç†è§£ Pending ç»„ä»¶çš„æ›´æ–°è¡Œä¸º</p>
<p><br><br><br></p>
<h3 id="4ï¸âƒ£-åµŒå¥—suspense"><a href="#4ï¸âƒ£-åµŒå¥—suspense" class="headerlink" title="4ï¸âƒ£ åµŒå¥—Suspense"></a><strong>4ï¸âƒ£ åµŒå¥—Suspense</strong></h3><p>åœ¨3ï¸âƒ£çš„åŸºç¡€ä¸Šï¼Œå°† SuspenseBoundary æ”¹å†™ä¸º DoubleSuspenseBoundary, è¿™é‡Œä¼šåµŒå¥—ä¸€ä¸ª Suspense åŠ è½½ä¸€ä¸ªæ›´è€—æ—¶çš„èµ„æº:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> DoubleSuspenseBoundary = <span class="function">(<span class="params">&#123; id &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Suspense fallback=&#123;&lt;div&gt;Loading...&lt;<span class="regexp">/div&gt;&#125;&gt;</span></span><br><span class="line"><span class="regexp">      &#123;/</span>* éœ€è¦åŠ è½½ <span class="number">2</span>s  *<span class="regexp">/&#125;</span></span><br><span class="line"><span class="regexp">      &lt;ComponentThatThrowPromise id=&#123;id&#125; timeout=&#123;2000&#125; /</span>&gt;</span><br><span class="line">      &lt;Suspense fallback=&#123;&lt;div&gt;Loading second...&lt;<span class="regexp">/div&gt;&#125;&gt;</span></span><br><span class="line"><span class="regexp">        &#123;/</span>* éœ€è¦åŠ è½½ <span class="number">4</span>s  *<span class="regexp">/&#125;</span></span><br><span class="line"><span class="regexp">        &lt;ComponentThatThrowPromise id=&#123;id + "second"&#125; timeout=&#123;4000&#125; /</span>&gt;</span><br><span class="line">      &lt;<span class="regexp">/Suspense&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>Suspense&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æµ‹è¯•ä¸€ä¸‹æ•ˆæœï¼š</p>
<p><img src="/images/concurrent-mode/test4-1.gif" alt></p>
<p><br></p>
<p>é¦–å…ˆæ³¨æ„è§‚å¯Ÿé¦–æ¬¡æŒ‚è½½ï¼Œ<strong>Suspense é¦–æ¬¡æŒ‚è½½æ—¶ä¸ä¼šè§¦å‘å»¶è¿Ÿæäº¤</strong>ï¼Œå› æ­¤æˆ‘ä»¬é¦–å…ˆä¼šçœ‹åˆ° <code>Loading...</code>ã€æ¥ç€ç¬¬ä¸€ä¸ª <code>ComponentThatThrowPromise</code> åŠ è½½å®Œæ¯•ï¼Œæ˜¾ç¤º<code>ComponentThatThrowPromise id: 0</code> å’Œ <code>Loading second...</code>, æœ€åå®Œå…¨åŠ è½½å®Œæ¯•ã€‚</p>
<p>æ¥ç€æˆ‘ä»¬ç‚¹å‡»æŒ‰é’®ï¼Œè¿™æ—¶å€™ DoubleSuspenseBoundary ä¼šä¿æŒä¸åŠ¨ï¼Œç­‰å¾… 5s å(ä¹Ÿå°±æ˜¯ç¬¬äºŒä¸ª<code>ComponentThatThrowPromise</code>åŠ è½½å®Œæ¯•), æ‰æäº¤ã€‚</p>
<p><br></p>
<p>ç†æƒ³çš„æ•ˆæœæ˜¯è·Ÿé¦–æ¬¡æŒ‚è½½çš„æ—¶å€™ä¸€æ ·ï¼šåœ¨ç¬¬ä¸€ä¸ª ComponentThatThrowPromise å°±ç»ªæ—¶å°±åˆ‡æ¢è¿‡æ¥ï¼Œä¸ç”¨ç­‰å¾…ç¬¬äºŒä¸ªåŠ è½½å®Œæ¯•ã€‚</p>
<p>æ„Ÿè§‰æœ‰ç‚¹ä¸å¯¹ï¼Ÿæˆ‘è¿™è¿™é‡Œæƒ³äº†å¾ˆä¹…, å®˜æ–¹æ–‡æ¡£ä¸Š <a href="https://reactjs.org/docs/concurrent-mode-patterns.html#wrap-lazy-features-in-suspense" target="_blank" rel="noopener">Concurrent UI Patterns (Experimental) - Wrap Lazy Features in \&lt;Suspense></a> è¯´äº†ï¼Œç¬¬äºŒä¸ª<code>ComponentThatThrowPromise</code> å·²ç»åµŒå¥—åœ¨ <code>Suspense</code> ä¸­äº†ï¼Œç†è®ºä¸Šåº”è¯¥ä¸ä¼šé˜»å¡æäº¤ã€‚</p>
<p>å›åˆ°å¼€å¤´çš„ç¬¬ä¸€å¥è¯ï¼šâ€™<strong>Suspense é¦–æ¬¡æŒ‚è½½æ—¶ä¸ä¼šè§¦å‘å»¶è¿Ÿæäº¤</strong>â€˜ã€‚æˆ‘ä»¬å†è¯•ä¸€ä¸‹, ç»™ DoubleSuspenseBoundary è®¾ç½®ä¸€ä¸ªkeyï¼Œå¼ºåˆ¶è®©å®ƒé”€æ¯é‡æ–°åˆ›å»º:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// .....</span></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div className=<span class="string">"App"</span>&gt;</span><br><span class="line">      &lt;h1&gt;Hello useTransition &#123;tick&#125;&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">      &lt;div&gt;</span></span><br><span class="line"><span class="regexp">        &lt;button onClick=&#123;handleClick&#125;&gt;ADD + 1&lt;/</span>button&gt;</span><br><span class="line">        &#123;pending &amp;&amp; <span class="xml"><span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">"pending"</span>&gt;</span>pending<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span>&#125;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;Tick /</span>&gt;</span><br><span class="line">      &#123;<span class="comment">/* âš›ï¸ è¿™é‡Œæ·»åŠ keyï¼Œå¼ºåˆ¶é‡æ–°é”€æ¯åˆ›å»º */</span>&#125;</span><br><span class="line">      &lt;DoubleSuspenseBoundary id=&#123;count&#125; key=&#123;count&#125; /&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p>è¯•ä¸€ä¸‹æ•ˆæœ:</p>
<p><img src="/images/concurrent-mode/test4-2.gif" alt></p>
<p><br></p>
<p>æˆ‘ä»¬å‘ç°ï¼Œæ¯æ¬¡ç‚¹å‡»éƒ½æ˜¯<code>Loading...</code>, Pending çŠ¶æ€æ²¡æœ‰äº†! å› ä¸ºæ¯æ¬¡ <code>count</code> é€’å¢, <code>DoubleSuspenseBoundary</code> å°±ä¼šé‡æ–°åˆ›å»ºï¼Œä¸ä¼šè§¦å‘å»¶è¿Ÿæäº¤ã€‚</p>
<p>åŸºäºè¿™ä¸ªåŸç†ï¼Œæˆ‘ä»¬å¯ä»¥å†æ”¹é€ ä¸€ä¸‹ <code>DoubleSuspenseBoundary</code>, è¿™ä¸€æ¬¡ï¼Œæˆ‘ä»¬åªç»™åµŒå¥—çš„ <code>Suspense</code> åŠ ä¸Škeyï¼Œè®©å®ƒä»¬é‡æ–°åˆ›å»ºä¸é˜»å¡ Pending çŠ¶æ€.</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> DoubleSuspenseBoundary = <span class="function">(<span class="params">&#123; id &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Suspense fallback=&#123;&lt;div&gt;Loading...&lt;<span class="regexp">/div&gt;&#125;&gt;</span></span><br><span class="line"><span class="regexp">      &lt;ComponentThatThrowPromise id=&#123;id&#125; timeout=&#123;2000&#125; /</span>&gt;</span><br><span class="line">      &#123;<span class="comment">/* âš›ï¸ æˆ‘ä»¬ä¸å¸Œæœ›è¿™ä¸ª Suspense é˜»å¡ pending çŠ¶æ€, ç»™å®ƒåŠ ä¸ªkey, è®©å®ƒå¼ºåˆ¶é‡æ–°åˆ›å»º */</span>&#125;</span><br><span class="line">      &lt;Suspense key=&#123;id&#125; fallback=&#123;&lt;div&gt;Loading second...&lt;<span class="regexp">/div&gt;&#125;&gt;</span></span><br><span class="line"><span class="regexp">        &lt;ComponentThatThrowPromise id=&#123;id + "second"&#125; timeout=&#123;4000&#125; /</span>&gt;</span><br><span class="line">      &lt;<span class="regexp">/Suspense&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>Suspense&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><br></p>
<p>æœ€åçš„æ•ˆæœ</p>
<p><img src="/images/concurrent-mode/test4-3.gif" alt></p>
<p>Itâ€™s work! ğŸ»</p>
<p><br><br><br></p>
<h3 id="5ï¸âƒ£-å¯ä»¥å’Œ-mobx-å’Œ-redux-é…åˆä½¿ç”¨å—"><a href="#5ï¸âƒ£-å¯ä»¥å’Œ-mobx-å’Œ-redux-é…åˆä½¿ç”¨å—" class="headerlink" title="5ï¸âƒ£ å¯ä»¥å’Œ Mobx å’Œ Redux é…åˆä½¿ç”¨å—?"></a><strong>5ï¸âƒ£ å¯ä»¥å’Œ Mobx å’Œ Redux é…åˆä½¿ç”¨å—?</strong></h3><p>æˆ‘ä¹Ÿä¸çŸ¥é“ï¼Œæµ‹è¯•ä¸€ä¸‹:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">mport React, &#123; useTransition, useEffect &#125; <span class="keyword">from</span> <span class="string">"react"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; createStore &#125; <span class="keyword">from</span> <span class="string">"redux"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Provider, useSelector, useDispatch &#125; <span class="keyword">from</span> <span class="string">"react-redux"</span>;</span><br><span class="line"><span class="keyword">import</span> SuspenseBoundary <span class="keyword">from</span> <span class="string">"./SuspenseBoundary"</span>;</span><br><span class="line"><span class="keyword">import</span> Tick <span class="keyword">from</span> <span class="string">"./Tick"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> initialState = &#123; <span class="attr">count</span>: <span class="number">0</span>, <span class="attr">tick</span>: <span class="number">0</span> &#125;;</span><br><span class="line"><span class="keyword">const</span> ADD_TICK = <span class="string">"ADD_TICK"</span>;</span><br><span class="line"><span class="keyword">const</span> ADD_COUNT = <span class="string">"ADD_COUNT"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> store = createStore(<span class="function">(<span class="params">state = initialState, action</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> copy = &#123; ...state &#125;;</span><br><span class="line">  <span class="keyword">if</span> (action.type === ADD_TICK) &#123;</span><br><span class="line">    copy.tick++;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    copy.count++;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> copy</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> Page = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; count, tick &#125; = useSelector(<span class="function">(<span class="params">&#123; tick, count &#125;</span>) =&gt;</span> (&#123; tick, count &#125;));</span><br><span class="line">  <span class="keyword">const</span> dispatch = useDispatch();</span><br><span class="line">  <span class="keyword">const</span> [startTransition, pending] = useTransition(&#123; <span class="attr">timeoutMs</span>: <span class="number">10000</span> &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> addTick = <span class="function"><span class="params">()</span> =&gt;</span> dispatch(&#123; <span class="attr">type</span>: ADD_TICK &#125;);</span><br><span class="line">  <span class="keyword">const</span> addCount = <span class="function"><span class="params">()</span> =&gt;</span> dispatch(&#123; <span class="attr">type</span>: ADD_COUNT &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> handleClick = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    addTick();</span><br><span class="line">    startTransition(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"Start transition with count: "</span>, count);</span><br><span class="line">      addCount();</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"End transition"</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`App rendering with count(<span class="subst">$&#123;count&#125;</span>) pendig(<span class="subst">$&#123;pending&#125;</span>)`</span>);</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"committed with"</span>, count, tick, pending);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div className=<span class="string">"App"</span>&gt;</span><br><span class="line">      &lt;h1&gt;Hello useTransition &#123;tick&#125;&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">      &lt;div&gt;</span></span><br><span class="line"><span class="regexp">        &lt;button onClick=&#123;handleClick&#125;&gt;ADD + 1&lt;/</span>button&gt;</span><br><span class="line">        &#123;pending &amp;&amp; <span class="xml"><span class="tag">&lt;<span class="name">span</span> <span class="attr">className</span>=<span class="string">"pending"</span>&gt;</span>pending<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span>&#125;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      &lt;Tick /</span>&gt;</span><br><span class="line">      &lt;SuspenseBoundary id=&#123;count&#125; /&gt;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default () =&gt; &#123;</span></span><br><span class="line"><span class="regexp">  return (</span></span><br><span class="line"><span class="regexp">    &lt;Provider store=&#123;store&#125;&gt;</span></span><br><span class="line"><span class="regexp">      &lt;Page /</span>&gt;</span><br><span class="line">    &lt;<span class="regexp">/Provider&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;;</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p>å…ˆçœ‹ä¸€ä¸‹è¿è¡Œæ•ˆæœ:</p>
<p><img src="/images/concurrent-mode/test5.gif" alt></p>
<p><br></p>
<p><img src="/images/concurrent-mode/hyhs.png" alt></p>
<p><br></p>
<p>Whatâ€™s the problem? æ•´ä¸ªç•Œé¢éƒ½ <code>Pending</code> äº†, æ•´ä¸ªç•Œé¢ä¸å•å•æŒ‡ <code>App</code> è¿™é¢—å­æ ‘ï¼Œè€Œä¸” Tick ä¹Ÿä¸èµ°äº†ã€‚æ‰“å¼€æ§åˆ¶å°çœ‹åˆ°äº†ä¸€ä¸ªè­¦å‘Š:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Warning: Page triggered a user-blocking update that suspended.</span><br><span class="line"></span><br><span class="line">The fix is to split the update into multiple parts: a user-blocking update to provide immediate feedback, and another update that triggers the bulk of the changes.</span><br><span class="line">Refer to the documentation for useTransition to learn how to implement this pattern.</span><br></pre></td></tr></table></figure>
<p><br></p>
<p>å…ˆæ¥çœ‹ä¸€ä¸‹ç›®å‰Rudux å’Œ Mobx çš„Hooks API æ˜¯æ€ä¹ˆæ›´æ–°çš„ï¼Œ<strong>æœ¬è´¨ä¸Šå®ƒä»¬éƒ½é‡‡ç”¨è®¢é˜…æœºåˆ¶ï¼Œåœ¨äº‹ä»¶è§¦å‘åè¿›è¡Œå¼ºåˆ¶æ›´æ–°</strong>, åŸºæœ¬ç»“æ„å¦‚ä¸‹:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useSomeOutsideStore</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// è·å–å¤–éƒ¨ store</span></span><br><span class="line">  <span class="keyword">const</span> store = getOutsideStore()</span><br><span class="line">  <span class="keyword">const</span> [, forceUpdate] = useReducer(<span class="function"><span class="params">s</span> =&gt;</span> s + <span class="number">1</span>, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// âš›ï¸ è®¢é˜…å¤–éƒ¨æ•°æ®æº</span></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> disposer = store.subscribe(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// âš›ï¸ å¼ºåˆ¶æ›´æ–°</span></span><br><span class="line">      forceUpdate()</span><br><span class="line">    ))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> disposer</span><br><span class="line">  &#125;, [store])</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br></p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬åœ¨ <code>startTransition</code> ä¸­æ›´æ–° Redux çŠ¶æ€æ—¶ï¼Œä¼šåŒæ­¥æ¥æ”¶åˆ°äº‹ä»¶ï¼Œç„¶åè°ƒç”¨ <code>forceUpdate</code>ã€‚<strong><code>forceUpdate</code> æ‰æ˜¯çœŸæ­£åœ¨ suspenseConfig ä¸Šä¸‹æ–‡ä¸­å˜æ›´çš„çŠ¶æ€</strong>ã€‚</p>
<p>æˆ‘ä»¬å†çœ‹ä¸€ä¸‹æ§åˆ¶å°æ—¥å¿—:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Start transition with count 0</span><br><span class="line">End transition</span><br><span class="line">App rendering with count(1) pendig(true)  # è¿™é‡Œå‡ºé—®é¢˜äº† ğŸ”´, ä½ å¯ä»¥å’Œå®éªŒ 3ï¸âƒ£ ä¸­çš„æ—¥å¿—å¯¹æ¯”ä¸€ä¸‹</span><br><span class="line">App rendering with count(1) pendig(true)  # å®éªŒ 3ï¸âƒ£ ä¸­è¿™é‡Œçš„ count æ˜¯ 0ï¼Œè€Œè¿™é‡Œçš„countæ˜¯1ï¼Œè¯´æ˜æ²¡æœ‰ defer!</span><br><span class="line">read  1</span><br><span class="line"></span><br><span class="line">Warning: App triggered a user-blocking update that suspended.</span><br><span class="line">The fix is to split the update into multiple parts: a user-blocking update to provide immediate feedback, and another update that triggers the bulk of the changes.</span><br><span class="line">Refer to the documentation for useTransition to learn how to implement this pattern.</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡æ—¥å¿—å¯ä»¥åŸºæœ¬ä¸Šèƒ½å¤Ÿå®šä½å‡ºé—®é¢˜ï¼Œcount æ²¡æœ‰è¢«å»¶è¿Ÿæ›´æ–°ï¼Œæ‰€ä»¥å¯¼è‡´â€™åŒæ­¥â€™è§¦å‘äº† Suspenseï¼Œè¿™ä¹Ÿæ˜¯ React è­¦å‘Šçš„åŸå› ã€‚ ç”±äº useTransition ç›®å‰è¿˜å¤„äºå®éªŒé˜¶æ®µï¼Œ<strong>å¦‚æœä¸æ˜¯ startTransition ä¸Šä¸‹æ–‡ä¸­çš„çŠ¶æ€æ›´æ–°å¯¼è‡´çš„Suspenseï¼Œè¡Œä¸ºè¿˜æ˜¯æœªç¡®å®šçš„</strong>ã€‚</p>
<p>ä½†æ˜¯æœ€ç»ˆçš„è¡Œä¸ºæœ‰ç‚¹ç„å­¦ï¼Œå®ƒä¼šå¯¼è‡´æ•´ä¸ªåº”ç”¨è¢«â€˜Pendingâ€™ï¼Œæ‰€æœ‰çŠ¶æ€æ›´æ–°éƒ½ä¸ä¼šè¢«æäº¤ã€‚è¿™å—æˆ‘ä¹Ÿå¾ˆç–‘æƒ‘ï¼Œæ²¡æœ‰ç²¾åŠ›æ·±ç©¶ä¸‹å»ï¼Œåªèƒ½ç­‰å¾…åç»­å®˜æ–¹çš„æ›´æ–°ï¼Œè¯»è€…ä¹Ÿå¯ä»¥å»ç¢ç£¨ç¢ç£¨ã€‚</p>
<p>å› æ­¤ï¼Œæš‚æ—¶ä¸æ¨èå°†ä¼šè§¦å‘ Suspense çš„çŠ¶æ€æ”¾ç½®åœ¨ Redux æˆ–è€… Mobx ä¸­ã€‚</p>
<p><br><br><br></p>
<p>æœ€åå†é‡ç”³ä¸€ä¸‹ï¼Œ <code>useTransition</code> è¦è¿›å…¥ <code>Pending</code> çŠ¶æ€è¦ç¬¦åˆä»¥ä¸‹å‡ ä¸ªæ¡ä»¶:</p>
<ul>
<li>æœ€å¥½ä½¿ç”¨ React æœ¬èº«çš„çŠ¶æ€æœºåˆ¶è¿›è¡Œæ›´æ–°, å¦‚ Hooks æˆ– setState, å½“å‰ä¸è¦ä½¿ç”¨ Mobx å’Œ Redux</li>
<li>è¿™äº›æ›´æ–°ä¼šè§¦å‘ Suspenseã€‚</li>
<li>æ›´æ–°å¿…é¡»åœ¨<code>startTransition</code>ä½œç”¨åŸŸä¸‹, è¿™äº›æ›´æ–°ä¼šå…³è” <code>suspenseConfig</code></li>
<li>è¿™äº›æ›´æ–°è§¦å‘çš„é‡æ–°æ¸²æŸ“ä¸­, å¿…é¡»è§¦å‘è‡³å°‘ä¸€ä¸ª <code>Suspense</code></li>
<li>è¿™ä¸ª <code>Suspense</code> ä¸æ˜¯é¦–æ¬¡æŒ‚è½½</li>
</ul>
<p><br><br><br></p>
<h2 id="é‚£-usedeferedvalue-å‘¢ï¼Ÿ"><a href="#é‚£-usedeferedvalue-å‘¢ï¼Ÿ" class="headerlink" title="é‚£ useDeferedValue å‘¢ï¼Ÿ"></a>é‚£ useDeferedValue å‘¢ï¼Ÿ</h2><p>å¦‚æœä½ ç†è§£äº†ä¸Šé¢çš„å†…å®¹, é‚£ä¹ˆ <code>useDeferedValue</code> å°±å¥½åŠäº†ï¼Œå®ƒä¸è¿‡æ˜¯ useTransition çš„ç®€å•å°è£…ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useDeferredValue</span>&lt;<span class="title">T</span>&gt;(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  value: T,</span></span></span><br><span class="line"><span class="function"><span class="params">  config: TimeoutConfig | void | null,</span></span></span><br><span class="line"><span class="function"><span class="params"></span>): <span class="title">T</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [prevValue, setValue] = useState(value);</span><br><span class="line">  <span class="keyword">const</span> [startTransition] = useTransition(config)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// âš›ï¸ useDeferredValue åªä¸è¿‡æ˜¯ç›‘å¬ value çš„å˜åŒ–ï¼Œ</span></span><br><span class="line">  <span class="comment">// ç„¶ååœ¨ startTransition ä¸­æ›´æ–°å®ƒã€‚ä»è€Œå®ç°å»¶è¿Ÿæ›´æ–°çš„æ•ˆæœ</span></span><br><span class="line">  useEffect(</span><br><span class="line">    () =&gt; &#123;</span><br><span class="line">      startTransition(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        setValue(value);</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    [value, config],</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> prevValue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br></p>
<p><code>useDeferredValue</code> åªä¸è¿‡æ˜¯ä½¿ç”¨ useEffect ç›‘å¬ <code>value</code> çš„å˜åŒ–ï¼Œ ç„¶ååœ¨ startTransition ä¸­æ›´æ–°å®ƒã€‚ä»è€Œå®ç°å»¶è¿Ÿæ›´æ–°çš„æ•ˆæœã€‚ä¸Šæ–‡å®éªŒ 1ï¸âƒ£ å·²ç»ä»‹ç»è¿‡è¿è¡Œæ•ˆæœï¼ŒReact ä¼šé™ä½ startTransition ä¸­æ›´æ–°çš„ä¼˜å…ˆçº§ï¼Œ è¿™æ„å‘³ç€åœ¨äº‹åŠ¡ç¹å¿™æ—¶å®ƒä»¬ä¼šå»¶åæ‰§è¡Œã€‚</p>
<p><br><br><br></p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æˆ‘ä»¬ä¸€å¼€å§‹ä»‹ç»äº† useTransition çš„åº”ç”¨åœºæ™¯, è®©é¡µé¢å®ç° <strong><code>Pending</code> -&gt; <code>Skeleton</code> -&gt; <code>Complete</code></strong> çš„æ›´æ–°è·¯å¾„, ç”¨æˆ·åœ¨åˆ‡æ¢é¡µé¢æ—¶å¯ä»¥åœç•™åœ¨å½“å‰é¡µé¢ï¼Œè®©é¡µé¢ä¿æŒå“åº”ã€‚ ç›¸æ¯”å±•ç¤ºä¸€ä¸ªæ— ç”¨çš„ç©ºç™½é¡µé¢æˆ–è€…åŠ è½½çŠ¶æ€ï¼Œè¿™ç§ç”¨æˆ·ä½“éªŒæ›´åŠ å‹å¥½ã€‚</p>
<p>å½“ç„¶ä¸Šè¿°çš„å‡è®¾æ¡ä»¶æ—¶æ•°æ®åŠ è½½å¾ˆæ…¢ï¼Œå¦‚æœæ•°æ®åŠ è½½å¾ˆå¿«ï¼Œåˆ©ç”¨ useTransition æœºåˆ¶ï¼Œæˆ‘ä»¬å®ç°ä¸è®©ç”¨æˆ·çœ‹åˆ°åŠ è½½çŠ¶æ€ï¼Œè¿™æ ·èƒ½é¿å…é¡µé¢é¡µé¢æŠ–åŠ¨å’Œé—ªçƒ, çœ‹èµ·æ¥åƒæ²¡æœ‰åŠ è½½çš„è¿‡ç¨‹ã€‚</p>
<p>æ¥ç€æˆ‘ä»¬ç®€å•ä»‹ç»äº† useTransition çš„è¿è¡ŒåŸç†å’Œæ¡ä»¶ã€‚ å¦‚æœ startTransition ä¸­çš„çŠ¶æ€æ›´æ–°è§¦å‘äº† Suspenseï¼Œé‚£ä¹ˆå¯¹åº”çš„ç»„ä»¶å°±ä¼šè¿›å…¥ Pending çŠ¶æ€ã€‚åœ¨ Pending çŠ¶æ€æœŸé—´ï¼ŒstartTransitionä¸­è®¾ç½®å˜æ›´éƒ½ä¼šè¢«å»¶è¿Ÿæäº¤ã€‚ Pending çŠ¶æ€ä¼šæŒç»­åˆ° Suspense å°±ç»ªæˆ–è€…è¶…æ—¶ã€‚</p>
<p>useTransition å¿…é¡»å’Œ Suspense é…åˆä½¿ç”¨æ‰èƒ½æ–½å±•é­”æ³•ã€‚è¿˜æœ‰ä¸€ä¸ªç”¨æˆ·åœºæ™¯æ˜¯æˆ‘ä»¬å¯ä»¥å°†ä½ä¼˜å…ˆçº§çš„æ›´æ–°æ”¾ç½®åˆ° startTransition ä¸­ã€‚æ¯”å¦‚æŸä¸ªæ›´æ–°çš„æˆæœ¬å¾ˆé«˜ï¼Œå°±å¯ä»¥é€‰æ‹©æ”¾åˆ° startTransition ä¸­, è¿™äº›æ›´æ–°ä¼šè®©ä½é«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡ï¼Œå¦å¤–ä¼š React å»¶è¿Ÿæˆ–åˆå¹¶ä¸€ä¸ªæ¯”è¾ƒå¤æ‚çš„æ›´æ–°ï¼Œè®©é¡µé¢ä¿æŒå“åº”ã€‚</p>
<p><br><br><br></p>
<p><strong>Okï¼Œå…³äº Concurrent æ¨¡å¼çš„ä»‹ç»å°±å…ˆå‘Šä¸€æ®µè½äº†, è¿™æ˜¯ä¸­æ–‡çš„ç¬¬ä¸€æ‰‹èµ„æ–™ã€‚å†™è¿™äº›æ–‡ç« è€—æ‰äº†æˆ‘å¤§éƒ¨åˆ†çš„ä¸šä½™æ—¶é—´ï¼Œå¦‚æœä½ å–œæ¬¢æˆ‘çš„æ–‡ç« ï¼Œè¯·å¤šç»™æˆ‘ç‚¹èµå’Œåé¦ˆã€‚</strong></p>
<p><br><br><br></p>
<h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul>
<li><a href="https://reactjs.org/docs/concurrent-mode-patterns.html" target="_blank" rel="noopener">Concurrent UI Patterns</a></li>
<li><a href="https://github.com/facebook/react/pull/15593" target="_blank" rel="noopener">Add withSuspenseConfig API</a></li>
</ul>
<p><br></p>
<p><img src="/images/sponsor.jpg" alt></p>

  </div>
</article>

    <div class="blog-post-comments">
        <div id="disqus_thread">
            <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        </div>
    </div>



    </div>
    
      <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Blogs</a></li>
         
          <li><a href="http://github.com/ivan-94">Projects</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#åº”ç”¨åœºæ™¯æ˜¯ä»€ä¹ˆï¼Ÿ"><span class="toc-number">1.</span> <span class="toc-text">åº”ç”¨åœºæ™¯æ˜¯ä»€ä¹ˆï¼Ÿ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#usetransition-ç™»åœº"><span class="toc-number">2.</span> <span class="toc-text">useTransition ç™»åœº</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#usetransition-åŸç†åˆæ¢"><span class="toc-number">3.</span> <span class="toc-text">useTransition åŸç†åˆæ¢</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1ï¸âƒ£-åˆ©ç”¨-starttransition-æ¥è¿è¡Œä½ä¼˜å…ˆçº§ä»»åŠ¡"><span class="toc-number">3.1.</span> <span class="toc-text">1ï¸âƒ£ åˆ©ç”¨ startTransition æ¥è¿è¡Œä½ä¼˜å…ˆçº§ä»»åŠ¡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2ï¸âƒ£-starttransition-æ›´æ–°è§¦å‘-suspense"><span class="toc-number">3.2.</span> <span class="toc-text">2ï¸âƒ£ startTransition æ›´æ–°è§¦å‘ Suspense</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3ï¸âƒ£-å°†-tick-æ›´æ–°æåˆ°-starttransition-ä½œç”¨åŸŸå¤–"><span class="toc-number">3.3.</span> <span class="toc-text">3ï¸âƒ£ å°† tick æ›´æ–°æåˆ° startTransition ä½œç”¨åŸŸå¤–</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4ï¸âƒ£-åµŒå¥—suspense"><span class="toc-number">3.4.</span> <span class="toc-text">4ï¸âƒ£ åµŒå¥—Suspense</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5ï¸âƒ£-å¯ä»¥å’Œ-mobx-å’Œ-redux-é…åˆä½¿ç”¨å—"><span class="toc-number">3.5.</span> <span class="toc-text">5ï¸âƒ£ å¯ä»¥å’Œ Mobx å’Œ Redux é…åˆä½¿ç”¨å—?</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#é‚£-usedeferedvalue-å‘¢ï¼Ÿ"><span class="toc-number">4.</span> <span class="toc-text">é‚£ useDeferedValue å‘¢ï¼Ÿ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#æ€»ç»“"><span class="toc-number">5.</span> <span class="toc-text">æ€»ç»“</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#å‚è€ƒèµ„æ–™"><span class="toc-number">6.</span> <span class="toc-text">å‚è€ƒèµ„æ–™</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://bobi.ink/2019/10/28/concurrent-mode-transition/"><i class="fa fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=https://bobi.ink/2019/10/28/concurrent-mode-transition/&text=React Concurrent æ¨¡å¼æŠ¢å…ˆé¢„è§ˆä¸‹ç¯‡: useTransition çš„å¹³è¡Œä¸–ç•Œ"><i class="fa fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://bobi.ink/2019/10/28/concurrent-mode-transition/&title=React Concurrent æ¨¡å¼æŠ¢å…ˆé¢„è§ˆä¸‹ç¯‡: useTransition çš„å¹³è¡Œä¸–ç•Œ"><i class="fa fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://bobi.ink/2019/10/28/concurrent-mode-transition/&is_video=false&description=React Concurrent æ¨¡å¼æŠ¢å…ˆé¢„è§ˆä¸‹ç¯‡: useTransition çš„å¹³è¡Œä¸–ç•Œ"><i class="fa fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=React Concurrent æ¨¡å¼æŠ¢å…ˆé¢„è§ˆä¸‹ç¯‡: useTransition çš„å¹³è¡Œä¸–ç•Œ&body=Check out this article: https://bobi.ink/2019/10/28/concurrent-mode-transition/"><i class="fa fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=https://bobi.ink/2019/10/28/concurrent-mode-transition/&title=React Concurrent æ¨¡å¼æŠ¢å…ˆé¢„è§ˆä¸‹ç¯‡: useTransition çš„å¹³è¡Œä¸–ç•Œ"><i class="fa fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=https://bobi.ink/2019/10/28/concurrent-mode-transition/&title=React Concurrent æ¨¡å¼æŠ¢å…ˆé¢„è§ˆä¸‹ç¯‡: useTransition çš„å¹³è¡Œä¸–ç•Œ"><i class="fa fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://bobi.ink/2019/10/28/concurrent-mode-transition/&title=React Concurrent æ¨¡å¼æŠ¢å…ˆé¢„è§ˆä¸‹ç¯‡: useTransition çš„å¹³è¡Œä¸–ç•Œ"><i class="fa fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=https://bobi.ink/2019/10/28/concurrent-mode-transition/&title=React Concurrent æ¨¡å¼æŠ¢å…ˆé¢„è§ˆä¸‹ç¯‡: useTransition çš„å¹³è¡Œä¸–ç•Œ"><i class="fa fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=https://bobi.ink/2019/10/28/concurrent-mode-transition/&name=React Concurrent æ¨¡å¼æŠ¢å…ˆé¢„è§ˆä¸‹ç¯‡: useTransition çš„å¹³è¡Œä¸–ç•Œ&description="><i class="fa fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
      <ul>
        <li id="toc"><a class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa fa-list fa-lg" aria-hidden="true"></i> TOC</a></li>
        <li id="share"><a class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa fa-share-alt fa-lg" aria-hidden="true"></i> Share</a></li>
        <li id="top" style="display:none"><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a></li>
        <li id="menu"><a class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa fa-bars fa-lg" aria-hidden="true"></i> Menu</a></li>
      </ul>
    </div>

  </div>
</div>

    
    <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2025 Ivan
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Blogs</a></li>
         
          <li><a href="http://github.com/ivan-94">Projects</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

</body>
</html>
<!-- styles -->
<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
<link rel="stylesheet" href="/lib/meslo-LG/styles.css">
<link rel="stylesheet" href="/lib/justified-gallery/justifiedGallery.min.css">

<!-- jquery -->
<script src="/lib/jquery/jquery.min.js"></script>
<script src="/lib/justified-gallery/jquery.justifiedGallery.min.js"></script>
<script src="/js/main.js"></script>


    <!-- Google Analytics -->
    <script type="text/javascript">
        (function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-44571525-2', 'auto');
        ga('send', 'pageview');
    </script>


    <!-- Disqus Comments -->
    <script type="text/javascript">
        var disqus_shortname = 'bobi-ink';

        (function(){
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        }());
    </script>


