<!DOCTYPE html>
<html lang=zh>
<head><meta name="generator" content="Hexo 3.8.0">
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="description" content="å½“æˆ‘ä»¬åœ¨ç»„ä»¶ä¸Šè®¾ç½®äº‹ä»¶å¤„ç†å™¨æ—¶ï¼ŒReactå¹¶ä¸ä¼šåœ¨è¯¥DOMå…ƒç´ ä¸Šç›´æ¥ç»‘å®šäº‹ä»¶å¤„ç†å™¨. Reactå†…éƒ¨è‡ªå®šä¹‰äº†ä¸€å¥—äº‹ä»¶ç³»ç»Ÿï¼Œåœ¨è¿™ä¸ªç³»ç»Ÿä¸Šç»Ÿä¸€è¿›è¡Œäº‹ä»¶è®¢é˜…å’Œåˆ†å‘.  å…·ä½“æ¥è®²ï¼ŒReactåˆ©ç”¨äº‹ä»¶å§”æ‰˜æœºåˆ¶åœ¨Documentä¸Šç»Ÿä¸€ç›‘å¬DOMäº‹ä»¶ï¼Œå†æ ¹æ®è§¦å‘çš„targetå°†äº‹ä»¶åˆ†å‘åˆ°å…·ä½“çš„ç»„ä»¶å®ä¾‹ã€‚å¦å¤–ä¸Šé¢eæ˜¯ä¸€ä¸ªåˆæˆäº‹ä»¶å¯¹è±¡(SyntheticEvent), è€Œä¸æ˜¯åŸå§‹çš„DOMäº‹ä»¶å¯¹è±¡.  æ–‡ç« å¤§çº²">
<meta name="keywords" content="Blog,FrontEnd,React,Javascript,Typescript">
<meta property="og:type" content="article">
<meta property="og:title" content="è°ˆè°ˆReactäº‹ä»¶æœºåˆ¶å’Œæœªæ¥(react-events)">
<meta property="og:url" content="https://bobi.ink/2019/07/29/react-event/index.html">
<meta property="og:site_name" content="Bobi.ink">
<meta property="og:description" content="å½“æˆ‘ä»¬åœ¨ç»„ä»¶ä¸Šè®¾ç½®äº‹ä»¶å¤„ç†å™¨æ—¶ï¼ŒReactå¹¶ä¸ä¼šåœ¨è¯¥DOMå…ƒç´ ä¸Šç›´æ¥ç»‘å®šäº‹ä»¶å¤„ç†å™¨. Reactå†…éƒ¨è‡ªå®šä¹‰äº†ä¸€å¥—äº‹ä»¶ç³»ç»Ÿï¼Œåœ¨è¿™ä¸ªç³»ç»Ÿä¸Šç»Ÿä¸€è¿›è¡Œäº‹ä»¶è®¢é˜…å’Œåˆ†å‘.  å…·ä½“æ¥è®²ï¼ŒReactåˆ©ç”¨äº‹ä»¶å§”æ‰˜æœºåˆ¶åœ¨Documentä¸Šç»Ÿä¸€ç›‘å¬DOMäº‹ä»¶ï¼Œå†æ ¹æ®è§¦å‘çš„targetå°†äº‹ä»¶åˆ†å‘åˆ°å…·ä½“çš„ç»„ä»¶å®ä¾‹ã€‚å¦å¤–ä¸Šé¢eæ˜¯ä¸€ä¸ªåˆæˆäº‹ä»¶å¯¹è±¡(SyntheticEvent), è€Œä¸æ˜¯åŸå§‹çš„DOMäº‹ä»¶å¯¹è±¡.  æ–‡ç« å¤§çº²">
<meta property="og:locale" content="zh">
<meta property="og:image" content="https://bobi.ink/images/react-event/sample.png">
<meta property="og:image" content="https://bobi.ink/images/react-event/st.png">
<meta property="og:image" content="https://bobi.ink/images/react-event/dispatch-config.png">
<meta property="og:image" content="https://bobi.ink/images/react-event/listento.png">
<meta property="og:image" content="https://bobi.ink/images/react-event/binding.png">
<meta property="og:image" content="https://bobi.ink/images/react-event/binding.png">
<meta property="og:image" content="https://bobi.ink/images/react-event/event-delivery.png">
<meta property="og:image" content="https://bobi.ink/images/react-event/dispatch.png">
<meta property="og:image" content="https://bobi.ink/images/react-event/responder.png">
<meta property="og:image" content="https://codesandbox.io/static/img/play-codesandbox.svg">
<meta property="og:image" content="https://bobi.ink/images/react-event/react-events.png">
<meta property="og:updated_time" content="2023-06-01T09:55:14.330Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="è°ˆè°ˆReactäº‹ä»¶æœºåˆ¶å’Œæœªæ¥(react-events)">
<meta name="twitter:description" content="å½“æˆ‘ä»¬åœ¨ç»„ä»¶ä¸Šè®¾ç½®äº‹ä»¶å¤„ç†å™¨æ—¶ï¼ŒReactå¹¶ä¸ä¼šåœ¨è¯¥DOMå…ƒç´ ä¸Šç›´æ¥ç»‘å®šäº‹ä»¶å¤„ç†å™¨. Reactå†…éƒ¨è‡ªå®šä¹‰äº†ä¸€å¥—äº‹ä»¶ç³»ç»Ÿï¼Œåœ¨è¿™ä¸ªç³»ç»Ÿä¸Šç»Ÿä¸€è¿›è¡Œäº‹ä»¶è®¢é˜…å’Œåˆ†å‘.  å…·ä½“æ¥è®²ï¼ŒReactåˆ©ç”¨äº‹ä»¶å§”æ‰˜æœºåˆ¶åœ¨Documentä¸Šç»Ÿä¸€ç›‘å¬DOMäº‹ä»¶ï¼Œå†æ ¹æ®è§¦å‘çš„targetå°†äº‹ä»¶åˆ†å‘åˆ°å…·ä½“çš„ç»„ä»¶å®ä¾‹ã€‚å¦å¤–ä¸Šé¢eæ˜¯ä¸€ä¸ªåˆæˆäº‹ä»¶å¯¹è±¡(SyntheticEvent), è€Œä¸æ˜¯åŸå§‹çš„DOMäº‹ä»¶å¯¹è±¡.  æ–‡ç« å¤§çº²">
<meta name="twitter:image" content="https://bobi.ink/images/react-event/sample.png">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>è°ˆè°ˆReactäº‹ä»¶æœºåˆ¶å’Œæœªæ¥(react-events)</title>
    <!-- styles -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- rss -->
    
    
</head>

<body>
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Blogs</a></li>
         
          <li><a href="http://github.com/ivan-94">Projects</a></li>
        
      </ul>
    </span>
    <br>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2019/08/04/electron-remote/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/2019/07/19/frontend-standard/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://bobi.ink/2019/07/29/react-event/"><i class="fa fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=https://bobi.ink/2019/07/29/react-event/&text=è°ˆè°ˆReactäº‹ä»¶æœºåˆ¶å’Œæœªæ¥(react-events)"><i class="fa fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://bobi.ink/2019/07/29/react-event/&title=è°ˆè°ˆReactäº‹ä»¶æœºåˆ¶å’Œæœªæ¥(react-events)"><i class="fa fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://bobi.ink/2019/07/29/react-event/&is_video=false&description=è°ˆè°ˆReactäº‹ä»¶æœºåˆ¶å’Œæœªæ¥(react-events)"><i class="fa fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=è°ˆè°ˆReactäº‹ä»¶æœºåˆ¶å’Œæœªæ¥(react-events)&body=Check out this article: https://bobi.ink/2019/07/29/react-event/"><i class="fa fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=https://bobi.ink/2019/07/29/react-event/&title=è°ˆè°ˆReactäº‹ä»¶æœºåˆ¶å’Œæœªæ¥(react-events)"><i class="fa fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=https://bobi.ink/2019/07/29/react-event/&title=è°ˆè°ˆReactäº‹ä»¶æœºåˆ¶å’Œæœªæ¥(react-events)"><i class="fa fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://bobi.ink/2019/07/29/react-event/&title=è°ˆè°ˆReactäº‹ä»¶æœºåˆ¶å’Œæœªæ¥(react-events)"><i class="fa fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=https://bobi.ink/2019/07/29/react-event/&title=è°ˆè°ˆReactäº‹ä»¶æœºåˆ¶å’Œæœªæ¥(react-events)"><i class="fa fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=https://bobi.ink/2019/07/29/react-event/&name=è°ˆè°ˆReactäº‹ä»¶æœºåˆ¶å’Œæœªæ¥(react-events)&description="><i class="fa fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#é‚£ä¸ºä»€ä¹ˆè¦è‡ªå®šä¹‰ä¸€å¥—äº‹ä»¶ç³»ç»Ÿ"><span class="toc-number">1.</span> <span class="toc-text">é‚£ä¸ºä»€ä¹ˆè¦è‡ªå®šä¹‰ä¸€å¥—äº‹ä»¶ç³»ç»Ÿ?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#åŸºæœ¬æ¦‚å¿µ"><span class="toc-number">2.</span> <span class="toc-text">åŸºæœ¬æ¦‚å¿µ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#æ•´ä½“çš„æ¶æ„"><span class="toc-number">2.1.</span> <span class="toc-text">æ•´ä½“çš„æ¶æ„</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#äº‹ä»¶åˆ†ç±»ä¸ä¼˜å…ˆçº§"><span class="toc-number">2.2.</span> <span class="toc-text">äº‹ä»¶åˆ†ç±»ä¸ä¼˜å…ˆçº§</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#å®ç°ç»†èŠ‚"><span class="toc-number">3.</span> <span class="toc-text">å®ç°ç»†èŠ‚</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#äº‹ä»¶æ˜¯å¦‚ä½•ç»‘å®šçš„ï¼Ÿ"><span class="toc-number">3.1.</span> <span class="toc-text">äº‹ä»¶æ˜¯å¦‚ä½•ç»‘å®šçš„ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#äº‹ä»¶æ˜¯å¦‚ä½•åˆ†å‘çš„ï¼Ÿ"><span class="toc-number">3.2.</span> <span class="toc-text">äº‹ä»¶æ˜¯å¦‚ä½•åˆ†å‘çš„ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#äº‹ä»¶è§¦å‘è°ƒåº¦"><span class="toc-number">3.2.1.</span> <span class="toc-text">äº‹ä»¶è§¦å‘è°ƒåº¦</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#æ’ä»¶æ˜¯å¦‚ä½•å¤„ç†äº‹ä»¶"><span class="toc-number">3.2.2.</span> <span class="toc-text">æ’ä»¶æ˜¯å¦‚ä½•å¤„ç†äº‹ä»¶?</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#æ‰¹é‡æ‰§è¡Œ"><span class="toc-number">3.2.3.</span> <span class="toc-text">æ‰¹é‡æ‰§è¡Œ</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#æœªæ¥"><span class="toc-number">4.</span> <span class="toc-text">æœªæ¥</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#åˆæ¢responderçš„åˆ›å»º"><span class="toc-number">4.1.</span> <span class="toc-text">åˆæ¢Responderçš„åˆ›å»º</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#react-eventsæ„ä¹‰ä½•åœ¨"><span class="toc-number">4.2.</span> <span class="toc-text">react-eventsæ„ä¹‰ä½•åœ¨?</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#æ‰©å±•é˜…è¯»"><span class="toc-number">5.</span> <span class="toc-text">æ‰©å±•é˜…è¯»</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index width mx-auto px2 my4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        è°ˆè°ˆReactäº‹ä»¶æœºåˆ¶å’Œæœªæ¥(react-events)
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">Bobi.ink</span>
      </span>
      
    <div class="postdate">
        <time datetime="2019-07-28T16:00:00.000Z" itemprop="datePublished">2019-07-29</time>
    </div>


      

    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <p><img src="/images/react-event/sample.png" alt></p>
<p>å½“æˆ‘ä»¬åœ¨ç»„ä»¶ä¸Šè®¾ç½®äº‹ä»¶å¤„ç†å™¨æ—¶ï¼ŒReactå¹¶ä¸ä¼šåœ¨è¯¥DOMå…ƒç´ ä¸Šç›´æ¥ç»‘å®šäº‹ä»¶å¤„ç†å™¨. Reactå†…éƒ¨è‡ªå®šä¹‰äº†ä¸€å¥—äº‹ä»¶ç³»ç»Ÿï¼Œåœ¨è¿™ä¸ªç³»ç»Ÿä¸Šç»Ÿä¸€è¿›è¡Œäº‹ä»¶è®¢é˜…å’Œåˆ†å‘. </p>
<p>å…·ä½“æ¥è®²ï¼ŒReactåˆ©ç”¨äº‹ä»¶å§”æ‰˜æœºåˆ¶åœ¨Documentä¸Šç»Ÿä¸€ç›‘å¬DOMäº‹ä»¶ï¼Œå†æ ¹æ®è§¦å‘çš„targetå°†äº‹ä»¶åˆ†å‘åˆ°å…·ä½“çš„ç»„ä»¶å®ä¾‹ã€‚å¦å¤–ä¸Šé¢eæ˜¯ä¸€ä¸ªåˆæˆäº‹ä»¶å¯¹è±¡(SyntheticEvent), è€Œä¸æ˜¯åŸå§‹çš„DOMäº‹ä»¶å¯¹è±¡.</p>
<p><br></p>
<p><strong>æ–‡ç« å¤§çº²</strong></p>
<!-- TOC -->
<ul>
<li><a href="#é‚£ä¸ºä»€ä¹ˆè¦è‡ªå®šä¹‰ä¸€å¥—äº‹ä»¶ç³»ç»Ÿ">é‚£ä¸ºä»€ä¹ˆè¦è‡ªå®šä¹‰ä¸€å¥—äº‹ä»¶ç³»ç»Ÿ?</a></li>
<li><a href="#åŸºæœ¬æ¦‚å¿µ">åŸºæœ¬æ¦‚å¿µ</a><ul>
<li><a href="#æ•´ä½“çš„æ¶æ„">æ•´ä½“çš„æ¶æ„</a></li>
<li><a href="#äº‹ä»¶åˆ†ç±»ä¸ä¼˜å…ˆçº§">äº‹ä»¶åˆ†ç±»ä¸ä¼˜å…ˆçº§</a></li>
</ul>
</li>
<li><a href="#å®ç°ç»†èŠ‚">å®ç°ç»†èŠ‚</a><ul>
<li><a href="#äº‹ä»¶æ˜¯å¦‚ä½•ç»‘å®šçš„">äº‹ä»¶æ˜¯å¦‚ä½•ç»‘å®šçš„ï¼Ÿ</a></li>
<li><a href="#äº‹ä»¶æ˜¯å¦‚ä½•åˆ†å‘çš„">äº‹ä»¶æ˜¯å¦‚ä½•åˆ†å‘çš„ï¼Ÿ</a><ul>
<li><a href="#äº‹ä»¶è§¦å‘è°ƒåº¦">äº‹ä»¶è§¦å‘è°ƒåº¦</a></li>
<li><a href="#æ’ä»¶æ˜¯å¦‚ä½•å¤„ç†äº‹ä»¶">æ’ä»¶æ˜¯å¦‚ä½•å¤„ç†äº‹ä»¶?</a></li>
<li><a href="#æ‰¹é‡æ‰§è¡Œ">æ‰¹é‡æ‰§è¡Œ</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#æœªæ¥">æœªæ¥</a><ul>
<li><a href="#åˆæ¢responderçš„åˆ›å»º">åˆæ¢Responderçš„åˆ›å»º</a></li>
<li><a href="#react-eventsæ„ä¹‰ä½•åœ¨">react-eventsæ„ä¹‰ä½•åœ¨?</a></li>
</ul>
</li>
<li><a href="#æ‰©å±•é˜…è¯»">æ‰©å±•é˜…è¯»</a></li>
</ul>
<!-- /TOC -->
<blockquote>
<p>æˆªæ­¢æœ¬æ–‡å†™ä½œæ—¶ï¼ŒReactç‰ˆæœ¬æ˜¯16.8.6</p>
</blockquote>
<p><br></p>
<h2 id="é‚£ä¸ºä»€ä¹ˆè¦è‡ªå®šä¹‰ä¸€å¥—äº‹ä»¶ç³»ç»Ÿ"><a href="#é‚£ä¸ºä»€ä¹ˆè¦è‡ªå®šä¹‰ä¸€å¥—äº‹ä»¶ç³»ç»Ÿ" class="headerlink" title="é‚£ä¸ºä»€ä¹ˆè¦è‡ªå®šä¹‰ä¸€å¥—äº‹ä»¶ç³»ç»Ÿ?"></a>é‚£ä¸ºä»€ä¹ˆè¦è‡ªå®šä¹‰ä¸€å¥—äº‹ä»¶ç³»ç»Ÿ?</h2><p>å¦‚æœäº†è§£è¿‡Preact(ç¬”è€…ä¹‹å‰å†™è¿‡ä¸€ç¯‡æ–‡ç« <a href="https://juejin.im/post/5cfa29e151882539c33e4f5e" target="_blank" rel="noopener">è§£æPreactçš„æºç </a>)ï¼ŒPreactè£å‰ªäº†å¾ˆå¤šReactçš„ä¸œè¥¿ï¼Œå…¶ä¸­åŒ…æ‹¬äº‹ä»¶æœºåˆ¶ï¼ŒPreactæ˜¯ç›´æ¥åœ¨DOMå…ƒç´ ä¸Šè¿›è¡Œäº‹ä»¶ç»‘å®šçš„ã€‚</p>
<p>åœ¨ç ”ç©¶ä¸€ä¸ªäº‹ç‰©ä¹‹å‰ï¼Œæˆ‘é¦–å…ˆè¦é—®ä¸ºä»€ä¹ˆï¼Ÿäº†è§£å®ƒçš„åŠ¨æœºï¼Œæ‰æœ‰åˆ©äºä½ å¯¹å®ƒæœ‰æœ¬è´¨çš„è®¤è¯†ã€‚</p>
<p>Reactè‡ªå®šä¹‰ä¸€å¥—äº‹ä»¶ç³»ç»Ÿçš„åŠ¨æœºæœ‰ä»¥ä¸‹å‡ ä¸ª:</p>
<ul>
<li><p><strong>1. æŠ¹å¹³æµè§ˆå™¨ä¹‹é—´çš„å…¼å®¹æ€§å·®å¼‚</strong>ã€‚ è¿™æ˜¯ä¼°è®¡æœ€åŸå§‹çš„åŠ¨æœºï¼ŒReactæ ¹æ®<a href="https://www.w3.org/TR/DOM-Level-3-Events/" target="_blank" rel="noopener">W3C è§„èŒƒ</a>æ¥å®šä¹‰è¿™äº›åˆæˆäº‹ä»¶(SyntheticEvent), æ„åœ¨æŠ¹å¹³æµè§ˆå™¨ä¹‹é—´çš„å·®å¼‚ã€‚</p>
<p>å¦å¤–Reactè¿˜ä¼šè¯•å›¾é€šè¿‡å…¶ä»–ç›¸å…³äº‹ä»¶æ¥æ¨¡æ‹Ÿä¸€äº›ä½ç‰ˆæœ¬ä¸å…¼å®¹çš„äº‹ä»¶, è¿™æ‰æ˜¯â€˜åˆæˆâ€™çš„æœ¬æ¥æ„æ€å§ï¼Ÿã€‚</p>
</li>
<li><p><strong>2. äº‹ä»¶â€˜åˆæˆâ€™, å³äº‹ä»¶è‡ªå®šä¹‰</strong>ã€‚äº‹ä»¶åˆæˆé™¤äº†å¤„ç†å…¼å®¹æ€§é—®é¢˜ï¼Œè¿˜å¯ä»¥ç”¨æ¥è‡ªå®šä¹‰é«˜çº§äº‹ä»¶ï¼Œæ¯”è¾ƒå…¸å‹çš„æ˜¯Reactçš„onChangeäº‹ä»¶ï¼Œå®ƒä¸ºè¡¨å•å…ƒç´ å®šä¹‰äº†ç»Ÿä¸€çš„å€¼å˜åŠ¨äº‹ä»¶ã€‚å¦å¤–ç¬¬ä¸‰æ–¹ä¹Ÿå¯ä»¥é€šè¿‡Reactçš„äº‹ä»¶æ’ä»¶æœºåˆ¶æ¥åˆæˆè‡ªå®šä¹‰äº‹ä»¶ï¼Œå°½ç®¡å¾ˆå°‘äººè¿™ä¹ˆåšã€‚</p>
</li>
<li><p><strong>3. æŠ½è±¡è·¨å¹³å°äº‹ä»¶æœºåˆ¶</strong>ã€‚ å’ŒVirtualDOMçš„æ„ä¹‰å·®ä¸å¤šï¼ŒVirtualDOMæŠ½è±¡äº†è·¨å¹³å°çš„æ¸²æŸ“æ–¹å¼ï¼Œé‚£ä¹ˆå¯¹åº”çš„SyntheticEventç›®çš„ä¹Ÿæ˜¯æƒ³æä¾›ä¸€ä¸ªæŠ½è±¡çš„è·¨å¹³å°äº‹ä»¶æœºåˆ¶ã€‚</p>
</li>
<li><p><strong>4. Reactæ‰“ç®—åšæ›´å¤šä¼˜åŒ–</strong>ã€‚æ¯”å¦‚åˆ©ç”¨äº‹ä»¶å§”æ‰˜æœºåˆ¶ï¼Œå¤§éƒ¨åˆ†äº‹ä»¶æœ€ç»ˆç»‘å®šåˆ°äº†Documentï¼Œè€Œä¸æ˜¯DOMèŠ‚ç‚¹æœ¬èº«. è¿™æ ·ç®€åŒ–äº†DOMäº‹ä»¶å¤„ç†é€»è¾‘ï¼Œå‡å°‘äº†å†…å­˜å¼€é”€. ä½†è¿™ä¹Ÿæ„å‘³ç€ï¼Œ<strong>Reactéœ€è¦è‡ªå·±æ¨¡æ‹Ÿä¸€å¥—äº‹ä»¶å†’æ³¡çš„æœºåˆ¶</strong>ã€‚</p>
</li>
<li><p><strong>5. Reactæ‰“ç®—å¹²é¢„äº‹ä»¶çš„åˆ†å‘</strong>ã€‚v16å¼•å…¥Fiberæ¶æ„ï¼ŒReactä¸ºäº†ä¼˜åŒ–ç”¨æˆ·çš„äº¤äº’ä½“éªŒï¼Œä¼šå¹²é¢„äº‹ä»¶çš„åˆ†å‘ã€‚ä¸åŒç±»å‹çš„äº‹ä»¶æœ‰ä¸åŒçš„ä¼˜å…ˆçº§ï¼Œæ¯”å¦‚é«˜ä¼˜å…ˆçº§çš„äº‹ä»¶å¯ä»¥ä¸­æ–­æ¸²æŸ“ï¼Œè®©ç”¨æˆ·ä»£ç å¯ä»¥åŠæ—¶å“åº”ç”¨æˆ·äº¤äº’ã€‚</p>
</li>
</ul>
<p><br></p>
<p>Ok, åé¢æˆ‘ä»¬ä¼šæ·±å…¥äº†è§£Reactçš„äº‹ä»¶å®ç°ï¼Œæˆ‘ä¼šå°½é‡ä¸è´´ä»£ç ï¼Œç”¨æµç¨‹å›¾è¯´è¯ã€‚</p>
<p><br></p>
<h2 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h2><h3 id="æ•´ä½“çš„æ¶æ„"><a href="#æ•´ä½“çš„æ¶æ„" class="headerlink" title="æ•´ä½“çš„æ¶æ„"></a>æ•´ä½“çš„æ¶æ„</h3><p><img src="/images/react-event/st.png" alt></p>
<ul>
<li><strong>ReactEventListener</strong> - äº‹ä»¶å¤„ç†å™¨. åœ¨è¿™é‡Œè¿›è¡Œäº‹ä»¶å¤„ç†å™¨çš„ç»‘å®šã€‚å½“DOMè§¦å‘äº‹ä»¶æ—¶ï¼Œä¼šä»è¿™é‡Œå¼€å§‹è°ƒåº¦åˆ†å‘åˆ°Reactç»„ä»¶æ ‘</li>
<li><strong>ReactEventEmitter</strong> - æš´éœ²æ¥å£ç»™Reactç»„ä»¶å±‚ç”¨äºæ·»åŠ äº‹ä»¶è®¢é˜…</li>
<li><strong>EventPluginHub</strong> - å¦‚å…¶åï¼Œè¿™æ˜¯ä¸€ä¸ªâ€˜æ’ä»¶æ’æ§½â€™ï¼Œè´Ÿè´£ç®¡ç†å’Œæ³¨å†Œå„ç§æ’ä»¶ã€‚åœ¨äº‹ä»¶åˆ†å‘æ—¶ï¼Œè°ƒç”¨æ’ä»¶æ¥ç”Ÿæˆåˆæˆäº‹ä»¶</li>
<li><p><strong>Plugin</strong> - Reactäº‹ä»¶ç³»ç»Ÿä½¿ç”¨äº†æ’ä»¶æœºåˆ¶æ¥ç®¡ç†ä¸åŒè¡Œä¸ºçš„äº‹ä»¶ã€‚è¿™äº›æ’ä»¶ä¼šå¤„ç†è‡ªå·±æ„Ÿå…´è¶£çš„äº‹ä»¶ç±»å‹ï¼Œå¹¶ç”Ÿæˆåˆæˆäº‹ä»¶å¯¹è±¡ã€‚ç›®å‰ReactDOMæœ‰ä»¥ä¸‹å‡ ç§æ’ä»¶ç±»å‹:</p>
<ul>
<li><strong>SimpleEventPlugin</strong> - ç®€å•äº‹ä»¶, å¤„ç†ä¸€äº›æ¯”è¾ƒé€šç”¨çš„äº‹ä»¶ç±»å‹ï¼Œä¾‹å¦‚clickã€inputã€keyDownã€mouseOverã€mouseOutã€pointerOverã€pointerOut</li>
<li><p><strong>EnterLeaveEventPlugin</strong> - mouseEnter/mouseLeaveå’ŒpointerEnter/pointerLeaveè¿™ä¸¤ç±»äº‹ä»¶æ¯”è¾ƒç‰¹æ®Š, å’Œ<code>*over/*leave</code>äº‹ä»¶ç›¸æ¯”, å®ƒä»¬ä¸æ”¯æŒäº‹ä»¶å†’æ³¡, <code>*enter</code>ä¼šç»™æ‰€æœ‰è¿›å…¥çš„å…ƒç´ å‘é€äº‹ä»¶, è¡Œä¸ºæœ‰ç‚¹ç±»ä¼¼äº<code>:hover</code>; è€Œ<code>*over</code>åœ¨è¿›å…¥å…ƒç´ åï¼Œè¿˜ä¼šå†’æ³¡é€šçŸ¥å…¶ä¸Šçº§. å¯ä»¥é€šè¿‡è¿™ä¸ª<a href="https://codesandbox.io/s/enter-and-over-608cl" target="_blank" rel="noopener">å®ä¾‹</a>è§‚å¯Ÿenterå’Œoverçš„åŒºåˆ«.</p>
<p>å¦‚æœæ ‘å±‚æ¬¡æ¯”è¾ƒæ·±ï¼Œå¤§é‡çš„mouseenterè§¦å‘å¯èƒ½å¯¼è‡´æ€§èƒ½é—®é¢˜ã€‚å¦å¤–å…¶ä¸æ”¯æŒå†’æ³¡ï¼Œæ— æ³•åœ¨Documentå®Œç¾çš„ç›‘å¬å’Œåˆ†å‘, æ‰€ä»¥ReactDOMä½¿ç”¨<code>*over/*out</code>äº‹ä»¶æ¥æ¨¡æ‹Ÿè¿™äº›<code>*enter/*leave</code>ã€‚</p>
</li>
<li><p><strong>ChangeEventPlugin</strong> - changeäº‹ä»¶æ˜¯Reactçš„ä¸€ä¸ªè‡ªå®šä¹‰äº‹ä»¶ï¼Œæ—¨åœ¨è§„èŒƒåŒ–è¡¨å•å…ƒç´ çš„å˜åŠ¨äº‹ä»¶ã€‚</p>
<p>å®ƒæ”¯æŒè¿™äº›è¡¨å•å…ƒç´ : input, textarea, select </p>
</li>
<li><p><strong>SelectEventPlugin</strong> - å’Œchangeäº‹ä»¶ä¸€æ ·ï¼ŒReactä¸ºè¡¨å•å…ƒç´ è§„èŒƒåŒ–äº†select(é€‰æ‹©èŒƒå›´å˜åŠ¨)äº‹ä»¶ï¼Œé€‚ç”¨äºinputã€textareaã€contentEditableå…ƒç´ .</p>
</li>
<li><strong>BeforeInputEventPlugin</strong> - beforeinputäº‹ä»¶ä»¥åŠ<a href="https://developer.mozilla.org/zh-CN/docs/Web/Events/compositionstart" target="_blank" rel="noopener">composition</a>äº‹ä»¶å¤„ç†ã€‚</li>
</ul>
<p>æœ¬æ–‡ä¸»è¦ä¼šå…³æ³¨<code>SimpleEventPlugin</code>çš„å®ç°ï¼Œæœ‰å…´è¶£çš„è¯»è€…å¯ä»¥è‡ªå·±é˜…è¯»Reactçš„æºä»£ç .</p>
</li>
<li><p><strong>EventPropagators</strong> æŒ‰ç…§DOMäº‹ä»¶ä¼ æ’­çš„ä¸¤ä¸ªé˜¶æ®µï¼Œéå†Reactç»„ä»¶æ ‘ï¼Œå¹¶æ”¶é›†æ‰€æœ‰ç»„ä»¶çš„äº‹ä»¶å¤„ç†å™¨.</p>
</li>
<li><strong>EventBatching</strong> è´Ÿè´£æ‰¹é‡æ‰§è¡Œäº‹ä»¶é˜Ÿåˆ—å’Œäº‹ä»¶å¤„ç†å™¨ï¼Œå¤„ç†äº‹ä»¶å†’æ³¡ã€‚</li>
<li><p><strong>SyntheticEvent</strong> è¿™æ˜¯â€˜åˆæˆâ€™äº‹ä»¶çš„åŸºç±»ï¼Œå¯ä»¥å¯¹åº”DOMçš„Eventå¯¹è±¡ã€‚åªä¸è¿‡Reactä¸ºäº†å‡ä½å†…å­˜æŸè€—å’Œåƒåœ¾å›æ”¶ï¼Œä½¿ç”¨ä¸€ä¸ªå¯¹è±¡æ± æ¥æ„å»ºå’Œé‡Šæ”¾äº‹ä»¶å¯¹è±¡ï¼Œ ä¹Ÿå°±æ˜¯è¯´SyntheticEventä¸èƒ½ç”¨äºå¼‚æ­¥å¼•ç”¨ï¼Œå®ƒåœ¨åŒæ­¥æ‰§è¡Œå®Œäº‹ä»¶å¤„ç†å™¨åå°±ä¼šè¢«é‡Šæ”¾ã€‚</p>
<p>SyntheticEventä¹Ÿæœ‰å­ç±»ï¼Œå’ŒDOMå…·ä½“äº‹ä»¶ç±»å‹ä¸€ä¸€åŒ¹é…:</p>
<ul>
<li>SyntheticAnimationEvent</li>
<li>SyntheticClipboardEvent</li>
<li>SyntheticCompositionEvent</li>
<li>SyntheticDragEvent</li>
<li>SyntheticFocusEvent</li>
<li>SyntheticInputEvent</li>
<li>SyntheticKeyboardEvent</li>
<li>SyntheticMouseEvent</li>
<li>SyntheticPointerEvent</li>
<li>SyntheticTouchEvent</li>
<li>â€¦.</li>
</ul>
</li>
</ul>
<p><br></p>
<h3 id="äº‹ä»¶åˆ†ç±»ä¸ä¼˜å…ˆçº§"><a href="#äº‹ä»¶åˆ†ç±»ä¸ä¼˜å…ˆçº§" class="headerlink" title="äº‹ä»¶åˆ†ç±»ä¸ä¼˜å…ˆçº§"></a>äº‹ä»¶åˆ†ç±»ä¸ä¼˜å…ˆçº§</h3><p>SimpleEventPluginå°†äº‹ä»¶ç±»å‹åˆ’åˆ†æˆäº†ä¸‰ç±», å¯¹åº”ä¸åŒçš„ä¼˜å…ˆçº§(<strong>ä¼˜å…ˆçº§ç”±ä½åˆ°é«˜</strong>):</p>
<ul>
<li><strong>DiscreteEvent</strong> ç¦»æ•£äº‹ä»¶. ä¾‹å¦‚blurã€focusã€ clickã€ submitã€ touchStart. è¿™äº›äº‹ä»¶éƒ½æ˜¯ç¦»æ•£è§¦å‘çš„</li>
<li><strong>UserBlockingEvent</strong> ç”¨æˆ·é˜»å¡äº‹ä»¶. ä¾‹å¦‚touchMoveã€mouseMoveã€scrollã€dragã€dragOverç­‰ç­‰ã€‚è¿™äº›äº‹ä»¶ä¼šâ€™é˜»å¡â€™ç”¨æˆ·çš„äº¤äº’ã€‚</li>
<li><strong>ContinuousEvent</strong> å¯è¿ç»­äº‹ä»¶ã€‚ä¾‹å¦‚loadã€errorã€loadStartã€abortã€animationEnd. è¿™ä¸ªä¼˜å…ˆçº§æœ€é«˜ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä»¬åº”è¯¥æ˜¯ç«‹å³åŒæ­¥æ‰§è¡Œçš„ï¼Œè¿™å°±æ˜¯Continuousçš„æ„ä¹‰ï¼Œå³å¯è¿ç»­çš„æ‰§è¡Œï¼Œä¸è¢«æ‰“æ–­.</li>
</ul>
<p>å¯èƒ½è¦å…ˆäº†è§£ä¸€ä¸‹Reactè°ƒåº¦(Schedule)çš„ä¼˜å…ˆçº§ï¼Œæ‰èƒ½ç†è§£è¿™ä¸‰ç§äº‹ä»¶ç±»å‹çš„åŒºåˆ«ã€‚æˆªæ­¢åˆ°æœ¬æ–‡å†™ä½œæ—¶ï¼ŒReactæœ‰5ä¸ªä¼˜å…ˆçº§çº§åˆ«:</p>
<ul>
<li><code>Immediate</code> - è¿™ä¸ªä¼˜å…ˆçº§çš„ä»»åŠ¡ä¼šåŒæ­¥æ‰§è¡Œ, æˆ–è€…è¯´è¦é©¬ä¸Šæ‰§è¡Œä¸”ä¸èƒ½ä¸­æ–­</li>
<li><code>UserBlocking</code>(250ms timeout) è¿™äº›ä»»åŠ¡ä¸€èˆ¬æ˜¯ç”¨æˆ·äº¤äº’çš„ç»“æœ, éœ€è¦å³æ—¶å¾—åˆ°åé¦ˆ .</li>
<li><code>Normal</code> (5s timeout) åº”å¯¹å“ªäº›ä¸éœ€è¦ç«‹å³æ„Ÿå—åˆ°çš„ä»»åŠ¡ï¼Œä¾‹å¦‚ç½‘ç»œè¯·æ±‚</li>
<li><code>Low</code> (10s timeout) è¿™äº›ä»»åŠ¡å¯ä»¥æ”¾åï¼Œä½†æ˜¯æœ€ç»ˆåº”è¯¥å¾—åˆ°æ‰§è¡Œ. ä¾‹å¦‚åˆ†æé€šçŸ¥</li>
<li><code>Idle</code> (no timeout) ä¸€äº›æ²¡æœ‰å¿…è¦åšçš„ä»»åŠ¡ (e.g. æ¯”å¦‚éšè—çš„å†…å®¹).</li>
</ul>
<p>ç›®å‰ContinuousEventå¯¹åº”çš„æ˜¯Immediateä¼˜å…ˆçº§; UserBlockingEventå¯¹åº”çš„æ˜¯UserBlocking(éœ€è¦æ‰‹åŠ¨å¼€å¯); è€ŒDiscreteEventå¯¹åº”çš„ä¹Ÿæ˜¯UserBlocking, åªä¸è¿‡å®ƒåœ¨æ‰§è¡Œä¹‹å‰ï¼Œå…ˆä¼šæ‰§è¡Œå®Œå…¶ä»–Discreteä»»åŠ¡ã€‚</p>
<p>æœ¬æ–‡ä¸ä¼šæ·±å…¥React Fiberæ¶æ„çš„ç»†èŠ‚ï¼Œæœ‰å…´è¶£çš„è¯»è€…å¯ä»¥é˜…è¯»æ–‡æœ«çš„æ‰©å±•é˜…è¯»åˆ—è¡¨.</p>
<p><br><br><br></p>
<h2 id="å®ç°ç»†èŠ‚"><a href="#å®ç°ç»†èŠ‚" class="headerlink" title="å®ç°ç»†èŠ‚"></a>å®ç°ç»†èŠ‚</h2><p>ç°åœ¨å¼€å§‹è¿›å…¥æ–‡ç« æ­£é¢˜ï¼ŒReactæ˜¯æ€ä¹ˆå®ç°äº‹ä»¶æœºåˆ¶ï¼Ÿä¸»è¦åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†: <strong>ç»‘å®š</strong>å’Œ<strong>åˆ†å‘</strong>.</p>
<h3 id="äº‹ä»¶æ˜¯å¦‚ä½•ç»‘å®šçš„ï¼Ÿ"><a href="#äº‹ä»¶æ˜¯å¦‚ä½•ç»‘å®šçš„ï¼Ÿ" class="headerlink" title="äº‹ä»¶æ˜¯å¦‚ä½•ç»‘å®šçš„ï¼Ÿ"></a>äº‹ä»¶æ˜¯å¦‚ä½•ç»‘å®šçš„ï¼Ÿ</h3><p>ä¸ºäº†é¿å…åé¢ç»•æ™•äº†ï¼Œæœ‰å¿…è¦å…ˆäº†è§£ä¸€ä¸‹Reactäº‹ä»¶æœºåˆ¶ä¸­çš„æ’ä»¶åè®®ã€‚ æ¯ä¸ªæ’ä»¶çš„ç»“æ„å¦‚ä¸‹:</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> EventTypes = &#123;[key: <span class="built_in">string</span>]: DispatchConfig&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ’ä»¶æ¥å£</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> PluginModule&lt;NativeEvent&gt; = &#123;</span><br><span class="line">  eventTypes: EventTypes,          <span class="comment">// å£°æ˜æ’ä»¶æ”¯æŒçš„äº‹ä»¶ç±»å‹</span></span><br><span class="line">  extractEvents: (                 <span class="comment">// å¯¹äº‹ä»¶è¿›è¡Œå¤„ç†ï¼Œå¹¶è¿”å›åˆæˆäº‹ä»¶å¯¹è±¡</span></span><br><span class="line">    topLevelType: TopLevelType,</span><br><span class="line">    targetInst: <span class="literal">null</span> | Fiber,</span><br><span class="line">    nativeEvent: NativeEvent,</span><br><span class="line">    nativeEventTarget: EventTarget,</span><br><span class="line">  ) =&gt; ?ReactSyntheticEvent,</span><br><span class="line">  tapMoveThreshold?: <span class="built_in">number</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><br></p>
<p><strong>eventTypes</strong>å£°æ˜è¯¥æ’ä»¶è´Ÿè´£çš„äº‹ä»¶ç±»å‹, å®ƒé€šè¿‡<code>DispatchConfig</code>æ¥æè¿°:</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> DispatchConfig = &#123;</span><br><span class="line">  dependencies: <span class="built_in">Array</span>&lt;TopLevelType&gt;, <span class="comment">// ä¾èµ–çš„åŸç”Ÿäº‹ä»¶ï¼Œè¡¨ç¤ºå…³è”è¿™äº›äº‹ä»¶çš„è§¦å‘. â€˜ç®€å•äº‹ä»¶â€™ä¸€èˆ¬åªæœ‰ä¸€ä¸ªï¼Œå¤æ‚äº‹ä»¶å¦‚onChangeä¼šç›‘å¬å¤šä¸ª, å¦‚ä¸‹å›¾ğŸ‘‡</span></span><br><span class="line">  phasedRegistrationNames?: &#123;    <span class="comment">// ä¸¤é˜¶æ®µpropsäº‹ä»¶æ³¨å†Œåç§°, Reactä¼šæ ¹æ®è¿™äº›åç§°åœ¨ç»„ä»¶å®ä¾‹ä¸­æŸ¥æ‰¾å¯¹åº”çš„propsäº‹ä»¶å¤„ç†å™¨</span></span><br><span class="line">    bubbled: <span class="built_in">string</span>,             <span class="comment">// å†’æ³¡é˜¶æ®µ, å¦‚onClick</span></span><br><span class="line">    captured: <span class="built_in">string</span>,            <span class="comment">// æ•è·é˜¶æ®µï¼Œå¦‚onClickCapture</span></span><br><span class="line">  &#125;,</span><br><span class="line">  registrationName?: <span class="built_in">string</span>      <span class="comment">// propsäº‹ä»¶æ³¨å†Œåç§°, æ¯”å¦‚onMouseEnterè¿™äº›ä¸æ”¯æŒå†’æ³¡çš„äº‹ä»¶ç±»å‹ï¼Œåªä¼šå®šä¹‰  registrationNameï¼Œä¸ä¼šå®šä¹‰phasedRegistrationNames</span></span><br><span class="line">  eventPriority: EventPriority,  <span class="comment">// äº‹ä»¶çš„ä¼˜å…ˆçº§ï¼Œä¸Šæ–‡å·²ç»ä»‹ç»è¿‡äº†</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><br></p>
<p>çœ‹ä¸€ä¸‹å®ä¾‹:</p>
<p><img src="/images/react-event/dispatch-config.png" alt></p>
<p>ä¸Šé¢åˆ—ä¸¾äº†ä¸‰ä¸ªå…¸å‹çš„EventPluginï¼š</p>
<ul>
<li><p><strong>SimpleEventPlugin</strong> - ç®€å•äº‹ä»¶æœ€å¥½ç†è§£ï¼Œå®ƒä»¬çš„è¡Œä¸ºéƒ½æ¯”è¾ƒé€šç”¨ï¼Œæ²¡æœ‰ä»€ä¹ˆTrick, ä¾‹å¦‚ä¸æ”¯æŒäº‹ä»¶å†’æ³¡ã€ä¸æ”¯æŒåœ¨Documentä¸Šç»‘å®šç­‰ç­‰. å’ŒåŸç”ŸDOMäº‹ä»¶æ˜¯ä¸€ä¸€å¯¹åº”çš„å…³ç³»ï¼Œæ¯”è¾ƒå¥½å¤„ç†.</p>
</li>
<li><p><strong>EnterLeaveEventPlugin</strong> - ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºæ¥ï¼Œ<code>mouseEnter</code>å’Œ<code>mouseLeave</code>ä¾èµ–çš„æ˜¯<code>mouseout</code>å’Œ<code>mouseover</code>äº‹ä»¶ã€‚ä¹Ÿå°±æ˜¯è¯´<code>*Enter/*Leave</code>äº‹ä»¶åœ¨Reactä¸­æ˜¯é€šè¿‡<code>*Over/*Out</code>äº‹ä»¶æ¥æ¨¡æ‹Ÿçš„ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯å¯ä»¥åœ¨documentä¸Šé¢è¿›è¡Œå§”æ‰˜ç›‘å¬ï¼Œè¿˜æœ‰é¿å…<code>*Enter/*Leave</code>ä¸€äº›å¥‡æ€ªè€Œä¸å®ç”¨çš„è¡Œä¸ºã€‚</p>
</li>
<li><p><strong>ChangeEventPlugin</strong> - onChangeæ˜¯Reactçš„ä¸€ä¸ªè‡ªå®šä¹‰äº‹ä»¶ï¼Œå¯ä»¥çœ‹å‡ºå®ƒä¾èµ–äº†å¤šç§åŸç”ŸDOMäº‹ä»¶ç±»å‹æ¥æ¨¡æ‹ŸonChangeäº‹ä»¶.</p>
</li>
</ul>
<p><br></p>
<p>å¦å¤–æ¯ä¸ªæ’ä»¶è¿˜ä¼šå®šä¹‰<code>extractEvents</code>æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æ¥å—äº‹ä»¶åç§°ã€åŸç”ŸDOMäº‹ä»¶å¯¹è±¡ã€äº‹ä»¶è§¦å‘çš„DOMå…ƒç´ ä»¥åŠReactç»„ä»¶å®ä¾‹, è¿”å›ä¸€ä¸ªåˆæˆäº‹ä»¶å¯¹è±¡ï¼Œå¦‚æœè¿”å›ç©ºåˆ™è¡¨ç¤ºä¸ä½œå¤„ç†. å…³äºextractEventsçš„ç»†èŠ‚ä¼šåœ¨ä¸‹ä¸€èŠ‚é˜è¿°.</p>
<p><br></p>
<p>åœ¨ReactDOMå¯åŠ¨æ—¶å°±ä¼šå‘<code>EventPluginHub</code>æ³¨å†Œè¿™äº›æ’ä»¶ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">EventPluginHubInjection.injectEventPluginsByName(&#123;</span><br><span class="line">  SimpleEventPlugin: SimpleEventPlugin,</span><br><span class="line">  EnterLeaveEventPlugin: EnterLeaveEventPlugin,</span><br><span class="line">  ChangeEventPlugin: ChangeEventPlugin,</span><br><span class="line">  SelectEventPlugin: SelectEventPlugin,</span><br><span class="line">  BeforeInputEventPlugin: BeforeInputEventPlugin,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><br></p>
<p>Ok, å›åˆ°æ­£é¢˜ï¼Œäº‹ä»¶æ˜¯æ€ä¹ˆç»‘å®šçš„å‘¢ï¼Ÿ æ‰“ä¸ªæ–­ç‚¹çœ‹ä¸€ä¸‹è°ƒç”¨æ ˆ:</p>
<p><img src="/images/react-event/listento.png" alt></p>
<p>å‰é¢è°ƒç”¨æ ˆå…³äºReactæ ‘å¦‚ä½•æ›´æ–°å’Œæ¸²æŸ“å°±ä¸åœ¨æœ¬æ–‡çš„èŒƒå›´å†…äº†ï¼Œé€šè¿‡è°ƒç”¨æ ˆå¯ä»¥çœ‹å‡ºReactåœ¨propsåˆå§‹åŒ–å’Œæ›´æ–°æ—¶ä¼šè¿›è¡Œäº‹ä»¶ç»‘å®šã€‚è¿™é‡Œå…ˆçœ‹ä¸€ä¸‹æµç¨‹å›¾ï¼Œå¿½ç•¥æ‚ä¹±çš„è·³è½¬ï¼š</p>
<p><img src="/images/react-event/binding.png" alt></p>
<ul>
<li><strong>1. åœ¨propsåˆå§‹åŒ–å’Œæ›´æ–°æ—¶ä¼šè¿›è¡Œäº‹ä»¶ç»‘å®š</strong>ã€‚é¦–å…ˆReactä¼šåˆ¤æ–­å…ƒç´ æ˜¯å¦æ˜¯<code>åª’ä½“ç±»å‹</code>ï¼Œ<strong>åª’ä½“ç±»å‹çš„äº‹ä»¶æ˜¯æ— æ³•åœ¨Documentç›‘å¬çš„ï¼Œæ‰€ä»¥ä¼šç›´æ¥åœ¨å…ƒç´ ä¸Šè¿›è¡Œç»‘å®š</strong></li>
<li><strong>2. åä¹‹å°±åœ¨Documentä¸Šç»‘å®š</strong>. è¿™é‡Œé¢éœ€è¦ä¸¤ä¸ªä¿¡æ¯ï¼Œä¸€ä¸ªå°±æ˜¯ä¸Šæ–‡æåˆ°çš„â€™äº‹ä»¶ä¾èµ–åˆ—è¡¨â€™, æ¯”å¦‚<code>onMouseEnter</code>ä¾èµ–<code>mouseover/mouseout</code>; ç¬¬äºŒä¸ªæ˜¯ReactBrowserEventEmitterç»´æŠ¤çš„â€™å·²è®¢é˜…äº‹ä»¶è¡¨â€™ã€‚<strong>äº‹ä»¶å¤„ç†å™¨åªéœ€åœ¨Documentè®¢é˜…ä¸€æ¬¡ï¼Œæ‰€ä»¥ç›¸æ¯”åœ¨æ¯ä¸ªå…ƒç´ ä¸Šè®¢é˜…äº‹ä»¶ä¼šèŠ‚çœå¾ˆå¤šèµ„æº</strong>.</li>
</ul>
<p>ä»£ç å¤§æ¦‚å¦‚ä¸‹:</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">listenTo</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  registrationName: <span class="built_in">string</span>,           <span class="comment">// æ³¨å†Œåç§°ï¼Œå¦‚onClick</span></span></span></span><br><span class="line"><span class="function"><span class="params">  mountAt: Document | Element | Node, <span class="comment">// ç»„ä»¶æ ‘å®¹å™¨ï¼Œä¸€èˆ¬æ˜¯Document</span></span></span></span><br><span class="line"><span class="function"><span class="params"></span>): <span class="title">void</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> listeningSet = getListeningSetForElement(mountAt);             <span class="comment">// å·²è®¢é˜…äº‹ä»¶è¡¨</span></span><br><span class="line">  <span class="keyword">const</span> dependencies = registrationNameDependencies[registrationName]; <span class="comment">// äº‹ä»¶ä¾èµ–</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; dependencies.length; i++) &#123;</span><br><span class="line">    <span class="keyword">const</span> dependency = dependencies[i];</span><br><span class="line">    <span class="keyword">if</span> (!listeningSet.has(dependency)) &#123;                               <span class="comment">// æœªè®¢é˜…</span></span><br><span class="line">      <span class="keyword">switch</span> (dependency) &#123;</span><br><span class="line">        <span class="comment">// ... ç‰¹æ®Šçš„äº‹ä»¶ç›‘å¬å¤„ç†</span></span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">          <span class="keyword">const</span> isMediaEvent = mediaEventTypes.indexOf(dependency) !== <span class="number">-1</span>;</span><br><span class="line">          <span class="keyword">if</span> (!isMediaEvent) &#123;</span><br><span class="line">            trapBubbledEvent(dependency, mountAt);                     <span class="comment">// è®¾ç½®äº‹ä»¶å¤„ç†å™¨</span></span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      listeningSet.add(dependency);                                    <span class="comment">// æ›´æ–°å·²è®¢é˜…è¡¨</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>æ¥ä¸‹æ¥å°±æ˜¯æ ¹æ®äº‹ä»¶çš„â€™ä¼˜å…ˆçº§â€™å’Œâ€™æ•è·é˜¶æ®µâ€™(æ˜¯å¦æ˜¯capture)æ¥è®¾ç½®äº‹ä»¶å¤„ç†å™¨</strong>:</li>
</ul>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">trapEventForPluginEventSystem</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  element: Document | Element | Node,   <span class="comment">// ç»‘å®šåˆ°å…ƒç´ ï¼Œä¸€èˆ¬æ˜¯Document</span></span></span></span><br><span class="line"><span class="function"><span class="params">  topLevelType: DOMTopLevelEventType,   <span class="comment">// äº‹ä»¶åç§°</span></span></span></span><br><span class="line"><span class="function"><span class="params">  capture: <span class="built_in">boolean</span>,</span></span></span><br><span class="line"><span class="function"><span class="params"></span>): <span class="title">void</span> </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> listener;</span><br><span class="line">  <span class="keyword">switch</span> (getEventPriority(topLevelType)) &#123;</span><br><span class="line">    <span class="comment">// ä¸åŒä¼˜å…ˆçº§çš„äº‹ä»¶ç±»å‹ï¼Œæœ‰ä¸åŒçš„äº‹ä»¶å¤„ç†å™¨è¿›è¡Œåˆ†å‘, ä¸‹æ–‡ä¼šè¯¦ç»†ä»‹ç»</span></span><br><span class="line">    <span class="keyword">case</span> DiscreteEvent:                      <span class="comment">// âš›ï¸ç¦»æ•£äº‹ä»¶</span></span><br><span class="line">      listener = dispatchDiscreteEvent.bind(</span><br><span class="line">        <span class="literal">null</span>,</span><br><span class="line">        topLevelType,</span><br><span class="line">        PLUGIN_EVENT_SYSTEM,</span><br><span class="line">      );</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> UserBlockingEvent:                 <span class="comment">// âš›ï¸ç”¨æˆ·é˜»å¡äº‹ä»¶</span></span><br><span class="line">      listener = dispatchUserBlockingUpdate.bind(</span><br><span class="line">        <span class="literal">null</span>,</span><br><span class="line">        topLevelType,</span><br><span class="line">        PLUGIN_EVENT_SYSTEM,</span><br><span class="line">      );</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> ContinuousEvent:                   <span class="comment">// âš›ï¸å¯è¿ç»­äº‹ä»¶</span></span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      listener = dispatchEvent.bind(<span class="literal">null</span>, topLevelType, PLUGIN_EVENT_SYSTEM);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> rawEventName = getRawEventName(topLevelType);</span><br><span class="line">  <span class="keyword">if</span> (capture) &#123;                            <span class="comment">// ç»‘å®šäº‹ä»¶å¤„ç†å™¨åˆ°å…ƒç´ </span></span><br><span class="line">    addEventCaptureListener(element, rawEventName, listener);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    addEventBubbleListener(element, rawEventName, listener);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>äº‹ä»¶ç»‘å®šçš„è¿‡ç¨‹è¿˜æ¯”è¾ƒç®€å•, æ¥ä¸‹æ¥çœ‹çœ‹äº‹ä»¶æ˜¯å¦‚ä½•åˆ†å‘çš„ã€‚</p>
<p><br></p>
<h3 id="äº‹ä»¶æ˜¯å¦‚ä½•åˆ†å‘çš„ï¼Ÿ"><a href="#äº‹ä»¶æ˜¯å¦‚ä½•åˆ†å‘çš„ï¼Ÿ" class="headerlink" title="äº‹ä»¶æ˜¯å¦‚ä½•åˆ†å‘çš„ï¼Ÿ"></a>äº‹ä»¶æ˜¯å¦‚ä½•åˆ†å‘çš„ï¼Ÿ</h3><p>æŒ‰æƒ¯ä¾‹è¿˜æ˜¯å…ˆä¸Šæµç¨‹å›¾:</p>
<p><img src="/images/react-event/binding.png" alt></p>
<h4 id="äº‹ä»¶è§¦å‘è°ƒåº¦"><a href="#äº‹ä»¶è§¦å‘è°ƒåº¦" class="headerlink" title="äº‹ä»¶è§¦å‘è°ƒåº¦"></a>äº‹ä»¶è§¦å‘è°ƒåº¦</h4><p>é€šè¿‡ä¸Šé¢çš„<code>trapEventForPluginEventSystem</code>å‡½æ•°å¯ä»¥çŸ¥é“ï¼Œä¸åŒçš„äº‹ä»¶ç±»å‹æœ‰ä¸åŒçš„äº‹ä»¶å¤„ç†å™¨, å®ƒä»¬çš„åŒºåˆ«æ˜¯è°ƒåº¦çš„ä¼˜å…ˆçº§ä¸ä¸€æ ·:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ç¦»æ•£äº‹ä»¶</span></span><br><span class="line"><span class="comment">// discrentUpdates åœ¨UserBlockingä¼˜å…ˆçº§ä¸­æ‰§è¡Œ</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dispatchDiscreteEvent</span>(<span class="params">topLevelType, eventSystemFlags, nativeEvent</span>) </span>&#123;</span><br><span class="line">  flushDiscreteUpdatesIfNeeded(nativeEvent.timeStamp);</span><br><span class="line">  discreteUpdates(dispatchEvent, topLevelType, eventSystemFlags, nativeEvent);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é˜»å¡äº‹ä»¶</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dispatchUserBlockingUpdate</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  topLevelType,</span></span></span><br><span class="line"><span class="function"><span class="params">  eventSystemFlags,</span></span></span><br><span class="line"><span class="function"><span class="params">  nativeEvent,</span></span></span><br><span class="line"><span class="function"><span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// å¦‚æœå¼€å¯äº†enableUserBlockingEvents, åˆ™åœ¨UserBlockingä¼˜å…ˆçº§ä¸­è°ƒåº¦ï¼Œ</span></span><br><span class="line">  <span class="comment">// å¼€å¯enableUserBlockingEventså¯ä»¥é˜²æ­¢é¥¥é¥¿é—®é¢˜ï¼Œå› ä¸ºé˜»å¡äº‹ä»¶ä¸­æœ‰scrollã€mouseMoveè¿™ç±»é¢‘ç¹è§¦å‘çš„äº‹ä»¶</span></span><br><span class="line">  <span class="comment">// å¦åˆ™åŒæ­¥æ‰§è¡Œ</span></span><br><span class="line">  <span class="keyword">if</span> (enableUserBlockingEvents) &#123;</span><br><span class="line">    runWithPriority(</span><br><span class="line">      UserBlockingPriority,</span><br><span class="line">      dispatchEvent.bind(<span class="literal">null</span>, topLevelType, eventSystemFlags, nativeEvent),</span><br><span class="line">    );</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    dispatchEvent(topLevelType, eventSystemFlags, nativeEvent);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯è¿ç»­äº‹ä»¶åˆ™ç›´æ¥åŒæ­¥è°ƒç”¨dispatchEvent</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p>æœ€ç»ˆä¸åŒçš„äº‹ä»¶ç±»å‹éƒ½ä¼šè°ƒç”¨<code>dispatchEvent</code>å‡½æ•°. <code>dispatchEvent</code>ä¸­ä¼šä»DOMåŸç”Ÿäº‹ä»¶å¯¹è±¡è·å–äº‹ä»¶è§¦å‘çš„targetï¼Œå†æ ¹æ®è¿™ä¸ªtargetè·å–å…³è”çš„ReactèŠ‚ç‚¹å®ä¾‹.</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">dispatchEvent</span>(<span class="params">topLevelType: DOMTopLevelEventType, eventSystemFlags: EventSystemFlags, nativeEvent: AnyNativeEvent</span>): <span class="title">void</span> </span>&#123;</span><br><span class="line">  <span class="comment">// è·å–äº‹ä»¶è§¦å‘çš„ç›®æ ‡DOM</span></span><br><span class="line">  <span class="keyword">const</span> nativeEventTarget = getEventTarget(nativeEvent);</span><br><span class="line">  <span class="comment">// è·å–ç¦»è¯¥DOMæœ€è¿‘çš„ç»„ä»¶å®ä¾‹(åªèƒ½æ˜¯DOMå…ƒç´ ç»„ä»¶)</span></span><br><span class="line">  <span class="keyword">let</span> targetInst = getClosestInstanceFromNode(nativeEventTarget);</span><br><span class="line">  <span class="comment">// ....</span></span><br><span class="line">  dispatchEventForPluginEventSystem(topLevelType, eventSystemFlags, nativeEvent, targetInst);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br></p>
<p>æ¥ç€(ä¸­é—´è¿˜æœ‰ä¸€äº›æ­¥éª¤ï¼Œè¿™é‡Œå¿½ç•¥)ä¼šè°ƒç”¨<code>EventPluginHub</code>çš„<code>runExtractedPluginEventsInBatch</code>ï¼Œè¿™ä¸ªæ–¹æ³•éå†æ’ä»¶åˆ—è¡¨æ¥å¤„ç†äº‹ä»¶ï¼Œç”Ÿæˆä¸€ä¸ªSyntheticEventåˆ—è¡¨:</p>
<figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">runExtractedPluginEventsInBatch</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  topLevelType: TopLevelType,</span></span></span><br><span class="line"><span class="function"><span class="params">  targetInst: <span class="literal">null</span> | Fiber,</span></span></span><br><span class="line"><span class="function"><span class="params">  nativeEvent: AnyNativeEvent,</span></span></span><br><span class="line"><span class="function"><span class="params">  nativeEventTarget: EventTarget,</span></span></span><br><span class="line"><span class="function"><span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// éå†æ’ä»¶åˆ—è¡¨, è°ƒç”¨æ’ä»¶çš„extractEventsï¼Œç”ŸæˆSyntheticEventåˆ—è¡¨</span></span><br><span class="line">  <span class="keyword">const</span> events = extractPluginEvents(</span><br><span class="line">    topLevelType,</span><br><span class="line">    targetInst,</span><br><span class="line">    nativeEvent,</span><br><span class="line">    nativeEventTarget,</span><br><span class="line">  );</span><br><span class="line"></span><br><span class="line">  <span class="comment">// äº‹ä»¶å¤„ç†å™¨æ‰§è¡Œ, è§åæ–‡æ‰¹é‡æ‰§è¡Œ</span></span><br><span class="line">  runEventsInBatch(events);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br></p>
<h4 id="æ’ä»¶æ˜¯å¦‚ä½•å¤„ç†äº‹ä»¶"><a href="#æ’ä»¶æ˜¯å¦‚ä½•å¤„ç†äº‹ä»¶" class="headerlink" title="æ’ä»¶æ˜¯å¦‚ä½•å¤„ç†äº‹ä»¶?"></a>æ’ä»¶æ˜¯å¦‚ä½•å¤„ç†äº‹ä»¶?</h4><p>ç°åœ¨æ¥çœ‹çœ‹æ’ä»¶æ˜¯å¦‚ä½•å¤„ç†äº‹ä»¶çš„ï¼Œæˆ‘ä»¬ä»¥<code>SimpleEventPlugin</code>ä¸ºä¾‹:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> SimpleEventPlugin: PluginModule&lt;MouseEvent&gt; &amp; &#123;</span><br><span class="line">  getEventPriority: <span class="function">(<span class="params">topLevelType: TopLevelType</span>) =&gt;</span> EventPriority,</span><br><span class="line">&#125; = &#123;</span><br><span class="line">  eventTypes: eventTypes,</span><br><span class="line">  <span class="comment">// æŠ½å–äº‹ä»¶å¯¹è±¡</span></span><br><span class="line">  extractEvents: <span class="function"><span class="keyword">function</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">    topLevelType: TopLevelType,</span></span></span><br><span class="line"><span class="function"><span class="params">    targetInst: null | Fiber,</span></span></span><br><span class="line"><span class="function"><span class="params">    nativeEvent: MouseEvent,</span></span></span><br><span class="line"><span class="function"><span class="params">    nativeEventTarget: EventTarget,</span></span></span><br><span class="line"><span class="function"><span class="params">  </span>): <span class="title">null</span> | <span class="title">ReactSyntheticEvent</span> </span>&#123;</span><br><span class="line">    <span class="comment">// äº‹ä»¶é…ç½®</span></span><br><span class="line">    <span class="keyword">const</span> dispatchConfig = topLevelEventsToDispatchConfig[topLevelType];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1ï¸âƒ£ æ ¹æ®äº‹ä»¶ç±»å‹è·å–SyntheticEventå­ç±»äº‹ä»¶æ„é€ å™¨</span></span><br><span class="line">    <span class="keyword">let</span> EventConstructor;</span><br><span class="line">    <span class="keyword">switch</span> (topLevelType) &#123;</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">      <span class="keyword">case</span> DOMTopLevelEventTypes.TOP_KEY_DOWN:</span><br><span class="line">      <span class="keyword">case</span> DOMTopLevelEventTypes.TOP_KEY_UP:</span><br><span class="line">        EventConstructor = SyntheticKeyboardEvent;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> DOMTopLevelEventTypes.TOP_BLUR:</span><br><span class="line">      <span class="keyword">case</span> DOMTopLevelEventTypes.TOP_FOCUS:</span><br><span class="line">        EventConstructor = SyntheticFocusEvent;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="comment">// ... çœç•¥</span></span><br><span class="line">      <span class="keyword">case</span> DOMTopLevelEventTypes.TOP_GOT_POINTER_CAPTURE:</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">      <span class="keyword">case</span> DOMTopLevelEventTypes.TOP_POINTER_UP:</span><br><span class="line">        EventConstructor = SyntheticPointerEvent;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        EventConstructor = SyntheticEvent;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2ï¸âƒ£ æ„é€ äº‹ä»¶å¯¹è±¡, ä»å¯¹è±¡æ± ä¸­è·å–</span></span><br><span class="line">    <span class="keyword">const</span> event = EventConstructor.getPooled(</span><br><span class="line">      dispatchConfig,</span><br><span class="line">      targetInst,</span><br><span class="line">      nativeEvent,</span><br><span class="line">      nativeEventTarget,</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3ï¸âƒ£ æ ¹æ®DOMäº‹ä»¶ä¼ æ’­çš„é¡ºåºè·å–ç”¨æˆ·äº‹ä»¶å¤„ç†å™¨</span></span><br><span class="line">    accumulateTwoPhaseDispatches(event);</span><br><span class="line">    <span class="keyword">return</span> event;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><code>SimpleEventPlugin</code>çš„<code>extractEvents</code>ä¸»è¦åšä»¥ä¸‹ä¸‰ä¸ªäº‹æƒ…:</p>
<ul>
<li>1ï¸âƒ£ æ ¹æ®äº‹ä»¶çš„ç±»å‹ç¡®å®šSyntheticEventæ„é€ å™¨</li>
<li>2ï¸âƒ£ æ„é€ SyntheticEventå¯¹è±¡ã€‚</li>
<li>3ï¸âƒ£ æ ¹æ®DOMäº‹ä»¶ä¼ æ’­çš„é¡ºåºè·å–ç”¨æˆ·äº‹ä»¶å¤„ç†å™¨åˆ—è¡¨</li>
</ul>
<p><br></p>
<p><strong>ä¸ºäº†é¿å…é¢‘ç¹åˆ›å»ºå’Œé‡Šæ”¾äº‹ä»¶å¯¹è±¡å¯¼è‡´æ€§èƒ½æŸè€—(å¯¹è±¡åˆ›å»ºå’Œåƒåœ¾å›æ”¶)ï¼ŒReactä½¿ç”¨ä¸€ä¸ªäº‹ä»¶æ± æ¥è´Ÿè´£ç®¡ç†äº‹ä»¶å¯¹è±¡ï¼Œä½¿ç”¨å®Œçš„äº‹ä»¶å¯¹è±¡ä¼šæ”¾å›æ± ä¸­ï¼Œä»¥å¤‡åç»­çš„å¤ç”¨</strong>ã€‚</p>
<p>è¿™ä¹Ÿæ„å‘³ç€ï¼Œ<strong>åœ¨äº‹ä»¶å¤„ç†å™¨åŒæ­¥æ‰§è¡Œå®Œåï¼ŒSyntheticEventå¯¹è±¡å°±ä¼šé©¬ä¸Šè¢«å›æ”¶</strong>ï¼Œæ‰€æœ‰å±æ€§éƒ½ä¼šæ— æ•ˆã€‚æ‰€ä»¥ä¸€èˆ¬ä¸ä¼šåœ¨å¼‚æ­¥æ“ä½œä¸­è®¿é—®SyntheticEventäº‹ä»¶å¯¹è±¡ã€‚ä½ ä¹Ÿå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹æ³•æ¥ä¿æŒäº‹ä»¶å¯¹è±¡çš„å¼•ç”¨ï¼š</p>
<ul>
<li>è°ƒç”¨<code>SyntheticEvent#persist()</code>æ–¹æ³•ï¼Œå‘Šè¯‰Reactä¸è¦å›æ”¶åˆ°å¯¹è±¡æ± </li>
<li>ç›´æ¥å¼•ç”¨<code>SyntheticEvent#nativeEvent</code>, nativeEventæ˜¯å¯ä»¥æŒä¹…å¼•ç”¨çš„ï¼Œä¸è¿‡ä¸ºäº†ä¸æ‰“ç ´æŠ½è±¡ï¼Œå»ºè®®ä¸è¦ç›´æ¥å¼•ç”¨nativeEvent</li>
</ul>
<p><br></p>
<p>æ„å»ºå®ŒSyntheticEventå¯¹è±¡åï¼Œå°±éœ€è¦<strong>éå†ç»„ä»¶æ ‘æ¥è·å–è®¢é˜…è¯¥äº‹ä»¶çš„ç”¨æˆ·äº‹ä»¶å¤„ç†å™¨</strong>äº†:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">accumulateTwoPhaseDispatchesSingle</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ä»¥_targetInstä¸ºåŸºç‚¹, æŒ‰ç…§DOMäº‹ä»¶ä¼ æ’­çš„é¡ºåºéå†ç»„ä»¶æ ‘</span></span><br><span class="line">  traverseTwoPhase(event._targetInst, accumulateDirectionalDispatches, event);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>éå†æ–¹æ³•å…¶å®å¾ˆç®€å•ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">traverseTwoPhase</span>(<span class="params">inst, fn, arg</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> path = [];</span><br><span class="line">  <span class="keyword">while</span> (inst) &#123;           <span class="comment">// ä»instå¼€å§‹ï¼Œå‘ä¸Šçº§å›æº¯</span></span><br><span class="line">    path.push(inst);</span><br><span class="line">    inst = getParent(inst);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> i;</span><br><span class="line">  <span class="comment">// æ•è·é˜¶æ®µï¼Œå…ˆä»æœ€é¡¶å±‚çš„çˆ¶ç»„ä»¶å¼€å§‹, å‘ä¸‹çº§ä¼ æ’­</span></span><br><span class="line">  <span class="keyword">for</span> (i = path.length; i-- &gt; <span class="number">0</span>; ) &#123;</span><br><span class="line">    fn(path[i], <span class="string">'captured'</span>, arg);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å†’æ³¡é˜¶æ®µï¼Œä»instï¼Œå³äº‹ä»¶è§¦å‘ç‚¹å¼€å§‹, å‘ä¸Šçº§ä¼ æ’­</span></span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; path.length; i++) &#123;</span><br><span class="line">    fn(path[i], <span class="string">'bubbled'</span>, arg);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>accumulateDirectionalDispatches</code>å‡½æ•°åˆ™æ˜¯ç®€å•æŸ¥æ‰¾å½“å‰èŠ‚ç‚¹æ˜¯å¦æœ‰å¯¹åº”çš„äº‹ä»¶å¤„ç†å™¨:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">accumulateDirectionalDispatches</span>(<span class="params">inst, phase, event</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// æ£€æŸ¥æ˜¯å¦å­˜åœ¨äº‹ä»¶å¤„ç†å™¨</span></span><br><span class="line">  <span class="keyword">const</span> listener = listenerAtPhase(inst, event, phase);</span><br><span class="line">  <span class="comment">// æ‰€æœ‰å¤„ç†å™¨éƒ½æ”¾å…¥åˆ°_dispatchListenersé˜Ÿåˆ—ä¸­ï¼Œåç»­æ‰¹é‡æ‰§è¡Œè¿™ä¸ªé˜Ÿåˆ—</span></span><br><span class="line">  <span class="keyword">if</span> (listener) &#123;</span><br><span class="line">    event._dispatchListeners = accumulateInto(</span><br><span class="line">      event._dispatchListeners,</span><br><span class="line">      listener,</span><br><span class="line">    );</span><br><span class="line">    event._dispatchInstances = accumulateInto(event._dispatchInstances, inst);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br></p>
<p>ä¾‹å¦‚ä¸‹é¢çš„ç»„ä»¶æ ‘, éå†è¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š</p>
<p><img src="/images/react-event/event-delivery.png" alt></p>
<p>æœ€ç»ˆè®¡ç®—å‡ºæ¥çš„<code>_dispatchListeners</code>é˜Ÿåˆ—æ˜¯è¿™æ ·çš„ï¼š<code>[handleB, handleC, handleA]</code></p>
<p><br></p>
<h4 id="æ‰¹é‡æ‰§è¡Œ"><a href="#æ‰¹é‡æ‰§è¡Œ" class="headerlink" title="æ‰¹é‡æ‰§è¡Œ"></a>æ‰¹é‡æ‰§è¡Œ</h4><p>éå†æ‰§è¡Œæ’ä»¶åï¼Œä¼šå¾—åˆ°ä¸€ä¸ªSyntheticEventåˆ—è¡¨ï¼Œ<code>runEventsInBatch</code>å°±æ˜¯æ‰¹é‡æ‰§è¡Œè¿™äº›äº‹ä»¶ä¸­çš„<code>_dispatchListeners</code>äº‹ä»¶é˜Ÿåˆ—</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">runEventsInBatch</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  events: Array&lt;ReactSyntheticEvent&gt; | ReactSyntheticEvent | null,</span></span></span><br><span class="line"><span class="function"><span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  forEachAccumulated(processingEventQueue, executeDispatchesAndRelease);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ğŸ‘‡</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> executeDispatchesAndRelease = <span class="function"><span class="keyword">function</span>(<span class="params">event: ReactSyntheticEvent</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (event) &#123;</span><br><span class="line">    <span class="comment">// æŒ‰é¡ºåºæ‰§è¡Œ_dispatchListeners</span></span><br><span class="line">    <span class="comment">// ğŸ‘‡</span></span><br><span class="line">    executeDispatchesInOrder(event);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¦‚æœæ²¡æœ‰è°ƒç”¨persist()æ–¹æ³•åˆ™ç›´æ¥å›æ”¶</span></span><br><span class="line">    <span class="keyword">if</span> (!event.isPersistent()) &#123;</span><br><span class="line">      event.constructor.release(event);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">executeDispatchesInOrder</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// éå†dispatchListeners</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; dispatchListeners.length; i++) &#123;</span><br><span class="line">    <span class="comment">// é€šè¿‡è°ƒç”¨ stopPropagation æ–¹æ³•å¯ä»¥ç¦æ­¢æ‰§è¡Œä¸‹ä¸€ä¸ªäº‹ä»¶å¤„ç†å™¨</span></span><br><span class="line">    <span class="keyword">if</span> (event.isPropagationStopped()) &#123;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ‰§è¡Œäº‹ä»¶å¤„ç†å™¨</span></span><br><span class="line">    executeDispatch(event, dispatchListeners[i], dispatchInstances[i]);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/images/react-event/dispatch.png" alt></p>
<p>OK, åˆ°è¿™é‡ŒReactçš„äº‹ä»¶æœºåˆ¶å°±åŸºæœ¬ä»‹ç»å®Œäº†ï¼Œè¿™é‡Œåªæ˜¯ç®€å•äº†ä»‹ç»äº†ä¸€ä¸‹<code>SimpleEventPlugin</code>, å®é™…ä»£ç ä¸­è¿˜æœ‰å¾ˆå¤šäº‹ä»¶å¤„ç†çš„ç»†èŠ‚ï¼Œé™äºç¯‡å¹…ï¼Œæœ¬æ–‡å°±ä¸å±•å¼€å»è®²äº†ã€‚æœ‰å…´è¶£çš„è¯»è€…å¯ä»¥äº²è‡ªå»è§‚æ‘©Reactçš„æºä»£ç .</p>
<p><br><br><br></p>
<h2 id="æœªæ¥"><a href="#æœªæ¥" class="headerlink" title="æœªæ¥"></a>æœªæ¥</h2><p>Reactå†…éƒ¨æœ‰ä¸€ä¸ªå®éªŒæ€§çš„äº‹ä»¶APIï¼ŒReactå†…éƒ¨ç§°ä¸º<code>React Flare</code>ã€æ­£å¼åç§°æ˜¯<a href="https://github.com/facebook/react/tree/master/packages/react-events" target="_blank" rel="noopener"><code>react-events</code></a>, <strong>é€šè¿‡è¿™ä¸ªAPIå¯ä»¥å®ç°è·¨å¹³å°ã€è·¨è®¾å¤‡çš„é«˜çº§äº‹ä»¶å°è£…</strong>.</p>
<p>react-eventså®šä¹‰äº†ä¸€ä¸ª<strong>äº‹ä»¶å“åº”å™¨(Event Responders)</strong>çš„æ¦‚å¿µï¼Œè¿™ä¸ªäº‹ä»¶å“åº”å™¨å¯ä»¥æ•è·å­ç»„ä»¶æ ‘æˆ–åº”ç”¨æ ¹èŠ‚ç‚¹çš„äº‹ä»¶ï¼Œç„¶åè½¬æ¢ä¸ºè‡ªå®šä¹‰äº‹ä»¶.</p>
<p>æ¯”è¾ƒå…¸å‹çš„é«˜çº§äº‹ä»¶æ˜¯pressã€longPressã€swipeè¿™äº›æ‰‹åŠ¿ã€‚é€šå¸¸æˆ‘ä»¬éœ€è¦è‡ªå·±æˆ–è€…åˆ©ç”¨ç¬¬ä¸‰æ–¹åº“æ¥å®ç°è¿™ä¸€å¥—æ‰‹åŠ¿è¯†åˆ«, ä¾‹å¦‚</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Gesture <span class="keyword">from</span> <span class="string">'rc-gesture'</span>;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(</span><br><span class="line">  &lt;Gesture</span><br><span class="line">    onTap=&#123;handleTap&#125;</span><br><span class="line">    onSwipe=&#123;onSwipe&#125;</span><br><span class="line">    onPinch=&#123;handlePinch&#125;</span><br><span class="line">  &gt;</span><br><span class="line">    &lt;div&gt;container&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>Gesture&gt;,</span><br><span class="line">container);</span><br></pre></td></tr></table></figure>
<p><br></p>
<p>é‚£ä¹ˆreact-eventsçš„ç›®çš„å°±æ˜¯<strong>æä¾›ä¸€å¥—é€šç”¨çš„äº‹ä»¶æœºåˆ¶ç»™å¼€å‘è€…æ¥å®ç°â€™é«˜çº§äº‹ä»¶â€™çš„å°è£…, ç”šè‡³å®ç°äº‹ä»¶çš„è·¨å¹³å°ã€è·¨è®¾å¤‡</strong>, ç°åœ¨ä½ å¯ä»¥é€šè¿‡react-eventsæ¥å°è£…è¿™äº›æ‰‹åŠ¿äº‹ä»¶.</p>
<p>react-eventsé™¤äº†æ ¸å¿ƒçš„<code>Responder</code>æ¥å£ï¼Œè¿˜å°è£…äº†ä¸€äº›å†…ç½®æ¨¡å—, å®ç°è·¨å¹³å°çš„ã€å¸¸ç”¨çš„é«˜çº§äº‹ä»¶å°è£…ï¼š</p>
<ul>
<li>Focus module</li>
<li>Hover module</li>
<li>Press module</li>
<li>FocusScope module</li>
<li>Input module</li>
<li>KeyBoard module</li>
<li>Drag module</li>
<li>Pan module</li>
<li>Scroll module</li>
<li>Swipe module</li>
</ul>
<p>ä¸¾<code>Press</code>æ¨¡å—ä½œä¸ºä¾‹å­, <a href="https://github.com/facebook/react/blob/master/packages/react-events/docs/Press.md" target="_blank" rel="noopener">Pressæ¨¡å—</a>ä¼šå“åº”å®ƒåŒ…è£¹çš„å…ƒç´ çš„pressäº‹ä»¶ã€‚pressäº‹ä»¶åŒ…æ‹¬onContextMenuã€onLongPressã€onPressã€onPressEndã€onPressMoveã€onPressStartç­‰ç­‰. å…¶åº•å±‚é€šè¿‡mouseã€penã€touchã€trackpadç­‰äº‹ä»¶æ¥è½¬æ¢.</p>
<p>çœ‹çœ‹ä½¿ç”¨ç¤ºä¾‹ï¼š</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; PressResponder, usePressListener &#125; <span class="keyword">from</span> <span class="string">'react-events/press'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Button = <span class="function">(<span class="params">props</span>) =&gt;</span> (</span><br><span class="line">  <span class="keyword">const</span> listener = usePressListener(&#123;  <span class="comment">// âš›ï¸é€šè¿‡hooksåˆ›å»ºResponder</span></span><br><span class="line">    onPressStart,</span><br><span class="line">    onPress,</span><br><span class="line">    onPressEnd,</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div listeners=&#123;listener&#125;&gt;</span><br><span class="line">      &#123;subtrees&#125;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">);</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p>react-eventsçš„è¿ä½œæµç¨‹å›¾å¦‚ä¸‹, <strong>äº‹ä»¶å“åº”å™¨(Event Responders)ä¼šæŒ‚è½½åˆ°hostèŠ‚ç‚¹ï¼Œå®ƒä¼šåœ¨hostèŠ‚ç‚¹ç›‘å¬hostæˆ–å­èŠ‚ç‚¹åˆ†å‘çš„åŸç”Ÿäº‹ä»¶(DOMæˆ–React Native), å¹¶å°†å®ƒä»¬è½¬æ¢/åˆå¹¶æˆé«˜çº§çš„äº‹ä»¶</strong>:</p>
<p><img src="/images/react-event/responder.png" alt></p>
<p><br></p>
<blockquote>
<p>ä½ å¯ä»¥é€šè¿‡è¿™ä¸ªCodesanboxç©ä¸€ä¸‹<code>react-events</code>: <a href="https://codesandbox.io/s/github/ivan-94/react-events-playground" target="_blank" rel="noopener"><img src="https://codesandbox.io/static/img/play-codesandbox.svg" alt="Edit react-events-playground"></a></p>
</blockquote>
<p><br></p>
<h3 id="åˆæ¢responderçš„åˆ›å»º"><a href="#åˆæ¢responderçš„åˆ›å»º" class="headerlink" title="åˆæ¢Responderçš„åˆ›å»º"></a>åˆæ¢Responderçš„åˆ›å»º</h3><p>æˆ‘ä»¬æŒ‘ä¸€ä¸ªç®€å•çš„æ¨¡å—æ¥äº†è§£ä¸€äº›react-eventsçš„æ ¸å¿ƒAPI, ç›®å‰æœ€ç®€å•çš„æ˜¯Keyboardæ¨¡å—. Keyboardæ¨¡å—çš„ç›®çš„å°±æ˜¯è§„èŒƒåŒ–keydownå’Œkeyupäº‹ä»¶å¯¹è±¡çš„keyå±æ€§(éƒ¨åˆ†æµè§ˆå™¨keyå±æ€§çš„è¡Œä¸ºä¸ä¸€æ ·)ï¼Œå®ƒçš„å®ç°å¦‚ä¸‹:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å®šä¹‰Responderçš„å®ç°</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> keyboardResponderImpl = &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 1ï¸âƒ£å®šä¹‰Responderéœ€è¦ç›‘å¬çš„å­æ ‘çš„DOMäº‹ä»¶ï¼Œå¯¹äºKeyboardæ¥è¯´æ˜¯['keydown', 'keyup';]</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  targetEventTypes,</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 2ï¸âƒ£ç›‘å¬å­æ ‘è§¦å‘çš„äº‹ä»¶</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  onEvent(</span><br><span class="line">    event: ReactDOMResponderEvent,     <span class="comment">// åŒ…å«äº†å½“å‰è§¦å‘äº‹ä»¶çš„ç›¸å…³ä¿¡æ¯ï¼Œå¦‚åŸç”Ÿäº‹ä»¶å¯¹è±¡ï¼Œäº‹ä»¶è§¦å‘çš„èŠ‚ç‚¹ï¼Œäº‹ä»¶ç±»å‹ç­‰ç­‰</span></span><br><span class="line">    context: ReactDOMResponderContext, <span class="comment">// Responderçš„ä¸Šä¸‹æ–‡ï¼Œç»™Responderæä¾›äº†ä¸€äº›æ–¹æ³•æ¥é©±åŠ¨äº‹ä»¶åˆ†å‘</span></span><br><span class="line">    props: KeyboardResponderProps,     <span class="comment">// ä¼ é€’ç»™Responderçš„props</span></span><br><span class="line">  ): <span class="keyword">void</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123;responderTarget, type&#125; = event;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (props.disabled) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (type === <span class="string">'keydown'</span>) &#123;</span><br><span class="line">      dispatchKeyboardEvent(</span><br><span class="line">        <span class="string">'onKeyDown'</span>,</span><br><span class="line">        event,</span><br><span class="line">        context,</span><br><span class="line">        <span class="string">'keydown'</span>,</span><br><span class="line">        ((responderTarget: any): Element | Document),</span><br><span class="line">      );</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type === <span class="string">'keyup'</span>) &#123;</span><br><span class="line">      dispatchKeyboardEvent(</span><br><span class="line">        <span class="string">'onKeyUp'</span>,</span><br><span class="line">        event,</span><br><span class="line">        context,</span><br><span class="line">        <span class="string">'keyup'</span>,</span><br><span class="line">        ((responderTarget: any): Element | Document),</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>å†æ¥çœ‹çœ‹dispatchKeyboardEvent:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dispatchKeyboardEvent</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  eventPropName: string,</span></span></span><br><span class="line"><span class="function"><span class="params">  event: ReactDOMResponderEvent,</span></span></span><br><span class="line"><span class="function"><span class="params">  context: ReactDOMResponderContext,</span></span></span><br><span class="line"><span class="function"><span class="params">  type: KeyboardEventType,</span></span></span><br><span class="line"><span class="function"><span class="params">  target: Element | Document,</span></span></span><br><span class="line"><span class="function"><span class="params"></span>): <span class="title">void</span> </span>&#123;</span><br><span class="line">  <span class="comment">// âš›ï¸åˆ›å»ºåˆæˆäº‹ä»¶å¯¹è±¡ï¼Œåœ¨è¿™ä¸ªå‡½æ•°ä¸­ä¼šè§„èŒƒåŒ–äº‹ä»¶çš„keyå±æ€§</span></span><br><span class="line">  <span class="keyword">const</span> syntheticEvent = createKeyboardEvent(event, context, type, target);</span><br><span class="line">  <span class="comment">// âš›ï¸é€šè¿‡Responderä¸Šä¸‹æ–‡åˆ†å‘äº‹ä»¶</span></span><br><span class="line">  context.dispatchEvent(eventPropName, syntheticEvent, DiscreteEvent);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¯¼å‡ºResponder:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// âš›ï¸createResponderæŠŠkeyboardResponderImplè½¬æ¢ä¸ºç»„ä»¶å½¢å¼</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> KeyboardResponder = React.unstable_createResponder(</span><br><span class="line">  <span class="string">'Keyboard'</span>,</span><br><span class="line">  keyboardResponderImpl,</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// âš›ï¸åˆ›å»ºhookså½¢å¼</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">useKeyboardListener</span>(<span class="params">props: KeyboardListenerProps</span>): <span class="title">void</span> </span>&#123;</span><br><span class="line">  React.unstable_useListener(KeyboardResponder, props);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br></p>
<p>ç°åœ¨è¯»è€…åº”è¯¥å¯¹<strong>Responderçš„èŒè´£</strong>æœ‰äº†ä¸€äº›åŸºæœ¬çš„äº†è§£ï¼Œå®ƒä¸»è¦åšä»¥ä¸‹å‡ ä»¶äº‹æƒ…:</p>
<ul>
<li>å£°æ˜è¦ç›‘å¬çš„åŸç”Ÿäº‹ä»¶(å¦‚DOM), å¦‚ä¸Šé¢çš„<code>targetEventTypes</code></li>
<li>å¤„ç†å’Œè½¬æ¢åˆæˆäº‹ä»¶ï¼Œå¦‚ä¸Šé¢çš„<code>onEvent</code></li>
<li>åˆ›å»ºå¹¶åˆ†å‘è‡ªå®šä¹‰äº‹ä»¶ã€‚å¦‚ä¸Šé¢çš„<code>context.dispatchEvent</code></li>
</ul>
<p><br></p>
<p>å’Œä¸Šé¢çš„Keyboardæ¨¡å—ç›¸æ¯”ï¼Œç°å®ä¸­çš„å¾ˆå¤šé«˜çº§äº‹ä»¶ï¼Œå¦‚longPress, å®ƒä»¬çš„å®ç°åˆ™è¦å¤æ‚å¾—å¤š. å®ƒä»¬å¯èƒ½è¦ç»´æŒä¸€å®šçš„<strong>çŠ¶æ€</strong>ã€ä¹Ÿå¯èƒ½è¦ç‹¬å å“åº”çš„<strong>æ‰€æœ‰æƒ</strong>(å³åŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªResponderå¯ä»¥å¯¹äº‹ä»¶è¿›è¡Œå¤„ç†, è¿™ä¸ªå¸¸ç”¨äºç§»åŠ¨ç«¯è§¦æ‘¸æ‰‹åŠ¿ï¼Œä¾‹å¦‚React Nativeçš„<a href="https://reactnative.cn/docs/gesture-responder-system/" target="_blank" rel="noopener">GestureResponderSystem</a>)ã€‚</p>
<p>react-eventsç›®å‰éƒ½è€ƒè™‘äº†è¿™äº›åœºæ™¯, çœ‹ä¸€ä¸‹APIæ¦‚è§ˆ:</p>
<p><img src="/images/react-event/react-events.png" alt></p>
<p><br></p>
<p>è¯¦ç»†å¯ä»¥çœ‹react-events<a href="https://github.com/facebook/react/tree/master/packages/react-events" target="_blank" rel="noopener">å®˜æ–¹ä»“åº“</a></p>
<p><br></p>
<h3 id="react-eventsæ„ä¹‰ä½•åœ¨"><a href="#react-eventsæ„ä¹‰ä½•åœ¨" class="headerlink" title="react-eventsæ„ä¹‰ä½•åœ¨?"></a>react-eventsæ„ä¹‰ä½•åœ¨?</h3><p>ä¸Šæ–‡æåˆ°äº†Reactäº‹ä»¶å†…éƒ¨é‡‡ç”¨äº†æ’ä»¶æœºåˆ¶ï¼Œæ¥å®ç°äº‹ä»¶å¤„ç†å’Œåˆæˆï¼Œæ¯”è¾ƒå…¸å‹çš„å°±æ˜¯onChangeäº‹ä»¶ã€‚onChangeäº‹ä»¶å…¶å®å°±æ˜¯æ‰€è°“çš„â€˜é«˜çº§äº‹ä»¶â€™ï¼Œå®ƒæ˜¯é€šè¿‡è¡¨å•ç»„ä»¶çš„å„ç§åŸç”Ÿäº‹ä»¶æ¥æ¨¡æ‹Ÿçš„ã€‚</p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼ŒReacté€šè¿‡æ’ä»¶æœºåˆ¶æœ¬è´¨ä¸Šæ˜¯å¯ä»¥å®ç°é«˜çº§äº‹ä»¶çš„å°è£…çš„ã€‚ä½†æ˜¯å¦‚æœè¯»è€…çœ‹è¿‡æºä»£ç ï¼Œå°±ä¼šè§‰å¾—é‡Œé¢é€»è¾‘æ¯”è¾ƒç»•ï¼Œè€Œä¸”ä¾èµ–Reactçš„å¾ˆå¤šå†…éƒ¨å®ç°ã€‚<strong>æ‰€ä»¥è¿™ç§å†…éƒ¨çš„æ’ä»¶æœºåˆ¶å¹¶ä¸æ˜¯é¢å‘æ™®é€šå¼€å‘è€…çš„</strong>ã€‚</p>
<p><code>react-events</code>æ¥å£å°±ç®€å•å¾ˆå¤šäº†ï¼Œå®ƒå±è”½äº†å¾ˆå¤šå†…éƒ¨ç»†èŠ‚ï¼Œé¢å‘æ™®é€šå¼€å‘è€…ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨å®ƒæ¥å®ç°é«˜æ€§èƒ½çš„è‡ªå®šä¹‰äº‹ä»¶åˆ†å‘ï¼Œæ›´å¤§çš„æ„ä¹‰æ˜¯é€šè¿‡å®ƒå¯ä»¥å®ç°è·¨å¹³å°/è®¾å¤‡çš„äº‹ä»¶å¤„ç†æ–¹å¼.</p>
<p>ç›®å‰react-eventsè¿˜æ˜¯å®éªŒé˜¶æ®µï¼Œç‰¹æ€§æ˜¯é»˜è®¤å…³é—­ï¼ŒAPIå¯èƒ½ä¼šå‡ºç°å˜æ›´, æ‰€ä»¥ä¸å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ã€‚å¯ä»¥é€šè¿‡è¿™ä¸ª<a href="https://github.com/facebook/react/issues/15257" target="_blank" rel="noopener">Issue</a>æ¥å…³æ³¨å®ƒçš„è¿›å±•ã€‚</p>
<p><br></p>
<p>æœ€åèµå¹ä¸€ä¸‹Reactå›¢é˜Ÿçš„åˆ›æ–°èƒ½åŠ›ï¼</p>
<p><br></p>
<p>å®Œï¼</p>
<p><br></p>
<h2 id="æ‰©å±•é˜…è¯»"><a href="#æ‰©å±•é˜…è¯»" class="headerlink" title="æ‰©å±•é˜…è¯»"></a>æ‰©å±•é˜…è¯»</h2><ul>
<li><a href="https://segmentfault.com/a/1190000013094932" target="_blank" rel="noopener">inputäº‹ä»¶ä¸­æ–‡è§¦å‘å¤šæ¬¡é—®é¢˜ç ”ç©¶</a></li>
<li><a href="http://www.ayqy.net/blog/dive-into-react-fiber/" target="_blank" rel="noopener">å®Œå…¨ç†è§£React Fiber</a></li>
<li><a href="https://www.youtube.com/watch?v=ZCuYPiUIONs" target="_blank" rel="noopener">Lin Clark â€“ A Cartoon Intro to Fiber â€“ React Conf 2017</a></li>
<li><a href="https://philippspiess.com/scheduling-in-react/" target="_blank" rel="noopener">Scheduling in React</a></li>
<li><a href="https://github.com/facebook/react/issues/15257" target="_blank" rel="noopener">[Umbrella] React Flare</a></li>
<li><a href="https://github.com/facebook/react/tree/master/packages/react-events" target="_blank" rel="noopener">react-events</a></li>
</ul>

  </div>
</article>

    <div class="blog-post-comments">
        <div id="disqus_thread">
            <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        </div>
    </div>



    </div>
    
      <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Blogs</a></li>
         
          <li><a href="http://github.com/ivan-94">Projects</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#é‚£ä¸ºä»€ä¹ˆè¦è‡ªå®šä¹‰ä¸€å¥—äº‹ä»¶ç³»ç»Ÿ"><span class="toc-number">1.</span> <span class="toc-text">é‚£ä¸ºä»€ä¹ˆè¦è‡ªå®šä¹‰ä¸€å¥—äº‹ä»¶ç³»ç»Ÿ?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#åŸºæœ¬æ¦‚å¿µ"><span class="toc-number">2.</span> <span class="toc-text">åŸºæœ¬æ¦‚å¿µ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#æ•´ä½“çš„æ¶æ„"><span class="toc-number">2.1.</span> <span class="toc-text">æ•´ä½“çš„æ¶æ„</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#äº‹ä»¶åˆ†ç±»ä¸ä¼˜å…ˆçº§"><span class="toc-number">2.2.</span> <span class="toc-text">äº‹ä»¶åˆ†ç±»ä¸ä¼˜å…ˆçº§</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#å®ç°ç»†èŠ‚"><span class="toc-number">3.</span> <span class="toc-text">å®ç°ç»†èŠ‚</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#äº‹ä»¶æ˜¯å¦‚ä½•ç»‘å®šçš„ï¼Ÿ"><span class="toc-number">3.1.</span> <span class="toc-text">äº‹ä»¶æ˜¯å¦‚ä½•ç»‘å®šçš„ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#äº‹ä»¶æ˜¯å¦‚ä½•åˆ†å‘çš„ï¼Ÿ"><span class="toc-number">3.2.</span> <span class="toc-text">äº‹ä»¶æ˜¯å¦‚ä½•åˆ†å‘çš„ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#äº‹ä»¶è§¦å‘è°ƒåº¦"><span class="toc-number">3.2.1.</span> <span class="toc-text">äº‹ä»¶è§¦å‘è°ƒåº¦</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#æ’ä»¶æ˜¯å¦‚ä½•å¤„ç†äº‹ä»¶"><span class="toc-number">3.2.2.</span> <span class="toc-text">æ’ä»¶æ˜¯å¦‚ä½•å¤„ç†äº‹ä»¶?</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#æ‰¹é‡æ‰§è¡Œ"><span class="toc-number">3.2.3.</span> <span class="toc-text">æ‰¹é‡æ‰§è¡Œ</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#æœªæ¥"><span class="toc-number">4.</span> <span class="toc-text">æœªæ¥</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#åˆæ¢responderçš„åˆ›å»º"><span class="toc-number">4.1.</span> <span class="toc-text">åˆæ¢Responderçš„åˆ›å»º</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#react-eventsæ„ä¹‰ä½•åœ¨"><span class="toc-number">4.2.</span> <span class="toc-text">react-eventsæ„ä¹‰ä½•åœ¨?</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#æ‰©å±•é˜…è¯»"><span class="toc-number">5.</span> <span class="toc-text">æ‰©å±•é˜…è¯»</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://bobi.ink/2019/07/29/react-event/"><i class="fa fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=https://bobi.ink/2019/07/29/react-event/&text=è°ˆè°ˆReactäº‹ä»¶æœºåˆ¶å’Œæœªæ¥(react-events)"><i class="fa fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://bobi.ink/2019/07/29/react-event/&title=è°ˆè°ˆReactäº‹ä»¶æœºåˆ¶å’Œæœªæ¥(react-events)"><i class="fa fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://bobi.ink/2019/07/29/react-event/&is_video=false&description=è°ˆè°ˆReactäº‹ä»¶æœºåˆ¶å’Œæœªæ¥(react-events)"><i class="fa fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=è°ˆè°ˆReactäº‹ä»¶æœºåˆ¶å’Œæœªæ¥(react-events)&body=Check out this article: https://bobi.ink/2019/07/29/react-event/"><i class="fa fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=https://bobi.ink/2019/07/29/react-event/&title=è°ˆè°ˆReactäº‹ä»¶æœºåˆ¶å’Œæœªæ¥(react-events)"><i class="fa fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=https://bobi.ink/2019/07/29/react-event/&title=è°ˆè°ˆReactäº‹ä»¶æœºåˆ¶å’Œæœªæ¥(react-events)"><i class="fa fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://bobi.ink/2019/07/29/react-event/&title=è°ˆè°ˆReactäº‹ä»¶æœºåˆ¶å’Œæœªæ¥(react-events)"><i class="fa fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=https://bobi.ink/2019/07/29/react-event/&title=è°ˆè°ˆReactäº‹ä»¶æœºåˆ¶å’Œæœªæ¥(react-events)"><i class="fa fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=https://bobi.ink/2019/07/29/react-event/&name=è°ˆè°ˆReactäº‹ä»¶æœºåˆ¶å’Œæœªæ¥(react-events)&description="><i class="fa fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
      <ul>
        <li id="toc"><a class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa fa-list fa-lg" aria-hidden="true"></i> TOC</a></li>
        <li id="share"><a class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa fa-share-alt fa-lg" aria-hidden="true"></i> Share</a></li>
        <li id="top" style="display:none"><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a></li>
        <li id="menu"><a class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa fa-bars fa-lg" aria-hidden="true"></i> Menu</a></li>
      </ul>
    </div>

  </div>
</div>

    
    <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2023 Ivan
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Blogs</a></li>
         
          <li><a href="http://github.com/ivan-94">Projects</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

</body>
</html>
<!-- styles -->
<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
<link rel="stylesheet" href="/lib/meslo-LG/styles.css">
<link rel="stylesheet" href="/lib/justified-gallery/justifiedGallery.min.css">

<!-- jquery -->
<script src="/lib/jquery/jquery.min.js"></script>
<script src="/lib/justified-gallery/jquery.justifiedGallery.min.js"></script>
<script src="/js/main.js"></script>


    <!-- Google Analytics -->
    <script type="text/javascript">
        (function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-44571525-2', 'auto');
        ga('send', 'pageview');
    </script>


    <!-- Disqus Comments -->
    <script type="text/javascript">
        var disqus_shortname = 'bobi-ink';

        (function(){
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        }());
    </script>


