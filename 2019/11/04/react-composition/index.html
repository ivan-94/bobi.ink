<!DOCTYPE html>
<html lang=zh>
<head><meta name="generator" content="Hexo 3.8.0">
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="description" content="å‰å‡ ç¯‡æ–‡ç« éƒ½åœ¨è®² React çš„ Concurrent æ¨¡å¼, å¾ˆå¤šè¯»è€…éƒ½çœ‹æ‡µäº†ï¼Œè¿™ä¸€ç¯‡æ¥ç‚¹è½»æ¾çš„ï¼Œè¹­äº†ä¸€ä¸‹ Vue 3.0 çš„çƒ­åº¦ã€‚è®²è®²å¦‚ä½•åœ¨ React ä¸‹å®ç° Vue Composition API(ä¸‹é¢ç®€ç§°VCA)ï¼Œåªæ˜¯ä¸ªç©å…·ï¼Œåˆ«å½“çœŸã€‚ å®ç° â€˜Reactâ€™ Composition APIï¼Ÿçœ‹èµ·æ¥å¾ˆåŠï¼Œç¡®å®ä¹Ÿæ˜¯ï¼Œé€šè¿‡æœ¬æ–‡ä½ å¯ä»¥ä½“ä¼šåˆ°è¿™ä¸¤ç§æ€æƒ³çš„ç¢°æ’, ä½ å¯ä»¥æ·±å…¥å­¦ä¹ ä¸‰æ ·ä¸œè¥¿ï¼šReact H">
<meta name="keywords" content="Blog,FrontEnd,React,Javascript,Typescript">
<meta property="og:type" content="article">
<meta property="og:title" content="[å®æˆ˜] ä¸ºäº†å­¦å¥½ React Hooks, æˆ‘æŠ„äº† Vue Composition API, çœŸé¦™">
<meta property="og:url" content="https://bobi.ink/2019/11/04/react-composition/index.html">
<meta property="og:site_name" content="Bobi.ink">
<meta property="og:description" content="å‰å‡ ç¯‡æ–‡ç« éƒ½åœ¨è®² React çš„ Concurrent æ¨¡å¼, å¾ˆå¤šè¯»è€…éƒ½çœ‹æ‡µäº†ï¼Œè¿™ä¸€ç¯‡æ¥ç‚¹è½»æ¾çš„ï¼Œè¹­äº†ä¸€ä¸‹ Vue 3.0 çš„çƒ­åº¦ã€‚è®²è®²å¦‚ä½•åœ¨ React ä¸‹å®ç° Vue Composition API(ä¸‹é¢ç®€ç§°VCA)ï¼Œåªæ˜¯ä¸ªç©å…·ï¼Œåˆ«å½“çœŸã€‚ å®ç° â€˜Reactâ€™ Composition APIï¼Ÿçœ‹èµ·æ¥å¾ˆåŠï¼Œç¡®å®ä¹Ÿæ˜¯ï¼Œé€šè¿‡æœ¬æ–‡ä½ å¯ä»¥ä½“ä¼šåˆ°è¿™ä¸¤ç§æ€æƒ³çš„ç¢°æ’, ä½ å¯ä»¥æ·±å…¥å­¦ä¹ ä¸‰æ ·ä¸œè¥¿ï¼šReact H">
<meta property="og:locale" content="zh">
<meta property="og:image" content="https://bobi.ink/images/react-composition/pass-by-reference-vs-pass-by-value-animation.gif">
<meta property="og:image" content="https://bobi.ink/images/sponsor.jpg">
<meta property="og:updated_time" content="2023-06-01T09:55:14.330Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="[å®æˆ˜] ä¸ºäº†å­¦å¥½ React Hooks, æˆ‘æŠ„äº† Vue Composition API, çœŸé¦™">
<meta name="twitter:description" content="å‰å‡ ç¯‡æ–‡ç« éƒ½åœ¨è®² React çš„ Concurrent æ¨¡å¼, å¾ˆå¤šè¯»è€…éƒ½çœ‹æ‡µäº†ï¼Œè¿™ä¸€ç¯‡æ¥ç‚¹è½»æ¾çš„ï¼Œè¹­äº†ä¸€ä¸‹ Vue 3.0 çš„çƒ­åº¦ã€‚è®²è®²å¦‚ä½•åœ¨ React ä¸‹å®ç° Vue Composition API(ä¸‹é¢ç®€ç§°VCA)ï¼Œåªæ˜¯ä¸ªç©å…·ï¼Œåˆ«å½“çœŸã€‚ å®ç° â€˜Reactâ€™ Composition APIï¼Ÿçœ‹èµ·æ¥å¾ˆåŠï¼Œç¡®å®ä¹Ÿæ˜¯ï¼Œé€šè¿‡æœ¬æ–‡ä½ å¯ä»¥ä½“ä¼šåˆ°è¿™ä¸¤ç§æ€æƒ³çš„ç¢°æ’, ä½ å¯ä»¥æ·±å…¥å­¦ä¹ ä¸‰æ ·ä¸œè¥¿ï¼šReact H">
<meta name="twitter:image" content="https://bobi.ink/images/react-composition/pass-by-reference-vs-pass-by-value-animation.gif">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>[å®æˆ˜] ä¸ºäº†å­¦å¥½ React Hooks, æˆ‘æŠ„äº† Vue Composition API, çœŸé¦™</title>
    <!-- styles -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- rss -->
    
    
</head>

<body>
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Blogs</a></li>
         
          <li><a href="http://github.com/ivan-94">Projects</a></li>
        
      </ul>
    </span>
    <br>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2019/11/17/fe-load/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/2019/10/28/concurrent-mode-transition/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://bobi.ink/2019/11/04/react-composition/"><i class="fa fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=https://bobi.ink/2019/11/04/react-composition/&text=[å®æˆ˜] ä¸ºäº†å­¦å¥½ React Hooks, æˆ‘æŠ„äº† Vue Composition API, çœŸé¦™"><i class="fa fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://bobi.ink/2019/11/04/react-composition/&title=[å®æˆ˜] ä¸ºäº†å­¦å¥½ React Hooks, æˆ‘æŠ„äº† Vue Composition API, çœŸé¦™"><i class="fa fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://bobi.ink/2019/11/04/react-composition/&is_video=false&description=[å®æˆ˜] ä¸ºäº†å­¦å¥½ React Hooks, æˆ‘æŠ„äº† Vue Composition API, çœŸé¦™"><i class="fa fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=[å®æˆ˜] ä¸ºäº†å­¦å¥½ React Hooks, æˆ‘æŠ„äº† Vue Composition API, çœŸé¦™&body=Check out this article: https://bobi.ink/2019/11/04/react-composition/"><i class="fa fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=https://bobi.ink/2019/11/04/react-composition/&title=[å®æˆ˜] ä¸ºäº†å­¦å¥½ React Hooks, æˆ‘æŠ„äº† Vue Composition API, çœŸé¦™"><i class="fa fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=https://bobi.ink/2019/11/04/react-composition/&title=[å®æˆ˜] ä¸ºäº†å­¦å¥½ React Hooks, æˆ‘æŠ„äº† Vue Composition API, çœŸé¦™"><i class="fa fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://bobi.ink/2019/11/04/react-composition/&title=[å®æˆ˜] ä¸ºäº†å­¦å¥½ React Hooks, æˆ‘æŠ„äº† Vue Composition API, çœŸé¦™"><i class="fa fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=https://bobi.ink/2019/11/04/react-composition/&title=[å®æˆ˜] ä¸ºäº†å­¦å¥½ React Hooks, æˆ‘æŠ„äº† Vue Composition API, çœŸé¦™"><i class="fa fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=https://bobi.ink/2019/11/04/react-composition/&name=[å®æˆ˜] ä¸ºäº†å­¦å¥½ React Hooks, æˆ‘æŠ„äº† Vue Composition API, çœŸé¦™&description="><i class="fa fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#å¯¹æ¯”-react-hooks-å’Œ-vue-composition-api"><span class="toc-number">1.</span> <span class="toc-text">å¯¹æ¯” React Hooks å’Œ Vue Composition API</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#åŸºæœ¬-api-ç±»æ¯”"><span class="toc-number">1.1.</span> <span class="toc-text">åŸºæœ¬ API ç±»æ¯”</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#api-è®¾è®¡æ¦‚è§ˆ"><span class="toc-number">2.</span> <span class="toc-text">API è®¾è®¡æ¦‚è§ˆ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#å“åº”å¼æ•°æ®å’Œ-ref"><span class="toc-number">3.</span> <span class="toc-text">å“åº”å¼æ•°æ®å’Œ ref</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#å…³äº-vue-composition-api-ref"><span class="toc-number">3.1.</span> <span class="toc-text">å…³äº Vue Composition API ref</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ä¸ºä»€ä¹ˆéœ€è¦-ref"><span class="toc-number">3.2.</span> <span class="toc-text">ä¸ºä»€ä¹ˆéœ€è¦ ref?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ref-å’Œ-useref"><span class="toc-number">3.3.</span> <span class="toc-text">ref å’Œ useRef</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ç”Ÿå‘½å‘¨æœŸæ–¹æ³•"><span class="toc-number">4.</span> <span class="toc-text">ç”Ÿå‘½å‘¨æœŸæ–¹æ³•</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#watch"><span class="toc-number">5.</span> <span class="toc-text">watch</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#åŒ…è£…-props-ä¸ºå“åº”å¼æ•°æ®"><span class="toc-number">6.</span> <span class="toc-text">åŒ…è£… Props ä¸ºå“åº”å¼æ•°æ®</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#æ”¯æŒ-context-æ³¨å…¥"><span class="toc-number">7.</span> <span class="toc-text">æ”¯æŒ Context æ³¨å…¥</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#è·Ÿè¸ªç»„ä»¶ä¾èµ–å¹¶è§¦å‘é‡æ–°æ¸²æŸ“"><span class="toc-number">8.</span> <span class="toc-text">è·Ÿè¸ªç»„ä»¶ä¾èµ–å¹¶è§¦å‘é‡æ–°æ¸²æŸ“</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#forwardref-å¤„ç†"><span class="toc-number">9.</span> <span class="toc-text">forwardRef å¤„ç†</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#æ€»ç»“"><span class="toc-number">10.</span> <span class="toc-text">æ€»ç»“</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#å‚è€ƒ-æ‰©å±•"><span class="toc-number">11.</span> <span class="toc-text">å‚è€ƒ/æ‰©å±•</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index width mx-auto px2 my4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        [å®æˆ˜] ä¸ºäº†å­¦å¥½ React Hooks, æˆ‘æŠ„äº† Vue Composition API, çœŸé¦™
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">Bobi.ink</span>
      </span>
      
    <div class="postdate">
        <time datetime="2019-11-03T16:00:00.000Z" itemprop="datePublished">2019-11-04</time>
    </div>


      

    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <p><a href="https://juejin.im/post/5dadc6045188255a270a0f85" target="_blank" rel="noopener">å‰å‡ ç¯‡æ–‡ç« </a>éƒ½åœ¨è®² React çš„ Concurrent æ¨¡å¼, å¾ˆå¤šè¯»è€…éƒ½çœ‹æ‡µäº†ï¼Œè¿™ä¸€ç¯‡æ¥ç‚¹è½»æ¾çš„ï¼Œè¹­äº†ä¸€ä¸‹ Vue 3.0 çš„çƒ­åº¦ã€‚è®²è®²å¦‚ä½•åœ¨ React ä¸‹å®ç° <a href="https://vue-composition-api-rfc.netlify.com/#type-issues-with-class-api" target="_blank" rel="noopener"><code>Vue Composition API</code></a>(ä¸‹é¢ç®€ç§°<strong>VCA</strong>)ï¼Œåªæ˜¯ä¸ªç©å…·ï¼Œåˆ«å½“çœŸã€‚</p>
<p>å®ç° â€˜Reactâ€™ Composition APIï¼Ÿçœ‹èµ·æ¥å¾ˆåŠï¼Œç¡®å®ä¹Ÿæ˜¯ï¼Œé€šè¿‡æœ¬æ–‡ä½ å¯ä»¥ä½“ä¼šåˆ°è¿™ä¸¤ç§æ€æƒ³çš„ç¢°æ’, ä½ å¯ä»¥æ·±å…¥å­¦ä¹ ä¸‰æ ·ä¸œè¥¿ï¼š<code>React Hooks</code>ã€<code>Vue Composition API</code>ã€<a href="https://mobx.js.org/refguide/api.html" target="_blank" rel="noopener"><code>Mobx</code></a>ã€‚ç¯‡å¹…å¾ˆé•¿(ä¸»è¦æ˜¯ä»£ç )ï¼Œå½“ç„¶å¹²è´§ä¹Ÿå¾ˆå¤šã€‚</p>
<p><br></p>
<p><strong>ç›®å½•</strong></p>
<p><br></p>
<!-- TOC -->
<ul>
<li><a href="#å¯¹æ¯”-react-hooks-å’Œ-vue-composition-api">å¯¹æ¯” React Hooks å’Œ Vue Composition API</a><ul>
<li><a href="#åŸºæœ¬-api-ç±»æ¯”">åŸºæœ¬ API ç±»æ¯”</a></li>
</ul>
</li>
<li><a href="#api-è®¾è®¡æ¦‚è§ˆ">API è®¾è®¡æ¦‚è§ˆ</a></li>
<li><a href="#å“åº”å¼æ•°æ®å’Œ-ref">å“åº”å¼æ•°æ®å’Œ ref</a><ul>
<li><a href="#å…³äº-vue-composition-api-ref">å…³äº Vue Composition API ref</a></li>
<li><a href="#ä¸ºä»€ä¹ˆéœ€è¦-ref">ä¸ºä»€ä¹ˆéœ€è¦ ref?</a></li>
<li><a href="#ref-å’Œ-useref">ref å’Œ useRef</a></li>
</ul>
</li>
<li><a href="#ç”Ÿå‘½å‘¨æœŸæ–¹æ³•">ç”Ÿå‘½å‘¨æœŸæ–¹æ³•</a></li>
<li><a href="#watch">watch</a></li>
<li><a href="#åŒ…è£…-props-ä¸ºå“åº”å¼æ•°æ®">åŒ…è£… Props ä¸ºå“åº”å¼æ•°æ®</a></li>
<li><a href="#æ”¯æŒ-context-æ³¨å…¥">æ”¯æŒ Context æ³¨å…¥</a></li>
<li><a href="#è·Ÿè¸ªç»„ä»¶ä¾èµ–å¹¶è§¦å‘é‡æ–°æ¸²æŸ“">è·Ÿè¸ªç»„ä»¶ä¾èµ–å¹¶è§¦å‘é‡æ–°æ¸²æŸ“</a></li>
<li><a href="#forwardref-å¤„ç†">forwardRef å¤„ç†</a></li>
<li><a href="#æ€»ç»“">æ€»ç»“</a></li>
<li><a href="#å‚è€ƒæ‰©å±•">å‚è€ƒ/æ‰©å±•</a></li>
</ul>
<!-- /TOC -->
<p><br></p>
<p>Vue Composition API æ˜¯ Vue 3.0 çš„ä¸€ä¸ªé‡è¦ç‰¹æ€§ï¼Œå’Œ React Hooks ä¸€æ ·ï¼Œè¿™æ˜¯ä¸€ç§éå¸¸æ£’çš„<strong>é€»è¾‘ç»„åˆ/å¤ç”¨æœºåˆ¶</strong>ã€‚å°½ç®¡åˆæœŸå—åˆ°ä¸å°‘<a href="https://juejin.im/post/5d0f64d4f265da1b67211893" target="_blank" rel="noopener">äº‰è®®</a>ï¼Œ<strong>æˆ‘ä¸ªäººè¿˜æ˜¯æ¯”è¾ƒçœ‹å¥½è¿™ä¸ª API ææ¡ˆï¼Œå› ä¸ºç¡®å®è§£å†³äº† Vue ä»¥å¾€çš„å¾ˆå¤šç—›ç‚¹</strong>, è¿™äº›ç—›ç‚¹åœ¨å®ƒçš„<a href="https://vue-composition-api-rfc.netlify.com/#motivation" target="_blank" rel="noopener"> RFC æ–‡æ¡£</a>ä¸­è¯´å¾—å¾ˆæ¸…æ¥šã€‚åŠ¨æœºå’Œ React Hooks å·®ä¸å¤šï¼Œæ— éå°±æ˜¯ä¸‰ç‚¹:</p>
<p><br></p>
<ul>
<li>â‘  é€»è¾‘ç»„åˆå’Œå¤ç”¨</li>
<li>â‘¡ æ›´å¥½çš„ç±»å‹æ¨æ–­ã€‚å®Œç¾æ”¯æŒ Typescript</li>
<li>â‘¢ Tree-shakable å’Œ ä»£ç å‹ç¼©å‹å¥½</li>
</ul>
<p><br></p>
<p>å¦‚æœä½ äº†è§£ React Hooks ä½ ä¼šè§‰å¾— VCA èº«ä¸Šæœ‰å¾ˆå¤š Hooks çš„å½±å­, æ¯•ç«Ÿå®˜æ–¹ä¹Ÿæ‰¿è®¤ React Hooks æ˜¯ VCA çš„ä¸»è¦çµæ„Ÿæ¥æºï¼Œä½†æ˜¯ Vue æ²¡æœ‰å®Œå…¨ç…§æ¬ React Hooksï¼Œè€Œæ˜¯åŸºäºè‡ªå·±çš„æ•°æ®å“åº”å¼æœºåˆ¶ï¼Œåˆ›å»ºå‡ºäº†è‡ªå·±ç‰¹è‰²çš„é€»è¾‘å¤ç”¨åŸè¯­, è¾¨è¯†åº¦ä¹Ÿæ˜¯éå¸¸é«˜çš„ã€‚</p>
<p><br><br><br></p>
<h2 id="å¯¹æ¯”-react-hooks-å’Œ-vue-composition-api"><a href="#å¯¹æ¯”-react-hooks-å’Œ-vue-composition-api" class="headerlink" title="å¯¹æ¯” React Hooks å’Œ Vue Composition API"></a>å¯¹æ¯” React Hooks å’Œ Vue Composition API</h2><p>å¯¹äº React å¼€å‘è€…æ¥è¯´, VCA è¿˜è§£å†³äº† React Hooks çš„ä¸€äº›æœ‰ç‚¹ç¨å¾®è®©äººéš¾å—ã€æ–°æ‰‹ä¸å‹å¥½çš„é—®é¢˜ã€‚è¿™æ˜¯é©±åŠ¨æˆ‘å†™è¿™ç¯‡æ–‡ç« åŸå› ä¹‹ä¸€ï¼Œæ¥å°è¯•æŠŠ VCA æŠ„è¿‡æ¥, é™¤äº†å­¦ä¹  VCAï¼Œè¿˜å¯ä»¥åŠ æ·±å¯¹ React Hooks çš„ç†è§£ã€‚</p>
<p>VCA å®˜æ–¹ RFC æ–‡æ¡£å·²ç»å¾ˆè¯¦ç»†åˆ—ä¸¾äº†å®ƒå’Œ React Hooks çš„å·®å¼‚:</p>
<p><br></p>
<p><strong>â‘  æ€»çš„æ¥è¯´ï¼Œæ›´ç¬¦åˆæƒ¯ç”¨çš„ JavaScript ä»£ç ç›´è§‰</strong>ã€‚è¿™ä¸»è¦æ˜¯ Immutable å’Œ Mutable çš„æ•°æ®æ“ä½œä¹ æƒ¯çš„ä¸åŒã€‚</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Vue: å“åº”å¼æ•°æ®, æ›´ç¬¦åˆ JavaScript ä»£ç çš„ç›´è§‰, å°±æ˜¯æ™®é€šçš„å¯¹è±¡æ“ä½œ</span></span><br><span class="line"><span class="keyword">const</span> data = reactive(&#123;<span class="attr">count</span>: <span class="number">1</span>&#125;)</span><br><span class="line">data.count++</span><br><span class="line"></span><br><span class="line"><span class="comment">// React: ä¸å¯å˜æ•°æ®, JavaScript åŸç”Ÿä¸æ”¯æŒä¸å¯å˜æ•°æ®ï¼Œå› æ­¤æ•°æ®æ“ä½œä¼š verbose ä¸€ç‚¹</span></span><br><span class="line"><span class="keyword">const</span> [count, setCount] = useState(<span class="number">1</span>)</span><br><span class="line">setCount(count + <span class="number">1</span>)</span><br><span class="line">setCoung(<span class="function"><span class="params">c</span> =&gt;</span> c + <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// React: æˆ–è€…ä½¿ç”¨ Reducer, é€‚åˆè¿›è¡Œä¸€äº›å¤æ‚çš„æ•°æ®æ“ä½œ</span></span><br><span class="line"><span class="keyword">const</span> initialState = &#123;<span class="attr">count</span>: <span class="number">0</span>, <span class="comment">/* å‡è®¾è¿˜æœ‰å…¶ä»–çŠ¶æ€ */</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">reducer</span>(<span class="params">state, action</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">switch</span> (action.type) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'increment'</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123;...state, <span class="attr">count</span>: state.count + <span class="number">1</span>&#125;;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'decrement'</span>:</span><br><span class="line">      <span class="keyword">return</span> &#123;...state, <span class="attr">count</span>: state.count - <span class="number">1</span>&#125;;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">return</span> state</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> [state, dispatch] = useReducer(reducer, initialState)</span><br><span class="line">dispatch(&#123;<span class="attr">type</span>: <span class="string">'increment'</span>&#125;)</span><br></pre></td></tr></table></figure>
<p><br></p>
<p>ä¸è¿‡, ä¸èƒ½è¯´å¯å˜æ•°æ®å°±ä¸€å®šå¥½äºä¸å¯å˜æ•°æ®, åä¹‹äº¦ç„¶ã€‚ <strong>ä¸å¯å˜æ•°æ®ä¹Ÿç»™ React å‘æŒ¥å’Œä¼˜åŒ–çš„ç©ºé—´, å°¤å…¶åœ¨ Concurrent æ¨¡å¼ä¸‹, ä¸å¯å˜æ•°æ®å¯ä»¥æ›´å¥½åœ°è¢«è·Ÿè¸ªå’Œ reduce</strong>ã€‚ ä¾‹å¦‚:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// React</span></span><br><span class="line"><span class="keyword">const</span> [state, setState] = useState(<span class="number">0</span>)</span><br><span class="line"><span class="keyword">const</span> [startTransition] = useTransition()</span><br><span class="line"></span><br><span class="line">setState(<span class="number">1</span>)              <span class="comment">// é«˜ä¼˜å…ˆçº§å˜æ›´</span></span><br><span class="line">startTransition(<span class="function"><span class="params">()</span> =&gt;</span> &#123;  <span class="comment">// ä½ä¼˜å…ˆçº§çŠ¶æ€å˜æ›´</span></span><br><span class="line">  setState(<span class="number">2</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><br></p>
<p>React ä¸­çŠ¶æ€å˜æ›´å¯ä»¥æœ‰ä¸åŒçš„ä¼˜å…ˆçº§ï¼Œå®é™…ä¸Šè¿™äº›å˜æ›´ä¼šæ”¾å…¥ä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œç•Œé¢å¯èƒ½å…ˆæ˜¾ç¤º <code>1</code>, ç„¶åæ‰æ˜¯ <code>2</code>ã€‚<strong>ä½ å¯ä»¥è®¤ä¸ºè¿™ä¸ªé˜Ÿåˆ—å°±æ˜¯è¿™ä¸ªçŠ¶æ€çš„å†å²å¿«ç…§ï¼Œç”± React æ¥è°ƒåº¦è¿›è¡ŒçŠ¶æ€çš„å‰è¿›ï¼Œæœ‰ç‚¹ç±»ä¼¼äº Redux çš„â€™æ—¶é—´æ—…è¡Œâ€™</strong>ã€‚å¦‚æœæ˜¯å¯å˜æ•°æ®ï¼Œå®ç°è¿™ç§â€˜æ—¶é—´æ—…è¡Œâ€™ä¼šç›¸å¯¹æ¯”è¾ƒéº»çƒ¦ã€‚</p>
<p><br></p>
<hr>
<p><br></p>
<p><strong>â‘¡ ä¸å…³å¿ƒè°ƒç”¨é¡ºåºå’Œæ¡ä»¶åŒ–</strong>ã€‚React Hooks <a href="https://juejin.im/post/5cfa29e151882539c33e4f5e" target="_blank" rel="noopener">åŸºäºæ•°ç»„å®ç°</a>ï¼Œæ¯æ¬¡é‡æ–°æ¸²æŸ“å¿…é¡»ä¿è¯è°ƒç”¨çš„é¡ºåºï¼Œå¦åˆ™ä¼šå‡ºç°æ•°æ®é”™ä¹±ã€‚VCA ä¸ä¾èµ–æ•°ç»„ï¼Œä¸å­˜åœ¨è¿™äº›é™åˆ¶ã€‚</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// React</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useMyHooks</span>(<span class="params">someCondition, antherCondition</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (someCondition) &#123;</span><br><span class="line">    useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;<span class="comment">/* ... */</span>&#125;, []) <span class="comment">// ğŸ’¥</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (anotherCondition) &#123;</span><br><span class="line">    <span class="keyword">return</span> something      <span class="comment">// æå‰è¿”å› ğŸ’¥</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> [someState] = useState(<span class="number">0</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br></p>
<hr>
<p><br></p>
<p><strong>â‘¢ ä¸ç”¨æ¯æ¬¡æ¸²æŸ“é‡å¤è°ƒç”¨ï¼Œå‡ä½ GC çš„å‹åŠ›</strong>ã€‚ æ¯æ¬¡æ¸²æŸ“æ‰€æœ‰ Hooks éƒ½ä¼šé‡æ–°æ‰§è¡Œä¸€éï¼Œè¿™ä¸­é—´å¯èƒ½ä¼šé‡å¤åˆ›å»ºä¸€äº›ä¸´æ—¶çš„å˜é‡ã€å¯¹è±¡ä»¥åŠé—­åŒ…ã€‚è€Œ VCA çš„setup åªè°ƒç”¨ä¸€æ¬¡ã€‚</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// React</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">MyComp</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = useState(<span class="number">0</span>)</span><br><span class="line">  <span class="keyword">const</span> add = <span class="function"><span class="params">()</span> =&gt;</span> setCount(<span class="function"><span class="params">c</span> =&gt;</span> c+<span class="number">1</span>)  <span class="comment">// è¿™äº›å†…è”å‡½æ•°æ¯æ¬¡æ¸²æŸ“éƒ½ä¼šåˆ›å»º</span></span><br><span class="line">  <span class="keyword">const</span> decr = <span class="function"><span class="params">()</span> =&gt;</span> setCount(<span class="function"><span class="params">c</span> =&gt;</span> c<span class="number">-1</span>)</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(count)</span><br><span class="line">  &#125;, [count])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">    count: &#123;count&#125;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">onClick</span>=<span class="string">&#123;add&#125;</span>&gt;</span>add<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">span</span> <span class="attr">onClick</span>=<span class="string">&#123;decr&#125;</span>&gt;</span>decr<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br></p>
<hr>
<p><br></p>
<p><strong>â‘£ ä¸ç”¨è€ƒè™‘ useCallback/useMemo é—®é¢˜</strong>ã€‚ å› ä¸ºé—®é¢˜ â‘¢ , åœ¨ React ä¸­ï¼Œä¸ºäº†é¿å…å­ç»„ä»¶ diff å¤±æ•ˆå¯¼è‡´æ— æ„ä¹‰çš„é‡æ–°æ¸²æŸ“ï¼Œæˆ‘ä»¬å‡ ä¹æ€»ä¼šä½¿ç”¨ useCallback æˆ–è€… useMemo æ¥ç¼“å­˜ä¼ é€’ç»™ä¸‹çº§çš„äº‹ä»¶å¤„ç†å™¨æˆ–å¯¹è±¡ã€‚</p>
<p>VCA ä¸­æˆ‘ä»¬å¯ä»¥å®‰å…¨åœ°å¼•ç”¨å¯¹è±¡ï¼Œéšæ—¶å¯ä»¥å­˜å–æœ€æ–°çš„å€¼ã€‚</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// React</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">MyComp</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setCount] = useState(<span class="number">0</span>)</span><br><span class="line">  <span class="keyword">const</span> add = useCallback(<span class="function"><span class="params">()</span> =&gt;</span> setCount(<span class="function"><span class="params">c</span> =&gt;</span> c+<span class="number">1</span>), [])</span><br><span class="line">  <span class="keyword">const</span> decr = useCallback(<span class="function"><span class="params">()</span> =&gt;</span> setCount(<span class="function"><span class="params">c</span> =&gt;</span> c<span class="number">-1</span>), [])</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(count)</span><br><span class="line">  &#125;, [count])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">SomeComplexComponent</span> <span class="attr">count</span>=<span class="string">&#123;count&#125;</span> <span class="attr">onAdd</span>=<span class="string">&#123;add&#125;</span> <span class="attr">onDecr</span>=<span class="string">&#123;decr&#125;/</span>&gt;</span>)</span></span><br><span class="line"><span class="xml">&#125;</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">// Vue: æ²¡æœ‰æ­¤é—®é¢˜, é€šè¿‡å¯¹è±¡å¼•ç”¨å­˜å–æœ€æ–°å€¼</span></span><br><span class="line"><span class="xml">createComponent(&#123;</span></span><br><span class="line"><span class="xml">  setup((props) =&gt; &#123;</span></span><br><span class="line"><span class="xml">    const count = ref(0)</span></span><br><span class="line"><span class="xml">    const add = () =&gt; count.value++</span></span><br><span class="line"><span class="xml">    const decr = () =&gt; count.value--</span></span><br><span class="line"><span class="xml">    watch(count, c =&gt; console.log(c))</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line">    return () =&gt; &lt;SomeComplexComponent count=&#123;count&#125; onAdd=&#123;add&#125; onDecr=&#123;decr&#125;/&gt;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><br></p>
<hr>
<p><br></p>
<p><strong>â‘¤ ä¸å¿…æ‰‹åŠ¨ç®¡ç†æ•°æ®ä¾èµ–</strong>ã€‚åœ¨ React Hooks ä¸­ï¼Œä½¿ç”¨ <code>useCallback</code>ã€<code>useMemo</code>ã€<code>useEffect</code> è¿™äº› Hooksï¼Œéƒ½éœ€è¦æ‰‹åŠ¨ç»´æŠ¤ä¸€ä¸ªæ•°æ®ä¾èµ–æ•°ç»„ã€‚å½“è¿™äº›ä¾èµ–é¡¹å˜åŠ¨æ—¶ï¼Œæ‰è®©ç¼“å­˜å¤±æ•ˆã€‚</p>
<p>è¿™å¾€å¾€æ˜¯æ–°æ‰‹æ¥è§¦ React Hooks çš„ç¬¬ä¸€é“åã€‚ä½ è¦ç†è§£å¥½é—­åŒ…ï¼Œç†è§£å¥½ Memoize å‡½æ•° ï¼Œæ‰èƒ½ç†è§£è¿™äº› Hooks çš„è¡Œä¸ºã€‚è¿™è¿˜ä¸æ˜¯é—®é¢˜ï¼Œé—®é¢˜æ˜¯è¿™äº›æ•°æ®ä¾èµ–éœ€è¦å¼€å‘è€…æ‰‹åŠ¨å»ç»´æŠ¤ï¼Œå¾ˆå®¹æ˜“æ¼æ‰ä»€ä¹ˆï¼Œå¯¼è‡´bugã€‚</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// React</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">MyComp</span>(<span class="params">&#123;anotherCount, onClick&#125;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [count, setState] = useState(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> handleClick = useCallback(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    onClick(anotherCount + count)</span><br><span class="line">  &#125;, [count]) <span class="comment">// ğŸæ¼æ‰äº† antherCount å’Œ onClick</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å› æ­¤ React å›¢é˜Ÿå¼€å‘äº† <a href="https://www.npmjs.com/package/eslint-plugin-react-hooks" target="_blank" rel="noopener">eslint-plugin-react-hooks</a>æ’ä»¶ï¼Œè¾…åŠ©æ£€æŸ¥ React Hooks çš„ç”¨æ³•, å¯ä»¥é¿å…æ¼æ‰æŸäº›ä¾èµ–ã€‚ä¸è¿‡è¿™ä¸ªæ’ä»¶å¤ªæ­»äº†ï¼Œæä¸å¥½è¦å†™å¾ˆå¤š <code>//eslint-disable-next-line</code> ğŸ˜‚</p>
<p>VCA ç”±äºä¸å­˜åœ¨ â‘£ é—®é¢˜ï¼Œå½“ç„¶ä¹Ÿä¸å­˜åœ¨ â‘¤é—®é¢˜ã€‚ Vue çš„å“åº”å¼æœºåˆ¶å¯ä»¥è‡ªåŠ¨ã€ç²¾ç¡®åœ°è·Ÿè¸ªæ•°æ®ä¾èµ–ï¼Œè€Œä¸”åŸºäºå¯¹è±¡å¼•ç”¨çš„ä¸å˜æ€§ï¼Œæˆ‘ä»¬ä¸éœ€è¦å…³å¿ƒé—­åŒ…é—®é¢˜ã€‚</p>
<p><br></p>
<hr>
<p><br></p>
<p>å¦‚æœä½ é•¿æœŸè¢«è¿™äº›é—®é¢˜å›°æ‰°ï¼Œä½ ä¼šè§‰å¾— VCA å¾ˆæœ‰å¸å¼•åŠ›ã€‚è€Œä¸”å®ƒç®€å•æ˜“å­¦, è¿™ç®€ç›´æ˜¯ Vue å¼€å‘è€…çš„â€˜ç¦æŠ¥â€˜å•Šï¼ æ˜¯ä¸æ˜¯ä¹Ÿæƒ³è‡ªå·±åŠ¨æ‰‹å†™ä¸€ä¸ªï¼ŸæŠŠ VCA æ¬åˆ° React è¿™è¾¹æ¥ï¼Œè§£å†³è¿™äº›é—®é¢˜ï¼Ÿé‚£è¯·ç»§ç»­å¾€ä¸‹è¯»</p>
<p><br><br><br></p>
<h3 id="åŸºæœ¬-api-ç±»æ¯”"><a href="#åŸºæœ¬-api-ç±»æ¯”" class="headerlink" title="åŸºæœ¬ API ç±»æ¯”"></a>åŸºæœ¬ API ç±»æ¯”</h3><p>é¦–å…ˆï¼Œä½ å¾—å…ˆäº†è§£ React Hooks å’Œ VCAã€‚æœ€å¥½çš„å­¦ä¹ èµ„æ–™æ˜¯å®ƒä»¬çš„å®˜æ–¹æ–‡æ¡£ã€‚ä¸‹é¢ç®€å•ç±»æ¯”ä¸€ä¸‹ä¸¤è€…çš„ API:</p>
<p><br></p>
<table>
<thead>
<tr>
<th></th>
<th>React Hooks</th>
<th>Vue Composition API</th>
</tr>
</thead>
<tbody>
<tr>
<td>çŠ¶æ€</td>
<td><code>const [value, setValue] = useState(0)</code> <br> <code>useReducer</code></td>
<td><code>const state = reactive({value: 0})</code> <br> <code>ref(0)</code></td>
</tr>
<tr>
<td>çŠ¶æ€å˜æ›´</td>
<td><code>setValue(1)</code> <br> <code>setValue(n =&gt; n + 1)</code> <br> <code>dispatch</code></td>
<td><code>state.value = 1</code> <br> <code>state.value++</code></td>
</tr>
<tr>
<td>çŠ¶æ€è¡ç”Ÿ</td>
<td><code>useMemo(() =&gt; derived, [deps])</code></td>
<td><code>computed(() =&gt; derived)</code></td>
</tr>
<tr>
<td>å¯¹è±¡å¼•ç”¨</td>
<td><code>const foo = useRef(0);</code> <br> <code>foo.current = 1</code></td>
<td><code>const foo = ref(0)</code> <br> <code>foo.value = 1</code></td>
</tr>
<tr>
<td>æŒ‚è½½</td>
<td><code>useEffect(() =&gt; {/*æŒ‚è½½*/}, [])</code></td>
<td><code>onBeforeMount(() =&gt; {/*æŒ‚è½½å‰*/})</code> <br> <code>onMounted(() =&gt; {/*æŒ‚è½½å*/})</code></td>
</tr>
<tr>
<td>å¸è½½</td>
<td><code>useEffect(() =&gt; () =&gt; {/*å¸è½½*/}}, [])</code></td>
<td><code>onBeforeUnmount(() =&gt; {/*å¸è½½å‰*/})</code> <br> <code>onUnmounted(() =&gt; {/*å¸è½½å*/})</code></td>
</tr>
<tr>
<td>é‡æ–°æ¸²æŸ“</td>
<td><code>useEffect(() =&gt; {/*æ›´æ–°*/})</code></td>
<td><code>onBeforeUpdate(() =&gt; {/*æ›´æ–°å‰*/})</code> <br> <code>onUpdated(() =&gt; {/*æ›´æ–°å*/})</code></td>
</tr>
<tr>
<td>å¼‚å¸¸å¤„ç†</td>
<td>ç›®å‰åªæœ‰ç±»ç»„ä»¶æ”¯æŒ(<code>componentDidCatch</code>, <br> <code>static getDerivedStateFromError</code>)</td>
<td><code>onErrorCaptured((err) =&gt; {/*å¼‚å¸¸å¤„ç†*/})</code></td>
</tr>
<tr>
<td>ä¾èµ–ç›‘å¬</td>
<td><code>useEffect(() =&gt; {/*ä¾èµ–æ›´æ–°*/}, [deps])</code></td>
<td><code>const stop = watch(() =&gt; {/*è‡ªåŠ¨æ£€æµ‹æ•°æ®ä¾èµ–, æ›´æ–°...*/})</code></td>
</tr>
<tr>
<td>ä¾èµ–ç›‘å¬ + æ¸…ç†</td>
<td><code>useEffect(() =&gt; {/*...*/; return () =&gt; {/*æ¸…ç†*/}}, [deps])</code></td>
<td><code>watch(() =&gt; [deps], (newVal, oldVal, clean) =&gt; {/*æ›´æ–°*/; clean(() =&gt; {/* æ¸…ç†*/})})</code></td>
</tr>
<tr>
<td>Context æ³¨å…¥</td>
<td><code>useContext(YouContext)</code></td>
<td><code>inject(key)</code> <br> <code>provider(key, value)</code></td>
</tr>
</tbody>
</table>
<p><br></p>
<p>å¯¹æ¯”ä¸Šè¡¨ï¼Œæˆ‘ä»¬å‘ç°ä¸¤è€…éå¸¸ç›¸ä¼¼ï¼Œæ¯ä¸ªåŠŸèƒ½éƒ½å¯ä»¥åœ¨å¯¹æ–¹èº«ä¸Šæ‰¾åˆ°ç­‰ä»·ç‰©ã€‚ React Hooks å’Œ VCA çš„ä¸»è¦å·®åˆ«å¦‚ä¸‹:</p>
<p><br></p>
<ul>
<li><strong>æ•°æ®æ–¹é¢</strong>ã€‚<code>Mutable</code> vs <code>Immutable</code>ï¼Œ<code>Reactive</code> vs <code>Diff</code>ã€‚</li>
<li><strong>æ›´æ–°å“åº”æ–¹é¢</strong>ã€‚React Hooks å’Œå…¶ç»„ä»¶æ€ç»´ä¸€è„‰ç›¸æ‰¿ï¼Œå®ƒä¾èµ–æ•°æ®çš„æ¯”å¯¹æ¥ç¡®å®šä¾èµ–çš„æ›´æ–°ã€‚è€ŒVue åˆ™åŸºäºè‡ªåŠ¨çš„ä¾èµ–è®¢é˜…ã€‚è¿™ç‚¹å¯ä»¥é€šè¿‡å¯¹æ¯” useEffect å’Œ watch ä½“ä¼šã€‚</li>
<li><strong>ç”Ÿå‘½å‘¨æœŸé’©å­</strong>ã€‚React Hooks å·²ç»å¼±åŒ–äº†ç»„ä»¶ç”Ÿå‘½å‘¨æœŸçš„æ¦‚å¿µï¼Œç±»ç»„ä»¶ä¹ŸåºŸå¼ƒäº†<code>componentWillMount</code>ã€ <code>componentWillUpdate</code>ã€   <code>componentWillReceiveProps</code> è¿™äº›ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ã€‚ ä¸€åˆ™æˆ‘ä»¬ç¡®å®ä¸éœ€è¦è¿™ä¹ˆå¤šç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼ŒReact åšäº†å‡æ³•ï¼›äºŒåˆ™ï¼ŒConcurrent æ¨¡å¼ä¸‹ï¼ŒReconciliation é˜¶æ®µç»„ä»¶å¯èƒ½ä¼šè¢«é‡å¤æ¸²æŸ“ï¼Œè¿™äº›ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ä¸èƒ½ä¿è¯åªè¢«è°ƒç”¨ä¸€æ¬¡ï¼Œå¦‚æœåœ¨è¿™äº›ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ä¸­åŒ…å«å‰¯ä½œç”¨ï¼Œä¼šå¯¼è‡´åº”ç”¨å¼‚å¸¸, æ‰€ä»¥åºŸå¼ƒä¼šæ¯”è¾ƒå¥½ã€‚Vue Composition API ç»§ç»­æ²¿ç”¨ Vue 2.x çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•.</li>
</ul>
<p><br></p>
<p>å…¶ä¸­ç¬¬ä¸€ç‚¹æ˜¯æœ€é‡è¦çš„ï¼Œä¹Ÿæ˜¯æœ€å¤§çš„åŒºåˆ«(æ€æƒ³)ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ VCA çš„ â€˜Hooksâ€™ åªéœ€è¦åˆå§‹åŒ–ä¸€æ¬¡ï¼Œä¸éœ€è¦åœ¨æ¯æ¬¡æ¸²æŸ“æ—¶éƒ½å»è°ƒç”¨çš„ä¸»è¦åŸå› : <strong>åŸºäºMutable æ•°æ®ï¼Œå¯ä»¥ä¿æŒæ•°æ®çš„å¼•ç”¨ï¼Œä¸éœ€è¦æ¯æ¬¡éƒ½å»é‡æ–°è®¡ç®—</strong>ã€‚</p>
<p><br><br><br></p>
<h2 id="api-è®¾è®¡æ¦‚è§ˆ"><a href="#api-è®¾è®¡æ¦‚è§ˆ" class="headerlink" title="API è®¾è®¡æ¦‚è§ˆ"></a>API è®¾è®¡æ¦‚è§ˆ</h2><p>å…ˆæ¥çœ‹ä¸€ä¸‹ï¼Œæˆ‘ä»¬çš„ç©å…·(éšä¾¿å–åå«<strong>mpos</strong>å§)çš„å¤§ä½“è®¾è®¡:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å°±éšä¾¿å–åå« mpos å§</span></span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  reactive,</span><br><span class="line">  box,</span><br><span class="line">  createRef,</span><br><span class="line">  computed,</span><br><span class="line">  inject,</span><br><span class="line">  watch,</span><br><span class="line">  onMounted,</span><br><span class="line">  onUpdated,</span><br><span class="line">  onUnmount,</span><br><span class="line">  createComponent,</span><br><span class="line">  Box</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">'mpos'</span></span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> interface CounterProps &#123;</span><br><span class="line">  initial: number;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> MultiplyContext = React.createContext(&#123; <span class="attr">value</span>: <span class="number">0</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è‡ªå®šä¹‰ Hooks</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useTitle</span>(<span class="params">title: Box&lt;string&gt;</span>) </span>&#123;</span><br><span class="line">  watch(<span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">document</span>.title = title.value)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// createComponent åˆ›å»ºç»„ä»¶</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> createComponent&lt;CounterProps&gt;(&#123;</span><br><span class="line">  <span class="comment">// ç»„ä»¶å</span></span><br><span class="line">  name: <span class="string">'Counter'</span>,</span><br><span class="line">  <span class="comment">// âš›ï¸ å’Œ Vue Composition API ä¸€æ ·çš„setupï¼Œåªä¼šè¢«è°ƒç”¨ä¸€æ¬¡</span></span><br><span class="line">  <span class="comment">// æ¥å—ç»„ä»¶çš„ props å¯¹è±¡, è¿™ä¹Ÿæ˜¯å“åº”å¼å¯¹è±¡, å¯ä»¥è¢«watchï¼Œå¯ä»¥è·å–æœ€æ–°å€¼</span></span><br><span class="line">  setup(props) &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * âš›ï¸åˆ›å»ºä¸€ä¸ªå“åº”å¼æ•°æ®</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">const</span> data = reactive(&#123; <span class="attr">count</span>: props.initial, <span class="attr">tick</span>: <span class="number">0</span> &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * âš›ï¸ç­‰ä»·äº Vue Composition API çš„ ref</span></span><br><span class="line"><span class="comment">     * ç”±äºreactive ä¸èƒ½åŒ…è£…åŸå§‹ç±»å‹ï¼Œbox å¯ä»¥å¸®åˆ°æˆ‘ä»¬</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">const</span> name = box(<span class="string">'kobe'</span>)</span><br><span class="line">    name.set(<span class="string">'curry'</span>)</span><br><span class="line">    <span class="built_in">console</span>.log(name.get()) <span class="comment">// curry</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * âš›ï¸è¡ç”Ÿæ•°æ®è®¡ç®—</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">const</span> derivedCount = computed(<span class="function"><span class="params">()</span> =&gt;</span> data.count * <span class="number">2</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(derivedCount.get()) <span class="comment">// 0</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * âš›ï¸ç­‰ä»·äº React.createRef()ï¼Œç”¨äºå¼•ç”¨Virtual DOM èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">const</span> containerRef = createRef&lt;HTMLDivElement&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * âš›ï¸ä¾èµ–æ³¨å…¥ï¼Œè·å– React.Context å€¼, ç±»ä¼¼äº useContextï¼Œåªä¸è¿‡è¿”å›ä¸€ä¸ªå“åº”å¼æ•°æ®</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">const</span> ctx = inject(MultiplyContext);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * âš›ï¸å¯ä»¥å¤åˆå…¶ä»– Hooksï¼Œå®ç°é€»è¾‘ç»„åˆ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    useTitle(computed(<span class="function"><span class="params">()</span> =&gt;</span> <span class="string">`title: <span class="subst">$&#123;data.count&#125;</span>`</span>))</span><br><span class="line">    <span class="keyword">const</span> awesome = useYourImagination()</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * âš›ï¸ç”Ÿå‘½å‘¨æœŸæ–¹æ³•</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    onMounted(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"mounted"</span>, container.current);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// æ”¯æŒç±»ä¼¼ useEffect çš„æ–¹å¼ï¼Œè¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°ä¼šåœ¨å¸è½½å‰è¢«è°ƒç”¨</span></span><br><span class="line">      <span class="comment">// å› ä¸ºä¸€èˆ¬èµ„æºè·å–å’Œèµ„æºé‡Šæ”¾é€»è¾‘æ”¾åœ¨ä¸€èµ·ï¼Œä»£ç ä¼šæ›´æ¸…æ™°</span></span><br><span class="line">      <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"unmount"</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    onUpdated(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"update"</span>, data.count, props);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ³¨æ„è¿™é‡Œæ˜¯ onUnmountï¼Œè€Œ VCA æ˜¯ onUnmounted</span></span><br><span class="line">    onUnmount(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"unmount"</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * âš›ï¸ç›‘å¬æ•°æ®å˜åŠ¨, ç±»ä¼¼äº useEffect</span></span><br><span class="line"><span class="comment">     * è¿”å›ä¸€ä¸ªdisposerï¼Œå¯ä»¥ç”¨äºæ˜¾å¼å–æ¶ˆç›‘å¬ï¼Œé»˜è®¤ä¼šåœ¨ç»„ä»¶å¸è½½æ—¶è‡ªåŠ¨å–æ¶ˆ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">const</span> stop = watch(</span><br><span class="line">      () =&gt; [data.count], <span class="comment">// å¯é€‰</span></span><br><span class="line">      ([count]) =&gt; &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"count change"</span>, count);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å‰¯ä½œç”¨</span></span><br><span class="line">        <span class="keyword">const</span> timer = setInterval(<span class="function"><span class="params">()</span> =&gt;</span> data.tick++, count)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å‰¯ä½œç”¨æ¸…ç†ï¼ˆå¯é€‰ï¼‰, å’ŒuseEffect ä¿æŒä¸€è‡´ï¼Œåœ¨ç»„ä»¶å¸è½½æˆ–è€…å½“å‰å‡½æ•°è¢«é‡æ–°è°ƒç”¨æ—¶ï¼Œè°ƒç”¨</span></span><br><span class="line">        <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">          clearInterval(timer)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// props æ˜¯ä¸€ä¸ªå“åº”å¼æ•°æ®</span></span><br><span class="line">    watch(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"initial change"</span>, props.initial);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// context æ˜¯ä¸€ä¸ªå“åº”å¼æ•°æ®</span></span><br><span class="line">    watch(</span><br><span class="line">      () =&gt; [ctx.value],</span><br><span class="line">      ([ctxValue], [oldCtxValue]) =&gt; &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"context change"</span>, ctxValue);</span><br><span class="line">      &#125;</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * âš›ï¸æ–¹æ³•ï¼Œä¸éœ€è¦ useCallbackï¼Œæ°¸ä¹…ä¸å˜</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">const</span> add = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      data.count++;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * âš›ï¸è¿”å›ä¸€ä¸ªæ¸²æŸ“å‡½æ•°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// åœ¨è¿™é‡Œä½ ä¹Ÿå¯ä»¥è°ƒç”¨ React Hooks, å°±è·Ÿæ™®é€šå‡½æ•°ç»„ä»¶ä¸€æ ·</span></span><br><span class="line">      useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'hello world'</span>)</span><br><span class="line">      &#125;, [])</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> (</span><br><span class="line">        &lt;div className=<span class="string">"counter"</span> onClick=&#123;add&#125; ref=&#123;containerRef&#125;&gt;</span><br><span class="line">          &#123;data.count&#125; : &#123;derivedCount.get()&#125; : &#123;data.tick&#125;</span><br><span class="line">        &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">      );</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">  &#125;,</span></span><br><span class="line"><span class="regexp">&#125;)</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p>æˆ‘ä¸æ‰“ç®—å®Œå…¨ç…§æ¬ VCAï¼Œå› æ­¤ç•¥æœ‰ç®€åŒ–å’Œå·®å¼‚ã€‚ä»¥ä¸‹æ˜¯å®ç°çš„è¦ç‚¹:</p>
<ul>
<li>â‘  å¦‚ä½•ç¡®ä¿ setup åªåˆå§‹åŒ–ä¸€æ¬¡?</li>
<li>â‘¡ å› ä¸º â‘ ï¼Œæˆ‘ä»¬éœ€è¦å°† Contextã€Props è¿™äº›å¯¹è±¡è¿›è¡ŒåŒ…è£…æˆå“åº”å¼æ•°æ®, ç¡®ä¿æˆ‘ä»¬æ€»æ˜¯å¯ä»¥æ‹¿åˆ°æœ€æ–°çš„å€¼ï¼Œé¿å…ç±»ä¼¼ React Hook çš„é—­åŒ…é—®é¢˜.</li>
<li>â‘¢ ç”Ÿå‘½å‘¨æœŸé’©å­, watch å¦‚ä½•ç»‘å®šåˆ°ç»„ä»¶ä¸Šï¼Ÿæˆ‘ä»¬è¦å®ç°ä¸€ä¸ªè°ƒç”¨ä¸Šä¸‹æ–‡</li>
<li>â‘£ watch æ•°æ®ç›‘å¬å’Œé‡Šæ”¾</li>
<li>â‘£ Context æ”¯æŒ, inject æ€ä¹ˆå®ç°ï¼Ÿ</li>
<li>â‘¤ å¦‚ä½•è§¦å‘ç»„ä»¶é‡æ–°æ¸²æŸ“?</li>
</ul>
<p><br></p>
<p>æˆ‘ä»¬å¸¦ç€è¿™äº›é—®é¢˜ï¼Œä¸€æ­¥ä¸€æ­¥æ¥å®ç°è¿™ä¸ª <strong>â€˜React Composition APIâ€™</strong></p>
<p><br><br><br></p>
<h2 id="å“åº”å¼æ•°æ®å’Œ-ref"><a href="#å“åº”å¼æ•°æ®å’Œ-ref" class="headerlink" title="å“åº”å¼æ•°æ®å’Œ ref"></a>å“åº”å¼æ•°æ®å’Œ ref</h2><p>å¦‚ä½•å®ç°æ•°æ®çš„å“åº”å¼ï¼Ÿä¸éœ€è¦æˆ‘ä»¬è‡ªå·±å»é€ è½®å­ï¼Œç°æˆæœ€å¥½åº“çš„æ˜¯ <a href="https://mobx.js.org/refguide/observable.html" target="_blank" rel="noopener"><code>MobX</code></a>ã€‚</p>
<p><code>reactive</code> å’Œ <code>computed</code> ä»¥åŠ <code>watch</code> éƒ½å¯ä»¥åœ¨ Mobx ä¸­æ‰¾åˆ°ç­‰ä»·çš„APIã€‚ä»¥ä¸‹æ˜¯ Mobx API å’Œ VCA çš„å¯¹ç…§è¡¨:</p>
<p><br></p>
<table>
<thead>
<tr>
<th>Mobx</th>
<th>Vue Composition API</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>observable(object/map/array/set)</td>
<td>reactive()</td>
<td>è½¬æ¢å“åº”å¼å¯¹è±¡</td>
</tr>
<tr>
<td>box(åŸå§‹ç±»å‹)</td>
<td>ref()</td>
<td>è½¬æ¢åŸå§‹ç±»å‹ä¸ºå“åº”å¼å¯¹è±¡</td>
</tr>
<tr>
<td>computed() + è¿”å› box ç±»å‹</td>
<td>computed() + è¿”å› ref ç±»å‹</td>
<td>å“åº”å¼è¡ç”ŸçŠ¶æ€è®¡ç®—</td>
</tr>
<tr>
<td>autorun(), reaction()</td>
<td>watch()</td>
<td>ç›‘å¬å“åº”å¼å¯¹è±¡å˜åŠ¨</td>
</tr>
</tbody>
</table>
<p><br></p>
<p>æ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦è‡ªå·±å»å®ç°è¿™äº› API, ç®€å•è®¾ç½®ä¸ªåˆ«å:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// mpos.ts</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; observable, computed, isBoxedObservable &#125; <span class="keyword">from</span> <span class="string">'mobx'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> type Box&lt;T&gt; = IObservableValue&lt;T&gt;</span><br><span class="line"><span class="keyword">export</span> type Boxes&lt;T&gt; = &#123;</span><br><span class="line">  [K <span class="keyword">in</span> keyof T]: T[K] extends Box&lt;infer V&gt; ? Box&lt;V&gt; : Box&lt;T[K]&gt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> reactive = observable</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> box = reactive.box        <span class="comment">// ç­‰ä»·äº VCA çš„ ref</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> isBox = isBoxedObservabl</span><br><span class="line"><span class="keyword">export</span> &#123; computed &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç­‰ä»·äº VCA çš„ toRefs, è§ä¸‹æ–‡</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">toBoxes</span>&lt;<span class="title">T</span> <span class="title">extends</span> <span class="title">object</span>&gt;(<span class="params">obj: T</span>): <span class="title">Boxes</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> res: Boxes&lt;T&gt; = &#123;&#125; <span class="keyword">as</span> any</span><br><span class="line">  <span class="built_in">Object</span>.keys(obj).forEach(<span class="function"><span class="params">k</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (isBox(obj[k])) &#123;</span><br><span class="line">      res[k] = obj[k]</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      res[k] = &#123;</span><br><span class="line">        <span class="keyword">get</span>: () =&gt; obj[k],</span><br><span class="line">        <span class="keyword">set</span>: (v: any) =&gt; (obj[k] = v),</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  return res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br></p>
<p>ä¸‹é¢æ˜¯å®ƒä»¬çš„ç®€å•ç”¨æ³•ä»‹ç»(è¯¦ç»†ç”¨æ³•è§<a href="https://mobx.js.org/refguide/observable.html" target="_blank" rel="noopener">å®˜æ–¹æ–‡æ¡£</a>)</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; reactive, box, computed &#125; <span class="keyword">from</span> <span class="string">'mpos'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * âš›ï¸ reactive å¯ä»¥ç”¨äºè½¬æ¢ Mapã€Setã€æ•°ç»„ã€å¯¹è±¡ä¸ºå“åº”å¼æ•°æ®</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> data = reactive(&#123;<span class="attr">foo</span>: <span class="string">'bar'</span>&#125;)</span><br><span class="line">data.foo = <span class="string">'baz'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// reactive å†…éƒ¨ä½¿ç”¨Proxy å®ç°æ•°æ®å“åº”ï¼Œä»–ä¼šè¿”å›ä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œä¸ä¼šå½±å“åŸå§‹å¯¹è±¡</span></span><br><span class="line"><span class="keyword">const</span> initialState = &#123; <span class="attr">firstName</span>: <span class="string">"Clive Staples"</span>, <span class="attr">lastName</span>: <span class="string">"Lewis"</span> &#125;</span><br><span class="line"><span class="keyword">const</span> person = reactive(initialState)</span><br><span class="line">person.firstName = <span class="string">'Kobe'</span></span><br><span class="line">person.firstName <span class="comment">// "Kobe"</span></span><br><span class="line">initialState.firstName <span class="comment">// "Clive Staples"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è½¬æ¢æ•°ç»„</span></span><br><span class="line"><span class="keyword">const</span> arr = reactive([])</span><br><span class="line">arr.push(<span class="number">1</span>)</span><br><span class="line">arr[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * âš›ï¸ ä¸€èˆ¬æƒ…å†µä¸‹éƒ½ä½¿ç”¨reactiveï¼Œå¦‚æœä½ è¦è½¬æ¢åŸå§‹ç±»å‹ä¸ºå“åº”å¼æ•°æ®</span></span><br><span class="line"><span class="comment"> * æˆ–è€…è¿›è¡Œæ•°æ®ä¼ é€’ï¼Œå¯ä»¥ç”¨ box</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> temperature = box(<span class="number">20</span>)</span><br><span class="line">temperature.set(<span class="number">37</span>)</span><br><span class="line">temperature.get() <span class="comment">// 37</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * âš›ï¸ è¡ç”Ÿæ•°æ®è®¡ç®—, å®ƒä»¬ä¹Ÿå…·æœ‰å“åº”ç‰¹æ€§ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> fullName = computed(<span class="function"><span class="params">()</span> =&gt;</span> <span class="string">`<span class="subst">$&#123;person.firstName&#125;</span> <span class="subst">$&#123;person.lastName&#125;</span>`</span>)</span><br><span class="line">fullName.get() <span class="comment">// "Kobe Lewis"</span></span><br></pre></td></tr></table></figure>
<p><br><br><br></p>
<h3 id="å…³äº-vue-composition-api-ref"><a href="#å…³äº-vue-composition-api-ref" class="headerlink" title="å…³äº Vue Composition API ref"></a>å…³äº Vue Composition API ref</h3><p>ä¸Šé¢è¯´äº†ï¼Œ<strong>VCA çš„ ref å‡½æ•°ç­‰ä»·äº Mobx çš„ box å‡½æ•°</strong>ã€‚å¯ä»¥å°†åŸå§‹ç±»å‹åŒ…è£…ä¸ºâ€™å“åº”å¼æ•°æ®â€™(æœ¬è´¨ä¸Šå°±æ˜¯åˆ›å»ºä¸€ä¸ªreactiveå¯¹è±¡ï¼Œç›‘å¬getter/setteræ–¹æ³•), å› æ­¤ ref ä¹Ÿè¢« ç§°ä¸º<strong>åŒ…è£…å¯¹è±¡</strong>(Mobx çš„ box å‘½åæ›´è´´åˆ‡):</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Vue</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> count = ref(<span class="number">0</span>)</span><br><span class="line"><span class="built_in">console</span>.log(count.value) <span class="comment">// 0</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p>ä½ å¯ä»¥è¿™æ ·ç†è§£, ref å†…éƒ¨å°±æ˜¯ä¸€ä¸ª <code>computed</code> å°è£…(å½“ç„¶æ˜¯å‡çš„):</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Vue</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ref</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> data = reactive(&#123;value&#125;)</span><br><span class="line">  <span class="keyword">return</span> computed(&#123;</span><br><span class="line">    <span class="keyword">get</span>: () =&gt; data.value,</span><br><span class="line">    <span class="keyword">set</span>: val =&gt; data.value = val</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// æˆ–è€…è¿™æ ·ç†è§£ä¹Ÿå¯ä»¥</span><br><span class="line">function ref(value) &#123;</span><br><span class="line">  <span class="keyword">const</span> data = reactive(&#123;value&#125;)</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="keyword">get</span> value() &#123; <span class="keyword">return</span> data.value &#125;,</span><br><span class="line">    <span class="keyword">set</span> value(val) &#123; data.value = val &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br></p>
<p>åªä¸è¿‡å®ƒä»¬éœ€è¦é€šè¿‡ <code>value</code> å±æ€§æ¥å­˜å–å€¼ï¼Œæœ‰æ—¶å€™ä»£ç æ˜¾å¾—æœ‰ç‚¹å•°å—¦ã€‚<strong>å› æ­¤ VCA åœ¨æŸäº›åœ°æ–¹æ”¯æŒå¯¹ ref å¯¹è±¡è¿›è¡Œ<code>è‡ªåŠ¨è§£åŒ…(Unwrap, ä¹Ÿç§°è‡ªåŠ¨å±•å¼€)</code></strong>, ä¸è¿‡ç›®å‰è‡ªåŠ¨è§£åŒ…ï¼Œä»…é™äºè¯»å–ã€‚ ä¾‹å¦‚:</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1ï¸âƒ£ ä½œä¸ºreactive å€¼æ—¶</span></span><br><span class="line"><span class="keyword">const</span> state = reactive(&#123;</span><br><span class="line">  count                  <span class="comment">// å¯ä»¥èµ‹å€¼ç»™ reactive å±æ€§</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">console</span>.log(state.count) <span class="comment">// 0 ç­‰ä»·äº state.count.value</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è‡ªåŠ¨å±•å¼€æœ‰æ—¶å€™ä¼šè®©äººå›°æƒ‘ï¼Œè¿™é‡Œæœ‰ä¸ªé™·é˜±ï¼Œä¼šå¯¼è‡´åŸæœ‰çš„ ref å¯¹è±¡è¢«è¦†ç›–</span></span><br><span class="line">state.count = <span class="number">1</span>          <span class="comment">// è¢«è¦†ç›–æ‰äº†, count å±æ€§ç°åœ¨æ˜¯ 1, è€Œä¸æ˜¯ Ref&lt;count&gt;</span></span><br><span class="line"><span class="built_in">console</span>.log(count.value) <span class="comment">// 0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2ï¸âƒ£ ä¼ é€’ç»™æ¨¡æ¿æ—¶ï¼Œæ¨¡æ¿å¯ä»¥è‡ªåŠ¨è§£åŒ…</span></span><br><span class="line"><span class="comment">//  </span></span><br><span class="line"><span class="comment">// &lt;button @click="increment"&gt;&#123;&#123; count &#125;&#125;&lt;/button&gt;</span></span><br><span class="line"><span class="comment">// ç­‰ä»·äº</span></span><br><span class="line"><span class="comment">// &lt;button @click="increment"&gt;&#123;&#123; count.value &#125;&#125;&lt;/button&gt;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3ï¸âƒ£ æ”¯æŒç›´æ¥ watch</span></span><br><span class="line">watch(count, (cur, prev) =&gt; &#123; <span class="comment">// ç­‰ä»·äº watch(() =&gt; count.value, (cur, prev) =&gt; &#123;&#125;)</span></span><br><span class="line">  <span class="built_in">console</span>.log(cur) <span class="comment">// ç›´æ¥æ‹¿åˆ°çš„æ˜¯ ref çš„å€¼ï¼Œæ‰€ä»¥ä¸éœ€è¦ cur.value è¿™æ ·è·å–</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><br></p>
<p>å¦å¤– VCA çš„ computed å®é™…ä¸Šå°±æ˜¯è¿”å› ref å¯¹è±¡:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> double = computed(<span class="function"><span class="params">()</span> =&gt;</span> state.count * <span class="number">2</span>)</span><br><span class="line"><span class="built_in">console</span>.log(double.value) <span class="comment">// 2</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p>ğŸ¤” VSA å’Œ Mobx çš„ API æƒŠäººçš„ç›¸ä¼¼ã€‚æƒ³å¿… Vue ä¸å°‘å€Ÿé‰´äº† Mobx.</p>
<p><br><br><br></p>
<h3 id="ä¸ºä»€ä¹ˆéœ€è¦-ref"><a href="#ä¸ºä»€ä¹ˆéœ€è¦-ref" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦ ref?"></a>ä¸ºä»€ä¹ˆéœ€è¦ ref?</h3><p>å“åº”å¼å¯¹è±¡æœ‰ä¸€ä¸ªå¹¿ä¸ºäººçŸ¥çš„é™·é˜±ï¼Œå¦‚æœä½ å¯¹å“åº”å¼å¯¹è±¡è¿›è¡Œè§£æ„ã€å±•å¼€ï¼Œæˆ–è€…å°†å…·ä½“çš„å±æ€§ä¼ é€’ç»™å˜é‡æˆ–å‚æ•°ï¼Œé‚£ä¹ˆå¯èƒ½ä¼šå¯¼è‡´å“åº”ä¸¢å¤±ã€‚ çœ‹ä¸‹é¢çš„ä¾‹å­, æ€è€ƒä¸€ä¸‹å“åº”æ˜¯æ€ä¹ˆä¸¢å¤±çš„:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> data = reactive(&#123;<span class="attr">count</span>: <span class="number">1</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// è§£æ„, å“åº”ä¸¢å¤±äº†.</span></span><br><span class="line"><span class="comment">// è¿™æ—¶å€™ count åªæ˜¯ä¸€ä¸ªæ™®é€šçš„ã€å€¼ä¸º1çš„å˜é‡.</span></span><br><span class="line"><span class="comment">// reactive å¯¹è±¡å˜åŠ¨ä¸ä¼šä¼ å¯¼åˆ° count</span></span><br><span class="line"><span class="comment">// ä¿®æ”¹å˜é‡æœ¬èº«ï¼Œæ›´ä¸ä¼šå½±å“åˆ°åŸæœ¬çš„reactive å¯¹è±¡</span></span><br><span class="line"><span class="keyword">let</span> &#123; count &#125; = data</span><br></pre></td></tr></table></figure>
<p><br></p>
<p>å› ä¸º Javascript <strong>åŸå§‹å€¼</strong>æ˜¯<strong>æŒ‰å€¼ä¼ é€’</strong>çš„ï¼Œè¿™æ—¶å€™ä¼ é€’ç»™å˜é‡ã€å¯¹è±¡å±æ€§æˆ–è€…å‡½æ•°å‚æ•°ï¼Œå¼•ç”¨å°±ä¼šä¸¢å¤±ã€‚<strong>ä¸ºäº†ä¿è¯ â€˜å®‰å…¨å¼•ç”¨â€™, æˆ‘ä»¬æ‰éœ€è¦ç”¨â€™å¯¹è±¡â€™æ¥åŒ…è£¹è¿™äº›å€¼ï¼Œæˆ‘ä»¬æ€»æ˜¯å¯ä»¥é€šè¿‡è¿™ä¸ªå¯¹è±¡è·å–åˆ°æœ€æ–°çš„å€¼</strong>:</p>
<p><img src="/images/react-composition/pass-by-reference-vs-pass-by-value-animation.gif" alt></p>
<p><br></p>
<p>å…³äº VCA çš„ refï¼Œè¿˜æœ‰ <a href="https://vue-composition-api-rfc.netlify.com/api.html#torefs" target="_blank" rel="noopener"><code>toRefs</code></a> å€¼å¾—æä¸€ä¸‹ã€‚ <strong>toRefs å¯ä»¥å°† reactive å¯¹è±¡çš„æ¯ä¸ªå±æ€§éƒ½è½¬æ¢ä¸º ref å¯¹è±¡ï¼Œè¿™æ ·å¯ä»¥å®ç°å¯¹è±¡è¢«è§£æ„æˆ–è€…å±•å¼€çš„æƒ…å†µä¸‹ï¼Œä¸ä¸¢å¤±å“åº”</strong>:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Vue ä»£ç </span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨toRefs è½¬æ¢</span></span><br><span class="line"><span class="keyword">const</span> state = reactive(&#123;<span class="attr">count</span>: <span class="number">1</span>&#125;)</span><br><span class="line"><span class="keyword">const</span> stateRef = toRefs(state) <span class="comment">// è½¬æ¢æˆäº† Reactive&lt;&#123;count: Ref&lt;state.count&gt;&#125;&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿™æ—¶å€™å¯ä»¥å®‰å…¨åœ°è¿›è¡Œè§£æ„å’Œä¼ é€’å±æ€§</span></span><br><span class="line"><span class="keyword">const</span> &#123; count &#125; = stateRef</span><br><span class="line"></span><br><span class="line">count.value    <span class="comment">// 1</span></span><br><span class="line">state.count    <span class="comment">// 1 ä¸‰è€…æŒ‡å‘åŒä¸€ä¸ªå€¼</span></span><br><span class="line">stateRef.count.value <span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line">state.count++ <span class="comment">// æ›´æ–°æº state</span></span><br><span class="line">count.value   <span class="comment">// 2 å“åº”åˆ° ref</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p>ç®€å•å®ç°ä¸€ä¸‹ toRefs, æ²¡ä»€ä¹ˆé»‘é­”æ³•:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Vue ä»£ç </span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">toRefs</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> res = &#123;&#125;</span><br><span class="line">  <span class="built_in">Object</span>.keys(obj).forEach(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (isRef(obj[key])) &#123;</span><br><span class="line">      res[key] = obj[key]</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      res[key] = &#123;</span><br><span class="line">        <span class="keyword">get</span> value() &#123;</span><br><span class="line">          <span class="keyword">return</span> obj[key]</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="keyword">set</span> value(val) &#123;</span><br><span class="line">          obj[key] = val</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br></p>
<p>toRefs è§£å†³ reactive å¯¹è±¡å±æ€§å€¼è§£æ„å’Œå±•å¼€å¯¼è‡´å“åº”ä¸¢å¤±é—®é¢˜ã€‚é…åˆ<strong>è‡ªåŠ¨è§£åŒ…</strong>ï¼Œä¸è‡³äºè®©ä»£ç å˜å¾—å•°å—¦(å°½ç®¡æœ‰é™åˆ¶).</p>
<p><br></p>
<p> <strong>å¯¹äº VCA æ¥è¯´ï¼Œâ‘  ref é™¤äº†å¯ä»¥ç”¨äºå°è£…åŸå§‹ç±»å‹ï¼Œæ›´é‡è¦çš„ä¸€ç‚¹æ˜¯ï¼šâ‘¡ å®ƒæ˜¯ä¸€ä¸ªâ€™è§„èŒƒâ€™çš„æ•°æ®è½½ä½“ï¼Œå®ƒå¯ä»¥åœ¨ Hooks ä¹‹é—´è¿›è¡Œæ•°æ®ä¼ é€’ï¼›ä¹Ÿå¯ä»¥æš´éœ²ç»™ç»„ä»¶å±‚ï¼Œç”¨äºå¼•ç”¨ä¸€äº›å¯¹è±¡ï¼Œä¾‹å¦‚å¼•ç”¨DOMç»„ä»¶å®ä¾‹</strong>ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­, ä¸‹é¢çš„ <code>useOnline</code> Hook, è¿™ä¸ª Hooks åªè¿”å›ä¸€ä¸ªçŠ¶æ€:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Vue ä»£ç </span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useOnline</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> online = ref(<span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line">  online.value = navigator.onLine</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> handleOnline = <span class="function"><span class="params">()</span> =&gt;</span> (online.value = <span class="literal">true</span>)</span><br><span class="line">  <span class="keyword">const</span> handleOffline = <span class="function"><span class="params">()</span> =&gt;</span> (online.value = <span class="literal">false</span>)</span><br><span class="line">  <span class="built_in">window</span>.addEventListener(<span class="string">'online'</span>, handleOnline)</span><br><span class="line">  <span class="built_in">window</span>.addEventListener(<span class="string">'offline'</span>, handleOffline)</span><br><span class="line"></span><br><span class="line">  onUnmounted(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">window</span>.removeEventListener(<span class="string">'online'</span>, handleOnline)</span><br><span class="line">    <span class="built_in">window</span>.removeEventListener(<span class="string">'offline'</span>, handleOffline)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è¿”å›ä¸€ä¸ª ref</span></span><br><span class="line">  <span class="comment">// å¦‚æœè¿™æ—¶å€™è¿”å›ä¸€ä¸ª reactive å¯¹è±¡ï¼Œä¼šæ˜¾å¾—æœ‰ç‚¹å¥‡æ€ª</span></span><br><span class="line">  <span class="keyword">return</span> online</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br></p>
<p>å¦‚æœ useOnline è¿”å›ä¸€ä¸ª reactive å¯¹è±¡, ä¼šæ˜¾å¾—æœ‰ç‚¹æ€ª:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Vue ä»£ç </span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿™æ ·å­ï¼Ÿ online å¯èƒ½ä¼šä¸¢å¤±å“åº”</span></span><br><span class="line"><span class="keyword">const</span> &#123; online &#125; = useOnline() <span class="comment">// è¿”å› Reactive&lt;&#123;online: boolean&#125;&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ€ä¹ˆç¡®å®šå±æ€§å‘½åï¼Ÿ</span></span><br><span class="line"><span class="keyword">const</span> online = useOnline()</span><br><span class="line">watch(<span class="function"><span class="params">()</span> =&gt;</span> online.online)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰€ä»¥æˆ‘ä»¬éœ€è¦è§„èŒƒï¼Œè¿™ä¸ªè§„èŒƒå¯ä»¥å¸®æˆ‘ä»¬è§„é¿é™·é˜±ï¼Œä¹Ÿç»Ÿä¸€äº†ä½¿ç”¨æ–¹å¼</span></span><br><span class="line"><span class="comment">// æ›´è§„èŒƒçš„è¿”å›ä¸€ä¸ª refï¼Œä½¿ç”¨ value æ¥è·å–å€¼</span></span><br><span class="line">watch(<span class="function"><span class="params">()</span> =&gt;</span> online.value)</span><br><span class="line"><span class="comment">// å¯ä»¥æ›´æ–¹ä¾¿åœ°è¿›è¡Œç›‘å¬</span></span><br><span class="line">wacth(online, (ol) =&gt; &#123;</span><br><span class="line">  <span class="comment">// ç›´æ¥æ‹¿åˆ° online.value</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><br></p>
<p>å†çœ‹å¦ä¸€ä¸ªè¿”å›å¤šä¸ªå€¼çš„ä¾‹å­:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Vue ä»£ç </span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useMousePosition</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> pos = reactive(&#123;<span class="attr">x</span>: <span class="number">0</span>, <span class="attr">y</span>: <span class="number">0</span>&#125;)</span><br><span class="line">  <span class="keyword">const</span> update = <span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">    pos.x = e.pageX</span><br><span class="line">    pos.y = e.pageY</span><br><span class="line">  &#125;</span><br><span class="line">  onMounted(<span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">window</span>.addEventListener(<span class="string">'mousemove'</span>, update))</span><br><span class="line">  onUnmounted(<span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">window</span>.removeEventListener(<span class="string">'mousemove'</span>, update))</span><br><span class="line">  <span class="comment">// è¿”å›å¤šä¸ªå€¼ï¼Œå¯ä»¥ä½¿ç”¨ toRefs æ‰¹é‡è½¬æ¢</span></span><br><span class="line">  <span class="keyword">return</span> toRefs(pos)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useMyHook</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// å®‰å…¨åœ°ä½¿ç”¨è§£æ„è¡¨è¾¾å¼</span></span><br><span class="line">  <span class="keyword">const</span> &#123; x, y &#125; = useMousePosition()</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ... do something</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// å®‰å…¨åœ°è¾“å‡º</span></span><br><span class="line">  <span class="keyword">return</span> &#123; x, y &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br></p>
<p><strong>å› æ­¤å®˜æ–¹ä¹Ÿæ¨èä½¿ç”¨ ref å¯¹è±¡æ¥è¿›è¡Œæ•°æ®ä¼ é€’ï¼ŒåŒæ—¶ä¿æŒå“åº”çš„ä¼ å¯¼</strong>ã€‚å°±åˆ°è¿™å§ï¼Œä¸ç„¶å†™ç€å†™ç€å°±å˜æˆ VCA çš„æ–‡æ¡£äº†ğŸŒšã€‚</p>
<p><br><br><br></p>
<h3 id="ref-å’Œ-useref"><a href="#ref-å’Œ-useref" class="headerlink" title="ref å’Œ useRef"></a>ref å’Œ useRef</h3><p>VCA ref è¿™ä¸ªå‘½åä¼šè®© React å¼€å‘è€…å°†å…¶å’Œ <code>useRef</code> è”æƒ³åœ¨ä¸€èµ·ã€‚çš„ç¡®ï¼ŒVCA çš„ ref åœ¨ç»“æ„ã€åŠŸèƒ½å’ŒèŒè´£ä¸Šè·Ÿ React çš„ useRef å¾ˆåƒã€‚ä¾‹å¦‚ <a href="https://vue-composition-api-rfc.netlify.com/api.html#template-refs" target="_blank" rel="noopener">ref ä¹Ÿå¯ä»¥ç”¨äºå¼•ç”¨ Virtual DOMçš„èŠ‚ç‚¹å®ä¾‹</a>:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Vue ä»£ç </span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  setup() &#123;</span><br><span class="line">    <span class="keyword">const</span> root = ref(<span class="literal">null</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// with JSX</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &lt;div ref=&#123;root&#125;/&gt;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br></p>
<p>ä¸ºäº†é¿å…å’Œç°æœ‰çš„ useRef å†²çªï¼Œè€Œä¸”åœ¨æˆ‘ä»¬ä¹Ÿä¸æ‰“ç®—å®ç° ref è‡ªåŠ¨è§£åŒ…è¯¸å¦‚æ­¤ç±»çš„åŠŸèƒ½ã€‚å› æ­¤åœ¨æˆ‘ä»¬ä¼šæ²¿ç”¨ Mobx çš„ box å‘½åï¼Œå¯¹åº”çš„è¿˜æœ‰isBox, toBoxes å‡½æ•°ã€‚</p>
<p><br></p>
<p>é‚£æ€ä¹ˆå¼•ç”¨ Virtual DOM èŠ‚ç‚¹å‘¢ï¼Ÿ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ React çš„ <a href="https://reactjs.org/docs/react-api.html#reactcreateref" target="_blank" rel="noopener"><code>createRef()</code></a> å‡½æ•°ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// React ä»£ç </span></span><br><span class="line"><span class="keyword">import</span> &#123; createRef &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"></span><br><span class="line">createComponent(&#123;</span><br><span class="line">  setup(<span class="function"><span class="params">props</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> containerRef = createRef()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &lt;div className=<span class="string">"container"</span> ref=&#123;containerRef&#125;&gt;?...?<span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><br><br><br></p>
<h2 id="ç”Ÿå‘½å‘¨æœŸæ–¹æ³•"><a href="#ç”Ÿå‘½å‘¨æœŸæ–¹æ³•" class="headerlink" title="ç”Ÿå‘½å‘¨æœŸæ–¹æ³•"></a>ç”Ÿå‘½å‘¨æœŸæ–¹æ³•</h2><p>æ¥ä¸‹æ¥çœ‹çœ‹æ€ä¹ˆå®ç° useMounted è¿™äº›ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ã€‚è¿™äº›æ–¹æ³•æ˜¯å…¨å±€ã€é€šç”¨çš„ï¼Œæ€ä¹ˆå…³è”åˆ°å…·ä½“çš„ç»„ä»¶ä¸Šå‘¢ï¼Ÿ</p>
<p>è¿™ä¸ªå¯ä»¥å€Ÿé‰´ React Hooks çš„å®ç°ï¼Œå½“ setup() è¢«è°ƒç”¨æ—¶ï¼Œåœ¨ä¸€ä¸ªå…¨å±€å˜é‡ä¸­ä¿å­˜å½“å‰ç»„ä»¶çš„ä¸Šä¸‹æ–‡ï¼Œç”Ÿå‘½å‘¨æœŸæ–¹æ³•å†ä»è¿™ä¸ªä¸Šä¸‹æ–‡ä¸­å­˜å–ä¿¡æ¯ã€‚</p>
<p>æ¥çœ‹ä¸€ä¸‹ initial çš„å¤§æ¦‚å®ç°:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// âš›ï¸ å…¨å±€å˜é‡, è¡¨ç¤ºå½“å‰æ­£åœ¨æ‰§è¡Œçš„ setup çš„ä¸Šä¸‹æ–‡</span></span><br><span class="line"><span class="keyword">let</span> compositionContext: CompositionContext | <span class="literal">undefined</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * initial æ–¹æ³•æ¥å—ä¸€ä¸ª setup æ–¹æ³•ï¼Œ è¿”å›ä¸€ä¸ª useComposition Hooks</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">initial</span>&lt;<span class="title">Props</span> <span class="title">extends</span> <span class="title">object</span>, <span class="title">Rtn</span>, <span class="title">Ref</span>&gt;(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  setup: (props: Props</span>) =&gt; <span class="title">Rtn</span>,</span></span><br><span class="line"><span class="function">) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">useComposition</span>(<span class="params">props: Props, ref?: React.RefObject&lt;Ref&gt;</span>): <span class="title">Rtn</span> </span>&#123;</span><br><span class="line">    <span class="comment">// âš›ï¸ ä½¿ç”¨ useRef ç”¨æ¥ä¿å­˜å½“å‰çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚ useRefï¼Œå¯ä»¥ä¿è¯å¼•ç”¨ä¸å˜</span></span><br><span class="line">    <span class="keyword">const</span> context = useRef&lt;CompositionContext | <span class="literal">undefined</span>&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¦‚æœå½“å‰ä¸Šä¸‹æ–‡ä¸ºç©ºï¼Œåˆ™å¼€å§‹åˆå§‹åŒ–</span></span><br><span class="line">    <span class="comment">// âš›ï¸ æˆ‘ä»¬è¿™æ ·å®ç°äº† setup åªè¢«è°ƒç”¨ä¸€æ¬¡!</span></span><br><span class="line">    <span class="keyword">if</span> (context.current == <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="comment">// åˆ›å»º Composition ä¸Šä¸‹æ–‡</span></span><br><span class="line">      <span class="keyword">const</span> ctx = (context.current = createCompositionContext(props));</span><br><span class="line"></span><br><span class="line">      <span class="comment">// âš›ï¸ è¿›å…¥å½“å‰ç»„ä»¶çš„ä¸Šä¸‹æ–‡ä½œç”¨åŸŸ</span></span><br><span class="line">      <span class="keyword">const</span> prevCtx = compositionContext;</span><br><span class="line">      compositionContext = ctx;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// âš›ï¸ **è°ƒç”¨ setup, å¹¶ç¼“å­˜è¿”å›å€¼**</span></span><br><span class="line">      ctx._instance = setup(ctx._props);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// âš›ï¸ ç¦»å¼€å½“å‰ç»„ä»¶çš„ä¸Šä¸‹æ–‡ä½œç”¨åŸŸ, æ¢å¤</span></span><br><span class="line">      compositionContext = prevCtx;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ... å…¶ä»–ï¼Œä¸‹æ–‡å±•å¼€</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿”å› setup çš„è¿”å›å€¼</span></span><br><span class="line">    <span class="keyword">return</span> context.current._instance!;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br></p>
<p>Okï¼Œç°åœ¨ç”Ÿå‘½å‘¨æœŸæ–¹æ³•å®ç°åŸç†å·²ç»æµ®å‡ºæ°´é¢, å½“è¿™äº›æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œåªæ˜¯ç®€å•åœ°åœ¨ compositionContext ä¸­æ³¨å†Œå›è°ƒ, ä¾‹å¦‚:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">onMounted</span>(<span class="params">cb: (</span>) =&gt; <span class="title">any</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// âš›ï¸ è·å–å½“å‰ä¸Šä¸‹æ–‡</span></span><br><span class="line">  <span class="keyword">const</span> ctx = assertCompositionContext();</span><br><span class="line">  <span class="comment">// æ³¨å†Œå›è°ƒ</span></span><br><span class="line">  ctx.addMounted(cb);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">onUnmount</span>(<span class="params">cb: (</span>) =&gt; <span class="title">void</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> ctx = assertCompositionContext();</span><br><span class="line">  ctx.addDisposer(cb);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">onUpdated</span>(<span class="params">cb: (</span>) =&gt; <span class="title">void</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> ctx = assertCompositionContext();</span><br><span class="line">  ctx.addUpdater(cb);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br></p>
<p>assertCompositionContext è·å– compositionContextï¼Œå¦‚æœä¸åœ¨ <code>setup</code> ä½œç”¨åŸŸä¸‹è°ƒç”¨åˆ™æŠ›å‡ºå¼‚å¸¸.</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">assertCompositionContext</span>(<span class="params"></span>): <span class="title">CompositionContext</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (compositionContext == <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">`è¯·åœ¨ setup ä½œç”¨åŸŸä½¿ç”¨`</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> compositionContext;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br></p>
<p>çœ‹ä¸€ä¸‹ CompositionContext æ¥å£çš„å¤–å½¢:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">interface CompositionContext&lt;P = any, R = any&gt; &#123;</span><br><span class="line">  <span class="comment">// æ·»åŠ æŒ‚è½½å›è°ƒ</span></span><br><span class="line">  addMounted: <span class="function">(<span class="params">cb: (</span>) =&gt;</span> any) =&gt; <span class="keyword">void</span>;</span><br><span class="line">  <span class="comment">// æ·»åŠ é‡æ–°æ¸²æŸ“å›è°ƒ</span></span><br><span class="line">  addUpdater: <span class="function">(<span class="params">cb: (</span>) =&gt;</span> <span class="keyword">void</span>) =&gt; <span class="keyword">void</span>;</span><br><span class="line">  <span class="comment">// æ·»åŠ å¸è½½å›è°ƒ</span></span><br><span class="line">  addDisposer: <span class="function">(<span class="params">cb: (</span>) =&gt;</span> <span class="keyword">void</span>) =&gt; <span class="keyword">void</span>;</span><br><span class="line">  <span class="comment">// æ³¨å†Œ React.Context ä¸‹æ–‡ä¼šä»‹ç»</span></span><br><span class="line">  addContext: &lt;T&gt;(ctx: React.Context&lt;T&gt;) =&gt; T;</span><br><span class="line">  // æ·»åŠ é€šè¿‡refæš´éœ²ç»™å¤–éƒ¨çš„å¯¹è±¡, ä¸‹æ–‡ä¼šä»‹ç»</span><br><span class="line">  addExpose: (value: any) =&gt; void</span><br><span class="line"></span><br><span class="line">  /** ç§æœ‰å±æ€§ **/</span><br><span class="line">  // props å¼•ç”¨</span><br><span class="line">  _props: P;</span><br><span class="line">  // è¡¨ç¤ºæ˜¯å¦å·²æŒ‚è½½</span><br><span class="line">  _isMounted: boolean;</span><br><span class="line">  // setup() çš„è¿”å›å€¼</span><br><span class="line">  _instance?: R;</span><br><span class="line">  _disposers: Array&lt;() =&gt; void&gt;;</span><br><span class="line">  _mounted: Array&lt;() =&gt; any&gt;;</span><br><span class="line">  _updater: Array&lt;() =&gt; void&gt;;</span><br><span class="line">  _contexts: Map&lt;React.Context&lt;any&gt;, &#123; value: any; updater: () =&gt; void &#125;&gt;</span><br><span class="line">  _exposer?: () =&gt; any</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br></p>
<p><code>addMounted</code>ã€<code>addUpdater</code> è¿™äº›æ–¹æ³•å®ç°éƒ½å¾ˆç®€å•, åªæ˜¯ç®€å•æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createCompositionContext</span>&lt;<span class="title">P</span>, <span class="title">R</span>&gt;(<span class="params">props: P</span>): <span class="title">CompositionContext</span>&lt;<span class="title">P</span>, <span class="title">R</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> ctx = &#123;</span><br><span class="line">    addMounted: <span class="function"><span class="params">cb</span> =&gt;</span> ctx._mounted.push(cb),</span><br><span class="line">    addUpdater: <span class="function"><span class="params">cb</span> =&gt;</span> ctx._updater.push(cb),</span><br><span class="line">    addDisposer: <span class="function"><span class="params">cb</span> =&gt;</span> ctx._disposers.push(cb),</span><br><span class="line">    addContext: <span class="function"><span class="params">c</span> =&gt;</span> &#123;<span class="comment">/* ...  */</span>&#125; ,</span><br><span class="line">    _isMounted: <span class="literal">false</span>,</span><br><span class="line">    _instance: <span class="literal">undefined</span>,</span><br><span class="line">    _mounted: [],</span><br><span class="line">    _updater: [],</span><br><span class="line">    _disposers: [],</span><br><span class="line">    _contexts: <span class="keyword">new</span> <span class="built_in">Map</span>(),</span><br><span class="line">    _props: observable(props, &#123;&#125;, &#123; <span class="attr">deep</span>: <span class="literal">false</span>, <span class="attr">name</span>: <span class="string">"props"</span> &#125;)</span><br><span class="line">    _exposer: <span class="literal">undefined</span>,</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> ctx;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br></p>
<p>å…³é”®å®ç°è¿˜æ˜¯å¾—å›åˆ° initial æ–¹æ³•ä¸­:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">initial</span>&lt;<span class="title">Props</span> <span class="title">extends</span> <span class="title">object</span>, <span class="title">Rtn</span>, <span class="title">Ref</span>&gt;(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  setup: (props: Props</span>) =&gt; <span class="title">Rtn</span>,</span></span><br><span class="line"><span class="function">) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">useComposition</span>(<span class="params">props: Props, ref?: React.RefObject&lt;Ref&gt;</span>): <span class="title">Rtn</span> </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> context = useRef&lt;CompositionContext | <span class="literal">undefined</span>&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (context.current == <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="comment">// åˆå§‹åŒ–....</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// âš›ï¸ æ¯æ¬¡é‡æ–°æ¸²æŸ“, è°ƒç”¨ onUpdated ç”Ÿå‘½å‘¨æœŸé’©å­</span></span><br><span class="line">    useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> ctx = context.current;</span><br><span class="line">      <span class="comment">// é¦–æ¬¡æŒ‚è½½æ—¶ä¸è°ƒç”¨</span></span><br><span class="line">      <span class="keyword">if</span> (ctx._isMounted) executeCallbacks(ctx._updater);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// âš›ï¸ æŒ‚è½½</span></span><br><span class="line">    useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> ctx = context.current;</span><br><span class="line">      ctx._isMounted = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// âš›ï¸ è°ƒç”¨ useMounted ç”Ÿå‘½å‘¨æœŸé’©å­</span></span><br><span class="line">      <span class="keyword">if</span> (ctx._mounted.length) &#123;</span><br><span class="line">        ctx._mounted.forEach(<span class="function"><span class="params">cb</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="comment">// âš›ï¸ useMounted å¦‚æœè¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œåˆ™æ·»åŠ åˆ°disposerä¸­ï¼Œå¸è½½å‰è°ƒç”¨</span></span><br><span class="line">          <span class="keyword">const</span> rt = cb();</span><br><span class="line">          <span class="keyword">if</span> (<span class="keyword">typeof</span> rt === <span class="string">"function"</span>) &#123;</span><br><span class="line">            ctx.addDisposer(rt);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        ctx._mounted = EMPTY_ARRAY; <span class="comment">// é‡Šæ”¾æ‰</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// âš›ï¸ è°ƒç”¨ onUnmount ç”Ÿå‘½å‘¨æœŸé’©å­</span></span><br><span class="line">      <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> executeCallbacks(ctx._disposers);</span><br><span class="line">    &#125;, []);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br></p>
<p>æ²¡é”™ï¼Œè¿™äº›ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼Œæœ€ç»ˆè¿˜æ˜¯ç”¨ useEffect æ¥å®ç°ã€‚</p>
<p><br><br><br></p>
<h2 id="watch"><a href="#watch" class="headerlink" title="watch"></a>watch</h2><p>æ¥ä¸‹æ¥çœ‹çœ‹ watch æ–¹æ³•çš„å®ç°ã€‚watch ä¼°è®¡æ˜¯é™¤äº† reactive å’Œ ref ä¹‹å¤–è°ƒç”¨çš„æœ€é¢‘ç¹çš„å‡½æ•°äº†ã€‚</p>
<p>watch æ–¹æ³•å¯ä»¥é€šè¿‡ Mobx çš„ <code>authrun</code> å’Œ <code>reaction</code> æ–¹æ³•æ¥å®ç°ã€‚æˆ‘ä»¬è¿›è¡Œç®€å•çš„å°è£…ï¼Œè®©å®ƒæ›´æ¥è¿‘ Vue çš„watch å‡½æ•°çš„è¡Œä¸ºã€‚</p>
<p>è¿™é‡Œæœ‰ä¸€ä¸ªè¦ç‚¹æ˜¯: watch å³å¯ä»¥åœ¨setup ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ï¼Œä¹Ÿå¯ä»¥è£¸éœ²è°ƒç”¨ã€‚åœ¨setup ä¸Šä¸‹æ–‡è°ƒç”¨æ—¶ï¼Œæ”¯æŒç»„ä»¶å¸è½½å‰è‡ªåŠ¨é‡Šæ”¾ç›‘å¬ã€‚ å¦‚æœè£¸éœ²è°ƒç”¨ï¼Œåˆ™éœ€è¦å¼€å‘è€…è‡ªå·±æ¥é‡Šæ”¾ç›‘å¬:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åœ¨ setup ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ï¼Œwatch ä¼šåœ¨ç»„ä»¶å¸è½½åè‡ªåŠ¨è§£é™¤ç›‘å¬</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useMyHook</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> data = reactive(&#123;<span class="attr">count</span>: <span class="number">0</span>&#125;)</span><br><span class="line">  watch(<span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'count change'</span>, data.count))</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> data</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è£¸éœ²è°ƒç”¨ï¼Œéœ€è¦æ‰‹åŠ¨ç®¡ç†èµ„æºé‡Šæ”¾</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> stop = watch(<span class="function"><span class="params">()</span> =&gt;</span> someReactiveData, (data) =&gt; &#123;<span class="comment">/* reactiveData change */</span>&#125;)</span><br><span class="line">dosomething(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// æ‰‹åŠ¨é‡Šæ”¾</span></span><br><span class="line">  stop()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¦å¤–watch å›è°ƒå†…éƒ¨ä¹Ÿå¯ä»¥è·å–åˆ° stop æ–¹æ³•</span></span><br><span class="line"><span class="comment"> */</span> </span><br><span class="line">wacth(<span class="function">(<span class="params">stop</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (someReactiveData === <span class="number">0</span>) &#123;</span><br><span class="line">    stop()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line">watch(<span class="function"><span class="params">()</span> =&gt;</span> someReactiveData, (data, stop) =&gt; &#123;<span class="comment">/* reactiveData change */</span>&#125;)</span><br></pre></td></tr></table></figure>
<p><br></p>
<p>å¦å¤– watch çš„å›è°ƒæ”¯æŒè¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œç”¨æ¥é‡Šæ”¾å‰¯ä½œç”¨èµ„æºï¼Œè¿™ä¸ªè¡Œä¸ºå’Œ useEffect ä¿æŒä¸€è‡´ã€‚VCA çš„ watch ä½¿ç”¨onClean å›è°ƒæ¥é‡Šæ”¾èµ„æºï¼Œå› ä¸ºè€ƒè™‘åˆ° async/await å‡½æ•°ã€‚</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> timer = setInterval(<span class="function"><span class="params">()</span> =&gt;</span> &#123;<span class="comment">/* do something*/</span>&#125;, time)</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    clearInterval(timer)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;, [time])</span><br><span class="line"></span><br><span class="line"><span class="comment">// watch</span></span><br><span class="line">watch(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> timer = setInterval(<span class="function"><span class="params">()</span> =&gt;</span> &#123;<span class="comment">/* do something*/</span>&#125;, time)</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    clearInterval(timer)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><br></p>
<p>çœ‹çœ‹å®ç°ä»£ç :</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;reaction, autorun&#125; <span class="keyword">from</span> <span class="string">'mobx'</span></span><br><span class="line"><span class="keyword">export</span> type WatchDisposer = <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">void</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">watch</span>(<span class="params">view: (stop: WatchDisposer</span>) =&gt; <span class="title">any</span>, <span class="title">options</span>?: <span class="title">IAutorunOptions</span>): <span class="title">WatchDisposer</span>;</span></span><br><span class="line"><span class="function"><span class="title">export</span> <span class="title">function</span> <span class="title">watch</span>&lt;<span class="title">T</span>&gt;(<span class="params">expression: (</span>) =&gt; <span class="title">T</span>, <span class="title">effect</span>: (<span class="params">arg: T, stop: WatchDisposer</span>) =&gt; <span class="title">any</span>, <span class="title">options</span>?: <span class="title">IReactionOptions</span>): <span class="title">WatchDisposer</span>;</span></span><br><span class="line"><span class="function"><span class="title">export</span> <span class="title">function</span> <span class="title">watch</span>(<span class="params">expression: any, effect: any, options?: any</span>): <span class="title">WatchDisposer</span> </span>&#123;</span><br><span class="line">  <span class="comment">// æ”¾ç½® autorun æˆ–è€… reactive è¿”å›çš„é‡Šæ”¾å‡½æ•°</span></span><br><span class="line">  <span class="keyword">let</span> nativeDisposer: WatchDisposer;</span><br><span class="line">  <span class="comment">// æ”¾ç½®ä¸Šä¸€æ¬¡ watch å›è°ƒè¿”å›çš„å‰¯ä½œç”¨é‡Šæ”¾å‡½æ•°</span></span><br><span class="line">  <span class="keyword">let</span> effectDisposer: WatchDisposer | <span class="literal">undefined</span>;</span><br><span class="line">  <span class="comment">// æ˜¯å¦å·²ç»é‡Šæ”¾</span></span><br><span class="line">  <span class="keyword">let</span> disposed = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å°è£…é‡Šæ”¾å‡½æ•°ï¼Œæ”¯æŒè¢«é‡å¤è°ƒç”¨</span></span><br><span class="line">  <span class="keyword">const</span> stop = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (disposed) <span class="keyword">return</span>;</span><br><span class="line">    disposed = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">if</span> (effectDisposer) effectDisposer();</span><br><span class="line">    nativeDisposer();</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å°è£…å›è°ƒæ–¹æ³•</span></span><br><span class="line">  <span class="keyword">const</span> effectWrapper = <span class="function">(<span class="params">effect: (...args: any[]</span>) =&gt;</span> any, <span class="attr">argnum</span>: number) =&gt; (</span><br><span class="line">    ...args: any[]</span><br><span class="line">  ) =&gt; &#123;</span><br><span class="line">    <span class="comment">// é‡æ–°æ‰§è¡Œäº†å›è°ƒï¼Œé‡Šæ”¾ä¸Šä¸€ä¸ªå›è°ƒè¿”å›çš„é‡Šæ”¾æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">if</span> (effectDisposer != <span class="literal">null</span>) effectDisposer();</span><br><span class="line">    <span class="keyword">const</span> rtn = effect.apply(<span class="literal">null</span>, args.slice(<span class="number">0</span>, argnum).concat(stop));</span><br><span class="line">    effectDisposer = <span class="keyword">typeof</span> rtn === <span class="string">"function"</span> ? rtn : <span class="literal">undefined</span>;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> expression === <span class="string">"function"</span> &amp;&amp; <span class="keyword">typeof</span> effect === <span class="string">"function"</span>) &#123;</span><br><span class="line">    <span class="comment">// reaction</span></span><br><span class="line">    nativeDisposer = reaction(expression, effectWrapper(effect, <span class="number">1</span>), options);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// autorun</span></span><br><span class="line">    nativeDisposer = autorun(effectWrapper(expression, <span class="number">0</span>));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¦‚æœåœ¨ setup ä¸Šä¸‹æ–‡åˆ™æ·»åŠ åˆ°disposer é˜Ÿåˆ—ï¼Œåœ¨ç»„ä»¶å¸è½½æ—¶è‡ªåŠ¨é‡Šæ”¾</span></span><br><span class="line">  <span class="keyword">if</span> (compositionContext) &#123;</span><br><span class="line">    compositionContext.addDisposer(stop);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> stop;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br></p>
<p>DONE!</p>
<p><br><br><br></p>
<h2 id="åŒ…è£…-props-ä¸ºå“åº”å¼æ•°æ®"><a href="#åŒ…è£…-props-ä¸ºå“åº”å¼æ•°æ®" class="headerlink" title="åŒ…è£… Props ä¸ºå“åº”å¼æ•°æ®"></a>åŒ…è£… Props ä¸ºå“åº”å¼æ•°æ®</h2><p>React ç»„ä»¶æ¯æ¬¡é‡æ–°æ¸²æŸ“éƒ½ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„ Props å¯¹è±¡ï¼Œæ‰€ä»¥æ— æ³•ç›´æ¥åœ¨ setup ä¸­ä½¿ç”¨ï¼Œæˆ‘ä»¬éœ€è¦å°†å…¶è½¬æ¢ä¸ºä¸€ä¸ªå¯ä»¥å®‰å…¨å¼•ç”¨çš„å¯¹è±¡ï¼Œç„¶ååœ¨æ¯æ¬¡é‡æ–°æ¸²æŸ“æ—¶æ›´æ–°è¿™ä¸ªå¯¹è±¡ã€‚</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="keyword">set</span> &#125; from 'mobx'</span><br><span class="line"></span><br><span class="line">export function initial&lt;Props extends object, Rtn, Ref&gt;(setup: (props: Props) =&gt; Rtn) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">useComposition</span>(<span class="params">props: Props, ref?: React.RefObject&lt;Ref&gt;</span>): <span class="title">Rtn</span> </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> context = useRef&lt;CompositionContext | <span class="literal">undefined</span>&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–</span></span><br><span class="line">    <span class="keyword">if</span> (context.current == <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="comment">// âš›ï¸ createCompositoonContext ä¼šå°†props è½¬æ¢ä¸ºä¸€ä¸ªå“åº”å¼æ•°æ®, è€Œä¸”è¿™é‡Œæ˜¯æµ…å±‚è½¬æ¢</span></span><br><span class="line">      <span class="comment">// _props: observable(props, &#123;&#125;, &#123; deep: false, name: "props" &#125;)</span></span><br><span class="line">      <span class="keyword">const</span> ctx = (context.current = createCompositionContext(props));</span><br><span class="line">      <span class="keyword">const</span> prevCtx = compositionContext;</span><br><span class="line">      compositionContext = ctx;</span><br><span class="line">      ctx._instance = setup(ctx._props);</span><br><span class="line">      compositionContext = prevCtx;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// âš›ï¸ æ¯æ¬¡é‡æ–°æ¸²æŸ“æ—¶æ›´æ–°, props å±æ€§</span></span><br><span class="line">    <span class="keyword">set</span>(context.current._props, props);</span><br><span class="line"></span><br><span class="line">    return context.current._instance!;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br><br><br></p>
<h2 id="æ”¯æŒ-context-æ³¨å…¥"><a href="#æ”¯æŒ-context-æ³¨å…¥" class="headerlink" title="æ”¯æŒ Context æ³¨å…¥"></a>æ”¯æŒ Context æ³¨å…¥</h2><p>å’Œ VCA ä¸€æ ·ï¼Œæˆ‘ä»¬é€šè¿‡ <code>inject</code> æ”¯æŒä¾èµ–æ³¨å…¥ï¼Œä¸åŒçš„æ˜¯æˆ‘ä»¬çš„ <code>inject</code> æ–¹æ³•æ¥æ”¶ä¸€ä¸ª <a href="https://reactjs.org/docs/context.html#contextprovider" target="_blank" rel="noopener"><code>React.Context</code></a> å¯¹è±¡ã€‚<code>inject</code> å¯ä»¥ä» Context å¯¹è±¡ä¸­æ¨æ–­å‡ºæ³¨å…¥çš„ç±»å‹ã€‚</p>
<p>å¦å¤–å—é™äº React çš„ Context æœºåˆ¶ï¼Œæˆ‘ä»¬æ²¡æœ‰å®ç° provider å‡½æ•°ï¼Œç”¨æˆ·ç›´æ¥ä½¿ç”¨ Context.Provider ç»„ä»¶å³å¯ã€‚</p>
<p>å®ç° Context çš„æ³¨å…¥è¿˜æ˜¯å¾—è´¹ç‚¹äº‹ï¼Œæˆ‘ä»¬ä¼šåˆ©ç”¨ React çš„ <a href="https://reactjs.org/docs/hooks-reference.html#usecontext" target="_blank" rel="noopener"><code>useContext</code></a> Hook æ¥å®ç°ï¼Œå› æ­¤å¿…é¡»ä¿è¯ <code>useContext</code> çš„è°ƒç”¨é¡ºåºã€‚</p>
<p>å’Œç”Ÿå‘½å‘¨æœŸæ–¹æ³•ä¸€æ ·ï¼Œè°ƒç”¨ inject æ—¶ï¼Œå°† Context æ¨å…¥é˜Ÿåˆ—ä¸­, åªä¸è¿‡æˆ‘ä»¬ä¼šç«‹å³è°ƒç”¨ä¸€æ¬¡ useContext è·å–åˆ°å€¼:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">inject</span>&lt;<span class="title">T</span>&gt;(<span class="params">Context: React.Context&lt;T&gt;</span>): <span class="title">T</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> ctx = assertCompositionContext();</span><br><span class="line">  <span class="comment">// âš›ï¸ é©¬ä¸Šè·å–å€¼</span></span><br><span class="line">  <span class="keyword">return</span> ctx.addContext(Context);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br></p>
<p>ä¸ºäº†é¿å…é‡å¤çš„ useContext è°ƒç”¨, åŒæ—¶ä¿è¯æ’å…¥çš„é¡ºåºï¼Œæˆ‘ä»¬ä½¿ç”¨ <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Map" target="_blank" rel="noopener"><code>Map</code></a> æ¥ä¿å­˜ Context å¼•ç”¨:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createCompositionContext</span>&lt;<span class="title">P</span>, <span class="title">R</span>&gt;(<span class="params">props: P</span>): <span class="title">CompositionContext</span>&lt;<span class="title">P</span>, <span class="title">R</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> ctx = &#123;</span><br><span class="line">    _isMounted: <span class="literal">false</span>,</span><br><span class="line">    <span class="comment">// âš›ï¸ ä½¿ç”¨ Map ä¿å­˜</span></span><br><span class="line">    _contexts: <span class="keyword">new</span> <span class="built_in">Map</span>(),</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// âš›ï¸ æ³¨å†ŒContext</span></span><br><span class="line">    addContext: <span class="function"><span class="params">c</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// âš›ï¸ å·²æ·»åŠ </span></span><br><span class="line">      <span class="keyword">if</span> (ctx._contexts.has(c)) &#123;</span><br><span class="line">        <span class="keyword">return</span> ctx._contexts.get(c)!.value</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// âš›ï¸ é¦–æ¬¡ä½¿ç”¨ç«‹å³è°ƒç”¨ useContext è·å– Context çš„å€¼</span></span><br><span class="line">      <span class="keyword">let</span> value = useContext(c)</span><br><span class="line">      <span class="comment">// âš›ï¸ å’Œ Props ä¸€æ ·è½¬æ¢ä¸º å“åº”å¼æ•°æ®, è®© setup å¯ä»¥å®‰å…¨åœ°å¼•ç”¨</span></span><br><span class="line">      <span class="keyword">const</span> wrapped = observable(value, &#123;&#125;, &#123; <span class="attr">deep</span>: <span class="literal">false</span>, <span class="attr">name</span>: <span class="string">"context"</span> &#125;)</span><br><span class="line"></span><br><span class="line">      <span class="comment">// âš›ï¸ æ’å…¥åˆ°é˜Ÿåˆ—</span></span><br><span class="line">      ctx._contexts.set(c, &#123;</span><br><span class="line">        value: wrapped,</span><br><span class="line">        <span class="comment">// âš›ï¸ æ›´æ–°å™¨ï¼Œè¿™ä¸ªä¼šåœ¨ç»„ä»¶æŒ‚è½½ä¹‹åçš„æ¯æ¬¡é‡æ–°æ¸²æŸ“æ—¶è°ƒç”¨</span></span><br><span class="line">        <span class="comment">// æˆ‘ä»¬éœ€è¦ä¿è¯ useContext çš„è°ƒç”¨é¡ºåº</span></span><br><span class="line">        updater: <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="comment">// âš›ï¸ ä¾æ—§æ˜¯è°ƒç”¨ useContetxt é‡æ–°è·å– Context å€¼</span></span><br><span class="line">          <span class="keyword">const</span> newValue = useContext(c)</span><br><span class="line">          <span class="keyword">if</span> (newValue !== value) &#123;</span><br><span class="line">            <span class="keyword">set</span>(wrapped, newValue)</span><br><span class="line">            value = newValue</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">      return wrapped as any</span><br><span class="line">    &#125;,</span><br><span class="line">    // ....</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  return ctx;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br></p>
<p>å›åˆ° setup å‡½æ•°ï¼Œæˆ‘ä»¬å¿…é¡»ä¿è¯æ¯ä¸€æ¬¡æ¸²æŸ“æ—¶éƒ½æŒ‰ç…§ä¸€æ ·çš„æ¬¡åºè°ƒç”¨ useContextï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">initial</span>&lt;<span class="title">Props</span> <span class="title">extends</span> <span class="title">object</span>, <span class="title">Rtn</span>, <span class="title">Ref</span>&gt;(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  setup: (props: Props</span>) =&gt; <span class="title">Rtn</span>,</span></span><br><span class="line"><span class="function">) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">useComposition</span>(<span class="params">props: Props, ref?: React.RefObject&lt;Ref&gt;</span>): <span class="title">Rtn</span> </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> context = useRef&lt;CompositionContext | <span class="literal">undefined</span>&gt;()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–</span></span><br><span class="line">    <span class="keyword">if</span> (context.current == <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> ctx = (context.current = createCompositionContext(props))</span><br><span class="line">      <span class="keyword">const</span> prevCtx = compositionContext</span><br><span class="line">      compositionContext = ctx</span><br><span class="line">      ctx._instance = setup(ctx._props)</span><br><span class="line">      compositionContext = prevCtx</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// âš›ï¸ ä¸€å®šè¦åœ¨å…¶ä»– React Hooks ä¹‹å‰è°ƒç”¨</span></span><br><span class="line">    <span class="comment">// å› ä¸ºåœ¨ setup è°ƒç”¨çš„è¿‡ç¨‹ä¸­å·²ç»è°ƒç”¨äº† useContextï¼Œæ‰€ä»¥åªåœ¨æŒ‚è½½ä¹‹åçš„é‡æ–°æ¸²æŸ“ä¸­æ‰è°ƒç”¨æ›´æ–°</span></span><br><span class="line">    <span class="keyword">if</span> (context.current._contexts.size &amp;&amp; context.current._isMounted) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">const</span> &#123; updater &#125; <span class="keyword">of</span> context.current._contexts.values()) &#123;</span><br><span class="line">        updater()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br></p>
<p>DONE!</p>
<p><br><br><br></p>
<h2 id="è·Ÿè¸ªç»„ä»¶ä¾èµ–å¹¶è§¦å‘é‡æ–°æ¸²æŸ“"><a href="#è·Ÿè¸ªç»„ä»¶ä¾èµ–å¹¶è§¦å‘é‡æ–°æ¸²æŸ“" class="headerlink" title="è·Ÿè¸ªç»„ä»¶ä¾èµ–å¹¶è§¦å‘é‡æ–°æ¸²æŸ“"></a>è·Ÿè¸ªç»„ä»¶ä¾èµ–å¹¶è§¦å‘é‡æ–°æ¸²æŸ“</h2><p>åŸºæœ¬æ¥å£å·²ç»å‡†å¤‡å°±ç»ªäº†ï¼Œç°åœ¨å¦‚ä½•å’Œ React ç»„ä»¶å»ºç«‹å…³è”ï¼Œåœ¨å“åº”å¼æ•°æ®æ›´æ–°åè§¦å‘ç»„ä»¶é‡æ–°æ¸²æŸ“?</p>
<p>Mobx æœ‰ä¸€ä¸ªåº“å¯ä»¥ç”¨æ¥ç»‘å®š React ç»„ä»¶, å®ƒå°±æ˜¯ <a href="https://github.com/mobxjs/mobx-react-lite" target="_blank" rel="noopener"><code>mobx-react-lite</code></a>, æœ‰äº†å®ƒ, æˆ‘ä»¬å¯ä»¥ç›‘å¬å“åº”å¼å˜åŒ–å¹¶è§¦å‘ç»„ä»¶é‡æ–°æ¸²æŸ“ã€‚ç”¨æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; observer &#125; <span class="keyword">from</span> <span class="string">'mobx-react-lite'</span></span><br><span class="line"><span class="keyword">import</span> &#123; initial &#125; <span class="keyword">from</span> <span class="string">'mpos'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> useComposition = initial(<span class="function">(<span class="params">props</span>) =&gt;</span> &#123;<span class="comment">/* setup */</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> YouComponent = observer(<span class="function"><span class="params">props</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> state = useComposition(props)</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;state.data.count&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><br></p>
<p>How it work? å¦‚æœè¿™æ ·ä¸€ç¬”å¸¦è¿‡ï¼Œä¼°è®¡å¾ˆå¤šè¯»è€…ä¼šå¾ˆæ‰«å…´ï¼Œè‡ªå·±å†™ä¸€ä¸ª <code>observer</code> ä¹Ÿä¸éš¾ã€‚æˆ‘ä»¬å¯ä»¥å‚è€ƒ <a href="https://github.com/mobxjs/mobx-react" target="_blank" rel="noopener">mobx-react</a> æˆ–è€… mobx-react-lite çš„å®ç°ã€‚</p>
<p>å®ƒä»¬éƒ½å°†æ¸²æŸ“å‡½æ•°æ”¾åœ¨ <code>track</code> å‡½æ•°çš„ä¸Šä¸‹æ–‡ä¸‹ï¼Œtrackå‡½æ•°å¯ä»¥è·Ÿè¸ªæ¸²æŸ“å‡½æ•°ä¾èµ–äº†å“ªäº›æ•°æ®ï¼Œå½“è¿™äº›æ•°æ®å˜åŠ¨æ—¶ï¼Œå¼ºåˆ¶è¿›è¡Œç»„ä»¶æ›´æ–°:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; FC , useRef, useEffect &#125; <span class="keyword">from</span> <span class="string">'react'</span></span><br><span class="line"><span class="keyword">import</span> &#123; Reaction &#125; <span class="keyword">from</span> <span class="string">'mobx'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">createComponent</span>&lt;<span class="title">Props</span> <span class="title">extends</span> </span>&#123;&#125;, Ref = <span class="keyword">void</span>&gt;(options: &#123;</span><br><span class="line">  name?: string</span><br><span class="line">  setup: <span class="function">(<span class="params">props: Props</span>) =&gt;</span> () =&gt; React.ReactElement</span><br><span class="line">  forwardRef?: boolean</span><br><span class="line">&#125;): FC&lt;Props&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; setup, name, forwardRef &#125; = options</span><br><span class="line">  <span class="comment">// âš›ï¸ åˆ›å»º useComposition Hook</span></span><br><span class="line">  <span class="keyword">const</span> useComposition = initial(setup)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> Comp = <span class="function">(<span class="params">props: Props, ref: React.RefObject&lt;Ref&gt;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// ç”¨äºå¼ºåˆ¶æ›´æ–°ç»„ä»¶, å®ç°å¾ˆç®€å•ï¼Œå°±æ˜¯é€’å¢ useState çš„å€¼</span></span><br><span class="line">    <span class="keyword">const</span> forceUpdate = useForceUpdate()</span><br><span class="line">    <span class="keyword">const</span> reactionRef = useRef&lt;&#123; <span class="attr">reaction</span>: Reaction, <span class="attr">disposer</span>: <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">void</span> &#125; | <span class="literal">null</span>&gt;(<span class="literal">null</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> render = useComposition(props, forwardRef ? ref : <span class="literal">null</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºè·Ÿè¸ªå™¨</span></span><br><span class="line">    <span class="keyword">if</span> (reactionRef.current == <span class="literal">null</span>) &#123;</span><br><span class="line">      reactionRef.current = &#123;</span><br><span class="line">        <span class="comment">// âš›ï¸ åœ¨ä¾èµ–æ›´æ–°æ—¶ï¼Œè°ƒç”¨ forceUpdate å¼ºåˆ¶é‡æ–°æ¸²æŸ“</span></span><br><span class="line">        reaction: <span class="keyword">new</span> Reaction(<span class="string">`observer(<span class="subst">$&#123;name || <span class="string">"Unknown"</span>&#125;</span>)`</span>, () =&gt;  forceUpdate()),</span><br><span class="line">        <span class="comment">// é‡Šæ”¾è·Ÿè¸ªå™¨</span></span><br><span class="line">        disposer: <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (reactionRef.current &amp;&amp; !reactionRef.current.reaction.isDisposed) &#123;</span><br><span class="line">            reactionRef.current.reaction.dispose()</span><br><span class="line">            reactionRef.current = <span class="literal">null</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    useEffect(<span class="function"><span class="params">()</span> =&gt;</span> () =&gt; reactionRef.current &amp;&amp; reactionRef.current.disposer(), [])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> rendering</span><br><span class="line">    <span class="keyword">let</span> error</span><br><span class="line"></span><br><span class="line">    <span class="comment">// âš›ï¸ å°† render å‡½æ•°æ”¾åœ¨track ä½œç”¨åŸŸä¸‹ï¼Œæ”¶é›† render å‡½æ•°çš„æ•°æ®ä¾èµ–</span></span><br><span class="line">    reactionRef.current.reaction.track(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        rendering = render(props, inst)</span><br><span class="line">      &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">        error = err</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (error) &#123;</span><br><span class="line">      reactionRef.current.disposer()</span><br><span class="line">      <span class="keyword">throw</span> error</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> rendering</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br></p>
<p>æ¥ç€ï¼Œæˆ‘ä»¬å°† Comp ç»„ä»¶åŒ…è£¹åœ¨ React.memo ä¸‹ï¼Œé¿å…ä¸å¿…è¦é‡æ–°æ¸²æŸ“:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">createComponent</span>&lt;<span class="title">Props</span> <span class="title">extends</span> </span>&#123;&#125;, Ref = <span class="keyword">void</span>&gt;(options: &#123;</span><br><span class="line">  name?: string</span><br><span class="line">  setup: <span class="function">(<span class="params">props: Props</span>) =&gt;</span> () =&gt; React.ReactElement</span><br><span class="line">  forwardRef?: boolean</span><br><span class="line">&#125;): FC&lt;Props&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; setup, name, forwardRef &#125; = options</span><br><span class="line">  <span class="comment">// åˆ›å»º useComposition Hook</span></span><br><span class="line">  <span class="keyword">const</span> useComposition = initial(setup)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> Comp = <span class="function">(<span class="params">props: Props, ref: React.RefObject&lt;Ref&gt;</span>) =&gt;</span> &#123;<span class="comment">/**/</span>&#125;</span><br><span class="line"></span><br><span class="line">  Comp.displayName = <span class="string">`Composition(<span class="subst">$&#123;name || <span class="string">"Unknown"</span>&#125;</span>)`</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> finalComp</span><br><span class="line">  <span class="keyword">if</span> (forwardRef) &#123;</span><br><span class="line">    <span class="comment">// æ”¯æŒè½¬å‘ ref</span></span><br><span class="line">    finalComp = React.memo(React.forwardRef(Comp))</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    finalComp = React.memo(Comp)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  finalComp.displayName = name</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> finalComp</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br><br><br></p>
<h2 id="forwardref-å¤„ç†"><a href="#forwardref-å¤„ç†" class="headerlink" title="forwardRef å¤„ç†"></a>forwardRef å¤„ç†</h2><p>æœ€åä¸€æ­¥äº†ï¼Œæœ‰äº›æ—¶å€™æˆ‘ä»¬çš„ç»„ä»¶éœ€è¦é€šè¿‡ ref å‘å¤–éƒ¨æš´éœ²ä¸€äº›çŠ¶æ€å’Œæ–¹æ³•ã€‚åœ¨Hooks ä¸­æˆ‘ä»¬ä½¿ç”¨ <code>useImperativeHandle</code> æ¥å®ç°:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">FancyInput</span>(<span class="params">props, ref</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> inputRef = useRef();</span><br><span class="line">  useImperativeHandle(ref, () =&gt; (&#123;</span><br><span class="line">    focus: <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      inputRef.current.focus();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;));</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">input</span> <span class="attr">ref</span>=<span class="string">&#123;inputRef&#125;</span> <span class="attr">...</span> /&gt;</span>;</span></span><br><span class="line"><span class="xml">&#125;</span></span><br><span class="line"><span class="xml">FancyInput = forwardRef(FancyInput);</span></span><br></pre></td></tr></table></figure>
<p><br></p>
<p>åœ¨æˆ‘ä»¬çš„ç©å…·ä¸­ï¼Œæˆ‘ä»¬è‡ªå®šä¹‰ä¸€ä¸ªæ–°çš„å‡½æ•° <code>expose</code> æ¥æš´éœ²æˆ‘ä»¬çš„å…¬å¼€æ¥å£ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setup</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">  expose(&#123;</span><br><span class="line">    somePublicAPI: <span class="function"><span class="params">()</span> =&gt;</span> &#123;&#125;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br></p>
<p>å®ç°å¦‚ä¸‹ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">expose</span>(<span class="params">value: any</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> ctx = assertCompositionContext();</span><br><span class="line">  ctx.addExpose(value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br></p>
<p>å…³é”®æ˜¯ useComposition çš„å¤„ç†:</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">initial</span>&lt;<span class="title">Props</span> <span class="title">extends</span> <span class="title">object</span>, <span class="title">Rtn</span>, <span class="title">Ref</span>&gt;(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  setup: (props: Props</span>) =&gt; <span class="title">Rtn</span>,</span></span><br><span class="line"><span class="function">) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">useComposition</span>(<span class="params">props: Props, ref?: React.RefObject&lt;Ref&gt;</span>): <span class="title">Rtn</span> </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> context = useRef&lt;CompositionContext | <span class="literal">undefined</span>&gt;()</span><br><span class="line">    <span class="keyword">if</span> (context.current == <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="comment">// åˆå§‹åŒ–...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ... useContext</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// âš›ï¸ å¦‚æœä¼ é€’äº†ref ä¸” è°ƒç”¨äº† expose å‡½æ•°</span></span><br><span class="line">    <span class="comment">// åˆ™ä½¿ç”¨useImperativeHandle æš´éœ²ç»™ ref</span></span><br><span class="line">    <span class="keyword">if</span> (ref &amp;&amp; context.current._exposer != <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="comment">// åªåœ¨ _exposer å˜åŠ¨åæ›´æ–°</span></span><br><span class="line">      useImperativeHandle(ref, context.current._exposer, [context.current._exposer]);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p><br></p>
<p>ğŸ‰ğŸ‰ æå®šï¼Œ<strong>æ‰€æœ‰ä»£ç éƒ½åœ¨è¿™ä¸ª <a href="https://codesandbox.io/s/mobx-vue-composition-api-ft9mv?fontsize=14" target="_blank" rel="noopener">CodeSandbox</a> ä¸­ï¼Œå¤§å®¶å¯ä»¥è‡ªè¡Œä½“éªŒ</strong>. ğŸ‰ğŸ‰ </p>
<p><br><br><br></p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æœ€åï¼Œè¿™åªæ˜¯ä¸€ä¸ªç©å…·ğŸƒï¼æ•´ä¸ªè¿‡ç¨‹ä¹Ÿä¸è¿‡ç™¾æ¥è¡Œä»£ç ã€‚</p>
<p>å°±å¦‚æ ‡é¢˜æ‰€è¯´çš„ï¼Œé€šè¿‡è¿™ä¸ªç©å…·ï¼Œå­¦åˆ°å¾ˆå¤šå¥‡æ·«å·§æŠ€ï¼Œä½ å¯¹ React Hooks ä»¥åŠ Vue Composition API çš„äº†è§£åº”è¯¥æ›´æ·±äº†å§ï¼Ÿ <strong>ä¹‹æ‰€ä»¥æ˜¯ä¸ªç©å…·ï¼Œæ˜¯å› ä¸ºå®ƒè¿˜æœ‰ä¸€äº›ç¼ºé™·ï¼Œä¸å¤Ÿ â€™Reactâ€˜, åˆä¸å¤Ÿ â€˜Vueâ€™ï¼åªèƒ½ä»¥å­¦ä¹ çš„ç›®çš„è‡ªä¸ªç©ç©! è€Œä¸”æè¿™ç©æ„, æä¸å¥½å¯èƒ½åœ¨ä¸¤ä¸ªç¤¾åŒºéƒ½ä¼šè¢«å–·</strong>ã€‚æ‰€ä»¥æˆ‘è¯å°±æ’‚è¿™äº†ï¼Œä½ ä»¬å°±ä¸è¦åœ¨è¯„è®ºåŒºå–·äº†ã€‚</p>
<p><br></p>
<p>å¦‚æœä½ äº†è§£è¿‡ <a href="https://juejin.im/post/5dadc6045188255a270a0f85#heading-13" target="_blank" rel="noopener">React Concurrent æ¨¡å¼</a>ï¼Œä½ ä¼šå‘ç°è¿™ä¸ªæ¶æ„æ˜¯ React è‡ªèº«çš„çŠ¶æ€æ›´æ–°æœºåˆ¶æ˜¯æ·±å…¥ç»‘å®šçš„ã€‚React è‡ªèº«çš„setState çŠ¶æ€æ›´æ–°ç²’åº¦æ›´å°ã€å¯ä»¥è¿›è¡Œä¼˜å…ˆçº§è°ƒåº¦ã€Suspenseã€å¯ä»¥é€šè¿‡ useTransition + Suspense é…åˆè¿›å…¥ Pending çŠ¶æ€ã€åœ¨â€™å¹³è¡Œå®‡å®™â€™ä¸­è¿›è¡Œæ¸²æŸ“ã€‚ <strong>React è‡ªèº«çš„çŠ¶æ€æ›´æ–°æœºåˆ¶å’Œç»„ä»¶çš„æ¸²æŸ“ä½“ç³»æ˜¯æ·±åº¦é›†æˆ</strong>ã€‚</p>
<p>å› æ­¤æˆ‘ä»¬ç°åœ¨ç›‘å¬å“åº”å¼æ•°æ®ï¼Œç„¶åç²—æš´åœ° <code>forceUpdate</code>ï¼Œä¼šè®©æˆ‘ä»¬ä¸¢å¤±éƒ¨åˆ† React Concurrent æ¨¡å¼å¸¦æ¥çš„çº¢åˆ©ã€‚é™¤æ­¤ä¹‹å¤–ã€å¼€å‘è€…å·¥å…·çš„é›†æˆã€ç”Ÿæ€åœˆã€Benchmarkâ€¦</p>
<p>è¯´åˆ°ç”Ÿæ€åœˆï¼Œå¦‚æœä½ å°†è¿™ä¸ªç©å…·çš„ API ä¿æŒå’Œ VCA å®Œå…¨å…¼å®¹ï¼Œé‚£ä¹ˆä»¥å Vue ç¤¾åŒºçš„ Hooks åº“ä¹Ÿå¯ä»¥ä¸ºä½ æ‰€ç”¨ï¼Œæƒ³æƒ³è„‘æ´æŒºå¤§ã€‚</p>
<p><br></p>
<p><strong>æè¿™ä¸€å¥—è¿˜ä¸å¦‚ç›´æ¥ä¸Š Vue æ˜¯å§</strong>ï¼Ÿæ¯•ç«Ÿ Vue å¤©ç”Ÿé›†æˆå“åº”å¼æ•°æ®ï¼Œè·Ÿ React çš„ä¸å¯å˜æ•°æ®ä¸€æ ·, <strong>Vue çš„å“åº”å¼æ›´æ–°æœºåˆ¶å’Œå…¶ç»„ä»¶æ¸²æŸ“ä½“ç³»æ˜¯æ·±åº¦é›†æˆçš„</strong>ã€‚ æ•´ä¸ªå·¥ä½œé“¾è·¯è‡ªé¡¶å‘ä¸‹, ä»æ•°æ®åˆ°æ¨¡æ¿ã€å†åˆ°åº•å±‚ç»„ä»¶æ¸²æŸ“, å¯¹å“åº”å¼æ•°æ®æœ‰æ›´å¥½ã€æ›´é«˜æ•ˆåœ°èåˆã€‚</p>
<p>å°½ç®¡å¦‚æ­¤ï¼ŒReact çš„çµæ´»æ€§ã€å¼€æ”¾ã€å¤šèŒƒå¼ç¼–ç¨‹æ–¹å¼ã€åˆ›é€ åŠ›è¿˜æ˜¯è®©äººèµå¹ã€‚(ä»…ä»£è¡¨æˆ‘ä½œä¸ºReactçˆ±å¥½è€…çš„ç«‹åœº)</p>
<p><br></p>
<p><strong>å¦å¤–å“åº”å¼æœºåˆ¶ä¹Ÿä¸æ˜¯å®Œå…¨æ²¡æœ‰å¿ƒæ™ºè´Ÿæ‹…</strong>ï¼Œæœ€èµ·ç ä½ è¦äº†è§£å“åº”å¼æ•°æ®çš„åŸç†ï¼ŒçŸ¥é“ä»€ä¹ˆå¯ä»¥è¢«å“åº”ï¼Œä»€ä¹ˆä¸å¯ä»¥ï¼š</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ¯”å¦‚ä¸èƒ½ä½¿ç”¨è§£æ„å’Œå±•å¼€è¡¨è¾¾å¼</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useMyHook</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// å°†count æ‹·è´ç»™(æŒ‰å€¼ä¼ é€’) countå˜é‡ï¼Œè¿™ä¼šå¯¼è‡´å“åº”ä¸¢å¤±ï¼Œä¸‹æ¸¸æ— æ³•å“åº”count çš„å˜åŒ–</span></span><br><span class="line">  <span class="keyword">const</span> &#123; count &#125; = reactive(&#123;<span class="attr">count</span>: <span class="number">0</span>&#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123; count &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿˜æœ‰å“åº”å¼æ•°æ®è½¬æ¢æˆæœ¬ï¼Œè¯¸å¦‚æ­¤ç±»çš„ï¼Œç½‘ä¸Šä¹Ÿæœ‰å¤§é‡çš„èµ„æ–™, è¿™é‡Œå°±ä¸èµ˜è¿°äº†ã€‚ å…³äºå“åº”å¼æ•°æ®éœ€è¦æ³¨æ„çš„ä¸œè¥¿å¯ä»¥å‚è€ƒè¿™äº›èµ„æ–™:</p>
<ul>
<li><a href="https://vue-composition-api-rfc.netlify.com/#plugin-development" target="_blank" rel="noopener">Vue Composition API Drawbacks</a></li>
<li><a href="https://mobx.js.org/best/react.html" target="_blank" rel="noopener">What does MobX react to?</a></li>
<li><a href="https://cn.vuejs.org/v2/guide/reactivity.html" target="_blank" rel="noopener">Vue: æ·±å…¥å“åº”å¼åŸç†</a></li>
</ul>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œä½ æœ‰æ—¶å€™ä¼šçº ç»“ä»€ä¹ˆæ—¶å€™åº”è¯¥ä½¿ç”¨ reactiveï¼Œä»€ä¹ˆæ—¶å€™åº”è¯¥ä½¿ç”¨ refâ€¦</p>
<p>æ²¡æœ‰é“¶å¼¹ï¼Œæ²¡æœ‰é“¶å¼¹ã€‚</p>
<p><br></p>
<p>æœ€åçš„æœ€åï¼Œ <strong>useYourImagination</strong>, React Hooks æ—©å·²åœ¨ React ç¤¾åŒºç©å‡ºäº†èŠ±ğŸŒ¸ï¼ŒVue Composition API å®Œå…¨å¯ä»¥å°†è¿™äº›æ¨¡å¼æ‹¿è¿‡æ¥ç”¨ï¼Œä¸¤ä¸ªä»ç»“æ„å’Œé€»è¾‘ä¸Šéƒ½æ˜¯å·®ä¸å¤šçš„ï¼Œåªä¸è¿‡æ¢ä¸€ä¸‹ â€˜Mutableâ€™ çš„æ•°æ®æ“ä½œæ–¹å¼ã€‚å®‰åˆ© <a href="https://juejin.im/post/5d594ea5518825041301bbcb" target="_blank" rel="noopener">2019å¹´äº†ï¼Œæ•´ç†äº†Nä¸ªå®ç”¨æ¡ˆä¾‹å¸®ä½ å¿«é€Ÿè¿ç§»åˆ°React Hooks</a></p>
<p><br></p>
<p>æˆ‘æ˜¯è’å±±ï¼Œè§‰å¾—æ–‡ç« å¯ä»¥ï¼Œè¯·ç‚¹ä¸ªèµï¼Œä¸‹ç¯‡æ–‡ç« è§ï¼</p>
<p><br><br><br></p>
<h2 id="å‚è€ƒ-æ‰©å±•"><a href="#å‚è€ƒ-æ‰©å±•" class="headerlink" title="å‚è€ƒ/æ‰©å±•"></a>å‚è€ƒ/æ‰©å±•</h2><ul>
<li><a href="https://codesandbox.io/s/mobx-vue-composition-api-ft9mv?fontsize=14" target="_blank" rel="noopener"><strong>ğŸ‰æœ¬æ–‡æºç ï¼šCodeSandbox</strong></a></li>
<li><a href="https://vue-composition-api-rfc.netlify.com/" target="_blank" rel="noopener"><strong>Vue Composition API RFC</strong></a></li>
<li><a href="https://zhuanlan.zhihu.com/p/68477600" target="_blank" rel="noopener">Vue Function-based API RFC ä¸­æ–‡</a> æœ‰ç‚¹è¿‡æ—¶ï¼Œä¸å½±å“ç†è§£</li>
<li><a href="https://github.com/vuejs/composition-api" target="_blank" rel="noopener">@vue/composition-api</a></li>
<li><a href="https://mobx.js.org/" target="_blank" rel="noopener">Mobx</a></li>
<li><a href="https://github.com/kefranabg/awesome-vue-composition-api" target="_blank" rel="noopener">awesome-vue-composition-api</a></li>
<li><a href="https://codesandbox.io/s/github/nuxt/typescript/tree/master/examples/composition-api/minimal" target="_blank" rel="noopener">Vue Composition API CodeSandbox Playground</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/71667382" target="_blank" rel="noopener">ç²¾è¯»ã€ŠVue3.0 Function APIã€‹</a></li>
</ul>
<p><br></p>
<p><img src="/images/sponsor.jpg" alt></p>

  </div>
</article>

    <div class="blog-post-comments">
        <div id="disqus_thread">
            <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        </div>
    </div>



    </div>
    
      <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Blogs</a></li>
         
          <li><a href="http://github.com/ivan-94">Projects</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#å¯¹æ¯”-react-hooks-å’Œ-vue-composition-api"><span class="toc-number">1.</span> <span class="toc-text">å¯¹æ¯” React Hooks å’Œ Vue Composition API</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#åŸºæœ¬-api-ç±»æ¯”"><span class="toc-number">1.1.</span> <span class="toc-text">åŸºæœ¬ API ç±»æ¯”</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#api-è®¾è®¡æ¦‚è§ˆ"><span class="toc-number">2.</span> <span class="toc-text">API è®¾è®¡æ¦‚è§ˆ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#å“åº”å¼æ•°æ®å’Œ-ref"><span class="toc-number">3.</span> <span class="toc-text">å“åº”å¼æ•°æ®å’Œ ref</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#å…³äº-vue-composition-api-ref"><span class="toc-number">3.1.</span> <span class="toc-text">å…³äº Vue Composition API ref</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ä¸ºä»€ä¹ˆéœ€è¦-ref"><span class="toc-number">3.2.</span> <span class="toc-text">ä¸ºä»€ä¹ˆéœ€è¦ ref?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ref-å’Œ-useref"><span class="toc-number">3.3.</span> <span class="toc-text">ref å’Œ useRef</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ç”Ÿå‘½å‘¨æœŸæ–¹æ³•"><span class="toc-number">4.</span> <span class="toc-text">ç”Ÿå‘½å‘¨æœŸæ–¹æ³•</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#watch"><span class="toc-number">5.</span> <span class="toc-text">watch</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#åŒ…è£…-props-ä¸ºå“åº”å¼æ•°æ®"><span class="toc-number">6.</span> <span class="toc-text">åŒ…è£… Props ä¸ºå“åº”å¼æ•°æ®</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#æ”¯æŒ-context-æ³¨å…¥"><span class="toc-number">7.</span> <span class="toc-text">æ”¯æŒ Context æ³¨å…¥</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#è·Ÿè¸ªç»„ä»¶ä¾èµ–å¹¶è§¦å‘é‡æ–°æ¸²æŸ“"><span class="toc-number">8.</span> <span class="toc-text">è·Ÿè¸ªç»„ä»¶ä¾èµ–å¹¶è§¦å‘é‡æ–°æ¸²æŸ“</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#forwardref-å¤„ç†"><span class="toc-number">9.</span> <span class="toc-text">forwardRef å¤„ç†</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#æ€»ç»“"><span class="toc-number">10.</span> <span class="toc-text">æ€»ç»“</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#å‚è€ƒ-æ‰©å±•"><span class="toc-number">11.</span> <span class="toc-text">å‚è€ƒ/æ‰©å±•</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://bobi.ink/2019/11/04/react-composition/"><i class="fa fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=https://bobi.ink/2019/11/04/react-composition/&text=[å®æˆ˜] ä¸ºäº†å­¦å¥½ React Hooks, æˆ‘æŠ„äº† Vue Composition API, çœŸé¦™"><i class="fa fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://bobi.ink/2019/11/04/react-composition/&title=[å®æˆ˜] ä¸ºäº†å­¦å¥½ React Hooks, æˆ‘æŠ„äº† Vue Composition API, çœŸé¦™"><i class="fa fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://bobi.ink/2019/11/04/react-composition/&is_video=false&description=[å®æˆ˜] ä¸ºäº†å­¦å¥½ React Hooks, æˆ‘æŠ„äº† Vue Composition API, çœŸé¦™"><i class="fa fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=[å®æˆ˜] ä¸ºäº†å­¦å¥½ React Hooks, æˆ‘æŠ„äº† Vue Composition API, çœŸé¦™&body=Check out this article: https://bobi.ink/2019/11/04/react-composition/"><i class="fa fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=https://bobi.ink/2019/11/04/react-composition/&title=[å®æˆ˜] ä¸ºäº†å­¦å¥½ React Hooks, æˆ‘æŠ„äº† Vue Composition API, çœŸé¦™"><i class="fa fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=https://bobi.ink/2019/11/04/react-composition/&title=[å®æˆ˜] ä¸ºäº†å­¦å¥½ React Hooks, æˆ‘æŠ„äº† Vue Composition API, çœŸé¦™"><i class="fa fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://bobi.ink/2019/11/04/react-composition/&title=[å®æˆ˜] ä¸ºäº†å­¦å¥½ React Hooks, æˆ‘æŠ„äº† Vue Composition API, çœŸé¦™"><i class="fa fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=https://bobi.ink/2019/11/04/react-composition/&title=[å®æˆ˜] ä¸ºäº†å­¦å¥½ React Hooks, æˆ‘æŠ„äº† Vue Composition API, çœŸé¦™"><i class="fa fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=https://bobi.ink/2019/11/04/react-composition/&name=[å®æˆ˜] ä¸ºäº†å­¦å¥½ React Hooks, æˆ‘æŠ„äº† Vue Composition API, çœŸé¦™&description="><i class="fa fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
      <ul>
        <li id="toc"><a class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa fa-list fa-lg" aria-hidden="true"></i> TOC</a></li>
        <li id="share"><a class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa fa-share-alt fa-lg" aria-hidden="true"></i> Share</a></li>
        <li id="top" style="display:none"><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a></li>
        <li id="menu"><a class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa fa-bars fa-lg" aria-hidden="true"></i> Menu</a></li>
      </ul>
    </div>

  </div>
</div>

    
    <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2025 Ivan
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Blogs</a></li>
         
          <li><a href="http://github.com/ivan-94">Projects</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

</body>
</html>
<!-- styles -->
<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
<link rel="stylesheet" href="/lib/meslo-LG/styles.css">
<link rel="stylesheet" href="/lib/justified-gallery/justifiedGallery.min.css">

<!-- jquery -->
<script src="/lib/jquery/jquery.min.js"></script>
<script src="/lib/justified-gallery/jquery.justifiedGallery.min.js"></script>
<script src="/js/main.js"></script>


    <!-- Google Analytics -->
    <script type="text/javascript">
        (function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-44571525-2', 'auto');
        ga('send', 'pageview');
    </script>


    <!-- Disqus Comments -->
    <script type="text/javascript">
        var disqus_shortname = 'bobi-ink';

        (function(){
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        }());
    </script>


