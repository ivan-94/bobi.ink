<!DOCTYPE html>
<html lang=zh>
<head><meta name="generator" content="Hexo 3.8.0">
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="description" content="è¿™ç¯‡æ–‡ç« ç»§ç»­æˆ‘ä»¬çš„â€˜è·¨å¹³å°â€™ä¹‹æ—…ï¼Œ ä¹‹å‰æˆ‘ä»¬èŠè¿‡:  ç¼–å†™â€˜è·¨ç‰ˆæœ¬â€™ çš„ç»„ä»¶åº“ï¼š å¦‚ä½•å®ç°æ”¯æŒè·¨ Vue 2/3 çš„ç»„ä»¶åº“ ç¼–å†™â€˜è·¨æ¡†æ¶â€™çš„ç»„ä»¶ï¼šæ¥ä¸€ç“¶ Web Component é­”æ³•èƒ¶æ°´ è·¨å¹³å°çš„è¿è¡Œå®¹å™¨ï¼š ä½¿ç”¨ Docker å®ç°å‰ç«¯åº”ç”¨çš„æ ‡å‡†åŒ–æ„å»ºã€éƒ¨ç½²å’Œè¿è¡Œ ç¼–å†™è·¨è¿è¡Œæ—¶çš„ç¨‹åº   ä»Šå¤©ç»§ç»­æ¥èŠä¸€ä¸‹æ€ä¹ˆç¼–å†™â€˜è·¨å¹³å°â€™çš„æ„å»ºæ’ä»¶ï¼Œå‰ç«¯æ„å»ºå·¥å…·ä¸€ç›´éƒ½æ˜¯ä¸€ä¸ªæ¯”è¾ƒå·çš„èµ›é“ï¼Œæ¯•ç«Ÿå®ƒæ˜¯å‰ç«¯å·¥ç¨‹åŒ–">
<meta name="keywords" content="Blog,FrontEnd,React,Javascript,Typescript">
<meta property="og:type" content="article">
<meta property="og:title" content="ä½¿ç”¨ unplugin ç¼–å†™è·¨å¹³å°çš„æ„å»ºæ’ä»¶">
<meta property="og:url" content="https://bobi.ink/2023/09/25/unplugin/index.html">
<meta property="og:site_name" content="Bobi.ink">
<meta property="og:description" content="è¿™ç¯‡æ–‡ç« ç»§ç»­æˆ‘ä»¬çš„â€˜è·¨å¹³å°â€™ä¹‹æ—…ï¼Œ ä¹‹å‰æˆ‘ä»¬èŠè¿‡:  ç¼–å†™â€˜è·¨ç‰ˆæœ¬â€™ çš„ç»„ä»¶åº“ï¼š å¦‚ä½•å®ç°æ”¯æŒè·¨ Vue 2/3 çš„ç»„ä»¶åº“ ç¼–å†™â€˜è·¨æ¡†æ¶â€™çš„ç»„ä»¶ï¼šæ¥ä¸€ç“¶ Web Component é­”æ³•èƒ¶æ°´ è·¨å¹³å°çš„è¿è¡Œå®¹å™¨ï¼š ä½¿ç”¨ Docker å®ç°å‰ç«¯åº”ç”¨çš„æ ‡å‡†åŒ–æ„å»ºã€éƒ¨ç½²å’Œè¿è¡Œ ç¼–å†™è·¨è¿è¡Œæ—¶çš„ç¨‹åº   ä»Šå¤©ç»§ç»­æ¥èŠä¸€ä¸‹æ€ä¹ˆç¼–å†™â€˜è·¨å¹³å°â€™çš„æ„å»ºæ’ä»¶ï¼Œå‰ç«¯æ„å»ºå·¥å…·ä¸€ç›´éƒ½æ˜¯ä¸€ä¸ªæ¯”è¾ƒå·çš„èµ›é“ï¼Œæ¯•ç«Ÿå®ƒæ˜¯å‰ç«¯å·¥ç¨‹åŒ–">
<meta property="og:locale" content="zh">
<meta property="og:image" content="https://bobi.ink/images/unplugin/Untitled.png">
<meta property="og:image" content="https://bobi.ink/images/unplugin/Untitled%201.png">
<meta property="og:image" content="https://bobi.ink/images/unplugin/Untitled%202.png">
<meta property="og:image" content="https://bobi.ink/images/unplugin/Untitled%203.png">
<meta property="og:image" content="https://bobi.ink/images/unplugin/Untitled%204.png">
<meta property="og:image" content="https://bobi.ink/images/unplugin/Untitled%205.png">
<meta property="og:image" content="https://bobi.ink/images/unplugin/Untitled%206.png">
<meta property="og:updated_time" content="2023-09-25T07:15:41.999Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ä½¿ç”¨ unplugin ç¼–å†™è·¨å¹³å°çš„æ„å»ºæ’ä»¶">
<meta name="twitter:description" content="è¿™ç¯‡æ–‡ç« ç»§ç»­æˆ‘ä»¬çš„â€˜è·¨å¹³å°â€™ä¹‹æ—…ï¼Œ ä¹‹å‰æˆ‘ä»¬èŠè¿‡:  ç¼–å†™â€˜è·¨ç‰ˆæœ¬â€™ çš„ç»„ä»¶åº“ï¼š å¦‚ä½•å®ç°æ”¯æŒè·¨ Vue 2/3 çš„ç»„ä»¶åº“ ç¼–å†™â€˜è·¨æ¡†æ¶â€™çš„ç»„ä»¶ï¼šæ¥ä¸€ç“¶ Web Component é­”æ³•èƒ¶æ°´ è·¨å¹³å°çš„è¿è¡Œå®¹å™¨ï¼š ä½¿ç”¨ Docker å®ç°å‰ç«¯åº”ç”¨çš„æ ‡å‡†åŒ–æ„å»ºã€éƒ¨ç½²å’Œè¿è¡Œ ç¼–å†™è·¨è¿è¡Œæ—¶çš„ç¨‹åº   ä»Šå¤©ç»§ç»­æ¥èŠä¸€ä¸‹æ€ä¹ˆç¼–å†™â€˜è·¨å¹³å°â€™çš„æ„å»ºæ’ä»¶ï¼Œå‰ç«¯æ„å»ºå·¥å…·ä¸€ç›´éƒ½æ˜¯ä¸€ä¸ªæ¯”è¾ƒå·çš„èµ›é“ï¼Œæ¯•ç«Ÿå®ƒæ˜¯å‰ç«¯å·¥ç¨‹åŒ–">
<meta name="twitter:image" content="https://bobi.ink/images/unplugin/Untitled.png">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>ä½¿ç”¨ unplugin ç¼–å†™è·¨å¹³å°çš„æ„å»ºæ’ä»¶</title>
    <!-- styles -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- rss -->
    
    
</head>

<body>
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Blogs</a></li>
         
          <li><a href="http://github.com/ivan-94">Projects</a></li>
        
      </ul>
    </span>
    <br>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2023/09/27/to-young-me/"><i class="fa fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/2023/09/19/codemod/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://bobi.ink/2023/09/25/unplugin/"><i class="fa fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=https://bobi.ink/2023/09/25/unplugin/&text=ä½¿ç”¨ unplugin ç¼–å†™è·¨å¹³å°çš„æ„å»ºæ’ä»¶"><i class="fa fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://bobi.ink/2023/09/25/unplugin/&title=ä½¿ç”¨ unplugin ç¼–å†™è·¨å¹³å°çš„æ„å»ºæ’ä»¶"><i class="fa fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://bobi.ink/2023/09/25/unplugin/&is_video=false&description=ä½¿ç”¨ unplugin ç¼–å†™è·¨å¹³å°çš„æ„å»ºæ’ä»¶"><i class="fa fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=ä½¿ç”¨ unplugin ç¼–å†™è·¨å¹³å°çš„æ„å»ºæ’ä»¶&body=Check out this article: https://bobi.ink/2023/09/25/unplugin/"><i class="fa fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=https://bobi.ink/2023/09/25/unplugin/&title=ä½¿ç”¨ unplugin ç¼–å†™è·¨å¹³å°çš„æ„å»ºæ’ä»¶"><i class="fa fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=https://bobi.ink/2023/09/25/unplugin/&title=ä½¿ç”¨ unplugin ç¼–å†™è·¨å¹³å°çš„æ„å»ºæ’ä»¶"><i class="fa fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://bobi.ink/2023/09/25/unplugin/&title=ä½¿ç”¨ unplugin ç¼–å†™è·¨å¹³å°çš„æ„å»ºæ’ä»¶"><i class="fa fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=https://bobi.ink/2023/09/25/unplugin/&title=ä½¿ç”¨ unplugin ç¼–å†™è·¨å¹³å°çš„æ„å»ºæ’ä»¶"><i class="fa fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=https://bobi.ink/2023/09/25/unplugin/&name=ä½¿ç”¨ unplugin ç¼–å†™è·¨å¹³å°çš„æ„å»ºæ’ä»¶&description="><i class="fa fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#webpack"><span class="toc-number">1.</span> <span class="toc-text">Webpack</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#rollup"><span class="toc-number">2.</span> <span class="toc-text">Rollup</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ç¼–å†™è·¨å¹³å°çš„æ’ä»¶"><span class="toc-number">3.</span> <span class="toc-text">ç¼–å†™è·¨å¹³å°çš„æ’ä»¶</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#å®æˆ˜"><span class="toc-number">4.</span> <span class="toc-text">å®æˆ˜</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#vue-çƒ­æ›´æ–°åˆè¯†"><span class="toc-number">4.1.</span> <span class="toc-text">Vue çƒ­æ›´æ–°åˆè¯†</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#å®ç°"><span class="toc-number">4.2.</span> <span class="toc-text">å®ç°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#æ”¯æŒ-hmr"><span class="toc-number">4.3.</span> <span class="toc-text">æ”¯æŒ HMR</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#æ€»ç»“"><span class="toc-number">5.</span> <span class="toc-text">æ€»ç»“</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#æ‰©å±•é˜…è¯»"><span class="toc-number">6.</span> <span class="toc-text">æ‰©å±•é˜…è¯»</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index width mx-auto px2 my4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        ä½¿ç”¨ unplugin ç¼–å†™è·¨å¹³å°çš„æ„å»ºæ’ä»¶
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">Bobi.ink</span>
      </span>
      
    <div class="postdate">
        <time datetime="2023-09-24T16:00:00.000Z" itemprop="datePublished">2023-09-25</time>
    </div>


      

    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <p><img src="/images/unplugin/Untitled.png" alt="State of JS"></p>
<p><br></p>
<p>è¿™ç¯‡æ–‡ç« ç»§ç»­æˆ‘ä»¬çš„â€˜è·¨å¹³å°â€™ä¹‹æ—…ï¼Œ ä¹‹å‰æˆ‘ä»¬èŠè¿‡:</p>
<ul>
<li>ç¼–å†™â€˜è·¨ç‰ˆæœ¬â€™ çš„ç»„ä»¶åº“ï¼š <a href="https://juejin.cn/post/7243413934765916219" target="_blank" rel="noopener">å¦‚ä½•å®ç°æ”¯æŒè·¨ Vue 2/3 çš„ç»„ä»¶åº“</a></li>
<li>ç¼–å†™â€˜è·¨æ¡†æ¶â€™çš„ç»„ä»¶ï¼š<a href="https://juejin.cn/post/7263062397240377404" target="_blank" rel="noopener">æ¥ä¸€ç“¶ Web Component é­”æ³•èƒ¶æ°´</a></li>
<li>è·¨å¹³å°çš„è¿è¡Œå®¹å™¨ï¼š <a href="https://juejin.cn/post/7269668219488354361" target="_blank" rel="noopener">ä½¿ç”¨ Docker å®ç°å‰ç«¯åº”ç”¨çš„æ ‡å‡†åŒ–æ„å»ºã€éƒ¨ç½²å’Œè¿è¡Œ</a></li>
<li><a href="https://juejin.cn/post/7277426842814709815" target="_blank" rel="noopener">ç¼–å†™è·¨è¿è¡Œæ—¶çš„ç¨‹åº</a></li>
</ul>
<p><br></p>
<p>ä»Šå¤©ç»§ç»­æ¥èŠä¸€ä¸‹æ€ä¹ˆç¼–å†™â€˜è·¨å¹³å°â€™çš„æ„å»ºæ’ä»¶ï¼Œå‰ç«¯æ„å»ºå·¥å…·ä¸€ç›´éƒ½æ˜¯ä¸€ä¸ªæ¯”è¾ƒå·çš„èµ›é“ï¼Œæ¯•ç«Ÿå®ƒæ˜¯å‰ç«¯å·¥ç¨‹åŒ–çš„é‡è¦ä¸€ç¯ï¼Œæ­¤æ—¶æ­¤åˆ»å®ƒæ­£åœ¨ç»å†ç€æ–°ä¸€è½®çš„å˜é© â€”â€” ä½¿ç”¨ç³»ç»Ÿç¼–ç¨‹è¯­è¨€(å¦‚ Rustã€Go) é‡æ„ã€‚</p>
<p><br></p>
<p>ä» Webpackã€Parcelï¼Œåˆ° Vite, å†åˆ° Turbopackã€<a href="https://www.rspack.dev/" target="_blank" rel="noopener">Rspack</a>ã€Bunâ€¦ ç™¾èŠ±é½æ”¾ã€‚</p>
<p><br></p>
<p>é‚£é—®é¢˜åˆæ¥äº†ï¼Œæ–°çš„æ„å»ºå·¥å…·å‡ºæ¥ï¼Œæ„å‘³ç€åˆæœ‰æ–°çš„â€œæŠ€æœ¯å€ºâ€äº§ç”Ÿã€‚</p>
<p>åœ¨è¿™ä¸ªæŠ€æœ¯å¿«é€Ÿå‘å±•çš„æ—¶ä»£ï¼Œæ–°æ—§å¹¶å­˜çš„å±€é¢æ²¡åŠæ³•é¿å…ã€‚ä½œä¸ºåº“çš„å¼€å‘è€…ï¼Œæˆ‘ä»¬å¸Œæœ›æˆ‘ä»¬çš„åº“èƒ½å¤ŸæœåŠ¡æ›´å¤šçš„äººï¼Œé‚£â€œè·¨å¹³å°â€æ˜¯æˆ‘ä»¬ä¸å¾—ä¸è€ƒè™‘çš„é—®é¢˜ã€‚</p>
<p><br></p>
<p><strong>æ€ä¹ˆå¼€å‘ä¸€ä¸ªè·¨å¹³å°çš„æ„å»ºæ’ä»¶å‘¢ï¼Ÿ</strong></p>
<p>é¦–å…ˆæˆ‘ä»¬è¦ç«™åœ¨æ›´é«˜çš„è§’åº¦å®¡è§†è¿™äº›æ„å»ºå·¥å…·ï¼Œè¿™äº›æ„å»ºå·¥å…·ä¸»è¦åšä»€ä¹ˆå·¥ä½œï¼Ÿä»å®ƒä»¬æš´éœ²çš„æ’ä»¶ API ä¸­æŠ½è±¡å…±æ€§ã€‚è¿™äº›æ„å»ºå·¥å…·ç›®çš„éƒ½æ˜¯ä¸€è‡´çš„ï¼Œæ— éå°±æ˜¯:</p>
<ul>
<li>æ–‡ä»¶é¢„å¤„ç†/è½¬æ¢ã€‚æ¯”å¦‚ sassã€typescriptã€imageã€icon ç­‰ï¼Œå‰ç«¯éœ€è¦å¤„ç†çš„å„ç±»èµ„æºçš„å¤„ç†</li>
<li>ä¾èµ–å…³ç³»å¤„ç†ã€‚è§£æå’Œå¤„ç†æ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³ç³»</li>
<li>ä»£ç è¾“å‡ºã€‚åŒ…å«ä»£ç åˆå¹¶ã€ä»£ç ä¼˜åŒ–ã€äº§ç‰©è¾“å‡ºç­‰ã€‚</li>
</ul>
<p>ä¸»è¦çš„å·®å¼‚ç‚¹æ— éå°±æ˜¯å®ç°ä¸åŒï¼Œè¿›è€Œåœ¨æ‰©å±•æ€§ã€æ„å»ºæ€§èƒ½ä¸Šé¢ä¹Ÿä¼šæœ‰ä¸åŒçš„è¡¨ç°ã€‚</p>
<p><br></p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬å°±æŒ‘ä¸¤ä¸ªç›®å‰æ¯”è¾ƒä¸»æµçš„æ„å»ºå·¥å…·æ¥å–µå–µçœ‹ï¼Œæˆ‘æŒ‘é€‰çš„æ˜¯ <code>Webpack</code> å’Œ <code>Rollup</code>ï¼ˆ Vite ä¹Ÿæ˜¯åŸºäº Rollup çš„ï¼Œä¸¤è€…å·®å¼‚ä¸å¤§ï¼‰ã€‚</p>
<p><br><br><br></p>
<h1 id="webpack"><a href="#webpack" class="headerlink" title="Webpack"></a>Webpack</h1><p>å°½ç®¡è¿™å‡ å¹´å—åˆ°äº† Vite ç­‰æ–¹æ¡ˆçš„æŒ‘æˆ˜ï¼Œä½†ä¸å¾—ä¸æ‰¿è®¤ï¼ŒWebpack ä¾æ—§æ˜¯ç‹ï¼Œè‡³å°‘åœ¨ç”Ÿæ€å’Œå­˜é‡å¸‚åœºä¸Šã€‚</p>
<p><br></p>
<p>Webpack æ˜¯åŸºäº<code>äº‹ä»¶é©±åŠ¨</code>(Event Driven) çš„<code>æ’ä»¶å¼</code>ç¼–è¯‘å™¨ã€‚Webpack å°±æ˜¯ä¸€ä¸ªéå¸¸å…¸å‹çš„<code>å¾®å†…æ ¸</code>æ¶æ„ï¼Œ å¯ä»¥è¯´ Webpack çš„å†…æ ¸å°±æ˜¯ <a href="https://github.com/webpack/tapable" target="_blank" rel="noopener"><code>Tapable</code></a>ï¼Œéå¸¸å°ã€éå¸¸ä¼˜é›…ã€‚éå¸¸å€¼å¾—æˆ‘ä»¬å»åå¤å’€åš¼ç ”ç©¶</p>
<p>å‡ ä¹æ‰€æœ‰çš„åŠŸèƒ½ï¼Œä¸ç®¡æ˜¯å†…ç½®çš„ã€è¿˜æ˜¯ç¬¬ä¸‰æ–¹çš„éƒ½æ˜¯é€šè¿‡æ’ä»¶çš„å½¢å¼å®ç°ã€‚åŒ…æ‹¬æˆ‘ä»¬çœ‹åˆ°çš„æ‰€æœ‰çš„ webpack é…ç½®ï¼Œ éƒ½ä¼šè¢«è§£æè½¬æ¢æˆç›¸åº”çš„æ’ä»¶ï¼Œè€Œé…ç½®ä¸è¿‡æ˜¯æ–¹ä¾¿ç”¨æˆ·ä½¿ç”¨çš„<code>ç”¨æˆ·ç•Œé¢</code>ç½¢äº†</p>
<p>Webpack é€šè¿‡ <code>Tapable Hooks</code> æš´éœ²äº†ä¸°å¯Œçš„ç”Ÿå‘½å‘¨æœŸé’©å­ï¼Œæ”¯æŒå¼€å‘è€…å¯¹ç¼–è¯‘å™¨ã€æ¨¡å—æŸ¥æ‰¾ã€æ–‡ä»¶è½¬æ¢ã€ä¼˜åŒ–ã€äº§ç‰©ç”Ÿæˆçš„æ¯ä¸€ä¸ªç»†èŠ‚è¿›è¡Œå®šåˆ¶ã€‚</p>
<p><br></p>
<blockquote>
<p>ğŸ’¡  äº†è§£ Webpack çš„ä¸€äº›åŸºæœ¬æ¦‚å¿µã€‚</p>
<ul>
<li><code>Compiler</code>ï¼šå³ Webpack ç¼–è¯‘å™¨æœ¬èº«ï¼Œå®ƒä»æ•´ä½“ä¸Šç®¡ç† Webpack çš„ç”Ÿå‘½å‘¨æœŸï¼Œè´Ÿè´£å¤„ç†é…ç½®ã€åŠ è½½æ’ä»¶ã€æ„é€ æ ¸å¿ƒçš„å¯¹è±¡ï¼ˆCompilationã€Resolverã€Modulefactory ç­‰ï¼‰ï¼Œå¯ä»¥è®¤ä¸ºå°±æ˜¯ä¸€ä¸ªå…¨å±€çš„ç®¡ç†è€…ã€‚</li>
<li><code>Compilation</code>: ç”± Compiler åˆ›å»ºï¼Œå¯ä»¥è®¤ä¸ºæ˜¯ Webpack çš„æ ¸å¿ƒå¤§è„‘ï¼ŒWebpack çš„å¤§éƒ¨åˆ†å·¥ä½œç”±å®ƒå®Œæˆï¼Œå®ƒåŒ…å«ä¾èµ–å›¾(Dependency Graph)çš„æ„é€ ã€è´Ÿè´£æ¨¡å—æ„é€ ã€è½¬æ¢ã€ä¼˜åŒ–ã€èµ„æºè¾“å‡ºç­‰å„ç§æ ¸å¿ƒçš„æµç¨‹ã€‚</li>
<li><code>Resolver</code>ï¼šæ¨¡å—æŸ¥æ‰¾å™¨ï¼Œç®€å•è¯´å°±æ˜¯å°†ç›¸å¯¹è·¯å¾„è½¬æ¢ä¸ºç»å¯¹è·¯å¾„</li>
<li><code>Module</code>: JavaScript æ¨¡å—åœ¨ Webpack å†…çš„è¡¨ç¤º</li>
<li><code>Module Factory</code>ï¼šModule æ„é€ å·¥å‚</li>
<li><code>Parser</code>ï¼šè§£æ Module ä¸º AST, è·å–æ¨¡å—ä¾èµ–ã€‚</li>
<li><code>Loader</code>: è´Ÿè´£å°†æ–‡ä»¶è¾“å…¥(æ¯”å¦‚å›¾ç‰‡ã€CSSã€JavaScript æ–‡ä»¶ç­‰ç­‰)è½¬æ¢ä¸º Moduleã€‚Loader é€šå¸¸åªè´Ÿè´£æ— å‰¯ä½œç”¨çš„è½¬æ¢å·¥ä½œï¼ŒLoader æœ‰ç‚¹ç±»ä¼¼äº Shell å‘½ä»¤è¡Œ</li>
<li><code>Plugin</code>: æ’ä»¶ï¼Œä¸º Webpack æ‰©å±•å®é™…çš„åŠŸèƒ½</li>
</ul>
</blockquote>
<p><br></p>
<p>Webpack æš´éœ²äº†éå¸¸ä¸°å¯Œçš„ <a href="https://webpack.js.org/api/compiler-hooks/" target="_blank" rel="noopener">Hooks</a>ï¼Œè¿™äº› Hooks ä¸»è¦ç”±ä¸¤ä¸ªä¸»è¦çš„å¯¹è±¡ç®¡ç†ï¼Œå³ <code>Compiler</code> å’Œ <code>Compilation</code>ã€‚æ€ä¹ˆç†è§£è¿™ä¸¤ä¸ªå¯¹è±¡å‘¢ï¼Ÿä»ä¸¤ä¸ªè§’åº¦çœ‹ï¼š</p>
<p><br></p>
<ul>
<li>ä»æ„å»ºå·¥å…·çš„è§’åº¦çœ‹ï¼Œ Compiler ä»£è¡¨çš„æ˜¯ Webpack æ„å»ºçš„æ•´ä½“æµç¨‹</li>
<li>ä»æ¨¡å—çš„è§’åº¦çœ‹ï¼Œ Compilation åˆ™è´Ÿè´£å…·ä½“æ¨¡å—çš„ç¼–è¯‘æµç¨‹</li>
</ul>
<p><br></p>
<p>ä¸‹é¢ï¼Œæˆ‘æ•´ç† Compiler å’Œ Compilation æš´éœ²çš„å¸¸ç”¨çš„ hooks ä»¥åŠè°ƒç”¨çš„é¡ºåºã€‚å¯ä»¥ä¸€çª¥ Webpack çš„è¿è¡ŒåŸç†ã€‚</p>
<p><strong>Compiler ç”Ÿå‘½å‘¨æœŸ</strong>ï¼š</p>
<p><img src="/images/unplugin/Untitled%201.png" alt="Compiler"></p>
<p><br></p>
<p><strong>Compilation ç”Ÿå‘½å‘¨æœŸ</strong>ï¼š</p>
<p><img src="/images/unplugin/Untitled%202.png" alt="Compilation"></p>
<p><br></p>
<p>è¿™äº› Hooks çš„è¯¦æƒ…ä»‹ç»å’Œä½¿ç”¨ï¼Œå¯ä»¥å‚è€ƒ <a href="https://webpack.js.org/api/compiler-hooks/#afterenvironment" target="_blank" rel="noopener">Webpack çš„æ–‡æ¡£</a>ã€‚</p>
<p><strong>æˆ‘å»ºè®®ä½ å»ç›´æ¥å»çœ‹ Webpack çš„æºç ï¼ŒæŠ€å·§æ˜¯ï¼šæœç´¢å¯¹åº”çš„ Hooks æ˜¯æ€ä¹ˆè¢«è§¦å‘å’Œæ¶ˆè´¹çš„ï¼Œ å¯ä»¥å¸®åŠ©ä½ è¿›ä¸€æ­¥ç†è§£å®ƒä»¬çš„æ„ä¹‰ã€‚</strong></p>
<p><br><br><br></p>
<h1 id="rollup"><a href="#rollup" class="headerlink" title="Rollup"></a>Rollup</h1><p>è·Ÿ Webpack ç›¸æ¯”ï¼ŒRollup çš„ hooks æ›´åŠ ç²¾ç»ƒã€‚æ²¡æœ‰åƒ Webpack ä¸€æ ·åŒºåˆ† Compiler å’Œ Compillationï¼ŒLoader å’Œ Pluginã€‚</p>
<p>Webpack æš´éœ²äº†å¾ˆå¤š Hooksï¼Œæœ‰äº›æ–‡æ¡£ä¸Šéƒ½æ²¡æœ‰æåŠï¼Œç”šè‡³æœ‰äº›è¿ Webpack è‡ªå·±ä¹Ÿæ²¡ç”¨ä¸Šã€‚</p>
<p>å°½ç®¡è¿™æ ·å­å¯ä»¥ç»™å¼€å‘è€…å¾ˆå¤§çš„å®šåˆ¶ç©ºé—´ï¼Œä½†å¯¹äºåˆå­¦è€…æ¥è¯´ï¼Œå°±å¾ˆå®¹æ˜“è¢«è¿™äº›ç»†èŠ‚æ·¹æ²¡ã€‚</p>
<p><br></p>
<p><strong>Rollup æ„å»º Hooks</strong>:</p>
<p><img src="/images/unplugin/Untitled%203.png" alt="Build hooks"></p>
<ul>
<li><code>resolveId</code>: ç”¨äºè‡ªå®šä¹‰æ¨¡å—æŸ¥æ‰¾é€»è¾‘</li>
<li><code>load</code>: ç”¨äºè‡ªå®šä¹‰æ¨¡å—åŠ è½½é€»è¾‘</li>
<li><code>transform</code>ï¼šå¯ä»¥ç”¨äºè½¬æ¢æ¨¡å—</li>
<li><code>moduleParsed</code>ï¼šæ¨¡å—å·²è§£æ</li>
</ul>
<p><br><br><br><br><br><br><br></p>
<p><strong>Rollup ä»£ç ç”Ÿæˆ Hooks</strong>:</p>
<p><img src="/images/unplugin/Untitled%204.png" alt="Emit Hooks"></p>
<p>å­¦ä¹  Rollup æ’ä»¶çš„æœ€å¥½æ–¹å¼ï¼Œè¿˜æ˜¯å»ä¸´æ‘¹åˆ«äººæ€ä¹ˆå†™ï¼Œ å…ˆä»<a href="https://github.com/rollup/plugins/tree/master/packages" target="_blank" rel="noopener">å®˜æ–¹çš„æ’ä»¶</a>å¼€å§‹å§ã€‚</p>
<p><br><br><br><br><br><br><br></p>
<h1 id="ç¼–å†™è·¨å¹³å°çš„æ’ä»¶"><a href="#ç¼–å†™è·¨å¹³å°çš„æ’ä»¶" class="headerlink" title="ç¼–å†™è·¨å¹³å°çš„æ’ä»¶"></a>ç¼–å†™è·¨å¹³å°çš„æ’ä»¶</h1><p>é™¤äº† Webpackã€Rollupï¼Œè¿˜æœ‰å¾ˆå¤šæ„å»ºå·¥å…·ä¸åœåœ°è¢«é€ å‡ºæ¥ï¼Œæœ‰æ²¡æœ‰åŠæ³•å¼€å‘ä¸€å¥—è·¨å¹³å°çš„æ’ä»¶å‘¢ï¼Ÿ</p>
<p>ç›®å‰æœ€ä½³ç­”æ¡ˆæ˜¯ <a href="https://github.com/unjs/unplugin" target="_blank" rel="noopener">unplugin</a>, å®ƒçš„ä¸»è¦è´¡çŒ®è€…è¿˜æ˜¯ <a href="https://github.com/antfu" target="_blank" rel="noopener">antfu</a> å¤§ä½¬ã€‚</p>
<p><br></p>
<p>unplugin ä»¥ Rollup æ’ä»¶ API ä¸ºåŸºå‡†ï¼ŒRollup è¿™å¥— API éå¸¸ç²¾ç»ƒï¼Œè¿™ä¸ªæŠ½è±¡åŸºæœ¬å¯ä»¥è¦†ç›–åˆ°ä¸»æµçš„æ„å»ºå·¥å…·ã€‚</p>
<p><img src="/images/unplugin/Untitled%205.png" alt="API"></p>
<p><br></p>
<p>å¤§å®¶å¯ä»¥ç›´æ¥å»çœ‹æºç ï¼Œä»£ç å¹¶ä¸å¤šã€‚ä»¥ä¸‹æ˜¯ Webpack å’Œ unplugin API çš„æ˜ å°„å…³ç³»ï¼š</p>
<p><img src="/images/unplugin/Untitled%206.png" alt="Webpack to Rollup"></p>
<p><br><br><br><br><br></p>
<h1 id="å®æˆ˜"><a href="#å®æˆ˜" class="headerlink" title="å®æˆ˜"></a>å®æˆ˜</h1><p>æ¥ä¸‹æ¥ï¼Œæ˜¯å®æˆ˜éƒ¨åˆ†ã€‚</p>
<p>æˆ‘åœ¨ <a href="https://juejin.cn/post/7244800185024380984#heading-4" target="_blank" rel="noopener">ã€Šå‰ç«¯å¦‚ä½•ç ´è§£ CRUD çš„å¾ªç¯ã€‹</a>ä»‹ç»äº†æˆ‘ä»¬çš„ç»„ä»¶åº“ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineFatForm &#125; <span class="keyword">from</span> <span class="string">'@wakeadmin/components'</span></span><br><span class="line"><span class="keyword">import</span> &#123; ElMessageBox &#125; <span class="keyword">from</span> <span class="string">'element-plus'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineFatForm&lt;&#123;</span><br><span class="line">  <span class="comment">// ğŸ”´ è¿™é‡Œçš„æ³›å‹å˜é‡å¯ä»¥å®šä¹‰è¡¨å•æ•°æ®ç»“æ„</span></span><br><span class="line">  name: string</span><br><span class="line">  nickName: string</span><br><span class="line">&#125;&gt;<span class="function">(<span class="params">(&#123; item, form, consumer, group &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ğŸ”´ è¿™é‡Œå¯ä»¥æ”¾ç½® Vue Hooks</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// è¿”å›è¡¨å•å®šä¹‰</span></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> (&#123;</span><br><span class="line">    <span class="comment">// FatForm props å®šä¹‰</span></span><br><span class="line">    initialValue: &#123;</span><br><span class="line">      name: <span class="string">'ivan'</span>,</span><br><span class="line">      nickName: <span class="string">'ç‹—è›‹'</span>,</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    submit: <span class="keyword">async</span> (values) =&gt; &#123;</span><br><span class="line">      <span class="keyword">await</span> ElMessageBox.confirm(<span class="string">'ç¡®è®¤ä¿å­˜'</span>)</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'ä¿å­˜æˆåŠŸ'</span>, values)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ğŸ”´ å­èŠ‚ç‚¹</span></span><br><span class="line">    children: [</span><br><span class="line">      item(&#123; <span class="attr">prop</span>: <span class="string">'name'</span>, <span class="attr">label</span>: <span class="string">'è´¦å·å'</span> &#125;),</span><br><span class="line">      item(&#123;</span><br><span class="line">        prop: <span class="string">'nickName'</span>,</span><br><span class="line">        label: <span class="string">'æ˜µç§°'</span>,</span><br><span class="line">      &#125;),</span><br><span class="line">    ],</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>ç°åœ¨æœ‰ä¸€ä¸ªé—®é¢˜ï¼ŒdefineFatForm è¿™ç§å†™æ³•ä¸æ”¯æŒçƒ­æ›´æ–°ï¼Œæ¯æ¬¡ä¿®æ”¹éƒ½ä¼šé‡åˆ·é¡µé¢ï¼Œä½“éªŒå¾ˆå·®ã€‚</p>
<p><br></p>
<p>å› æ­¤ä»Šå¤©æˆ‘ä»¬å°±æ¥å†™ä¸€ä¸ªæ’ä»¶ï¼Œè®©æˆ‘ä»¬çš„ç»„ä»¶åº“ define* å†™æ³•ä¹Ÿæ”¯æŒåƒ Vue defineComponent ä¸€æ ·çš„çƒ­æ›´æ–°ã€‚</p>
<blockquote>
<p>defineComponent çš„çƒ­æ›´æ–°å®ç°å¯ä»¥å‚è€ƒ <a href="https://github.com/vitejs/vite-plugin-vue/tree/main/packages/plugin-vue-jsx" target="_blank" rel="noopener">@vitejs/plugin-vue-js</a></p>
</blockquote>
<p><br><br><br><br><br><br><br></p>
<h2 id="vue-çƒ­æ›´æ–°åˆè¯†"><a href="#vue-çƒ­æ›´æ–°åˆè¯†" class="headerlink" title="Vue çƒ­æ›´æ–°åˆè¯†"></a>Vue çƒ­æ›´æ–°åˆè¯†</h2><p>æ¥ç®€å•çœ‹çœ‹ Vue æ˜¯æ€ä¹ˆå®ç°çƒ­æ›´æ–°</p>
<p>åœ¨ <code>SFC</code> ï¼ˆSingle File Componentï¼‰æ–‡ä»¶ç¼–è¯‘ä¹‹åï¼ŒVue æ’ä»¶ä¼šæ³¨å…¥ä»¥ä¸‹ä»£ç :</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ğŸ”´ _sfc_main æ˜¯ SFC ç¼–è¯‘å‡ºæ¥çš„ Vue Component ç»„ä»¶</span></span><br><span class="line">_sfc_main.__hmrId = <span class="string">'æ¨¡å—ID'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ğŸ”´ æ³¨å†Œç»„ä»¶è®°å½•</span></span><br><span class="line"><span class="keyword">typeof</span> __VUE_HMR_RUNTIME__ !== <span class="string">'undefined'</span> &amp;&amp; __VUE_HMR_RUNTIME__.createRecord(_sfc_main.__hmrId, _sfc_main)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> _rerender_only = <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ğŸ”´ vite çƒ­æ›´æ–°</span></span><br><span class="line"><span class="keyword">import</span>.meta.hot.(<span class="function"><span class="params">mod</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ğŸ”´ å½“å‰æ¨¡å—æ›´æ–°åä¼šè§¦å‘å½“å‰å›è°ƒ</span></span><br><span class="line">  <span class="keyword">if</span> (!mod) <span class="keyword">return</span></span><br><span class="line">  <span class="keyword">const</span> &#123; <span class="attr">default</span>: updated, _rerender_only &#125; = mod</span><br><span class="line">  <span class="keyword">if</span> (_rerender_only) &#123;</span><br><span class="line">    <span class="comment">// ğŸ”´ SFC å¯ä»¥æ”¯æŒæ›¿æ¢ renderï¼Œä¸ä¼šä¸¢å¤±çŠ¶æ€ï¼Œå¼€å‘ä½“éªŒä¼šæ›´å¥½ï¼Œ</span></span><br><span class="line">    __VUE_HMR_RUNTIME__.rerender(updated.__hmrId, updated.render)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// ğŸ”´ å¦‚æœæ˜¯ defineComponent å°±è¿™é‡Œèµ°è¿™é‡Œäº†ï¼Œä¼šè§¦å‘ parent å®Œå…¨é‡æ–°æ¸²æŸ“ç»„ä»¶ï¼ŒçŠ¶æ€ä¼šä¸¢å¤±</span></span><br><span class="line">    __VUE_HMR_RUNTIME__.reload(updated.__hmrId, updated)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>Vue å†…éƒ¨æ˜¯æ€ä¹ˆå®ç° <code>HMR</code> çš„å‘¢ï¼Ÿ</p>
<ul>
<li><code>__VUE_HMR_RUNTIME__.createRecord(æ¨¡å—ID, ç»„ä»¶)</code> ä¼šå°†â€œ<code>ç»„ä»¶å®ç°</code>â€æ”¾åˆ°ä¸€ä¸ªå…¨å±€ Map ä¸­ï¼Œå’Œ <code>æ¨¡å— ID</code> å…³è”èµ·æ¥</li>
<li><p>ç»„ä»¶æŒ‚è½½æ—¶ï¼Œå°†ç»„ä»¶å®ä¾‹ + æ¨¡å— ID å…³è”èµ·æ¥ï¼š</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æŒ‚è½½æ—¶æ³¨å†Œ</span></span><br><span class="line"><span class="keyword">if</span> (__DEV__ &amp;&amp; instance.type.__hmrId) &#123;</span><br><span class="line">  registerHMR(instance)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>  <br></p>
<p>ç°åœ¨å…¨å±€ Map çš„ç»“æ„ç±»ä¼¼ï¼š</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> records = &#123;</span><br><span class="line">  [__hmrId]: &#123;</span><br><span class="line">    initialDef: ç»„ä»¶å®ç°ï¼Œ</span><br><span class="line">    instances: <span class="built_in">Set</span>&lt;[æ‰€æœ‰å·²æ¸²æŸ“çš„ç»„ä»¶å®ä¾‹]&gt;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>ç»„ä»¶å¸è½½åï¼ŒåŒç†ä»è¿™ä¸ª Map ä¸­ç§»é™¤å®ä¾‹</p>
</li>
<li>rerender: æ›´æ–° initialDef å’Œæ‰€æœ‰â€œç»„ä»¶å®ä¾‹â€ render æ–¹æ³•ï¼Œç„¶å update() æ‰€æœ‰â€œç»„ä»¶å®ä¾‹â€</li>
<li>reloadï¼šæ›´æ–° initialDef, éå†æ‰€æœ‰â€œç»„ä»¶å®ä¾‹â€ï¼Œè°ƒç”¨â€œç»„ä»¶å®ä¾‹â€ parent èŠ‚ç‚¹ çš„ update() æ–¹æ³•ï¼Œé‡æ–°æ¸²æŸ“å½“å‰ç»„ä»¶</li>
</ul>
<blockquote>
<p>æºç åœ¨<a href="https://github.com/vuejs/core/blob/main/packages/runtime-core/src/hmr.ts" target="_blank" rel="noopener">è¿™é‡Œ</a>ã€‚æ¥çœ‹çœ‹</p>
</blockquote>
<p><br><br><br><br><br></p>
<h2 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h2><p>é¦–å…ˆï¼Œå¿«é€Ÿé€šè¿‡ <a href="https://github.com/unplugin/unplugin-starter" target="_blank" rel="noopener">unplugin-starter</a> åˆå§‹åŒ–ä¸€ä¸ªé¡¹ç›®æ¨¡æ¿ï¼š</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ npx degit antfu/unplugin-starter unplugin-wakeadmin-components</span><br></pre></td></tr></table></figure>
<p><br></p>
<p>åœ¨é¡¹ç›®å‘½åä¸Šï¼Œéµå¾ª unplugin çš„<a href="https://github.com/unjs/unplugin#conventions" target="_blank" rel="noopener">è§„èŒƒ</a>ï¼Œ ä½¿ç”¨ <code>unplugin-*</code> çš„å½¢å¼ï¼Œ Vite ä¸‹ï¼Œæ’ä»¶ç”¨æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="comment">// vite.config.ts</span></span><br><span class="line"><span class="keyword">import</span> WakeadminComponents <span class="keyword">from</span> <span class="string">'unplugin-wakeadmin-components/vite'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> defineConfig(&#123;</span><br><span class="line">  plugins: [</span><br><span class="line">    WakeadminComponents(&#123;</span><br><span class="line">      <span class="comment">/* options */</span></span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><br></p>
<p>å…ˆæ¥å†™ä¸€ä¸ª Hello worldï¼Œå°è¯•ç‰›åˆ€ã€‚</p>
<p>ç¬¬ä¸€æ­¥ï¼Œ æˆ‘ä»¬å…ˆç»™ <code>define*</code> æ–¹æ³•è°ƒç”¨åŠ ä¸Š <code>#__PURE__</code> æ³¨é‡Šï¼Œé¿å…è¢«è¯†åˆ«ä¸ºâ€˜å‰¯ä½œç”¨â€™ï¼Œè¿™ä¸ªæœ‰åˆ©äº Tree-Shaking å’Œ æ­»ä»£ç æ¶ˆé™¤(Dead Code Elimination)ã€‚</p>
<p><br><br><br></p>
<p>è¯»è€…å¯ä»¥åœ¨ <a href="https://try.terser.org/" target="_blank" rel="noopener">Terser REPL</a> ä¸Šå¯¹æ¯”ä¸€ä¸‹ä»¥ä¸‹ä»£ç çš„ä¼˜åŒ–ç»“æœï¼š</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="comment">// B ä¸ä¼šè¢«æ¸…ç†æ‰</span></span><br><span class="line"><span class="keyword">const</span> A = defineA(&#123;&#125;)</span><br><span class="line"><span class="keyword">const</span> B = defineA(&#123;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(A)</span><br></pre></td></tr></table></figure>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="comment">// B ä¼šè¢«æ¸…ç†æ‰</span></span><br><span class="line"><span class="keyword">const</span> A = <span class="comment">/*#__PURE__*/</span> defineA(&#123;&#125;)</span><br><span class="line"><span class="keyword">const</span> B = <span class="comment">/*#__PURE__*/</span> defineA(&#123;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(A)</span><br></pre></td></tr></table></figure>
<p><br><br><br></p>
<p>ç°åœ¨å¼€å§‹å†™æ’ä»¶çš„å®ç°ã€‚é¦–å…ˆå®šä¹‰æ’ä»¶çš„<code>å‚æ•°</code>ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import type &#123; ParserOptions &#125; from &apos;@babel/core&apos;</span><br><span class="line">import type &#123; FilterPattern &#125; from &apos;@rollup/pluginutils&apos;</span><br><span class="line"></span><br><span class="line">export interface Options &#123;</span><br><span class="line">  /**</span><br><span class="line">   * å¾…å¤„ç†çš„æ–‡ä»¶ï¼Œé»˜è®¤ ä¼šå¤„ç† .jsxã€.tsx æ–‡ä»¶</span><br><span class="line">   */</span><br><span class="line">  include?: FilterPattern</span><br><span class="line">  exclude?: FilterPattern</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * æ˜¯å¦å¼€å¯ defineComponent çš„å¤„ç†ï¼Œé»˜è®¤ false</span><br><span class="line">   */</span><br><span class="line">  enabledDefineComponent?: boolean</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * babel parser æ’ä»¶ï¼Œé»˜è®¤ [&apos;jsx&apos;]</span><br><span class="line">   * å¦‚æœæ˜¯ tsx æ–‡ä»¶ï¼Œä¼šåŠ ä¸Š typescript</span><br><span class="line">   */</span><br><span class="line">  parserPlugins?: ParserOptions[&apos;plugins&apos;]</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * è°ƒè¯•æ¨¡å¼</span><br><span class="line">   */</span><br><span class="line">  debug?: boolean</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br><br><br></p>
<p>æ¥ç€æ˜¯å®ç°ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import &#123; UnpluginFactory, createUnplugin &#125; from &apos;unplugin&apos;</span><br><span class="line">import &#123; createFilter &#125; from &apos;@rollup/pluginutils&apos;</span><br><span class="line">import type &#123; Options &#125; from &apos;./types&apos;</span><br><span class="line">import babel, &#123; PluginObj, ParserOptions &#125; from &apos;@babel/core&apos;</span><br><span class="line"></span><br><span class="line">const PLUGIN_NAME = &apos;unplugin-wakeadmin-components&apos;</span><br><span class="line">const t = babel.types</span><br><span class="line"></span><br><span class="line">const DEFINE_FACTORIES = new Set([&apos;defineFatTable&apos;, &apos;defineFatForm&apos;])</span><br><span class="line"></span><br><span class="line">function isDefineCall(node: babel.types.CallExpression) &#123;</span><br><span class="line">  return t.isIdentifier(node.callee) &amp;&amp; DEFINE_FACTORIES.has(node.callee.name)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export const unpluginFactory: UnpluginFactory&lt;Options | undefined&gt; = (options, meta) =&gt; &#123;</span><br><span class="line">  const filter = createFilter(options?.include || /\.[jt]sx$/, options?.exclude)</span><br><span class="line">  const enableDefineComponent = options?.enabledDefineComponent</span><br><span class="line"></span><br><span class="line">  if (enableDefineComponent) &#123;</span><br><span class="line">    DEFINE_FACTORIES.add(&apos;defineComponent&apos;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  const REGEXP = new RegExp(`($&#123;Array.from(DEFINE_FACTORIES).join(&apos;|&apos;)&#125;)`, &apos;g&apos;)</span><br><span class="line"></span><br><span class="line">  return &#123;</span><br><span class="line">    name: PLUGIN_NAME,</span><br><span class="line">    // ğŸ”´ é…ç½®ä¸º pre, åœ¨å…¶ä»– loader ä¹‹å‰å¤„ç†</span><br><span class="line">    enforce: &apos;pre&apos;,</span><br><span class="line">    // ğŸ”´ ç­›é€‰è¦è¢«è½¬æ¢çš„æ–‡ä»¶</span><br><span class="line">    transformInclude(id) &#123;</span><br><span class="line">      const [filepath] = id.split(&apos;?&apos;)</span><br><span class="line"></span><br><span class="line">      return filter(id) || filter(filepath)</span><br><span class="line">    &#125;,</span><br><span class="line">    //  ğŸ”´ è½¬æ¢é€»è¾‘</span><br><span class="line">    transform(code, id) &#123;</span><br><span class="line">      if (code.match(REGEXP) == null) &#123;</span><br><span class="line">        // æ²¡æœ‰åŒ…å« define* è·³è¿‡</span><br><span class="line">        return null</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      const plugins: PluginObj[] = []</span><br><span class="line">      const parserPlugins: ParserOptions[&apos;plugins&apos;] = [&apos;jsx&apos;]</span><br><span class="line"></span><br><span class="line">      if (id.endsWith(&apos;.tsx&apos;)) &#123;</span><br><span class="line">        parserPlugins.push(&apos;typescript&apos;)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      if (options?.parserPlugins) &#123;</span><br><span class="line">        parserPlugins.push(...options.parserPlugins)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      plugins.push(&#123;</span><br><span class="line">        visitor: &#123;</span><br><span class="line">          // ğŸ”´  ä¸º define* æ·»åŠ  #__PURE__</span><br><span class="line">          CallExpression(path) &#123;</span><br><span class="line">            if (isDefineCall(path.node)) &#123;</span><br><span class="line">              path.get(&apos;callee&apos;).addComment(&apos;leading&apos;, &apos;#__PURE__&apos;)</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">      const result = babel.transformSync(code, &#123;</span><br><span class="line">        sourceFileName: id,</span><br><span class="line">        sourceMaps: true,</span><br><span class="line">        babelrc: false,</span><br><span class="line">        configFile: false,</span><br><span class="line">        plugins,</span><br><span class="line">        parserOpts: &#123;</span><br><span class="line">          plugins: parserPlugins,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">      if (result?.code == null) &#123;</span><br><span class="line">        return null</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      return &#123;</span><br><span class="line">        code: result.code,</span><br><span class="line">        map: result?.map,</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export const unplugin = /* #__PURE__ */ createUnplugin(unpluginFactory)</span><br><span class="line"></span><br><span class="line">export default unplugin</span><br></pre></td></tr></table></figure>
<p><br></p>
<p>è¿™é‡Œä½¿ç”¨ Babel æ¥ parse å’Œ transform ä»£ç ã€‚é€»è¾‘å¾ˆç®€å•ï¼Œå°±æ˜¯æ‰¾åˆ°æ‰€æœ‰çš„å‡½æ•°è°ƒç”¨ï¼Œå¦‚æœåç§°åŒ¹é…åˆ°æˆ‘ä»¬çš„ <code>define*</code> åˆ—è¡¨ï¼Œå°±ç»™å®ƒæ·»åŠ  <code>#__PURE__</code> æ³¨é‡Šã€‚</p>
<p>å¦‚æœä½ å¯¹ Babel ä»£ç æ„Ÿåˆ°åƒåŠ›ï¼Œå¯ä»¥çœ‹æˆ‘ä¹‹å‰å†™çš„æ–‡ç«  <a href="https://juejin.cn/post/6844903956905197576" target="_blank" rel="noopener">æ·±å…¥æµ…å‡º Babel ä¸Šç¯‡ï¼šæ¶æ„å’ŒåŸç† + å®æˆ˜</a>ã€‚</p>
<p><br><br><br><br><br><br><br></p>
<h2 id="æ”¯æŒ-hmr"><a href="#æ”¯æŒ-hmr" class="headerlink" title="æ”¯æŒ HMR"></a>æ”¯æŒ HMR</h2><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ­£å¼æ·»åŠ  HMR çš„é€»è¾‘ã€‚</p>
<p>æˆ‘ä»¬éœ€è¦åœ¨ JavaScript æ–‡ä»¶ä¸­æ‰¾å‡ºæ‰€æœ‰ <code>define*</code> çš„â€œå¯¼å‡ºâ€ï¼Œ ä»¥ä¸‹å½¢å¼å¯¼å‡ºæˆ‘ä»¬éƒ½éœ€è¦æ”¯æŒï¼š</p>
<p><br></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">// å‘½åå¯¼å‡º</span><br><span class="line">export const NamedExport = defineFatForm(/*...*/)</span><br><span class="line">const AnotherNamedExport = defineFatForm(/*...*/)</span><br><span class="line"></span><br><span class="line">// å¦ä¸€ç§å‘½åå¯¼å‡º</span><br><span class="line">export &#123; AnotherNamedExport &#125;</span><br><span class="line"></span><br><span class="line">// é»˜è®¤å¯¼å‡ºå½¢å¼</span><br><span class="line">export default defineFatForm(/*...*/)</span><br></pre></td></tr></table></figure>
<p><br></p>
<p>è½¬æ¢åçš„ä»£ç ç±»ä¼¼äºï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">// å‘½åå¯¼å‡º</span><br><span class="line">export const NamedExport = defineFatForm(/*...*/)</span><br><span class="line">const AnotherNamedExport = defineFatForm(/*...*/)</span><br><span class="line"></span><br><span class="line">// å¦ä¸€ç§å‘½åå¯¼å‡º</span><br><span class="line">export &#123; AnotherNamedExport &#125;</span><br><span class="line"></span><br><span class="line">// ğŸ”´ é»˜è®¤å¯¼å‡ºå½¢å¼, ä½¿ç”¨ä¸€ä¸ªä¸´æ—¶å˜é‡å­˜å‚¨ï¼Œæ–¹ä¾¿åé¢ patch</span><br><span class="line">const __default__ = defineFatForm(/*...*/)</span><br><span class="line">export default __default__</span><br><span class="line"></span><br><span class="line">// ğŸ”´ æ³¨å†Œç»„ä»¶å®ä¾‹</span><br><span class="line">if (typeof __VUE_HMR_RUNTIME__ !== &apos;undefined&apos;) &#123;</span><br><span class="line">  NamedExport.__hmrId = &apos;a1203740&apos;</span><br><span class="line">  AnotherNamedExport.__hmrId = &apos;bad12ad2&apos;</span><br><span class="line">  __default__.__hmrId = &apos;x12312w32&apos;</span><br><span class="line"></span><br><span class="line">  __VUE_HMR_RUNTIME__.createRecord(&apos;a1203740&apos;, A)</span><br><span class="line">  __VUE_HMR_RUNTIME__.createRecord(&apos;bad12ad2&apos;, AnotherNamedExport)</span><br><span class="line">  __VUE_HMR_RUNTIME__.createRecord(&apos;x12312w32&apos;, __default__)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// ğŸ”´ vite HMR</span><br><span class="line">if (import.meta.hot) &#123;</span><br><span class="line">  import.meta.hot.accept(</span><br><span class="line">    (&#123;</span><br><span class="line">      NamedExport: __NamedExport,</span><br><span class="line">      AnotherNamedExport: __AnotherNamedExport,</span><br><span class="line">      default: __default,</span><br><span class="line">    &#125;) =&gt; &#123;</span><br><span class="line">      __VUE_HMR_RUNTIME__.reload(&apos;a1203740&apos;, __NamedExport)</span><br><span class="line">      __VUE_HMR_RUNTIME__.reload(&apos;bad12ad2&apos;, __AnotherNamedExport)</span><br><span class="line">      __VUE_HMR_RUNTIME__.reload(&apos;x12312w32&apos;, __default)</span><br><span class="line">    &#125;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br></p>
<p>ç…§ç€ä¸Šé¢çš„çº¦å®šï¼Œæˆ‘ä»¬æ¥å®ç°çœ‹çœ‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">// .. çœç•¥</span><br><span class="line">const DEFAULT_LOCAL_NAME = &apos;__default__&apos;</span><br><span class="line"></span><br><span class="line">// ç”Ÿæˆ hash å€¼</span><br><span class="line">function getHash(text: string) &#123;</span><br><span class="line">  return createHash(&apos;sha256&apos;).update(text).digest(&apos;hex&apos;).substring(0, 12)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// è§£æå‡ºæ¥çš„çƒ­æ›´æ–°ç»„ä»¶</span><br><span class="line">interface HotComponent &#123;</span><br><span class="line">  local: string</span><br><span class="line">  exported: string</span><br><span class="line">  id: string</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export const unpluginFactory: UnpluginFactory&lt;Options | undefined&gt; = (options, meta) =&gt; &#123;</span><br><span class="line">  // ....</span><br><span class="line">  let isWebpack = meta.framework === &apos;webpack&apos;</span><br><span class="line">  let isVite = meta.framework === &apos;vite&apos;</span><br><span class="line"></span><br><span class="line">  const enableHMR = process.env.NODE_ENV === &apos;development&apos; &amp;&amp; (isWebpack || isVite)</span><br><span class="line">  // ...</span><br><span class="line"></span><br><span class="line">  return &#123;</span><br><span class="line">    // ...</span><br><span class="line">    transform(code, id) &#123;</span><br><span class="line">      // ...</span><br><span class="line">      // ğŸ”´ è®°å½•æŸ¥æ‰¾åˆ°çš„ç»„ä»¶</span><br><span class="line">      const hotComponents: HotComponent[] = []</span><br><span class="line"></span><br><span class="line">      // ...</span><br><span class="line"></span><br><span class="line">      if (enableHMR) &#123;</span><br><span class="line">        // ğŸ”´ æ”¯æŒçƒ­æ›´æ–°</span><br><span class="line">        plugins.push(&#123;</span><br><span class="line">          visitor: &#123;</span><br><span class="line">            // ğŸ”´ å¤„ç†å‘½åå¯¼å‡º</span><br><span class="line">            ExportNamedDeclaration(path) &#123;</span><br><span class="line">              if (path.node.declaration &amp;&amp; t.isVariableDeclaration(path.node.declaration)) &#123;</span><br><span class="line">                // ğŸ”´ export const xxx = defineXXX() å½¢å¼</span><br><span class="line">                const declarations = path.node.declaration.declarations</span><br><span class="line">                for (const decl of declarations) &#123;</span><br><span class="line">                  if (</span><br><span class="line">                    t.isIdentifier(decl.id) &amp;&amp;</span><br><span class="line">                    decl.init &amp;&amp;</span><br><span class="line">                    t.isCallExpression(decl.init) &amp;&amp;</span><br><span class="line">                    isDefineCall(decl.init)</span><br><span class="line">                  ) &#123;</span><br><span class="line">                    hotComponents.push(&#123;</span><br><span class="line">                      local: decl.id.name,</span><br><span class="line">                      exported: decl.id.name,</span><br><span class="line">                      id: getHash(id + decl.id.name),</span><br><span class="line">                    &#125;)</span><br><span class="line">                  &#125;</span><br><span class="line">                &#125;</span><br><span class="line">              &#125; else if (path.node.specifiers) &#123;</span><br><span class="line">                // ğŸ”´ export &#123; xxx &#125; å½¢å¼</span><br><span class="line">                const specifiers = path.node.specifiers</span><br><span class="line">                for (const spec of specifiers) &#123;</span><br><span class="line">                  if (t.isExportSpecifier(spec)) &#123;</span><br><span class="line">                    // æŸ¥æ‰¾å˜é‡å®šä¹‰</span><br><span class="line">                    const binding = path.scope.getBinding(spec.local.name)</span><br><span class="line">                    if (</span><br><span class="line">                      binding &amp;&amp;</span><br><span class="line">                      t.isVariableDeclarator(binding.path.node) &amp;&amp;</span><br><span class="line">                      t.isCallExpression(binding.path.node.init) &amp;&amp;</span><br><span class="line">                      isDefineCall(binding.path.node.init)</span><br><span class="line">                    ) &#123;</span><br><span class="line">                      const exported = t.isIdentifier(spec.exported)</span><br><span class="line">                        ? spec.exported.name</span><br><span class="line">                        : spec.exported.value</span><br><span class="line">                      hotComponents.push(&#123;</span><br><span class="line">                        local: spec.local.name,</span><br><span class="line">                        exported,</span><br><span class="line">                        id: getHash(id + exported),</span><br><span class="line">                      &#125;)</span><br><span class="line">                    &#125;</span><br><span class="line">                  &#125;</span><br><span class="line">                &#125;</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            // ğŸ”´ é»˜è®¤å¯¼å‡º</span><br><span class="line">            ExportDefaultDeclaration(path) &#123;</span><br><span class="line">              // export default defineXXX() å½¢å¼</span><br><span class="line">              const declaration = path.node.declaration</span><br><span class="line">              if (t.isCallExpression(declaration) &amp;&amp; isDefineCall(declaration)) &#123;</span><br><span class="line">                hotComponents.push(&#123;</span><br><span class="line">                  local: DEFAULT_LOCAL_NAME,</span><br><span class="line">                  exported: &apos;default&apos;,</span><br><span class="line">                  id: getHash(id + &apos;default&apos;),</span><br><span class="line">                &#125;)</span><br><span class="line"></span><br><span class="line">                // åˆ›å»ºä¸´æ—¶å˜é‡</span><br><span class="line">                const variable = t.variableDeclaration(&apos;const&apos;, [</span><br><span class="line">                  t.variableDeclarator(t.identifier(DEFAULT_LOCAL_NAME), declaration),</span><br><span class="line">                ])</span><br><span class="line">                const exportDefault = t.exportDefaultDeclaration(t.identifier(DEFAULT_LOCAL_NAME))</span><br><span class="line">                // æ›¿æ¢ export default ä¸º export default __default__</span><br><span class="line">                path.replaceWithMultiple([variable, exportDefault])</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      // ....</span><br><span class="line"></span><br><span class="line">      if (hotComponents.length !== 0) &#123;</span><br><span class="line">        // ğŸ”´ æ³¨å…¥çƒ­æ›´æ–°ä»£ç </span><br><span class="line">        const hmrCode = patchHotComponents(hotComponents, meta.framework, id, options?.debug)</span><br><span class="line">        result.code = result.code + hmrCode</span><br><span class="line">      &#125;</span><br><span class="line">      // ...</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// ...</span><br></pre></td></tr></table></figure>
<p><br></p>
<p>ä¸Šé¢ä»£ç çš„ä¸»è¦é€»è¾‘æ˜¯è¿ç”¨ Babel æ¥éå†å¯¼å‡ºè¯­å¥ï¼Œæ‰¾å‡ºæ‰€æœ‰é€šè¿‡ <code>define*</code> åˆ›å»ºçš„ç»„ä»¶ã€‚</p>
<p><br></p>
<p>æ¥ä¸‹æ¥å°±æ˜¯æ³¨å…¥ HMR çš„ä»£ç ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">function patchHotComponents(</span><br><span class="line">  hotComponents: HotComponent[],</span><br><span class="line">  framework: &apos;vite&apos; | &apos;webpack&apos;,</span><br><span class="line">  id: string,</span><br><span class="line">  debug?: boolean</span><br><span class="line">): string &#123;</span><br><span class="line">  let hmrCode = &apos;&apos;</span><br><span class="line">  let callbackCode = &apos;&apos;</span><br><span class="line">  const debugCode = debug ? `\n  console.log(&apos;HMR reloading for $&#123;id&#125;&apos;)` : &apos;&apos;</span><br><span class="line"></span><br><span class="line">  for (const c of hotComponents) &#123;</span><br><span class="line">    hmrCode +=</span><br><span class="line">      `\n  $&#123;c.local&#125;.__hmrId = $&#123;c.local&#125;.__wkhmr = &apos;$&#123;c.id&#125;&apos;` +</span><br><span class="line">      `\n  __VUE_HMR_RUNTIME__.createRecord(&apos;$&#123;c.id&#125;&apos;, $&#123;c.local&#125;)`</span><br><span class="line">    callbackCode += `\n  __VUE_HMR_RUNTIME__.reload(&quot;$&#123;c.id&#125;&quot;, __$&#123;c.exported&#125;)`</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  hmrCode = `\nif (typeof __VUE_HMR_RUNTIME__ !== &apos;undefined&apos;) &#123;\n$&#123;hmrCode&#125;\n&#125;\n`</span><br><span class="line"></span><br><span class="line">  if (framework === &apos;vite&apos;) &#123;</span><br><span class="line">    // ğŸ”´ vite</span><br><span class="line">    hmrCode += `\nif (import.meta.hot) &#123;</span><br><span class="line">  import.meta.hot.accept((&#123;$&#123;hotComponents</span><br><span class="line">    .map((c) =&gt; `$&#123;c.exported&#125;: __$&#123;c.exported&#125;`)</span><br><span class="line">    .join(&apos;,&apos;)&#125;&#125;) =&gt; &#123;$&#123;debugCode&#125;$&#123;callbackCode&#125;\n&#125;)</span><br><span class="line">&#125;`</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    // ğŸ”´ webpack</span><br><span class="line">    hmrCode += `\nif (module.hot) &#123;</span><br><span class="line">  // æ¥å—è‡ªèº«ï¼Œ</span><br><span class="line">  module.hot.accept()</span><br><span class="line">  if (module.hot.status() !== &apos;idle&apos;) &#123;</span><br><span class="line">    const &#123;$&#123;hotComponents</span><br><span class="line">      .map((c) =&gt; `$&#123;c.exported&#125;: __$&#123;c.exported&#125;`)</span><br><span class="line">      .join(&apos;, &apos;)&#125;&#125; = __webpack_module__.exports</span><br><span class="line">    $&#123;debugCode&#125;</span><br><span class="line">    $&#123;callbackCode&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;`</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  return hmrCode</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br></p>
<p>Vite å’Œ Webpack çš„ HMR API æœ‰ç‚¹å·®å¼‚ã€‚</p>
<p><br></p>
<p>ç›¸å¯¹è€Œè¨€ Vite ä¼šæ›´ç›´è§‚ä¸€ç‚¹ï¼Œä½¿ç”¨ <code>import.meta.hot.accept(callback)</code> ä¸€è¡Œä»£ç å°±å¯ä»¥æå®šï¼Œåªè¦å½“å‰æ¨¡å—å˜åŠ¨ï¼Œå›è°ƒå°±ä¼šè¢«è°ƒç”¨ï¼Œå¹¶ä¼ å…¥æ–°çš„æ¨¡å—ä¿¡æ¯ã€‚</p>
<p><br></p>
<p>è€Œ Webpackï¼Œè¦æ¥å—å½“å‰æ¨¡å—çš„æ›´æ–°ï¼Œé¦–å…ˆè¦è°ƒç”¨ä¸€ä¸‹ <code>module.hot.accept()</code>ï¼Œè¡¨ç¤ºæœªæ¥çš„æ¨¡å—æ›´æ–°æˆ‘å¯ä»¥è‡ªè¡Œå¤„ç†ã€‚</p>
<p>åé¢æ¯æ¬¡ä»£ç æ¨¡å—æ›´æ–°ï¼Œéƒ½ä¼šé‡æ–°æ‰§è¡Œæ¨¡å—ä»£ç ï¼Œæˆ‘ä»¬é€šè¿‡ <code>status === &#39;idle&#39;</code> æ¥åŒºåˆ†é¦–æ¬¡æ‰§è¡Œï¼Œè¿˜æ˜¯åç»­çš„çƒ­æ›´æ–°é‡æ–°æ‰§è¡Œï¼Œå¦‚æœæ˜¯çƒ­æ›´æ–°æ‰§è¡Œï¼Œå°± reload ç»„ä»¶ã€‚</p>
<p><br></p>
<p>å­¦åºŸäº†å—ï¼Ÿæºä»£ç åœ¨<a href="https://github.com/wakeadmin/components/tree/master/packages/unplugin/src" target="_blank" rel="noopener">è¿™é‡Œ</a></p>
<p><br><br><br><br><br></p>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>è¿™ç¯‡æ–‡ç« æˆ‘ä»¬èµ°é©¬è§‚èŠ±è®²äº†è®² Webpack å’Œ Rollup çš„æ’ä»¶ APIï¼Œæ¥ç€å¼•å…¥äº† Unpluginã€‚</p>
<p>Unplugin ä»¥ Rollup çš„ç®€ç»ƒæ’ä»¶ API ä¸ºæ¯ç‰ˆï¼Œè¿™å¥— API åŸºæœ¬å°±æ˜¯ä¸»æµæ„å»ºå·¥å…·æ’ä»¶ API çš„æœ€å°å¹¶é›†äº†ï¼Œå¯ä»¥è½»æ¾å…¼å®¹ä¸»æµçš„å¹³å°ã€‚</p>
<p>æ¥ç€ï¼Œå®æˆ˜éƒ¨åˆ†ï¼Œæˆ‘ä»¬åŸºäº Babel å†™äº†ä¸€ä¸ªç®€å•çš„ Vue HMR æ’ä»¶ã€‚</p>
<p>å¦‚æœè¯»è€…æƒ³è¦è¿›ä¸€æ­¥å¦‚ä½•ç¼–å†™æ’ä»¶ï¼Œå¯ä»¥ä¸´æ‘¹ä¸€äº›å®˜æ–¹æ’ä»¶ï¼Œå†æ·±ä¸€ç‚¹ï¼Œå¯ä»¥é¡ºè—¤æ‘¸ç“œçœ‹çœ‹æºç ã€‚</p>
<p><br><br><br><br><br></p>
<h1 id="æ‰©å±•é˜…è¯»"><a href="#æ‰©å±•é˜…è¯»" class="headerlink" title="æ‰©å±•é˜…è¯»"></a>æ‰©å±•é˜…è¯»</h1><ul>
<li><a href="https://juejin.cn/post/6844903956905197576" target="_blank" rel="noopener">æ·±å…¥æµ…å‡º Babel ä¸Šç¯‡ï¼šæ¶æ„å’ŒåŸç† + å®æˆ˜</a></li>
<li><a href="https://cn.vitejs.dev/guide/api-plugin.html" target="_blank" rel="noopener">Vite</a></li>
<li><a href="https://github.com/unjs/unplugin" target="_blank" rel="noopener">https://github.com/unjs/unplugin</a></li>
<li><a href="https://webpack.docschina.org/api/plugins/#plugin-types" target="_blank" rel="noopener">Plugin API | webpack ä¸­æ–‡æ–‡æ¡£</a></li>
<li><a href="https://cn.rollupjs.org/plugin-development/#watchchange" target="_blank" rel="noopener">Rollup</a></li>
<li><a href="https://blog.lyearn.com/how-webpack-works-236f8cc43ae7" target="_blank" rel="noopener">How Webpack works?</a></li>
<li><a href="https://github.com/vitejs/vite-plugin-vue" target="_blank" rel="noopener">vite-plugin-vue</a></li>
</ul>

  </div>
</article>

    <div class="blog-post-comments">
        <div id="disqus_thread">
            <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        </div>
    </div>



    </div>
    
      <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Blogs</a></li>
         
          <li><a href="http://github.com/ivan-94">Projects</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#webpack"><span class="toc-number">1.</span> <span class="toc-text">Webpack</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#rollup"><span class="toc-number">2.</span> <span class="toc-text">Rollup</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ç¼–å†™è·¨å¹³å°çš„æ’ä»¶"><span class="toc-number">3.</span> <span class="toc-text">ç¼–å†™è·¨å¹³å°çš„æ’ä»¶</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#å®æˆ˜"><span class="toc-number">4.</span> <span class="toc-text">å®æˆ˜</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#vue-çƒ­æ›´æ–°åˆè¯†"><span class="toc-number">4.1.</span> <span class="toc-text">Vue çƒ­æ›´æ–°åˆè¯†</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#å®ç°"><span class="toc-number">4.2.</span> <span class="toc-text">å®ç°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#æ”¯æŒ-hmr"><span class="toc-number">4.3.</span> <span class="toc-text">æ”¯æŒ HMR</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#æ€»ç»“"><span class="toc-number">5.</span> <span class="toc-text">æ€»ç»“</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#æ‰©å±•é˜…è¯»"><span class="toc-number">6.</span> <span class="toc-text">æ‰©å±•é˜…è¯»</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://bobi.ink/2023/09/25/unplugin/"><i class="fa fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=https://bobi.ink/2023/09/25/unplugin/&text=ä½¿ç”¨ unplugin ç¼–å†™è·¨å¹³å°çš„æ„å»ºæ’ä»¶"><i class="fa fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://bobi.ink/2023/09/25/unplugin/&title=ä½¿ç”¨ unplugin ç¼–å†™è·¨å¹³å°çš„æ„å»ºæ’ä»¶"><i class="fa fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://bobi.ink/2023/09/25/unplugin/&is_video=false&description=ä½¿ç”¨ unplugin ç¼–å†™è·¨å¹³å°çš„æ„å»ºæ’ä»¶"><i class="fa fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=ä½¿ç”¨ unplugin ç¼–å†™è·¨å¹³å°çš„æ„å»ºæ’ä»¶&body=Check out this article: https://bobi.ink/2023/09/25/unplugin/"><i class="fa fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=https://bobi.ink/2023/09/25/unplugin/&title=ä½¿ç”¨ unplugin ç¼–å†™è·¨å¹³å°çš„æ„å»ºæ’ä»¶"><i class="fa fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=https://bobi.ink/2023/09/25/unplugin/&title=ä½¿ç”¨ unplugin ç¼–å†™è·¨å¹³å°çš„æ„å»ºæ’ä»¶"><i class="fa fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://bobi.ink/2023/09/25/unplugin/&title=ä½¿ç”¨ unplugin ç¼–å†™è·¨å¹³å°çš„æ„å»ºæ’ä»¶"><i class="fa fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=https://bobi.ink/2023/09/25/unplugin/&title=ä½¿ç”¨ unplugin ç¼–å†™è·¨å¹³å°çš„æ„å»ºæ’ä»¶"><i class="fa fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=https://bobi.ink/2023/09/25/unplugin/&name=ä½¿ç”¨ unplugin ç¼–å†™è·¨å¹³å°çš„æ„å»ºæ’ä»¶&description="><i class="fa fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
      <ul>
        <li id="toc"><a class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa fa-list fa-lg" aria-hidden="true"></i> TOC</a></li>
        <li id="share"><a class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa fa-share-alt fa-lg" aria-hidden="true"></i> Share</a></li>
        <li id="top" style="display:none"><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a></li>
        <li id="menu"><a class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa fa-bars fa-lg" aria-hidden="true"></i> Menu</a></li>
      </ul>
    </div>

  </div>
</div>

    
    <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2023 Ivan
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Blogs</a></li>
         
          <li><a href="http://github.com/ivan-94">Projects</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

</body>
</html>
<!-- styles -->
<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
<link rel="stylesheet" href="/lib/meslo-LG/styles.css">
<link rel="stylesheet" href="/lib/justified-gallery/justifiedGallery.min.css">

<!-- jquery -->
<script src="/lib/jquery/jquery.min.js"></script>
<script src="/lib/justified-gallery/jquery.justifiedGallery.min.js"></script>
<script src="/js/main.js"></script>


    <!-- Google Analytics -->
    <script type="text/javascript">
        (function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-44571525-2', 'auto');
        ga('send', 'pageview');
    </script>


    <!-- Disqus Comments -->
    <script type="text/javascript">
        var disqus_shortname = 'bobi-ink';

        (function(){
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        }());
    </script>


