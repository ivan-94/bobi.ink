<!DOCTYPE html>
<html lang=zh>
<head><meta name="generator" content="Hexo 3.8.0">
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="description" content="ç³»åˆ—æ–‡ç« ï¼š  å…¨æ–° Javascript è£…é¥°å™¨å®æˆ˜ä¸Šç¯‡ï¼šç”¨ MobX çš„æ–¹å¼æ‰“å¼€ Vue  å…¨æ–° JavaScript è£…é¥°å™¨å®æˆ˜ä¸‹ç¯‡ï¼šå®ç°ä¾èµ–æ³¨å…¥  ä¸Šä¸€ç¯‡æ–‡ç« æˆ‘ä»¬ä»‹ç»äº† JavaScript æœ€æ–°çš„è£…é¥°å™¨ææ¡ˆï¼Œä»¥åŠå®ƒå’Œæ—§ç‰ˆçš„åŒºåˆ«ã€‚è¿™ç¯‡æ–‡ç« æˆ‘ä»¬å°†ç»§ç»­æ·±å…¥è£…é¥°å™¨ï¼Œå°è¯•å®ç°ä¸€ä¸ªç®€æ˜“çš„ä¾èµ–æ³¨å…¥åº“ã€‚  è°ˆåˆ°è£…é¥°å™¨æˆ‘ä»¬æ€»ä¼šå¬åˆ° reflect-metadata, å°¤å…¶æ˜¯ç¤¾åŒºä¸Šçš„ä¾èµ–æ³¨å…¥åº“ï¼Œæ¯”å¦‚ in">
<meta name="keywords" content="Blog,FrontEnd,React,Javascript,Typescript">
<meta property="og:type" content="article">
<meta property="og:title" content="å…¨æ–° JavaScript è£…é¥°å™¨å®æˆ˜ä¸‹ç¯‡ï¼šå®ç°ä¾èµ–æ³¨å…¥">
<meta property="og:url" content="https://bobi.ink/2023/06/30/decorator-2/index.html">
<meta property="og:site_name" content="Bobi.ink">
<meta property="og:description" content="ç³»åˆ—æ–‡ç« ï¼š  å…¨æ–° Javascript è£…é¥°å™¨å®æˆ˜ä¸Šç¯‡ï¼šç”¨ MobX çš„æ–¹å¼æ‰“å¼€ Vue  å…¨æ–° JavaScript è£…é¥°å™¨å®æˆ˜ä¸‹ç¯‡ï¼šå®ç°ä¾èµ–æ³¨å…¥  ä¸Šä¸€ç¯‡æ–‡ç« æˆ‘ä»¬ä»‹ç»äº† JavaScript æœ€æ–°çš„è£…é¥°å™¨ææ¡ˆï¼Œä»¥åŠå®ƒå’Œæ—§ç‰ˆçš„åŒºåˆ«ã€‚è¿™ç¯‡æ–‡ç« æˆ‘ä»¬å°†ç»§ç»­æ·±å…¥è£…é¥°å™¨ï¼Œå°è¯•å®ç°ä¸€ä¸ªç®€æ˜“çš„ä¾èµ–æ³¨å…¥åº“ã€‚  è°ˆåˆ°è£…é¥°å™¨æˆ‘ä»¬æ€»ä¼šå¬åˆ° reflect-metadata, å°¤å…¶æ˜¯ç¤¾åŒºä¸Šçš„ä¾èµ–æ³¨å…¥åº“ï¼Œæ¯”å¦‚ in">
<meta property="og:locale" content="zh">
<meta property="og:image" content="https://bobi.ink/images/decorator-2/Untitled.jpeg">
<meta property="og:image" content="https://bobi.ink/images/decorator-2/Untitled.png">
<meta property="og:image" content="https://bobi.ink/images/decorator-2/Untitled%201.png">
<meta property="og:updated_time" content="2023-06-30T08:43:56.329Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="å…¨æ–° JavaScript è£…é¥°å™¨å®æˆ˜ä¸‹ç¯‡ï¼šå®ç°ä¾èµ–æ³¨å…¥">
<meta name="twitter:description" content="ç³»åˆ—æ–‡ç« ï¼š  å…¨æ–° Javascript è£…é¥°å™¨å®æˆ˜ä¸Šç¯‡ï¼šç”¨ MobX çš„æ–¹å¼æ‰“å¼€ Vue  å…¨æ–° JavaScript è£…é¥°å™¨å®æˆ˜ä¸‹ç¯‡ï¼šå®ç°ä¾èµ–æ³¨å…¥  ä¸Šä¸€ç¯‡æ–‡ç« æˆ‘ä»¬ä»‹ç»äº† JavaScript æœ€æ–°çš„è£…é¥°å™¨ææ¡ˆï¼Œä»¥åŠå®ƒå’Œæ—§ç‰ˆçš„åŒºåˆ«ã€‚è¿™ç¯‡æ–‡ç« æˆ‘ä»¬å°†ç»§ç»­æ·±å…¥è£…é¥°å™¨ï¼Œå°è¯•å®ç°ä¸€ä¸ªç®€æ˜“çš„ä¾èµ–æ³¨å…¥åº“ã€‚  è°ˆåˆ°è£…é¥°å™¨æˆ‘ä»¬æ€»ä¼šå¬åˆ° reflect-metadata, å°¤å…¶æ˜¯ç¤¾åŒºä¸Šçš„ä¾èµ–æ³¨å…¥åº“ï¼Œæ¯”å¦‚ in">
<meta name="twitter:image" content="https://bobi.ink/images/decorator-2/Untitled.jpeg">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>å…¨æ–° JavaScript è£…é¥°å™¨å®æˆ˜ä¸‹ç¯‡ï¼šå®ç°ä¾èµ–æ³¨å…¥</title>
    <!-- styles -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- rss -->
    
    
</head>

<body>
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Blogs</a></li>
         
          <li><a href="http://github.com/ivan-94">Projects</a></li>
        
      </ul>
    </span>
    <br>
    <span id="actions">
      <ul>
        
        
        <li><a class="icon" href="/2023/06/26/decorator/"><i class="fa fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://bobi.ink/2023/06/30/decorator-2/"><i class="fa fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=https://bobi.ink/2023/06/30/decorator-2/&text=å…¨æ–° JavaScript è£…é¥°å™¨å®æˆ˜ä¸‹ç¯‡ï¼šå®ç°ä¾èµ–æ³¨å…¥"><i class="fa fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://bobi.ink/2023/06/30/decorator-2/&title=å…¨æ–° JavaScript è£…é¥°å™¨å®æˆ˜ä¸‹ç¯‡ï¼šå®ç°ä¾èµ–æ³¨å…¥"><i class="fa fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://bobi.ink/2023/06/30/decorator-2/&is_video=false&description=å…¨æ–° JavaScript è£…é¥°å™¨å®æˆ˜ä¸‹ç¯‡ï¼šå®ç°ä¾èµ–æ³¨å…¥"><i class="fa fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=å…¨æ–° JavaScript è£…é¥°å™¨å®æˆ˜ä¸‹ç¯‡ï¼šå®ç°ä¾èµ–æ³¨å…¥&body=Check out this article: https://bobi.ink/2023/06/30/decorator-2/"><i class="fa fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=https://bobi.ink/2023/06/30/decorator-2/&title=å…¨æ–° JavaScript è£…é¥°å™¨å®æˆ˜ä¸‹ç¯‡ï¼šå®ç°ä¾èµ–æ³¨å…¥"><i class="fa fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=https://bobi.ink/2023/06/30/decorator-2/&title=å…¨æ–° JavaScript è£…é¥°å™¨å®æˆ˜ä¸‹ç¯‡ï¼šå®ç°ä¾èµ–æ³¨å…¥"><i class="fa fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://bobi.ink/2023/06/30/decorator-2/&title=å…¨æ–° JavaScript è£…é¥°å™¨å®æˆ˜ä¸‹ç¯‡ï¼šå®ç°ä¾èµ–æ³¨å…¥"><i class="fa fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=https://bobi.ink/2023/06/30/decorator-2/&title=å…¨æ–° JavaScript è£…é¥°å™¨å®æˆ˜ä¸‹ç¯‡ï¼šå®ç°ä¾èµ–æ³¨å…¥"><i class="fa fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=https://bobi.ink/2023/06/30/decorator-2/&name=å…¨æ–° JavaScript è£…é¥°å™¨å®æˆ˜ä¸‹ç¯‡ï¼šå®ç°ä¾èµ–æ³¨å…¥&description="><i class="fa fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#di-åº“ç»å¸¸æåŠçš„-reflect-metadata-åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ"><span class="toc-number">1.</span> <span class="toc-text">DI åº“ç»å¸¸æåŠçš„ reflect-metadata åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#decorator-metadata"><span class="toc-number">2.</span> <span class="toc-text">Decorator Metadata</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ç®€å•ç†è§£ä¾èµ–æ³¨å…¥"><span class="toc-number">3.</span> <span class="toc-text">ç®€å•ç†è§£ä¾èµ–æ³¨å…¥</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ç»§ç»­æ¢ç´¢-typescript-è£…é¥°å™¨çš„èƒ½åŠ›è¾¹ç•Œ"><span class="toc-number">4.</span> <span class="toc-text">ç»§ç»­æ¢ç´¢ Typescript è£…é¥°å™¨çš„èƒ½åŠ›è¾¹ç•Œ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#å®æˆ˜"><span class="toc-number">5.</span> <span class="toc-text">å®æˆ˜</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#è£…é¥°å™¨-api"><span class="toc-number">5.1.</span> <span class="toc-text">è£…é¥°å™¨ API</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#å®¹å™¨å®ç°"><span class="toc-number">5.2.</span> <span class="toc-text">å®¹å™¨å®ç°</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#æ€»ç»“"><span class="toc-number">6.</span> <span class="toc-text">æ€»ç»“</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#æ‰©å±•é˜…è¯»"><span class="toc-number">7.</span> <span class="toc-text">æ‰©å±•é˜…è¯»</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index width mx-auto px2 my4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        å…¨æ–° JavaScript è£…é¥°å™¨å®æˆ˜ä¸‹ç¯‡ï¼šå®ç°ä¾èµ–æ³¨å…¥
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">Bobi.ink</span>
      </span>
      
    <div class="postdate">
        <time datetime="2023-06-29T16:00:00.000Z" itemprop="datePublished">2023-06-30</time>
    </div>


      

    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <p><img src="/images/decorator-2/Untitled.jpeg" alt="cover"></p>
<p><br></p>
<p>ç³»åˆ—æ–‡ç« ï¼š</p>
<ul>
<li><a href="https://www.notion.so/Javascript-MobX-Vue-5e1c633167094d9784e602d66a5877f8?pvs=21" target="_blank" rel="noopener">å…¨æ–° Javascript è£…é¥°å™¨å®æˆ˜ä¸Šç¯‡ï¼šç”¨ MobX çš„æ–¹å¼æ‰“å¼€ Vue </a></li>
<li><a href="https://www.notion.so/JavaScript-0729df8081ec44b48f6f2e6ec7835120?pvs=21" target="_blank" rel="noopener">å…¨æ–° JavaScript è£…é¥°å™¨å®æˆ˜ä¸‹ç¯‡ï¼šå®ç°ä¾èµ–æ³¨å…¥</a></li>
</ul>
<p>ä¸Šä¸€ç¯‡<a href="https://www.notion.so/Javascript-MobX-Vue-5e1c633167094d9784e602d66a5877f8?pvs=21" target="_blank" rel="noopener">æ–‡ç« </a>æˆ‘ä»¬ä»‹ç»äº† JavaScript æœ€æ–°çš„è£…é¥°å™¨ææ¡ˆï¼Œä»¥åŠå®ƒå’Œæ—§ç‰ˆçš„åŒºåˆ«ã€‚è¿™ç¯‡æ–‡ç« æˆ‘ä»¬å°†ç»§ç»­æ·±å…¥è£…é¥°å™¨ï¼Œå°è¯•å®ç°ä¸€ä¸ªç®€æ˜“çš„ä¾èµ–æ³¨å…¥åº“ã€‚</p>
<p><br></p>
<p>è°ˆåˆ°è£…é¥°å™¨æˆ‘ä»¬æ€»ä¼šå¬åˆ° <code>reflect-metadata</code>, å°¤å…¶æ˜¯ç¤¾åŒºä¸Šçš„ä¾èµ–æ³¨å…¥åº“ï¼Œæ¯”å¦‚ <a href="https://github.com/inversify/InversifyJS" target="_blank" rel="noopener">inversify.js</a></p>
<p><br></p>
<p><img src="/images/decorator-2/Untitled.png" alt="inversify.js"></p>
<p><br></p>
<p><strong>æˆ‘ä»¬åœ¨ä¸Šä¸€ç¯‡æ–‡ç« çš„è£…é¥°å™¨å®ç°ä¸­ï¼Œä¼šç›´æ¥å»è½¬æ¢æˆ–è€…ä¿®æ”¹ç±»çš„ç»“æ„ï¼Œå¤§éƒ¨åˆ†åœºæ™¯è¿™å¹¶ä¸æ˜¯æœ€ä½³å®è·µã€‚</strong></p>
<p><strong>å¤§éƒ¨åˆ†æƒ…å†µä¸‹æˆ‘ä»¬åº”è¯¥åˆ©ç”¨è£…é¥°å™¨æ¥æ”¶é›†ä¸€äº›æ ‡æ³¨ä¿¡æ¯</strong>ï¼Œæ¯”å¦‚ MobX ç”¨è£…é¥°å™¨æ¥æ ‡æ³¨å“ªäº›æ˜¯ observableã€å“ªäº›æ˜¯ computedï¼›Inversify.js ç”¨ inject æ ‡æ³¨å“ªäº›å±æ€§éœ€è¦è¿›è¡Œæ³¨å…¥ï¼›Angular.js ä½¿ç”¨ Input/Output æ ‡è®°å±æ€§â€¦.</p>
<p>å¦‚æœæˆ‘ä»¬è¦é€šè¿‡è£…é¥°å™¨æ¥æ ‡è®°ç±»çš„åŸä¿¡æ¯ï¼Œé‚£å°±å¾—æ¥è®¤è¯†ä¸€ä¸‹ï¼šè£…é¥°å™¨çš„å¥½æ­å­ <code>reflect-metadata</code> ã€‚</p>
<p><br><br><br><br><br></p>
<h2 id="di-åº“ç»å¸¸æåŠçš„-reflect-metadata-åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#di-åº“ç»å¸¸æåŠçš„-reflect-metadata-åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="DI åº“ç»å¸¸æåŠçš„ reflect-metadata åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ"></a>DI åº“ç»å¸¸æåŠçš„ reflect-metadata åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>è¿™æ˜¯ä¸€ä¸ª JavaScript ææ¡ˆï¼Œä½†æ˜¯ä½œè€…å¹¶æ²¡æœ‰<a href="https://github.com/rbuckton/reflect-metadata/issues/96" target="_blank" rel="noopener">å°†å…¶æäº¤åˆ° TC39</a>ã€‚å®ƒçš„ç»§ä»»è€…ç°åœ¨æ˜¯ <a href="https://github.com/tc39/proposal-decorator-metadata" target="_blank" rel="noopener">Decorator Metadata</a>ï¼Œç°åœ¨å·²ç»è¿›å…¥äº† Stage 3 é˜¶æ®µï¼ŒTypescript ä¹Ÿå°†åœ¨ 5.2 ä¸­å®ç°è¿™ä¸ªææ¡ˆã€‚</p>
<p>Decorator Metadata ä¼šåœ¨ä¸‹æ–‡è¯¦ç»†ä»‹ç»ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ reflect-metadataã€‚</p>
<p>å…ˆæ¥çœ‹çœ‹ä½¿ç”¨å®ƒèƒ½ç”¨æ¥å¹²å•¥ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">test(&apos;reflect-metadata&apos;, () =&gt; &#123;</span><br><span class="line">  const key = &apos;myKey&apos;</span><br><span class="line"></span><br><span class="line">  // ğŸ”´ è£…é¥°å™¨è¯­æ³•</span><br><span class="line">  @Reflect.metadata(key, &apos;inClass&apos;)</span><br><span class="line">  class Foo &#123;</span><br><span class="line">    @Reflect.metadata(key, &apos;inStaticMember&apos;)</span><br><span class="line">    static staticMember = 1</span><br><span class="line"></span><br><span class="line">    @Reflect.metadata(key, &apos;inMember&apos;)</span><br><span class="line">    member = 2</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // ğŸ”´ ä¸Šè¿°è£…é¥°å™¨ç­‰ä»·äº</span><br><span class="line">  Reflect.defineMetadata(key, &apos;inClass&apos;, Foo)</span><br><span class="line">  Reflect.defineMetadata(key, &apos;inStaticMember&apos;, Foo, &apos;staticMember&apos;)</span><br><span class="line">  Reflect.defineMetadata(key, &apos;inMember&apos;, Foo.prototype, &apos;member&apos;)</span><br><span class="line"></span><br><span class="line">  // ğŸ”´ é™æ€æˆå‘˜</span><br><span class="line">  expect(Reflect.getMetadata(key, Foo)).toBe(&apos;inClass&apos;)</span><br><span class="line">  expect(Reflect.getMetadata(key, Foo, &apos;staticMember&apos;)).toBe(&apos;inStaticMember&apos;)</span><br><span class="line"></span><br><span class="line">  // ğŸ”´ å®ä¾‹æˆå‘˜ï¼Œ**éœ€è¦é€šè¿‡å®ä¾‹è·å–**</span><br><span class="line">  expect(Reflect.getMetadata(key, Foo, &apos;member&apos;)).toBeUndefined()</span><br><span class="line">  const foo = new Foo()</span><br><span class="line">  expect(Reflect.getMetadata(key, foo, &apos;member&apos;)).toBe(&apos;inMember&apos;)</span><br><span class="line">  // æˆ–è€…é€šè¿‡åŸå‹å¯¹è±¡è·å–</span><br><span class="line">  expect(Reflect.getMetadata(key, Foo.prototype, &apos;member&apos;)).toBe(&apos;inMember&apos;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><br><br><br></p>
<p>é€šè¿‡ä¸Šé¢çš„ ã€Œhello worldã€ æˆ‘ä»¬å¯ä»¥å‘ç°ï¼š</p>
<ol>
<li>å¯ä»¥ä½œä¸º<code>è£…é¥°å™¨</code>ä½¿ç”¨ã€‚è¿™ä¸ªè¡¨ç¤ºè¿™ä¸ªææ¡ˆå’Œè£…é¥°å™¨æœ‰ä¸è§£çš„æ¸Šæºï¼Œæ‰€ä»¥å½“æˆ‘ä»¬è°ˆåŠè£…é¥°å™¨çš„æ—¶å€™ï¼Œæ€»ä¼šçœ‹åˆ°å®ƒçš„èº«å½±ã€‚</li>
<li>å…ƒæ•°æ®? æ²¡é‚£ä¹ˆé«˜å¤§ä¸Šï¼Œå°±æ˜¯ä¸€äº› key/value å­˜å‚¨</li>
<li>æ‰©å±•äº† Reflect APIï¼Ÿä¸ºä»€ä¹ˆæ˜¯ Reflect API?</li>
<li>å…³äºå­˜å‚¨ä½ç½®ï¼Œç±»å’Œé™æ€æˆå‘˜å­˜å‚¨åœ¨ç±»ä¸Šï¼Œå®ä¾‹æˆå‘˜å­˜å‚¨åœ¨ç±»çš„åŸå‹ä¸Š(prototype)</li>
</ol>
<p><br></p>
<p>é€šè¿‡ä¸Šé¢çš„çš®æ¯›ï¼Œæˆ‘ä»¬ GET ä¸åˆ°å®ƒè¦è§£å†³ç—›ç‚¹æ˜¯å•¥ã€‚ä¸å°±æ˜¯å­˜å‚¨ä¸€äº›å…ƒæ•°æ®å˜›ï¼Œæˆ‘ä»¬ä¸éœ€è¦è¿™ä¸ª API ä¹Ÿå¯ä»¥åšåˆ°ï¼Œæ¯”å¦‚ MobX çš„è£…é¥°å™¨å°±æ˜¯æ”¾åœ¨åŸå‹ä¸Šçš„ä¸€ä¸ªéšè—è‡ªå®šä¹‰å±æ€§ä¸Šï¼š</p>
<p><br></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">export function storeAnnotation(prototype: any, key: PropertyKey, annotation: Annotation) &#123;</span><br><span class="line">  if (!hasProp(prototype, storedAnnotationsSymbol)) &#123;</span><br><span class="line">    addHiddenProp(prototype, storedAnnotationsSymbol, &#123;</span><br><span class="line">      // Inherit annotations</span><br><span class="line">      ...prototype[storedAnnotationsSymbol],</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  // ....</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br><br><br><br><br></p>
<p>å®é™…ä¸Šè¿™ä¸ªæ¦‚å¿µæ˜¯ä»å…¶ä»–è¯­è¨€å€Ÿé‰´çš„ï¼Œæ¯”å¦‚ä¸‹é¢ Java Spring ä¾èµ–æ³¨å…¥ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MovieRecommender</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> CustomerPreferenceDao customerPreferenceDao;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">MovieRecommender</span><span class="params">(CustomerPreferenceDao customerPreferenceDao)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.customerPreferenceDao = customerPreferenceDao;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨ Java ä¸­ï¼Œå¯ä»¥é€šè¿‡å®ƒçš„ <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/package-summary.html" target="_blank" rel="noopener">Reflect API</a> å¯ä»¥è·å–åˆ°ç±»çš„<code>ç±»å‹ä¿¡æ¯</code>ï¼Œæ¯”å¦‚æ–¹æ³•ã€æ–¹æ³•çš„å‚æ•°ã€è¿”å›å€¼ç­‰ç±»å‹ä¿¡æ¯ã€‚</p>
<p>ç„¶è€Œï¼ŒJavaScript æ˜¯ä¸€é—¨å¼±ç±»å‹è¯­è¨€ï¼Œæ²¡æœ‰è¿™ç±»ä¿¡æ¯ã€‚æ‰€ä»¥æˆ‘ä»¬åœ¨å®ç°<code>ä¾èµ–æ³¨å…¥</code>æ—¶ï¼Œå¹¶ä¸èƒ½åšåˆ°åƒ Java é‚£ä¹ˆå¼ºå¤§ï¼š</p>
<p><br></p>
<p>Java:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Engine</span> </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Autowired</span></span><br><span class="line">  <span class="keyword">private</span> Engine engine;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      engine.turnOn();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>vs Typescript</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">interface Engine &#123;&#125;</span><br><span class="line"></span><br><span class="line">@injectable()</span><br><span class="line">class Car &#123;</span><br><span class="line">  @inject(&apos;EngineKey&apos;)</span><br><span class="line">  private engine: Engine</span><br><span class="line">  start() &#123;</span><br><span class="line">    this.engine.turnOn()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br></p>
<p><strong>Java Spring å¯ä»¥è‡ªåŠ¨æ¨æ–­ç±»å‹æ¥è¿›è¡Œæ³¨å…¥</strong>ï¼Œè¿™ä¸ªç±»å‹å¯ä»¥æ˜¯æ¥å£ã€å…·ä½“çš„ç±»ã€æŠ½è±¡ç±»ç­‰ç­‰ã€‚è€Œç°åœ¨ JavaScript ä¸‹çš„ DI åº“ï¼Œæˆ‘ä»¬é€šå¸¸éœ€è¦æ˜¾å¼æŒ‡å®šä¸€ä¸ªæ ‡è¯†ç¬¦ï¼Œæˆ–è€…åªèƒ½æ˜¯ä¸€ä¸ªå…·ä½“çš„ç±»(ä¸æ”¯æŒæ¥å£)ï¼Œ ä¸€ç‚¹ä¹Ÿä¸å¤Ÿä¼˜é›…ã€‚</p>
<p>æ—¢ç„¶ç°åœ¨æœ‰äº† <code>Typescript</code> ï¼Œèƒ½ä¸èƒ½åšåˆ°å‘¢ï¼ŸTypescript æœ€ç»ˆä¹Ÿæ˜¯è½¬æ¢ä¸º JavaScript ï¼Œé»˜è®¤æƒ…å†µä¸‹<code>ç±»å‹ä¿¡æ¯</code>éƒ½ä¼šè¢«è£å‡æ‰ã€‚</p>
<p>è€Œ reflect-metadata çš„åˆè¡·è¿˜æ˜¯æƒ³å°† Java/C# è¿™ç±»è¯­è¨€çš„ Reflect èƒ½åŠ›å¸¦åˆ° JavaScriptã€‚<strong>å› æ­¤å°±æ‹Ÿå®šäº†è¿™æ ·ä¸€ä¸ªåè®®ï¼Œ è®© Typescript æˆ–è€…å…¶ä»–è½¬è¯‘åˆ° JavaScript å¼ºç±»å‹è¯­è¨€ï¼Œå¯ä»¥é€šè¿‡å®ƒå°†ç±»å‹ä¿¡æ¯ä¿ç•™ä¸‹æ¥ã€‚</strong></p>
<p><br></p>
<p>æ‰€ä»¥æˆ‘ä»¬çœ‹åˆ° Typescript æ˜¯å®ƒçš„ä¸»è¦æ¨åŠ¨è€…ã€‚æˆ‘ä»¬åœ¨ Typescript ä¸­å¯ä»¥é€šè¿‡å¼€å¯ <code>emitDecoratorMetadata</code> å®ç°è£…é¥°å™¨ç±»å‹ä¿¡æ¯çš„ä¿ç•™:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">interface Bar &#123;&#125;</span><br><span class="line"></span><br><span class="line">@d</span><br><span class="line">class Foo &#123;</span><br><span class="line">  @d</span><br><span class="line">  static staticMember = 1</span><br><span class="line"></span><br><span class="line">  @d</span><br><span class="line">  member = 2</span><br><span class="line"></span><br><span class="line">  @d</span><br><span class="line">  method(foo: number, bar: Bar, baz: Foo): string &#123;&#125;</span><br><span class="line"></span><br><span class="line">  constructor(a: Bar) &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è½¬æ¢ç»“æœï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var __metadata =</span><br><span class="line">  (this &amp;&amp; this.__metadata) ||</span><br><span class="line">  function (k, v) &#123;</span><br><span class="line">    if (typeof Reflect === &apos;object&apos; &amp;&amp; typeof Reflect.metadata === &apos;function&apos;)</span><br><span class="line">      return Reflect.metadata(k, v)</span><br><span class="line">  &#125;</span><br><span class="line">// çœç•¥éƒ¨åˆ†ä»£ç </span><br><span class="line">__decorate([d, __metadata(&apos;design:type&apos;, Object)], Foo.prototype, &apos;member&apos;, void 0)</span><br><span class="line">__decorate(</span><br><span class="line">  [</span><br><span class="line">    d,</span><br><span class="line">    __metadata(&apos;design:type&apos;, Function),</span><br><span class="line">    __metadata(&apos;design:paramtypes&apos;, [Number, Object, Foo]),</span><br><span class="line">    __metadata(&apos;design:returntype&apos;, String),</span><br><span class="line">  ],</span><br><span class="line">  Foo.prototype,</span><br><span class="line">  &apos;method&apos;,</span><br><span class="line">  null</span><br><span class="line">)</span><br><span class="line">__decorate([d, __metadata(&apos;design:type&apos;, Object)], Foo, &apos;staticMember&apos;, void 0)</span><br><span class="line">Foo = __decorate([d, __metadata(&apos;design:paramtypes&apos;, [Object])], Foo)</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬çœ‹åˆ°å¤§éƒ¨åˆ†çš„ç±»å‹ä¿¡æ¯éƒ½ä¿ç•™ä¸‹æ¥äº†ï¼Œæ¯”å¦‚æˆå‘˜ç±»å‹ã€æ–¹æ³•çš„å‚æ•°/è¿”å›å€¼ç±»å‹ã€‚</p>
<p>ä½†æ˜¯å®ƒä¹Ÿæœ‰å±€é™æ€§ï¼Œæ¯”å¦‚æ¥å£ç­‰è‡ªå®šä¹‰ç±»å‹ä¾æ—§æ— æ³•ä¿ç•™ï¼Œæ¯•ç«Ÿ JavaScript å¹¶æ²¡æœ‰è¿™äº›æ¦‚å¿µã€‚è¿™ä¹Ÿç›´æ¥å†³å®šäº†ä¾æ—§æ— æ³•å’Œ Java è¿™ç§ã€ŒåŸç”Ÿã€å¼ºç±»å‹è¯­è¨€æ¯”è‚©ã€‚</p>
<p><br></p>
<blockquote>
<p>reflect-metadata å¯èƒ½ä»£è¡¨çš„æ˜¯ JavaScript ä½œä¸ºä¸€ä¸ªæ–°æ±‡ç¼–è¯­è¨€çš„è§‰æ‚Ÿï¼Œä½†æ˜¯ç›®å‰çš„äº‹å®ä¹Ÿè¯æ˜äº†è¿™æ¡è·¯æ¯”è¾ƒéš¾ã€‚å°±æ‹¿ Typescript æ¥è¯´ï¼Œä¿ç•™çš„ä¿¡æ¯æ¯”è¾ƒæœ‰é™ï¼Œè€Œä¸”è¿™ä¼šè®©å¼€å‘è€…çš„æŠ€æœ¯æ ˆä¸¥é‡ä¾èµ– Typescriptï¼Œå¦å¤–åƒ esbuildã€swcã€babel è¿™äº›è½¬è¯‘å™¨ä¹Ÿå¾ˆéš¾è·Ÿè¿›è¿™ç§ç‰¹æ€§ã€‚<br><br><br>å®é™…ä¸Šï¼Œç°åœ¨æµè¡Œçš„ DI åº“ï¼Œå¦‚ <code>inversify</code>ã€<code>tsyringe</code> å¯¹ Typescript <code>emitDecoratorMetadata</code> çš„ä¾èµ–ä¹Ÿå¾ˆå°ï¼Œå»æ‰åŸºæœ¬ä¸Šä¸å½±å“å…¶æœ‰æ•ˆè¿è¡Œã€‚</p>
</blockquote>
<blockquote>
</blockquote>
<p><br></p>
<p>æ€»ç»“, reflect-metadata è§†å›¾æä¾›ä¸€ä¸ªç±»(class)å…ƒä¿¡æ¯çš„å­˜å‚¨æ ‡å‡†ã€‚åœ¨ç¬”è€…å¼€æ¥ï¼Œä¸»è¦çš„æ„¿æ™¯æ˜¯ä¸ºä¸Šå±‚æ›´é«˜çº§çš„è¯­è¨€(æ¯”å¦‚ Typescript)ä¿ç•™é™æ€ç±»å‹ä¿¡æ¯æä¾›ä¸€ç§æ–¹å¼ã€‚å…¶æ¬¡ï¼Œæ™®é€šå¼€å‘è€…ä¹Ÿèƒ½ä½¿ç”¨è¿™ä¸ªæ ‡å‡†åŒ–çš„ API æ¥ç»™ç±»æ ‡æ³¨ä¿¡æ¯ã€‚</p>
<p><br><br><br><br><br></p>
<h2 id="decorator-metadata"><a href="#decorator-metadata" class="headerlink" title="Decorator Metadata"></a>Decorator Metadata</h2><p>å¦‚ä»Šçš„ Metadata ææ¡ˆå·²ç»ä»è£…é¥°å™¨ä¸­åˆ†ç¦»å‡ºæ¥ï¼Œç›®å‰ä¹Ÿè¿›å…¥äº† Stage 3 é˜¶æ®µã€‚ç»è¿‡é‡æ–°è®¾è®¡çš„ Metadata å’Œ reflect-metadata ä¸æ˜¯åŒä¸€ä¸ªç©æ„ã€‚</p>
<p>è¿™ä¸ªææ¡ˆéå¸¸ç®€å•ï¼Œå°±æ˜¯æ–°å¢äº†ä¸€ä¸ªå†…ç½® Symbol â€”â€” <code>Symbol.metadata</code>ã€‚åœ¨è£…é¥°å™¨çš„é…åˆå°†å…ƒæ•°æ®å­˜å‚¨åœ¨ç±»çš„ Symbol.metadata ä¸‹é¢:</p>
<p><br><br><br></p>
<p>é’ˆå¯¹è£…é¥°å™¨åè®®çš„æ‰©å±•:</p>
<figure class="highlight diff"><table><tr><td class="code"><pre><span class="line">type Decorator = (value: Input, context: &#123;</span><br><span class="line">  kind: string;</span><br><span class="line">  name: string | symbol;</span><br><span class="line">  access: &#123;</span><br><span class="line">    get?(): unknown;</span><br><span class="line">    set?(value: unknown): void;</span><br><span class="line">  &#125;;</span><br><span class="line">  isPrivate?: boolean;</span><br><span class="line">  isStatic?: boolean;</span><br><span class="line">  addInitializer?(initializer: () =&gt; void): void;</span><br><span class="line"><span class="addition">+ metadata?: Record&lt;string | number | symbol, unknown&gt;;</span></span><br><span class="line">&#125;) =&gt; Output | void;</span><br></pre></td></tr></table></figure>
<p><br></p>
<p>æ‰€æœ‰è£…é¥°å™¨çš„ context å¯¹è±¡æ–°å¢äº† metadata å¯¹è±¡ã€‚ metadata åªæ˜¯ä¸€ä¸ªæ™®é€šçš„å¯¹è±¡ï¼Œæ²¡ä»€ä¹ˆç‰¹åˆ«ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">function meta(key: string) &#123;</span><br><span class="line">  return (value: unknown, context: DecoratorContext) =&gt; &#123;</span><br><span class="line">    context.metadata![key] = true</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@meta(&apos;inClass&apos;)</span><br><span class="line">class Foo &#123;</span><br><span class="line">  @meta(&apos;inStaticMember&apos;)</span><br><span class="line">  static staticMember = 1</span><br><span class="line"></span><br><span class="line">  @meta(&apos;inMember&apos;)</span><br><span class="line">  member = 2</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// ç±»çš„æ‰€æœ‰è£…é¥°å™¨å…±äº«</span><br><span class="line">expect(Foo[Symbol.metadata]).toEqual(&#123;</span><br><span class="line">  inStaticMember: true,</span><br><span class="line">  inMember: true,</span><br><span class="line">  inClass: true,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><br><br><br></p>
<p>å°±æ˜¯è¿™ä¹ˆæœ´å®ä¸”æ— åã€‚å› ä¸º<strong>æ‰€æœ‰è£…é¥°å™¨éƒ½æ˜¯å…±äº«ä¸€ä¸ªå¯¹è±¡ç©ºé—´</strong>ï¼Œé¿å…å†²çªçš„èŒè´£å°±äº¤ç»™å¼€å‘è€…äº†ã€‚</p>
<p>å¤§æ¦‚æœ‰ä¸¤ç§æ–¹å¼ï¼š</p>
<ul>
<li>å‘½åç©ºé—´ã€‚æ¯”å¦‚å•çº¯ç”¨å­—ç¬¦ä¸² key <code>åº“åç§°.{æ˜¯å¦é™æ€}.{è£…é¥°å™¨ä½ç½®}.{å±æ€§å}</code>ï¼Œæˆ–è€…åˆ›å»ºä¸€ä¸ªç§æœ‰ Symbol æŒ‰åµŒå¥—çš„ç»“æ„å­˜å‚¨ã€‚</li>
<li><p>ç§æœ‰ç©ºé—´ã€‚ä»¥ä¸‹æ˜¯ MetaData ææ¡ˆä¸­çš„ä¾‹å­ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const PRIVATE_METADATA = new WeakMap();</span><br><span class="line"></span><br><span class="line">function meta(key, value) &#123;</span><br><span class="line">  return (_, context) =&gt; &#123;</span><br><span class="line">    let metadata = PRIVATE_METADATA.get(context.metadata);</span><br><span class="line"></span><br><span class="line">    if (!metadata) &#123;</span><br><span class="line">      metadata = &#123;&#125;;</span><br><span class="line">      PRIVATE_METADATA.set(context.metadata, metadata);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    metadata[key] = value;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@meta(&apos;a&apos; &apos;x&apos;)</span><br><span class="line">class C &#123;</span><br><span class="line">  @meta(&apos;b&apos;, &apos;y&apos;)</span><br><span class="line">  m() &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PRIVATE_METADATA.get(C[Symbol.metadata]).a; // &apos;x&apos;</span><br><span class="line">PRIVATE_METADATA.get(C[Symbol.metadata]).b; // &apos;y&apos;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><br></p>
<p>Anywayï¼Œè§£å†³å‘½åå†²çªæœ‰æ— æ•°çš„åŠæ³•ã€‚</p>
<blockquote>
<p>ğŸ™‹  é‚£ <code>Typescript</code> çš„ <code>emitDecoratorMetadata</code> è¿˜æ”¯æŒå—ï¼Ÿæš‚æ—¶çœ‹åˆ°ç›¸å…³çš„è®¡åˆ’</p>
</blockquote>
<p><br><br><br><br><br></p>
<h2 id="ç®€å•ç†è§£ä¾èµ–æ³¨å…¥"><a href="#ç®€å•ç†è§£ä¾èµ–æ³¨å…¥" class="headerlink" title="ç®€å•ç†è§£ä¾èµ–æ³¨å…¥"></a>ç®€å•ç†è§£ä¾èµ–æ³¨å…¥</h2><p>ç°åœ¨å¼€å§‹å®æˆ˜éƒ¨åˆ†ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦äº†è§£ä¸€ä¸‹ä»€ä¹ˆæ˜¯ä¾èµ–æ³¨å…¥ï¼š</p>
<p><img src="/images/decorator-2/Untitled%201.png" alt="di"></p>
<p>ç†è§£ä¾èµ–æ³¨å…¥ï¼Œéœ€è¦ææ¸…æ¥šä»¥ä¸‹å‡ ä¸ªæ¦‚å¿µï¼š</p>
<ul>
<li><strong>æ¥å£(interface)ã€‚</strong>æ¥å£æ˜¯ä¸€ä¸ªåè®®ï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªéœ€æ±‚ã€‚è¿™ä¸ªç”±â€™ç”²æ–¹â€˜æå‡ºæ¥ï¼Œæ¯”å¦‚æˆ‘ä»¬è¦ä¸€ä¸ªæ‰‹æœºï¼Œé‚£ä¹ˆèƒ½â€œæ‰“ç”µè¯â€ã€â€å‘çŸ­ä¿¡â€, å°±æ˜¯éœ€æ±‚ã€‚æ¥å£æ˜¯ä¸€ä¸ªæŠ½è±¡çš„ä¸œè¥¿ï¼Œå¹¶ä¸æ˜¯å…·ä½“çš„å®ç°ã€‚å¯¹äºæ¶ˆè´¹è€…æ¥è¯´å®ƒå¹¶ä¸å…³å¿ƒçš„å†…éƒ¨ç»†èŠ‚ã€æ˜¯æ€ä¹ˆåˆ¶é€ å‡ºæ¥çš„ã€‚</li>
<li><strong>å®ç°(implements)</strong>ã€‚æ»¡è¶³æ¥å£éœ€æ±‚çš„å…·ä½“å®ç°ï¼Œæ¯”å¦‚â€œæ‰‹æœºâ€è¿™ä¸ªæ¥å£çš„å®ç°ï¼Œå¯ä»¥æ˜¯ iphoneã€å°ç±³æ‰‹æœºã€åä¸ºæ‰‹æœºç­‰ç­‰ã€‚</li>
<li><strong>ä¾èµ–æ³¨å…¥</strong>ã€‚ä¾èµ–æ³¨å…¥çš„æ„æ€å°±æ˜¯<code>éœ€æ±‚è€…</code>æè¿°å¥½è‡ªå·±çš„<code>éœ€æ±‚</code>ï¼Œç„¶åç”±<code>ç»é”€å•†</code>æ¥æŸ¥æ‰¾<strong>ç¬¦åˆéœ€æ±‚</strong>çš„<code>å®ç°</code>ï¼Œç»™åˆ°éœ€æ±‚è€…ã€‚éœ€æ±‚è€…ä»å¤´åˆ°å°¾ï¼Œä¸ä¼šå»å…³å¿ƒè¿™ä¸ªéœ€æ±‚æ˜¯æ€ä¹ˆå»å®ç°çš„ï¼Œå®ƒåªå…³å¿ƒå®ƒè‡ªå·±è¦å¹²çš„äº‹æƒ…ã€‚</li>
<li><strong>ä¸‰ç§è§’è‰²</strong>:<ul>
<li><code>éœ€æ±‚è€…</code>ã€‚æˆ–è€…è¯´<code>æ¶ˆè´¹è€…</code></li>
<li><code>ç»é”€å•†</code>(å®¹å™¨)ã€‚æˆ‘ä»¬ä¹Ÿç§°ä¸ºå®¹å™¨ï¼Œä»–è´Ÿè´£åè°ƒéœ€æ±‚å’Œå®ç°ã€‚</li>
<li><code>ä¾›åº”å•†</code>ã€‚éœ€æ±‚çš„å…·ä½“å®ç°è€…ã€‚</li>
</ul>
</li>
</ul>
<p><br><br><br></p>
<p>å¯ä»¥é€šè¿‡ä¸€ä¸ªä¾‹å­(æ¥æº<a href="https://www.notion.so/wakeapp-framework-b08cb3cb5f8e49f597aa90bbb89a1641?pvs=21" target="_blank" rel="noopener">è¿™é‡Œ</a>)æ¥ç†è§£ä¸€ä¸‹ï¼š</p>
<p><br></p>
<ol>
<li><p>å®šä¹‰éœ€æ±‚(åè®®)</p>
<p>é¦–å…ˆå®šä¹‰éœ€æ±‚ï¼Œæè¿°æˆ‘ä»¬æœŸæœ›å¾—åˆ°ä¸€ä¸ªæ€æ ·çš„ä¸œè¥¿ã€‚</p>
<p>éœ€æ±‚é€šå¸¸ä½¿ç”¨ <code>interface</code> æ¥æè¿°ï¼Œå½“ç„¶ï¼Œè¿™å¹¶æ²¡æœ‰é™åˆ¶ã€‚ä½ è¦ä¸€ä¸ªç±»ä¹Ÿå¯ä»¥ã€å­—ç¬¦ä¸²ã€æ•°å­—ä¹Ÿå¯ä»¥ï¼Œå–å†³ä½ çš„éœ€æ±‚ã€‚</p>
<p>æ¯”å¦‚æˆ‘æƒ³è¦ä¸€ä¸ªæ‰‹æœº:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">interface IPhone &#123;</span><br><span class="line">  /**</span><br><span class="line">   * æ‰“ç”µè¯</span><br><span class="line">   */</span><br><span class="line">  call(num: string): void</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * å‘çŸ­ä¿¡</span><br><span class="line">   */</span><br><span class="line">  sendMessage(num: string, message: string): void</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ³¨å†Œä½ çš„éœ€æ±‚å’Œæ ‡è¯†ç¬¦çš„ç»‘å®šå…³ç³»ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">declare global &#123;</span><br><span class="line">  interface DIMapper &#123;</span><br><span class="line">    &apos;DI.IPhone&apos;: IPhone</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>è¯·æ±‚æ³¨å…¥</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class WeChat &#123;</span><br><span class="line">  // æ³¨å…¥è¯·æ±‚</span><br><span class="line">  @inject(&apos;DI.IPhone&apos;)</span><br><span class="line">  myPhone: IPhone</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * æ‰“ç”µè¯è€å¦ˆ</span><br><span class="line">   */</span><br><span class="line">  callMom() &#123;</span><br><span class="line">    this.myPhone.call(&apos;137****110&apos;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>å®ç°éœ€æ±‚</p>
<p>æ¥ä¸‹æ¥å°±æ˜¯ä¾›åº”å•†æ¥å®ç°éœ€æ±‚äº†ã€‚é€šå¸¸ä½¿ç”¨ç±»æ¥å®ç°éœ€æ±‚ï¼š</p>
<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">@injectable()</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TheIPhone</span> <span class="title">implements</span> <span class="title">IPhone</span> </span>&#123;</span><br><span class="line">  call(num: string) &#123;</span><br><span class="line">    <span class="comment">// æ‹¨æ‰“ç”µè¯æµç¨‹</span></span><br><span class="line">  &#125;</span><br><span class="line">  sendMessage(num: string, <span class="attr">message</span>: string) &#123;</span><br><span class="line">    <span class="comment">// å‘é€çŸ­ä¿¡æµç¨‹</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>æ³¨å†Œå®ç°</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">configureDI((registerSingletonClass) =&gt; &#123;</span><br><span class="line">  registerSingletonClass(&apos;DI.IPhone&apos;, TheIPhone)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p><br><br><br></p>
<p>å¦‚æœä½ ç†è§£äº†ä¸Šé¢çš„ä¾‹å­ï¼Œé‚£ä¹ˆä½ å·²ç»æ‡‚ä¾èµ–æ³¨å…¥äº†ã€‚ä¸è¿‡ï¼Œå½“ä½ æ¥è§¦åˆ°ä¾èµ–æ³¨å…¥çš„ç›¸å…³å®ç°åº“æ—¶ï¼Œè¿˜æœ‰å¬åˆ°è¿™äº›æ¦‚å¿µï¼š</p>
<ul>
<li><code>å®¹å™¨(Container)</code>ã€‚ å°±æ˜¯ä¸Šæ–‡æåˆ°çš„<code>ç»é”€å•†</code>ï¼Œç”¨æœ€ç®€å•æŠ€æœ¯æœ¯è¯­æ¥æè¿°çš„è¯ï¼Œä»–å°±æ˜¯ä¸€ä¸ª<code>å¯¹è±¡æ± </code>ã€‚ä»–è´Ÿè´£åè°ƒ<code>æ¶ˆè´¹è€…</code>éœ€æ±‚å’Œ<code>æä¾›å•†</code>çš„å®ç°ã€‚</li>
<li><code>ä½œç”¨åŸŸ(Scope)</code>ã€‚å°±æ˜¯å¯¹è±¡çš„å­˜æ´»æ—¶é—´å’Œæ´»åŠ¨èŒƒå›´<ul>
<li>å­˜æ´»æ—¶é—´ï¼šæ¯”è¾ƒå…¸å‹çš„æœ‰ singleton(å•ä¾‹)ã€request(è¯·æ±‚ï¼Œ è¿™ä¸ªä¸€å¥è¯è¯´ä¸æ¸…æ¥šï¼Œä½ å¯ä»¥ç±»æ¯”ä¸º ã€ŒHTTP è¯·æ±‚ã€ï¼Œè¿™äº›å¯¹è±¡ä»…åœ¨è¿™ä¸€æ¬¡ HTTP çš„è¯·æ±‚å‘¨æœŸå†…æœ‰æ•ˆ)ã€transient(ä¸´æ—¶ï¼Œå³æ¯æ¬¡ inject è¯·æ±‚éƒ½åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡)ã€‚å½“ç„¶ï¼Œæ ¹æ®å®é™…çš„åœºæ™¯è¿˜å¯ä»¥æ‰©å±•ï¼Œæ¯”å¦‚åœ¨ React ç»„ä»¶ç”Ÿå‘½å‘¨æœŸ</li>
<li>æ´»åŠ¨èŒƒå›´ï¼š å¾ˆå¤šä¾èµ–æ³¨å…¥åº“ä¸­ï¼Œå®¹å™¨ä¸æ˜¯ä¸€ä¸ªå•ä¸€çš„å¯¹è±¡ï¼Œè€Œæ˜¯ä¸€ä¸ªæ ‘çŠ¶çš„ç»“æ„ï¼Œå¦‚æœè¦é™åˆ¶æŸäº›å¯¹è±¡çš„æ´»åŠ¨èŒƒå›´ï¼Œæˆ–è€…è¦†ç›–å¯¹è±¡çš„å®ç°ï¼Œå¯ä»¥é€šè¿‡ Fork å­å®¹å™¨çš„å½¢å¼æ¥å®ç°éš”ç¦»ã€‚</li>
</ul>
</li>
<li><code>ç»‘å®š(binding)</code>ã€‚å³åè®®çš„ç»‘å®šï¼Œæ¯”å¦‚ä¸Šé¢çš„ä¾‹å­ä¸­æˆ‘ä»¬ä½¿ç”¨ <code>DI.IPhone</code> å­—ç¬¦ä¸²æ¥ç»‘å®šåè®®å’Œå®ç°ã€‚å…¶ä»–ç¼–ç¨‹è¯­è¨€å¯ä»¥åšå¾—æ›´åŠ çµæ´»ï¼Œåªéœ€è¦å£°æ˜ç±»å‹ï¼Œå®¹å™¨ä¼šæ ¹æ®ç±»å‹çš„å…¼å®¹æ€§æ¥åè°ƒæ³¨å…¥ã€‚</li>
</ul>
<p><br></p>
<p>å½“ç„¶ï¼Œä¸€ä¸ªç”Ÿäº§çº§åˆ«çš„ä¾èµ–æ³¨å…¥å®ç°è¿˜ä¼šæ¶‰åŠå¾ˆå¤šæŠ€æœ¯ç»†èŠ‚å’Œæ¦‚å¿µï¼Œæ¯”å¦‚å¾ªç¯ä¾èµ–ã€å¯¹è±¡æ„é€ å’Œææ„ã€å·¥å‚ã€å¼‚æ­¥åŠ è½½ã€å¯¹è±¡ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€ä¸­é—´ä»¶ã€æ ‡ç­¾(Tagged)ç­‰ç­‰ã€‚</p>
<p><br></p>
<p>ä¸è¿‡ä¸Šé¢æˆ‘ä»¬æŒæ¡çš„çŸ¥è¯†å·²ç»è¶³å¤Ÿè¦†ç›–æ­£å¸¸çš„å¼€å‘åœºæ™¯äº†ã€‚</p>
<p><br><br><br></p>
<p><strong>ä¾èµ–æ³¨å…¥çš„å¥½å¤„å°±ä¸å¤šè¯´äº†ï¼š</strong></p>
<ul>
<li>è§£è€¦ã€‚é¢å‘æ¥å£ç¼–ç¨‹ã€‚</li>
<li>å¯æ‰©å±•æ€§ã€‚æ¯ä¸ªä¾èµ–æ³¨å…¥çš„ç‚¹å°±æ˜¯ä¸€ä¸ªæ‰©å±•ç‚¹ã€‚</li>
<li>å¯æµ‹è¯•æ€§ã€‚å¯ä»¥è®©ç¨‹åºèŒè´£æ›´åŠ å•ä¸€ï¼Œå…³æ³¨çœŸæ­£éœ€è¦å…³æ³¨çš„å†…å®¹ã€‚å±è”½å¹²æ‰°ï¼Œè®©æ ¸å¿ƒé€»è¾‘æ›´å®¹æ˜“è¢«æµ‹è¯•ã€‚</li>
</ul>
<p><br><br><br><br><br></p>
<h2 id="ç»§ç»­æ¢ç´¢-typescript-è£…é¥°å™¨çš„èƒ½åŠ›è¾¹ç•Œ"><a href="#ç»§ç»­æ¢ç´¢-typescript-è£…é¥°å™¨çš„èƒ½åŠ›è¾¹ç•Œ" class="headerlink" title="ç»§ç»­æ¢ç´¢ Typescript è£…é¥°å™¨çš„èƒ½åŠ›è¾¹ç•Œ"></a>ç»§ç»­æ¢ç´¢ Typescript è£…é¥°å™¨çš„èƒ½åŠ›è¾¹ç•Œ</h2><p>åœ¨ä¸Šç¯‡<a href="https://www.notion.so/Javascript-MobX-Vue-5e1c633167094d9784e602d66a5877f8?pvs=21" target="_blank" rel="noopener">æ–‡ç« </a>ä¸­ï¼Œæˆ‘ä»¬æåˆ° Typescript å¯¹æ–°ç‰ˆçš„è£…é¥°å™¨æœ‰äº†æ›´ä¸¥æ ¼çš„æ£€æŸ¥ã€‚</p>
<p><br></p>
<p>å®ƒå¯ä»¥çº¦æŸè£…é¥°å™¨çš„ä½ç½®ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">declare function injectable&lt;T, Class extends abstract new (...args: any) =&gt; T&gt;(): (</span><br><span class="line">  value: Class,</span><br><span class="line">  context: ClassDecoratorContext&lt;Class&gt;</span><br><span class="line">) =&gt; void</span><br><span class="line"></span><br><span class="line">@injectable()</span><br><span class="line">class Foo &#123;</span><br><span class="line">  // @ts-expect-error âŒ åªèƒ½è£…é¥°ç±»</span><br><span class="line">  @injectable()</span><br><span class="line">  member = 1</span><br><span class="line"></span><br><span class="line">  // @ts-expect-error âŒ åªèƒ½è£…é¥°ç±»</span><br><span class="line">  @injectable()</span><br><span class="line">  method() &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br></p>
<p>è¿™è¿˜ä¸æ­¢ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å¯¹è¢«è£…é¥°çš„ç›®æ ‡å€¼è¿›è¡Œçº¦æŸã€‚ä»¥ä¾èµ–æ³¨å…¥çš„åœºæ™¯æ¥çœ‹, æ—§ç‰ˆçš„è£…é¥°å™¨å¾ˆéš¾åšåˆ°æ ¹æ®æ³¨å…¥çš„æ ‡è¯†ç¬¦æ¥çº¦æŸ<code>å®ç°</code>å’Œ<code>æ³¨å…¥</code>ã€‚ç°åœ¨æˆ‘ä»¬å¾ˆå®¹æ˜“åšåˆ°ï¼š</p>
<p>å…ˆæ¥æ„é€ <code>æ³¨å…¥æ ‡è¯†ç¬¦</code>çš„ç±»å‹(çµæ„Ÿæ¥æºäº <code>Vue</code> çš„ <code>provide/inject</code>)ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">export interface InjectionKey&lt;T&gt; extends Symbol &#123;&#125;</span><br></pre></td></tr></table></figure>
<p><br></p>
<p>ç°åœ¨å¯ä»¥è¿™æ ·å®šä¹‰æ ‡è¯†ç¬¦ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">// å®šä¹‰æ³¨å…¥çš„åè®®ï¼Œé¸Ÿç±»</span><br><span class="line">interface Bird &#123;</span><br><span class="line">  fly(): void</span><br><span class="line">  searchForFood(): void</span><br><span class="line">  breed(): void</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// å°†æ¥å£å’Œæ ‡è¯†ç¬¦å®ç°ç»‘å®š</span><br><span class="line">const BIRD_BINDING: InjectionKey&lt;Bird&gt; = Symbol(&apos;Bird&apos;)</span><br></pre></td></tr></table></figure>
<p><br></p>
<p>æˆ‘ä»¬å†æ¥å®šä¹‰ <code>injectable</code> è£…é¥°å™¨ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">declare function injectable&lt;T, Class extends abstract new (...args: any) =&gt; T&gt;(</span><br><span class="line">  // ä¼ å…¥ InjectionKey ç±»å‹ï¼Œæ¨æ–­å‡º T æ¥çº¦æŸ class</span><br><span class="line">  key: InjectionKey&lt;T&gt;</span><br><span class="line">): (value: Class, context: ClassDecoratorContext&lt;Class&gt;) =&gt; void</span><br></pre></td></tr></table></figure>
<p>æµ‹è¯•ä¸€ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">// @ts-expect-error âŒ æ²¡æœ‰å±¥è¡Œ Bird åè®®</span><br><span class="line">@injectable(BIRD_BINDING)</span><br><span class="line">class Eagle &#123;&#125;</span><br><span class="line"></span><br><span class="line">// âœ… å±¥è¡Œäº† Bird åè®®</span><br><span class="line">@injectable(BIRD_BINDING)</span><br><span class="line">class Pigeon implements Bird &#123;</span><br><span class="line">  fly() &#123;&#125;</span><br><span class="line">  searchForFood() &#123;&#125;</span><br><span class="line">  breed() &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬ç°åœ¨å¯ä»¥å¯¹<code>å®ç°è€…</code>çš„<code>åè®®å±¥è¡Œ</code>è¿›è¡Œä¸¥æ ¼æ£€æŸ¥ã€‚</p>
<p><br><br><br></p>
<p>åŒç†æˆ‘ä»¬å¯ä»¥æ£€æŸ¥æ³¨å…¥ä¾§ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">declare function inject&lt;T&gt;(</span><br><span class="line">  key: InjectionKey&lt;T&gt;</span><br><span class="line">): (value: undefined, context: ClassFieldDecoratorContext&lt;unknown, T | undefined&gt;) =&gt; void</span><br><span class="line"></span><br><span class="line">declare function injectAll&lt;T&gt;(</span><br><span class="line">  key: InjectionKey&lt;T&gt;</span><br><span class="line">): (value: undefined, context: ClassFieldDecoratorContext&lt;unknown, T[] | undefined&gt;) =&gt; void</span><br></pre></td></tr></table></figure>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class Zoo &#123;</span><br><span class="line">  // @ts-expect-error âŒ ç±»å‹ä¸åŒ¹é…</span><br><span class="line">  @inject(BIRD_BINDING)</span><br><span class="line">  private unknown?: number</span><br><span class="line"></span><br><span class="line">  // âœ…</span><br><span class="line">  @inject(BIRD_BINDING)</span><br><span class="line">  private bird?: Bird</span><br><span class="line"></span><br><span class="line">  // @ts-expect-error âŒ ç±»å‹ä¸åŒ¹é…</span><br><span class="line">  @injectAll(BIRD_BINDING)</span><br><span class="line">  private allBirds?: Bird</span><br><span class="line"></span><br><span class="line">  // âœ…</span><br><span class="line">  @injectAll(BIRD_BINDING)</span><br><span class="line">  private birds?: Bird[]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ˜¯ä¸æ˜¯å¾ˆé…·?ï¼</p>
<p><br><br><br><br><br></p>
<h2 id="å®æˆ˜"><a href="#å®æˆ˜" class="headerlink" title="å®æˆ˜"></a>å®æˆ˜</h2><p>æ¥ä¸‹æ¥æˆ‘ä»¬æŠŠä¸Šé¢è®²åˆ°çš„çŸ¥è¯†ç‚¹è¿ç”¨èµ·æ¥ï¼Œå®ç°ä¸€ä¸ªç®€æ˜“çš„ä¾èµ–æ³¨å…¥åº“ã€‚</p>
<p>ğŸ”´  è¿è¡Œç¯å¢ƒï¼šç”±äºä½¿ç”¨äº†è¾ƒæ–°çš„ç‰¹æ€§ï¼Œå…¶ä»–æ„å»ºå¹³å°æš‚æœªè·Ÿè¿›(åŒ…æ‹¬ Babelã€Vite)ã€‚ä¸‹é¢ä»£ç åŸºäº Typescript 5.2(next) + <code>jest</code> + <code>ts-jest</code> è¿è¡Œã€‚</p>
<p>ä¸ºäº†ç¡®ä¿è¿è¡Œï¼Œ éœ€è¦æ·»åŠ ä»¥ä¸‹ polyfillï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">// typescript polyfill</span><br><span class="line">declare global &#123;</span><br><span class="line">  interface SymbolConstructor &#123;</span><br><span class="line">    readonly metadata: unique symbol</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  interface Function &#123;</span><br><span class="line">    [Symbol.metadata]?: DecoratorMetadata</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">// runtime polyfill</span><br><span class="line">if (typeof Symbol.metadata === &apos;undefined&apos;) &#123;</span><br><span class="line">  // @ts-expect-error</span><br><span class="line">  Symbol.metadata = Symbol(&apos;Symbol.metadata&apos;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ğŸ’¡  åœ¨æ–°ç‰ˆçš„è£…é¥°å™¨ä¸­ï¼Œå®ç°ä¾èµ–æ³¨å…¥ä¸ä¸€å®šè¦ç”¨åˆ° Decorator Metadata, å¯ä»¥çœ‹è£…é¥°å™¨ææ¡ˆä¸­çš„<a href="https://github.com/tc39/proposal-decorators#access-and-metadata-sidechanneling" target="_blank" rel="noopener">ä¾‹å­</a>ã€‚</p>
</blockquote>
<p><br><br><br><br><br><br><br></p>
<h3 id="è£…é¥°å™¨-api"><a href="#è£…é¥°å™¨-api" class="headerlink" title="è£…é¥°å™¨ API"></a>è£…é¥°å™¨ API</h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬æŠŠå…³é”®çš„è£…é¥°å™¨ API å®šä¹‰å‡ºæ¥:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">// ğŸ”´ InjectionKey ç”¨äºå®šä¹‰ä¾èµ–æ³¨å…¥çš„æ ‡è¯†ç¬¦, å¯æ˜¯å®ç°æ ‡å¿—æœå’Œåè®®çš„ç»‘å®šï¼Œæˆ‘ä»¬åœ¨ä¸Šæ–‡ä»‹ç»è¿‡äº†</span><br><span class="line">export interface InjectionKey&lt;T&gt; extends Symbol &#123;&#125;</span><br><span class="line"></span><br><span class="line">// ğŸ”´ ä½œç”¨åŸŸç±»å‹, ä½œä¸ºç®€å•ç¤ºä¾‹ï¼Œæˆ‘ä»¬å°±æ”¯æŒä¸¤ç§ä½œç”¨åŸŸç±»å‹</span><br><span class="line">export enum Scope &#123;</span><br><span class="line">  Singleton,</span><br><span class="line">  Transient,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// ğŸ”´ ç±»è£…é¥°å™¨ï¼Œæ”¯æŒè¢«æ³¨å…¥çš„ç±»éƒ½éœ€è¦ä½¿ç”¨å®ƒæ¥è£…é¥°</span><br><span class="line">// å¯ä»¥æ¥å—ä¸€ä¸ª scopeï¼Œé»˜è®¤ä¸º å•ä¾‹</span><br><span class="line">export function injectable&lt;T, Class extends abstract new (...args: any) =&gt; T&gt;(</span><br><span class="line">  key: InjectionKey&lt;T&gt;,</span><br><span class="line">  scope?: Scope</span><br><span class="line">) &#123;</span><br><span class="line">  return (value: Class, context: ClassDecoratorContext&lt;Class&gt;) =&gt; &#123;</span><br><span class="line">    const metadata = getOrCreateMetadata(context.metadata)</span><br><span class="line"></span><br><span class="line">    if (metadata.injectable) &#123;</span><br><span class="line">      throw new Error(&apos;injectable is already defined&apos;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    metadata.injectable = key</span><br><span class="line">    metadata.scope = scope</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// ğŸ”´ å±æ€§è£…é¥°å™¨, å£°æ˜æ³¨å…¥</span><br><span class="line">export function inject&lt;T&gt;(key: InjectionKey&lt;T&gt;) &#123;</span><br><span class="line">  return (value: undefined, context: ClassFieldDecoratorContext&lt;unknown, T | undefined&gt;) =&gt; &#123;</span><br><span class="line">    injectToField(&#123; key, context &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// ğŸ”´ å±æ€§è£…é¥°å™¨, å£°æ˜æ³¨å…¥æ‰€æœ‰ç»‘å®š</span><br><span class="line">export function injectAll&lt;T&gt;(key: InjectionKey&lt;T&gt;) &#123;</span><br><span class="line">  return (value: undefined, context: ClassFieldDecoratorContext&lt;unknown, T[] | undefined&gt;) =&gt; &#123;</span><br><span class="line">    injectToField(&#123; key, multiple: true, context &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸Šè¿°è£…é¥°å™¨ä¸ä¼šå¯¹ç±»è¿›è¡Œæ”¹é€ ï¼Œåªæ˜¯åˆ©ç”¨ Decorator Metadata è¿›è¡Œä¸€äº›æ ‡æ³¨ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">// ğŸ”´ æˆ‘ä»¬å­˜å‚¨åœ¨ç±» Decorator Metadata çš„æ•°æ®</span><br><span class="line">interface InjectionMetadata &#123;</span><br><span class="line">  // ç±»æ˜¯å¦è£…é¥°äº† @injectable</span><br><span class="line">  injectable?: InjectionKey&lt;unknown&gt;</span><br><span class="line">  // ä½œç”¨åŸŸ</span><br><span class="line">  scope?: Scope</span><br><span class="line">  // ç±»éœ€è¦è¿›è¡Œæ³¨å…¥çš„å±æ€§</span><br><span class="line">  injections?: Map&lt;PropertyKey, Injection&gt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// ğŸ”´ ç±»å±æ€§æ³¨å…¥ä¿¡æ¯</span><br><span class="line">interface Injection &#123;</span><br><span class="line">  // å±æ€§å</span><br><span class="line">  key: InjectionKey&lt;unknown&gt;</span><br><span class="line">  // æ˜¯å¦è·å–å¤šä¸ªå®ä¾‹</span><br><span class="line">  multiple?: boolean</span><br><span class="line">  // è£…é¥°å™¨çš„ä¸Šä¸‹æ–‡</span><br><span class="line">  context: ClassFieldDecoratorContext</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// ğŸ”´ Decorator Metadata çš„ KEY, ä½¿ç”¨ Symbolï¼Œé¿å…å’Œå…¶ä»–åº“å†²çª</span><br><span class="line">const METADATA_KEY: unique symbol = Symbol(&apos;METADATA_KEY&apos;)</span><br><span class="line"></span><br><span class="line">// åˆå§‹åŒ– metadata</span><br><span class="line">function getOrCreateMetadata&lt;T&gt;(metadata: DecoratorMetadata): InjectionMetadata &#123;</span><br><span class="line">  if (metadata == null) &#123;</span><br><span class="line">    throw new Error(&apos;Decorator metadata is not defined&apos;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  return metadata[METADATA_KEY] ?? (metadata[METADATA_KEY] = &#123;&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// æ ‡è®°å±æ€§æ³¨å…¥</span><br><span class="line">function injectToField(injection: Injection) &#123;</span><br><span class="line">  const &#123; context &#125; = injection</span><br><span class="line"></span><br><span class="line">  if (context.static === true) &#123;</span><br><span class="line">    throw new Error(&apos;inject cannot be used on static fields&apos;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  const metadata = getOrCreateMetadata(context.metadata)</span><br><span class="line"></span><br><span class="line">  if (metadata.injections == null) &#123;</span><br><span class="line">    metadata.injections = new Map()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  if (metadata.injections.has(context.name)) &#123;</span><br><span class="line">    throw new Error(`inject is already defined for $&#123;context.name.toString()&#125;`)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  metadata.injections.set(context.name, injection)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æµ‹è¯•é©±åŠ¨å¼€å‘ï¼Œæˆ‘ä»¬å…ˆæŠŠæµ‹è¯•ç”¨ä¾‹å†™äº†ï¼Œä¹Ÿæ–¹ä¾¿è¯»è€…å¯¹æˆ‘ä»¬ API çš„ç”¨æ³•æœ‰åŸºæœ¬çš„äº†è§£ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">// å®šä¹‰åè®®</span><br><span class="line">interface Bird &#123;</span><br><span class="line">  fly(): void</span><br><span class="line">  searchForFood(): void</span><br><span class="line">  breed(): void</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface IZoo &#123;</span><br><span class="line">  getAllBirds(): Bird[]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// å®šä¹‰æ ‡è¯†ç¬¦ï¼Œå¹¶ç»‘å®šåè®®</span><br><span class="line">const BIRD_BINDING: InjectionKey&lt;Bird&gt; = Symbol.for(&apos;Bird&apos;)</span><br><span class="line">const ZOO_KEY: InjectionKey&lt;IZoo&gt; = Symbol.for(&apos;Zoo&apos;)</span><br><span class="line"></span><br><span class="line">// ...</span><br><span class="line"></span><br><span class="line">test(&apos;property inject&apos;, () =&gt; &#123;</span><br><span class="line">  // ğŸ”´ ä½¿ç”¨ @injectable æ ‡æ³¨æ”¯æŒæ³¨å…¥çš„ç±»</span><br><span class="line">  @injectable(BIRD_BINDING)</span><br><span class="line">  class MyBird &#123;</span><br><span class="line">    fly() &#123;&#125;</span><br><span class="line">    searchForFood() &#123;&#125;</span><br><span class="line">    breed() &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  @injectable(BIRD_BINDING)</span><br><span class="line">  class MyBird2 &#123;</span><br><span class="line">    fly() &#123;&#125;</span><br><span class="line">    searchForFood() &#123;&#125;</span><br><span class="line">    breed() &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  @injectable(ZOO_KEY)</span><br><span class="line">  class Zoo implements IZoo &#123;</span><br><span class="line">    // ğŸ”´ è·å–æ‰€æœ‰ Bird å®ä¾‹</span><br><span class="line">    @injectAll(BIRD_BINDING)</span><br><span class="line">    birds?: Bird[]</span><br><span class="line"></span><br><span class="line">    getAllBirds() &#123;</span><br><span class="line">      return this.birds!</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // ğŸ”´ æ³¨å†Œåˆ°å®¹å™¨</span><br><span class="line">  const container = new Container()</span><br><span class="line">  container.bind(BIRD_BINDING, MyBird)</span><br><span class="line">  container.bind(BIRD_BINDING, MyBird2)</span><br><span class="line">  container.bind(ZOO_KEY, Zoo)</span><br><span class="line"></span><br><span class="line">  // æµ‹è¯•</span><br><span class="line">  const zoo = container.get(ZOO_KEY)</span><br><span class="line"></span><br><span class="line">  expect(zoo).toBeInstanceOf(Zoo)</span><br><span class="line">  expect(zoo.getAllBirds().length).toBe(2)</span><br><span class="line">  expect(zoo.getAllBirds()[0]).toBeInstanceOf(MyBird)</span><br><span class="line">  expect(zoo.getAllBirds()[1]).toBeInstanceOf(MyBird2)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><br><br><br><br><br></p>
<h3 id="å®¹å™¨å®ç°"><a href="#å®¹å™¨å®ç°" class="headerlink" title="å®¹å™¨å®ç°"></a>å®¹å™¨å®ç°</h3><p>æ¥ä¸‹æ¥å°±æ˜¯å®ç°å®¹å™¨äº†</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">type Ctor&lt;T = unknown&gt; = new (...args: any) =&gt; T</span><br><span class="line"></span><br><span class="line">export class Container &#123;</span><br><span class="line">  // å­˜å‚¨ç»‘å®šå…³ç³»</span><br><span class="line">  private bindings: Map&lt;InjectionKey&lt;unknown&gt;, Ctor[]&gt; = new Map()</span><br><span class="line">  // å•ä¾‹å¯¹è±¡æ± </span><br><span class="line">  private pools: Map&lt;Ctor, unknown&gt; = new Map()</span><br><span class="line"></span><br><span class="line">  // ğŸ”´ ç»‘å®šï¼Œä¼ å…¥ InjectionKey å’Œ ç±»å®ç°</span><br><span class="line">  bind&lt;T&gt;(key: InjectionKey&lt;T&gt;, impl: new (...args: any) =&gt; T) &#123;</span><br><span class="line">    // è£…é¥°å™¨ä¿¡æ¯æ£€æŸ¥</span><br><span class="line">    if (impl[Symbol.metadata] == null) &#123;</span><br><span class="line">      throw new Error(`No metadata found for $&#123;impl.name&#125;`)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    const metadata = impl[Symbol.metadata]![METADATA_KEY] as InjectionMetadata | undefined</span><br><span class="line"></span><br><span class="line">    if (metadata == null || metadata.injectable == null) &#123;</span><br><span class="line">      throw new Error(`No injectable found for $&#123;impl.name&#125;`)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // å­˜å‚¨</span><br><span class="line">    if (this.bindings.has(key)) &#123;</span><br><span class="line">      this.bindings.get(key)!.push(impl)</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      this.bindings.set(key, [impl])</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // ğŸ”´ è·å–å®ä¾‹</span><br><span class="line">  get&lt;T&gt;(key: InjectionKey&lt;T&gt;): T &#123;</span><br><span class="line">    return this.resolve(key, false) as T</span><br><span class="line">  &#125;</span><br><span class="line">  // ğŸ”´ è·å–æ‰€æœ‰å®ä¾‹</span><br><span class="line">  getAll&lt;T&gt;(key: InjectionKey&lt;T&gt;): T[] &#123;</span><br><span class="line">    return this.resolve(key, true) as T[]</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * ğŸ”´ å¯¹è±¡æŸ¥æ‰¾</span><br><span class="line">   */</span><br><span class="line">  private resolve(key: InjectionKey&lt;unknown&gt;, multiple: boolean): unknown &#123;</span><br><span class="line">    const binding = this.bindings.get(key)</span><br><span class="line"></span><br><span class="line">    if (binding == null) &#123;</span><br><span class="line">      throw new Error(`No binding found for $&#123;key.toString()&#125;`)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (!multiple &amp;&amp; binding.length &gt; 1) &#123;</span><br><span class="line">      throw new Error(`Multiple bindings found for $&#123;key.toString()&#125;`)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return multiple</span><br><span class="line">      ? binding.map((impl) =&gt; this.createInstance(impl))</span><br><span class="line">      : this.createInstance(binding[0])</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * ğŸ”´ å¯¹è±¡å®ä¾‹åŒ–</span><br><span class="line">   */</span><br><span class="line">  private createInstance(impl: Ctor): unknown &#123;</span><br><span class="line">    const metadata = impl[Symbol.metadata]![METADATA_KEY] as InjectionMetadata</span><br><span class="line">    const &#123; scope = Scope.Singleton, injections &#125; = metadata</span><br><span class="line"></span><br><span class="line">    // å•ä¾‹</span><br><span class="line">    if (scope === Scope.Singleton &amp;&amp; this.pools.has(impl)) &#123;</span><br><span class="line">      return this.pools.get(impl)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // å®ä¾‹åŒ–</span><br><span class="line">    const instance = new impl()</span><br><span class="line"></span><br><span class="line">    // ä¾èµ–æ³¨å…¥ï¼Œé€’å½’è°ƒç”¨</span><br><span class="line">    if (injections != null) &#123;</span><br><span class="line">      for (const injection of injections.values()) &#123;</span><br><span class="line">        const &#123; key, context, multiple &#125; = injection</span><br><span class="line">        const value = multiple ? this.getAll(key) : this.get(key)</span><br><span class="line">        // ğŸ”´ åˆ©ç”¨æ–°ç‰ˆè£…é¥°å™¨çš„ access å®ç°æ³¨å…¥</span><br><span class="line">        context.access.set(instance, value)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (scope === Scope.Singleton) &#123;</span><br><span class="line">      this.pools.set(impl, instance)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return instance</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><br></p>
<p>æ•´ä¸ªä»£ç éå¸¸ç®€å•ï¼Œè¿™é‡Œå¯¹æ–°ç‰ˆè£…é¥°å™¨çš„å¦™ç”¨åœ¨äº <code>context.access.set(instance, value)</code> , ç”¨èµ·æ¥éå¸¸æ–¹ä¾¿ï¼Œæˆ‘ä»¬ä¸éœ€è¦å…³å¿ƒå±æ€§çš„å­˜å‚¨è¿‡ç¨‹ï¼Œæ¯”å¦‚<code>ç§æœ‰å±æ€§</code>ã€‚</p>
<p><br></p>
<p>ä¸Šé¢çš„ä»£ç æœ‰ä¸€ä¸ªé—®é¢˜æ²¡æœ‰è§£å†³ï¼Œå°±æ˜¯<code>å¾ªç¯ä¾èµ–</code>ã€‚æˆ‘ä»¬å†™ä¸€ä¸ªæµ‹è¯•æ¥å¤ç°ä¸€ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">test(&apos;cycle dependency&apos;, () =&gt; &#123;</span><br><span class="line">  const container = new Container()</span><br><span class="line"></span><br><span class="line">  const A_KEY: InjectionKey&lt;A&gt; = Symbol(&apos;A&apos;)</span><br><span class="line">  const B_KEY: InjectionKey&lt;B&gt; = Symbol(&apos;B&apos;)</span><br><span class="line"></span><br><span class="line">  @injectable(A_KEY)</span><br><span class="line">  class A &#123;</span><br><span class="line">    @inject(B_KEY)</span><br><span class="line">    b?: B</span><br><span class="line"></span><br><span class="line">    constructor() &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  @injectable(B_KEY)</span><br><span class="line">  class B &#123;</span><br><span class="line">    @inject(A_KEY)</span><br><span class="line">    a?: A</span><br><span class="line"></span><br><span class="line">    constructor() &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  container.bind(A_KEY, A)</span><br><span class="line">  container.bind(B_KEY, B)</span><br><span class="line"></span><br><span class="line">  const a = container.get(A_KEY)</span><br><span class="line">  expect(a).toBeInstanceOf(A)</span><br><span class="line">  const b = container.get(B_KEY)</span><br><span class="line">  expect(b).toBeInstanceOf(B)</span><br><span class="line">  expect(a.b).toBe(b)</span><br><span class="line">  expect(b.a).toBe(a)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„æµ‹è¯•ç”¨ä¾‹ä¼šå‡ºç°<code>è°ƒç”¨æ ˆæº¢å‡º</code>ã€‚å› ä¸º A â†’ B ä¹‹é—´å‡ºç°äº†å¾ªç¯ä¾èµ–ã€‚è¿™ä¸ªä¹Ÿå¥½åŠï¼Œæˆ‘ä»¬æ–°å¢ä¸€ä¸ªç¼“å­˜å±æ€§ï¼Œå­˜å‚¨æ­£åœ¨å®ä¾‹åŒ–çš„å¯¹è±¡ï¼Œå¯ä»¥ç®€å•è§£å†³é—®é¢˜ï¼š</p>
<figure class="highlight diff"><table><tr><td class="code"><pre><span class="line">export class Container &#123;</span><br><span class="line"><span class="addition">+ // æ­£åœ¨åˆ›å»ºçš„å¯¹è±¡</span></span><br><span class="line"><span class="addition">+ private creating: Map&lt;Ctor, unknown&gt; = new Map()</span></span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * å¯¹è±¡å®ä¾‹åŒ–</span><br><span class="line">   */</span><br><span class="line">  private createInstance(impl: Ctor): unknown &#123;</span><br><span class="line"><span class="addition">+   if (this.creating.has(impl)) &#123;</span></span><br><span class="line"><span class="addition">+     return this.creating.get(impl)</span></span><br><span class="line"><span class="addition">+   &#125;</span></span><br><span class="line">    // ...</span><br><span class="line"><span class="addition">+   // å®ä¾‹åŒ–</span></span><br><span class="line"><span class="addition">+   const instance = new impl()</span></span><br><span class="line"><span class="addition">+   // ç¼“å­˜</span></span><br><span class="line"><span class="addition">+   this.creating.set(impl, instance)</span></span><br><span class="line"></span><br><span class="line"><span class="addition">+   try &#123;</span></span><br><span class="line">      // ä¾èµ–æ³¨å…¥</span><br><span class="line">      if (injections != null) &#123;</span><br><span class="line">        for (const injection of injections.values()) &#123;</span><br><span class="line">          const &#123; key, context, multiple &#125; = injection</span><br><span class="line">          const value = multiple ? this.getAll(key) : this.get(key)</span><br><span class="line">          context.access.set(instance, value)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      if (scope <span class="comment">=== Scope.Singleton) &#123;</span></span><br><span class="line">        this.pools.set(impl, instance)</span><br><span class="line">      &#125;</span><br><span class="line"><span class="addition">+   &#125; finally &#123;</span></span><br><span class="line"><span class="addition">+     this.creating.delete(impl)</span></span><br><span class="line"><span class="addition">+   &#125;</span></span><br><span class="line"></span><br><span class="line">    return instance</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢å°±æ˜¯è£…é¥°å™¨çš„æ ¸å¿ƒé€»è¾‘äº†ã€‚å¦‚æœä½ å¯¹ç”Ÿäº§çº§åˆ« DI åº“æ„Ÿå…´è¶£ï¼Œå¯ä»¥æ·±å…¥çœ‹ä¸‹æ‰©å±•é˜…è¯»æåŠçš„å¼€æºå®ç°ã€‚</p>
<p>ä¸Šé¢ç›¸å…³æºç å¯ä»¥åœ¨<a href="https://github.com/ivan-94/decoractor-in-action/tree/new-di/src/di" target="_blank" rel="noopener">è¿™é‡Œ</a>æ‰¾åˆ°ã€‚</p>
<p><br><br><br><br><br></p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æœ¬æ–‡å›é¡¾äº†è£…é¥°å™¨çš„è€æ­æ¡£ <code>reflect-metadata</code> çš„å†å²ï¼Œå®ƒçš„æ„¿æ™¯ç»™è£…é¥°å™¨æä¾›æ ‡å‡†åŒ–çš„å…ƒæ•°æ®å­˜å‚¨æœåŠ¡ï¼Œæ›´é•¿è¿œæ¥æ„¿æ™¯æ˜¯ç»™ JavaScript çš„ä¸Šå±‚è¯­è¨€æä¾›ä¿ç•™é™æ€ä¿¡æ¯çš„æ¥å£ã€‚</p>
<p>ä½†å®ƒæœ€ç»ˆæ²¡æœ‰æäº¤ç»™ tc39, ç°åœ¨éšç€æ–°çš„è£…é¥°å™¨æ ‡å‡†çš„å‘å±•ï¼Œå·²ç»è¢« <code>Decorator Metadata</code> ææ¡ˆå–ä»£ã€‚<code>Decorator Metadata</code> ç›¸æ¯” reflect-metadata ç®€åŒ–å¾ˆå¤šï¼Œå°±æ˜¯æ–°å¢äº† <code>Symbol.metadata</code>, é…åˆè£…é¥°å™¨ context.metadataï¼Œå¼€å‘è€…å¯ä»¥å­˜å‚¨ä»»æ„å…ƒæ•°æ®ã€‚</p>
<p>æ¥ç€æˆ‘ä»¬ç»§ç»­æ¢ç´¢äº† Typescript å¯¹è£…é¥°å™¨ç±»å‹æ£€æŸ¥çš„å¢å¼ºï¼Œå¯ä»¥è®©æˆ‘ä»¬å†™å‡ºæ›´å®‰å…¨çš„ä»£ç ã€‚å°¤å…¶åœ¨ DI è¿™ä¸ªåœºæ™¯ã€‚</p>
<p>æœ€åæˆ‘ä»¬å°†ä¸Šé¢å­¦åˆ°çš„çŸ¥è¯†èä¼šè´¯é€šï¼Œå¼€å‘äº†ä¸€ä¸ªç®€æ˜“çš„ä¾èµ–æ³¨å…¥å®ç°ã€‚</p>
<p><br><br><br><br><br></p>
<h2 id="æ‰©å±•é˜…è¯»"><a href="#æ‰©å±•é˜…è¯»" class="headerlink" title="æ‰©å±•é˜…è¯»"></a>æ‰©å±•é˜…è¯»</h2><ul>
<li>Decorator<br><a href="https://github.com/tc39/proposal-decorators" target="_blank" rel="noopener">https://github.com/tc39/proposal-decorators</a></li>
<li>Decorator Metadata<br><a href="https://github.com/tc39/proposal-decorator-metadata" target="_blank" rel="noopener">https://github.com/tc39/proposal-decorator-metadata</a></li>
<li>reflect-metadata<br><a href="https://github.com/rbuckton/reflect-metadata" target="_blank" rel="noopener">https://github.com/rbuckton/reflect-metadata</a><ul>
<li><a href="https://dev.to/svehla/why-reflect-metadata-suc-s-5fal" target="_blank" rel="noopener">Why reflect-metadata suc*s</a></li>
<li><a href="https://www.typescriptlang.org/docs/handbook/decorators.html" target="_blank" rel="noopener">Typescript Experimental Decorator</a></li>
<li><a href="https://medium.com/jspoint/introduction-to-reflect-metadata-package-and-its-ecmascript-proposal-8798405d7d88" target="_blank" rel="noopener">Introduction to â€œreflect-metadataâ€ package and its ECMAScript proposal</a></li>
</ul>
</li>
<li>DI å®ç°<br><a href="https://github.com/inversify/InversifyJS" target="_blank" rel="noopener">https://github.com/inversify/InversifyJS</a><br><a href="https://github.com/microsoft/tsyringe" target="_blank" rel="noopener">https://github.com/microsoft/tsyringe</a><br><a href="https://github.com/midwayjs/injection" target="_blank" rel="noopener">https://github.com/midwayjs/injection</a><br><a href="https://github.com/jeffijoe/awilix" target="_blank" rel="noopener">https://github.com/jeffijoe/awilix</a><br><a href="https://github.com/typestack/typedi" target="_blank" rel="noopener">https://github.com/typestack/typedi</a></li>
</ul>

  </div>
</article>

    <div class="blog-post-comments">
        <div id="disqus_thread">
            <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        </div>
    </div>



    </div>
    
      <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Blogs</a></li>
         
          <li><a href="http://github.com/ivan-94">Projects</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#di-åº“ç»å¸¸æåŠçš„-reflect-metadata-åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ"><span class="toc-number">1.</span> <span class="toc-text">DI åº“ç»å¸¸æåŠçš„ reflect-metadata åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#decorator-metadata"><span class="toc-number">2.</span> <span class="toc-text">Decorator Metadata</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ç®€å•ç†è§£ä¾èµ–æ³¨å…¥"><span class="toc-number">3.</span> <span class="toc-text">ç®€å•ç†è§£ä¾èµ–æ³¨å…¥</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ç»§ç»­æ¢ç´¢-typescript-è£…é¥°å™¨çš„èƒ½åŠ›è¾¹ç•Œ"><span class="toc-number">4.</span> <span class="toc-text">ç»§ç»­æ¢ç´¢ Typescript è£…é¥°å™¨çš„èƒ½åŠ›è¾¹ç•Œ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#å®æˆ˜"><span class="toc-number">5.</span> <span class="toc-text">å®æˆ˜</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#è£…é¥°å™¨-api"><span class="toc-number">5.1.</span> <span class="toc-text">è£…é¥°å™¨ API</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#å®¹å™¨å®ç°"><span class="toc-number">5.2.</span> <span class="toc-text">å®¹å™¨å®ç°</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#æ€»ç»“"><span class="toc-number">6.</span> <span class="toc-text">æ€»ç»“</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#æ‰©å±•é˜…è¯»"><span class="toc-number">7.</span> <span class="toc-text">æ‰©å±•é˜…è¯»</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://bobi.ink/2023/06/30/decorator-2/"><i class="fa fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=https://bobi.ink/2023/06/30/decorator-2/&text=å…¨æ–° JavaScript è£…é¥°å™¨å®æˆ˜ä¸‹ç¯‡ï¼šå®ç°ä¾èµ–æ³¨å…¥"><i class="fa fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://bobi.ink/2023/06/30/decorator-2/&title=å…¨æ–° JavaScript è£…é¥°å™¨å®æˆ˜ä¸‹ç¯‡ï¼šå®ç°ä¾èµ–æ³¨å…¥"><i class="fa fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://bobi.ink/2023/06/30/decorator-2/&is_video=false&description=å…¨æ–° JavaScript è£…é¥°å™¨å®æˆ˜ä¸‹ç¯‡ï¼šå®ç°ä¾èµ–æ³¨å…¥"><i class="fa fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=å…¨æ–° JavaScript è£…é¥°å™¨å®æˆ˜ä¸‹ç¯‡ï¼šå®ç°ä¾èµ–æ³¨å…¥&body=Check out this article: https://bobi.ink/2023/06/30/decorator-2/"><i class="fa fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=https://bobi.ink/2023/06/30/decorator-2/&title=å…¨æ–° JavaScript è£…é¥°å™¨å®æˆ˜ä¸‹ç¯‡ï¼šå®ç°ä¾èµ–æ³¨å…¥"><i class="fa fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=https://bobi.ink/2023/06/30/decorator-2/&title=å…¨æ–° JavaScript è£…é¥°å™¨å®æˆ˜ä¸‹ç¯‡ï¼šå®ç°ä¾èµ–æ³¨å…¥"><i class="fa fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://bobi.ink/2023/06/30/decorator-2/&title=å…¨æ–° JavaScript è£…é¥°å™¨å®æˆ˜ä¸‹ç¯‡ï¼šå®ç°ä¾èµ–æ³¨å…¥"><i class="fa fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=https://bobi.ink/2023/06/30/decorator-2/&title=å…¨æ–° JavaScript è£…é¥°å™¨å®æˆ˜ä¸‹ç¯‡ï¼šå®ç°ä¾èµ–æ³¨å…¥"><i class="fa fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=https://bobi.ink/2023/06/30/decorator-2/&name=å…¨æ–° JavaScript è£…é¥°å™¨å®æˆ˜ä¸‹ç¯‡ï¼šå®ç°ä¾èµ–æ³¨å…¥&description="><i class="fa fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
      <ul>
        <li id="toc"><a class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa fa-list fa-lg" aria-hidden="true"></i> TOC</a></li>
        <li id="share"><a class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa fa-share-alt fa-lg" aria-hidden="true"></i> Share</a></li>
        <li id="top" style="display:none"><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a></li>
        <li id="menu"><a class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa fa-bars fa-lg" aria-hidden="true"></i> Menu</a></li>
      </ul>
    </div>

  </div>
</div>

    
    <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2023 Ivan
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Blogs</a></li>
         
          <li><a href="http://github.com/ivan-94">Projects</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

</body>
</html>
<!-- styles -->
<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">
<link rel="stylesheet" href="/lib/meslo-LG/styles.css">
<link rel="stylesheet" href="/lib/justified-gallery/justifiedGallery.min.css">

<!-- jquery -->
<script src="/lib/jquery/jquery.min.js"></script>
<script src="/lib/justified-gallery/jquery.justifiedGallery.min.js"></script>
<script src="/js/main.js"></script>


    <!-- Google Analytics -->
    <script type="text/javascript">
        (function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-44571525-2', 'auto');
        ga('send', 'pageview');
    </script>


    <!-- Disqus Comments -->
    <script type="text/javascript">
        var disqus_shortname = 'bobi-ink';

        (function(){
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        }());
    </script>


