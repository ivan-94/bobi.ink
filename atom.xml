<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Bobi.ink</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://bobi.ink/"/>
  <updated>2023-07-26T01:27:49.261Z</updated>
  <id>https://bobi.ink/</id>
  
  <author>
    <name>Ivan</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>AI è°ƒæ•™å¸ˆï¼šç»˜åˆ¶ ER å›¾</title>
    <link href="https://bobi.ink/2023/07/26/ai-build-er/"/>
    <id>https://bobi.ink/2023/07/26/ai-build-er/</id>
    <published>2023-07-25T16:00:00.000Z</published>
    <updated>2023-07-26T01:27:49.261Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/images/ai-build-er/Untitled.png" alt="Untitled"></p><p><br></p><p><img src="/images/ai-build-er/Untitled.gif" alt="Untitled"></p><p>åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬<a href="https://juejin.cn/post/7258150367120310332" target="_blank" rel="noopener">è®© ChatGPT æ¥å¸®æˆ‘ä»¬å†™ SQL è¯­å¥</a>, ç°åœ¨æˆ‘ä»¬å†æŒ‘æˆ˜ä¸€ä¸‹ï¼Œè®© ChatGPT æ¥å¸®æˆ‘ä»¬æ•°æ®å»ºæ¨¡ã€‚</p><p><br></p><p>å¦‚ä¸Šå›¾ï¼Œæˆ‘ä»¬å¸Œæœ›èƒ½åšåˆ°æ¯”å¦‚ï¼š</p><ul><li>åˆ›å»ºæ•°æ®æ¨¡å‹ï¼Œè®© ChatGPT å¸®æˆ‘ä»¬æ¨æ–­è¡¨åº”è¯¥åŒ…å«çš„å­—æ®µã€å­—æ®µç±»å‹ã€ä¸»é”®ã€ç´¢å¼•ã€è¡¨ä¹‹é—´çš„å…³è”å…³ç³»ç­‰ç­‰</li><li>ä¼˜åŒ–æ•°æ®æ¨¡å‹ã€‚å¯¹ç°æœ‰çš„æ•°æ®æ¨¡å‹è¿›è¡Œæ‰©å±•å’Œä¼˜åŒ–</li><li>å¯¹æ•°æ®æ¨¡å‹åŠå…¶å­—æ®µè¿›è¡Œå¢åˆ æ”¹ã€‚</li><li>â€¦</li></ul><p><br></p><p>è¦ ChatGPT å¤„ç†è¿™ä¹ˆã€Œå¤æ‚ã€çš„éœ€æ±‚ï¼Œå…¶å®æœ‰ç‚¹éš¾åº¦ã€‚æˆ‘ä»¬ä»æœ€ç®€å•çš„éœ€æ±‚å¼€å§‹ï¼Œå…ˆè®© ChatGPT å°†ç”¨æˆ·çš„éœ€æ±‚è½¬æ¢ä¸ºæ•°æ®æ¨¡å‹ï¼Œå¹¶è¿”å› JSON æ ¼å¼ï¼š</p><p><br></p><figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">ä½ æ˜¯ä¸€ä¸ªæ•°æ®åº“å»ºæ¨¡ä¸“å®¶, ä½ ä¼šæ ¹æ®ç”¨æˆ·çš„æç¤ºè¿›è¡Œæ•°æ®åº“æ¦‚å¿µå»ºæ¨¡, å‡è®¾å®ä½“(è¡¨)æœ‰å¤šä¸ªå­—æ®µ(å±æ€§), è¿™äº›å­—æ®µæ”¯æŒä»¥ä¸‹ç±»å‹:</span><br><span class="line"></span><br><span class="line"><span class="bullet">- </span>Boolean</span><br><span class="line"><span class="bullet">- </span>Date</span><br><span class="line"><span class="bullet">- </span>DateTime</span><br><span class="line"><span class="bullet">- </span>Timestamp</span><br><span class="line"><span class="bullet">- </span>Integer</span><br><span class="line"><span class="bullet">- </span>Decimal</span><br><span class="line"><span class="bullet">- </span>Long</span><br><span class="line"><span class="bullet">- </span>Double</span><br><span class="line"><span class="bullet">- </span>Float</span><br><span class="line"><span class="bullet">- </span>String</span><br><span class="line"><span class="bullet">- </span>Text</span><br><span class="line"><span class="bullet">- </span>LongText</span><br><span class="line"><span class="bullet">- </span>JSON</span><br><span class="line"><span class="bullet">- </span>Reference</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">å¼•ç”¨å…³ç³»çš„æè¿°ï¼š</span><br><span class="line"></span><br><span class="line">å…¶ä¸­ Reference ç±»å‹è¡¨ç¤ºå¯¹å…¶ä»–å®ä½“çš„å¼•ç”¨ï¼Œæ¯”å¦‚ å¼•ç”¨äº† B å®ä½“çš„ b å­—æ®µï¼Œä¼šè¿™æ ·è¡¨ç¤º: &#123;"type": "Reference", "target": "B", "property": "b", "cardinality": "OneToMany" &#125;</span><br><span class="line"></span><br><span class="line">cardinality å¯é€‰å€¼æœ‰: OneToOne, OneToMany, ManyToOne, ManyToMany</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">å¦‚æœæ˜¯ä¸»é”®ï¼Œéœ€è¦å°†å­—æ®µçš„ primaryKey è®¾ç½®ä¸º true</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">ä¸¾ä¸ªä¾‹å­ï¼Œç”¨æˆ·è¾“å…¥: """åˆ›å»ºä¸€ä¸ªç”¨æˆ·, è¿™ä¸ªç”¨æˆ·æœ‰å¤šä¸ªåœ°å€"""", ä½ åº”è¯¥è¿”å›ï¼š</span><br><span class="line"></span><br><span class="line">[</span><br><span class="line">&#123;</span><br><span class="line">"name": "User",</span><br><span class="line">"title": "ç”¨æˆ·",</span><br><span class="line">"properties": [</span><br><span class="line">&#123;</span><br><span class="line">"name": "id",</span><br><span class="line">"title": "ç”¨æˆ·å”¯ä¸€ id",</span><br><span class="line">"primaryKey": true,</span><br><span class="line">"type": &#123; "type": "Long" &#125;</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">"name": "name",</span><br><span class="line">"title": "ç”¨æˆ·å",</span><br><span class="line">"type": &#123; "type": "String" &#125;</span><br><span class="line">&#125;</span><br><span class="line">]</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">"name": "Address",</span><br><span class="line">"title": "åœ°å€",</span><br><span class="line">"properties": [</span><br><span class="line">&#123;</span><br><span class="line">"name": "id",</span><br><span class="line">"title": "å”¯ä¸€ id",</span><br><span class="line">"primaryKey": true,</span><br><span class="line">"type": &#123; "type": "Long" &#125;</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">"name": "value",</span><br><span class="line">"title": "è¯¦ç»†åœ°å€",</span><br><span class="line">"type": &#123; "type": "String" &#125;</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">"name": "userId",</span><br><span class="line">"title": "ç”¨æˆ·å¼•ç”¨",</span><br><span class="line">"type": &#123; "type": "Reference", "target": "User", "property": "id", "cardinality": "ManyToOne" &#125;</span><br><span class="line">&#125;</span><br><span class="line">]</span><br><span class="line">&#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">ä½ å¯ä»¥æ ¹æ®é—®é¢˜åˆ›å»ºå¤šä¸ªå¯¹è±¡ï¼Œä»¥æ•°ç»„çš„å½¢å¼è¿”å›ã€‚ä¸Šé¢çš„ä¾‹å­åªæ˜¯ä¸€ä¸ªæ ¼å¼ç¤ºèŒƒ, ä¸è¦ç…§æ¬ï¼Œä½ éœ€è¦æ ¹æ®ç”¨æˆ·çš„æç¤º, ä»¥åŠä½ çš„æ•°æ®åº“å»ºæ¨¡çš„ä¸°å¯Œç»éªŒå’Œè¡Œä¸šçš„æœ€ä½³å®è·µæ¥å›ç­”ã€‚</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">ä»¥ JSON æ•°ç»„çš„æ ¼å¼å›ç­”ï¼Œä¸è¦è§£é‡Š</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">å½“ä½ æ— æ³•ç†è§£è¯·æ±‚æ—¶ï¼Œ è¯·å›ç­”ç›´æ¥è¿”å›ï¼š</span><br><span class="line"></span><br><span class="line">[SORRY]</span><br><span class="line"></span><br><span class="line">ä¸è¦è§£é‡Š</span><br><span class="line">`</span><br></pre></td></tr></table></figure><p><br></p><p>è¿™ä¸ª Prompt ç»“æ„ç®—æ˜¯æ¯”è¾ƒå…¸å‹ï¼š</p><ul><li>è§’è‰²å®šä¹‰ã€‚æ•°æ®åº“å»ºæ¨¡ä¸“å®¶</li><li>ä»»åŠ¡ã€‚å°†ç”¨æˆ·éœ€æ±‚è½¬æ¢ä¸ºæ¦‚å¿µæ¨¡å‹</li><li>è§„åˆ™ã€‚å­—æ®µçš„ç±»å‹ï¼Œå¼•ç”¨å…³ç³»çš„æè¿°ï¼Œä¸»é”®</li><li>è¾“å‡ºè§„åˆ™ã€‚è¾“å‡º JSONï¼Œå¦‚æœå¤±è´¥å°±è¿”å› <code>[SORRY]</code></li><li>ç¤ºä¾‹ã€‚</li></ul><p><br></p><p>è¿™ä¸ª Prompt å¤§éƒ¨åˆ†æƒ…å†µè¿è¡Œè¿˜å¥½ï¼Œè°ƒè¯•çš„è¿‡ç¨‹ä¸­å‘ç°çš„ä¸€äº›å‘ï¼Œä¹Ÿä½“ç°åœ¨ Prompt é‡Œé¢äº†ï¼Œæ¯”å¦‚</p><p><br></p><ul><li>æˆ‘ä»¬æƒ³è®©å®ƒè¿”å› JSON æ ¼å¼ï¼Œä½†æ˜¯å®ƒå¯èƒ½ä¼šå¤¹å¸¦ä¸€äº›è§£é‡Šï¼Œå¯¼è‡´æ²¡åŠæ³•ç›´æ¥ JSON.parse</li><li>å®ƒå¯èƒ½ä¼šç›´æ¥ç…§æ¬æˆ‘ä»¬ç»™å®ƒçš„ç¤ºä¾‹</li></ul><p><br></p><p>è¿™æ˜¯æˆ‘ä»¬æœ€åˆçš„ Prompt ç‰ˆæœ¬ï¼Œä»…æ”¯æŒåˆ›å»ºæ–°æ•°æ®æ¨¡å‹ï¼Œè€Œä¸”æ²¡æœ‰ç»“åˆå·²æœ‰çš„æ•°æ®æ¨¡å‹ä¸Šä¸‹æ–‡æ¥è¾“å‡ºç»“æœã€‚æˆ‘ä»¬è¿˜éœ€è¦ç»§ç»­ä¼˜åŒ–ã€‚</p><p><br><br><br><br><br></p><h1 id="è®¾è®¡åŸå­æ“ä½œ"><a href="#è®¾è®¡åŸå­æ“ä½œ" class="headerlink" title="è®¾è®¡åŸå­æ“ä½œ"></a>è®¾è®¡åŸå­æ“ä½œ</h1><p>åœ¨éœ€æ±‚æ˜ç¡®ä¹‹åï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦è®¾è®¡æ¥å…¥ AI çš„åŸå­æ“ä½œï¼Œåœ¨ä¸Šé¢çš„éœ€æ±‚ä¸­ï¼Œæˆ‘ä»¬æ— éæ˜¯å¸Œæœ›é€šè¿‡ AI å¯¹æˆ‘ä»¬çš„æ•°æ®æ¨¡å‹è¿›è¡Œ<code>å¢åˆ æ”¹</code>ã€‚å½“ç„¶è¿™ä¸æ˜¯ç®€å•çš„è½¬æ¢ï¼Œæˆ‘ä»¬è¿˜å¸Œæœ› ChatGPT èƒ½åœ¨è¿™é‡Œå‘æŒ¥<code>æ¨å¯¼</code>å’Œ<code>æ¼”ç»</code>çš„èƒ½åŠ›ã€‚</p><p><br></p><p>åŸºäºæ­¤ï¼Œæˆ‘ä»¬è®¾è®¡äº†ä»¥ä¸‹åŸå­æ“ä½œ</p><ul><li>è¡¨æ“ä½œ<ul><li>æ–°å¢è¡¨</li><li>ä¿®æ”¹è¡¨</li><li>é‡å‘½åè¡¨</li><li>åˆ é™¤è¡¨</li></ul></li><li>å­—æ®µæ“ä½œ<ul><li>åˆ›å»ºå­—æ®µ</li><li>ä¿®æ”¹å­—æ®µ</li><li>é‡å‘½åå­—æ®µ</li><li>åˆ é™¤å­—æ®µ</li></ul></li></ul><p>å¦å¤–æˆ‘ä»¬è¿˜è¦è€ƒè™‘å®‰å…¨æ€§çš„çº¦æŸï¼Œæ¯”å¦‚ä¸èƒ½åˆ é™¤å’Œå¼•ç”¨ä¸å­˜åœ¨çš„è¡¨å’Œå­—æ®µã€‚</p><p><br></p><p>äºæ˜¯ï¼Œæˆ‘ä»¬é‡æ–°æ•´ç†äº† Prompt éœ€æ±‚ï¼š</p><figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">You are an expert in conceptual modeling for relational databases. let's play a game, You need to parsing user inputs and converting them into a series of TASKs.</span><br><span class="line"></span><br><span class="line">Here are some rules:</span><br><span class="line"></span><br><span class="line">Rule 1: The following descriptions are equivalent:</span><br><span class="line"></span><br><span class="line"><span class="bullet">- </span>table, entity, model, å®ä½“,è¡¨,æ•°æ®å¯¹è±¡, æ¨¡å‹</span><br><span class="line"><span class="bullet">- </span>field, property, å­—æ®µ, å±æ€§, è¡¨å­—æ®µ, è¡¨å±æ€§,å®ä½“å±æ€§</span><br><span class="line"><span class="bullet">- </span>name,åç§°,å,æ ‡è¯†ç¬¦</span><br><span class="line"><span class="bullet">- </span>title,æ ‡é¢˜,ä¸­æ–‡å</span><br><span class="line"><span class="bullet">- </span>rename, é‡å‘½å,ä¿®æ”¹æ ‡è¯†ç¬¦, ä¿®æ”¹åç§°</span><br><span class="line"><span class="bullet">- </span>retitle, é‡å‘½åæ ‡é¢˜,ä¿®æ”¹æ ‡é¢˜</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">Rule 2: The types of TASK:</span><br><span class="line"></span><br><span class="line"><span class="bullet">- </span>createTable:</span><br><span class="line">  - name: table name in upper camel case</span><br><span class="line">  - title: table title in chinese</span><br><span class="line"><span class="bullet">- </span>updateTable:</span><br><span class="line">  - name</span><br><span class="line">  - title</span><br><span class="line"><span class="bullet">- </span>renameTable</span><br><span class="line">  - name</span><br><span class="line">  - newName: the new table new in upper camel case</span><br><span class="line"><span class="bullet">- </span>removeTable:</span><br><span class="line">  - name</span><br><span class="line"><span class="bullet">- </span>addField:</span><br><span class="line">  - table: table name</span><br><span class="line">  - name: field name in lower camel case</span><br><span class="line">  - title: field title in chinese</span><br><span class="line">  - type: field type</span><br><span class="line"><span class="code">    - Boolean</span></span><br><span class="line"><span class="code">    - Date</span></span><br><span class="line"><span class="code">    - DateTime</span></span><br><span class="line"><span class="code">    - Timestamp</span></span><br><span class="line"><span class="code">    - Integer</span></span><br><span class="line"><span class="code">    - Decimal</span></span><br><span class="line"><span class="code">    - Long</span></span><br><span class="line"><span class="code">    - Double</span></span><br><span class="line"><span class="code">    - Float</span></span><br><span class="line"><span class="code">    - String</span></span><br><span class="line"><span class="code">    - Text</span></span><br><span class="line"><span class="code">    - LongText</span></span><br><span class="line"><span class="code">    - JSON</span></span><br><span class="line"><span class="code">    - Reference: reference to other table</span></span><br><span class="line">  - reference: reference to other table field, for example: Table.field</span><br><span class="line">  - referenceCardinality: OneToOne, OneToMany, ManyToOne, ManyToMany</span><br><span class="line">  - primaryKey: optional, true or false</span><br><span class="line">  - notNull: optional, true or false</span><br><span class="line"><span class="bullet">- </span>removeField: remove the table field</span><br><span class="line">  - table</span><br><span class="line">  - name</span><br><span class="line"><span class="bullet">- </span>updateField: update the table field</span><br><span class="line">  - table</span><br><span class="line">  - name</span><br><span class="line">  - title</span><br><span class="line">  - type</span><br><span class="line">  - reference</span><br><span class="line">  - referenceCardinality</span><br><span class="line">  - primaryKey</span><br><span class="line">  - notNull</span><br><span class="line"><span class="bullet">- </span>renameField: rename the table field</span><br><span class="line">  - table</span><br><span class="line">  - name: old field name</span><br><span class="line">  - newName: new field name in lower camel case</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">Rule 3: CANNOT reference non-existent tables.</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">Rule 4: please response in chinese</span><br></pre></td></tr></table></figure><p><br><br><br></p><p>åœ¨è¿™é‡Œæˆ‘ä»¬è¦æ±‚ ChatGPT å°†ç”¨æˆ·çš„è¾“å…¥è½¬æ¢ä¸ºä¸€ç³»åˆ—çš„ <code>Task</code>ã€‚ä»¥åŠè¿™äº› Task çš„ <code>Schema</code>ã€‚</p><blockquote><p>ğŸ’¡  è¿™é‡Œä¸ºä»€ä¹ˆä½¿ç”¨è‹±æ–‡ï¼Ÿæœ‰ä¸¤ä¸ªåŸå› , ChatGPT å¤§éƒ¨åˆ†çš„è®­ç»ƒé›†æ˜¯è‹±æ–‡ï¼›è¿˜æœ‰ä¸­æ–‡åœ¨è¡¨è¿°ç›¸åŒçš„äº‹æƒ…å ç”¨çš„ Token é€šå¸¸è¦é«˜äºè‹±è¯­ã€‚</p></blockquote><p><br><br><br><br><br><br><br></p><h1 id="few-shot-prompting"><a href="#few-shot-prompting" class="headerlink" title="Few-shot Prompting"></a>Few-shot Prompting</h1><p>æˆ‘ä»¬æè¿°å¥½éœ€æ±‚äº†ï¼Œä½†æ˜¯è¿˜æ²¡æœ‰å‘Šè¯‰ ChatGPT åº”è¯¥è¿”å›æ€æ ·çš„æ•°æ®ï¼ŒChatGPT åªèƒ½è‡ªå·± YY äº†ï¼š</p><p><img src="/images/ai-build-er/Untitled%201.png" alt="Untitled"></p><p><br><br><br></p><p>è§£å†³åŠæ³•æ˜¯ç»™ ChatGPT æ›´å¤šç¤ºä¾‹ï¼Œè¿™ç§æŠ€å·§ç§°ä¹‹ä¸º â€œ<a href="https://learningprompt.wiki/docs/chatGPT/tutorial-extras/Few-Shot%20Prompting" target="_blank" rel="noopener"><code>Few-Shot Prompting</code></a>â€ï¼Œåƒ ChatGPT è¿™ç§ç»Ÿè®¡æ¨¡å‹ï¼Œå®é™…ä¸Šæ˜¯è¯»ä¸æ‡‚æˆ‘ä»¬ä¸Šé¢çš„éœ€æ±‚çš„ï¼Œå®ƒæ˜¯åŸºäºâ€œæ¦‚ç‡é¢„æµ‹â€æ¥è¾“å‡ºå†…å®¹ã€‚</p><p>æˆ‘ä»¬åœ¨ä¸Šé¢ Prompt çš„åŸºç¡€ä¸ŠåŠ ä¸Šä¸€äº›ç¤ºä¾‹ï¼š</p><figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">Here is same demo:</span><br><span class="line"></span><br><span class="line"><span class="section">#### START OF DEMO 1</span></span><br><span class="line"></span><br><span class="line">Given Tables:</span><br><span class="line"></span><br><span class="line">"""</span><br><span class="line">[not table here]</span><br><span class="line">"""</span><br><span class="line"></span><br><span class="line">USER: """åˆ é™¤è®¢å•è¡¨"""</span><br><span class="line">ASSISTANT: """è®¢å•è¡¨ä¸å­˜åœ¨ï¼Œæ— æ³•åˆ é™¤"""</span><br><span class="line">explain: If the manipulated table is not in 'Given tables', you should stop the game</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">USER: """ç»™æ‰€æœ‰è¡¨éƒ½åŠ ä¸Šæ›´æ–°æ—¶é—´å’Œåˆ›å»ºæ—¶é—´"""</span><br><span class="line">ASSISTANT: """ä¸å­˜åœ¨è¡¨ï¼Œæ— æ³•æ·»åŠ å­—æ®µ"""</span><br><span class="line">explain: table not exist</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">USER:"""åˆ›å»ºä¸€ä¸ªç”¨æˆ·, è¿™ä¸ªç”¨æˆ·æœ‰å¤šä¸ªåœ°å€"""</span><br><span class="line">ASSISTANT: """</span><br><span class="line">%%createTable name="User" title="ç”¨æˆ·"%%</span><br><span class="line">%%createTable name="Address" title="åœ°å€"%%</span><br><span class="line"></span><br><span class="line">%%addField table="User" name="id" title="ç”¨æˆ· id" type="Long" primaryKey="true" notNull="true"%%</span><br><span class="line">%%addField table="User" name="name" title="ç”¨æˆ·å" type="String" notNull="true"%%</span><br><span class="line">%%addField table="User" name="avatar" title="å¤´åƒ" type="String" %%</span><br><span class="line">%%addField table="User" name="home" title="ä¸»é¡µ" type="String" %%</span><br><span class="line"></span><br><span class="line">%%addField table="Address" name="id" title="åœ°å€ id" type="Long" primaryKey="true" notNull="true"%%</span><br><span class="line">%%addField table="Address" name="userId" title="ç”¨æˆ·å¼•ç”¨" type="Reference" reference="User.id" referenceCardinality="ManyToOne" notNull="true"%%</span><br><span class="line">%%addField table="Address" name="street" title="è¡—é“" type="String" notNull="true"%%</span><br><span class="line">%%addField table="Address" name="city" title="åŸå¸‚" type="String" notNull="true"%%</span><br><span class="line">%%addField table="Address" name="state" title="å·" type="String" notNull="true"%%</span><br><span class="line">%%addField table="Address" name="country" title="å›½å®¶" type="String" notNull="true"%%</span><br><span class="line">"""</span><br><span class="line">explain: create User and Address Table, User has many Address, Address belongs to User, so Address to User is ManyToOne.</span><br><span class="line"></span><br><span class="line"><span class="section">#### END of DEMO 1</span></span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line"><span class="section">#### START OF DEMO 2</span></span><br><span class="line"></span><br><span class="line">Given tables:</span><br><span class="line"></span><br><span class="line">"""</span><br><span class="line">Table A (</span><br><span class="line">foo: Long;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">Table B (</span><br><span class="line">bar: Long;</span><br><span class="line">)</span><br><span class="line">"""</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">USER: """ä¿®æ”¹ A çš„ foo æ ‡é¢˜ä¸ºç”¨æˆ·å”¯ä¸€æ ‡è¯†"""</span><br><span class="line">ASSISTANT: """</span><br><span class="line">%%updateField table="A" name="foo" title="ç”¨æˆ·å”¯ä¸€æ ‡è¯†" %%</span><br><span class="line">"""</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">USER: """å°† B é‡å‘½åä¸ºè´¦å·"""</span><br><span class="line">ASSISTANT: """</span><br><span class="line">%%updateTable name="B" title="è´¦å·"%%</span><br><span class="line">%%renameTable name="B" newName="Account"%%</span><br><span class="line">"""</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">USER: """å°†æ‰€æœ‰è¡¨ä¸‹çš„æ‰€æœ‰å±æ€§åç§°éƒ½åŠ ä¸Š o å‰ç¼€"""</span><br><span class="line">ASSISTANT: """</span><br><span class="line">%%renameField table="A" name="foo" newName="oFoo" %%</span><br><span class="line">%%renameField table="B" name="bar" newName="oBar" %%</span><br><span class="line">"""</span><br><span class="line">explain: rename all fields in given tables</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">USER: """åˆ é™¤ C"""</span><br><span class="line">ASSISTANT: """C ä¸å­˜åœ¨ï¼Œæ— æ³•åˆ é™¤"""</span><br><span class="line">explain: If the manipulated table is not in 'Given tables'</span><br><span class="line"></span><br><span class="line"><span class="section">#### END of DEMO 2</span></span><br><span class="line"></span><br><span class="line"><span class="section">#### START OF DEMO 3</span></span><br><span class="line"></span><br><span class="line">Given tables:</span><br><span class="line">"""</span><br><span class="line"></span><br><span class="line"><span class="section"># ç”¨æˆ·</span></span><br><span class="line"></span><br><span class="line">Table User (</span><br><span class="line">id: Long, PrimaryKey;</span><br><span class="line">name: String;</span><br><span class="line">age: String;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">"""</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">USER: """å®Œå–„å’Œä¼˜åŒ–ç”¨æˆ·"""</span><br><span class="line">ASSISTANT: """</span><br><span class="line">%%addField table="User" name="avatar" title="å¤´åƒ" type="String" %%</span><br><span class="line">%%addField table="User" name="home" title="ä¸»é¡µ" type="String" %%</span><br><span class="line">%%addField table="User" name="password" title="å¯†ç " type="String" notNull="true" %%</span><br><span class="line">"""</span><br><span class="line">explain: improve User Table</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">USER: """åˆ›å»ºåœ°å€è¡¨"""</span><br><span class="line">ASSISTANT: """</span><br><span class="line">%%createTable name="Address" title="åœ°å€"%%</span><br><span class="line">%%addField table="Address" name="id" title="åœ°å€ id" type="Long" primaryKey="true" notNull="true"%%</span><br><span class="line">%%addField table="Address" name="street" title="è¡—é“" type="String" notNull="true"%%</span><br><span class="line">%%addField table="Address" name="city" title="åŸå¸‚" type="String" notNull="true"%%</span><br><span class="line">%%addField table="Address" name="state" title="å·" type="String" notNull="true"%%</span><br><span class="line">%%addField table="Address" name="country" title="å›½å®¶" type="String" notNull="true"%%</span><br><span class="line">"""</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line"><span class="section">#### END of DEMO 3</span></span><br><span class="line"></span><br><span class="line">Ok, FORGET the DEMO given tables above, let's start the new game</span><br><span class="line"></span><br><span class="line"><span class="section">#### START GAME</span></span><br><span class="line"></span><br><span class="line">Given Tables:</span><br><span class="line"></span><br><span class="line">$&#123;tables ?? '[not table here]'&#125;</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">USER: """$&#123;input&#125;"""</span><br><span class="line">ASSISTANT: """</span><br></pre></td></tr></table></figure><p><br></p><p>è¿™äº›ç¤ºä¾‹è¦†ç›–äº†å¾ˆå¤šåœºæ™¯ï¼š</p><ul><li>æ•°æ®æ¨¡å‹ä¸ºç©ºæ—¶ã€‚å„ç§å®‰å…¨æ€§çš„æ£€æŸ¥</li><li>è¡¨ç»“æ„ã€å…³è”å…³ç³»çš„æ¨å¯¼</li><li>è¡¨ç»“æ„çš„å¢åˆ æ”¹</li><li>è¾“å‡ºçš„æ ¼å¼</li><li>â€¦</li></ul><p><br><br><br></p><p>ä½ å¯èƒ½æœ‰è¿™äº›ç–‘é—®ï¼š</p><p><strong>ä¸ºä»€ä¹ˆéœ€è¦è¿™ä¹ˆå¤šç¤ºä¾‹ï¼Ÿ</strong></p><p>è¿™äº›ç¤ºä¾‹åªæ˜¯è¦†ç›–äº†å„ç§å·²çŸ¥çš„äº¤äº’åœºæ™¯ï¼Œå¦‚æœæ²¡æœ‰ç»™ ChatGPT æä¾›ç›¸å…³çš„ç¤ºä¾‹ï¼Œå®ƒå¹¶ä¸çŸ¥é“æ€ä¹ˆå¤„ç†æˆ–è€…å¤„ç†æ•ˆæœä¸å¥½ã€‚æœªæ¥éšç€æ›´å¤šåœºæ™¯è¢«æ‰©å±•ï¼Œ ç¤ºä¾‹ä¼šè¶Šæ¥è¶Šå¤šã€‚</p><p><br><br><br></p><p>ä¸ºä»€ä¹ˆä½¿ç”¨ <code>%%&lt;&gt;%%</code> è¿™ç§æ ¼å¼ï¼Œè€Œä¸æ˜¯ JSONï¼Ÿ</p><p>ChatGPT å¾ˆâ€˜ä»»æ€§â€™ï¼Œ å®ƒä¸ä¸€å®šå¬ä½ è¯ï¼Œåªè¿”å› JSONã€‚è€Œä¸”æˆ‘ä»¬å¯èƒ½éœ€è¦ç­‰å¾…æ‰€æœ‰æ¶ˆæ¯æ¥æ”¶å®Œæ¯•ä¹‹åæ‰èƒ½å¼€å§‹å¤„ç†ï¼Œ%%&lt;&gt;%% åˆ™èƒ½ä»¥æµçš„å½¢å¼ä¸€è¾¹æ¥æ”¶ä¸€è¾¹å¤„ç†ã€‚æœ€åå°±æ˜¯å®ƒçš„ç»“æ„æ›´å®¹æ˜“æè¿°</p><p><br><br><br></p><p><img src="/images/ai-build-er/Untitled%202.png" alt="Untitled"></p><p><strong>Prompt è¿™ä¹ˆé•¿ï¼ŸToken å¤Ÿå—ï¼Ÿ</strong></p><p>è¿™ä¸ªç‰ˆæœ¬çš„ Prompt åœ¨æ²¡æœ‰ç®—ä¸Šæ•°æ®æ¨¡å‹ä¸Šä¸‹æ–‡çš„æƒ…å†µä¸‹ï¼Œå·²ç»è¾¾åˆ° 2000+ token äº†ã€‚å¥½åœ¨ç°åœ¨ GPT 3.5 æœ‰ 16k ç‰ˆæœ¬ï¼ŒGPT 4 æœ€å°‘ä¹Ÿæœ‰ 8k, æ˜¯å¤Ÿç”¨çš„ã€‚å½“ç„¶ GPT4 æœ‰ç‚¹å°è´µ</p><p><br><br><br><br><br></p><p>æ‰§è¡Œæ•ˆæœï¼š</p><p><img src="/images/ai-build-er/Untitled%203.png" alt="Untitled"></p><p>è¿™é‡Œå‘ç°äº†ä¸€ä¸ªæœ‰è¶£çš„æƒ³è±¡ï¼ŒChatGPT æ¨¡ä»¿æˆ‘ä»¬çš„ç¤ºä¾‹å¥—è·¯(USERã€ASSISTANT)ï¼Œç»§ç»­é‡å¤è¾“å‡ºäº†å¾ˆå¤šå†…å®¹ã€‚<strong>è¿™å®é”¤ ChatGPT å°±æ˜¯å¤è¯»æœºäº†</strong>ã€‚</p><p>é€šè¿‡åå¤çš„è°ƒè¯•ï¼Œä½ ä¼šå‘ç°ï¼Œæˆ‘ä»¬åœ¨ä¸€å¼€å§‹å®šä¹‰çš„â€éœ€æ±‚è§„åˆ™â€ å¯¹ ChatGPT çš„å½±å“å¾®ä¹å…¶å¾®ï¼Œç”šè‡³ä¼šç›´æ¥å¿½ç•¥å®ƒä»¬ã€‚<strong>å®ƒæ›´å¤šæ˜¯ä»ç¤ºä¾‹ä¸­å­¦ä¹ è§„å¾‹</strong>ã€‚</p><p>é‚£æ€ä¹ˆé¿å…è¿™ç§é‡å¤å‘¢ï¼Ÿå¯ä»¥é€šè¿‡ ChatGPT API çš„ <code>stop</code> å‚æ•°æ¥å‘Šè¯‰å®ƒä»€ä¹ˆæ—¶å€™ç»ˆæ­¢ã€‚è¿™é‡Œæˆ‘ä»¬è®¾ç½®ä¸º <code>&quot;&quot;&quot;</code> å³å¯ã€‚</p><p><br><br><br><br><br></p><h1 id="æ€ç»´é“¾"><a href="#æ€ç»´é“¾" class="headerlink" title="æ€ç»´é“¾"></a>æ€ç»´é“¾</h1><p>ä¸Šé¢çš„ Prompt è¿˜æœ‰ä¸€äº›ç¼ºé™·ã€‚æˆ‘ä»¬å‘ç° ChatGPT å°±æ˜¯ä¸€ä¸ªå¤è¯»æœºï¼ŒåŸºæœ¬ä¸Šåªä¼šç…§æ¬æˆ‘ä»¬çš„ç¤ºä¾‹ã€‚ä¸»è¦çš„åŸå› æ˜¯ ChatGPT åªçŸ¥é“ç»“æœï¼Œè€Œä¸çŸ¥é“è¿‡ç¨‹ï¼Œæ‰€ä»¥æ¨ç†èƒ½åŠ›å°±æ¯”è¾ƒæœ‰é™ã€‚</p><p>å› æ­¤æˆ‘ä»¬å°±éœ€è¦å¼•å…¥ Few-shot Prompt çš„è¿›é˜¶æŠ€å·§ â€”â€” <strong><a href="https://learningprompt.wiki/docs/chatGPT/tutorial-tips/%E6%8A%80%E5%B7%A78%EF%BC%9AFew-Shot%20Chain%20of%20Thought" target="_blank" rel="noopener">Few-Shot Chain of Thought</a>ï¼š</strong></p><p><br></p><blockquote><p>é€šè¿‡å‘å¤§è¯­è¨€æ¨¡å‹å±•ç¤ºä¸€äº›å°‘é‡çš„æ ·ä¾‹ï¼Œå¹¶åœ¨æ ·ä¾‹ä¸­è§£é‡Šæ¨ç†è¿‡ç¨‹ï¼Œå¤§è¯­è¨€æ¨¡å‹åœ¨å›ç­”æç¤ºæ—¶ä¹Ÿä¼šæ˜¾ç¤ºæ¨ç†è¿‡ç¨‹ã€‚è¿™ç§æ¨ç†çš„è§£é‡Šå¾€å¾€ä¼šå¼•å¯¼å‡ºæ›´å‡†ç¡®çš„ç»“æœã€‚</p></blockquote><p><br><br><br></p><p>ç»§ç»­é‡æ„å’Œæ”¹è¿›ï¼š</p><figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">You are an expert in the conceptual design of relational databases, and you need to parse the user's input according to the following steps, and then convert it into a series of operation tasks.</span><br><span class="line"></span><br><span class="line">Step 1: Analyze which tables need to be created. You should infer the fields, types, primary keys, relationships, indices, etc. of the table.</span><br><span class="line">Step 2: Analyze which tables need to be deleted.</span><br><span class="line">Step 3: Analyze which tables need to be updated, including adding fields, deleting fields, modifying field types, modifying field names, etc.</span><br><span class="line">Step 4: Analyze unsafe operations, such as repeated creation, deletion of non-existent tables, modification of non-existent tables, modification of non-existent fields, deletion of non-existent fields, etc. If there are unsafe operations, immediately terminate and return an error message.</span><br><span class="line">Step 5: Convert the analysis results into the form of %%<span class="xml"><span class="tag">&lt;<span class="name">action</span>&gt;</span></span> <span class="xml"><span class="tag">&lt;<span class="name">key</span>&gt;</span></span>="<span class="xml"><span class="tag">&lt;<span class="name">value</span>&gt;</span></span>"%% to return, and the action structure must conform to the defined Action type:</span><br><span class="line"></span><br><span class="line">\<span class="code">`\`</span>\`typescript</span><br><span class="line">type Action = CreateTable | UpdateTable | RemoveTable | AddField | RemoveField | updateField | RenameField;</span><br><span class="line"></span><br><span class="line">type CreateTable = &#123;</span><br><span class="line">action: 'createTable';</span><br><span class="line">name: string; // table name in upper camel case</span><br><span class="line">title: string; // table name in chinese</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">type UpdateTable = &#123;</span><br><span class="line">action: 'updateTable';</span><br><span class="line">name: string; // table name in upper camel case</span><br><span class="line">title: string; // table name in chinese</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">type RemoveTable = &#123;</span><br><span class="line">action: 'removeTable';</span><br><span class="line">name: string;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">type FieldType =</span><br><span class="line">| 'Boolean'</span><br><span class="line">| 'Data'</span><br><span class="line">| 'DateTime'</span><br><span class="line">| 'Timestamp'</span><br><span class="line">| 'Integer'</span><br><span class="line">| 'Decimal'</span><br><span class="line">| 'Long'</span><br><span class="line">| 'Double'</span><br><span class="line">| 'Float'</span><br><span class="line">| 'String'</span><br><span class="line">| 'Text'</span><br><span class="line">| 'LongText'</span><br><span class="line">| 'JSON'</span><br><span class="line">| 'Reference';</span><br><span class="line">type ReferenceCardinality = 'OneToOne' | 'OneToMany' | 'ManyToOne' | 'ManyToMany';</span><br><span class="line"></span><br><span class="line">type AddField = &#123;</span><br><span class="line">action: 'addField';</span><br><span class="line">table: string; // table name</span><br><span class="line">name: string; // field name in lower camel case</span><br><span class="line">title: string; // field name in chinese</span><br><span class="line">type: FieldType;</span><br><span class="line">reference?: string; // reference to other table field, for example: Table.field</span><br><span class="line">referenceCardinality?: ReferenceCardinality;</span><br><span class="line">primaryKey?: boolean;</span><br><span class="line">notNull?: boolean;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">type RemoveField = &#123;</span><br><span class="line">action: 'removeField';</span><br><span class="line">table: string; // table name</span><br><span class="line">name: string; // field name</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">type updateField = &#123;</span><br><span class="line">action: 'updateField';</span><br><span class="line">table: string; // table name</span><br><span class="line">name: string; // field name in lower camel case</span><br><span class="line">title?: string; // field name in chinese</span><br><span class="line">type?: FieldType;</span><br><span class="line">reference?: string; // reference to other table field, for example: Table.field</span><br><span class="line">referenceCardinality?: ReferenceCardinality;</span><br><span class="line">primaryKey?: boolean;</span><br><span class="line">notNull?: boolean;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">type RenameField = &#123;</span><br><span class="line">action: 'renameField';</span><br><span class="line">table: string; // table name</span><br><span class="line">name: string; // field name in lower camel case</span><br><span class="line">newName: string; // new field name in lower camel case</span><br><span class="line">&#125;;</span><br><span class="line">\<span class="code">`\`</span>\`</span><br><span class="line"></span><br><span class="line">---</span><br></pre></td></tr></table></figure><p><br><br><br></p><p>ä¸Šé¢çš„ Prompt åšäº†ä»¥ä¸‹å‡ ç‚¹æ”¹è¿›ï¼š</p><p><br></p><ul><li>æˆ‘ä»¬æ‹†è§£äº†æ•´ä¸ªæ¨å¯¼çš„è¿‡ç¨‹ï¼š<ul><li>ç¬¬ä¸€æ­¥ï¼šè¯†åˆ«éœ€è¦åˆ›å»ºçš„è¡¨æ ¼ï¼Œä»¥åŠå¯¹åº”çš„å­—æ®µã€å­—æ®µç±»å‹ã€ä¸»é”®ã€å…³è”å…³ç³»ç­‰ç­‰</li><li>ç¬¬äºŒæ­¥ï¼šè¯†åˆ«éœ€è¦åˆ é™¤çš„è¡¨æ ¼</li><li>ç¬¬ä¸‰æ­¥ï¼šè¯†åˆ«éœ€è¦æ›´æ–°çš„å­—æ®µ</li><li>ç¬¬å››æ­¥ï¼šè¯†åˆ«ä¸å®‰å…¨çš„æ“ä½œï¼Œå¦‚æœå­˜åœ¨ä¸å®‰å…¨çš„æ“ä½œå°±ç»ˆæ­¢ç”Ÿæˆ</li><li>ç¬¬äº”æ­¥ï¼šå°†ä¸Šé¢çš„ç»“æœè½¬æ¢ä¸º DSLã€‚</li></ul></li><li>æˆ‘ä»¬ä½¿ç”¨ Typescript æ¥æè¿° DSL çš„ Schemaã€‚æˆ‘åœ¨ä¸Šä¸€ç¯‡æ–‡ç« *<strong>*<a href="https://juejin.cn/post/7259188522308550716" target="_blank" rel="noopener">AI è°ƒæ•™å¸ˆï¼šèŠèŠ TypeChat ä»¥åŠ ChatGPT å½¢å¼åŒ–è¾“å‡º</a></strong> å¤§æ¦‚ä»‹ç»è¿‡ ChatGPT çš„å½¢å¼åŒ–è¾“å‡ºèƒ½åŠ›ã€‚ChatGPT å¯èƒ½å¾ˆå¥½åœ°è¯†åˆ« Typescript</li></ul><p><br><br><br></p><p>æ¥ç€æˆ‘ä»¬å†ä¼˜åŒ–ç¤ºä¾‹ï¼ŒåŠ ä¸Šä¸Šè¿°çš„æ¨å¯¼æ­¥éª¤ï¼š</p><figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">Here is same demo:</span><br><span class="line"></span><br><span class="line"><span class="section">#### START OF DEMO 1</span></span><br><span class="line"></span><br><span class="line">Given Tables:</span><br><span class="line"></span><br><span class="line">"""</span><br><span class="line">[not table here]</span><br><span class="line">"""</span><br><span class="line"></span><br><span class="line">USER: """åˆ é™¤è®¢å•è¡¨"""</span><br><span class="line">ASSISTANT: """</span><br><span class="line">step 1: ä¸éœ€è¦åˆ›å»ºè¡¨</span><br><span class="line">step 2: åˆ é™¤è®¢å•è¡¨</span><br><span class="line">step 3: ä¸éœ€è¦æ›´æ–°è¡¨</span><br><span class="line">step 4: æœªå®šä¹‰ä»»ä½•è¡¨ï¼Œè®¢å•è¡¨ä¸å­˜åœ¨, ç»ˆæ­¢</span><br><span class="line"></span><br><span class="line">ç»“æœ: ä¸èƒ½åˆ é™¤è®¢å•è¡¨, è®¢å•è¡¨ä¸å­˜åœ¨</span><br><span class="line">"""</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">USER: """ç»™æ‰€æœ‰è¡¨éƒ½åŠ ä¸Šæ›´æ–°æ—¶é—´å’Œåˆ›å»ºæ—¶é—´"""</span><br><span class="line">ASSISTANT: """</span><br><span class="line">step 1: ä¸éœ€è¦åˆ›å»ºè¡¨</span><br><span class="line">step 2: ä¸éœ€è¦åˆ é™¤è¡¨</span><br><span class="line">step 3: ä¸å­˜åœ¨è¡¨ï¼Œä¸éœ€è¦æ›´æ–°æ“ä½œ</span><br><span class="line">step 4: æœªå®šä¹‰ä»»ä½•è¡¨, æ²¡æœ‰å¯ä»¥æ›´æ–°çš„è¡¨ï¼Œç»ˆæ­¢</span><br><span class="line"></span><br><span class="line">ç»“æœï¼šä¸å­˜åœ¨è¡¨ï¼Œæ— æ³•æ·»åŠ å­—æ®µ</span><br><span class="line">"""</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">USER:"""åˆ›å»ºä¸€ä¸ªç”¨æˆ·, è¿™ä¸ªç”¨æˆ·æœ‰å¤šä¸ªåœ°å€"""</span><br><span class="line">ASSISTANT: """</span><br><span class="line">step 1: éœ€è¦åˆ›å»ºç”¨æˆ·è¡¨å’Œåœ°å€è¡¨, ç”¨æˆ·å’Œåœ°å€æ˜¯ä¸€å¯¹å¤šå…³ç³»ï¼Œæ‰€ä»¥åœ°å€è¡¨éœ€è¦æœ‰ä¸€ä¸ªç”¨æˆ·å¼•ç”¨å­—æ®µã€‚æ¨æ–­ç”¨æˆ·è¡¨åº”è¯¥åŒ…å« idã€nameã€avatarã€home å­—æ®µï¼Œåœ°å€è¡¨åº”è¯¥åŒ…å« idã€userIdã€streetã€cityã€stateã€country å­—æ®µã€‚</span><br><span class="line">step 2: ä¸éœ€è¦åˆ é™¤è¡¨</span><br><span class="line">step 3: ä¸éœ€è¦æ›´æ–°è¡¨</span><br><span class="line">step 4: æ“ä½œå®‰å…¨</span><br><span class="line">step 5: è¾“å‡ºç»“æœ</span><br><span class="line"></span><br><span class="line">%%createTable name="User" title="ç”¨æˆ·"%%</span><br><span class="line">%%createTable name="Address" title="åœ°å€"%%</span><br><span class="line"></span><br><span class="line">%%addField table="User" name="id" title="ç”¨æˆ· id" type="Long" primaryKey="true" notNull="true"%%</span><br><span class="line">%%addField table="User" name="name" title="ç”¨æˆ·å" type="String" notNull="true"%%</span><br><span class="line">%%addField table="User" name="avatar" title="å¤´åƒ" type="String" %%</span><br><span class="line">%%addField table="User" name="home" title="ä¸»é¡µ" type="String" %%</span><br><span class="line"></span><br><span class="line">%%addField table="Address" name="id" title="åœ°å€ id" type="Long" primaryKey="true" notNull="true"%%</span><br><span class="line">%%addField table="Address" name="userId" title="ç”¨æˆ·å¼•ç”¨" type="Reference" reference="User.id" referenceCardinality="ManyToOne" notNull="true"%%</span><br><span class="line">%%addField table="Address" name="street" title="è¡—é“" type="String" notNull="true"%%</span><br><span class="line">%%addField table="Address" name="city" title="åŸå¸‚" type="String" notNull="true"%%</span><br><span class="line">%%addField table="Address" name="state" title="å·" type="String" notNull="true"%%</span><br><span class="line">%%addField table="Address" name="country" title="å›½å®¶" type="String" notNull="true"%%</span><br><span class="line">"""</span><br><span class="line"></span><br><span class="line"><span class="section">#### END of DEMO 1</span></span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line"><span class="section">#### START OF DEMO 2</span></span><br><span class="line"></span><br><span class="line">Given tables:</span><br><span class="line"></span><br><span class="line">"""</span><br><span class="line">Table A (</span><br><span class="line">foo: Long;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">Table B (</span><br><span class="line">bar: Long;</span><br><span class="line">)</span><br><span class="line">"""</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">USER: """ä¿®æ”¹ A çš„ foo æ ‡é¢˜ä¸ºç”¨æˆ·å”¯ä¸€æ ‡è¯†"""</span><br><span class="line">ASSISTANT: """</span><br><span class="line">step 1: ä¸éœ€è¦åˆ›å»ºè¡¨</span><br><span class="line">step 2: ä¸éœ€è¦åˆ é™¤è¡¨</span><br><span class="line">step 3: æ›´æ–° A è¡¨çš„ foo å­—æ®µçš„ title ä¸º 'ç”¨æˆ·å”¯ä¸€æ ‡è¯†'</span><br><span class="line">step 4: æ“ä½œå®‰å…¨</span><br><span class="line">step 5: è¾“å‡ºç»“æœ</span><br><span class="line"></span><br><span class="line">%%updateField table="A" name="foo" title="ç”¨æˆ·å”¯ä¸€æ ‡è¯†" %%</span><br><span class="line">"""</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">USER: """å°† B é‡å‘½åä¸ºè´¦å·"""</span><br><span class="line">ASSISTANT: """</span><br><span class="line">step 1: ä¸éœ€è¦åˆ›å»ºè¡¨</span><br><span class="line">step 2: ä¸éœ€è¦åˆ é™¤è¡¨</span><br><span class="line">step 3: æ›´æ–° B è¡¨çš„ name ä¸º 'Account', title ä¸º 'è´¦å·'</span><br><span class="line">step 4: æ“ä½œå®‰å…¨</span><br><span class="line">step 5: è¾“å‡ºç»“æœ</span><br><span class="line"></span><br><span class="line">%%updateTable name="B" title="è´¦å·"%%</span><br><span class="line">%%renameTable name="B" newName="Account"%%</span><br><span class="line">"""</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">USER: """å°†æ‰€æœ‰è¡¨ä¸‹çš„æ‰€æœ‰å±æ€§åç§°éƒ½åŠ ä¸Š o å‰ç¼€"""</span><br><span class="line">ASSISTANT: """</span><br><span class="line">step 1: ä¸éœ€è¦åˆ›å»ºè¡¨</span><br><span class="line">step 2: ä¸éœ€è¦åˆ é™¤è¡¨</span><br><span class="line">step 3: æ›´æ–° A è¡¨çš„ foo å­—æ®µçš„ name ä¸º 'oFoo', B è¡¨çš„ bar å­—æ®µçš„ name ä¸º 'oBar'</span><br><span class="line">step 4: æ“ä½œå®‰å…¨</span><br><span class="line">step 5: è¾“å‡ºç»“æœ</span><br><span class="line"></span><br><span class="line">%%renameField table="A" name="foo" newName="oFoo" %%</span><br><span class="line">%%renameField table="B" name="bar" newName="oBar" %%</span><br><span class="line">"""</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">USER: """åˆ é™¤ A çš„ bar å­—æ®µ"""</span><br><span class="line">ASSISTANT: """</span><br><span class="line">step 1: ä¸éœ€è¦åˆ›å»ºè¡¨</span><br><span class="line">step 2: ä¸éœ€è¦åˆ é™¤è¡¨</span><br><span class="line">step 3: åˆ é™¤ A è¡¨çš„ bar å­—æ®µ</span><br><span class="line">step 4: A è¡¨ä¸å­˜åœ¨ bar å­—æ®µï¼Œç»ˆæ­¢</span><br><span class="line"></span><br><span class="line">ç»“æœï¼š A è¡¨ä¸å­˜åœ¨ bar å­—æ®µï¼Œæ— æ³•åˆ é™¤</span><br><span class="line">"""</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">USER: """åˆ é™¤ C"""</span><br><span class="line">ASSISTANT: """</span><br><span class="line">step 1: ä¸éœ€è¦åˆ›å»ºè¡¨</span><br><span class="line">step 2: åˆ é™¤ C è¡¨</span><br><span class="line">step 3: ä¸éœ€è¦æ›´æ–°è¡¨</span><br><span class="line">step 4: C ä¸å­˜åœ¨ï¼Œç»ˆæ­¢</span><br><span class="line"></span><br><span class="line">ç»“æœï¼š C ä¸å­˜åœ¨ï¼Œæ— æ³•åˆ é™¤</span><br><span class="line">"""</span><br><span class="line"></span><br><span class="line"><span class="section">#### END of DEMO 2</span></span><br><span class="line"></span><br><span class="line"><span class="section">#### START OF DEMO 3</span></span><br><span class="line"></span><br><span class="line">Given tables:</span><br><span class="line"></span><br><span class="line">"""</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="section"># ç”¨æˆ·</span></span><br><span class="line"></span><br><span class="line">Table User (</span><br><span class="line">id: Long, PrimaryKey;</span><br><span class="line">name: String;</span><br><span class="line">age: String;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">"""</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">USER: """å®Œå–„å’Œä¼˜åŒ–ç”¨æˆ·"""</span><br><span class="line">ASSISTANT: """</span><br><span class="line">step 1: User å·²å­˜åœ¨ï¼Œä¸éœ€è¦åˆ›å»ºè¡¨, æ‰©å±• User è¡¨ï¼Œå¢åŠ  avatarã€homeã€password å­—æ®µ</span><br><span class="line">step 2: ä¸éœ€è¦åˆ é™¤è¡¨</span><br><span class="line">step 3: ä¸éœ€è¦æ›´æ–°è¡¨</span><br><span class="line">step 4: æ“ä½œå®‰å…¨</span><br><span class="line">step 5: è¾“å‡ºç»“æœ</span><br><span class="line"></span><br><span class="line">%%addField table="User" name="avatar" title="å¤´åƒ" type="String" %%</span><br><span class="line">%%addField table="User" name="home" title="ä¸»é¡µ" type="String" %%</span><br><span class="line">%%addField table="User" name="password" title="å¯†ç " type="String" notNull="true" %%</span><br><span class="line">"""</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">USER: """åˆ›å»ºåœ°å€è¡¨"""</span><br><span class="line">ASSISTANT: """</span><br><span class="line">step 1: åˆ›å»ºåœ°å€è¡¨ï¼Œæ¨æ–­å¢åŠ  idã€streetã€cityã€stateã€country å­—æ®µ</span><br><span class="line">step 2: ä¸éœ€è¦åˆ é™¤è¡¨</span><br><span class="line">step 3: ä¸éœ€è¦æ›´æ–°è¡¨</span><br><span class="line">step 4: æ“ä½œå®‰å…¨</span><br><span class="line">step 5: è¾“å‡ºç»“æœ</span><br><span class="line"></span><br><span class="line">%%createTable name="Address" title="åœ°å€"%%</span><br><span class="line">%%addField table="Address" name="id" title="åœ°å€ id" type="Long" primaryKey="true" notNull="true"%%</span><br><span class="line">%%addField table="Address" name="street" title="è¡—é“" type="String" notNull="true"%%</span><br><span class="line">%%addField table="Address" name="city" title="åŸå¸‚" type="String" notNull="true"%%</span><br><span class="line">%%addField table="Address" name="state" title="å·" type="String" notNull="true"%%</span><br><span class="line">%%addField table="Address" name="country" title="å›½å®¶" type="String" notNull="true"%%</span><br><span class="line">"""</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line"><span class="section">#### END of DEMO 3</span></span><br><span class="line"></span><br><span class="line">Ok, FORGET the DEMO given tables above, let's start the new game</span><br><span class="line"></span><br><span class="line"><span class="section">#### START GAME</span></span><br><span class="line"></span><br><span class="line">Given Tables:</span><br><span class="line"></span><br><span class="line">$&#123;tables ?? '[not table here]'&#125;</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">USER: """$&#123;input&#125;"""</span><br><span class="line">ASSISTANT: """</span><br></pre></td></tr></table></figure><p><br><br><br></p><p>è¿è¡Œç»“æœï¼š</p><p><img src="/images/ai-build-er/Untitled%204.png" alt=" GPT 3.5"></p><p>GPT 3.5</p><p><br><br><br></p><p><img src="/images/ai-build-er/Untitled%205.png" alt="GPT 4"></p><p>GPT 4</p><p><br><br><br><br><br></p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>åŠ å…¥äº†æ€ç»´é“¾(Chain of Thought) ä¹‹åï¼Œç»“æœç›¸å¯¹æ›´å¯æ§äº†ã€‚ä½†æ˜¯è¿˜æ˜¯ä¸å¤Ÿå®Œç¾ï¼Œç°åœ¨è¿˜æœ‰ä»¥ä¸‹é—®é¢˜ï¼š</p><ul><li>Token å ç”¨è¿‡å¤§ã€‚å°½ç®¡æˆ‘ä»¬å¯ä»¥é€‰æ‹©æ”¯æŒæ›´å¤§ Token çš„æ¨¡å‹ï¼Œç„¶è€Œæˆ‘ä»¬è¿˜è¦è€ƒè™‘æœªæ¥ä¸ºæ›´å¤šåœºæ™¯çš„åŠ å…¥ç¤ºä¾‹ã€å¯¹è¯å†å²éœ€è¦é¢„ç•™çš„ç©ºé—´ï¼Œè¿˜æœ‰å°±æ˜¯æˆæœ¬é—®é¢˜ã€‚</li><li>ä¸æ”¯æŒå¤šè½®å¯¹è¯æˆ–è€…ç”¨æˆ·çº æ­£æœºåˆ¶ã€‚è¿™ä¸ªéœ€è¦ä»äº¤äº’ä¸Šè¿›è¡Œä¼˜åŒ–ï¼Œæ¯”å¦‚æä¾›æ‰§è¡Œç¡®å®šï¼Œé‡æ–°ç”Ÿæˆç­‰ç­‰</li><li>å›ç­”æ•ˆæœè¿˜æœ‰å¾…ä¼˜åŒ–ã€‚å¹¶æ²¡æœ‰å‘æŒ¥å‡º ChatGPT å¼ºå¤§çš„è”æƒ³èƒ½åŠ›ï¼Œå…¶å®è¿™æ˜¯ä¸€ä»¶æŒºçŸ›ç›¾çš„äº‹æƒ…ï¼Œç¤ºä¾‹ä¸å¤Ÿï¼ŒGPT è¾“å‡ºçš„ç»“æœå¯èƒ½ä¸ç¬¦åˆè¦æ±‚ï¼Œå¤šäº†æœ‰å¯èƒ½æŠ‘åˆ¶å®ƒçš„ã€Œåˆ›é€ æ€§ã€ï¼Ÿ</li></ul><p><br><br><br></p><p>æˆ‘è§‰å¾—åé¢è¿˜æœ‰è¿™äº›ä¼˜åŒ–çš„æ–¹å‘ï¼š</p><ol><li><p>è½¬æ¢ä¸ºå¤šæ­¥éª¤ Prompt(<code>multi-step Prompt</code>)ã€‚å…¸å‹çš„ä¾‹å­å¯ä»¥çœ‹ OpenAI å®˜æ–¹çš„ <a href="https://github.com/openai/openai-cookbook/blob/main/examples/Unit_test_writing_using_a_multi-step_prompt.ipynb" target="_blank" rel="noopener">Unit test writing using a multi-step prompt</a> ã€‚æˆ‘ä»¬ä¸Šæ–‡çš„ä¾‹å­å°±æ˜¯å¤§é”…ç‚–ï¼Œå…¶å®è¿˜å¯ä»¥ç»§ç»­æ‹†è§£å’Œå¼•å¯¼ ChatGPT å±•å¼€ç»†èŠ‚ã€‚æ¯”å¦‚å•å…ƒæµ‹è¯•å°±æ‹†è§£äº†ä¸‰ä¸ªæ­¥éª¤ï¼š</p><ol><li><strong>Explain(è§£é‡Š)</strong>: ç»™ä¸€ä¸ª Python å‡½æ•°ï¼Œè®© GPT è§£é‡Šå®ƒåšäº†ä»€ä¹ˆï¼Œä¸ºä»€ä¹ˆè¿™ä¹ˆåš.</li><li><strong>Plan(è®¡åˆ’)</strong>: è®© GPT åˆ—ä¸¾é’ˆå¯¹è¿™ä¸ªå‡½æ•°å•å…ƒæµ‹è¯•çš„è®¡åˆ’ã€‚å¦‚æœè¿™ä¸ªè®¡åˆ’å¤ªçŸ­ï¼Œæˆ‘ä»¬å°±è¯· GPT è¿›ä¸€æ­¥é˜è¿°æ›´å¤šå•å…ƒæµ‹è¯•çš„æ€è·¯</li><li><strong>Execute(æ‰§è¡Œ)</strong>: æœ€åï¼Œè®© GPT å°†ä¸Šè¿°è®¡åˆ’çš„ç”¨ä¾‹è½¬æ¢ä¸ºå•å…ƒæµ‹è¯•</li></ol><p>åŒç†ï¼Œè¿™äº›æ€è·¯ä¹Ÿå¯ä»¥ç”¨åœ¨æˆ‘ä»¬çš„ã€Œæ•°æ®å»ºæ¨¡ã€çš„åœºæ™¯</p></li><li><p>æ¨¡å‹å¾®è°ƒ(Fine-tune)ã€‚ä¸Šé¢çš„ Prompt å·²ç»åˆ—ä¸¾äº†è¾ƒå¤šçš„ç¤ºä¾‹ï¼Œå·²ç»å æ®äº†å¾ˆå¤š Token ç©ºé—´ï¼Œå¦‚æœè¦è¾¾åˆ°ç”Ÿäº§å¯ç”¨çš„çº§åˆ«ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ç§¯ç´¯æ›´å¤šçš„æ ·æœ¬ï¼Œå¾®è°ƒå‡ºä¸“ç”¨çš„æ¨¡å‹æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚</p></li><li>ä½¿ç”¨æ›´é«˜çº§çš„æ¨¡å‹ã€‚æ¯”å¦‚ GPT 4 çš„æ•ˆæœä¼šæ¯” 3.5 å¥½ä¸Šå¾ˆå¤š</li></ol><p><br><br><br></p><p>è™½ç„¶è¿˜è¾¾ä¸åˆ°ã€Œç”Ÿäº§å¯ç”¨ã€çš„çº§åˆ«ï¼Œä½†åœ¨è¿™æœŸé—´æˆ‘ä»¬ä¹Ÿæ€»ç»“äº†å¯¹æ¥ AI åˆ°å·²æœ‰ç³»ç»Ÿçš„ä¸€äº›<code>å·¥ä½œæµ</code>ï¼š</p><ul><li>ç¡®å®šéœ€æ±‚ã€‚</li><li>ç³»ç»ŸåŸå­æ“ä½œçš„æ‹†è§£ã€‚æˆ‘ä»¬çš„ä¸»è¦å·¥ä½œå°±æ˜¯è®© AI å°†ç”¨æˆ·çš„è‡ªç„¶è¯­è¨€éœ€æ±‚è½¬æ¢ä¸ºè¿™äº›åŸå­æ“ä½œã€‚</li><li>è®¾è®¡ DSLã€‚è®¾è®¡ AI è¾“å‡ºçš„ DSL å½¢å¼ï¼Œéœ€è¦å…¼é¡¾ AI å’Œå·²æœ‰ç³»ç»Ÿçš„å¤„ç†èƒ½åŠ›</li><li>æ¨ç†è¿‡ç¨‹æ­¥éª¤è®¾è®¡ã€‚è®© AI æ¨¡å‹çŸ¥é“ç»“æœæ˜¯å¦‚ä½•å¾—åˆ°çš„ï¼Œå¯ä»¥æå‡è¾“å‡ºç»“æœçš„å‡†ç¡®æ€§ã€‚</li><li>æä¾›æ¡ˆä¾‹ã€‚æ¡ˆä¾‹è¶Šå¤šï¼Œè¾“å‡ºçš„ç»“æœå°±è¶Šå¯æ§</li><li>è°ƒä¼˜ã€‚è¿™ä¸ªè°ƒè¯•çš„è¿‡ç¨‹å¾ˆéš¾ä¸€æ­¥åˆ°ä½ï¼Œå°±æ˜¯æµ‹è¯•ã€é‡å»ºã€æµ‹è¯•ã€é‡å»ºçš„è¿‡ç¨‹ã€‚è€Œä¸”æˆ‘ä»¬å¾ˆéš¾å¯¹å®ƒè¿›è¡Œå•å…ƒæµ‹è¯•è¯¸å¦‚æ­¤ç±»çš„ã€‚</li></ul><p><br><br><br></p><p>åé¢æˆ‘ä»¬è¿˜ä¼šç»§ç»­ä¼˜åŒ–ï¼Œå¦‚æœè¯»è€…æœ‰æ›´å¥½çš„å»ºè®®è¯·å’Œæˆ‘äº¤æµã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;img src=&quot;/images/ai-build-er/Untitled.png&quot; alt=&quot;Untitled&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/ai-build-er/Untitled.gif&quot; alt=&quot;Untitled&quot;
      
    
    </summary>
    
      <category term="AI" scheme="https://bobi.ink/categories/AI/"/>
    
    
  </entry>
  
  <entry>
    <title>AI è°ƒæ•™å¸ˆï¼šèŠèŠ TypeChat ä»¥åŠChatGPT å½¢å¼åŒ–è¾“å‡º</title>
    <link href="https://bobi.ink/2023/07/24/typechat/"/>
    <id>https://bobi.ink/2023/07/24/typechat/</id>
    <published>2023-07-23T16:00:00.000Z</published>
    <updated>2023-07-24T03:27:27.183Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/images/typechat/Untitled%201.png" alt="Untitled"></p><p>Typescript ä¹‹çˆ¶(å¾®è½¯)åœ¨ 7æœˆ 21 å·å‘å¸ƒäº†ä¸€ä¸ªæœ‰è¶£çš„é¡¹ç›®â€”â€” <code>[Typechat](https://github.com/microsoft/TypeChat)</code>ã€‚<strong>æ—¨åœ¨ä½¿ç”¨ AI æ¥è¿æ¥è‡ªç„¶è¯­è¨€å’Œåº”ç”¨çš„ Schema / API</strong>ã€‚è¯´ç™½è¯å°±æ˜¯ä½¿ç”¨ Typescript ç±»å‹ä¿¡æ¯æ¥çº¦æŸ ChatGPT è¾“å‡ºå†…å®¹çš„ç»“æ„ã€‚</p><p>æˆ‘ä»¬æ—©å·²è§è¯è¿‡ ChatGPT çš„å¼ºå¤§ï¼Œå¦‚æœæƒ³è¦å¯¹æ¥åˆ°æˆ‘ä»¬å·²æœ‰çš„è½¯ä»¶ç³»ç»Ÿï¼Œé€šå¸¸ä¼šè¦æ±‚å®ƒè¾“å‡º JSON è¿™ç±»å½¢å¼åŒ–ã€ç»“æ„åŒ–çš„æ•°æ®ã€‚å¦‚æœä½ è°ƒæ•™è¿‡ ChatGPT å°±ä¼šå‘ç°ï¼Œ å®ƒçš„è¾“å‡ºç»“æœå¾€å¾€æ²¡é‚£ä¹ˆé è°±ã€‚ä¸ºäº†è®©å®ƒè¾“å‡ºç¬¦åˆè¦æ±‚çš„å†…å®¹ï¼Œæˆ‘ä»¬éœ€è¦ç»™å‡ºè¶³å¤Ÿçš„ä¸Šä¸‹æ–‡ä¿¡æ¯å’Œç¤ºä¾‹ï¼Œå¹¶ä¸”è¿™ä¸ªè°ƒæ•™è¿‡ç¨‹ä¹Ÿæ¯”è¾ƒç„å­¦ã€‚</p><p>æœ¬æ–‡å°±æ¥çœ‹çœ‹ Typechat æ˜¯å¦‚ä½•è®© ChatGPT è¾“å‡ºç¬¦åˆéœ€æ±‚çš„å†…å®¹</p><p><br></p><h1 id="chatgpt-çš„èƒ½åŠ›å’Œç¼ºé™·"><a href="#chatgpt-çš„èƒ½åŠ›å’Œç¼ºé™·" class="headerlink" title="ChatGPT çš„èƒ½åŠ›å’Œç¼ºé™·"></a>ChatGPT çš„èƒ½åŠ›å’Œç¼ºé™·</h1><h3 id="chatgpt-çœ‹èµ·æ¥å¾ˆæ“…é•¿å¤„ç†ä»£ç "><a href="#chatgpt-çœ‹èµ·æ¥å¾ˆæ“…é•¿å¤„ç†ä»£ç " class="headerlink" title="ChatGPT çœ‹èµ·æ¥å¾ˆæ“…é•¿å¤„ç†ä»£ç "></a>ChatGPT çœ‹èµ·æ¥å¾ˆæ“…é•¿å¤„ç†ä»£ç </h3><p><img src="/images/typechat/Untitled%202.png" alt="æ‰®æ¼”ä¸€ä¸ª linux ç»ˆç«¯"></p><p>æ‰®æ¼”ä¸€ä¸ª linux ç»ˆç«¯</p><p><br></p><p><img src="/images/typechat/Untitled%203.png" alt="æ‰®æ¼”ä¸€ä¸ª Javascript æ‰§è¡Œå™¨"></p><p>æ‰®æ¼”ä¸€ä¸ª Javascript æ‰§è¡Œå™¨</p><p><br></p><p><img src="/images/typechat/Untitled%204.png" alt="æ‰®æ¼” Typescript"></p><p>æ‰®æ¼” Typescript</p><p><br></p><p>è¿™èƒ½è¯´æ˜ ChatGPT çš„é¢„è®­ç»ƒé›†ä¸­åŒ…å«äº†ä¸°å¯Œçš„ç¼–ç¨‹è¯­è¨€ç›¸å…³çš„å†…å®¹ã€‚</p><p><br><br><br><br><br></p><h2 id="è¿ç»­å¯¹è¯å’Œçº é”™æœºåˆ¶"><a href="#è¿ç»­å¯¹è¯å’Œçº é”™æœºåˆ¶" class="headerlink" title="è¿ç»­å¯¹è¯å’Œçº é”™æœºåˆ¶"></a>è¿ç»­å¯¹è¯å’Œçº é”™æœºåˆ¶</h2><p><img src="/images/typechat/Untitled%205.png" alt="Untitled"></p><p>ä¼—æ‰€å‘¨çŸ¥ï¼Œ ChatGPT ç”Ÿæˆçš„å†…å®¹å­˜åœ¨ä¸€å®šçš„éšæœºæ€§å’Œä¸ç¨³å®šæ€§ï¼Œå¾ˆéš¾ä¸€æ­¥åˆ°ä½ã€‚è¯»è€…ä»¬ä½œä¸ºå¼€å‘è€…æˆ‘ä»¬ç»å¸¸ä½¿ç”¨å®ƒæ¥ç”Ÿæˆä»£ç ï¼Œåº”è¯¥èƒ½å¤Ÿä½“ä¼šåˆ°ã€‚</p><p>è¿™ä¸ªé—®é¢˜æ€ä¹ˆè§£å†³å‘¢ï¼Ÿå¤§æ¦‚æœ‰ä»¥ä¸‹å‡ ä¸ªæ–¹å‘</p><ul><li>å¯ä»¥å’Œ ChatGPT è¿ç»­å¯¹è¯ï¼Œå¼•å¯¼å®ƒï¼Œåé—®å®ƒã€çº æ­£å®ƒ</li><li>ç»™ ChatGPT æä¾›æ›´è¯¦ç»†çš„ä¸Šä¸‹æ–‡ä¿¡æ¯</li><li>ä½¿ç”¨ä¸€äº›å¯¹è¯çš„æŠ€å·§ï¼šChain of thought, è®© ChatGPT å­¦ä¹ æ¨ç†çš„è¿‡ç¨‹</li><li>æ¨¡å‹å¾®è°ƒã€‚</li></ul><p>æœ€åæ˜¯å¹³å¸¸å¿ƒï¼Œå¼€æ”¾åœ°å¯¹å¾…ï¼Œ AI ä¸æ˜¯æ— æ‰€ä¸èƒ½çš„ï¼Œæˆ‘ä»¬å¯èƒ½ç”¨å°½çš„æ‰€æœ‰æŠ€å·§ï¼Œ ä¹Ÿå¯èƒ½æ— æ³•ä»¤äººæ»¡æ„çš„ç­”æ¡ˆã€‚</p><p><br><br><br></p><h2 id="dsl-è¾“å‡º"><a href="#dsl-è¾“å‡º" class="headerlink" title="DSL è¾“å‡º"></a>DSL è¾“å‡º</h2><p>å¦‚æœæˆ‘ä»¬æƒ³è¦è®© AI è¿æ¥åˆ°å…¶ä»–ç”Ÿæ€ï¼Œæ¯”å¦‚è¿æ¥åˆ°è½¯ä»¶ç³»ç»Ÿã€æ§åˆ¶ç¡¬ä»¶è®¾å¤‡ã€å®ç°å„ç§è‡ªåŠ¨åŒ–æµç¨‹ï¼Œåœ¨ç°åœ¨è¿™ä¸ªé˜¶æ®µï¼Œæˆ‘ä»¬éœ€è¦è®© ChatGPT è¾“å‡ºç»“æ„åŒ–çš„æ•°æ®ï¼Œæ¯”å¦‚ JSONã€XMLã€æˆ–è€…å…¶ä»–å¸¸è§çš„ DSLã€‚</p><p><img src="/images/typechat/Untitled%206.png" alt="Untitled"></p><p>å°±åƒæˆ‘ä»¬å¼€å¤´è¯´çš„ â€œ <em>Typechat æ—¨åœ¨ä½¿ç”¨ AI æ¥è¿æ¥è‡ªç„¶è¯­è¨€å’Œåº”ç”¨çš„ Schema / API</em>â€,  ç»“åˆä¸Šé¢çš„æµç¨‹å›¾ç†è§£ï¼Œä½ åº”è¯¥å°±èƒ½ä½“ä¼šåˆ°è¿™å¥è¯çš„æ„æ€ã€‚<strong><code>AI</code> åœ¨è¿™é‡Œå°±æ˜¯ä¸€ä¸ª<code>è¿æ¥è€…</code>ï¼Œè®©ç”¨æˆ·å¯ä»¥ä½¿ç”¨<code>è‡ªç„¶è¯­è¨€</code>å’Œæˆ‘ä»¬çš„<code>åº”ç”¨ç³»ç»Ÿ</code>è¿›è¡Œäº¤äº’ï¼ŒAI åœ¨è¿™é‡Œçš„è´£ä»»å°±æ˜¯å°†<code>è‡ªç„¶è¯­è¨€</code>ç¿»è¯‘ä¸ºæˆ‘ä»¬åº”ç”¨ç³»ç»Ÿèƒ½å¤Ÿå¤„ç†çš„ <code>DSL</code></strong>ã€‚</p><p><br></p><p>ChatGPT å·²ç»å…·å¤‡è¿™æ ·çš„èƒ½åŠ›ï¼š</p><p><img src="/images/typechat/Untitled%207.png" alt="ç»˜åˆ¶ mermaid æµç¨‹å›¾"></p><p>ç»˜åˆ¶ mermaid æµç¨‹å›¾</p><p><br></p><p><img src="/images/typechat/Untitled%208.png" alt="è¾“å‡º JSON"></p><p>è¾“å‡º JSON</p><p><br></p><p>å¦‚æœä½ è¦æ±‚è¾“å‡ºæ›´å¤æ‚çš„æ•°æ®ç»“æ„ï¼Œåˆ™éœ€è¦ä½¿ç”¨ <a href="https://learningprompt.wiki/docs/chatGPT/tutorial-extras/Few-Shot%20Prompting" target="_blank" rel="noopener">Few-shot</a> Prompt ç­‰æ‰‹æ®µï¼Œ<strong>åœ¨å—é™çš„ Token èŒƒå›´å†…ï¼Œç»™ ChatGPTè¶³å¤Ÿçš„æ¡ˆä¾‹å’Œä¸Šä¸‹æ–‡ä¿¡æ¯</strong>ã€‚</p><p>é™¤æ­¤ä¹‹å¤–ï¼ŒOpenAI å®˜æ–¹åœ¨ 613 ç‰ˆæœ¬çš„ GPT 3.5 å’Œ 4 å¸¦æ¥äº†<code>å‡½æ•°è°ƒç”¨</code>çš„èƒ½åŠ›(<a href="https://platform.openai.com/docs/guides/gpt/function-calling" target="_blank" rel="noopener">Function Calling</a>), å¯ä»¥å¸®åŠ©å¼€å‘è€…é€šè¿‡ API æ–¹å¼å®ç°ç±»ä¼¼äº ChatGPT æ’ä»¶çš„æ•°æ®äº¤äº’èƒ½åŠ›ã€‚è®©å¼€å‘è€…å¯ä»¥ä½¿ç”¨  JSON Schema æ¥æè¿°ä½ çš„å‡½æ•°æ¥å£ï¼ŒGPT ä¼šæ ¹æ®ç”¨æˆ·çš„è¾“å…¥ï¼Œå†³å®šè°ƒç”¨å“ªä¸ªå‡½æ•°ï¼Œå¹¶ç»„è£…ç¬¦åˆ Schema è¦æ±‚çš„ JSON æ•°æ®ã€‚</p><p>ä»¥ä¸‹æ˜¯ OpenAI çš„å®˜æ–¹ç¤ºä¾‹ï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># ğŸ”´ å‡½æ•°æ¥å£å®šä¹‰</span></span><br><span class="line">functions = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">"name"</span>: <span class="string">"get_current_weather"</span>,</span><br><span class="line">        <span class="string">"description"</span>: <span class="string">"Get the current weather in a given location"</span>,</span><br><span class="line">        <span class="string">"parameters"</span>: &#123;</span><br><span class="line">            <span class="string">"type"</span>: <span class="string">"object"</span>,</span><br><span class="line">            <span class="string">"properties"</span>: &#123;</span><br><span class="line">                <span class="string">"location"</span>: &#123;</span><br><span class="line">                    <span class="string">"type"</span>: <span class="string">"string"</span>,</span><br><span class="line">                    <span class="string">"description"</span>: <span class="string">"The city and state, e.g. San Francisco, CA"</span>,</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="string">"unit"</span>: &#123;<span class="string">"type"</span>: <span class="string">"string"</span>, <span class="string">"enum"</span>: [<span class="string">"celsius"</span>, <span class="string">"fahrenheit"</span>]&#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">"required"</span>: [<span class="string">"location"</span>],</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># ğŸ”´ ç”¨æˆ·è¾“å…¥</span></span><br><span class="line">messages = [&#123;<span class="string">"role"</span>: <span class="string">"user"</span>, <span class="string">"content"</span>: <span class="string">"What's the weather like in Boston?"</span>&#125;]</span><br><span class="line"><span class="comment"># è°ƒç”¨</span></span><br><span class="line">response = openai.ChatCompletion.create(</span><br><span class="line">    model=<span class="string">"gpt-3.5-turbo-0613"</span>,</span><br><span class="line">    messages=messages,</span><br><span class="line">    functions=functions,</span><br><span class="line">    function_call=<span class="string">"auto"</span>,  <span class="comment"># auto is default, but we'll be explicit</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">response_message = response[<span class="string">"choices"</span>][<span class="number">0</span>][<span class="string">"message"</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># ğŸ”´ GPT ä¼šå‘Šè¯‰ä½ æœ€ç»ˆéœ€è¦è°ƒç”¨å“ªä¸ªå‡½æ•°ä»¥åŠå®ƒçš„å‚æ•°ï¼Œä¹Ÿå¯èƒ½ä¸ä¼šè°ƒç”¨ä»»ä½•ä¸œè¥¿</span></span><br><span class="line"><span class="keyword">if</span> response_message.get(<span class="string">"function_call"</span>):</span><br></pre></td></tr></table></figure><p>gpt-3.5-turbo-0613ã€gpt-4-0613 é’ˆå¯¹ Function calling è¿™ç§åœºæ™¯åšäº†å¾®è°ƒï¼Œå®é™…ä¸Šè¿™äº› â€˜å‡½æ•°â€™ ä¹Ÿæ˜¯æ³¨å…¥åˆ° <code>system</code> prompt é‡Œé¢ï¼ŒåŒæ ·ä¼šå ç”¨è¯·æ±‚çš„ Tokenã€‚åœ¨æ—§çš„ç‰ˆæœ¬ç†è®ºä¸Šä¹Ÿå¯ä»¥å®ç°ç±»ä¼¼çš„æ•ˆæœã€‚æˆ‘ä¼šåœ¨åç»­çš„æ–‡ç« ä¸­ä¸“é—¨ä»‹ç» Function callingã€‚</p><p><br></p><p>å®é™…ä¸Šï¼ŒFunction Calling è¿˜æ˜¯ä¸å®Œç¾ï¼Œæ¯”å¦‚æ— æ³•ä¿è¯ä¸¥æ ¼æŒ‰ç…§æˆ‘ä»¬ç»™å®šçš„ JSON  Schema è¾“å‡ºï¼Œä¸æ”¯æŒå¤æ‚çš„ JSON Schemaï¼Œç¼ºä¹çµæ´»æ€§ç­‰ç­‰ã€‚ç°åœ¨æˆ‘ä»¬å¼€å§‹ä»‹ç»æœ¬æ–‡çš„ä¸»è§’ â€”â€” typechat</p><p><br><br><br><br><br></p><h1 id="typechat"><a href="#typechat" class="headerlink" title="TypeChat"></a>TypeChat</h1><p>TypeChat æ˜¯å¾®è½¯åˆšå‘å¸ƒä¸€ä¸ªæœ‰è¶£çš„é¡¹ç›®ï¼Œä¸åŒäº Function callingï¼Œ å®ƒä½¿ç”¨ Typescript ç±»å‹æ¥ä½œä¸º ã€ŒSchemaã€ï¼Œè¦æ±‚ ChatGPT è¿”å›ç¬¦åˆè¿™ä¸ªç±»å‹å®šä¹‰çš„æ•°æ®ã€‚</p><p>åœ¨ <code>Typechat</code> ä¸­ï¼Œå…ˆå®šä¹‰å¥½ ChatGPT çš„å“åº”ç±»å‹ï¼Œå³ <code>Schema</code>, ä¾‹å¦‚:</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">type Response = &#123;</span><br><span class="line">    items: Item[];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">type Item = &#123;</span><br><span class="line">    name: string;</span><br><span class="line">    quantity: number;</span><br><span class="line">    size?: string;</span><br><span class="line">    notes?: string;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¦æ±‚ ChatGPT è¿”å› JSON æ ¼å¼ï¼Œå¹¶ç¬¦åˆä¸Šè¿°çš„ Response ç±»å‹ã€‚æ¥ç€è¾“å…¥ç”¨æˆ·éœ€æ±‚ï¼š</p><figure class="highlight"><table><tr><td class="code"><pre><span class="line">Could I get a blueberry muffin and a grande latte?</span><br></pre></td></tr></table></figure><p>æœ€å ChatGPT è¿”å›ç»“æœï¼š</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"items"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"name"</span>: <span class="string">"blueberry muffin"</span>,</span><br><span class="line">      <span class="string">"quantity"</span>: <span class="number">1</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"name"</span>: <span class="string">"latte"</span>,</span><br><span class="line">      <span class="string">"quantity"</span>: <span class="number">1</span>,</span><br><span class="line">      <span class="string">"size"</span>: <span class="string">"grande"</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><hr><p><br></p><p>é‚£ä¹ˆå®ƒæ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼Ÿæˆ‘ä»¬åœ¨ä¸Šä¸€èŠ‚å¯¹ ChatGPT çš„èƒ½åŠ›åšäº†å¤§æ¦‚çš„åˆ†æï¼Œä½ å¯ä»¥å°†å®ƒä»¬ç»“åˆèµ·æ¥æƒ³æƒ³ï¼š</p><ul><li>ChatGPT æ“…é•¿æ‰®æ¼”â€œä»£ç â€æ‰§è¡Œå™¨,  è¿™å…¶ä¸­ä¹ŸåŒ…æ‹¬ Typescript</li><li>ChatGPT çš„ç¼ºç‚¹å°±æ˜¯ä¸ç¨³å®šã€éšæœºæ€§ã€‚è§£å†³åŠæ³•å°±ç»™å‡ºæ›´å¤šçš„ä¿¡æ¯ã€æ¨ç†æ­¥éª¤ï¼Œé€šè¿‡è¿ç»­å¯¹è¯ã€åå¤çº æ­£å®ƒã€‚</li><li>ChatGPT é€šè¿‡ç»™å‡ºè¶³å¤Ÿçš„æŒ‡ç¤ºï¼Œå¯ä»¥è¾“å‡ºâ€˜ç¬¦åˆâ€™éœ€æ±‚çš„ç»“æ„åŒ–æ•°æ®ã€‚</li></ul><p><br><br><br><br><br></p><p>Typechat å°±æ˜¯è¿ç”¨äº†ä¸Šè¿°æ€è·¯ï¼š</p><p><img src="/images/typechat/Untitled%209.png" alt="Untitled"></p><ul><li>å°†ç±»å‹å®šä¹‰å’Œç”¨æˆ·éœ€æ±‚ä¸€èµ·æŠ•å–‚ç»™ ChatGPTï¼Œè¦æ±‚å®ƒè¿”å›æŒ‡å®šç±»å‹çš„ JSONæ•°æ®</li><li>å°†è¿”å›çš„æ•°æ®å–‚ç»™ Typescript è¿›è¡Œæ£€æŸ¥</li><li>å¦‚æœç±»å‹é”™è¯¯ï¼Œå°†é”™è¯¯ç»“æœä¸¢å› ChatGPTï¼Œé‡æ–°çº æ­£</li></ul><p><br><br><br></p><p>å®ƒçš„ Prompt éå¸¸ç®€å•ã€‚ è¯·æ±‚çš„ Promptï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">function createRequestPrompt(request: string) &#123;</span><br><span class="line">      return `You are a service that translates user requests into JSON objects of type &quot;$&#123;validator.typeName&#125;&quot; according to the following TypeScript definitions:\n` +</span><br><span class="line">          `\`\`\`\n$&#123;validator.schema&#125;\`\`\`\n` +</span><br><span class="line">          `The following is a user request:\n` +</span><br><span class="line">          `&quot;&quot;&quot;\n$&#123;request&#125;\n&quot;&quot;&quot;\n` +</span><br><span class="line">          `The following is the user request translated into a JSON object with 2 spaces of indentation and no properties with the value undefined:\n`;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p><br></p><p>çº é”™ Promptï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">function createRepairPrompt(validationError: string) &#123;</span><br><span class="line">        return `The JSON object is invalid for the following reason:\n` +</span><br><span class="line">            `&quot;&quot;&quot;\n$&#123;validationError&#125;\n&quot;&quot;&quot;\n` +</span><br><span class="line">            `The following is a revised JSON object:\n`;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><br></p><p>ç¿»è¯‘æµç¨‹ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">async function translate(request: string) &#123;</span><br><span class="line">        let prompt = typeChat.createRequestPrompt(request);</span><br><span class="line">        let attemptRepair = typeChat.attemptRepair;</span><br><span class="line">        while (true) &#123;</span><br><span class="line">            const response = await model.complete(prompt);</span><br><span class="line">            if (!response.success) &#123;</span><br><span class="line">                return response;</span><br><span class="line">            &#125;</span><br><span class="line">            const responseText = response.data;</span><br><span class="line">            const startIndex = responseText.indexOf(&quot;&#123;&quot;);</span><br><span class="line">            const endIndex = responseText.lastIndexOf(&quot;&#125;&quot;);</span><br><span class="line">            if (!(startIndex &gt;= 0 &amp;&amp; endIndex &gt; startIndex)) &#123;</span><br><span class="line">                return error(`Response is not JSON:\n$&#123;responseText&#125;`);</span><br><span class="line">            &#125;</span><br><span class="line">            const jsonText = responseText.slice(startIndex, endIndex + 1);</span><br><span class="line">            // ğŸ”´ ç±»å‹æ£€æŸ¥</span><br><span class="line">            const validation = validator.validate(jsonText);</span><br><span class="line">            if (validation.success) &#123;</span><br><span class="line">                return validation;</span><br><span class="line">            &#125;</span><br><span class="line">            if (!attemptRepair) &#123;</span><br><span class="line">                return error(`JSON validation failed: $&#123;validation.message&#125;\n$&#123;jsonText&#125;`);</span><br><span class="line">            &#125;</span><br><span class="line">            // ğŸ”´ ä¿®å¤</span><br><span class="line">            prompt += `$&#123;responseText&#125;\n$&#123;typeChat.createRepairPrompt(validation.message)&#125;`;</span><br><span class="line">            attemptRepair = false;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><br></p><p>Typechat ä¸ Function calling å¯¹æ¯”ï¼š</p><ul><li>Typescript å¯ä»¥æ›´ç®€æ´ã€çµæ´»åœ°å®šä¹‰å¤æ‚çš„æ•°æ®ç±»å‹ï¼›</li><li>Typechat ä¹ŸåŠ å…¥äº†ç®€å•çš„çº é”™æœºåˆ¶ï¼Œè¿›ä¸€æ­¥ä¿è¯ç»“æœçš„å¯é æ€§ã€‚</li></ul><p><br></p><p>å®ƒä»¬éƒ½æ”¹å˜ä¸äº† ChatGPT çš„ç‰¹æ€§ï¼Œç»“æœä¾ç„¶ä¸ä¸€å®šæ˜¯å¯é çš„ã€‚ç›®å‰ Typechat  åªæœ‰ä¸€è½®çº æ­£ï¼Œå…¶å®é™…çš„æ•ˆæœã€Token æ¶ˆè€—é‡ç­‰è¿˜æœ‰å¾…éªŒè¯ã€‚</p><p><br><br><br><br><br><br><br></p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>ä¸Šé¢æˆ‘ä»¬ç®€å•ä»‹ç»äº† ChatGPT çš„ä¸€äº›ç‰¹æ€§å’Œç¼ºé™·ã€‚æ¥ç€å¼•å…¥äº† Typechatï¼Œå®ƒç»™æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªè¾ƒæ–°çš„æ€è·¯ï¼šä½¿ç”¨ Typescript ç±»å‹æ¥å®šä¹‰ ChatGPT çš„è¾“å‡ºç»“æ„ï¼Œç„¶åé€šè¿‡ Typescript æ¥éªŒè¯è¾“å‡ºç»“æœï¼Œå¾ªç¯çº æ­£ ChatGPTã€‚</p><p>æœ¬æ–‡çš„è¦ç‚¹ï¼š</p><ul><li>ChatGPT çœ‹èµ·æ¥å¾ˆæ“…é•¿å¤„ç†ç¼–ç¨‹è¯­è¨€ã€‚æ¯”å¦‚ Typescriptï¼Œè¿™å°±ç»™ Typechat çš„å®ç°å¥ å®šäº†åŸºç¡€ã€‚</li><li>ä½¿ç”¨ Typescript ç±»å‹ä½œä¸º Schemaï¼Œè¿™æœ¬èº«å°±å¯ä»¥ç»™ ChatGPT æä¾›è¾ƒä¸ºä¸¥è°¨çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚</li><li>ChatGPT çš„å›ç­”æ˜¯éšæœºçš„ã€ä¸ç¨³å®šï¼Œå¾ˆéš¾åšåˆ°ä¸€æ­¥åˆ°ä½ã€‚åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œéœ€è¦é€šè¿‡å¤šæ¬¡å¯¹è¯å’Œçº æ­£æ‰èƒ½å¾—åˆ°è¾ƒä¸ºå®Œå–„çš„ç»“æœã€‚æ‰€ä»¥ Typechat å°±å¼•å…¥äº†è‡ªåŠ¨çº é”™æœºåˆ¶ï¼Œè®© ChatGPT è¾“å‡ºæ›´åŠ ç¨³å®šã€‚</li><li>ç¼–ç¨‹è¯­è¨€æ˜¯ä¸¥è‹›çš„ï¼Œå…·å¤‡å¯â€˜çº é”™æ€§â€™ã€‚æˆ‘ä»¬å¯ä»¥å°†ä»£ç é”™è¯¯ä¿¡æ¯åé¦ˆç»™ ChatGPT æ¥å®Œå–„ç­”æ¡ˆã€‚Typechat å°±æ˜¯åˆ©ç”¨äº†è¿™ç‚¹ï¼Œå…¶ä»–ç¼–ç¨‹è¯­è¨€ä¹Ÿå¯ä»¥è½»æ¾å®ç°ç±»ä¼¼çš„æ•ˆæœï¼Œå¾ˆå¿«å…¶ä»–è¯­è¨€åº”è¯¥ä¹Ÿä¼šæœ‰ç±»ä¼¼çš„åº“å‡ºæ¥</li></ul><p><br></p><h1 id="æ‰©å±•é˜…è¯»"><a href="#æ‰©å±•é˜…è¯»" class="headerlink" title="æ‰©å±•é˜…è¯»"></a>æ‰©å±•é˜…è¯»</h1><ul><li><a href="https://github.com/microsoft/TypeChat" target="_blank" rel="noopener">https://github.com/microsoft/TypeChat</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;img src=&quot;/images/typechat/Untitled%201.png&quot; alt=&quot;Untitled&quot;&gt;&lt;/p&gt;
&lt;p&gt;Typescript ä¹‹çˆ¶(å¾®è½¯)åœ¨ 7æœˆ 21 å·å‘å¸ƒäº†ä¸€ä¸ªæœ‰è¶£çš„é¡¹ç›®â€”â€” &lt;code&gt;[Typechat](https://githu
      
    
    </summary>
    
      <category term="AI" scheme="https://bobi.ink/categories/AI/"/>
    
    
  </entry>
  
  <entry>
    <title>AI è°ƒæ•™å¸ˆç³»åˆ—å¼€ç¯‡ï¼š MySQL ä¸“å®¶</title>
    <link href="https://bobi.ink/2023/07/21/ai-sql-master/"/>
    <id>https://bobi.ink/2023/07/21/ai-sql-master/</id>
    <published>2023-07-20T16:00:00.000Z</published>
    <updated>2023-07-21T09:17:38.044Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/images/ai-sql-master/Untitled.jpeg" alt="cover"></p><p>ChatGPT åœ¨å¹´åˆçˆ†ç«ï¼Œæˆä¸ºè¡—å¤´å··å°¾çƒ­è®®çš„è¯é¢˜ã€‚ç°åœ¨çš„ AI åº”è¯¥ç®—æ˜¯ç›®å‰æœ€å·çš„èµ›é“äº†ï¼Œä»å–è´¦å·ã€å¥—å£³å®¢æˆ·ç«¯ã€ å‰²éŸ­èœæ•™ç¨‹ã€å¤§å‚äº‰å…ˆå‘å¸ƒè‡ªå·±çš„å¤§æ¨¡å‹â€¦</p><p>ä½œä¸ºæ™®é€šå¼€å‘è€…ï¼Œæåº•å±‚å¤§æ¨¡å‹ä¸æ˜¯äººäººéƒ½èƒ½ä¼åŠï¼Œä¸‹åœºå‰²éŸ­èœå®åœ¨å·ä¸è¿‡åˆ«äººï¼Œè¿½æ–°ä¹Ÿéœ€è¦ä»˜å‡ºå¾ˆå¤šç²¾åŠ›ã€‚çœ¼å‰è²Œä¼¼å°±åªæœ‰ä¸€æ¡è·¯ï¼Œç€çœ¼äº AI çš„åº”ç”¨å±‚ï¼Œçœ‹èƒ½ä¸èƒ½ç»™è‡ªå·±çš„å‚ç›´èµ›é“èµ‹èµ‹èƒ½ï¼Ÿ æˆ–è€…é’ˆå¯¹ä¸ªäººè€Œè¨€ï¼Œèƒ½ä¸èƒ½åˆ©ç”¨ AI æé«˜å·¥ä½œæ•ˆç‡ï¼Ÿ</p><p><br></p><p>æ‰€ä»¥æˆ‘å¼€ä¸€ä¸ªæ–°å‘, ä»¥å‰ç«¯å¼€å‘è€…è§†è§’ï¼Œ è®°å½•ä¸€ä¸‹ä½œä¸ºä¸€ä¸ª ã€ŒAI è°ƒæ•™å¸ˆã€åœ¨ <code>AI åº”ç”¨å±‚</code>çš„ä¸€äº›å®è·µè®°å½•, æ²¡æœ‰é«˜è°ˆé˜”è®ºï¼Œå°±ä¸€äº›ç¢ç¢å¿µã€‚</p><p><br><br><br></p><h1 id="ä¸€ç§å…¨æ–°çš„äººæœºäº¤äº’æ¨¡å¼"><a href="#ä¸€ç§å…¨æ–°çš„äººæœºäº¤äº’æ¨¡å¼" class="headerlink" title="ä¸€ç§å…¨æ–°çš„äººæœºäº¤äº’æ¨¡å¼"></a>ä¸€ç§å…¨æ–°çš„äººæœºäº¤äº’æ¨¡å¼</h1><p>ä»Šå¹´äºŒæœˆä»½ï¼Œæˆ‘ä»¬å°±å¼€å§‹å°è¯•å°† ChatGPT æ¥å…¥åˆ°æˆ‘ä»¬çš„å·¥å…·ä¸­ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="/images/ai-sql-master/Untitled.png" alt="AIå¯¹è¯æ¡†"></p><p><br></p><p>å°±æ˜¯è¿™æ ·çš„ä¸€ä¸ª<code>å¯¹è¯æ¡†</code>ï¼Œç°åœ¨å¤§å®¶å¯èƒ½å¸ç©ºè§æƒ¯äº†ã€‚é‚£æ—¶å€™å¹¶ä¸å¸¸è§ï¼Œæ¯•ç«Ÿ Microsoft Office Copilotã€<code>ChatGPT æ’ä»¶</code>ä»€ä¹ˆçš„éƒ½è¿˜æ²¡å‘å¸ƒã€‚åœ¨å½“æ—¶æƒ³å‡ºè¿™ä¸ªç‚¹å­çš„æ—¶å€™ï¼Œæˆ‘ä¸€æ•´å¤œç¡ä¸ç€è§‰ï¼Œç¬¬äºŒå¤©å››äº”ç‚¹å°±å†³å®šèµ·åºŠï¼Œè‚äº†ä¸€å¤©æå‡ºè¿™æ ·çš„æ•ˆæœã€‚</p><blockquote><p>ğŸ˜‚ ä¸çŸ¥é“æœ‰æ²¡æœ‰äººè·Ÿæˆ‘ä¸€æ ·ï¼Œä¸€å…´å¥‹å°±ä¼šç¡ä¸ç€è§‰</p></blockquote><p><br></p><p>è¿™æ˜¯ä¸€ç§å…¨æ–°çš„ç³»ç»Ÿäº¤äº’æ–¹å¼ï¼Œå³ç”¨<code>è‡ªç„¶è¯­è¨€</code>æ¥æ“æ§æ•´ä¸ªç³»ç»Ÿã€‚æ€ä¹ˆæ“æ§æ³•å‘¢ï¼Ÿ</p><p><img src="/images/ai-sql-master/Untitled%201.png" alt="æŒ‡ä»¤"></p><p><br></p><ul><li>è¿™ä¸ªå¯¹è¯æ¡†æ˜¯å…¨å±€çš„<code>å¸¸é©»</code>çš„ï¼Œç”¨æˆ·å¯ä»¥éšæ—¶é€šè¿‡å¿«æ·é”®æˆ–è€…æ‚¬æµ®æŒ‰é’®å”¤èµ·</li><li>æ¯ä¸ªé¡µé¢éƒ½å¯ä»¥æ‰©å±•è‡ªå·±çš„æŒ‡ä»¤ï¼Œæ¯”å¦‚è¿›å…¥æ•°æ®å»ºæ¨¡é¡µé¢ï¼Œå°±æ³¨å†Œ <code>SQL ä¸“å®¶</code>ã€<code>æ•°æ®å»ºæ¨¡</code>ç­‰æŒ‡ä»¤ï¼Œç¦»å¼€åå°±é”€æ¯ï¼š<figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="comment">// React ä»£ç </span></span><br><span class="line">useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (model.readonly) &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ³¨å†Œæ‰©å±•</span></span><br><span class="line">  <span class="keyword">return</span> registerExtension(&#123;</span><br><span class="line">    key: <span class="string">'æ•°æ®å»ºæ¨¡(æµ‹è¯•)'</span>,</span><br><span class="line">    match: <span class="string">'æ•°æ®å»ºæ¨¡(æµ‹è¯•)'</span>,</span><br><span class="line">    type: ExtensionType.Command,</span><br><span class="line">    description: <span class="string">'æ•°æ®æ¨¡å‹åˆ›å»ºå’Œä¿®æ”¹'</span>,</span><br><span class="line">    onSend(context) &#123;</span><br><span class="line">      <span class="comment">// ... å®ç°</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;, [])</span><br></pre></td></tr></table></figure></li></ul><p><br></p><p><img src="/images/ai-sql-master/Untitled%202.png" alt="æŒ‡ä»¤ç³»ç»Ÿ"><br>æŒ‡ä»¤ç³»ç»Ÿ</p><p><br></p><p><code>æŒ‡ä»¤</code>ç±»ä¼¼äºç°åœ¨çš„ <code>ChatGPT æ’ä»¶</code>ï¼Œç”¨äºæ‰©å±• ChatGPT çš„èƒ½åŠ›è¾¹ç•Œã€‚</p><p>å¯¹è¯æ¡†åªæ˜¯æä¾›äº† AI å¯¹è¯çš„èƒ½åŠ›(æœºåˆ¶)ï¼Œè€Œå…·ä½“çš„ä¸šåŠ¡ã€ä¸Šä¸‹æ–‡ä¿¡æ¯åªæœ‰é¡µé¢è‡ªå·±æœ€æ¸…æ¥šï¼Œå› æ­¤å°±è®©é¡µé¢è‡ªå·±æä¾›ä¸ AI å¯¹æ¥çš„æ¥å£ã€‚</p><p>ç›®å‰çš„å®ç°æ–¹å¼æ˜¯é€šè¿‡ <code>#</code> æ¥å”¤èµ·é€‰æ‹©å…·ä½“æŒ‡ä»¤ï¼Œæœªæ¥æˆ‘ä»¬ä¼šåˆ©ç”¨ ChatGPT æœ€æ–°çš„ <a href="https://platform.openai.com/docs/guides/gpt/function-calling" target="_blank" rel="noopener">Function Calling</a> å®ç°ç±»ä¼¼ <code>ChatGPT æ’ä»¶</code> ä¸€æ ·çš„è‡ªç„¶è¯­è¨€è°ƒç”¨èƒ½åŠ›ã€‚</p><p><br><br><br><br><br></p><h1 id="mysql-ä¸“å®¶"><a href="#mysql-ä¸“å®¶" class="headerlink" title="MySQL ä¸“å®¶"></a>MySQL ä¸“å®¶</h1><p>æˆ‘ä»¬ç¬¬ä¸€ä¸ªæ¥å…¥çš„ <code>AI çš„å¤§è…¿</code>ï¼Œå°±æ˜¯ç»™æˆ‘ä»¬çš„<code>æ•°æ®å»ºæ¨¡å·¥å…·</code>æ¥å…¥ <code>AI  ç”Ÿæˆ SQL è¯­å¥</code>çš„åŠŸèƒ½ï¼š</p><p><img src="/images/ai-sql-master/Untitled.png" alt="å¯¹è¯æ¡†"></p><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è‡ªç„¶è¯­è¨€çš„å½¢å¼ï¼ŒåŸºäºæˆ‘ä»¬å·²åˆ›å»ºçš„æ•°æ®æ¨¡å‹æ¥åšä»¥ä¸‹äº‹æƒ…ï¼š</p><ul><li>ç”Ÿæˆ MySQL å»ºè¡¨ã€ å¢åˆ æ”¹æŸ¥è¯­å¥</li><li>ç»™å‡ºä¼˜åŒ–çš„å»ºè®®</li><li>æ£€æŸ¥æ˜¯å¦ç¬¦åˆå…³ç³»å‹æ•°æ®çš„èŒƒå¼ç­‰ç­‰â€¦</li></ul><p><br></p><p>å»ºè¡¨è¯­å¥ï¼š</p><p><img src="/images/ai-sql-master/Untitled%203.png" alt="å»ºè¡¨è¯­å¥"></p><p><br></p><p>ä¼˜åŒ–å»ºè®®ï¼š</p><p><img src="/images/ai-sql-master/Untitled%204.png" alt="ä¼˜åŒ–å»ºè®®"></p><p>è¿˜æœ‰å¾ˆå¤šåœºæ™¯â€¦</p><p><br><br><br><br><br></p><h1 id="prompt-å®ç°"><a href="#prompt-å®ç°" class="headerlink" title="Prompt å®ç°"></a>Prompt å®ç°</h1><p>å‡ ä¹é›¶æˆæœ¬å°±å¯ä»¥æ‹¥æœ‰ä¸€ä¸ª ã€ŒMySQL ä¸“å®¶ã€ã€‚å®ƒçš„ Prompt å…¶å®å¾ˆç®€å•ï¼</p><p><br></p><p>é¦–å…ˆéœ€è¦å°†å·²åˆ›å»ºçš„æ•°æ®æ¨¡å‹åºåˆ—åŒ–ï¼Œä½œä¸ºä¸Šä¸‹æ–‡å–‚ç»™ ChatGPT, ä¾‹å¦‚ï¼š</p><figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"><span class="comment">#ä¼šå‘˜ä¸»æ¡£</span></span><br><span class="line">Table m_member (</span><br><span class="line">  <span class="symbol">id:</span> Long, PrimaryKey;</span><br><span class="line">  <span class="symbol">tenant_id:</span> Long; <span class="comment">#ç§Ÿæˆ·id</span></span><br><span class="line">  <span class="symbol">unique_account_id:</span> String; <span class="comment">#ä¼šå‘˜ä¸€è´¦é€šid</span></span><br><span class="line">  <span class="symbol">status:</span> Integer; <span class="comment">#ä¼šå‘˜çŠ¶æ€</span></span><br><span class="line">  <span class="symbol">unique_identifier_key:</span> String; <span class="comment">#ä¼šå‘˜å”¯ä¸€æ ‡è¯†é”®</span></span><br><span class="line">  <span class="symbol">unique_identifier:</span> String; <span class="comment">#ä¼šå‘˜å”¯ä¸€æ ‡è¯†çš„å€¼</span></span><br><span class="line">  <span class="symbol">ext_json:</span> String; <span class="comment">#è‡ªå®šä¹‰æ‰©å±•å­—æ®µ</span></span><br><span class="line">  <span class="symbol">clubs:</span> String; <span class="comment">#ä¼šå‘˜æ‰€å±çš„ä¿±ä¹éƒ¨</span></span><br><span class="line">  <span class="symbol">channel:</span> String; <span class="comment">#æ¸ é“</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¿±ä¹éƒ¨ä¼šå‘˜</span></span><br><span class="line">Table club_member_do (</span><br><span class="line">  <span class="symbol">id:</span> Long, PrimaryKey; <span class="comment">#å®ä½“å”¯ä¸€æ ‡è¯†ç¬¦</span></span><br><span class="line">  <span class="symbol">tenant_id:</span> Long; <span class="comment">#ç§Ÿæˆ·id</span></span><br><span class="line">  <span class="symbol">club_id:</span> Long; <span class="comment">#ä¿±ä¹éƒ¨id</span></span><br><span class="line">  <span class="symbol">unique_account_id:</span> String; <span class="comment">#ä¼šå‘˜ä¸€è´¦é€šid</span></span><br><span class="line">  <span class="symbol">member_no:</span> String; <span class="comment">#ä¼šå‘˜å¡å·</span></span><br><span class="line">  <span class="symbol">level_num:</span> Integer; <span class="comment">#ä¼šå‘˜ç­‰çº§ç¼–å·</span></span><br><span class="line">  <span class="symbol">level_expired_time:</span> DateTime; <span class="comment">#ç­‰çº§è¿‡æœŸæ—¶é—´</span></span><br><span class="line">  <span class="symbol">nickname:</span> String; <span class="comment">#æ˜µç§°</span></span><br><span class="line">  <span class="symbol">channel:</span> String; <span class="comment">#æ¸ é“</span></span><br><span class="line">  <span class="symbol">certificate_type:</span> String; <span class="comment">#è¯ä»¶ç±»å‹</span></span><br><span class="line">  <span class="symbol">certificate_no:</span> String; <span class="comment">#è¯ä»¶å·ç </span></span><br><span class="line">  <span class="symbol">email:</span> String; <span class="comment">#é‚®ç®±</span></span><br><span class="line">  <span class="symbol">country_code:</span> String; <span class="comment">#å›½å®¶ç¼–ç </span></span><br><span class="line">  <span class="symbol">address:</span> String; <span class="comment">#è¯¦ç»†åœ°å€ä¿¡æ¯</span></span><br><span class="line">  <span class="symbol">ext_json:</span> String; <span class="comment">#æ‰©å±•å­—æ®µ</span></span><br><span class="line">  <span class="symbol">status:</span> Integer; <span class="comment">#ä¿±ä¹éƒ¨ä¼šå‘˜çŠ¶æ€</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¼šå‘˜å˜åŠ¨æ—¥å¿—</span></span><br><span class="line">Table m_member_operation_log (</span><br><span class="line">  <span class="symbol">id:</span> Long; <span class="comment">#å®ä½“å”¯ä¸€æ ‡è¯†ç¬¦</span></span><br><span class="line">  <span class="symbol">tenant_id:</span> Long; <span class="comment">#ç§Ÿæˆ·ID</span></span><br><span class="line">  <span class="symbol">club_id:</span> Long; <span class="comment">#ä¿±ä¹éƒ¨Id</span></span><br><span class="line">  <span class="symbol">unique_account_id:</span> String; <span class="comment">#ä¸€è´¦é€šID</span></span><br><span class="line">  <span class="symbol">operation_type:</span> String; <span class="comment">#æ“ä½œç±»å‹</span></span><br><span class="line">  <span class="symbol">remark:</span> String; <span class="comment">#æ“ä½œå¤‡æ³¨</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><p><br><br><br></p><p>è¿™ä¸ª DSL çš„æ ¼å¼æ— æ‰€è°“ï¼ŒChatGPT è‡ªç„¶è¯­è¨€çš„å¤„ç†èƒ½åŠ›éå¸¸å¼ºï¼Œåªè¦ä½ ç»™å‡ºçš„ä¿¡æ¯ç¬¦åˆä¸€å®šçš„è§„å¾‹ï¼Œæ ¼å¼å¹¶ä¸é‡è¦ã€‚</p><p><br></p><p>å®Œæ•´çš„ Prompt(<code>system</code>) æ¨¡æ¿å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ä½ æ˜¯ä¸€ä¸ª MySQL ä¸“å®¶ï¼Œä½ ä¼šæ ¹æ®ç”¨æˆ·ç»™å‡ºçš„æ¦‚å¿µæ¨¡å‹ï¼Œåˆ›å»ºä¸“ä¸šã€é«˜æ€§èƒ½ SQL è¯­å¥ï¼Œ ä»¥åŠå›ç­”ç”¨æˆ·å…³äºæ•°æ®åº“çš„ä»»ä½•é—®é¢˜ï¼Œæå‡ºå»ºè®¾æ€§æ„è§ã€‚</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">å‡è®¾å®ä½“(æˆ–è€…è¡¨)æœ‰å¤šä¸ªå­—æ®µ(æˆ–è€…å±æ€§), è¿™äº›å­—æ®µæ”¯æŒä»¥ä¸‹ç±»å‹:</span><br><span class="line"></span><br><span class="line">- Boolean</span><br><span class="line">- Date</span><br><span class="line">- DateTime</span><br><span class="line">- Timestamp</span><br><span class="line">- Integer</span><br><span class="line">- Decimal</span><br><span class="line">- Long</span><br><span class="line">- Double</span><br><span class="line">- Float</span><br><span class="line">- String</span><br><span class="line">- Text</span><br><span class="line">- LongText</span><br><span class="line">- JSON</span><br><span class="line">- Reference : è¡¨ç¤ºå¯¹å…¶ä»–è¡¨çš„å¼•ç”¨</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">è¿™æ˜¯æ¦‚å¿µæ¨¡å‹ï¼š</span><br><span class="line"></span><br><span class="line">$&#123;conception&#125;</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">ç”¨æˆ·è¾“å…¥ï¼š &quot;&quot;&quot;$&#123;input&#125;&quot;&quot;&quot;</span><br></pre></td></tr></table></figure><p><br><br><br></p><p>è¿™æ˜¯ä¸€ä¸ªå¾ˆç®€å•çš„ Promptï¼Œä½†ä¹Ÿæ­ç¤ºäº†æˆ‘ä»¬å†™ Prompt çš„<a href="https://learningprompt.wiki/docs/chatGPT/tutorial-extras/ChatGPT%20Prompt%20Framework" target="_blank" rel="noopener">ä¸»è¦æ¡†æ¶</a>ï¼š</p><ul><li><strong>èƒ½åŠ›ä¸è§’è‰²</strong>ï¼ˆCapacity and Roleï¼‰ï¼šä¸€ä¸Šæ¥å°±ç»™å®ƒå¸¦ä¸ªå¸½å­ï¼Œå®šä¹‰å¥½å®ƒçš„è§’è‰²å’Œèƒ½åŠ›</li><li><strong>æ´å¯ŸåŠ›</strong>ï¼ˆInsightï¼‰ï¼šèƒŒæ™¯ä¿¡æ¯å’Œä¸Šä¸‹æ–‡ã€‚å³æˆ‘ä»¬æºå¸¦äº†æ•°æ®æ¨¡å‹å·¥å…·ä¸­æå–å‡ºæ¥çš„ <code>æ¨¡å‹ DSL</code>ï¼Œ ä»¥åŠ DSL çš„åŸºç¡€è§„åˆ™</li><li><strong>æŒ‡ä»¤</strong>ï¼ˆStatementï¼‰ï¼šè¦æ±‚ ChatGPT åšä»€ä¹ˆã€‚è¿™ä¸ªç”±åç»­çš„ç”¨æˆ·ç»™å‡º</li></ul><p><br></p><p>è¿™é‡Œæˆ‘ä»¬ä¹Ÿä½¿ç”¨äº†ä¸€äº›<a href="https://learningprompt.wiki/docs/chatGPT/tutorial-tips/%E6%8A%80%E5%B7%A75%EF%BC%9A%E4%BD%BF%E7%94%A8%E7%89%B9%E6%AE%8A%E7%AC%A6%E5%8F%B7%E6%8C%87%E4%BB%A4%E5%92%8C%E9%9C%80%E8%A6%81%E5%A4%84%E7%90%86%E7%9A%84%E6%96%87%E6%9C%AC%E5%88%86%E5%BC%80" target="_blank" rel="noopener">ç‰¹æ®Šç¬¦å·</a>, æ¯”å¦‚ <code>---</code> <code>&quot;&quot;&quot;</code> , å¯¹æ–‡æœ¬è¿›è¡Œåˆ†æ®µï¼Œå¯ä»¥æå‡ AI åé¦ˆçš„å‡†ç¡®æ€§</p><p><br></p><p>å› ä¸º ChatGPT è¯­è¨€æ¨¡å‹å·²ç»é¢„è®­ç»ƒäº†å¾ˆå¤šæ•°æ®åº“ç›¸å…³çš„è¯­æ–™ï¼Œæ‰€ä»¥å›ç­”çš„æ•ˆæœè¿˜ä¸é”™ï¼Œä¸éœ€è¦å¤ªå¤šçš„æŒ‡ç¤º(å³ <code>[Zero-Shot Prompting](https://learningprompt.wiki/docs/chatGPT/tutorial-extras/Zero-Shot%20Prompts)</code>)ã€‚</p><blockquote><p>ğŸ’¡  ä½ å¯ä»¥é€šè¿‡è¿™ä¸ª<a href="https://sdk.vercel.ai/r/25O12Mq" target="_blank" rel="noopener">é“¾æ¥è¯•ä¸€è¯•æ•ˆæœ</a></p></blockquote><p><br><br><br><br><br></p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>ã€ŒAI è°ƒæ•™å¸ˆã€ç³»åˆ—çš„ç¬¬ä¸€ç¯‡æ–‡ç« ä»¥ä¸€ä¸ªæœ€ç®€å•çš„ç¤ºä¾‹å¼€å§‹ï¼Œ è¿™æ˜¯æˆ‘ä¸ºæ•°ä¸å¤šæ¯”è¾ƒçŸ­çš„æ–‡ç« äº†ã€‚å¦‚æœä½ æƒ³ç»™å·²æœ‰çš„å·¥å…·æ¥å…¥ AI èƒ½åŠ›ï¼Œå…´è®¸è¿™ç§æ–¹å¼å°±æ˜¯æœ€å¥½çš„å¼€å§‹ï¼Œä»å·²æœ‰çš„å·¥å…·ä¸­æå–å‡ºç›¸å…³ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼ŒæŠ•å–‚ç»™ AI æ¥å®ç°æ™ºèƒ½é—®ç­”ã€‚</p><p>ä¸‹ä¸€ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬å°†è¿›ä¸€æ­¥æ·±åŒ–ï¼Œè®²è®²å¦‚ä½•åˆ©ç”¨ AI æ¥å®ç°<code>æ•°æ®å»ºæ¨¡</code>(ç”» ER å›¾)ï¼Œæ•¬è¯·æœŸå¾…ã€‚åŒæ—¶æ±‚èµæ±‚å…³æ³¨æ±‚æ”¶è—ï¼Œä½ ä¹Ÿå¯ä»¥ç›´æ¥è®¢é˜…è¿™ä¸ªä¸“æ ã€‚</p><p><br><br><br></p><h1 id="æ‰©å±•é˜…è¯»"><a href="#æ‰©å±•é˜…è¯»" class="headerlink" title="æ‰©å±•é˜…è¯»"></a>æ‰©å±•é˜…è¯»</h1><p>æœ¬æ–‡ç”¨åˆ°çš„æŠ€å·§</p><ul><li><a href="https://learningprompt.wiki/docs/chatGPT/tutorial-extras/Zero-Shot%20Prompts" target="_blank" rel="noopener">Zero-Shot Prompts</a></li><li><a href="https://learningprompt.wiki/docs/chatGPT/tutorial-tips/%E6%8A%80%E5%B7%A75%EF%BC%9A%E4%BD%BF%E7%94%A8%E7%89%B9%E6%AE%8A%E7%AC%A6%E5%8F%B7%E6%8C%87%E4%BB%A4%E5%92%8C%E9%9C%80%E8%A6%81%E5%A4%84%E7%90%86%E7%9A%84%E6%96%87%E6%9C%AC%E5%88%86%E5%BC%80" target="_blank" rel="noopener">æŠ€å·§ 5ï¼šä½¿ç”¨ç‰¹æ®Šç¬¦å·æŒ‡ä»¤å’Œéœ€è¦å¤„ç†çš„æ–‡æœ¬åˆ†å¼€</a></li><li><a href="https://learningprompt.wiki/docs/chatGPT/tutorial-extras/ChatGPT%20Prompt%20Framework" target="_blank" rel="noopener">CRISPE Prompt Framework</a></li></ul><p>å­¦ä¹  Prompt</p><ul><li><a href="https://learningprompt.wiki/docs/chatGPT/tutorial-basics/%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF%20&amp;%20%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7/scenario-1-ask-questions" target="_blank" rel="noopener">Learning Prompt</a></li><li><a href="https://www.deeplearning.ai/short-courses/chatgpt-prompt-engineering-for-developers/" target="_blank" rel="noopener">ChatGPT Prompt Engineering for Developers</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;img src=&quot;/images/ai-sql-master/Untitled.jpeg&quot; alt=&quot;cover&quot;&gt;&lt;/p&gt;
&lt;p&gt;ChatGPT åœ¨å¹´åˆçˆ†ç«ï¼Œæˆä¸ºè¡—å¤´å··å°¾çƒ­è®®çš„è¯é¢˜ã€‚ç°åœ¨çš„ AI åº”è¯¥ç®—æ˜¯ç›®å‰æœ€å·çš„èµ›é“äº†ï¼Œä»å–è´¦å·ã€å¥—å£³å®¢æˆ·ç«¯ã€ å‰²éŸ­èœæ•™ç¨‹ã€å¤§å‚äº‰å…ˆå‘å¸ƒ
      
    
    </summary>
    
      <category term="AI" scheme="https://bobi.ink/categories/AI/"/>
    
    
  </entry>
  
  <entry>
    <title>2B or not 2B: å‰ç«¯å¤§æ³¥çƒ</title>
    <link href="https://bobi.ink/2023/07/20/to-be-shit/"/>
    <id>https://bobi.ink/2023/07/20/to-be-shit/</id>
    <published>2023-07-19T16:00:00.000Z</published>
    <updated>2023-07-20T03:05:33.711Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/images/to-be-shit/Untitled.jpeg" alt="cover"></p><p>ä»Šå¤©ç»™å¤§å®¶å¸¦æ¥çš„æ˜¯ 2B é¢†åŸŸçš„ä¸€ä¸ªæ¶æ„éš¾é¢˜ï¼Œæˆ‘ä»¬æœ€ç»ˆä¹Ÿæ²¡æœ‰æ‰¾åˆ°ä¸€ä¸ªè¾ƒå¥½ã€Œè§£å†³ã€æ–¹æ¡ˆï¼Œ æˆ–è€…è¯´å®ƒæœ¬æ¥å°±æ˜¯ä¸€ä¸ªä¼ªå‘½é¢˜ã€‚</p><p>è®©æˆ‘æ…¢æ…¢è·Ÿä½ é“æ¥â€¦</p><p><br><br><br></p><h1 id="è½¯ä»¶çš„åˆ’åˆ†æ¨¡å¼"><a href="#è½¯ä»¶çš„åˆ’åˆ†æ¨¡å¼" class="headerlink" title="è½¯ä»¶çš„åˆ’åˆ†æ¨¡å¼"></a>è½¯ä»¶çš„åˆ’åˆ†æ¨¡å¼</h1><p>é¦–å…ˆä»è½¯ä»¶ç³»ç»Ÿçš„åˆ’åˆ†æ¨¡å¼è®²èµ·ã€‚<strong>è½¯ä»¶ç³»ç»Ÿçš„åˆ’åˆ†æœ‰å¾ˆå¤šç§æ–¹å¼ï¼Œæ‹†åˆ†çš„ç›®çš„æ— ééƒ½æ˜¯ï¼šåˆ†æ²»ã€å¤ç”¨ã€éš”ç¦»ã€æ‰©å±•æ€§ã€æŠ½è±¡ç­‰ç­‰ã€‚</strong></p><p><br></p><hr><p><br></p><p><strong>æœ€ä¸ºå¸¸è§çš„ä¾¿æ˜¯<code>åˆ†å±‚æ¶æ„</code></strong></p><p>åˆ†å±‚æ¶æ„å°†è½¯ä»¶ç³»ç»Ÿåˆ’åˆ†ä¸ºè‹¥å¹²å±‚æ¬¡ï¼Œæ¯ä¸ªå±‚æ¬¡éƒ½æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œå„è‡ªè´Ÿè´£ä¸åŒçš„åŠŸèƒ½å’ŒèŒè´£ï¼Œé€šè¿‡æ˜ç¡®çš„æ¥å£å’Œåè®®è¿›è¡Œé€šä¿¡ï¼Œä»è€Œå®ç°ç³»ç»Ÿçš„å¯æ‰©å±•æ€§ã€å¯ç»´æŠ¤æ€§ã€å¯æµ‹è¯•æ€§ã€å¯é‡ç”¨æ€§ç­‰ç‰¹ç‚¹ã€‚</p><p>æ¯”å¦‚ä¸€ä¸ªå…¸å‹çš„ Web ç³»ç»Ÿçš„â€œä¸‰å±‚æ¶æ„â€ï¼š</p><ul><li><code>è¡¨ç¤ºå±‚ï¼ˆPresentation Layerï¼‰</code>ï¼šè´Ÿè´£ç”¨æˆ·ç•Œé¢ã€ç”¨æˆ·äº¤äº’å’Œç”¨æˆ·è¾“å…¥è¾“å‡ºç­‰åŠŸèƒ½ï¼Œé€šè¿‡ Web é¡µé¢æˆ–è€…å®¢æˆ·ç«¯åº”ç”¨æ¥å±•ç¤ºå’Œæ§åˆ¶æ•°æ®çš„å‘ˆç°æ–¹å¼ã€‚</li><li><code>ä¸šåŠ¡é€»è¾‘å±‚ï¼ˆBusiness Logic Layer</code>ï¼‰ï¼šè´Ÿè´£ç³»ç»Ÿçš„ä¸šåŠ¡é€»è¾‘å¤„ç†ã€æ•°æ®å¤„ç†å’Œå…¶ä»–ä¸šåŠ¡è§„åˆ™çš„å®ç°ï¼Œä¸ºè¡¨ç¤ºå±‚æä¾›æ•°æ®å’Œä¸šåŠ¡é€»è¾‘çš„æ”¯æŒã€‚</li><li><code>æ•°æ®è®¿é—®å±‚ï¼ˆData Access Layerï¼‰</code>ï¼šè´Ÿè´£æ•°æ®çš„å­˜å‚¨å’Œè®¿é—®ï¼Œä¸ºä¸šåŠ¡é€»è¾‘å±‚æä¾›æ•°æ®è®¿é—®çš„æ¥å£å’Œå®ç°ã€‚</li></ul><p><img src="/images/to-be-shit/Untitled.png" alt="åˆ†å±‚"></p><p><br></p><hr><p><br></p><p><strong>å¾®æœåŠ¡æ¶æ„</strong></p><p>éšç€ç³»ç»Ÿçš„å¤æ‚åŒ–ï¼Œæˆ‘ä»¬éœ€è¦å°†ç³»ç»Ÿæ‹†åˆ†ä¸ºæ›´å°çš„å­ç³»ç»Ÿï¼Œæ¥è§£å†³æ€§èƒ½ã€ç»´æŠ¤æ€§ã€æ‰©å±•æ€§ç­‰è¯¸å¤šé—®é¢˜ã€‚æ¯”å¦‚å¼•å…¥äº†å¾®æœåŠ¡ã€å¾®å‰ç«¯ç­‰è§£å†³æ–¹æ¡ˆï¼Œè¿™ä¸ªæœ¬è´¨ä¸Šæ˜¯ä¸€ç§<code>å‚ç›´æ–¹å‘çš„æ‹†åˆ†</code>ï¼š</p><p><img src="/images/to-be-shit/Untitled%201.png" alt="å‚ç›´æ‹†åˆ†"></p><p>ç”šè‡³æˆ‘ä»¬åœ¨åº”ç”¨å†…éƒ¨è¿˜ä¼šè¿›ä¸€æ­¥æ‹†åˆ†, æŒ‰ç…§ä¸šåŠ¡èšåˆåº¦æ‹†åˆ†æˆä¸åŒçš„æ¨¡å—ï¼š</p><p><img src="/images/to-be-shit/Untitled%202.png" alt="é¢†åŸŸæ‹†åˆ†"></p><p>è¿™å°±æ˜¯åˆ†æ²»çš„é­…åŠ›å§ã€‚</p><p><br><br><br><br><br></p><h1 id="å¤šä¸šæ€"><a href="#å¤šä¸šæ€" class="headerlink" title="å¤šä¸šæ€"></a>å¤šä¸šæ€</h1><p>åœ¨ 2B é¢†åŸŸï¼Œè®©æˆ‘ä»¬æ›´æ£˜æ‰‹çš„æ˜¯ï¼Œè¿˜è¦é¢ä¸´<code>å¤šä¸šæ€é—®é¢˜</code>ã€‚</p><p><br></p><p><strong>ä»€ä¹ˆæ˜¯å¤šä¸šæ€ï¼Ÿ</strong></p><p>è®© <code>ChatGPT</code> æ¥è§£é‡Šä¸€ä¸‹ï¼š<em>å¤šä¸šæ€æ˜¯æŒ‡ä¸€ä¸ªä¼ä¸šæˆ–è€…å“ç‰Œåœ¨ä¸åŒçš„ä¸šåŠ¡é¢†åŸŸæˆ–è¡Œä¸šä¸­æ‹¥æœ‰ä¸åŒçš„ä¸šæ€ï¼Œä¾‹å¦‚åŒä¸€ä¸ªå“ç‰Œæ—¢å¯ä»¥å¼€è®¾é¤å…ï¼Œä¹Ÿå¯ä»¥å¼€è®¾é…’åº—ã€å’–å•¡åº—ã€å¿«é¤åº—ã€å½±é™¢ç­‰ä¸åŒçš„ä¸šæ€ã€‚å¤šä¸šæ€çš„ä¼ä¸šæˆ–å“ç‰Œé€šè¿‡åœ¨ä¸åŒçš„ä¸šæ€ä¸­æä¾›ä¸åŒçš„äº§å“å’ŒæœåŠ¡ï¼Œä»¥æ»¡è¶³ä¸åŒæ¶ˆè´¹è€…çš„éœ€æ±‚å’Œåå¥½ï¼Œå¢åŠ ä¼ä¸šçš„æ”¶å…¥å’Œå¸‚åœºä»½é¢</em>ã€‚</p><p><strong>å¤šä¸šæ€å¹¶ä¸æ˜¯ä¸€ç§ç»“æœï¼Œè€Œæ˜¯ä¸€ç§æ‰‹æ®µ</strong>ã€‚æ¯”å¦‚åœ¨å‚ç›´é¢†åŸŸè€•è€˜å¤šå¹´çš„ä¼ä¸šï¼Œæƒ³è¦æ‰©å¤§åˆ›æ”¶ï¼Œå°±ä¼šå°†è§¦è§’ä¼¸åˆ°å…¶ä»–è¡Œä¸šï¼Œå³æ‰€è°“çš„è·¨ç•Œã€‚è¿˜æœ‰å°±æ˜¯ä¸€äº›åˆåˆ›ä¼ä¸šï¼Œå°±åƒæ— å¤´è‹è‡ä¸€æ ·ï¼Œå°†ç½‘æ’’å‘ä¸åŒçš„è¡Œä¸šï¼Œæ¥æ‘¸ç´¢å‡ºè·¯ã€‚</p><p>æˆ‘ä»¬å°±æ˜¯å±äºåè€…ã€‚ä¸è¿‡ä¹Ÿæœ‰å¯èƒ½å‰æœŸç­–ç•¥æ˜¯åœ¨æ¨¡ä»¿<code>æœ‰èµ</code> çš„å«Œç–‘(<em>æ¯•ç«Ÿæœ‰èµåœ¨ 18ã€19 å¹´æ˜¯å½“çº¢çš„ SaaS ç‚¸å­é¸¡</em>)ï¼Œé“ºè®¾äº†å¾ˆå¤šè¡Œä¸šï¼šåŒ»è¯ã€æ•™è‚²ã€æ–‡æ—…ã€é›¶å”®ã€åœ°äº§ã€æ±½è½¦â€¦</p><p>ä¹Ÿå°±æ˜¯è¯´åœ¨è¿™ç§ã€Œå¹¿æ’’ç½‘ã€çš„å•†ä¸šç­–ç•¥ä¸‹, æˆ‘ä»¬éœ€è¦åœ¨ã€Œä¸€å¥—ä»£ç ã€ä¸­é€‚é…â€œå¤šä¸šæ€â€ï¼š</p><p><img src="/images/to-be-shit/Untitled%203.png" alt="å¤šä¸šæ€"></p><p>ç„¶è€Œå¤šä¸šæ€å¹¶ä¸æ˜¯ç®€å•çš„<code>å‚ç›´æ–¹å‘</code>çš„è¿›ä¸€æ­¥ç»†åˆ†ï¼Œè€Œæ˜¯å¤šäº†ä¸€ä¸ª<code>ç»´åº¦</code>ã€‚å¦‚æœè¯´åˆ†å±‚æ˜¯ 1Dã€ å‚ç›´åˆ’åˆ†æ˜¯ 2Dã€å†åŠ ä¸Šå¤šä¸šæ€ï¼Œå°±æ˜¯ 3D äº†ï¼</p><p><strong>è¿™äº›<code>è¡Œä¸šå¤šæ€</code>ä¼šæ¨ªå‘å‡»ç©¿å‚ç›´æ‹†åˆ†åçš„æ¨¡å—å£å’ï¼Œè¡Œä¸šçš„å¤šæ ·æ€§ä¼šæ¸—é€åˆ°ç¨‹åºçš„å„ä¸ªè§’è½ï¼Œå¼€é—­åŸåˆ™å½¢åŒè™šè®¾ã€‚ä¸ç®¡æ˜¯å‰ç«¯è¿˜æ˜¯åç«¯ï¼Œè¿™æ˜¯éƒ½æ˜¯ä¸€ä¸ªéå¸¸å¤§çš„æŒ‘æˆ˜ã€‚</strong></p><p>ç°çŠ¶å°±æ˜¯æœ¬æ–‡æ ‡é¢˜ä¸­è®²çš„ï¼Œå¤šäº†ä¸€ä¸ªç»´åº¦ä¹‹åï¼Œå¯¹å¼€å‘è€Œè¨€æ˜¯ç¾éš¾æ€§æ€§ï¼Œæ•´ä¸ªé¡¹ç›®å°±æ˜¯ä¸€ä¸ªå¤§æ³¥çƒã€‚</p><p>æ‰€æœ‰è¡Œä¸šçš„ä»£ç éƒ½å †ç Œåœ¨ä¸€èµ·ï¼Œå……æ–¥ç€å„ç§åŒºåˆ†è¡Œä¸šçš„ if/else è¯­å¥ã€è€¦åˆç‰µæ‰¯ã€æ¸—é€åœ¨é¡¹ç›®çš„å„ä¸ªè§’è½â€¦ æ€»ä¹‹è¿™å¯èƒ½æ˜¯ç¨‹åºç”Ÿæ¶¯éš¾å¾—ä¸€è§çš„ä»£ç å±å±±ï¼</p><p><img src="/images/to-be-shit/Untitled%204.png" alt="ç»™å¤§å®¶ä¸€ä¸ªç›´è§‚çš„ä½“éªŒ"><br>ç»™å¤§å®¶ä¸€ä¸ªç›´è§‚çš„ä½“éªŒ</p><p><br><br><br></p><p>å‚ç›´çš„è½¯ä»¶æ‹†åˆ†æœ‰å¾ˆå¤šæ–¹æ³•è®ºï¼Œæ¯”å¦‚å¾®æœåŠ¡ã€ DDDã€‚è€Œå¤šä¸šæ€ï¼Œåœ¨è½¯ä»¶è¡Œä¸šå¹¶æ‰¾ä¸åˆ°å¤ªå¤šè¿™æ ·çš„æœ€ä½³å®è·µã€‚</p><p>ä¸”ä¸è®ºè¿™æ˜¯å¦æ˜¯æˆ˜ç•¥ä¸Šçš„é”™è¯¯ã€‚ä½œä¸ºæŠ€æœ¯å¼€å‘æˆ‘ä»¬åªèƒ½æœä»å®ƒï¼Œ å¹¶éœ€æ±‚åœ¨æˆ˜æœ¯ä¸Šè¿›è¡Œå¼¥è¡¥ã€‚<strong>ä¼ä¸šå¯¹è½¯ä»¶å¼€å‘çš„è¦æ±‚å¹¶ä¸ä¼šå› æ­¤é™ä½ï¼Œå®ƒè¿˜æ˜¯ä¼šè¦æ±‚ä½ çš„ä»£ç è¦åŒºåˆ«ã€Œå¤ç”¨æ€§ã€ï¼Œè¦èƒ½å¿«é€Ÿåº”å˜å„ç§éœ€æ±‚ã€æ”¯æŒå¿«é€Ÿè¿­ä»£â€¦</strong></p><p><img src="/images/to-be-shit/Untitled%205.png" alt="äº§å“æ¶æ„"><br>äº§å“æ¶æ„</p><p><br></p><p>ä¸Šå›¾æ˜¯æˆ‘ä»¬å›¢é˜ŸåŸºæœ¬ç»“æ„ï¼Œä¹Ÿæ˜¯<code>äº§å“ç»“æ„</code>(åº·å¨å®šå¾‹)ã€æ›´ä½“ç°äº†æˆ‘ä»¬çš„<code>é¡¹ç›®äº¤ä»˜æ¨¡å¼</code>ã€‚å¾ˆå¤šé SasS åŒ–çš„ 2B å…¬å¸çš„åº”è¯¥éƒ½æ˜¯è¿™ç±»æ¨¡å¼ã€‚</p><p>å¯¹æˆ‘ä»¬æ¥è¯´æ›´å¤§çš„æŒ‘æˆ˜åœ¨äºï¼š<strong>ä¸‹æ¸¸çš„é¡¹ç›®èƒ½å°½é‡å¤ç”¨ä¸Šæ¸¸çš„åŠŸèƒ½ï¼Œé¿å…é‡å¤å·¥ä½œï¼Œå¹¶ä¸”è¦æ±‚ä¸Šæ¸¸çš„æ›´æ–°èƒ½å‘ä¸‹ä¼ é€’ï¼Œç”šè‡³ä¸æ’é™¤ä¸‹æ¸¸åˆå¹¶åˆ°ä¸Šæ¸¸çš„å¯èƒ½æ€§ã€‚</strong></p><p>èƒ½æ„Ÿå—åˆ°å®ƒçš„éš¾åº¦äº†å—ï¼Ÿ</p><p><br><br><br></p><h1 id="æ€ä¹ˆè§£å†³ï¼Ÿ"><a href="#æ€ä¹ˆè§£å†³ï¼Ÿ" class="headerlink" title="æ€ä¹ˆè§£å†³ï¼Ÿ"></a>æ€ä¹ˆè§£å†³ï¼Ÿ</h1><h2 id="æˆ˜ç•¥ä¸Šçš„è°ƒæ•´"><a href="#æˆ˜ç•¥ä¸Šçš„è°ƒæ•´" class="headerlink" title="æˆ˜ç•¥ä¸Šçš„è°ƒæ•´"></a>æˆ˜ç•¥ä¸Šçš„è°ƒæ•´</h2><p>ä»è¿‘å‡ å¹´ç»„ç»‡æ¶æ„ä¸Šé¢çš„è°ƒæ•´ï¼Œå¯ä»¥åæ˜ è½¯ä»¶æ¶æ„çš„æˆ˜ç•¥è°ƒæ•´ï¼Œå®ƒå®šä¸‹æ•´ä¸ªç ”å‘ä½“ç³»çš„åŸºè°ƒã€‚å¦å¤–è¿™äº›å˜åŒ–ï¼Œä¹Ÿåæ˜ äº†æˆ‘ä»¬å¯¹ 2B è¡Œä¸šæ¢ç´¢å’Œè®¤çŸ¥ä¸Šé¢çš„å˜åŒ–ï¼š</p><p><img src="/images/to-be-shit/Untitled%206.png" alt="å•ä½“å›¢é˜Ÿ"></p><p>åˆåˆ›å›¢é˜Ÿå°±æ˜¯ä¸€ä¸ªå•ä½“å›¢é˜Ÿ(å·¦å›¾æ‰€ç¤º)ï¼Œæ¥ç€å¼€å§‹å¤šè¡Œä¸šæ’’ç½‘ï¼ŒåŸæœ¬çš„é¡¹ç›®ä¸Šæ…¢æ…¢å †ç Œå‡ºå„ç§è¡Œä¸šçš„å½¢æ€(å³å›¾æ‰€ç¤º)ã€‚</p><p><br></p><hr><p><br></p><p><img src="/images/to-be-shit/Untitled%207.png" alt="æ‹†åˆ†äº‹ä¸šéƒ¨"></p><p>éšç€ä¸šåŠ¡å‘å±•èµ·æ¥ï¼Œä¸€äº›å‘å±•è¾ƒå¥½çš„è¡Œä¸šæˆç«‹äº†äº‹ä¸šéƒ¨ï¼Œä¸“é—¨è´Ÿè´£é¡¹ç›®çš„äº¤ä»˜ã€‚</p><p><br></p><hr><p><br></p><p><img src="/images/to-be-shit/Untitled%208.png" alt="è¡Œä¸šæ ‡å“"></p><p>éšç€è¡Œä¸šçš„æ·±å…¥ï¼Œäº‹ä¸šéƒ¨æ…¢æ…¢ç§¯ç´¯èµ·æ¥äº†æ›´å¤šè¡Œä¸š <code>Known How</code>ï¼Œé€šç”¨çš„æ ‡å“å·²ç»æ— æ³•æ»¡è¶³éœ€æ±‚ï¼Œäº‹ä¸šéƒ¨å¼€å§‹æˆç«‹<code>è¡Œä¸šæ ‡å“å›¢é˜Ÿ</code>ï¼Œåœ¨è¡Œä¸šæ ‡å‡†åŒ–äº§å“ä¸Šåšæ›´å¤šæ·±å…¥çš„å®šåˆ¶å¼€å‘ï¼›å¦å¤–äº‹ä¸šéƒ¨å†…éƒ¨ç»§ç»­ç»†åˆ†ä¸“é—¨çš„äº¤ä»˜å›¢é˜Ÿã€‚</p><blockquote><p>ğŸ’¡ è¡Œä¸š Known How æŒ‡çš„æ˜¯æŸä¸ªè¡Œä¸šå†…éƒ¨ç‰¹å®šçš„ã€éå…¬å¼€çš„çŸ¥è¯†å’ŒæŠ€æœ¯ï¼Œé€šå¸¸åªæœ‰åœ¨è¯¥è¡Œä¸šå†…éƒ¨çš„ä»ä¸šäººå‘˜æ‰èƒ½å¤ŸæŒæ¡å’Œç†è§£ã€‚è¿™äº›çŸ¥è¯†å’ŒæŠ€æœ¯å¯èƒ½åŒ…æ‹¬è¡Œä¸šå†…éƒ¨çš„æ ‡å‡†ã€å·¥è‰ºã€æµç¨‹ã€æŠ€æœ¯ã€ç»éªŒç­‰æ–¹é¢çš„å†…å®¹ï¼Œæ˜¯è¡Œä¸šå†…éƒ¨çš„æ ¸å¿ƒç«äº‰åŠ›å’Œå•†ä¸šæœºå¯†ã€‚</p></blockquote><p>åˆ°è¿™ä¸ªé˜¶æ®µã€Œäº§å“ç ”å‘ã€å¼€å‘çš„ã€Œæ ‡å“ã€å°±å¤„äºä¸€ç§æ¯”è¾ƒå°´å°¬çš„ä½ç½®ã€‚ä¸€æ¥å®ƒæ¯•ç«Ÿä¸æ˜¯ä¸ºç‰¹å®šè¡Œä¸šæ‰“é€ çš„ï¼Œå·²ç»ä¸èƒ½æ»¡è¶³è¡Œä¸šçš„å®šåˆ¶åŒ–éœ€æ±‚ï¼Œæ— æ³•å®ç°å¼€ç®±å³ç”¨ï¼›äºŒæ¥äº§å“ç ”å‘éƒ¨é—¨ç¦»çœŸå®çš„å®¢æˆ·ä¹Ÿæ¯”è¾ƒè¿œï¼Œå¾ˆå®¹æ˜“é—­é—¨é€ è½¦ï¼Œäº§å“æ²¡æœ‰ç»è¿‡å¸‚åœºæ‰“ç£¨ï¼Œè´¨é‡è¾ƒå·®ã€‚</p><p>äººä»¬å¼€å§‹å¯¹ã€Œäº§å“ç ”å‘éƒ¨ã€çš„ä»·å€¼äº§ç”Ÿäº†æ€€ç–‘ã€‚</p><p><br></p><hr><p><br></p><p><img src="/images/to-be-shit/Untitled%209.png" alt="å¹³å°åŒ–"></p><p>äºæ˜¯ã€Œäº§å“ç ”å‘ã€çš„å‡ºè·¯æ˜¯ç»§ç»­åšä¸‹æ²‰ï¼Œä¸å†åšæ‰€è°“çš„å¤§è€Œå…¨æ ‡å“ï¼Œè€Œæ˜¯åšå¥½æ ¸å¿ƒçš„<code>å¹³å°åŒ–èƒ½åŠ›</code>ï¼Œæ¯”å¦‚ä¼šå‘˜ä½“ç³»ã€CDPã€SCRMã€MA(Marketing Automation)â€¦</p><p>è¿™äº›å¹³å°åŒ–èƒ½åŠ›ï¼Œå‰¥ç¦»äº†å…·ä½“çš„è¡Œä¸šå±æ€§ï¼Œå¹¶å‘æœªæ¥çš„ SaaS åŒ–é æ‹¢ã€‚</p><p><br></p><hr><p><br><br><br></p><p><strong>å¤šä¸šæ€çš„æ¶æ„éš¾é¢˜ï¼Œä»ç¬”è€…çš„è§’åº¦æ¥çœ‹ï¼Œåœ¨æˆ˜æœ¯ä¸Šæ˜¯åŸºæœ¬æ˜¯æ— è§£çš„</strong>ã€‚é€šè¿‡ä¸Šé¢çš„æˆ˜ç•¥è°ƒæ•´å¯ä»¥çœ‹å‡ºï¼Œæˆ‘ä»¬æ…¢æ…¢è§„é¿äº†è¿™äº›é—®é¢˜ã€‚</p><p>ä¹Ÿå°±è¯´ï¼Œæˆ‘ä»¬æ²¡æœ‰è§£å†³å®ƒï¼Œè€Œæ˜¯ç»•è¿‡äº†å®ƒï¼Œç”šè‡³è¯´æˆ‘ä»¬æ”¾å¼ƒäº†è¿™æ¡è·¯çº¿ä¹Ÿä¸ä¸ºè¿‡ã€‚</p><p>é€šè¿‡ä¸Šé¢çš„è°ƒæ•´æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼š</p><ul><li>è¦†ç›–çš„è¡Œä¸šåœ¨æ…¢æ…¢æ”¶æ•›ï¼Œä¸èµšé’±çš„ã€èµ°ä¸é€šçš„è¡Œä¸šå¹²è„†å°±æ”¾å¼ƒäº†ã€‚</li><li>å¦ä¸€æ–¹é¢ï¼Œåœ¨å…·ä½“è¡Œä¸šå’Œå¹³å°ä¸Šæ›´åŠ ä¸“æ³¨ï¼Œä¸å†è¿½æ±‚æ‰“é€ ä¸€ä¸ªå¤§è€Œå…¨çš„ã€å¯ä»¥è¦†ç›–å¤šè¡Œä¸šçš„å•ä¸€äº§å“ã€‚</li></ul><p><br><br><br><br><br></p><h2 id="æˆ˜æœ¯ä¸Šçš„é€‚é…"><a href="#æˆ˜æœ¯ä¸Šçš„é€‚é…" class="headerlink" title="æˆ˜æœ¯ä¸Šçš„é€‚é…"></a>æˆ˜æœ¯ä¸Šçš„é€‚é…</h2><p>è™½ç„¶ï¼Œæˆ‘ä»¬æœ€ç»ˆé€šè¿‡æˆ˜ç•¥ä¸Šçš„è°ƒæ•´è§„é¿äº†å¤šä¸šæ€æ¶æ„éš¾é¢˜ï¼Œä½†è¿™æ¯•ç«Ÿæ˜¯ã€Œ<code>æœ</code>ã€ã€‚æ¨åŠ¨æˆ˜ç•¥ä¸Šè°ƒæ•´çš„ã€Œ<code>å› </code>ã€ï¼Œå¹¶ä¸æ˜¯å› ä¸ºæˆ˜æœ¯ä¸Šçš„å®æ–½éš¾åº¦ï¼Œè€Œæ˜¯ä¼ä¸šçš„å¸‚åœºé€‚åº”ã€‚</p><p>è™½ç„¶æˆ˜ç•¥çš„è°ƒæ•´å¯ä»¥ä»æ ¹ä¸Šè§£å†³äº†é—®é¢˜ï¼Œä½†è¿™æ˜¯ä¸€ä¸ªæ¼«é•¿çš„æ¼”è¿›è¿‡ç¨‹(å¤§æ¦‚äº”å¹´)ã€‚ ä¸€å¼€å§‹æˆ‘ä»¬ä¹Ÿé¢„æ–™ä¸åˆ°ç°åœ¨çš„ç»“å±€ã€‚å› æ­¤åœ¨è¿‡å»ç›¸å½“é•¿çš„æ—¶é—´å†…ï¼Œæˆ‘ä»¬ä¸€ç›´éƒ½åœ¨å°è¯•<code>æˆ˜æœ¯å±‚é¢</code>å»è§£å†³å¤šä¸šæ€é—®é¢˜ã€‚</p><p>ä¸‹é¢è®²ä¸€è®²ï¼Œå‰ç«¯æ˜¯æ€ä¹ˆåº”å¯¹è¿™äº›é—®é¢˜ã€‚</p><p><br><br><br></p><h3 id="åŸåˆ™"><a href="#åŸåˆ™" class="headerlink" title="åŸåˆ™"></a>åŸåˆ™</h3><p>é¦–å…ˆç¡®ç«‹ä¸€äº›è¡Œäº‹çš„åŸåˆ™ï¼Œä½œä¸ºåé¢å…·ä½“å®æ–½çš„æŒ‡å¯¼æ–¹å‘ï¼Œ æ¯”å¦‚ï¼š</p><ul><li><strong>ç»Ÿä¸€è§„èŒƒ</strong>ã€‚å®Œæ•´çš„é¡¹ç›®ç‰ˆå›¾è®¾è®¡åˆ°å¾ˆå¤šå›¢é˜Ÿã€ä¸Šä¸‹æ¸¸çš„å‚ä¸ï¼Œæˆ‘ä»¬å¿…é¡»ç»Ÿä¸€è§„èŒƒã€‚</li><li><strong>ä¿æŒæ²Ÿé€š</strong>ã€‚å› ä¸ºæˆ‘ä»¬éœ€è¦æ‹‰é€šä¸Šä¸‹æ¸¸ï¼Œè¿›è¡Œä¸€äº›çŸ¥è¯†å’Œä»£ç çš„ä¼ é€’ï¼Œæ²Ÿé€šæ˜¯å¾ˆé‡è¦çš„ã€‚</li><li><strong>æ›´æ–°/è”åŠ¨ï¼Œéš”ç¦»/å¤ç”¨æœºåˆ¶</strong>ã€‚æˆ‘ä»¬éœ€è¦åœ¨æ¡†æ¶å±‚é¢æä¾›ä»£ç ä¸Šä¸‹æ¸¸æ›´æ–°ã€è”åŠ¨ï¼Œå¤ç”¨ã€éš”ç¦»ç­‰æœºåˆ¶ã€‚</li><li><strong>ç”Ÿæ€å…±å»º</strong>ã€‚è§„å®šä¸Šä¸‹æ¸¸å›¢é˜Ÿéœ€è¦ä¸€èµ·å…±å»ºç”Ÿæ€ï¼Œæ²‰æ·€çŸ¥è¯†å’Œè¡Œä¸š Known How.</li><li><strong>äº’ä¸å½±å“ã€ç‹¬ç«‹å¼€å‘ã€ç‹¬ç«‹éƒ¨ç½²</strong>ã€‚</li><li><strong>å¼€é—­åŸåˆ™</strong>ã€‚å¯¹ä¸‹æ¸¸æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ã€‚</li><li><strong>åˆ†ç¦»å…³æ³¨ç‚¹</strong>ã€‚</li></ul><p><br><br><br></p><h3 id="ç¡®ç«‹å…±å»ºçš„èŒƒå›´å’Œä¸Šä¸‹æ¸¸çš„åä½œå…³ç³»"><a href="#ç¡®ç«‹å…±å»ºçš„èŒƒå›´å’Œä¸Šä¸‹æ¸¸çš„åä½œå…³ç³»" class="headerlink" title="ç¡®ç«‹å…±å»ºçš„èŒƒå›´å’Œä¸Šä¸‹æ¸¸çš„åä½œå…³ç³»"></a>ç¡®ç«‹å…±å»ºçš„èŒƒå›´å’Œä¸Šä¸‹æ¸¸çš„åä½œå…³ç³»</h3><p><img src="/images/to-be-shit/Untitled%2010.png" alt="ååŒ"></p><p>å³å®šä¹‰äº†ä¸€äº›å›¢é˜Ÿä¹‹é—´çš„åä½œè§„èŒƒï¼Œæ¯”å¦‚ï¼š</p><ul><li>ä¸Šä¸‹æ¸¸å›¢é˜Ÿä¹‹é—´è´£ä»»åˆ’åˆ†ã€å…±å»ºçš„èŒƒå›´</li><li>æ²Ÿé€šæœºåˆ¶</li><li>å‘å¸ƒæ›´æ–°çš„é¢‘ç‡å’Œå½¢å¼</li><li>åˆ†æ”¯è§„èŒƒç­‰ç­‰</li></ul><p><br><br><br></p><h3 id="å®è§‚ä¸Šï¼šè¡Œä¸šéš”ç¦»-ä¸šåŠ¡èšåˆ"><a href="#å®è§‚ä¸Šï¼šè¡Œä¸šéš”ç¦»-ä¸šåŠ¡èšåˆ" class="headerlink" title="å®è§‚ä¸Šï¼šè¡Œä¸šéš”ç¦»/ä¸šåŠ¡èšåˆ"></a>å®è§‚ä¸Šï¼šè¡Œä¸šéš”ç¦»/ä¸šåŠ¡èšåˆ</h3><p>åœ¨å®è§‚çš„å±‚é¢ä¸Šï¼Œå®šä¹‰äº†ä¸¤å¤§æªæ–½æˆ–å»ºè®®ï¼š</p><ol><li><strong>è¡Œä¸šéš”ç¦»</strong>ã€‚ä¸ºäº†éš”ç¦»ä¸åŒä¸šæ€ï¼Œæˆ‘ä»¬æå‡ºäº†ä¸¤ä¸ªæªæ–½<ul><li>åˆ†æ”¯éš”ç¦»ã€‚ä¸åŒä¸šæ€æœ‰ä¸åŒçš„åˆ†æ”¯å‰ç¼€(æ¯”å¦‚<code>å›¢é˜Ÿå/dev</code>ã€<code>å›¢é˜Ÿå/master</code>)ï¼Œä»è€Œåšåˆ°å¼€å‘ä¸Šäº’ä¸å¹²æ‰°ã€‚å¯ä»¥ä»ä¸Šæ¸¸æ ‡å“å›¢é˜Ÿçš„åˆ†æ”¯ä¸­<code>å•å‘åˆå¹¶</code>ï¼Œæ¥å®ç°ä¸‹æ¸¸åŒæ­¥</li><li>æ¨¡å—/æ–‡ä»¶çš„éš”ç¦»ã€‚åœ¨è¿™é‡Œæˆ‘ä»¬ä¸»è¦ä½¿ç”¨<code>ä¸šæ€æ‰©å±•å</code>ï¼Œ æ¯”å¦‚ <code>index.js</code>ã€<code>index.ky.js</code>ã€<code>index.home.js</code>, æœ‰ç‚¹ç±»ä¼¼äº <code>React Native</code>ï¼ˆ<code>*.android.js</code>, <code>*.ios.js</code>ï¼‰ æˆ–è€… <code>Taro</code> çš„ç‰¹å®šå¹³å°æ–‡ä»¶ã€‚åœ¨ç¼–è¯‘æ—¶ï¼Œæ ¹æ®å½“å‰ä¸šæ€è¿›è¡Œæ¡ä»¶ç¼–è¯‘ã€‚</li></ul></li><li><p><strong>æŒ‰ç…§ä¸šåŠ¡èšåˆ</strong>ã€‚æ¨¡å—æŒ‰ç…§ä¸šåŠ¡è¿›è¡Œèšåˆï¼Œè€Œä¸æ˜¯æ ¹æ®èœå•/èŒèƒ½ï¼š</p><ul><li>âŒ  èœå•ã€‚è¿™ä¸ªé—®é¢˜ä¸»è¦å‡ºåœ¨ B ç«¯ï¼Œå¾ˆå¤šå‰ç«¯ç†æ‰€å½“ç„¶ä¼šæŒ‰ç…§å¯¼èˆªèœå•æ¥æ‹†åˆ†åº”ç”¨ï¼Œé—®é¢˜å°±æ˜¯èœå•å¹¶ä¸ä¸€å®šèƒ½å‡†ç¡®åœ°è¡¨è¾¾ä¸šåŠ¡çš„è¾¹ç•Œï¼Œè€Œä¸”èœå•æ˜¯å¤šå˜çš„ï¼Œå—è¿è¥çš„å½±å“æ¯”è¾ƒå¤§ã€‚<br>è¿™ä¸ªæˆ‘åœ¨ <a href="https://www.notion.so/b590284a71934f97a1db71ef967fbc5a?pvs=21" target="_blank" rel="noopener">å¾®å‰ç«¯çš„è½åœ°å’Œæ²»ç†å®æˆ˜</a> ä¸­ä¹Ÿæœ‰è®¨è®º</li><li><p>âŒ  èŒèƒ½èšåˆã€‚ä¾‹å¦‚, å…¨å±€æŒ‰ç…§èŒèƒ½åˆ’åˆ†ç›®å½•ï¼Œæ‰€æœ‰ä¸šåŠ¡æ¨¡å—éƒ½å †åœ¨ä¸€èµ·</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">src</span><br><span class="line">  /components</span><br><span class="line">  A.js</span><br><span class="line">    B.js</span><br><span class="line">  /pages</span><br><span class="line">  /api</span><br><span class="line">  /...</span><br></pre></td></tr></table></figure></li><li><p>âœ… ä¸šåŠ¡èšåˆã€‚<strong>æŒ‰ç…§ä¸šåŠ¡é¢†åŸŸçš„è¾¹ç•Œè¿›è¡Œå‚ç›´çš„æ‹†åˆ†ï¼š</strong></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">A é¢†åŸŸ</span><br><span class="line">  /components</span><br><span class="line">  /pages</span><br><span class="line">  /api</span><br><span class="line"></span><br><span class="line">B é¢†åŸŸ</span><br><span class="line">  /components</span><br><span class="line">  /pages</span><br><span class="line">  /api</span><br></pre></td></tr></table></figure></li></ul></li></ol><p><br><br><br><br><br></p><h3 id="å¾®è§‚ä¸Šï¼šå¤ç”¨å’Œæ‰©å±•æ¨¡å¼"><a href="#å¾®è§‚ä¸Šï¼šå¤ç”¨å’Œæ‰©å±•æ¨¡å¼" class="headerlink" title="å¾®è§‚ä¸Šï¼šå¤ç”¨å’Œæ‰©å±•æ¨¡å¼"></a>å¾®è§‚ä¸Šï¼šå¤ç”¨å’Œæ‰©å±•æ¨¡å¼</h3><p>å®è§‚çš„åˆ†æ”¯ã€ä¸šæ€æ‰©å±•åå¯ä»¥å®ç°<code>è¡Œä¸šéš”ç¦»</code>ï¼Œè®©å¤šä¸ªå›¢é˜Ÿåœ¨åŒä¸€ä¸ªä»“åº“ä¸‹äº’ä¸å¹²æ‰°ï¼Œåˆå¯ä»¥èåˆå¼€å‘ã€‚</p><p>è€Œå¾®è§‚ä¸Šå±‚é¢ï¼Œä¸»è¦å…³æ³¨ä»£ç çš„å¤ç”¨å’Œæ‰©å±•æœºåˆ¶ï¼Œç›®çš„åˆ™æ˜¯è®©è¡Œä¸šèƒ½å¤Ÿæœ€å¤§é™åº¦åœ°ã€Œå¤ç”¨ã€<code>æ ‡å“</code>çš„åŠŸèƒ½å’Œä»£ç ã€‚</p><p><br><br><br></p><p>ç¬”è€…åœ¨å®è·µè¿‡ç¨‹ä¸­ï¼Œæ€»ç»“äº†å¾ˆå¤šã€Œè®¾è®¡æ¨¡å¼ã€ï¼Œ æ¯”å¦‚ï¼š</p><table><thead><tr><th>æ¨¡å¼</th><th>çµæ„Ÿæ¥æº</th><th>æ¦‚è¦è¯´æ˜</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td>åŸå­èƒ½åŠ›ç»„åˆæ¨¡å¼</td><td>ä½ä»£ç å¹³å°ï¼Œå‰ç«¯ç»„ä»¶åŒ–æ­å»ºï¼Œæµç¨‹ç¼–æ’</td><td>å…ˆå¯¹åº”ç”¨ç¨‹åºè¿›è¡Œåˆ†å±‚ï¼Œå†ç»„æˆæ‹†åˆ†åŸå­èƒ½åŠ›ã€‚å®ç°è‡ªä¸Šè€Œä¸‹çš„å¯ç»„åˆã€‚</td><td>åº”ç”¨çš„æ•´ä½“æ¶æ„</td></tr><tr><td>æ’ä»¶æ¨¡å¼</td><td>VSCodeã€å„ç§æ”¯æŒæ’ä»¶çš„å·¥å…·</td><td>åˆ†ç¦»å…³æ³¨ç‚¹ï¼Œæå–æ ¸å¿ƒèƒ½åŠ›å’Œå¤–å£³ã€‚é€šè¿‡æ’ä»¶æ¥å£æ‰©å±•æ ¸å¿ƒèƒ½åŠ›ã€‚</td><td>å›ºå®šã€ç¨³å®šçš„ä¸šåŠ¡</td></tr><tr><td>é’©å­æ¨¡å¼</td><td>å¾ˆå¤š Web æ¡†æ¶éƒ½æä¾›äº†é’©å­å‡½æ•°ã€æˆ–è€…ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼Œå¯¹æ¡†æ¶è¿›è¡Œæ‰©å±•</td><td>é¢„ç•™æ’æ§½ï¼ŒæŒ‰éœ€å¡«å……ã€‚</td><td>+ é€‚åˆæ¯”è¾ƒå›ºåŒ–çš„ä¸šåŠ¡æµç¨‹ï¼Œæ¯”å¦‚ç™»å½•ã€ä¸‹å•<br> + é€‚åˆæ¯”è¾ƒå›ºåŒ–çš„ç•Œé¢å¸ƒå±€ï¼Œé€šè¿‡æ’æ§½æ‰©å±•æŸä¸ªåŒºå—çš„æ˜¾ç¤º</td></tr><tr><td>è¦†ç›–æ¨¡å¼</td><td>ä¾èµ–æ³¨å…¥</td><td>é€šè¿‡ä¾èµ–æ³¨å…¥è¦†ç›–åŸæœ‰çš„å®ç°</td><td></td></tr><tr><td>ç»§æ‰¿æ¨¡å¼</td><td>ç±»ç»§æ‰¿</td><td>åœ¨è¦†ç›–æ¨¡å¼åŸºç¡€æ·±å…¥å®šåˆ¶</td><td>å®ç°æ–‡ä»¶çº§åˆ«çš„è¦†ç›–ï¼Œå®Œå…¨é‡æ–°å®ç°åŠŸèƒ½ã€‚å’Œ index å¯¼å‡ºå…¼å®¹ã€‚ä¸šæ€éš”ç¦»</td></tr><tr><td>é‡å¤/éš”ç¦»æ¨¡å¼</td><td>React Nativeã€Taro æ¡ä»¶ç¼–è¯‘</td><td>æ— å¯é€€è·¯çš„é€€è·¯ã€‚æ‹·è´ä»£ç ï¼Œæ·±åº¦å®šåˆ¶ï¼Œäº’ä¸å¹²æ‰°</td><td>å·®å¼‚æ€§è¾ƒå¤§ï¼Œæ²¡æœ‰åˆç†æ‰©å±•æ–¹æ¡ˆçš„æƒ…å†µ</td></tr></tbody></table><p>ç”±äºæ–‡ç« ç¯‡å¹…åŸå› ï¼Œ<strong>å…³äºè¿™äº›è®¾è®¡æ¨¡å¼çš„ç»†èŠ‚ï¼Œè¯·<a href="https://www.notion.so/358c4bafc42b42acacab2c74f3f21593?pvs=21" target="_blank" rel="noopener">ç§»æ­¥åˆ°è¿™é‡Œ</a></strong></p><p><br><br><br><br><br></p><h1 id="æ²¡æœ‰é“¶å¼¹"><a href="#æ²¡æœ‰é“¶å¼¹" class="headerlink" title="æ²¡æœ‰é“¶å¼¹"></a>æ²¡æœ‰é“¶å¼¹</h1><p>åœ¨å¤šä¸šæ€çš„æ¶æ„éš¾é¢˜ä¸Šï¼Œç¬”è€…å¹¶æ²¡æœ‰æƒ³åˆ°è¡Œä¹‹æœ‰æ•ˆçš„åŠæ³•ã€‚åè€Œéšç€æˆ˜ç•¥çš„è°ƒæ•´ï¼Œè¿™ä¸ªé—®é¢˜å˜å¾—ä¸å†é‡è¦ã€‚</p><p>ä¸Šæ–‡ä»‹ç»çš„æˆ˜æœ¯é€‚é…ï¼Œä¹Ÿä»…ä»…èƒ½å¤Ÿå®ç°ã€Œéš”ç¦»ã€é—®é¢˜ã€‚è€Œã€Œå¤ç”¨ã€é—®é¢˜ï¼Œæˆ‘åªæ˜¯ç»™å‡ºäº†ä¸€äº›è®¾è®¡æ¨¡å¼ï¼Œå®é™…æ‰§è¡Œèµ·æ¥æ¯”è¾ƒå›°éš¾ï¼šä¸€åˆ™æ˜¯éœ€æ±‚çš„å˜åŒ–å’Œå¤šæ ·æ€§è¶³ä»¥æ‰“ç ´å„ç§ç¾å¥½çš„å‡è®¾ï¼› äºŒæ¥è¿™ä¼šæå‡å¤æ‚åº¦ï¼Œä¸æ˜¯æ‰€æœ‰å¼€å‘è€…éƒ½å…·å¤‡è‰¯å¥½çš„æ¶æ„è®¾è®¡ç´ å…»ã€‚</p><p>æœ€åï¼Œéšç€å¸‚åœºçš„å˜åŒ–ï¼Œé©±åŠ¨ä¼ä¸šæˆ˜ç•¥ä¸Šçš„è°ƒæ•´ï¼Œä¼ä¸šå®¶é€æ¸æ”¾å¼ƒäº†åœ¨äº§å“ä¸Šåšå¤§åšå…¨çš„å¹»æƒ³ã€‚ æˆ‘ä»¬çš„å„ç§æŒ£æ‰ï¼Œæœ€ç»ˆä¸è¿‡æ˜¯ç‚®ç°ï¼Œå¹¶æ²¡æœ‰å¤ªå¤šå®é™…çš„æ„ä¹‰ã€‚</p><p><br><br><br></p><p>å½“ç„¶ï¼Œå¯¹æˆ‘æ¥è¯´ä¹Ÿä¸æ˜¯ä¸€æ— æ‰€è·ï¼Œ<strong>å†å²ç»éªŒæ•™è®­</strong>:</p><ul><li>ä¸è¦è¿‡åº¦è¿½æ±‚å¤ç”¨ã€‚å®ƒæ˜¯ä¸€æŠŠåŒåˆƒå‰‘ï¼Œé‡å¤ä¸è§å¾—å°±æ˜¯åäº‹ï¼Œæˆ‘ä»¬éœ€è¦åœ¨å¤ç”¨æ€§å’Œéš”ç¦»æ€§ä¹‹é—´æƒè¡¡åˆ©å¼Šã€‚</li><li>ä¸è¦è¿½æ±‚å¤§è€Œå…¨ã€‚æ›´è¦åšæ·±åšç²¾ã€‚</li><li>ç”¨å¥¥å¡å§†å‰ƒåˆ€åšå‡æ³•ã€‚æ”¾å¼ƒé‚£äº›ä¸åˆ‡å®é™…çš„å¹»æƒ³ã€‚</li><li>æˆ˜ç•¥å’Œæˆ˜æœ¯é…åˆã€‚ä¸è¦åªåœ¨æˆ˜æœ¯å±‚é¢é’»ç‰›è§’å°–ã€‚</li><li>Keep it simple and stupidã€‚ ç®€å•å³æ˜¯ç¾ï¼Œåœ¨è®¾è®¡å’Œå¼€å‘è¿‡ç¨‹ä¸­ï¼Œå°½é‡è¿½æ±‚ç®€å•å’Œæ˜“äºç†è§£çš„æ–¹æ¡ˆï¼Œé¿å…è¿‡åº¦è®¾è®¡å’Œå¤æ‚æ€§ã€‚å…³æ³¨ç”¨æˆ·æœ€æ ¸å¿ƒçš„éœ€æ±‚ã€‚</li></ul><p><br></p><p>æœ¬æ–‡å®Œï¼Œæ±‚èµæ±‚æ”¶è—æ±‚è½¬å‘ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;img src=&quot;/images/to-be-shit/Untitled.jpeg&quot; alt=&quot;cover&quot;&gt;&lt;/p&gt;
&lt;p&gt;ä»Šå¤©ç»™å¤§å®¶å¸¦æ¥çš„æ˜¯ 2B é¢†åŸŸçš„ä¸€ä¸ªæ¶æ„éš¾é¢˜ï¼Œæˆ‘ä»¬æœ€ç»ˆä¹Ÿæ²¡æœ‰æ‰¾åˆ°ä¸€ä¸ªè¾ƒå¥½ã€Œè§£å†³ã€æ–¹æ¡ˆï¼Œ æˆ–è€…è¯´å®ƒæœ¬æ¥å°±æ˜¯ä¸€ä¸ªä¼ªå‘½é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;è®©æˆ‘æ…¢æ…¢è·Ÿä½ é“
      
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://bobi.ink/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>TypeScript æ¥å£åˆå¹¶ï¼Œ ä½ ä¸çŸ¥é“çš„å¦™ç”¨</title>
    <link href="https://bobi.ink/2023/07/17/ts-interface-merge/"/>
    <id>https://bobi.ink/2023/07/17/ts-interface-merge/</id>
    <published>2023-07-16T16:00:00.000Z</published>
    <updated>2023-07-17T06:34:55.473Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/images/ts-interface-merge/Untitled.jpeg" alt="Untitled"></p><p><br></p><h1 id="åˆè¯†"><a href="#åˆè¯†" class="headerlink" title="åˆè¯†"></a>åˆè¯†</h1><p><a href="https://www.typescriptlang.org/docs/handbook/declaration-merging.html#merging-interfaces" target="_blank" rel="noopener">å£°æ˜åˆå¹¶(Declaration Merging)</a> æ˜¯ <code>Typescript</code> çš„ä¸€ä¸ªé«˜çº§ç‰¹æ€§ï¼Œé¡¾åæ€ä¹‰ï¼Œ<code>å£°æ˜åˆå¹¶</code>å°±æ˜¯å°†ç›¸åŒåç§°çš„ä¸€ä¸ªæˆ–å¤šä¸ªå£°æ˜åˆå¹¶ä¸ºå•ä¸ªå®šä¹‰ã€‚</p><p>ä¾‹å¦‚ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">interface Box &#123;</span><br><span class="line">  height: number;</span><br><span class="line">  width: number;</span><br><span class="line">&#125;</span><br><span class="line">interface Box &#123;</span><br><span class="line">  scale: number;</span><br><span class="line">&#125;</span><br><span class="line">let box: Box = &#123; height: 5, width: 6, scale: 10 &#125;;</span><br><span class="line"></span><br><span class="line">interface Cloner &#123;</span><br><span class="line">  clone(animal: Animal): Animal;</span><br><span class="line">&#125;</span><br><span class="line">interface Cloner &#123;</span><br><span class="line">  clone(animal: Sheep): Sheep;</span><br><span class="line">&#125;</span><br><span class="line">interface Cloner &#123;</span><br><span class="line">  clone(animal: Dog): Dog;</span><br><span class="line">  clone(animal: Cat): Cat;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Cloner å°†åˆå¹¶ä¸º</span><br><span class="line">//interface Cloner &#123;</span><br><span class="line">//  clone(animal: Dog): Dog;</span><br><span class="line">//  clone(animal: Cat): Cat;</span><br><span class="line">//  clone(animal: Sheep): Sheep;</span><br><span class="line">//  clone(animal: Animal): Animal;</span><br><span class="line">//&#125;</span><br></pre></td></tr></table></figure><p><br></p><p>å£°æ˜åˆå¹¶æœ€åˆçš„è®¾è®¡ç›®çš„æ˜¯ä¸ºäº†è§£å†³æ—©æœŸ <code>JavaScript</code> æ¨¡å—åŒ–å¼€å‘ä¸­çš„ç±»å‹å®šä¹‰é—®é¢˜ã€‚</p><ul><li>æ—©æœŸçš„ JavaScript åº“åŸºæœ¬éƒ½ä½¿ç”¨å…¨å±€çš„<code>å‘½åç©ºé—´</code>ï¼Œæ¯”å¦‚  <code>jQuery</code>  ä½¿ç”¨ <code>$</code>, <code>lodash</code> ä½¿ç”¨ <code>_</code>ã€‚è¿™äº›åº“é€šå¸¸è¿˜å…è®¸å¯¹å‘½åç©ºé—´è¿›è¡Œæ‰©å±•ï¼Œæ¯”å¦‚ jQuery å¾ˆå¤šæ’ä»¶å°±æ˜¯æ‰©å±• $ çš„åŸå‹æ–¹æ³•</li><li>æ—©æœŸå¾ˆå¤š Javascript åº“ä¹Ÿä¼šå»æ‰©å±•æˆ–è¦†ç›– JavaScript å†…ç½®å¯¹è±¡çš„åŸå‹ã€‚æ¯”å¦‚å¤æ—©çš„ RxJS å°±ä¼šå» ã€ŒMonkey Patchingã€ JavaScript çš„ Arrayã€Function ç­‰å†…ç½®åŸå‹å¯¹è±¡ã€‚</li></ul><p><br><br><br></p><p>å°½ç®¡è¿™äº›æ–¹æ¡ˆåœ¨å½“ä»Šå·²ç»å±äºã€Œåæ¨¡å¼ã€äº†ï¼Œä½†æ˜¯åœ¨ Typescript 2012 å¹´å‘å¸ƒé‚£ä¸ªå¹´ä»£ï¼Œ jQuery è¿˜æ˜¯ç‹è€…ã€‚</p><p><br></p><p>Typescript é€šè¿‡ç±»å‹åˆå¹¶è¿™ç§æœºåˆ¶ï¼Œæ”¯æŒå°†åˆ†æ•£åˆ°ä¸åŒçš„æ–‡ä»¶ä¸­çš„å‘½åç©ºé—´çš„ç±»å‹å®šä¹‰åˆå¹¶èµ·æ¥ï¼Œé¿å…ç¼–è¯‘é”™è¯¯ã€‚</p><p>ç°åœ¨æ˜¯ ES Module å½“é“ï¼Œ å‘½åç©ºé—´çš„æ¨¡å¼å·²ç»ä¸å†æµè¡Œã€‚ä½†æ˜¯ä¸å¦¨ç¢ <a href="https://www.typescriptlang.org/docs/handbook/declaration-merging.html#merging-interfaces" target="_blank" rel="noopener">å£°æ˜åˆå¹¶</a> ç»§ç»­å‘å…‰å‘çƒ­ï¼Œæœ¬æ–‡å°±è®²è®²å®ƒå‡ ä¸ªæœ‰è¶£çš„ä½¿ç”¨åœºæ™¯ã€‚</p><p><br><br><br><br><br></p><h1 id="jsx-å†…ç½®ç»„ä»¶å£°æ˜"><a href="#jsx-å†…ç½®ç»„ä»¶å£°æ˜" class="headerlink" title="JSX å†…ç½®ç»„ä»¶å£°æ˜"></a>JSX å†…ç½®ç»„ä»¶å£°æ˜</h1><p>Typescript ä¸‹ï¼Œå†…ç½®çš„ç»„ä»¶(<code>Host Components</code>) éƒ½æŒ‚è½½åœ¨ <code>JSX</code> å‘½åç©ºé—´ä¸‹çš„ <code>IntrinsicElements</code> æ¥å£ä¸­ã€‚ä¾‹å¦‚ Vue çš„ JSX å£°æ˜ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">// somehow we have to copy=pase the jsx-runtime types here to make TypeScript happy</span><br><span class="line">import type &#123;</span><br><span class="line">  VNode,</span><br><span class="line">  IntrinsicElementAttributes,</span><br><span class="line">  ReservedProps,</span><br><span class="line">  NativeElements</span><br><span class="line">&#125; from &apos;@vue/runtime-dom&apos;</span><br><span class="line"></span><br><span class="line">// ğŸ”´ å…¨å±€ä½œç”¨åŸŸ</span><br><span class="line">declare global &#123;</span><br><span class="line">  namespace JSX &#123;</span><br><span class="line">    export interface Element extends VNode &#123;&#125;</span><br><span class="line">    export interface ElementClass &#123;</span><br><span class="line">      $props: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    export interface ElementAttributesProperty &#123;</span><br><span class="line">      $props: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    // ğŸ”´ å†…ç½®ç»„ä»¶å®šä¹‰</span><br><span class="line">    export interface IntrinsicElements extends NativeElements &#123;</span><br><span class="line">      // allow arbitrary elements</span><br><span class="line">      // @ts-ignore suppress ts:2374 = Duplicate string index signature.</span><br><span class="line">      [name: string]: any</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    export interface IntrinsicAttributes extends ReservedProps &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥éšæ„åœ°æ‰©å±• IntrinsicElementsï¼Œä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å¼€å‘äº†ä¸€äº› <code>Web Component</code> ç»„ä»¶ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">declare global &#123;</span><br><span class="line">  namespace JSX &#123;</span><br><span class="line">    export interface IntrinsicElements &#123;</span><br><span class="line">      &apos;wkc-header&apos;: &#123;</span><br><span class="line">        // props å®šä¹‰</span><br><span class="line">        title?: string;</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><blockquote><p>ğŸ’¡ ä¸Šé¢ä¾‹å­ä¸­ JSX æ˜¯æ”¾åœ¨ <code>global</code> ç©ºé—´ä¸‹çš„ï¼ŒæŸäº›æç«¯çš„åœºæ™¯ä¸‹ï¼Œæ¯”å¦‚æœ‰å¤šä¸ªåº“éƒ½æ‰©å±•äº†å®ƒï¼Œæˆ–è€…ä½ å³ç”¨äº† Vue åˆç”¨äº† Reactï¼Œ é‚£ä¹ˆå°±ä¼šäº’ç›¸æ±¡æŸ“ã€‚<br> ç°åœ¨ Typescript ä¹Ÿæ”¯æŒ JSX å®šä¹‰çš„å±€éƒ¨åŒ–ï¼Œé…åˆ <a href="https://www.typescriptlang.org/tsconfig#jsxImportSource" target="_blank" rel="noopener">jsxImportSource</a> é€‰é¡¹æ¥å¼€å¯ï¼Œ å‚è€ƒ <a href="https://github.com/vuejs/core/blob/main/packages/vue/jsx-runtime/index.d.ts" target="_blank" rel="noopener">Vue çš„å®ç°</a></p></blockquote><p><br><br><br><br><br></p><h1 id="vue-å…¨å±€ç»„ä»¶å£°æ˜"><a href="#vue-å…¨å±€ç»„ä»¶å£°æ˜" class="headerlink" title="Vue å…¨å±€ç»„ä»¶å£°æ˜"></a>Vue å…¨å±€ç»„ä»¶å£°æ˜</h1><p>å’Œ JSX ç±»ä¼¼ï¼Œ Vue å…¨å±€ç»„ä»¶ã€å…¨å±€å±æ€§ç­‰å£°æ˜ä¹Ÿé€šè¿‡æ¥å£åˆå¹¶æ¥å®ç°ã€‚ä¸‹é¢æ˜¯ vue-router çš„ä»£ç ç¤ºä¾‹ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">declare module &apos;@vue/runtime-core&apos; &#123;</span><br><span class="line">  // Optional API æ‰©å±•</span><br><span class="line">  export interface ComponentCustomOptions &#123;</span><br><span class="line">    beforeRouteEnter?: TypesConfig extends Record&lt;&apos;beforeRouteEnter&apos;, infer T&gt;</span><br><span class="line">      ? T</span><br><span class="line">      : NavigationGuardWithThis&lt;undefined&gt;</span><br><span class="line">    beforeRouteUpdate?: TypesConfig extends Record&lt;&apos;beforeRouteUpdate&apos;, infer T&gt;</span><br><span class="line">      ? T</span><br><span class="line">      : NavigationGuard</span><br><span class="line">    beforeRouteLeave?: TypesConfig extends Record&lt;&apos;beforeRouteLeave&apos;, infer T&gt;</span><br><span class="line">      ? T</span><br><span class="line">      : NavigationGuard</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // ç»„ä»¶å®ä¾‹å±æ€§</span><br><span class="line">  export interface ComponentCustomProperties &#123;</span><br><span class="line">    $route: TypesConfig extends Record&lt;&apos;$route&apos;, infer T&gt;</span><br><span class="line">      ? T</span><br><span class="line">      : RouteLocationNormalizedLoaded</span><br><span class="line">    $router: TypesConfig extends Record&lt;&apos;$router&apos;, infer T&gt; ? T : Router</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // ğŸ”´ å…¨å±€ç»„ä»¶</span><br><span class="line">  export interface GlobalComponents &#123;</span><br><span class="line">    RouterView: TypesConfig extends Record&lt;&apos;RouterView&apos;, infer T&gt;</span><br><span class="line">      ? T</span><br><span class="line">      : typeof RouterView</span><br><span class="line">    RouterLink: TypesConfig extends Record&lt;&apos;RouterLink&apos;, infer T&gt;</span><br><span class="line">      ? T</span><br><span class="line">      : typeof RouterLink</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p>ä¸Šé¢æˆ‘ä»¬è§è¯†äº† JSX ä½¿ç”¨ <code>declare global</code>  æ¥æŒ‚è½½<code>å…¨å±€ä½œç”¨åŸŸ</code>ï¼Œè€Œ <code>declare module *</code> åˆ™å¯ä»¥æŒ‚è½½åˆ°<code>å…·ä½“æ¨¡å—çš„ä½œç”¨åŸŸ</code>ä¸­ã€‚</p><p><br></p><p>å¦å¤–ï¼Œæˆ‘ä»¬åœ¨å®šä¹‰ Vue Route æ—¶ï¼Œé€šå¸¸ä¼šä½¿ç”¨ meta æ¥å®šä¹‰ä¸€äº›è·¯ç”±å…ƒæ•°æ®ï¼Œæ¯”å¦‚æ ‡é¢˜ã€æƒé™ä¿¡æ¯ç­‰,  ä¹Ÿå¯ä»¥é€šè¿‡ä¸Šé¢çš„æ–¹å¼æ¥å®ç°ï¼š</p><p><br></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">declare module &apos;vue-router&apos; &#123;</span><br><span class="line">  interface RouteMeta &#123;</span><br><span class="line">    /**</span><br><span class="line">     * æ˜¯å¦æ˜¾ç¤ºé¢åŒ…å±‘, é»˜è®¤ false</span><br><span class="line">     */</span><br><span class="line">    breadcrumb?: boolean</span><br><span class="line">    </span><br><span class="line">    /**</span><br><span class="line">     * æ ‡é¢˜</span><br><span class="line">     */</span><br><span class="line">    title?: string</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * æ‰€éœ€æƒé™</span><br><span class="line">     */</span><br><span class="line">    permissions?: string[]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">export const routes: RouteRecordRaw[] = [ </span><br><span class="line">  &#123;</span><br><span class="line">    path: &apos;/club/plugins&apos;,</span><br><span class="line">    name: &apos;custom-club-plugins&apos;,</span><br><span class="line">    component: () =&gt; import(&apos;./plugins&apos;),</span><br><span class="line">    // ç°åœ¨ meta å°±æ”¯æŒç±»å‹æ£€æŸ¥äº†</span><br><span class="line">    meta: &#123;</span><br><span class="line">      breadcrumb: true,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  // ...</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p><br><br><br><br><br></p><h1 id="ä¾èµ–æ³¨å…¥ï¼šå®ç°æ ‡è¯†ç¬¦å’Œç±»å‹ä¿¡æ¯ç»‘å®š"><a href="#ä¾èµ–æ³¨å…¥ï¼šå®ç°æ ‡è¯†ç¬¦å’Œç±»å‹ä¿¡æ¯ç»‘å®š" class="headerlink" title="ä¾èµ–æ³¨å…¥ï¼šå®ç°æ ‡è¯†ç¬¦å’Œç±»å‹ä¿¡æ¯ç»‘å®š"></a>ä¾èµ–æ³¨å…¥ï¼šå®ç°æ ‡è¯†ç¬¦å’Œç±»å‹ä¿¡æ¯ç»‘å®š</h1><p>è¿˜æœ‰ä¸€ä¸ªæ¯”è¾ƒæœ‰è¶£çš„ä½¿ç”¨åœºæ™¯ï¼Œå³ä¾èµ–æ³¨å…¥ã€‚æˆ‘ä»¬åœ¨ä½¿ç”¨ <code>[InversifyJS](https://github.com/inversify/InversifyJS)</code> è¿™é‡Œä¾èµ–æ³¨å…¥åº“æ—¶ï¼Œé€šå¸¸éƒ½ä¼šä½¿ç”¨å­—ç¬¦ä¸²æˆ–è€… Symbol æ¥ä½œä¸ºä¾èµ–æ³¨å…¥çš„<code>æ ‡è¯†ç¬¦</code>ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">// inversify ç¤ºä¾‹</span><br><span class="line">// å®šä¹‰æ ‡è¯†ç¬¦</span><br><span class="line">const TYPES = &#123;</span><br><span class="line">    Warrior: Symbol.for(&quot;Warrior&quot;),</span><br><span class="line">    Weapon: Symbol.for(&quot;Weapon&quot;),</span><br><span class="line">    ThrowableWeapon: Symbol.for(&quot;ThrowableWeapon&quot;)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">@injectable()</span><br><span class="line">class Ninja implements Warrior &#123;</span><br><span class="line">    @inject(TYPES.Weapon) private _katana: Weapon;</span><br><span class="line">    @inject(TYPES.ThrowableWeapon) private _shuriken: ThrowableWeapon;</span><br><span class="line">    public fight() &#123; return this._katana.hit(); &#125;</span><br><span class="line">    public sneak() &#123; return this._shuriken.throw(); &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p>ä½†æ˜¯è¿™ç§æ ‡è¯†ç¬¦æ²¡æœ‰å…³è”ä»»ä½•ç±»å‹ä¿¡æ¯ï¼Œæ— æ³•è¿›è¡Œç±»å‹æ£€æŸ¥å’Œæ¨æ–­ã€‚</p><p><br></p><p>äºæ˜¯ï¼Œç¬”è€…å°±æƒ³åˆ°äº†<code>æ¥å£åˆå¹¶</code>ã€‚èƒ½ä¸èƒ½åˆ©ç”¨å®ƒæ¥å®ç°æ ‡è¯†ç¬¦å’Œç±»å‹ä¹‹é—´çš„ç»‘å®šï¼Ÿç­”æ¡ˆæ˜¯å¯ä»¥çš„ï¼š</p><p>æˆ‘ä»¬å¯ä»¥å£°æ˜ä¸€ä¸ªå…¨å±€çš„ <code>DIMapper</code> æ¥å£ã€‚è¿™ä¸ªæ¥å£çš„ key ä¸ºä¾èµ–æ³¨å…¥çš„æ ‡è¯†ç¬¦ï¼Œvalue ä¸ºä¾èµ–æ³¨å…¥ç»‘å®šçš„ç±»å‹ä¿¡æ¯ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">declare global &#123;</span><br><span class="line">  interface DIMapper &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p>æ¥ä¸‹æ¥ï¼Œä¾èµ–æ³¨å…¥çš„ã€ä¾›åº”å•†ã€ï¼Œå°±å¯ä»¥ç”¨æ¥å£°æ˜æ ‡è¯†ç¬¦å’Œæ³¨å…¥ç±»å‹çš„ç»‘å®šå…³ç³»ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">interface IPhone &#123;</span><br><span class="line">  /**</span><br><span class="line">   * æ‰“ç”µè¯</span><br><span class="line">   */</span><br><span class="line">  call(num: string): void</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * å‘çŸ­ä¿¡</span><br><span class="line">   */</span><br><span class="line">  sendMessage(num: string, message: string): void</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// è¡¨ç¤º DI.IPhone è¿™ä¸ªæ ‡è¯†ç¬¦å…³è”çš„å°±æ˜¯ IPhone æ¥å£ç±»å‹</span><br><span class="line">declare global &#123;</span><br><span class="line">  interface DIMapper &#123;</span><br><span class="line">    &apos;DI.IPhone&apos;: IPhone</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p>æˆ‘ä»¬ç¨å¾®æ”¹é€ ä¸€ä¸‹ä¾èµ–æ³¨å…¥ç›¸å…³æ–¹æ³•çš„å®ç°ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">/**</span><br><span class="line"> * è·å–æ‰€æœ‰ä¾èµ–æ³¨å…¥æ ‡è¯†ç¬¦</span><br><span class="line"> */</span><br><span class="line">export type DIIdentifier = keyof DIMapper;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * è®¡ç®—ä¾èµ–æ³¨å…¥å€¼ç±»å‹</span><br><span class="line"> */</span><br><span class="line">export type DIValue&lt;T extends DIIdentifier&gt; = DIMapper[T];</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * æ³¨å†Œä¾èµ–</span><br><span class="line"> */</span><br><span class="line">export function registerClass&lt;I extends DIIdentifier, T extends DIValue&lt;I&gt;&gt;(</span><br><span class="line">  identifier: I,</span><br><span class="line">  target: new (...args: never[]) =&gt; T,</span><br><span class="line">): void</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * è·å–ä¾èµ–</span><br><span class="line"> */</span><br><span class="line">export function useInject&lt;I extends DIIdentifier, T extends DIValue&lt;I&gt;&gt;(</span><br><span class="line">  identifier: I,</span><br><span class="line">  defaultValue?: T,</span><br><span class="line">): T</span><br></pre></td></tr></table></figure><p><br></p><p>ä½¿ç”¨æ–¹æ³•ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class Foo &#123;&#125;</span><br><span class="line">class MI &#123;</span><br><span class="line">  call(num: string) &#123;&#125;</span><br><span class="line">  sendMessage(num: string, message: string) &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">registerClass(&apos;DI.IPhone&apos;, Foo) // âŒ è¿™ä¸ªä¼šæŠ¥é”™ï¼ŒFoo ä¸ç¬¦åˆ IPhone æ¥å£</span><br><span class="line">registerClass(&apos;DI.IPhone&apos;, MI) // âœ… OK!</span><br><span class="line"></span><br><span class="line">const phone = useInject(&apos;DI.IPhone&apos;) // phone è‡ªåŠ¨æ¨æ–­ä¸º IPhone ç±»å‹</span><br></pre></td></tr></table></figure><blockquote><p>ğŸ’¡ å¯¹äºä¾èµ–æ³¨å…¥ï¼Œæˆ‘åœ¨ <a href="https://juejin.cn/post/7250356064989397053" target="_blank" rel="noopener">å…¨æ–° JavaScript è£…é¥°å™¨å®æˆ˜ä¸‹ç¯‡ï¼šå®ç°ä¾èµ–æ³¨å…¥</a>ï¼Œ ä»‹ç»äº†å¦å¤–ä¸€ç§æ›´åŠ ä¸¥æ ¼å’Œå‹å¥½çš„æ–¹å¼ã€‚</p></blockquote><p><br><br><br><br><br></p><h1 id="äº‹ä»¶è®¢é˜…"><a href="#äº‹ä»¶è®¢é˜…" class="headerlink" title="äº‹ä»¶è®¢é˜…"></a>äº‹ä»¶è®¢é˜…</h1><p>åŒæ ·çš„åŠæ³•ä¹Ÿå¯ä»¥ç”¨äº<code>äº‹ä»¶è®¢é˜…</code>ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">declare global &#123;</span><br><span class="line">  /**</span><br><span class="line">   * å£°æ˜ äº‹ä»¶ æ ‡è¯†ç¬¦å’Œç±»å‹çš„æ˜ å°„å…³ç³»</span><br><span class="line">   * @example æ‰©å±•å®šä¹‰</span><br><span class="line">   * declare global &#123;</span><br><span class="line">   *   interface EventMapper &#123;</span><br><span class="line">   *     &apos;Event.foo.success&apos;: ISuccessMessage</span><br><span class="line">   *   &#125;</span><br><span class="line">   * &#125;</span><br><span class="line">   */</span><br><span class="line">  interface EventMapper &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * äº‹ä»¶åç§°</span><br><span class="line"> */</span><br><span class="line">export type EventName = keyof EventMapper;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * äº‹ä»¶å‚æ•°</span><br><span class="line"> */</span><br><span class="line">export type EventArgument&lt;T extends EventName&gt; = EventMapper[T];</span><br></pre></td></tr></table></figure><p><br><br><br></p><p>EventBus å®ç°ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">export class EventBus &#123;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * ç›‘å¬äº‹ä»¶</span><br><span class="line">   */</span><br><span class="line">  on&lt;N extends EventName, A extends EventArgument&lt;N&gt;&gt;(event: N, callback: (arg: A) =&gt; void) &#123;&#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * è§¦å‘äº‹ä»¶</span><br><span class="line"></span><br><span class="line">   */</span><br><span class="line">  emit&lt;N extends EventName, A extends EventArgument&lt;N&gt;&gt;(event: N, arg: A) &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br><br><br><br><br></p><h1 id="åŠ¨æ€ç±»å‹æ’æ§½"><a href="#åŠ¨æ€ç±»å‹æ’æ§½" class="headerlink" title="åŠ¨æ€ç±»å‹æ’æ§½"></a>åŠ¨æ€ç±»å‹æ’æ§½</h1><p>è¿˜æœ‰ä¸€ä¸ªæ¯”è¾ƒè„‘æ´çš„ä¾‹å­ï¼Œæˆ‘ä¹‹å‰å°è£…è¿‡ä¸€ä¸ª Vue i18n åº“ï¼Œå› ä¸º  Vue 2/3 å·®å¼‚æœ‰ç‚¹å¤§ï¼Œæ‰€ä»¥æˆ‘å°±æ‹†äº†ä¸¤ä¸ªåº“æ¥å®ç°ï¼Œå¦‚ä¸‹å›¾ã€‚<code>i18n</code> ç”¨äº  <code>Vue 3</code> + <code>vue-i18n@&gt;=9</code>, <code>i18n-legacy</code> ç”¨äº <code>Vue 2</code> + <code>vue-i18n@8</code>ã€‚</p><p>ä½†æ˜¯ä¸¤ä¸ªåº“å¤§éƒ¨åˆ†çš„å®ç°æ˜¯ä¸€è‡´çš„ï¼Œè¿™äº›å…±æ€§éƒ¨åˆ†å°±æå–åˆ° <code>i18n-shared</code> ï¼š</p><p><img src="/images/ts-interface-merge/Untitled.png" alt="Untitled"></p><p>ç„¶è€Œ <code>i18n-shared</code> å¹¶ä¸è€¦åˆ <code>Vue</code> å’Œ <code>vue-i18n</code> çš„ç‰ˆæœ¬ï¼Œä¹Ÿä¸å¯èƒ½å°†å®ƒä»¬å£°æ˜ä¸ºä¾èµ–é¡¹ï¼Œ é‚£ä¹ˆå®ƒç›¸å…³ API çš„ç±»å‹æ€ä¹ˆåŠå‘¢ï¼Ÿ</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">// i18n-shared ä»£ç ç‰‡æ®µ</span><br><span class="line">export interface I18nInstance &#123;</span><br><span class="line">  /**</span><br><span class="line">   * vue æ’ä»¶å®‰è£…</span><br><span class="line">   * ğŸ”´ VueApp æ˜¯ Vue App çš„å®ä¾‹</span><br><span class="line">   */</span><br><span class="line">  install(app: VueApp): void;</span><br><span class="line"></span><br><span class="line">  // ğŸ”´ vue-i18n çš„å®ä¾‹</span><br><span class="line">  i18n: VueI18nInstance;</span><br><span class="line"></span><br><span class="line">  // ...</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * è·å–å…¨å±€å®ä¾‹</span><br><span class="line"> * @returns</span><br><span class="line"> */</span><br><span class="line">export function getGlobalInstance(): I18nInstance &#123;</span><br><span class="line">  if (globalInstance == null) &#123;</span><br><span class="line">    throw new Error(`è¯·å…ˆä½¿ç”¨ createI18n åˆ›å»ºå®ä¾‹`);</span><br><span class="line">  &#125;</span><br><span class="line">  return globalInstance;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * è·å–å…¨å±€ vue i18n å®ä¾‹</span><br><span class="line"> */</span><br><span class="line">export function getGlobalI18n(): I18nInstance[&apos;i18n&apos;] &#123;</span><br><span class="line">  return getGlobalInstance().i18n;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br><br><br></p><p>è¿™é‡Œç”¨<code>æ³›å‹</code>ä¹Ÿè§£å†³ä¸äº†é—®é¢˜ã€‚</p><p>ä¸€äº›å¥‡å·§æ·«æŠ€è¿˜å¾—æ˜¯ç±»å‹åˆå¹¶ã€‚æˆ‘åœ¨è¿™é‡Œå°±å·§å¦™åœ°ä½¿ç”¨äº†ç±»å‹åˆå¹¶æ¥åˆ›å»º<code>ç±»å‹æ’æ§½ã€‚</code></p><p>é¦–å…ˆåœ¨ <code>i18n-shared</code> ä¸‹é¢„å®šä¹‰ä¸€ä¸ªæ¥å£ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">/**</span><br><span class="line"> * ğŸ”´ ä¾›å­æ¨¡å—è¯¦ç»†å®šä¹‰ç±»å‹å‚æ•°</span><br><span class="line"> */</span><br><span class="line">export interface I18nSharedTypeParams &#123;</span><br><span class="line">  // VueI18nInstance: vue i18n å®ä¾‹ç±»å‹</span><br><span class="line">  // FallbackLocale</span><br><span class="line">  // VueApp åº”ç”¨ç±»å‹</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// æå–å‚æ•°</span><br><span class="line">// @ts-expect-error</span><br><span class="line">type ExtraParams&lt;T, V = I18nSharedTypeParams[T]&gt; = V;</span><br><span class="line"></span><br><span class="line">export type VueApp = ExtraParams&lt;&apos;VueApp&apos;&gt;;</span><br><span class="line">export type VueI18nInstance = ExtraParams&lt;&apos;VueI18nInstance&apos;&gt;;</span><br></pre></td></tr></table></figure><p><br></p><p>å®šä¹‰äº†ä¸€ä¸ªæ¥å£ <code>I18nSharedTypeParams</code>ï¼Œ<strong>å®ƒå…·ä½“çš„ç±»å‹ç”±ä¸‹çº§çš„åº“æ¥æ³¨å…¥</strong>ï¼Œæˆ‘å°šä¸”æŠŠå®ƒå‘½åä¸º â€œ<code>åŠ¨æ€ç±»å‹æ’æ§½</code>â€ å§ã€‚</p><p>ç°åœ¨ <code>i18n</code> å’Œ <code>i18n-legacy</code> å°±å¯ä»¥æ ¹æ®è‡ªå·±çš„ä¾èµ–ç¯å¢ƒæ¥é…ç½®å®ƒäº†ï¼š</p><p><br><br><br></p><p>i18n-legacy:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import VueI18n from &apos;vue-i18n&apos;; // vue-i18n@8</span><br><span class="line">import Vue from &apos;vue&apos;; // vue@2</span><br><span class="line"></span><br><span class="line">declare module &apos;i18n-shared&apos; &#123;</span><br><span class="line">  export interface I18nSharedTypeParams &#123;</span><br><span class="line">    VueI18nInstance: VueI18n;</span><br><span class="line">    VueApp: typeof Vue;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p>i18n:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import &#123; VueI18n, Composer &#125; from &apos;vue-i18n&apos;; // vue-i18n@9+</span><br><span class="line">import &#123; App &#125; from &apos;vue&apos;; // vue@3</span><br><span class="line"></span><br><span class="line">declare module &apos;i18n-shared&apos; &#123;</span><br><span class="line">  interface I18nSharedTypeParams &#123;</span><br><span class="line">    VueI18nInstance: VueI18n&lt;any, any, any&gt; | Composer&lt;any, any, any&gt;;</span><br><span class="line">    VueApp: App;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ğŸ’¡ æºç å¯ä»¥<a href="https://github.com/wakeadmin/tools/blob/db3809305e5698ac31a130319f430377a0e9c1be/packages/i18n-shared/src/types.ts#L45" target="_blank" rel="noopener">çœ‹è¿™é‡Œ</a></p></blockquote><p><br><br><br><br><br></p><h1 id="æ›´å¤š"><a href="#æ›´å¤š" class="headerlink" title="æ›´å¤š"></a>æ›´å¤š</h1><p>å½“ä½ æ·±å…¥äº†è§£äº†ç±»å‹åˆå¹¶ä¹‹åï¼Œä½ å¯èƒ½ä¼šåœ¨è¶Šæ¥è¶Šå¤šçš„åœ°æ–¹å‘ç°å®ƒçš„èº«å½±ã€‚è¿™æ¯•ç«Ÿæ˜¯ TypeScript ä¸ºæ•°ä¸å¤šï¼Œæ”¯æŒåŠ¨æ€å»æ‰©å±•ç±»å‹çš„ç‰¹æ€§ã€‚</p><p>æ›´å¤šçš„åœºæ™¯ï¼Œè¯»è€…å¯ä»¥å¼€å¼€è„‘æ´ï¼Œæ¯”å¦‚ï¼š</p><ul><li><code>unplugin-vue-components</code>  Vue ç»„ä»¶è‡ªåŠ¨å¯¼å…¥æ˜¯å¦‚ä½•æ”¯æŒç±»å‹æ£€æŸ¥çš„ï¼Ÿ</li><li><a href="https://github.com/posva/unplugin-vue-router" target="_blank" rel="noopener">unplugin-vue-router</a> å¦‚ä½•å®ç°æ”¯æŒç±»å‹æ£€æŸ¥çš„ vue-router?</li><li>ç»™æ’ä»¶ç³»ç»ŸåŠ ä¸Šç±»å‹æ£€æŸ¥</li><li>â€¦</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;img src=&quot;/images/ts-interface-merge/Untitled.jpeg&quot; alt=&quot;Untitled&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;h1 id=&quot;åˆè¯†&quot;&gt;&lt;a href=&quot;#åˆè¯†&quot; class=&quot;headerlink&quot; title=&quot;åˆ
      
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://bobi.ink/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>å¾®å‰ç«¯çš„è½åœ°å’Œæ²»ç†å®æˆ˜</title>
    <link href="https://bobi.ink/2023/07/13/microfrontend/"/>
    <id>https://bobi.ink/2023/07/13/microfrontend/</id>
    <published>2023-07-12T16:00:00.000Z</published>
    <updated>2023-07-13T02:11:54.631Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/images/microfrontend/Untitled.png" alt="Untitled"></p><p>å¾®å‰ç«¯å®ç°åŸç†ã€æ¡†æ¶é€‰å‹ä¹‹ç±»çš„æ–‡ç« æ¯”è¾ƒæ³›æ»¥ï¼Œæˆ‘ä¸æ‰“ç®—è®²è¿™äº›ç©æ„ï¼Œæœ¬æ–‡ä¸»è¦æ¥æºäºç¬”è€…è¿‡å»ä¸€å¹´è½åœ°å¾®å‰ç«¯çš„ä¸€æ‰‹ç»éªŒï¼Œå°½é‡ä¸è®²æŠ€æœ¯ç»†èŠ‚ï¼Œè€Œæ˜¯è®²ä¸€ä¸ªä½“ç³»åŒ–çš„æ–¹æ¡ˆæ˜¯æ€ä¹ˆæ­å»ºèµ·æ¥ã€‚</p><p>æ–‡ç« è¾ƒé•¿ï¼Œè€å¿ƒçœ‹å®Œä¿è¯ä¼šæœ‰æ”¶è·ã€‚</p><h1 id="èƒŒæ™¯ä¸ç—›ç‚¹"><a href="#èƒŒæ™¯ä¸ç—›ç‚¹" class="headerlink" title="èƒŒæ™¯ä¸ç—›ç‚¹"></a>èƒŒæ™¯ä¸ç—›ç‚¹</h1><p>é¦–å…ˆæ¥çœ‹ä¸‹ä¸šåŠ¡èƒŒæ™¯ï¼Œæ–¹ä¾¿è¯»è€…äº†è§£æˆ‘ä»¬ä¸ºä»€ä¹ˆé€‰æ‹©å¾®å‰ç«¯ï¼Œä»¥åŠå…¶ä»–ç›¸å…³æŠ€æœ¯é€‰å‹çš„åŸå› ã€‚</p><p>å‰ç«¯åœ¨æ¶æ„ä¸Šé¢çš„å˜åŒ–è¿œè½åäºåç«¯ï¼Œåç«¯çš„æ¶æ„å·²ç»ç»å†äº†å¾®æœåŠ¡ã€ä¸­å°åŒ–ã€DDD æ”¹é€ çš„è…¥é£è¡€é›¨â€¦</p><p>åœ¨æ”¹é€ æˆå¾®å‰ç«¯ä¹‹å‰, æˆ‘ä»¬ä¹Ÿæ˜¯ä¸€ä¸ªå·¨å‹çš„<code>å•ä½“åº”ç”¨</code>ï¼Œåé¢éšç€ä¸šåŠ¡çš„å¤æ‚åŒ–ï¼Œä¸šåŠ¡å’Œå›¢é˜Ÿè¿›ä¸€æ­¥è¿›è¡Œæ‹†åˆ†ï¼Œ æˆ‘ä»¬çš„å‰ç«¯é¡¹ç›®ä¹Ÿæ ¹æ®<a href="https://zh.wikipedia.org/zh-hans/%E5%BA%B7%E5%A8%81%E5%AE%9A%E5%BE%8B" target="_blank" rel="noopener"><code>åº·å¨å®šå¾‹</code></a>ï¼Œè¿›åŒ–æˆä¸ºäº†â€˜<code>å¤šé¡µåº”ç”¨</code>â€™ï¼Œ å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/images/microfrontend/Untitled%201.png" alt="å¤šé¡µ"></p><p><br></p><p>æˆ‘ä»¬ä¸»è¦åšçš„æ˜¯ 2B ä¸šåŠ¡ï¼Œåš <a href="https://zh.wikipedia.org/zh-hans/%E6%A6%82%E5%BF%B5%E9%AA%8C%E8%AF%81" target="_blank" rel="noopener">POC</a>(æ¦‚å¿µéªŒè¯) å’Œ<code>ç§æœ‰åŒ–éƒ¨ç½²</code>æ˜¯å®¶å¸¸ä¾¿é¥­ï¼Œåœ¨å·²æœ‰çš„æ¶æ„ä¸‹ï¼Œæˆ‘ä»¬éœ€è¦åº”ç”¨æŸäº›é…ç½®å¯èƒ½ä¼šç‰µæ‰¯å¤šä¸ªé¡¹ç›®ï¼Œæ¯”å¦‚ä¸»é¢˜ã€æ–‡æ¡ˆã€æ¥å£é…ç½®ç­‰ä¿¡æ¯çš„ä¿®æ”¹ï¼Œéœ€è¦é’ˆå¯¹å¤šä¸ªé¡¹ç›®è¿›è¡Œåˆ›å»ºåˆ†æ”¯ã€ä¿®æ”¹ä»£ç ã€æ„å»ºã€å‘å¸ƒã€éƒ¨ç½²â€¦ ä¸€ç³»åˆ—ç¹ççš„æµç¨‹</p><p>ä¸»è¦åŸå› æ˜¯æˆ‘ä»¬çš„ä¸šåŠ¡ç³»ç»Ÿç»è¿‡é•¿æœŸã€å¤šå›¢é˜Ÿã€å¤šä¸šæ€çš„è¿­ä»£ï¼Œç§¯ç´¯äº†å¤§é‡çš„æŠ€æœ¯å€ºã€‚</p><ul><li>æŠ€æœ¯æ ˆè€æ—§ï¼Œå¼€å‘æ•ˆç‡ä½ï¼Œæˆ‘ä»¬æƒ³è¦åº”ç”¨æ–°çš„æŠ€æœ¯å’Œè§„èŒƒï¼Œä½†ç¢äºé¡¹ç›®ä½“é‡å¤§ã€è´¨é‡å·®ï¼Œé‡æ„ä¸¾æ­¥ç»´è‰°ã€‚</li><li>å­åº”ç”¨çš„æ‹†åˆ†æ²¡æœ‰å›ºå®šçš„èŒƒå¼ã€‚æœ‰äº›æ¨¡å—æŒ‰ç…§å›¢é˜Ÿæ‹†åˆ†å‡ºç‹¬ç«‹çš„ä»“åº“ï¼Œæœ‰äº›ä»“åº“åˆ™é‡‡ç”¨ MonoRepoã€‚å‰è€…ä»“åº“ä¹‹é—´å­˜åœ¨å¤§é‡é‡å¤ä»£ç ã€ç¼ºä¹ç®¡ç†ï¼›è€Œåè€… MonoRepo åˆ™è¶Šæ¥è¶Šè‡ƒè‚¿, èŒè´£ä¸æ¸…æ™°ï¼Œç¼–è¯‘ç¼“æ…¢, é€æ¸ä¹Ÿæ¼”å˜æˆäº†<code>å·¨çŸ³åº”ç”¨</code>ã€‚</li><li>åŸºäºå¤šé¡µçš„å­åº”ç”¨ç¼ºä¹ç®¡ç†ï¼Œè§„èŒƒ/æ ‡å‡†ä¸ç»Ÿä¸€ã€‚æ— æ³•ç»Ÿä¸€æ§åˆ¶è§†è§‰å‘ˆç°ã€å…±äº«çš„åŠŸèƒ½å’Œä¾èµ–ã€‚é€ æˆé‡å¤å·¥ä½œ</li><li>æ–°æ—§é¡¹ç›®ã€ç¬¬ä¸‰æ–¹åº”ç”¨é›†æˆéƒ½å¾ˆå¤æ‚ã€‚</li><li>å¤šè¡Œä¸šã€å¤šå›¢é˜Ÿçš„é¡¹ç›®ç‰¹æ€§ï¼Œå¯¼è‡´å·¥ç¨‹ç®¡ç†å¤æ‚ï¼Œæ‰©å±•æ€§å·®ã€‚</li><li>éƒ¨ç½²æ–¹å¼åŸå§‹ã€‚</li><li>åº”ç”¨æŒ‰ç…§èœå•èšåˆï¼Œè€Œä¸æ˜¯æŒ‰ç…§ä¸šåŠ¡èšåˆ</li><li>â€¦</li></ul><p><br></p><blockquote><p>ğŸ’¡  æ€ä¹ˆç†è§£ â€œåº”ç”¨æŒ‰ç…§èœå•èšåˆï¼Œè€Œä¸æ˜¯æŒ‰ç…§ä¸šåŠ¡èšåˆâ€ å‘¢ï¼Ÿ</p><p><img src="/images/microfrontend/Untitled%202.png" alt="èœå•èšåˆ"></p><p><strong>æœ´ç´ çš„å¤šé¡µåº”ç”¨é€šå¸¸æŒ‰ç…§â€œèœå•â€æ¥æ‹†åˆ†åº”ç”¨ï¼Œæ¯”å¦‚æŒ‰ç…§ä¸Šå›¾çš„é¡¶çº§ Tabã€‚</strong></p><p>åé¢æ¥è¿™ä¸€ä¸ªè¿™æ ·çš„éœ€æ±‚ï¼Œa åº”ç”¨çš„æŸäº›åŠŸèƒ½èœå•éœ€è¦åœ¨ b Tab ä¸‹å±•ç¤ºï¼Œè¿™æ—¶å€™å°±å‚»çœ¼äº†ï¼š</p><ul><li>æŠŠ a çš„ç›¸å…³ä»£ç æ¬è¿åˆ° bï¼Ÿå¦‚æœåé¢èœå•åˆæ”¹äº†æ€ä¹ˆåŠï¼Ÿå†è¯´ï¼Œä½ èƒ½æ¬å¾—åŠ¨å—ï¼Ÿ</li><li>ç”¨ iframe å°† a å¥—åœ¨ b åº”ç”¨ä¸‹ï¼Ÿ</li></ul></blockquote><p><br><br><br></p><p>å› æ­¤æˆ‘ä»¬äºŸéœ€ä¸€å¥—æ–°çš„æ¶æ„ï¼Œ<strong>èƒ½ç»Ÿä¸€ç®¡ç†ä¸åŒå›¢é˜Ÿä¸šåŠ¡çº¿ã€åŒæ—¶èƒ½å¤Ÿä¿æŒåŸæœ¬çš„ç‹¬ç«‹æ€§å’Œçµæ´»æ€§</strong>ã€‚è¿™æ—¶å€™å¾®å‰ç«¯æ¶æ„å°±è¿›å…¥äº†æˆ‘ä»¬çš„è€ƒå¯ŸèŒƒå›´ï¼š</p><p><img src="/images/microfrontend/Untitled%203.png" alt="æ˜ŸçŠ¶"></p><p>æˆ‘ä»¬éœ€è¦ä¸€ä¸ªã€Œåº•åº§ã€å°†ä¸åŒçš„åº”ç”¨èšåˆèµ·æ¥ï¼Œå°†åŸæœ¬<code>ç¦»æ•£</code>çš„åº”ç”¨é€šè¿‡ä¸€ä¸ª<code>åŸºåº§</code>ä¸²è”èµ·æ¥ï¼š</p><ul><li><strong>ç¦»æ•£çš„åº”ç”¨ç»“æ„ï¼Œè½¬æ¢ä¸ºæ˜ŸçŠ¶ç»“æ„ã€‚</strong>åŸºåº§å¯ä»¥ç»Ÿä¸€ç®¡ç†å­åº”ç”¨ã€‚</li><li><strong>å¼€å‘è€…å¯ä»¥æ›´ä¸“æ³¨äºä¸šåŠ¡çš„å¼€å‘</strong>ã€‚åŸºåº§ä¼šæä¾›é…å¥—çš„ç™»å½•ä¼šè¯ç®¡ç†ã€æƒé™ç®¡ç†ã€èœå•ç®¡ç†ã€è·¯ç”±ç®¡ç†ã€ä¸»é¢˜ç®¡ç†ç­‰æ–¹æ¡ˆï¼Œå­åº”ç”¨åªéœ€å…³å¿ƒä¸šåŠ¡åŠŸèƒ½æœ¬èº«çš„å¼€å‘ã€‚</li><li><strong>æ›´å®¹æ˜“åœ°é›†æˆåº”ç”¨</strong>ã€‚ä¸ç®¡æ˜¯è‡ªå·±çš„ä¸šåŠ¡åº”ç”¨ã€è€æ—§ç³»ç»Ÿã€è¿˜æ˜¯å¤–éƒ¨ç¬¬ä¸‰æ–¹åº”ç”¨ï¼Œéƒ½å¯ä»¥åœ¨æå°‘æ”¹åŠ¨çš„æƒ…å†µä¸‹é›†æˆè¿›æ¥ã€‚</li><li><strong>è§†è§‰ç»Ÿä¸€</strong>ã€‚</li><li><strong>æ‹†åˆ†å·¨çŸ³åº”ç”¨ï¼Œè®©å­åº”ç”¨å¯ä»¥æŒ‰ç…§â€œä¸šåŠ¡èšåˆâ€</strong>ã€‚<strong>ä¸å†è€¦åˆèœå•</strong>ï¼Œ è®©åº”ç”¨æ›´è½»é‡ã€å†…èšã€æ›´å¯ç»´æŠ¤</li></ul><blockquote><p>ğŸ’¡  ä½¿ç”¨å¾®å‰ç«¯ä¹‹åï¼Œå­åº”ç”¨ä¸å†è€¦åˆèœå•ï¼Œèœå•ç”±åŸºåº§æ¥ç®¡ç†å’Œç»„åˆï¼Œèœå•å¯ä»¥è¢«æ”¾åœ¨ä»»æ„ä½ç½®ã€‚</p></blockquote><p><br></p><h1 id="æ¶æ„"><a href="#æ¶æ„" class="headerlink" title="æ¶æ„"></a>æ¶æ„</h1><p><strong>ç”±äºæˆ‘ä»¬åŸæœ¬å°±æ˜¯<code>å¤šé¡µåº”ç”¨</code>çš„æ¶æ„ï¼Œæ‰€ä»¥åŸºäº<code>è·¯ç”±åˆ†å‘</code> + <code>åŸºåº§å½¢å¼</code>çš„å¾®å‰ç«¯æ–¹æ¡ˆæ˜¯ä¸€ç§æ¯”è¾ƒè‡ªç„¶çš„é€‰æ‹©</strong>ã€‚æ•´ä½“é¡¹ç›®æ¶æ„å¦‚ä¸‹ï¼š</p><p><img src="/images/microfrontend/Untitled%204.png" alt="Untitled"></p><p>æˆ‘ä»¬æ„é€ äº†ä¸€æ•´å¥—ä½“ç³»åŒ–çš„æ–¹æ¡ˆï¼š ä»<code>è§„èŒƒ</code>åˆ°<code>å¼€å‘åŸºç¡€åº“</code>ã€ä»<code>æƒé™ç®¡ç†ç³»ç»Ÿ</code>åˆ°<code>å¾®å‰ç«¯åŸºåº§</code>ã€ä»<code>å¼€å‘è°ƒè¯•</code>åˆ°<code>éƒ¨ç½²è¿ç»´</code>ã€‚</p><ol><li><strong>åŸºç¡€åº“ï¼š</strong>æˆ‘ä»¬å°†æ¯ä¸ªåº”ç”¨éƒ½é‡å¤çš„å·¥ä½œæå–å‡ºæ¥ï¼Œé‡æ–°è®¾è®¡ï¼Œå¹¶ä¸¥æ ¼ç®¡ç†èµ·æ¥ã€‚ä½¿ä¹‹èƒ½çœŸæ­£æœ‰æ•ˆåœ°æœåŠ¡ä¸šåŠ¡å¼€å‘ï¼Œé¿å…é‡å¤é€ è½®å­ã€‚</li><li><strong>å¼€å‘è§„èŒƒ</strong>ï¼šåŒæ—¶ï¼Œæˆ‘ä»¬æœŸæœ›æä¾›æ›´ä¸°å¯Œçš„å¼€å‘è§„èŒƒã€æŒ‡å¯¼ã€æœ€ä½³å®è·µä½œä¸ºæ”¯æ’‘ã€‚è®©å¼€å‘è€…èµ°æ›´å°‘çš„å¼¯è·¯ã€‚</li><li><strong>æƒé™ç®¡ç†å¹³å°</strong>ï¼šåŸºåº§çš„<strong>èœå•</strong>ã€<strong>æƒé™ä¿¡æ¯</strong>æ¥æºäº<code>æƒé™ç®¡ç†å¹³å°</code>, é€šè¿‡æƒé™ç®¡ç†å¹³å°å¯ä»¥çµæ´»åœ°ç»™ä¸åŒä¸šæ€ã€ä¸åŒè§’è‰²é…ç½®ä¸åŒçš„èœå•å’Œæƒé™ã€‚è¿™æ˜¯æˆ‘ä»¬å¾®å‰ç«¯æ–¹æ¡ˆçš„é‡è¦åŸºç¡€ã€‚</li><li><strong>åŸºåº§:</strong> åŸºåº§æ˜¯å¾®å‰ç«¯åº”ç”¨é›†æˆçš„ä¸€ä¸ªé‡è¦å¹³å°ã€‚åŒæ—¶ä¹Ÿè‚©è´Ÿç€ç®¡ç†å…¬å…±èµ„æºã€ä¾èµ–ã€è§„èŒƒçš„è´£ä»»ã€‚ä¸»è¦æœ‰ä»¥ä¸‹èŒè´£ï¼š<ul><li>å­åº”ç”¨é›†æˆã€‚ç»™å­åº”ç”¨æä¾›æ¸²æŸ“å®¹å™¨</li><li>è·¯ç”±/èœå•ç®¡ç†</li><li>æƒé™ç®¡ç†</li><li>ä¸»é¢˜ç®¡ç†</li><li>ä¼šè¯ç®¡ç†</li><li>å¤šè¯­è¨€ç®¡ç†</li><li>å…±äº«ä¾èµ–ç­‰</li></ul></li><li><p><strong>è¿è¡Œå®¹å™¨ï¼š<a href="https://wakeadmin.wakedata.com/mapp/deploy.html" target="_blank" rel="noopener">è¿è¡Œå®¹å™¨</a></strong>  æ˜¯æˆ‘ä»¬æä¾›çš„ä¸€å¥—å¾®å‰ç«¯çš„è¿è¡Œå’Œéƒ¨ç½²æ–¹æ¡ˆã€‚ç›¸æ¯”ä¼ ç»Ÿçº¯ç²¹çš„å‰ç«¯èµ„æºé™æ€éƒ¨ç½²ï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨éƒ¨ç½²é˜¶æ®µå¯ä»¥åšæ›´å¤šçš„äº‹æƒ…ï¼š</p><ul><li>åŠ¨æ€é…ç½®ã€‚æ¯”å¦‚åŸŸåé…ç½®ã€SEO ä¿¡æ¯é…ç½®</li><li>ä¸»é¢˜ç®¡ç†ã€‚ä¸€é”®æ¢è‚¤èƒ½å¦å®ç°ï¼Ÿ</li><li>å­åº”ç”¨ç®¡ç†ã€‚è‡ªåŠ¨å‘ç°å­åº”ç”¨ï¼Œè€Œä¸æ˜¯åœ¨å¾®å‰ç«¯åŸºåº§ä¸­ç¡¬ç¼–ç ï¼Ÿ</li><li>è¯­è¨€åŒ…ã€‚èƒ½å¦å®æ—¶é…ç½®è¯­è¨€åŒ…ï¼Œè€Œä¸éœ€è¦é‡æ–°ç¼–è¯‘ä»£ç ã€å®¡æ ¸ã€å‘å¸ƒâ€¦</li><li>å¼€å‘ç¯å¢ƒã€æµ‹è¯•ç¯å¢ƒéƒ¨ç½²èƒ½å¦ç®€åŒ–ï¼Ÿ</li></ul><p>å¾—ç›Šäº<code>è¿è¡Œå®¹å™¨</code>ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°<strong>å‰ç«¯éƒ¨ç½²çš„æ ‡å‡†åŒ–</strong>ï¼Œæ”¯æŒã€Œ<strong>ä¸€é”®éƒ¨ç½²ã€</strong>ç­‰èƒ½åŠ›ã€‚</p></li></ol><p><br><br><br><br><br><br><br></p><h1 id="åŸºåº§"><a href="#åŸºåº§" class="headerlink" title="åŸºåº§"></a>åŸºåº§</h1><p><img src="/images/microfrontend/Untitled%205.png" alt="åŸºåº§ä¸»ç•Œé¢"></p><p>åŸºåº§ä¸»ç•Œé¢</p><p>å¦‚ä¸Šæ‰€ç¤ºï¼ŒåŸºåº§ä¸ºå­åº”ç”¨æä¾›äº†åŸºç¡€çš„è¿è¡Œç¯å¢ƒï¼Œ è“è‰²åŒºåŸŸä¸ºå­åº”ç”¨çš„è¿è¡ŒèŒƒå›´ã€‚</p><p><br></p><p><img src="/images/microfrontend/Untitled%206.png" alt="åŸºåº§ç»“æ„"></p><p>åŸºåº§çš„å¤§æ¦‚ç»“æ„å¦‚ä¸Šã€‚</p><p>é¦–å…ˆæ˜¯<code>ä¼šè¯ç®¡ç†</code>ï¼ŒåŸºåº§ä¼š<code>æ‹¦æˆª</code>åº”ç”¨çš„æ‰€æœ‰è¯·æ±‚ï¼Œå¦‚æœç›‘å¬åˆ° 401 çŠ¶æ€ç ï¼Œåˆ™è·³è½¬åˆ°ç™»å½•é¡µé¢è¿›è¡Œæˆæƒã€‚ç™»å½•/æ³¨å†Œé¡µé¢ä¹Ÿæ˜¯ç”±å­åº”ç”¨æä¾›ï¼Œæˆ‘ä»¬å°½é‡ä¸è®©åŸºåº§è€¦åˆå…·ä½“çš„ä¸šåŠ¡ã€‚</p><p><br></p><p>åŸºåº§å¯åŠ¨åï¼Œå°±ä¼šä»<code>æƒé™ç®¡ç†å¹³å°</code>æ‹‰å–èœå•ã€æƒé™é…ç½®ä¿¡æ¯ï¼Œæ¸²æŸ“é¡µé¢çš„èœå•å¯¼èˆªæ¡†æ¶ã€‚åŒæ—¶ä¹Ÿä¼šå¯¹é¡µé¢è·¯ç”±è¿›è¡Œæˆæƒæ‹¦æˆªï¼Œè€Œç»†ç²’åº¦çš„æƒé™æ§åˆ¶(æ¯”å¦‚æŒ‰é’®)ï¼ŒåŸºåº§ä¹Ÿä¼šæš´éœ² API ä¾›å­åº”ç”¨é€‚é…ã€‚</p><p><br></p><p>è‡³äºå­åº”ç”¨ä¿¡æ¯ï¼Œåˆ™æ˜¯<strong>ç”±<code>è¿è¡Œå®¹å™¨</code>è‡ªåŠ¨å‘ç°å¹¶æ³¨å…¥</strong>ï¼Œé¿å…åœ¨åŸºåº§ä¸­ç¡¬ç¼–ç äº†è¿™äº›ä¿¡æ¯ã€‚åŸºåº§åº•å±‚åŸºäº <a href="https://github.com/umijs/qiankun" target="_blank" rel="noopener">qiankun</a>ï¼Œæ ¹æ®è·¯ç”±åŒ¹é…æ¸²æŸ“æŒ‡å®šçš„å­åº”ç”¨ã€‚</p><blockquote><p>ğŸ’¡ <code>è¿è¡Œå®¹å™¨</code>æ˜¯å•¥? è¿™ä¸ªæˆ‘ä»¬ä¼šåœ¨ä¸‹æ–‡ä»‹ç»ï¼Œç®€å•æ¥è¯´ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ª <code>NodeJS</code> æœåŠ¡ï¼Œä¼š<strong>è‡ªåŠ¨å‘ç°</strong>å·²ç»éƒ¨ç½²åœ¨æœåŠ¡å™¨ä¸­çš„å­åº”ç”¨ï¼Œç„¶åå°†è¿™äº›ä¿¡æ¯æ³¨å…¥åˆ°åŸºåº§çš„å¯åŠ¨ä»£ç ä¸­ã€‚</p></blockquote><p><br></p><p>åŸºåº§è¿˜ç»Ÿä¸€ç®¡ç†äº†<code>ä¸»é¢˜åŒ…</code>ã€<code>å¤šè¯­è¨€</code>ã€‚ä»è€Œä¿è¯å­åº”ç”¨å¯ä»¥æœ‰è¾ƒä¸ºç»Ÿä¸€çš„å‘ˆç°ã€‚ä¸»é¢˜åŒ…ä¹Ÿå¯ä»¥åœ¨éƒ¨ç½²æ—¶åŠ¨æ€åˆ‡æ¢ï¼Œè¿™å¯¹äº POC æˆ–è€…ç§æœ‰åŒ–éƒ¨ç½²æ¯”è¾ƒæ–¹ä¾¿ã€‚</p><blockquote><p>ğŸ’¡  ä¸»é¢˜åŒ…ä¸»è¦åŒ…å« CSS å˜é‡ã€ç»„ä»¶åº“æ ·å¼ã€è¯­è¨€åŒ…ã€é™æ€èµ„æºã€ç”šè‡³ä¸€äº›éƒ¨ç½²é…ç½®ä¿¡æ¯ã€‚</p></blockquote><p><br></p><p><img src="/images/microfrontend/Untitled%207.png" alt="API"></p><p>ä¸ºäº†æ–¹ä¾¿å­åº”ç”¨ä½¿ç”¨åŸºåº§çš„ã€Œ<code>æœåŠ¡</code>ã€ï¼Œ åŸºåº§ä¹Ÿå‘å­åº”ç”¨æš´éœ²äº†ä¸€ç³»åˆ—çš„ç»„ä»¶åº“å’Œ APIã€‚</p><p>ç»„ä»¶åº“åŸºäºä½¿ç”¨ <code>Web Component</code> çš„å½¢å¼ï¼Œå®ç°æ¡†æ¶æ— å…³ï¼Œ åŸºäº Vue 3 åˆ›å»ºã€‚Vue 3 <a href="https://cn.vuejs.org/guide/extras/web-components.html" target="_blank" rel="noopener">æ„å»ºè‡ªå®šä¹‰å…ƒç´ </a> ä¹Ÿå¾ˆæ–¹ä¾¿ï¼Œæ‰€ä»¥å°±æ²¡å¿…è¦å¼•å…¥å…¶ä»–æ¡†æ¶ä¸“é—¨æ¥ç¼–å†™è¿™å—äº†</p><p>è¿™äº› API å¯ä»¥ç›´æ¥æŒ‚è½½åœ¨å…¨å±€ window å¯¹è±¡ä¸Šï¼Œå­åº”ç”¨å¯ä»¥ç›´æ¥è®¿é—®ã€‚</p><blockquote><p>ğŸ’¡  å®é™…ä¸Šæˆ‘ä»¬å°è£…äº†ä¸€ä¸ªå¥—å£³ npm åº“ï¼Œé¿å…å­åº”ç”¨ç›´æ¥è®¿é—® window å¯¹è±¡ä¸Šçš„æœåŠ¡, éšè—ç»†èŠ‚ï¼Œå¦å¤–å¯ä»¥æä¾›ç±»å‹æç¤ºã€‚</p></blockquote><p><br><br><br><br><br><br><br></p><h1 id="å­åº”ç”¨æ¥å…¥"><a href="#å­åº”ç”¨æ¥å…¥" class="headerlink" title="å­åº”ç”¨æ¥å…¥"></a>å­åº”ç”¨æ¥å…¥</h1><p>ç®€å•ã€å…ä¾µå…¥åœ°æ”¹é€ å­åº”ç”¨ä½¿æˆ‘ä»¬è¦è¾¾æˆçš„ä¸»è¦ç›®æ ‡ã€‚</p><h2 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h2><p>ä¸ºæ­¤ï¼Œæˆ‘ä»¬ä¹Ÿæä¾›äº†ç›¸åº”çš„ <code>vue-cli</code> æ’ä»¶, æ”¯æŒå¿«é€Ÿé›†æˆï¼Œé¿å…å¼€å‘è€…å…³å¿ƒ Webpack åº•å±‚çš„å„ç§é…ç½®ç»†èŠ‚</p><blockquote><p>æˆ‘ä»¬çš„å¾®å‰ç«¯ä¸»è¦åŸºäº <a href="https://github.com/umijs/qiankun" target="_blank" rel="noopener">qiankun</a>ï¼Œå®˜æ–¹ç›®å‰å¹¶ä¸æ”¯æŒ Viteï¼Œå¹¶ä¸”æˆ‘ä»¬å¤§é‡é¡¹ç›®ä¸»è¦ä»¥ Vue CLI ä¸ºä¸»ã€‚</p></blockquote><p>ç¤ºä¾‹ï¼š</p><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; defineConfig &#125; = <span class="built_in">require</span>(<span class="string">'@vue/cli-service'</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; defineMappChild &#125; = <span class="built_in">require</span>(<span class="string">'@wakeadmin/vue-cli-plugin-mapp-child'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = defineConfig(&#123;</span><br><span class="line">  transpileDependencies: <span class="literal">false</span>,</span><br><span class="line">  pluginOptions: &#123;</span><br><span class="line">    <span class="comment">// åªéœ€è¦ç®€å•çš„é…ç½®</span></span><br><span class="line">    ...defineMappChild(&#123;</span><br><span class="line">      mapp: &#123;</span><br><span class="line">        activeRule: <span class="string">'/dsp.html'</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;),</span><br><span class="line">  &#125;,</span><br><span class="line">  lintOnSave: <span class="literal">false</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>å¤šå…¥å£é…ç½®ï¼š</p><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; defineConfig &#125; = <span class="built_in">require</span>(<span class="string">'@vue/cli-service'</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; defineMappChild &#125; = <span class="built_in">require</span>(<span class="string">'@wakeadmin/vue-cli-plugin-mapp-child'</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = defineConfig(&#123;</span><br><span class="line">  <span class="comment">// å¤šé¡µåº”ç”¨</span></span><br><span class="line">  pages: &#123;</span><br><span class="line">    index: <span class="string">'src/main.ts'</span>,</span><br><span class="line">    another: <span class="string">'src/another.ts'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  pluginOptions: &#123;</span><br><span class="line">    <span class="comment">// å¾®å‰ç«¯é›†æˆé…ç½®</span></span><br><span class="line">    ...defineMappChild(&#123;</span><br><span class="line">      mapp: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="comment">// entry å¿…é¡»ä¸ºä¸Šé¢ pages ä¸­å®šä¹‰çš„ key</span></span><br><span class="line">          entry: <span class="string">'index'</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="comment">// entry å¿…é¡»ä¸ºä¸Šé¢ pages ä¸­å®šä¹‰çš„ key</span></span><br><span class="line">          entry: <span class="string">'another'</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      ],</span><br><span class="line">    &#125;),</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="æŒ‚è½½"><a href="#æŒ‚è½½" class="headerlink" title="æŒ‚è½½"></a>æŒ‚è½½</h2><p>æ¥ç€è°ƒæ•´åº”ç”¨æŒ‚è½½ç¨‹åºï¼š</p><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createApp, App <span class="keyword">as</span> TApp &#125; <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> &#123; createRouter, createWebHashHistory &#125; <span class="keyword">from</span> <span class="string">'vue-router'</span></span><br><span class="line"><span class="keyword">import</span> Bay <span class="keyword">from</span> <span class="string">'@wakeadmin/bay'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">'./App.vue'</span></span><br><span class="line"><span class="keyword">import</span> &#123; routes &#125; <span class="keyword">from</span> <span class="string">'./router'</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">'./store'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> app: TApp</span><br><span class="line"></span><br><span class="line">Bay.createMicroApp(&#123;</span><br><span class="line">  <span class="keyword">async</span> bootstrap() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'bootstrap vue3'</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="keyword">async</span> mount(container, props) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'mount vue3'</span>, props)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> router = createRouter(&#123;</span><br><span class="line">      history: createWebHashHistory(),</span><br><span class="line">      routes,</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    app = createApp(App).use(store).use(router).use(Bay)</span><br><span class="line"></span><br><span class="line">    app.mount(container?.querySelector(<span class="string">'#app'</span>) ?? <span class="string">'#app'</span>)</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> unmount() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'unmount vue3'</span>)</span><br><span class="line"></span><br><span class="line">    app.unmount()</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="keyword">async</span> update() &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'update vue3'</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="æœ¬åœ°å¼€å‘å’Œè°ƒè¯•"><a href="#æœ¬åœ°å¼€å‘å’Œè°ƒè¯•" class="headerlink" title="æœ¬åœ°å¼€å‘å’Œè°ƒè¯•"></a>æœ¬åœ°å¼€å‘å’Œè°ƒè¯•</h2><p>è¿è¡Œèµ·æ¥åï¼Œ æˆ‘ä»¬ä¼šåœ¨ç»ˆç«¯æ‰“å°å‡ºå­åº”ç”¨çš„ç›¸å…³ä¿¡æ¯ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="/images/microfrontend/Untitled%208.png" alt="terminal"></p><p>æ¥ä¸‹æ¥ï¼Œåªéœ€è¦åœ¨<code>åŸºåº§çš„è°ƒè¯•é¡µé¢</code>ï¼Œæ³¨å†Œè¿™ä¸ªå­åº”ç”¨å°±å¯ä»¥è¿è¡Œèµ·æ¥çš„ï¼š</p><p><img src="/images/microfrontend/Untitled%209.png" alt="debug"></p><blockquote><p>ğŸ’¡  æœ‰äº†å¾®å‰ç«¯ä¹‹åï¼Œå­åº”ç”¨çš„å¼€å‘å’Œè°ƒè¯•ä¹Ÿç®€åŒ–äº†å¾ˆå¤šï¼Œå¯ä»¥éšæ—¶æŒ‚è½½åˆ°ä»»æ„ç¯å¢ƒï¼Œä¸éœ€è¦é…ç½®ä»»ä½•æœåŠ¡ç«¯ä»£ç†ã€‚</p></blockquote><p><br><br><br><br><br></p><h1 id="éƒ¨ç½²å’Œæ²»ç†"><a href="#éƒ¨ç½²å’Œæ²»ç†" class="headerlink" title="éƒ¨ç½²å’Œæ²»ç†"></a>éƒ¨ç½²å’Œæ²»ç†</h1><p>ç½‘ä¸Šå¾ˆå°‘å…³äºå¾®å‰ç«¯åº”ç”¨çš„éƒ¨ç½²å’Œæ²»ç†çš„ä»‹ç»ï¼Œä¸‹é¢ä»‹ç»æˆ‘ä»¬è‡ªå·±æ‘¸ç´¢å‡ºæ¥ä¸€å¥—æ–¹æ¡ˆï¼Œ è¿™ä¹Ÿæ˜¯æœ¬æ–‡çš„é‡ç‚¹ã€‚</p><p><br></p><h2 id="å®¹å™¨åŒ–"><a href="#å®¹å™¨åŒ–" class="headerlink" title="å®¹å™¨åŒ–"></a>å®¹å™¨åŒ–</h2><p>åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬çš„å‰ç«¯é¡¹ç›®éƒ½æ˜¯æ‰”åˆ°ä¸€å°é™æ€èµ„æºæœåŠ¡å™¨ï¼Œå¾ˆå¤šå¼€å‘è€…ä¼šæ‰‹åŠ¨æ“ä½œï¼Œé¡¹ç›®ä¹‹å‰é€šè¿‡ç›®å½•éš”ç¦»ï¼Œæ‰‹åŠ¨ç»´æŠ¤ Nginx è¿›è¡Œåˆ†æµï¼Œæ‰‹æ®µåŸå§‹ä¸”å®¹æ˜“å‡ºé”™ï¼Œåœºé¢ååˆ†æ··ä¹±ã€‚</p><p>åœ¨ 2021 å¹´ï¼Œæˆ‘ä»¬å°±å¼€å§‹æ¨è¡Œå‰ç«¯é¡¹ç›®çš„å®¹å™¨åŒ–ï¼Œæ¥è§£å†³è¿™ç§æ··ä¹±çš„çŠ¶æ€ã€‚</p><p>ä¸ºäº†<code>æ ‡å‡†åŒ–</code>ã€<code>è‡ªåŠ¨åŒ–</code>æ¯ä¸ªé¡¹ç›®çš„æ„å»ºæ“ä½œã€éƒ¨ç½²æµç¨‹ï¼Œæˆ‘ä»¬å’Œåç«¯å¯¹é½ï¼Œ ä½¿ç”¨å®¹å™¨å’Œ K8S æ¥å®ç°å‘å¸ƒäº§ç‰©çš„å°è£…å’Œéƒ¨ç½²ã€‚è¿™æ ·çš„å¥½å¤„æ˜¯ï¼š</p><ul><li>å®ç°æµ‹è¯•ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒçš„ç»Ÿä¸€ã€‚</li><li>ç®€åŒ–éƒ¨ç½²æµç¨‹ï¼Œ é‡‡ç”¨ç»Ÿä¸€çš„é…ç½®ï¼Œæ— éœ€æ›´æ”¹ Nginx é…ç½®</li><li>çœŸæ­£åšåˆ°ä¸åŒå›¢é˜Ÿé¡¹ç›®çš„éš”ç¦»ã€‚</li><li>æ”¯æŒå›æ»š</li><li>ç®€åŒ–å’Œæ ‡å‡†åŒ–æ„å»ºæµç¨‹ã€‚åŒæ—¶ä¹Ÿç®€åŒ–äº†è¿ç»´çš„å·¥ä½œï¼Œå‰åç«¯éƒ½æ˜¯å®¹å™¨éƒ¨ç½²ã€‚</li><li>è¿è¡Œçš„ç¯å¢ƒæ›´åŠ çµæ´»ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æœ€æ–°çš„ nginx ç‰ˆæœ¬ï¼Œå¯ä»¥ä½¿ç”¨ HTTP2 ç­‰æ–°çš„æŠ€æœ¯ï¼Œå‰ç«¯è‡ªå·±å°±å¯ä»¥éƒ¨ç½²ä¸€å¥— NodeJS ç¯å¢ƒï¼Œåšä¸€äº›æ›´é…·çš„äº‹æƒ…ã€‚å¯¹è¿ç»´çš„ä¾èµ–æ€§ä¼šæ›´ä½ã€‚</li></ul><p><br></p><p>è¿™å¯¹æˆ‘ä»¬æ¥è¯´æ˜¯ä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„å‡çº§ã€‚æˆ‘ä»¬çš„å·¥ä½œä¸å†å±€é™äºé™æ€èµ„æºçš„ä¼ºæœï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ NodeJS å¼€å‘ APIã€è‡ªåŠ¨åŒ–å·¥ä½œæµã€å¯ä»¥è¿›è¡ŒæœåŠ¡ç«¯æ¸²æŸ“ç­‰ç­‰ï¼Œæ‹“å±•äº†èƒ½åŠ›çš„è¾¹ç•Œã€‚</p><p><br><br><br></p><p>ç„¶è€Œï¼Œå¾ˆå¤šé…ç½®ä¿¡æ¯åœ¨æ„å»ºæ—¶å°±å›ºå®šä¸‹æ¥äº†ï¼Œæ¯”å¦‚ CDN åŸŸåï¼Œæ¥å£è¯·æ±‚è·¯å¾„ç­‰ç­‰ã€‚è€Œä¸åŒç¯å¢ƒé€šå¸¸ä¼šä½¿ç”¨ä¸åŒçš„é…ç½®ä¿¡æ¯ã€‚<strong>è¿™æ ·å°±æ— æ³•å®ç°æ„å»ºä¸€æ¬¡é•œåƒï¼Œåœ¨ä¸åŒç¯å¢ƒè¿è¡Œã€‚</strong></p><p>åç«¯ç¨‹åºçš„è§£å†³åŠæ³•æ˜¯å°†é…ç½®ä¿¡æ¯å¤–ç½®ï¼Œæ¯”å¦‚é€šè¿‡<code>ç¯å¢ƒå˜é‡</code>é…ç½®æˆ–è€…ä»<code>é…ç½®ä¸­å¿ƒ</code>(æ¯”å¦‚ Nacos)è·å–ã€‚</p><p>è¿™åœ¨å‰ç«¯è¡Œä¸é€šï¼Œæ‰€ä»¥æˆ‘ä»¬å¼•å…¥äº†<code>è¿è¡Œå®¹å™¨</code>çš„æ¦‚å¿µã€‚</p><p><br><br><br></p><h2 id="è¿è¡Œå®¹å™¨"><a href="#è¿è¡Œå®¹å™¨" class="headerlink" title="è¿è¡Œå®¹å™¨"></a>è¿è¡Œå®¹å™¨</h2><p><code>è¿è¡Œå®¹å™¨</code>ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯æ•´å¥—<code>å¾®å‰ç«¯</code> çš„<code>è¿è¡Œæ—¶</code>ï¼Œä»¥ ã€Œ<code>Docker å®¹å™¨</code>ã€çš„å½¢å¼éƒ¨ç½²ã€‚æˆ‘ä»¬å°½é‡å¤ç”¨ K8S æä¾›çš„åŸºç¡€è®¾æ–½(æ¯”å¦‚ PVCã€é…ç½®æ˜ å°„ã€Sidecar ç­‰) æ¥å®ç°ã€‚</p><p>è¿è¡Œå®¹å™¨çš„ä¸»è¦ç»“æ„ï¼š</p><p><img src="/images/microfrontend/Untitled%2010.png" alt="container"></p><p><code>è¿è¡Œå®¹å™¨</code>ä¸»è¦åŒ…å«ä¸¤å¤§éƒ¨åˆ†ï¼š</p><ul><li><code>Nginx</code> ï¼šæ¯«æ— ç–‘é—®ï¼ŒNginx æ˜¯<code>é™æ€èµ„æºä¼ºæœ</code>çš„æœ€ä½³èƒ½æ‰‹ï¼ŒåŒæ—¶å®ƒä½œä¸ºå†…éƒ¨æœåŠ¡<code>åå‘ä»£ç†</code>ã€‚</li><li><code>transpiler</code> (æˆ‘ä»¬ç§°ä¸º<code>è½¬æ¢å™¨</code>): è¿™æ˜¯ä¸€ä¸ªã€Œæ¬è¿å·¥ã€ï¼Œä¸»è¦è´Ÿè´£é…ç½®çš„æ”¶é›†ã€ä»£ç è½¬æ¢ã€‚å¹¶å°†è½¬æ¢åçš„é™æ€èµ„æºäº¤ç»™  <code>nginx</code>  ä¼ºæœã€‚</li></ul><p>ä¸‹é¢ä¼šè¯¦ç»†ä»‹ç»å®ƒçš„èƒ½åŠ›ã€‚</p><p><br><br><br></p><h2 id="å¦‚æœå®ç°å­åº”ç”¨çš„è‡ªåŠ¨å‘ç°ï¼Ÿ"><a href="#å¦‚æœå®ç°å­åº”ç”¨çš„è‡ªåŠ¨å‘ç°ï¼Ÿ" class="headerlink" title="å¦‚æœå®ç°å­åº”ç”¨çš„è‡ªåŠ¨å‘ç°ï¼Ÿ"></a>å¦‚æœå®ç°å­åº”ç”¨çš„è‡ªåŠ¨å‘ç°ï¼Ÿ</h2><p>ç­”æ¡ˆæ˜¯<strong>â€çº¦å®šâ€œ</strong>ã€‚</p><p>è¿è¡Œå®¹å™¨çº¦å®šäº†ä»¥ä¸‹ç›®å½•ï¼š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/data/</span><br><span class="line">  /<span class="built_in">source</span>/                   <span class="comment"># æºç›®å½•</span></span><br><span class="line">    /__public__/             <span class="comment"># å…¬å…±èµ„æº, å¤–éƒ¨å¯ä»¥ç›´æ¥è®¿é—®ï¼Œä¸éœ€è¦ __public__ å‰ç¼€</span></span><br><span class="line">    /__config__/             <span class="comment"># é…ç½®ç›®å½•</span></span><br><span class="line">      config.yml</span><br><span class="line">      any-sub-dir/</span><br><span class="line">        my-config.yml</span><br><span class="line"></span><br><span class="line">    /__entry__/              <span class="comment"># åŸºåº§ç›®å½•</span></span><br><span class="line">      js/</span><br><span class="line">      index.html</span><br><span class="line"></span><br><span class="line">    /__apps__/               <span class="comment"># å­åº”ç”¨ç›®å½•</span></span><br><span class="line">      wkb/</span><br><span class="line">      dsp/</span><br><span class="line">      dmp/</span><br><span class="line">        js/</span><br><span class="line">        mapp.json</span><br><span class="line">        index.html</span><br><span class="line"></span><br><span class="line">    /__i18n__/               <span class="comment"># è¯­è¨€åŒ…ç›®å½•</span></span><br><span class="line">      zh.tr</span><br><span class="line">      en.tr</span><br><span class="line">      any-sub-dir/</span><br><span class="line">        zh.tr</span><br><span class="line">        en.tr</span><br><span class="line"></span><br><span class="line">    /__theme__/              <span class="comment"># ä¸»é¢˜ç›®å½•</span></span><br><span class="line">      config.yml</span><br><span class="line">      element-ui.css</span><br><span class="line">      element-plus.css</span><br><span class="line">      fonts/</span><br><span class="line">      i18n/</span><br><span class="line">        zh.tr</span><br><span class="line">        en.tr</span><br><span class="line"></span><br><span class="line">  /public/                    <span class="comment"># nginx ä¼ºæœç›®å½•</span></span><br></pre></td></tr></table></figure><p>ç›®å½•ç»“æ„è§£æï¼š</p><ul><li><code>/data/source</code>ã€‚æ²¡é”™ï¼Œ<code>transpiler</code>  å°±æ˜¯<code>è½¬è¯‘</code>å’Œæ¬è¿è¿™é‡Œçš„é™æ€èµ„æºã€‚</li><li><code>/data/public</code>ã€‚ <code>transpiler</code>  å°±æ˜¯å°†èµ„æºè½¬è¯‘åæ¬è¿åˆ°è¿™é‡Œï¼Œ<code>nginx</code>  å¯¹å¤–ä¼ºæœè¿™ä¸ªç›®å½•ã€‚</li></ul><p><br></p><blockquote><p>è½¬è¯‘ï¼Ÿ<code>transpiler</code> å¯ä»¥è®¤ä¸ºå°±æ˜¯ä¸€ä¸ªæ¨¡æ¿å¼•æ“ï¼Œå®ƒä¼šæ›¿æ¢ä»£ç é‡Œé¢çš„åŠ¨æ€å˜é‡ã€‚</p></blockquote><p><br></p><p>å†æ¥çœ‹  <code>/data/source</code>ï¼š</p><ul><li><code>__entry__</code>: åŸºåº§ç¼–è¯‘ä¹‹åçš„ä»£ç å°±éƒ¨ç½²è¿™é‡Œã€‚</li><li><code>__apps__</code>: å­åº”ç”¨ç¼–è¯‘ä¹‹åçš„ä»£ç å°±éƒ¨ç½²è¿™é‡Œï¼Œå­åº”ç”¨ä¹‹é—´ï¼Œ æŒ‰ç…§å”¯ä¸€çš„  <code>name</code>  åŒºåˆ†ç›®å½•ã€‚</li><li><code>__i18n__</code>: æ‰©å±•è¯­è¨€åŒ…ï¼Œæ–‡ä»¶æŒ‰ç…§  <code>&lt;language&gt;.tr</code>  å‘½åï¼Œ å­ç›®å½•çš„ .tr æ–‡ä»¶ä¹Ÿä¼šè¢«æ‰«æåˆ°ã€‚</li><li><code>__config__</code>: é…ç½®ç›®å½•ã€‚é…ç½®æ–‡ä»¶ä½¿ç”¨  <code>.yml</code>  æˆ–  <code>.yaml</code>  å‘½åï¼Œä¹Ÿå¯ä»¥æ”¾åœ¨å­ç›®å½•ä¸‹ã€‚</li><li><code>__theme__</code>: ä¸»é¢˜åŒ…ç›®å½•ã€‚å¯ä»¥æ‰‹åŠ¨ç»´æŠ¤ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨  <code>npmTheme</code>  é…ç½®é¡¹, è®©  <code>transpiler</code>  ä» npm æ‹‰å–ã€‚</li><li><code>__public__</code>: å…¬å…±èµ„æºç›®å½•ã€‚è¿™äº›èµ„æºå¯ä»¥ç›´æ¥è®¿é—®ï¼Œè€Œä¸éœ€è¦  <code>__public__</code>  å‰ç¼€ã€‚ä¸¾ä¸ªä¾‹å­:<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">__theme__/</span><br><span class="line">  index.css  *<span class="comment"># -&gt; è®¿é—®é“¾æ¥ example.com/__theme__/index.css*</span></span><br><span class="line">__public__/</span><br><span class="line">  hello.html *<span class="comment"># -&gt; è®¿é—®é“¾æ¥ example.com/hello.html*</span></span><br></pre></td></tr></table></figure></li></ul><p><br><br><br></p><p>é‚£  <code>transpiler</code>  çš„å·¥ä½œè¿‡ç¨‹åº”è¯¥æ¯”è¾ƒæ¸…æ™°äº†ï¼š</p><ul><li>æ‰«æ  <code>__apps__</code>  ä¸‹çš„<code>å­åº”ç”¨</code>ã€‚å¼€å‘è€…ä¹Ÿå¯ä»¥åœ¨<em>å­åº”ç”¨ç›®å½•ä¸‹</em>ä½¿ç”¨  <code>mapp.json</code>  æ˜¾å¼å®šä¹‰å­åº”ç”¨æè¿°ä¿¡æ¯ã€‚æ‰«æåçš„å­åº”ç”¨ä¿¡æ¯å°†æ”¾åœ¨  <code>microApps</code>  å˜é‡ä¸‹ã€‚</li><li>æ‰«æ  <code>__config__</code>  ä¸‹çš„é…ç½®æ–‡ä»¶ã€‚è§£æå‡ºé…ç½®ä¿¡æ¯ã€‚</li><li>æ‰«æ  <code>__i18n__</code>  ä¸‹çš„  <code>.tr</code>, è§£æç»“æœæ”¾åœ¨  <code>i18n</code>  å˜é‡ä¸‹ã€‚</li><li>æ‰«æ  <code>__theme__</code>  ç›®å½•ã€‚<code>__theme__</code>  ä¸»é¢˜åŒ…ä¹Ÿæ”¯æŒæºå¸¦é…ç½®æ–‡ä»¶ã€è¯­è¨€åŒ…ï¼Œæ‰€ä»¥è¿™äº›ä¿¡æ¯ä¹Ÿä¼šåˆå¹¶åˆ°é…ç½®ä¿¡æ¯ä¸­ã€‚å¦å¤– CSS æ–‡ä»¶ã€JavaScript æ–‡ä»¶å°†è¢«æ”¶é›†åˆ°  <code>theme</code>  å˜é‡ä¸­ã€‚</li></ul><p><br></p><p>æ‰«æå®Œæ¯•ä¹‹åï¼Œ<code>transpiler</code>  æ‹¿ç€é…ç½®ä¿¡æ¯è¿›è¡Œ<code>æ¨¡æ¿è½¬è¯‘</code>ï¼Œå°†  <code>/data/source</code>  ä¸‹çš„é™æ€èµ„æºè½¬æ¢è¢«æ‹·è´åˆ°  <code>/data/public</code>  ç›®å½•ä¸‹ã€‚</p><p>æ¥çœ‹ä¸ªå®é™…çš„æ¨¡æ¿ä¾‹å­:</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">""</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"IE=edge"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width,initial-scale=1"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"description"</span> <span class="attr">content</span>=<span class="string">"[%= description %]"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"keywords"</span> <span class="attr">content</span>=<span class="string">"[%= keywords %]"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"icon"</span> <span class="attr">href</span>=<span class="string">"[%= assets.IMG_BAY_FAVICON || entryPath + '/favicon.png' %]"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"version"</span> <span class="attr">content</span>=<span class="string">"[%= version %]"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"update-time"</span> <span class="attr">content</span>=<span class="string">"[%= `$&#123;year&#125;-$&#123;month&#125;-$&#123;date&#125;` %]"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>[%= title %]<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--! [%- theme.stylesheets.map(i =&gt; `&lt;link rel="stylesheet" href="$&#123;i + '?' + hash &#125;" /&gt;`).join('\n') %] --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--! [%- theme.scripts.map(i =&gt; `&lt;script async="true" src="$&#123;i + '?' + hash&#125;"&gt;&lt;/script&gt;`).join('\n') %] --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--! [% if (microApps.length) &#123; %] --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--! [%- </span></span><br><span class="line"><span class="comment">      `&lt;script&gt;</span></span><br><span class="line"><span class="comment">        // å¾®åº”ç”¨æ³¨å…¥</span></span><br><span class="line"><span class="comment">        (window.__MAPPS__ = (window.__MAPPS__ || [])).push($&#123;microApps.map(i =&gt; JSON.stringify(i)).join(', ')&#125;);</span></span><br><span class="line"><span class="comment">      &lt;/script&gt;`</span></span><br><span class="line"><span class="comment">    %] --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--! [% &#125; %]--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--! [%- `&lt;script&gt;</span></span><br><span class="line"><span class="comment">      // é™æ€èµ„æºæ³¨å…¥</span></span><br><span class="line"><span class="comment">      (window.__MAPP_ASSETS__ = (window.__MAPP_ASSETS__ || [])).push($&#123;JSON.stringify(assets)&#125;);</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">      // å…¨å±€å…±äº«çš„è¯­è¨€åŒ…</span></span><br><span class="line"><span class="comment">      window.__I18N_BUNDLES__ = $&#123;JSON.stringify(i18n)&#125;;</span></span><br><span class="line"><span class="comment">    &lt;/script&gt;` %] --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span></span></span><br><span class="line"><span class="tag">      <span class="attr">defer</span>=<span class="string">"defer"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">src</span>=<span class="string">"[%= cdnDomain ? '//' + cdnDomain : '' %][%= removeTrailingSlash(base) %]/__entry__/js/chunk-vendors.582ba02c.js?[%= hash %]"</span></span></span><br><span class="line"><span class="tag">    &gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span></span></span><br><span class="line"><span class="tag">      <span class="attr">defer</span>=<span class="string">"defer"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">src</span>=<span class="string">"[%= cdnDomain ? '//' + cdnDomain : '' %][%= removeTrailingSlash(base) %]/__entry__/js/app.01bd68bb.js?[%= hash %]"</span></span></span><br><span class="line"><span class="tag">    &gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span></span></span><br><span class="line"><span class="tag">      <span class="attr">href</span>=<span class="string">"[%= cdnDomain ? '//' + cdnDomain : '' %][%= removeTrailingSlash(base) %]/__entry__/css/app.d835cada.css?[%= hash %]"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">rel</span>=<span class="string">"stylesheet"</span></span></span><br><span class="line"><span class="tag">    /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">noscript</span></span></span><br><span class="line"><span class="tag">      &gt;</span><span class="tag">&lt;<span class="name">strong</span></span></span><br><span class="line"><span class="tag">        &gt;</span>We're sorry but [%= title %] doesn't work properly without JavaScript enabled. Please</span><br><span class="line">        enable it to continue.</span><br><span class="line">      <span class="tag">&lt;/<span class="name">strong</span>&gt;</span><span class="tag">&lt;/<span class="name">noscript</span></span></span><br><span class="line"><span class="tag">    &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p><br><br><br></p><p>ä¸Šé¢æ˜¯åŸºåº§çš„  <code>index.html</code>  æ¨¡æ¿ã€‚<code>transpiler</code>  åŸºäº  <strong><a href="https://ejs.bootcss.com/" target="_blank" rel="noopener">ejs</a></strong>  æ¨¡æ¿å¼•æ“ï¼Œä¼šè§£ææ›¿æ¢æ–‡æœ¬æ–‡ä»¶ä¸­  <code>[% æ¨¡æ¿ %]</code>  è¯­æ³•ã€‚</p><p><br></p><p>è¿˜æœ‰å¾ˆå¤šç”¨æ³•å€¼å¾—å»æŒ–æ˜ã€‚ æ¯”å¦‚:</p><ul><li>å…¨å±€åŸ‹ç‚¹è„šæœ¬æ³¨å…¥</li><li>å…¨å±€ç›‘æ§è„šæœ¬æ³¨å…¥</li><li>â€¦</li></ul><p>åŸç†å°±æ˜¯è¿™ä¹ˆç®€å•ï¼Œåªè¦å­åº”ç”¨éƒ¨ç½²åˆ° <code>__apps__</code> ç›®å½•ä¸‹ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç›‘å¬åˆ°ï¼Œæ”¶é›†åˆ°å¿…è¦çš„ä¿¡æ¯åï¼Œå¯¹ <code>source</code> ç›®å½•ä¸‹çš„é™æ€æ–‡ä»¶è¿›è¡Œè½¬è¯‘ï¼Œè¾“å‡ºåˆ° <code>public</code> ç›®å½•ä¸‹ï¼Œæœ€ç»ˆç”± Nginx è´Ÿè´£å°†æ–‡ä»¶ä¼ é€’ç»™æµè§ˆå™¨ã€‚</p><p><br><br><br><br><br></p><h2 id="éƒ¨ç½²å’Œè¿ç»´"><a href="#éƒ¨ç½²å’Œè¿ç»´" class="headerlink" title="éƒ¨ç½²å’Œè¿ç»´"></a>éƒ¨ç½²å’Œè¿ç»´</h2><p>é‚£ä¹ˆå­åº”ç”¨å…·ä½“å¦‚ä½•éƒ¨ç½²å’Œè¿ç»´å‘¢ï¼Ÿ</p><p>å­åº”ç”¨æ„å»ºã€ç”Ÿæˆå’Œå‘å¸ƒå®¹å™¨çš„è¿‡ç¨‹è¿™é‡Œå°±ä¸å±•å¼€è¯´äº†ï¼Œå¯ä»¥è‡ªè¡Œæœç´¢ Docker çš„ç›¸å…³æ•™ç¨‹ï¼Œæˆ‘ä»¬è¿™é‡Œä¸»è¦ç®€å•ä»‹ç»ä¸€ä¸‹åœ¨ K8S å¹³å°å¦‚ä½•éƒ¨ç½²å’Œè¿ç»´ã€‚</p><p>å°†åŸºåº§å’Œå­åº”ç”¨èšåˆåœ¨ä¸€èµ·ï¼Œæˆ‘ä»¬éœ€è¦ç”¨åˆ° <code>PVC</code> (PersistentVolumeClaim, å³æŒä¹…åŒ–å·), ä½ å¯ä»¥è®¤ä¸º PVC å°±æ˜¯ä¸€ä¸ªã€Œç½‘ç»œç¡¬ç›˜ã€ï¼Œè€Œæ¯ä¸ªå­åº”ç”¨ã€åŸºåº§éƒ½æ˜¯ç‹¬ç«‹è¿è¡Œçš„ã€Œä¸»æœºã€(<code>Pod</code> æˆ– å®¹å™¨ , <em>Kubernetes</em>  ä¸­å¯éƒ¨ç½²çš„æœ€å°ã€æœ€åŸºæœ¬å¯¹è±¡), è¿™ä¸ª PVC å¯ä»¥è¢«æ¯ä¸ªå­åº”ç”¨å…±äº«è®¿é—®ï¼Œåªè¦æŒ‰ç…§çº¦å®šå°†å­åº”ç”¨çš„é™æ€æ–‡ä»¶æ‹·è´åˆ° PVC å¯¹åº”ä½ç½®å°±è¡Œäº†ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/images/microfrontend/Untitled%2011.png" alt="PVC"></p><p><br><br><br><br><br></p><p>è‡³äºå­åº”ç”¨å’Œè¿è¡Œå®¹å™¨åœ¨ K8S ä¸‹å¦‚ä½•ç»„ç»‡ï¼Œå¯ä»¥éå¸¸çµæ´»ï¼Œå–å†³äºéœ€æ±‚å’Œç¯å¢ƒã€‚ç¬”è€…å®è·µè¿‡ä»¥ä¸‹å‡ ç§æ–¹å¼ï¼š</p><ol><li><p>å…¨éƒ¨éƒ¨ç½²åœ¨ä¸€ä¸ª Pod ä¸‹ã€‚å­åº”ç”¨ä½œä¸º <code>Init Sidecar</code>ï¼ˆåˆå§‹åŒ–è¾¹è½¦ï¼‰ã€‚è¿™ç§éƒ¨ç½²æ–¹å¼æ¯”è¾ƒç®€å•ï¼Œç¼ºç‚¹å°±æ˜¯ä»»æ„ä¸€ä¸ªåº”ç”¨éœ€è¦æ›´æ–°ï¼Œæ•´ä¸ª Pod éƒ½è¦é‡å¯ï¼ŒåŒ…æ‹¬è¿è¡Œå®¹å™¨ã€‚</p><p><img src="/images/microfrontend/Untitled%2012.png" alt="æ–¹æ³•1"></p><p>ç¤ºä¾‹å›¾ï¼š</p><p><img src="/images/microfrontend/Untitled%2013.png" alt="Sidecar"></p></li><li><p>åˆ†ç¦»è¿è¡Œå®¹å™¨å’Œå­åº”ç”¨ã€‚ä¸ºäº†é¿å…å­åº”ç”¨æ›´æ–°å¯¼è‡´æ•´ä¸ª Pod é‡å¯ï¼ˆåŒ…æ‹¬è¿è¡Œå®¹å™¨ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥å°†å­åº”ç”¨å•ç‹¬æ‹å‡ºå»ï¼Œå­åº”ç”¨æ›´æ–°åªä¼šé‡å¯æ‰€åœ¨çš„ Podï¼Œä»è€Œé¿å…è¿è¡Œå®¹å™¨åœæœºã€‚</p><p><img src="/images/microfrontend/Untitled%2014.png" alt="æ–¹æ³•2"></p></li><li><p>æ¯ä¸ªå­åº”ç”¨éƒ½æ˜¯ç‹¬ç«‹çš„ Podã€‚å¥½å¤„å°±æ˜¯æ¯ä¸ªå­åº”ç”¨å¯ä»¥çœŸæ­£åšåˆ°ç‹¬ç«‹éƒ¨ç½²ã€å¯åŠ¨ï¼Œåå¤„å°±æ˜¯ç®¡ç†èµ·æ¥ç¨æ˜¾éº»çƒ¦ã€‚</p><p><img src="/images/microfrontend/Untitled%2015.png" alt="æ–¹æ³•3"></p></li></ol><p>å¼€å‘è€…å¯ä»¥æ ¹æ®è‡ªå·±çš„è¿è¡Œç¯å¢ƒé€‰æ‹©ä¸åŒçš„ç»„ç»‡æ–¹å¼ã€‚</p><p><br><br><br><br><br></p><h2 id="é‚£ä¹ˆé…ç½®å‘¢ï¼Ÿ"><a href="#é‚£ä¹ˆé…ç½®å‘¢ï¼Ÿ" class="headerlink" title="é‚£ä¹ˆé…ç½®å‘¢ï¼Ÿ"></a>é‚£ä¹ˆé…ç½®å‘¢ï¼Ÿ</h2><p>é¦–å…ˆç®€å•çš„é…ç½®å¯ä»¥é€šè¿‡<code>ç¯å¢ƒå˜é‡</code>æ¥å®ç°ï¼Œå› ä¸ºåœ¨ K8S ä¸­ï¼Œé…ç½®ç¯å¢ƒå˜é‡ç›¸å¯¹ç®€å•å¾ˆå¤š:</p><p><img src="/images/microfrontend/Untitled%2016.png" alt="ç¯å¢ƒå˜é‡é…ç½®"></p><p>å¯¹äºç¨å¾®å¤æ‚çš„é…ç½®ï¼Œå¯ä»¥ä½¿ç”¨<code>é…ç½®æ˜ å°„</code>(Config-Maps), é…ç½®æ˜ å°„çš„æ¯ä¸ªé”®å€¼å¯¹å°±ç›¸å½“äºä¸€ä¸ªæ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‚è½½åˆ°å®¹å™¨çš„ä»»ä½•ä½ç½®ä¸Šï¼š</p><p>å®šä¹‰é…ç½®æ˜ å°„ï¼š</p><p><img src="/images/microfrontend/Untitled%2017.png" alt="å®šä¹‰é…ç½®æ˜ å°„"></p><p>æŒ‚è½½é…ç½®æ˜ å°„ï¼š</p><p><img src="/images/microfrontend/Untitled%2018.png" alt="æŒ‚è½½é…ç½®æ˜ å°„"></p><p>é…ç½®æ˜ å°„å¯ä»¥æŒ‚è½½åˆ°ä»»æ„çš„è·¯å¾„æˆ–æ–‡ä»¶ä¸Šï¼Œå®ƒè¿˜æœ‰ä¸€ä¸ªæ›´èµçš„èƒ½åŠ›<strong>æ˜¯ï¼šæˆ‘ä»¬å¯ä»¥ç›´æ¥ä¿®æ”¹é…ç½®æ˜ å°„ï¼Œè¿™äº›å˜åŠ¨ä¼šåŒæ­¥åˆ°å®¹å™¨å†…ï¼Œä»è€Œå®ç°å®æ—¶å˜æ›´</strong>ã€‚</p><p>å°ç»“ã€‚æˆ‘ä»¬å°½é‡å¤ç”¨äº† K8S æœ¬èº«çš„èƒ½åŠ›ï¼Œè¿™äº›èƒ½åŠ›è¶³ä»¥å®ç°è¾ƒä¸ºå¤æ‚åŠŸèƒ½ï¼Œé¿å…é‡å¤é€ è½®å­ã€‚</p><p><br><br><br><br><br></p><h2 id="æ›´å¤š"><a href="#æ›´å¤š" class="headerlink" title="æ›´å¤š"></a>æ›´å¤š</h2><p>é™äºç¯‡å¹…å¾ˆå¤šç»†èŠ‚æ— æ³•å±•å¼€ï¼Œè¿™é‡Œç‚¹åˆ°ä¸ºæ­¢ï¼š</p><ul><li><strong>å¦‚ä½•å®ç°ä¸€é”®éƒ¨ç½²ï¼Ÿ</strong>å› ä¸ºä½¿ç”¨çš„æ˜¯å®¹å™¨åŒ–éƒ¨ç½²ï¼Œå¯ä»¥å°†æ‰€æœ‰éƒ¨ç½²å£°æ˜åœ¨ <a href="https://www.notion.so/b590284a71934f97a1db71ef967fbc5a?pvs=21" target="_blank" rel="noopener">yaml æ–‡ä»¶</a>ä¸­ç»´æŠ¤, æ–°ç¯å¢ƒéƒ¨ç½²æ—¶ç›´æ¥å¯¼å…¥å°±è¡Œã€‚æˆ‘ä»¬ä¹Ÿå¼€å‘è¿‡ä¸€ä¸ª<a href="https://wakeadmin.wakedata.com/k8s-deploy/index.html#/micro" target="_blank" rel="noopener">å¯è§†åŒ–ç”Ÿæˆ yaml çš„ç®€æ˜“åº”ç”¨</a></li><li><strong>è‡ªåŠ¨åŒ–éƒ¨ç½²ï¼Ÿ</strong>å®ç°è‡ªåŠ¨åŒ–éƒ¨ç½²æœ‰å¾ˆå¤šæ‰‹æ®µï¼Œå¦‚æœä½ çš„å…¬å¸æœ‰ DevOps å¹³å°(æ¯”å¦‚æˆ‘ä»¬ä½¿ç”¨ Zadig) , è¿™äº›å¹³å°æœ¬èº«å°±æä¾›äº†è‡ªåŠ¨åŒ–éƒ¨ç½²çš„èƒ½åŠ›ï¼Œä½ å¯ä»¥æŸ¥çœ‹ç›¸å…³æ–‡æ¡£ã€‚å¦å¤–åœ¨ Jenkins ä¸­ä¹Ÿæœ‰ç›¸å…³çš„æ’ä»¶æ¥å®ç°éƒ¨ç½²æ¨é€ã€‚å†ä¸æµï¼Œ<a href="https://www.notion.so/a2b1fb632eb44b68b161a38f256756db?pvs=21" target="_blank" rel="noopener">å¯ä»¥ä½¿ç”¨ rancher çš„ CLI ç­‰ç­‰</a>ã€‚</li><li><strong>å­åº”ç”¨å¦‚ä½•å…±äº«ä¾èµ–ï¼Ÿ</strong>å¯ä»¥ä½¿ç”¨ <a href="https://webpack.js.org/configuration/externals/#externals" target="_blank" rel="noopener">externals</a>, æˆ–è€… Webpack 5 çš„ *<strong>*<a href="https://webpack.js.org/concepts/module-federation/#motivation" target="_blank" rel="noopener">Module Federation</a>,</strong> æˆ‘ä»¬ä¹Ÿæ¢ç´¢è¿‡ç±»ä¼¼ <a href="https://www.jsdelivr.com/" target="_blank" rel="noopener">jsDelivr</a> çš„æ–¹æ¡ˆï¼Œ è¯¦è§<a href="https://wakeadmin.wakedata.com/mapp/advanced/vendors.html#%E9%85%8D%E7%BD%AE%E9%A1%B9" target="_blank" rel="noopener">è¿™é‡Œ</a></li><li><strong>æ¥å£æœåŠ¡</strong>ã€‚è¿è¡Œå®¹å™¨é™¤äº†ä¸Šæ–‡è®²åˆ°çš„å„ç§åŠŸèƒ½ï¼Œè¿˜å¯ä»¥æä¾›ä¸€äº›é€ ç¦å‰ç«¯çš„<a href="https://wakeadmin.wakedata.com/mapp/advanced/services.html" target="_blank" rel="noopener">æ¥å£æœåŠ¡</a>ï¼Œæ¯”å¦‚æ¥å£ä»£ç†ã€polyfill æœåŠ¡ã€vendor ä¾èµ–ã€‚</li><li><strong><em>å®‰å…¨é…ç½®</em></strong>ã€‚åœ¨è¿è¡Œå®¹å™¨ä¸­ç»Ÿä¸€é…ç½® CSPã€è·¨åŸŸç­‰å®‰å…¨é…ç½®</li><li>â€¦</li></ul><p><br><br><br><br><br></p><h2 id="æœ‰å“ªäº›æœ€ä½³å®è·µ"><a href="#æœ‰å“ªäº›æœ€ä½³å®è·µ" class="headerlink" title="æœ‰å“ªäº›æœ€ä½³å®è·µ?"></a>æœ‰å“ªäº›æœ€ä½³å®è·µ?</h2><ul><li><strong>ä¿æŒåŸºåº§ä¸šåŠ¡æ— å…³æ€§</strong>ã€‚æˆ‘ä»¬å°½é‡ä¿è¯åŸºåº§ä¸è€¦åˆä¸šåŠ¡ï¼Œä¸ºäº†é¿å…å­åº”ç”¨çš„ä¸šåŠ¡ä¾µå…¥åˆ°åŸºåº§ï¼Œæˆ‘ä»¬ä¸¥æ ¼ç®¡æ§åŸºåº§ä»“åº“çš„å¼€å‘æƒé™ï¼Œä»¥åŠå‘ä¸‹æš´éœ²æ¥å£çš„æˆªé¢ã€‚</li><li><strong>ä¿æŒå­åº”ç”¨ä¹‹é—´çš„ç‹¬ç«‹æ€§</strong>ã€‚åŸºåº§é™¤äº† <code>EventBus</code> ï¼Œæ²¡æœ‰æä¾›å…¶ä»–åº”ç”¨é€šä¿¡çš„æ‰‹æ®µã€‚å¯¹æˆ‘ä»¬æ¥è¯´ï¼Œå¾®å‰ç«¯åªä¸è¿‡æ˜¯å¤šé¡µåº”ç”¨çš„å»¶ç»­ã€‚ è®¾è®¡è‰¯å¥½çš„åº”ç”¨ï¼Œä¸åº”è¯¥è€¦åˆå…¶ä»–åº”ç”¨ã€‚å°±ç®—æ˜¯ä¸€äº›å…±äº«çŠ¶æ€ï¼Œä¹Ÿå¯ä»¥ä»åç«¯è¯»å–ã€‚</li><li><strong>é¿å…ç¡¬ç¼–ç é…ç½®ä¿¡æ¯</strong>ã€‚å› ä¸º<code>è¿è¡Œå®¹å™¨</code>æœ‰åŠ¨æ€æ›¿æ¢å˜é‡çš„èƒ½åŠ›ï¼Œå› æ­¤åº”è¯¥é¿å…åœ¨ä»£ç ä¸­ç¡¬ç¼–ç é…ç½®ä¿¡æ¯ï¼Œæ¯”å¦‚åŸŸåä¿¡æ¯ã€ä¼ä¸šæ–‡æ¡ˆã€æœåŠ¡å™¨é“¾æ¥ã€‚è€Œæ˜¯é¢„ç•™æ¨¡æ¿, åœ¨éƒ¨ç½²æ—¶é€šè¿‡<strong><a href="https://wakeadmin.wakedata.com/mapp/deploy.html" target="_blank" rel="noopener">è¿è¡Œå®¹å™¨</a></strong>æ¥é…ç½®ã€‚</li><li><strong>æŒ‰ç…§ä¸šåŠ¡èšåˆå­åº”ç”¨</strong>ã€‚å³æŒ‰ç…§ä¸šåŠ¡è¾¹ç•Œæ¥æ‹†åˆ†å­åº”ç”¨ï¼Œè€Œä¸æ˜¯æŒ‰ç…§â€˜èœå•â€™ï¼Œ å…·ä½“æ¥è¯´å­åº”ç”¨åº”è¯¥å¯¹åº”åç«¯çš„å¾®æœåŠ¡ï¼Œå°½ç®¡å¾ˆå¤šæ—¶å€™åšä¸åˆ°ã€‚</li></ul><p><br><br><br><br><br></p><h2 id="æœªæ¥"><a href="#æœªæ¥" class="headerlink" title="æœªæ¥"></a>æœªæ¥</h2><p>æˆ‘ä»¬æ•´å¥—æ–¹æ¡ˆå¹¶æ²¡æœ‰â€˜è‡ªé€ â€™å¤æ‚çš„æŠ€æœ¯ï¼Œè€Œæ˜¯åŸºäºå·²æœ‰çš„å·¥å…·æ•´åˆèµ·æ¥çš„èƒ½åŠ›ã€‚è¿™ä¹Ÿæ˜¯ç¬”è€…ä¸€ç›´åšæŒçš„è§‚å¿µï¼Œç®€å•è‡³ä¸Šã€‚</p><p>è¿™ä¸ªæ–¹æ¡ˆæœªæ¥ä¼šå¦‚ä½•è¿­ä»£å‘¢ï¼Ÿ</p><ul><li>å¯è§†åŒ–æ–¹å¼ï¼Œç®€åŒ–éƒ¨ç½²çš„æµç¨‹ã€‚æ¯•ç«Ÿä¸æ˜¯æ‰€æœ‰å¼€å‘è€…éƒ½ç†Ÿæ‚‰ K8S è¿™å¥—æ¦‚å¿µ</li><li>å‘å¸ƒæµç¨‹å®¡æ ¸ã€‚ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å®¡æ ¸ã€‚</li><li>åŸºåº§æ’ä»¶ã€‚æ”¯æŒæ‰©å±•ä¸€äº›é™¤å­åº”ç”¨ä¹‹å¤–çš„åœºæ™¯ï¼Œæ¯”å¦‚ä¸€äº›å…¨å±€é€šç”¨çš„ä¸šåŠ¡ SDKã€ç»„ä»¶åº“ã€‚å¸¸è§„çš„å­åº”ç”¨åªä¼šåœ¨è·¯ç”±åŒ¹é…åˆ°æ—¶æ¿€æ´»ï¼Œè€Œæ’ä»¶ä¼šåœ¨åŸºåº§å¯åŠ¨ååŠ è½½å¹¶æŒä¹…å­˜åœ¨ã€‚</li><li>æ”¯æŒå­åº”ç”¨æ‰©å±•æœåŠ¡ç«¯çš„èƒ½åŠ›ã€‚å½“å‰çš„å­åº”ç”¨éƒ½æ˜¯ CSRï¼Œåç»­è¿è¡Œå®¹å™¨å¯ä»¥æ”¯æŒå­åº”ç”¨æ‰©å±•æœåŠ¡ç«¯æ¥å£ã€‚</li><li>ç°åº¦å‘å¸ƒã€‚</li><li>æ”¯æŒ Vite</li><li>â€¦</li></ul><p><br><br><br><br><br></p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æœ¬æ–‡å¤§æ¦‚ä»‹ç»äº†æˆ‘ä»¬è½åœ°å’Œæ²»ç†å¾®å‰ç«¯åº”ç”¨çš„å¤§æ¦‚æ€è·¯ã€‚è¿™å¥—ä½“ç³»ä¸­ä¸»è¦åŒ…å«äº†ä¸‰ä¸ªä¸»è¦éƒ¨ä»¶ï¼š</p><p><img src="/images/microfrontend/Untitled%2019.png" alt="å¾®å‰ç«¯"></p><ul><li>åŸºåº§ï¼š<code>é›†ä¸­å¼</code>çš„å¾®å‰ç«¯æ–¹æ¡ˆï¼ŒåŸºåº§æ˜¯æ•´ä¸ªå¾®å‰ç«¯çš„æ ¸å¿ƒï¼Œè´Ÿè´£ç®¡ç†å­åº”ç”¨ï¼Œå¹¶ä¸ºå­åº”ç”¨çš„å¼€å‘æä¾›å¿…è¦çš„æ”¯æ’‘</li><li>å­åº”ç”¨ï¼šè´Ÿè´£å…·ä½“ä¸šåŠ¡å®ç°ï¼ŒæŒ‰ç…§ä¸šåŠ¡èšåˆå’Œæ‹†åˆ†ã€‚</li><li>è¿è¡Œå®¹å™¨ï¼šä¸ºå¾®å‰ç«¯åº”ç”¨æ¶æ„æä¾›äº†éƒ¨ç½²å’Œæ²»ç†æ–¹æ¡ˆ</li></ul><p>å› ä¸ºæ–‡ç« ç¯‡å¹…åŸå› ï¼Œè¿™é‡Œé¢å¾ˆå¤šç»†èŠ‚æ— æ³•å±•å¼€ã€‚æ„Ÿå…´è¶£çš„å¯ä»¥ç§»æ­¥æˆ‘ä»¬<a href="https://wakeadmin.wakedata.com/mapp/index.html" target="_blank" rel="noopener">å…¬å¼€çš„æ–‡æ¡£</a>ï¼ˆæš‚æœªå¼€æºï¼‰ã€‚</p><p><br><br><br></p><h1 id="æ‰©å±•é˜…è¯»"><a href="#æ‰©å±•é˜…è¯»" class="headerlink" title="æ‰©å±•é˜…è¯»"></a>æ‰©å±•é˜…è¯»</h1><ul><li><a href="https://wakeadmin.wakedata.com/mapp/index.html" target="_blank" rel="noopener">Wakeadmin</a></li><li><a href="https://github.com/umijs/qiankun" target="_blank" rel="noopener">qiankun</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;img src=&quot;/images/microfrontend/Untitled.png&quot; alt=&quot;Untitled&quot;&gt;&lt;/p&gt;
&lt;p&gt;å¾®å‰ç«¯å®ç°åŸç†ã€æ¡†æ¶é€‰å‹ä¹‹ç±»çš„æ–‡ç« æ¯”è¾ƒæ³›æ»¥ï¼Œæˆ‘ä¸æ‰“ç®—è®²è¿™äº›ç©æ„ï¼Œæœ¬æ–‡ä¸»è¦æ¥æºäºç¬”è€…è¿‡å»ä¸€å¹´è½åœ°å¾®å‰ç«¯çš„ä¸€æ‰‹ç»éªŒï¼Œå°½é‡ä¸è®²æŠ€æœ¯ç»†èŠ‚ï¼Œè€Œæ˜¯è®²
      
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://bobi.ink/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>Vue å¼€å‘çš„æ­£ç¡®å§¿åŠ¿ï¼šå“åº”å¼ç¼–ç¨‹æ€ç»´</title>
    <link href="https://bobi.ink/2023/07/09/vue-with-rx/"/>
    <id>https://bobi.ink/2023/07/09/vue-with-rx/</id>
    <published>2023-07-08T16:00:00.000Z</published>
    <updated>2023-07-13T02:01:44.044Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/images/vue-with-rx/Untitled.png" alt="Untitled"></p><p>å†™è¿™ç¯‡æ–‡ç« çš„åŠ¨æœºå¯ä»¥è¿½æº¯åˆ° 3 å¹´å‰ï¼Œ æˆ‘å‘ç°å¾ˆå¤šèº«è¾¹å¼€å‘è€…å¹¶æ²¡æœ‰æ­£ç¡®åœ°ä½¿ç”¨ React Hooks, æ‰€ä»¥æˆ‘è§‰å¾—åº”è¯¥æŠŠæˆ‘çš„å¼€å‘ç»éªŒå’Œæ€ç»´æ•´ç†ä¸‹æ¥ã€‚</p><p>å°½ç®¡æœ¬æ–‡ä¸»è¦ä» Vue çš„è§’åº¦å‡ºå‘ï¼Œä½†æ˜¯å¾ˆå¤šæ€ç»´ä¹Ÿå¯ä»¥ç”¨åœ¨ React Hooks ä¸Šã€‚</p><p>ä»å¹¿ä¹‰çš„çš„â€œ<a href="https://en.wikipedia.org/wiki/Reactive_programming" target="_blank" rel="noopener">å“åº”å¼ç¼–ç¨‹(Reactive Programing)</a>â€ ä¸Šçœ‹ï¼ŒVueã€Reactã€Rxjs ç­‰æ¡†æ¶éƒ½å±äºè¿™ä¸ªèŒƒç•´ã€‚è€Œç‹­ä¹‰çš„å“åº”å¼ç¼–ç¨‹é€šå¸¸æŒ‡çš„æ˜¯ rxjs è¿™ç±» â€œé¢å‘æ•°æ®<a href="https://zh.wikipedia.org/wiki/%E4%B8%B2%E6%B5%81" target="_blank" rel="noopener">ä¸²æµ</a>å’Œå˜åŒ–ä¼ æ’­çš„<a href="https://zh.wikipedia.org/wiki/%E5%A3%B0%E6%98%8E%E5%BC%8F%E7%BC%96%E7%A8%8B" target="_blank" rel="noopener">å£°æ˜å¼</a><a href="https://zh.wikipedia.org/wiki/%E7%BC%96%E7%A8%8B%E8%8C%83%E5%BC%8F" target="_blank" rel="noopener">ç¼–ç¨‹èŒƒå¼</a>â€</p><p>è™½ç„¶ Vue ä¹Ÿæ˜¯â€˜å“åº”å¼ç¼–ç¨‹â€™ï¼Œ ä½†æ˜¯å’Œ RxJS æ˜¯å®Œå…¨ä¸ä¸€æ ·çš„æ¦‚å¿µï¼Œè‡³å°‘RxJS æ˜¯æœ‰èŒƒå¼çº¦æŸçš„ï¼Œä¸ç®¡æ˜¯ç¼–ç ä¸Šè¿˜æ˜¯æ€ç»´ä¸Šé¢ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥æ„Ÿå—åˆ°å®ƒçš„å¼ºåŠ›çº¦æŸï¼Œè¿™å’Œæˆ‘ä»¬æƒ¯ç”¨çš„å‘½ä»¤å¼ç¼–ç¨‹å·®åˆ«å¾ˆå¤§ã€‚è¿™ä¹Ÿå¯¼è‡´äº†å®ƒçš„å­¦ä¹ é—¨æ§›æ¯”è¾ƒé«˜ã€‚</p><p>ä¸ºä»€ä¹ˆè¦ç‰µæ‰¯åˆ° RxJS å‘¢ï¼Ÿå› ä¸ºå®ƒçš„æ€ç»´å¯¹æˆ‘ä»¬å†™å¥½ Vue ä»£ç å¾ˆæœ‰å¸®åŠ©ï¼</p><p><br><br><br></p><h1 id="ç®€è¿°-rxjs"><a href="#ç®€è¿°-rxjs" class="headerlink" title="ç®€è¿° RxJS"></a>ç®€è¿° RxJS</h1><p>å…ˆç¥­ä¸Š<a href="https://zhuanlan.zhihu.com/p/25383159" target="_blank" rel="noopener">å¾é£çš„ä¹°æˆ¿çš„ä¾‹å­</a>ï¼Œæ„Ÿå—ä¸€ä¸‹ RxJS çš„é­…åŠ›ï¼š</p><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="comment">//           å·¥èµ„å‘¨æœŸ  â€”â€”â€”&gt;  å·¥èµ„</span></span><br><span class="line"><span class="comment">//                            â†“</span></span><br><span class="line"><span class="comment">// æˆ¿ç§Ÿå‘¨æœŸ  â€”â€”â€”&gt;  ç§Ÿé‡‘  â€”â€”â€”&gt;  æ”¶å…¥  â€”â€”â€”&gt;  ç°é‡‘ </span></span><br><span class="line"><span class="comment">//                â†‘           â†“ </span></span><br><span class="line"><span class="comment">//             æˆ¿å­æ•°é‡ &lt;â€”â€”â€” æ–°è´­æˆ¿</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æŒ£é’±æ˜¯ä¸ºäº†ä¹°æˆ¿ï¼Œä¹°æˆ¿æ˜¯ä¸ºäº†èµšé’±</span></span><br><span class="line"><span class="keyword">const</span> house$ = <span class="keyword">new</span> Subject()</span><br><span class="line"><span class="keyword">const</span> houseCount$ = house$.scan(<span class="function">(<span class="params">acc, num</span>) =&gt;</span> acc + num, <span class="number">0</span>).startWith(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å·¥èµ„å§‹ç»ˆä¸æ¶¨</span></span><br><span class="line"><span class="keyword">const</span> salary$ = Observable.interval(<span class="number">100</span>).mapTo(<span class="number">2</span>)</span><br><span class="line"><span class="keyword">const</span> rent$ = Observable.interval(<span class="number">3000</span>)</span><br><span class="line">  .withLatestFrom(houseCount$)</span><br><span class="line">  .map(<span class="function"><span class="params">arr</span> =&gt;</span> arr[<span class="number">1</span>] * <span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸€ä¹°äº†æˆ¿ï¼Œå°±æ²¡ç°é‡‘äº†â€¦â€¦</span></span><br><span class="line"><span class="keyword">const</span> income$ = Observable.merge(salary$, rent$)</span><br><span class="line"><span class="keyword">const</span> cash$ = income$</span><br><span class="line">  .scan(<span class="function">(<span class="params">acc, num</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> newSum = acc + num</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> newHouse = <span class="built_in">Math</span>.floor(newSum / <span class="number">100</span>)</span><br><span class="line">    <span class="keyword">if</span> (newHouse &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      house$.next(newHouse)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> newSum % <span class="number">100</span></span><br><span class="line">  &#125;, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// houseCount$.subscribe(num =&gt; console.log(`houseCount: $&#123;num&#125;`))</span></span><br></pre></td></tr></table></figure><p><br></p><p>å¦‚æœç”¨å‡ ä¸ªå…³é”®å­—æ¥æè¿° RxJS çš„è¯ï¼Œæˆ‘æƒ³åº”è¯¥æ˜¯ï¼š</p><ul><li>äº‹ä»¶ï¼šè§‚å¯Ÿè€…æ¨¡å¼</li><li>åºåˆ—ï¼šè¿­ä»£å™¨æ¨¡å¼</li><li>æµï¼šç®¡é“æ¨¡å¼</li></ul><p>è¿™å‡ ä¸ªæ¨¡å¼æˆ‘ä»¬åˆ†å¼€å»ç†è§£éƒ½æ²¡å•¥ç‰¹åˆ«ï¼Œæ¯”å¦‚ Vue çš„ reactivity æ•°æ®å°±æ˜¯è§‚å¯Ÿè€…æ¨¡å¼ï¼›JavaScript çš„ forâ€¦of/generator å°±æ˜¯è¿­ä»£å™¨æ¨¡å¼ï¼›æ•°ç»„çš„map/filter/reduce, shell å‘½ä»¤éƒ½ç¬¦åˆç®¡é“æ¨¡å¼ã€‚</p><p>RxJS  çš„ç‰›é€¼ä¹‹å¤„å°±æ˜¯æŠŠè¿™ä¸‰ä¸ªæ¨¡å¼ä¼˜é›…åœ°ç»„åˆèµ·æ¥äº†ã€‚å®ƒæŠŠäº‹ä»¶æŠ½è±¡æˆä¸ºç±»ä¼¼â€™æ•°ç»„â€™ä¸€æ ·çš„åºåˆ—ï¼Œç„¶åæä¾›äº†ä¸°å¯Œçš„æ“ä½œç¬¦æ¥å˜æ¢è¿™ä¸ªåºåˆ—ï¼Œå°±åƒæ“ä½œæ•°ç»„ä¸€æ ·è‡ªç„¶ï¼Œæœ€åé€šè¿‡ç®¡é“å°†è¿™äº›æ“ä½œç¬¦ç»„åˆèµ·æ¥å®ç°å¤æ‚çš„åŠŸèƒ½å˜æ¢ã€‚</p><p><br><br><br></p><h1 id="ä¸ºä»€ä¹ˆå»ºè®®ä½ å»å­¦ä¹ -rxjsï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆå»ºè®®ä½ å»å­¦ä¹ -rxjsï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆå»ºè®®ä½ å»å­¦ä¹  rxjsï¼Ÿ"></a>ä¸ºä»€ä¹ˆå»ºè®®ä½ å»å­¦ä¹  rxjsï¼Ÿ</h1><p>è‡³å°‘å®ƒå¯ä»¥å¸®åŠ©ä½ å†™å¥½ Vue ä»£ç ã€‚å®ƒå¯ä»¥å¸®ä½ å†™å‡ºæ›´ç®€æ´ã€ç»“æ„æ›´æ¸…æ™°ã€ä½è€¦åˆã€æ›´å®¹æ˜“æµ‹è¯•çš„ä»£ç ï¼Œè¿™äº›ä»£ç æ›´èƒ½ä½“ç°åŸæœ¬çš„äº¤äº’é€»è¾‘æˆ–ä¸šåŠ¡æµç¨‹ã€‚</p><p>ç›¸ä¿¡æˆ‘ï¼Œå°è¯•æ¢ä¸ªæ€è·¯ï¼Œå¯èƒ½åŸæœ¬å¤æ‚çš„å®ç°ï¼Œä¼šå˜å¾—æ›´åŠ ç®€å•ã€‚</p><p><br></p><h1 id="rxjs-å’Œ-vue-reactivity-data-æœ‰ä»€ä¹ˆå…³è”ï¼Ÿ"><a href="#rxjs-å’Œ-vue-reactivity-data-æœ‰ä»€ä¹ˆå…³è”ï¼Ÿ" class="headerlink" title="RxJS å’Œ Vue Reactivity Data æœ‰ä»€ä¹ˆå…³è”ï¼Ÿ"></a>RxJS å’Œ Vue Reactivity Data æœ‰ä»€ä¹ˆå…³è”ï¼Ÿ</h1><p>ä¸€äº›å’Œ RxJS ç›¸ä¼¼çš„æ¦‚å¿µ</p><ul><li><p>å“åº”å¼æ•°æ®ã€‚æˆ‘ä»¬ç”¨ ref æˆ–reactive åˆ›å»ºçš„æ•°æ®ï¼Œå¯ä»¥ç­‰ä¼¼äº RxJS çš„ Observableã€‚åªä¸è¿‡å“åº”å¼æ•°æ®å¹¶ä¸åƒ rxjs æœ‰æ˜¾å¼çš„äº‹ä»¶å‘å¸ƒå’Œè®¢é˜…è¿‡ç¨‹ï¼Œä¹Ÿä¸å­˜åœ¨äº‹ä»¶æµ(åºåˆ—)ã€‚</p><p>  <strong>æˆ‘ä»¬å¯ä»¥è®¤ä¸ºVue æ•°æ®çš„æ¯æ¬¡å˜æ›´å°±ç›¸å½“äº RxJS å‘å‡ºæ¯æ¬¡äº‹ä»¶</strong>ã€‚</p></li><li><p>è¡ç”Ÿæ•°æ®ã€‚æˆ‘ä»¬ä¼šä½¿ç”¨ computed æ¥è¡ç”Ÿæ–°çš„æ•°æ®ï¼Œç­‰ä¼¼äº RxJS ç”¨æ“ä½œç¬¦è¡ç”Ÿå‡ºæ–°çš„ Observableã€‚<strong>å³ Vue æ•°æ®è¡ç”Ÿæ•°æ®ï¼ŒRxJS äº‹ä»¶è¡ç”Ÿäº‹ä»¶</strong></p></li><li>å‰¯ä½œç”¨ã€‚åœ¨ Vue ä¸­ï¼Œ watch/watcheffects/render ç›¸å½“äº RxJS çš„ subscribeï¼ŒRxJS çš„æ•°æ®æµçš„ç»ˆç‚¹é€šå¸¸ä¹Ÿæ˜¯å‰¯ä½œç”¨å¤„ç†ï¼Œæ¯”å¦‚å°†æ•°æ®æ¸²æŸ“åˆ°é¡µé¢ä¸Šã€‚</li></ul><p><br></p><p>RxJS çš„å¾ˆå¤šä¸œè¥¿å¹¶ä¸èƒ½ç›´æ¥å¥—ç”¨è¿‡æ¥ï¼Œä½†æ€æƒ³å’ŒåŸåˆ™æ˜¯å¯ä»¥å¤ç”¨çš„ã€‚</p><p>å…¶ä¸­ä¸€ä¸ªé‡è¦çš„æ€æƒ³å°±æ˜¯ï¼šç®¡é“å˜æ¢ã€‚è¿™æ˜¯ä¸€ç§æ€ç»´æ–¹å¼çš„è½¬å˜ï¼Œåœ¨ä»¥å¾€çš„ç¼–ç¨‹è®¾è®¡ä¸­ï¼Œæˆ‘ä»¬æ›´å¤šæ“å¿ƒçš„æ˜¯ç±»ã€æ¨¡å—ã€æ•°æ®ç»“æ„å’Œç®—æ³•ã€‚è€Œç®¡é“å˜æ¢æˆ‘ä»¬ä¼šæŠŠç¨‹åºè§†ä½œä»è¾“å…¥åˆ°è¾“å‡ºçš„ä¸€ä¸ªå˜æ¢å»æ„æ€:</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># â€œåˆ—å‡ºç›®å½•æ ‘ä¸­æœ€é•¿çš„äº”ä¸ªæ–‡â€</span></span><br><span class="line">find . -<span class="built_in">type</span> f | xargs wc -l | sort -n | tail -5</span><br></pre></td></tr></table></figure><p>ä¸è¦æŠŠæ•°æ®çœ‹ä½œæ˜¯éå¸ƒæ•´ä¸ªç³»ç»Ÿçš„å°æ•°æ®æ± ï¼Œè€Œè¦æŠŠæ•°æ®çœ‹ä½œæ˜¯ä¸€æ¡æµ©æµ©è¡è¡çš„æ²³æµã€‚</p><p>å¦ä¸€æ–¹é¢ï¼Œç¼–å†™ RxJS ä»£ç ä¸€äº›åŸåˆ™ï¼Œå¯¹æˆ‘ä»¬ç¼–å†™ Vue ä»£ç ä¹Ÿå¤§æœ‰è£¨ç›Šï¼š</p><ul><li>é¿å…å‰¯ä½œç”¨ã€‚RxJS çš„æ“ä½œç¬¦åº”è¯¥æ˜¯æ²¡æœ‰å‰¯ä½œç”¨çš„å‡½æ•°ï¼Œåªå…³æ³¨è¾“å…¥çš„æ•°æ®ï¼Œç„¶åå¯¹æ•°æ®è¿›è¡Œå˜æ¢ï¼Œä¼ é€’ç»™ä¸‹ä¸€ä¸ªã€‚</li><li><p>é¿å…å¤–éƒ¨çŠ¶æ€/ç¼“å­˜çŠ¶æ€ã€‚å¤–éƒ¨çŠ¶æ€ä¹Ÿæ˜¯å‰¯ä½œç”¨çš„ä¸€ç§ï¼Œå•ç‹¬æ‹å‡ºæ¥è®²ï¼Œæ˜¯å› ä¸ºæˆ‘ä»¬åœ¨ Vue ä¸­åˆ›å»ºå¤–éƒ¨çŠ¶æ€å¤ªå®¹æ˜“äº†ï¼Œè€Œ RxJS åˆ™ç›¸å¯¹æ¥è¯´éº»çƒ¦ä¸€äº›ï¼Œæ¯•ç«Ÿå¤–éƒ¨çŠ¶æ€å’Œäº‹ä»¶æµæ˜¾å¾—æ ¼æ ¼ä¸å…¥ã€‚</p><p>  åœ¨ RxJS ä¸­ç®¡é“æ˜¯è‡ªåŒ…å«çš„ï¼Œ æ‰€æœ‰çš„çŠ¶æ€ä»ä¸€ä¸ªæ“ä½œå™¨æµå‘ä¸‹ä¸€ä¸ªæ“ä½œå™¨ï¼Œè€Œä¸éœ€è¦å¤–éƒ¨å˜é‡ï¼š</p>  <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Observable.from([1, 2, 3, 4, 5, 6, 7, 8])</span><br><span class="line">  .filter(val =&gt; val % 2)</span><br><span class="line">  .map(val =&gt; val * 10);</span><br></pre></td></tr></table></figure></li></ul><p><br><br><br></p><h1 id="çœ‹çœ‹ä½ ä»£ç ä¸­çš„åå‘³é“"><a href="#çœ‹çœ‹ä½ ä»£ç ä¸­çš„åå‘³é“" class="headerlink" title="çœ‹çœ‹ä½ ä»£ç ä¸­çš„åå‘³é“"></a>çœ‹çœ‹ä½ ä»£ç ä¸­çš„åå‘³é“</h1><p>çœ‹çœ‹ä½ çš„ Vue ä»£ç æœ‰æ²¡æœ‰è¿™äº›ç°è±¡ï¼Œå¦‚æœå­˜åœ¨è¿™äº›åå‘³é“ï¼Œè¯´æ˜ä½ å¹¶æ²¡æœ‰æ­£ç¡®ä½¿ç”¨ Vue çš„ Reactivity APIã€‚</p><ul><li>åˆ›å»ºäº†å¤§é‡çš„ç¼“å­˜çŠ¶æ€ã€‚æ¯”å¦‚ sumï¼Œavgï¼Œtempâ€¦</li><li>ä½¿ç”¨äº†å¾ˆå¤š <code>watch</code> / <code>watchEffect</code>â€¦</li><li>å†—é•¿çš„ <code>setup</code> æ–¹æ³•æˆ–è€…ç»„ä»¶ä»£ç </li><li>çŠ¶æ€è¢«éšæ„ä¿®æ”¹ï¼Œä¿®æ”¹ä¸å±äºç®¡è¾–èŒƒå›´å†…çš„çŠ¶æ€</li><li>â€¦</li></ul><p><br><br><br></p><h1 id="å®è·µ"><a href="#å®è·µ" class="headerlink" title="å®è·µ"></a>å®è·µ</h1><h2 id="åˆ†é¡µ"><a href="#åˆ†é¡µ" class="headerlink" title="åˆ†é¡µ"></a>åˆ†é¡µ</h2><p>å…ˆä»ç®€å•çš„åœºæ™¯å¼€å§‹: åˆ†é¡µè¯·æ±‚ã€‚</p><p>âŒ å¸¸è§„çš„åšæ³•ï¼š</p><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> query = reactive(&#123;&#125;) <span class="comment">// æŸ¥è¯¢å‚æ•°</span></span><br><span class="line"><span class="keyword">const</span> pagination = reactive(&#123;<span class="attr">pageNo</span>: <span class="number">1</span>, <span class="attr">pageSize</span>: <span class="number">10</span>&#125;)</span><br><span class="line"><span class="keyword">const</span> total = ref(<span class="number">0</span>)</span><br><span class="line"><span class="keyword">const</span> list = ref([])</span><br><span class="line"><span class="keyword">const</span> loading = ref(<span class="literal">false</span>)</span><br><span class="line"><span class="keyword">const</span> error = ref()</span><br><span class="line"></span><br><span class="line">watch([query, pagination], <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    error.value = <span class="literal">undefined</span></span><br><span class="line">    loading.value = <span class="literal">true</span></span><br><span class="line">    <span class="keyword">const</span> data = <span class="keyword">await</span> request(<span class="string">`/something?<span class="subst">$&#123;qs(&#123;...query, ...pagination&#125;</span>)&#125;`</span>)</span><br><span class="line">    total.value = data.total</span><br><span class="line">    list.value = data.list</span><br><span class="line">  &#125; <span class="keyword">catch</span> (err)&#123;</span><br><span class="line">    error.value = err</span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    loading.value = <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;, &#123;<span class="attr">immediate</span>: <span class="literal">true</span>&#125;)</span><br></pre></td></tr></table></figure><p>âœ… æ¨èåšæ³•ï¼š</p><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> query = reactive(&#123;&#125;) <span class="comment">// æŸ¥è¯¢å‚æ•°</span></span><br><span class="line"><span class="keyword">const</span> pagination = reactive(&#123;<span class="attr">pageNo</span>: <span class="number">1</span>, <span class="attr">pageSize</span>: <span class="number">10</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// data åŒ…å«äº† listã€loadingã€errorã€total ç­‰ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">const</span> data = useRequest(<span class="function"><span class="params">()</span> =&gt;</span> <span class="string">`/something?<span class="subst">$&#123;qs(&#123;...query, ...pagination&#125;</span>)&#125;`</span>)</span><br></pre></td></tr></table></figure><ul><li><p>è‡ªç„¶åœ°è¡¨è¾¾ query/pagination â†’ data çš„æ•°æ®æµã€‚useRequest æ›´åƒ computed çš„è¯­ä¹‰ï¼Œä»ä¸€ä¸ªæ•°æ®è¡ç”Ÿå‡ºæ–°çš„æ•°æ®ï¼Œä¸ç®¡å®ƒæ˜¯åŒæ­¥çš„è¿˜æ˜¯å¼‚æ­¥çš„ã€‚</p><p>  è€Œä½¿ç”¨ watch ä¼šä¸­æ–­æ•°æ®çš„æµåŠ¨ï¼Œå¹¶ä¸”æˆ‘ä»¬éœ€è¦åˆ›å»ºå†—ä½™ç¼“å­˜çŠ¶æ€ï¼Œä»£ç çœ‹èµ·æ¥ä¼šæ¯”è¾ƒæ··ä¹±ã€‚æƒ³è±¡ä¸€ä¸‹å¤æ‚çš„é¡µé¢ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šæœ‰å¾ˆå¤šå¤æ‚ã€è”åŠ¨çš„å¼‚æ­¥è¯·æ±‚ï¼Œæƒ…å†µå°±ä¼šæ…¢æ…¢å¤±æ§ã€‚</p></li><li><p><code>useRequest</code> æ˜¯å•¥ï¼Ÿå®ƒå°è£…äº†ç½‘ç»œè¯·æ±‚ï¼Œ useRequest å¯ä»¥åŸºäº <a href="https://docs-swrv.netlify.app/guide.html" target="_blank" rel="noopener">swrv</a>(swr åœ¨ Vue ä¸‹çš„å®ç°, éå®˜æ–¹)ã€æˆ–è€…VueUse é‡Œé¢çš„ <a href="https://vueuse.org/core/computedAsync/" target="_blank" rel="noopener">computedAsync</a>ã€<a href="https://vueuse.org/core/useFetch/" target="_blank" rel="noopener">useFetch</a> æ¥å°è£…ã€‚</p><p>  useRequest ç±»ä¼¼äº RxJS çš„ switchMapï¼Œå½“æ–°çš„å‘èµ·æ–°çš„è¯·æ±‚æ—¶ï¼Œåº”è¯¥å°†æ—§çš„è¯·æ±‚æŠ›å¼ƒã€‚</p><p>  ç¬”è€…æ¨èä½¿ç”¨ swr è¿™ç±»åº“å»å¤„ç†ç½‘ç»œè¯·æ±‚ï¼Œç›¸æ¯”ç›´æ¥ç”¨ watch, è¿™ç±»åº“æ”¯æŒæ•°æ®ç¼“å­˜ã€Stale-while-revalidate æ›´æ–°ã€è¿˜æœ‰å¹¶å‘ç«æ€çš„å¤„ç†ç­‰ç­‰ã€‚</p></li></ul><p><br><br><br></p><h2 id="å®æ—¶æœç´¢"><a href="#å®æ—¶æœç´¢" class="headerlink" title="å®æ—¶æœç´¢"></a>å®æ—¶æœç´¢</h2><p>ç¬¬äºŒä¸ªä¾‹å­ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œç”¨æˆ·è¾“å…¥æ–‡æœ¬ï¼Œæˆ‘ä»¬debounce å‘èµ·æ•°æ®è¯·æ±‚</p><p>âš ï¸ å¸¸è§„çš„å®ç°ï¼š</p><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> query = ref(<span class="string">''</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ³•ä¸€ï¼šåœ¨äº‹ä»¶å¤„ç†å™¨åŠ  debounce</span></span><br><span class="line"><span class="comment">// å¦‚æœè¿™ä¹ˆå®ç°ï¼ŒåŒå‘ç»‘å®šåˆ°è¡¨å•å¯èƒ½æœ‰å¡é¡¿é—®é¢˜</span></span><br><span class="line"><span class="keyword">const</span> handleQueryChange = debounce(<span class="function">(<span class="params">evt</span>) =&gt;</span> &#123;</span><br><span class="line">  query.value = evt.target.value</span><br><span class="line">&#125;, <span class="number">800</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> data = ref()</span><br><span class="line"></span><br><span class="line">watch(query, <span class="keyword">async</span> (q) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> res = <span class="keyword">await</span> fetchData(q)</span><br><span class="line">  <span class="comment">// <span class="doctag">FIXME:</span> éœ€è¦å¤„ç†ç«æ€é—®é¢˜</span></span><br><span class="line">  data.value = res</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ---------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ³•äºŒï¼Œåœ¨ watch å›è°ƒæˆ–è€… fetchData åŠ ä¸Š debounce</span></span><br><span class="line"><span class="keyword">const</span> handleQueryChange = <span class="function">(<span class="params">evt</span>) =&gt;</span> &#123;</span><br><span class="line">  query.value = evt.target.value</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">watch(query, debounce(<span class="keyword">async</span> (q) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> res = <span class="keyword">await</span> fetchData(q)</span><br><span class="line">  data.value = res</span><br><span class="line">&#125;, <span class="number">800</span>))</span><br></pre></td></tr></table></figure><p>RxJS  å®ç°:</p><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> searchInput$ = fromEvent(searchInput, <span class="string">'input'</span>).pipe(</span><br><span class="line">  <span class="comment">// ä½¿ç”¨ debounceTime è¿›è¡Œé˜²æŠ–å¤„ç†</span></span><br><span class="line">  debounceTime(<span class="number">800</span>),</span><br><span class="line">  <span class="comment">// ä½¿ç”¨ map å°†äº‹ä»¶è½¬æ¢ä¸ºè¾“å…¥æ¡†çš„å€¼</span></span><br><span class="line">  map(<span class="function"><span class="params">event</span> =&gt;</span> event.target.value),</span><br><span class="line">  <span class="comment">// ä½¿ç”¨ distinctUntilChanged è¿›è¡Œå»é‡å¤„ç†</span></span><br><span class="line">  distinctUntilChanged(),</span><br><span class="line">  <span class="comment">// ä½¿ç”¨ switchMap è¿›è¡Œè¯·æ±‚å¹¶è½¬æ¢ä¸ºåˆ—è¡¨æ•°æ®</span></span><br><span class="line">  switchMap(<span class="function"><span class="params">keyword</span> =&gt;</span> <span class="keyword">from</span>(searchList(keyword)))</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä½¿ç”¨ Vue ä¹Ÿå¯ä»¥è¡¨è¾¾ç±»ä¼¼çš„æµç¨‹ï¼š</p><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> query = ref(<span class="string">''</span>)</span><br><span class="line"><span class="keyword">const</span> debouncedQuery = refDebounced(input, <span class="number">1000</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> data = useRequest(<span class="function"><span class="params">()</span> =&gt;</span> <span class="string">`/something?<span class="subst">$&#123;qs(&#123;query: query.value&#125;</span>)&#125;`</span>)</span><br></pre></td></tr></table></figure><p>refDebounce æ¥æºäº VueUseï¼Œå¯ä»¥ â€œDebounceâ€ æŒ‡å®šè¾“å…¥ ref å€¼çš„å˜åŠ¨ã€‚</p><p><br><br><br></p><h2 id="å®šæ—¶åˆ·æ–°"><a href="#å®šæ—¶åˆ·æ–°" class="headerlink" title="å®šæ—¶åˆ·æ–°"></a>å®šæ—¶åˆ·æ–°</h2><p>å‡è®¾æˆ‘ä»¬è¦åœ¨ä¸Šé¢çš„åˆ†é¡µåŸºç¡€ä¸Šå®ç°å®šæ—¶è½®è¯¢çš„åŠŸèƒ½ï¼š</p><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> query = reactive(&#123;&#125;) <span class="comment">// æŸ¥è¯¢å‚æ•°</span></span><br><span class="line"><span class="keyword">const</span> tick = useInterval(<span class="number">5000</span>)</span><br><span class="line"><span class="keyword">const</span> pagination = reactive(&#123;<span class="attr">pageNo</span>: <span class="number">1</span>, <span class="attr">pageSize</span>: <span class="number">10</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// data åŒ…å«äº† listã€loadingã€errorã€total ç­‰ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">const</span> data = useRequest(<span class="function"><span class="params">()</span> =&gt;</span> <span class="string">`/something?<span class="subst">$&#123;qs(&#123;...query, ...pagination, _t: tick.value&#125;</span>)&#125;`</span>)</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çœ‹åˆ°ä¸Šé¢çš„æµç¨‹å¾ˆè‡ªç„¶ã€‚</p><p>ç°åœ¨åŠ å¤§éš¾åº¦ï¼Œå¦‚æœè¦åœ¨ç‰¹å®šæ¡ä»¶ä¸‹ç»ˆæ­¢å‘¢ï¼Ÿ</p><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> query = reactive(&#123;&#125;) <span class="comment">// æŸ¥è¯¢å‚æ•°</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// é»˜è®¤å…³é—­</span></span><br><span class="line"><span class="keyword">const</span> &#123;<span class="attr">counter</span>: tick, pause, resume&#125; = useInterval(<span class="number">5000</span>, &#123;<span class="attr">controls</span>: <span class="literal">true</span>, <span class="attr">immediate</span>: <span class="literal">false</span>&#125;)</span><br><span class="line"><span class="keyword">const</span> pagination = reactive(&#123;<span class="attr">pageNo</span>: <span class="number">1</span>, <span class="attr">pageSize</span>: <span class="number">10</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// data åŒ…å«äº† listã€loadingã€errorã€total ç­‰ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">const</span> data = useRequest(<span class="function"><span class="params">()</span> =&gt;</span> <span class="string">`/something?<span class="subst">$&#123;qs(&#123;...query, ...pagination, _t: tick.value&#125;</span>)&#125;`</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ˜¯å¦è½®è¯¢</span></span><br><span class="line"><span class="keyword">const</span> shouldPoll = computed(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> data.data?.some(<span class="function"><span class="params">i</span> =&gt;</span> i.expired &gt; <span class="built_in">Date</span>.now())</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æŒ‰æ¡ä»¶å¼€å¯è½®è®­</span></span><br><span class="line">watch(shoudPoll, (p) =&gt; p ? resume() : pause())</span><br></pre></td></tr></table></figure><p>å¦‚æœç”¨ RxJS æ¥å®ç°çš„è¯ï¼Œä»£ç å¤§æ¦‚å¦‚ä¸‹ï¼š</p><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> interval$ = interval(<span class="number">5000</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> poll$ = interval$.pipe(</span><br><span class="line">  <span class="comment">// æŸ¥è¯¢</span></span><br><span class="line">  switchMap(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">from</span>(fetchData())),</span><br><span class="line">  share()</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> stop$ = poll$.pipe(</span><br><span class="line">  <span class="comment">// ç»ˆæ­¢è½®è¯¢æ¡ä»¶</span></span><br><span class="line">  filter(<span class="function">(<span class="params">i</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> i.every(<span class="function"><span class="params">i</span> =&gt;</span> i.expired &lt;= <span class="built_in">Date</span>.now())</span><br><span class="line">  &#125;)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°† poll$ å’Œ stop$ ç»„åˆåœ¨ä¸€èµ·</span></span><br><span class="line">poll$</span><br><span class="line">  .pipe(</span><br><span class="line">    <span class="comment">// ä½¿ç”¨ takeUntil åœ¨ stop$ å‘é€äº‹ä»¶ååœæ­¢è½®è¯¢</span></span><br><span class="line">    takeUntil(stop$)</span><br><span class="line">  )</span><br><span class="line">  .subscribe(<span class="function">(<span class="params">i</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(i);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure><p>å› ä¸º RxJS çš„ Observable æ˜¯æƒ°æ€§çš„ï¼Œåªæœ‰è¢« subscribe æ—¶æ‰ä¼šå¼€å§‹æ‰§è¡Œï¼ŒåŒç†åœæ­¢è®¢é˜…å°±ä¼šä¸­æ–­æ‰§è¡Œã€‚</p><p>ä¸­æ–­æ‰§è¡Œåï¼Œå¦‚æœè¦é‡æ–°å‘èµ·è¯·æ±‚ï¼Œé‡æ–°è®¢é˜…å°±å¥½äº†ã€‚æœ‰ç‚¹å¼‚æ›²åŒå·¥ä¹‹å¦™å§</p><p><br><br><br></p><h2 id="çœå¸‚åŒºé€‰æ‹©å™¨"><a href="#çœå¸‚åŒºé€‰æ‹©å™¨" class="headerlink" title="çœå¸‚åŒºé€‰æ‹©å™¨"></a>çœå¸‚åŒºé€‰æ‹©å™¨</h2><p>å†æ¥çœ‹ä¸€ä¸ªç¨å¾®å¤æ‚ä¸€ç‚¹çš„ä¾‹å­ï¼Œå¸¸è§çš„çœå¸‚åŒºé€‰æ‹©å™¨ï¼Œè¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„æ•°æ®è”åŠ¨çš„åœºæ™¯ã€‚</p><p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸ªåä¾‹å§ï¼Œæˆ‘ä»¬çš„é€‰æ‹©å™¨éœ€è¦å…ˆé€‰æ‹©å›½å®¶æˆ–åœ°åŒºï¼Œç„¶åæ ¹æ®å®ƒæ¥ç¡®å®šè¡Œæ”¿åŒºåŸŸçš„åˆ’åˆ†ï¼Œæ¥ç€æ¸²æŸ“å„çº§è¡Œæ”¿åŒºåŸŸé€‰æ‹©å™¨ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">export default defineComponent(&#123;</span><br><span class="line">  props: &#123;</span><br><span class="line">    modelValue: &#123;</span><br><span class="line">      type: Array as () =&gt; number[],</span><br><span class="line">      default: () =&gt; [],</span><br><span class="line">    &#125;,</span><br><span class="line">    onChange: &#123;</span><br><span class="line">      type: Function,</span><br><span class="line">      default: () =&gt; &#123;&#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  setup(props, &#123; emit &#125;) &#123;</span><br><span class="line">    const isEchoingData = ref(false);</span><br><span class="line">    const regionList = ref&lt;RegionInfoDTO[][]&gt;([]);</span><br><span class="line">    const regionUrl = ref(&apos;&apos;);</span><br><span class="line">    const queryParams = ref(&#123;&#125; as IQueryParams);</span><br><span class="line"></span><br><span class="line">    const selectedRegion = computed&lt;number[]&gt;(&#123;</span><br><span class="line">      get: () =&gt; props.modelValue,</span><br><span class="line">      set: value =&gt; emit(&apos;update:modelValue&apos;, [...value]),</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    const &#123; data: countryList &#125; = useRequest&lt;CountryInfoDTO&gt;(</span><br><span class="line">      () =&gt; `è¯·æ±‚å›½å®¶åˆ—è¡¨`</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    // è¯·æ±‚åŒºåŸŸåˆ—è¡¨</span><br><span class="line">    const &#123; data: regionItems &#125; = useRequest&lt;RegionInfoDTO&gt;(() =&gt; regionUrl.value);</span><br><span class="line"></span><br><span class="line">    watch(regionItems, () =&gt; &#123;</span><br><span class="line">      regionList.value[queryParams.value.level] = regionItems.value?.data!;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    const countryOptions = computed(() =&gt; &#123;</span><br><span class="line">      return countryList.value?.data.map(i =&gt; &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">          label: i.name,</span><br><span class="line">          value: i.id,</span><br><span class="line">        &#125;;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    watch(queryParams, async newValue =&gt; &#123;</span><br><span class="line">      if (!Object.keys(newValue).length) return;</span><br><span class="line"></span><br><span class="line">      const query = `&amp;countryId=$&#123;newValue.level ? &apos;&apos; : newValue.value&#125;&amp;parentId=$&#123;</span><br><span class="line">        newValue.level ? newValue.value : &apos;&apos;</span><br><span class="line">      &#125;&amp;level=$&#123;newValue.level + 1&#125;`;</span><br><span class="line">      regionUrl.value = `åŒºåŸŸè¯·æ±‚è·¯å¾„$&#123;query&#125;`;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    watch(</span><br><span class="line">      props.modelValue,</span><br><span class="line">      async (newValue, oldValue) =&gt; &#123;</span><br><span class="line">        const newLen = newValue.length;</span><br><span class="line">        const oldLen = oldValue?.length ?? 0;</span><br><span class="line"></span><br><span class="line">        if (newLen &amp;&amp; newLen !== oldLen) &#123;</span><br><span class="line">          const index = 0;</span><br><span class="line"></span><br><span class="line">          queryParams.value = &#123; value: newValue[index], level: index &#125;;</span><br><span class="line">          isEchoingData.value = true;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123; immediate: true &#125;</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    watch(</span><br><span class="line">      regionList,</span><br><span class="line">      newVal =&gt; &#123;</span><br><span class="line">        const len = newVal.length;</span><br><span class="line">        const selectedLen = selectedRegion.value.length;</span><br><span class="line"></span><br><span class="line">        if (isEchoingData.value &amp;&amp; selectedLen &gt; len) &#123;</span><br><span class="line">          if (len === selectedLen - 1) return (isEchoingData.value = false);</span><br><span class="line"></span><br><span class="line">          queryParams.value = &#123; value: selectedRegion.value[len], level: len &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123; deep: true &#125;</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    const onRegionChange = (value: number, level: number) =&gt; &#123;</span><br><span class="line">      selectedRegion.value.splice(level);</span><br><span class="line">      regionList.value.splice(level);</span><br><span class="line">      selectedRegion.value.push(value);</span><br><span class="line"></span><br><span class="line">      const currentRegion = regionList.value[level - 1]?.find(region =&gt; region.id === value);</span><br><span class="line"></span><br><span class="line">      if (!currentRegion?.isLeaf) &#123;</span><br><span class="line">        queryParams.value = &#123; value, level &#125;;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      props.onChange?.([...selectedRegion.value], [...selectedRegionNames.value]);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    const currentRegionPlaceholder = (index: number) =&gt; &#123;</span><br><span class="line">      return `$&#123;selectedCountry.value?.regionLevelInfos[index]?.name ?? &apos;åŒºåŸŸ&apos;&#125;`;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    const selectedCountry = computed(() =&gt; &#123;</span><br><span class="line">      const selectedCountryId = selectedRegion.value[0];</span><br><span class="line">      const selectedCountry = countryList.value?.data.find(country =&gt; country.id === selectedCountryId);</span><br><span class="line"></span><br><span class="line">      return selectedCountry;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    const selectedRegionNames = computed(() =&gt; &#123;</span><br><span class="line">      const names = [];</span><br><span class="line"></span><br><span class="line">      if (selectedCountry.value) &#123;</span><br><span class="line">        names.push(selectedCountry.value.name);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      selectedRegion.value.slice(1).forEach((id, index) =&gt; &#123;</span><br><span class="line">        const region = regionList.value[index]?.find(region =&gt; region.id === id);</span><br><span class="line">        if (region) &#123;</span><br><span class="line">          names.push(region.name);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      return names;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    return () =&gt; (</span><br><span class="line">      &lt;FatSpace&gt;</span><br><span class="line">        &lt;ElSelect</span><br><span class="line">          modelValue=&#123;selectedRegion.value[0]&#125;</span><br><span class="line">          placeholder=&quot;è¯·é€‰æ‹©å›½å®¶&quot;</span><br><span class="line">          onChange=&#123;val =&gt; onRegionChange(val, 0)&#125;</span><br><span class="line">          filterable</span><br><span class="line">        &gt;</span><br><span class="line">          &#123;countryOptions.value?.map(country =&gt; (</span><br><span class="line">            &lt;ElOption key=&#123;country.value&#125; label=&#123;country.label&#125; value=&#123;country.value&#125; /&gt;</span><br><span class="line">          ))&#125;</span><br><span class="line">        &lt;/ElSelect&gt;</span><br><span class="line"></span><br><span class="line">        &#123;regionList.value.map((regions, index) =&gt; (</span><br><span class="line">          &lt;ElSelect</span><br><span class="line">            key=&#123;index&#125;</span><br><span class="line">            modelValue=&#123;selectedRegion.value[index + 1]&#125;</span><br><span class="line">            placeholder=&#123;`è¯·é€‰æ‹©$&#123;currentRegionPlaceholder(index)&#125;`&#125;</span><br><span class="line">            onChange=&#123;val =&gt; onRegionChange(val, index + 1)&#125;</span><br><span class="line">            filterable</span><br><span class="line">          &gt;</span><br><span class="line">            &#123;regions.map(region =&gt; (</span><br><span class="line">              &lt;ElOption key=&#123;region.id&#125; label=&#123;region.name&#125; value=&#123;region.id&#125; /&gt;</span><br><span class="line">            ))&#125;</span><br><span class="line">          &lt;/ElSelect&gt;</span><br><span class="line">        ))&#125;</span><br><span class="line">      &lt;/FatSpace&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ä¹Ÿå°± 150 è¡Œå·¦å³çš„ä»£ç ï¼Œå®ç°çš„æ˜¯ <code>å›½å®¶-å›½å®¶å„ç§åŒºåŸŸ</code> çš„é€‰æ‹©å™¨ï¼Œæ¯”å¦‚é€‰æ‹©äº†ä¸­å›½å°±ä¼šæœ‰ <code>ä¸­å›½-çœ-å¸‚-åŒº</code> è¿™æ ·çš„åˆ†çº§ã€‚</p><p>è¯»è€…ä¹Ÿæ²¡å¿…è¦è¯»æ‡‚è¿™äº›ä»£ç ï¼Œæˆ‘çœ‹åˆ°ä¹Ÿå¤´å¤§ï¼Œä½ åªéœ€è¦è®°ä½ï¼Œè¿™ä¸ªå……æ–¥ç€æˆ‘ä»¬ä¸Šæ–‡æåˆ°çš„å„ç§åå‘³é“ï¼šè¿‡æ¸¡ä¾èµ– watchã€æ•°æ®æµæ··ä¹±â€¦</p><p><img src="/images/vue-with-rx/Untitled%201.png" alt="Untitled"></p><p>è®©æˆ‘ä»¬å›å½’åˆ°ä¸šåŠ¡æœ¬èº«ï¼Œæˆ‘ä»¬ä¸ºä»€ä¹ˆéœ€è¦ä¸æªå®ˆè¿™æ ·çš„è”åŠ¨å…³ç³»å»ç»„ç»‡ä»£ç å‘¢ï¼Ÿ</p><p>å¯ä»¥çš„ï¼Œä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„æŠ€å·§å°±æ˜¯è‡ªé¡¶è€Œä¸‹åœ°å»åˆ†ææµç¨‹/æ•°æ®æµå˜æ¢çš„è¿‡ç¨‹ã€‚</p><p>é¦–å…ˆä»å›½å®¶å¼€å§‹ï¼Œåªæœ‰ç”¨æˆ·é€‰æ‹©äº†æŒ‡å®šå›½å®¶ä¹‹åï¼Œæˆ‘ä»¬æ‰èƒ½è·å–åˆ°åŒºåŸŸçš„ç»“æ„ä¿¡æ¯(æ˜¯çœ/å¸‚/åŒº, è¿˜æ˜¯å·/åŸå¸‚ï¼Œanyway):</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">export const AreaSelect2 = defineComponent(&#123;</span><br><span class="line">  props: &#123;</span><br><span class="line">    // è¡¨å•å€¼æ˜¯æ•°ç»„æ ¼å¼ï¼Œæ¯ä¸€é¡¹ä¿å­˜çš„æ˜¯åŒºåŸŸçš„ id</span><br><span class="line">    modelValue: Array as PropType&lt;number[]&gt;,</span><br><span class="line">  &#125;,</span><br><span class="line">  emits: [&apos;update:modelValue&apos;],</span><br><span class="line">  setup(props, &#123; emit &#125;) &#123;</span><br><span class="line">    // ğŸ”´ è·å–å›½å®¶åˆ—è¡¨</span><br><span class="line">    const country = useCountryList();</span><br><span class="line"></span><br><span class="line">    // ğŸ”´ è®¡ç®—å½“å‰é€‰ä¸­çš„å›½å®¶ï¼Œæˆ‘ä»¬ä»è¿™é‡Œæ‹¿åˆ°è¡Œæ”¿åŒºåŸŸç»“æ„</span><br><span class="line">    const currentCountry = computed(() =&gt; &#123;</span><br><span class="line">      return country.data.value?.data?.find(i =&gt; i.id === props.modelValue?.[0]);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    const handleCountryChange = (value: number) =&gt; &#123;</span><br><span class="line">      if (value !== props.modelValue?.[0]) &#123;</span><br><span class="line">        // ğŸ›‘ å›½å®¶å˜åŠ¨åï¼Œé‡ç½®æ‰åç»­çš„æ•°æ®</span><br><span class="line">        emit(&apos;update:modelValue&apos;, [value]);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    return () =&gt; &#123;</span><br><span class="line">      return (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">          &lt;ElSelect</span><br><span class="line">            modelValue=&#123;props.modelValue?.[0]&#125;</span><br><span class="line">            placeholder=&quot;è¯·é€‰æ‹©å›½å®¶&quot;</span><br><span class="line">            onUpdate:modelValue=&#123;handleCountryChange&#125;</span><br><span class="line">            filterable</span><br><span class="line">            fitInputWidth</span><br><span class="line">            loading=&#123;country.isValidating.value&#125;</span><br><span class="line">          &gt;</span><br><span class="line">            &#123;country.data.value?.data?.map(i =&gt; &#123;</span><br><span class="line">              return &lt;ElOption key=&#123;i.id&#125; label=&#123;i.name&#125; value=&#123;i.id&#125;&gt;&lt;/ElOption&gt;;</span><br><span class="line">            &#125;)&#125;</span><br><span class="line">          &lt;/ElSelect&gt;</span><br><span class="line">          &#123;/* æ­¤å¤„æš‚æ—¶å¿½ç•¥ */&#125;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      );</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><ul><li>Composition API çš„å¥½å¤„æ˜¯ï¼Œå®ƒè®©ç»„åˆå’Œå°è£…å˜å¾—éå¸¸ä¾¿åˆ©ã€‚å¦‚ä¸Šé¢çš„ä»£ç ï¼Œæˆ‘ä»¬å°†è·å–å›½å®¶çš„ç›¸å…³é€»è¾‘å°è£…æˆ useCountryListï¼Œä»£ç å˜å¾—æ›´åŠ ç®€æ´æ˜“è¯»ã€‚</li><li>é¿å…ä¸­é—´å˜é‡ã€‚æªå®ˆ v-model å•å‘æ•°æ®æµ</li></ul><p><br></p><hr><p><br></p><p>æ¥ç€æˆ‘ä»¬æ ¹æ®é€‰ä¸­çš„å›½å®¶æ¥æ¸²æŸ“åç»­çš„åŒºåŸŸè”åŠ¨ã€‚</p><p>è¿™é‡Œæé†’ä¸€ä¸‹è¯»è€…ï¼šâ€œä¸è¦åå•¬åˆ›å»ºç»„ä»¶â€</p><p>æˆ‘åœ¨  <a href="https://juejin.cn/post/6844903844711759880#heading-2" target="_blank" rel="noopener">Reactç»„ä»¶è®¾è®¡å®è·µæ€»ç»“04 - ç»„ä»¶çš„æ€ç»´</a> ä¸­è®²è¿‡ï¼š</p><blockquote><p>å¤§éƒ¨åˆ†æƒ…å†µä¸‹, ç»„ä»¶è¡¨ç¤ºæ˜¯ä¸€ä¸ª UI å¯¹è±¡. å…¶å®ç»„ä»¶ä¸å•å•å¯ä»¥è¡¨ç¤º UI, ä¹Ÿå¯ä»¥ç”¨æ¥æŠ½è±¡ä¸šåŠ¡å¯¹è±¡, æœ‰æ—¶å€™æŠ½è±¡ä¸ºç»„ä»¶å¯ä»¥å·§å¦™åœ°è§£å†³ä¸€äº›é—®é¢˜</p></blockquote><p>ç»„ä»¶è¿™ä¸ªè®¾è®¡å®åœ¨å¤ªå¥½ç”¨äº†ï¼Œç¬”è€…è§‰å¾—å®ƒä½“ç°çš„æ›´é‡è¦çš„æ€æƒ³æ˜¯åˆ†æ²»ï¼Œè€Œä¸æ˜¯å¤ç”¨ã€‚ç»„ä»¶ä¸€äº›æ¯”è¾ƒé‡è¦çš„ç‰¹æ€§æ˜¯ï¼š</p><ul><li>å’Œå‡½æ•°ä¸€æ ·ï¼Œå®ƒæ˜¯ä¸€ä¸ªå°é—­çš„ã€è‡ªåŒ…å«çš„å•å…ƒã€‚çˆ¶ç»„ä»¶ä¸åº”è¯¥æ“å¿ƒå®ƒï¼Œè€Œåº”è¯¥è®©ä»–è‡ªæˆ‘ç»„ç»‡ã€‚</li><li>ç»„ä»¶æœ‰çŠ¶æ€ã€‚è¿™ä¸ªæ˜¯å’Œå‡½æ•°ä¸ä¸€æ ·çš„åœ°æ–¹</li><li><p>ç»„ä»¶æœ‰ç”Ÿå‘½å‘¨æœŸã€‚è¿™å°±æ„å‘³ç€ç»„ä»¶å¯ä»¥è‡ªå·±ç®¡ç†å’Œé”€æ¯è‡ªå·±çš„èµ„æºï¼Œä¸ä¼šæ³„éœ²å‡ºå»ã€‚</p><p>  è¿™æ˜¯ç»„ä»¶å’Œ Hooks æ˜¯æœ‰æœ¬è´¨åŒºåˆ«çš„ï¼æˆ‘ä»¬ä½¿ç”¨ Hooks ä¹Ÿå¯ä»¥å®ç°ä¸€ä¸ªè‡ªæˆ‘ç»„ç»‡çš„ã€å°é—­çš„ã€è‡ªåŒ…å«çš„å•å…ƒï¼Œä½†æ˜¯å®ƒçš„ç”Ÿå‘½å‘¨æœŸä¸æ˜¯å®ƒå†³å®šçš„ï¼Œè€Œæ˜¯ç”±ä½¿ç”¨å®ƒçš„å®¿ä¸»ç»„ä»¶å†³å®šçš„</p></li></ul><blockquote><p>å…³äºè¿™å—çš„è¯¦ç»†é˜è¿°å¯ä»¥çœ‹ç¬”è€…çš„<a href="https://juejin.cn/post/6844903844711759880#heading-2" target="_blank" rel="noopener">æ—§æ–‡ç« </a>ã€‚</p></blockquote><p>æ‰€ä»¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºç»„ä»¶æ¥å°è£…åŒºåŸŸé€‰æ‹©çš„é€»è¾‘ï¼Œå°†å¤æ‚åº¦åˆ†æµå‡ºå»ã€‚æˆ–è€…è¯´é€šè¿‡ props å°†æ•°æ®æµå¾€ä¸‹ä¼ é€’ç»™å­ç»„ä»¶â€¦ </p><figure class="highlight diff"><table><tr><td class="code"><pre><span class="line">export const AreaSelect2 = defineComponent(&#123;</span><br><span class="line">  // çœç•¥</span><br><span class="line">  setup(props, &#123; emit &#125;) &#123;</span><br><span class="line">    // çœç•¥</span><br><span class="line"></span><br><span class="line">    return () =&gt; &#123;</span><br><span class="line">      return (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">          &lt;ElSelect</span><br><span class="line">           // çœç•¥</span><br><span class="line">          &gt;</span><br><span class="line">            &#123;country.data.value?.data?.map(i =&gt; &#123;</span><br><span class="line">              return &lt;ElOption key=&#123;i.id&#125; label=&#123;i.name&#125; value=&#123;i.id&#125;&gt;&lt;/ElOption&gt;;</span><br><span class="line">            &#125;)&#125;</span><br><span class="line">          &lt;/ElSelect&gt;</span><br><span class="line">     </span><br><span class="line"><span class="addition">+          &#123;!!currentCountry.value &amp;&amp;</span></span><br><span class="line"><span class="addition">+            currentCountry.value?.regionLevelInfos?.map((i, index) =&gt; &#123;</span></span><br><span class="line"><span class="addition">+              // çˆ¶åŒºåŸŸ id</span></span><br><span class="line"><span class="addition">+              const parentValue = props.modelValue?.[index];</span></span><br><span class="line"><span class="addition">+              // å½“å‰åŒºåŸŸ</span></span><br><span class="line"><span class="addition">+              const value = props.modelValue?.[index + 1];</span></span><br><span class="line"><span class="addition">+              // çˆ¶åŒºåŸŸä¿¡æ¯</span></span><br><span class="line"><span class="addition">+              const parentRegion: RegionLevelDTO =</span></span><br><span class="line"><span class="addition">+                index === 0</span></span><br><span class="line"><span class="addition">+                  ? &#123; code: currentCountry.value?.code!, name: currentCountry.value?.name! &#125;</span></span><br><span class="line"><span class="addition">+                  : currentCountry.value?.regionLevelInfos?.[index - 1]!;</span></span><br><span class="line"></span><br><span class="line"><span class="addition">+              const handleChange = (nextValue: number) =&gt; &#123;</span></span><br><span class="line"><span class="addition">+                if (value === nextValue) &#123;</span></span><br><span class="line"><span class="addition">+                  return;</span></span><br><span class="line"><span class="addition">+                &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="addition">+                assert(Array.isArray(props.modelValue), 'modelValue is required');</span></span><br><span class="line"><span class="addition">+                // è£å‰ªæ‰å½“å‰åŒºåŸŸåé¢çš„åŒºåŸŸæ•°æ®</span></span><br><span class="line"><span class="addition">+                const clone = [...props.modelValue].slice(0, index + 2);</span></span><br><span class="line"><span class="addition">+                clone[index + 1] = nextValue;</span></span><br><span class="line"></span><br><span class="line"><span class="addition">+                emit('update:modelValue', clone);</span></span><br><span class="line"><span class="addition">+              &#125;;</span></span><br><span class="line"></span><br><span class="line"><span class="addition">+              return (</span></span><br><span class="line"><span class="addition">+                &lt;Section</span></span><br><span class="line"><span class="addition">+                  index=&#123;index&#125;</span></span><br><span class="line"><span class="addition">+                  parentValue=&#123;parentValue&#125;</span></span><br><span class="line"><span class="addition">+                  modelValue=&#123;value&#125;</span></span><br><span class="line"><span class="addition">+                  region=&#123;i&#125;</span></span><br><span class="line"><span class="addition">+                  parentRegion=&#123;parentRegion&#125;</span></span><br><span class="line"><span class="addition">+                  country=&#123;currentCountry.value!&#125;</span></span><br><span class="line"><span class="addition">+                  onUpdate:modelValue=&#123;handleChange&#125;</span></span><br><span class="line"><span class="addition">+                /&gt;</span></span><br><span class="line"><span class="addition">+              );</span></span><br><span class="line"><span class="addition">+            &#125;)&#125;</span></span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      );</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><br></p><p>ç»§ç»­åˆ†æµ, çœ‹çœ‹ Section ç»„ä»¶çš„å®ç°ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const Section = defineComponent(&#123;</span><br><span class="line">  name: &apos;AreaSelectSection&apos;,</span><br><span class="line">  props: &#123;</span><br><span class="line">    /**</span><br><span class="line">     * å½“å‰ç´¢å¼•</span><br><span class="line">     */</span><br><span class="line">    index: &#123; type: Number, required: true &#125;,</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * åŒºåŸŸä¿¡æ¯</span><br><span class="line">     */</span><br><span class="line">    region: &#123; type: Object as PropType&lt;RegionLevelDTO&gt;, required: true &#125;,</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * å½“å‰å›½å®¶</span><br><span class="line">     */</span><br><span class="line">    country: &#123; type: Object as PropType&lt;CountryInfoDTO&gt;, required: true &#125;,</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * çˆ¶çº§</span><br><span class="line">     */</span><br><span class="line">    parentRegion: &#123; type: Object as PropType&lt;RegionLevelDTO&gt;, required: true &#125;,</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * çˆ¶çº§çš„å€¼</span><br><span class="line">     */</span><br><span class="line">    parentValue: Number,</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * å½“å‰å€¼</span><br><span class="line">     */</span><br><span class="line">    modelValue: Number,</span><br><span class="line">  &#125;,</span><br><span class="line">  emits: [&apos;update:modelValue&apos;],</span><br><span class="line">  setup(props, &#123; emit &#125;) &#123;</span><br><span class="line">    // è·å–åŒºåŸŸåˆ—è¡¨</span><br><span class="line">    const region = useRegion(</span><br><span class="line">      computed(() =&gt; &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">          countryId: props.country.id,</span><br><span class="line">          level: props.index + 1,</span><br><span class="line">          parentId: props.parentValue,</span><br><span class="line">        &#125;;</span><br><span class="line">      &#125;)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    const handleChange = (value: number) =&gt; &#123;</span><br><span class="line">      emit(&apos;update:modelValue&apos;, value);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    return () =&gt; &#123;</span><br><span class="line">      return (</span><br><span class="line">        &lt;ElSelect</span><br><span class="line">          modelValue=&#123;props.modelValue&#125;</span><br><span class="line">          placeholder=&#123;`è¯·é€‰æ‹©$&#123;props.region.name&#125;`&#125;</span><br><span class="line">          filterable</span><br><span class="line">          fitInputWidth</span><br><span class="line">          disabled=&#123;!props.parentValue&#125;</span><br><span class="line">          onUpdate:modelValue=&#123;handleChange&#125;</span><br><span class="line">          loading=&#123;region.isValidating.value&#125;</span><br><span class="line">          class=&#123;s.select&#125;</span><br><span class="line">        &gt;</span><br><span class="line">          &#123;region.data.value?.data?.map(i =&gt; &#123;</span><br><span class="line">            return &lt;ElOption key=&#123;i.id&#125; label=&#123;i.name&#125; value=&#123;i.id&#125;&gt;&lt;/ElOption&gt;;</span><br><span class="line">          &#125;)&#125;</span><br><span class="line">        &lt;/ElSelect&gt;</span><br><span class="line">      );</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>å¯è§ï¼ŒSection çš„å®ç°ä¹Ÿå†ç®€å•ä¸è¿‡äº†ã€‚åˆ°è¿™é‡Œï¼Œæˆ‘ç›¸ä¿¡å¾ˆå¤šè¯»è€…å·²ç»æ„Ÿå—åˆ°â€œå“åº”å¼â€ç¼–ç¨‹çš„é­…åŠ›äº†å§</p><p><br><br><br><br><br></p><h1 id="åŸåˆ™å’Œå»ºè®®"><a href="#åŸåˆ™å’Œå»ºè®®" class="headerlink" title="åŸåˆ™å’Œå»ºè®®"></a>åŸåˆ™å’Œå»ºè®®</h1><ol><li>ä¼˜å…ˆä½¿ç”¨ <code>computed</code>ï¼Œè­¦æƒ• <code>watch</code>/<code>watchEffect</code> ç­‰ API çš„ä½¿ç”¨ã€‚è½¬æ¢æ€ç»´å…ˆä»å…‹åˆ¶ä½¿ç”¨ watch å¼€å§‹ã€‚</li><li>é€‚å½“ä½¿ç”¨ <code>readonly</code>, ç¦æ­¢çŠ¶æ€è¢«åäººä¿®æ”¹</li><li>æœ€å°åŒ–çŠ¶æ€ã€‚é¿å…åˆ›å»ºâ€˜ç¼“å­˜â€™çŠ¶æ€ï¼Œè®©æ•°æ®è‡ªç„¶æµåŠ¨ï¼Œä¸è¦é˜»æ–­ã€‚</li><li>è‡ªé¡¶è€Œä¸‹ï¼Œå°†ç»†èŠ‚/å‰¯ä½œç”¨åˆ†æµåˆ° hooks æˆ–å­ç»„ä»¶ä¸­ï¼Œèµ·ä¸€ä¸ªå¥½ä¸€ç‚¹çš„åå­—ï¼Œ è®©æµç¨‹çœ‹èµ·æ¥æ›´æ¸…æ™°</li><li>å°† watch è½¬æ¢ä¸º computed çš„è¯­ä¹‰ã€‚å¤–è§‚ä¸Šçš„å·®åˆ«æ˜¯ watch æœ‰ callbackï¼Œ è€Œ computed æ˜¯ã€Œç®¡é“ã€ï¼Œä¼šè¡ç”Ÿæ–°çš„æ•°æ®ã€‚æ¯”å¦‚ä¸Šé¢ useRequest çš„ä¾‹å­</li><li>æ¨èä½¿ç”¨ VueUse</li><li>å°è£… hooksï¼Œ è®©å„ç§å¤–éƒ¨çš„çŠ¶æ€æˆ–å‰¯ä½œç”¨ä¼˜é›…åœ°é›†æˆè¿›æ¥</li><li>å•å‘æ•°æ®æµï¼Œå¯¹è¿™ä¸ªæœ‰ä¸¤å±‚ç†è§£<ul><li>è¡¨ç¤ºæ˜¯ä¸€ç§æ•°æ®æµåŠ¨çš„æ–¹å‘ï¼Œé€šå¸¸å’Œ CQRS æ¨¡å¼é…åˆï¼Œæ¯”å¦‚ Reduxã€Vuexï¼Œåªèƒ½å•å‘çš„ä¿®æ”¹å’ŒæŸ¥è¯¢</li><li>è¡¨ç¤ºä¸€ç§æ•°æ®ç®¡è¾–çš„èŒƒå›´ã€‚ é€šå¸¸åº”ç”¨åªæœ‰æ•°æ®çš„æ‹¥æœ‰è€…æ‰æœ‰æƒé™å˜æ›´ã€‚è¿›ä¸€æ­¥åœ°è®²ï¼Œæˆ‘ä»¬åº”è¯¥ä»¥ç»„ä»¶ä¸ºè¾¹ç•Œï¼Œæ¥é™å®šæ•°æ®çš„ç®¡è¾–èŒƒå›´ã€‚éœ€è¦å˜æ›´æ—¶ï¼Œé€šè¿‡â€˜äº‹ä»¶â€™ æ¥é€šçŸ¥æ‹¥æœ‰è€…ã€‚æ¯”å¦‚ ä¸¥æ ¼éµå¾ª v-model åè®®ã€‚</li></ul></li><li><p>ä½¿ç”¨å“åº”å¼å¼€å‘æ€ç»´ï¼Œæ„é€ å•å‘çš„æ•°æ®æµ</p><ul><li>å°½é‡ç®¡é“åŒ–çš„æ–¹å¼å»è®¾è®¡ä½ çš„ç¨‹åº</li><li>å£°æ˜å¼ï¼Œä¸è¦å‘½ä»¤å¼</li><li>æ‹†åˆ†ç»„ä»¶æˆ–hooksæ¥åˆ†æ²»æ•°æ®æµ</li><li>ç»„ä»¶ä¹‹é—´ props ä¼ é€’ä¹Ÿå±äºæ•°æ®æµã€‚</li></ul><ol start="10"><li>ä½¿ç”¨ ref/reactive â†’ computed â†’ watch â†’ handler â†’ render è¿™æ ·çš„é¡ºåºç»„ç»‡ä»£ç </li></ol></li></ol><p>ğŸŒ¹æœ¬æ–‡å®Œï¼Œä½ çš„ç‚¹èµæ˜¯æˆ‘å†™ä½œçš„æœ€å¤§åŠ¨åŠ›ï¼Œæ¬¢è¿ç•™è¨€è½¬å‘ï¼ˆå¤‡æ³¨åŸæ–‡ä½œè€…å’Œé“¾æ¥ï¼‰ã€‚</p><p><br><br><br></p><h1 id="æ‰©å±•é˜…è¯»"><a href="#æ‰©å±•é˜…è¯»" class="headerlink" title="æ‰©å±•é˜…è¯»"></a>æ‰©å±•é˜…è¯»</h1><ul><li><a href="https://juejin.cn/post/6844903844711759880#heading-4" target="_blank" rel="noopener">Reactç»„ä»¶è®¾è®¡å®è·µæ€»ç»“04 - ç»„ä»¶çš„æ€ç»´</a></li><li><a href="https://rxjs.dev/" target="_blank" rel="noopener">RxJS</a></li><li><a href="https://dev.to/lloyds-digital/comparing-reactivity-models-react-vs-vue-vs-svelte-vs-mobx-vs-solid-29m8" target="_blank" rel="noopener">Comparing reactivity models - React vs Vue vs Svelte vs MobX vs Solid vs Redux</a></li><li><a href="https://zhuanlan.zhihu.com/p/25383159" target="_blank" rel="noopener">RxJS å…¥é—¨æŒ‡å¼•å’Œåˆæ­¥åº”ç”¨</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;img src=&quot;/images/vue-with-rx/Untitled.png&quot; alt=&quot;Untitled&quot;&gt;&lt;/p&gt;
&lt;p&gt;å†™è¿™ç¯‡æ–‡ç« çš„åŠ¨æœºå¯ä»¥è¿½æº¯åˆ° 3 å¹´å‰ï¼Œ æˆ‘å‘ç°å¾ˆå¤šèº«è¾¹å¼€å‘è€…å¹¶æ²¡æœ‰æ­£ç¡®åœ°ä½¿ç”¨ React Hooks, æ‰€ä»¥æˆ‘è§‰å¾—åº”è¯¥æŠŠæˆ‘çš„å¼€å‘ç»éªŒå’Œæ€ç»´æ•´
      
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://bobi.ink/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>æ¬¡ä¸–ä»£å‰ç«¯è§†å›¾æ¡†æ¶éƒ½åœ¨å·å•¥ï¼Ÿ</title>
    <link href="https://bobi.ink/2023/07/02/fe-view-future/"/>
    <id>https://bobi.ink/2023/07/02/fe-view-future/</id>
    <published>2023-07-01T16:00:00.000Z</published>
    <updated>2023-07-04T01:19:01.665Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/images/fe-view-future/Untitled.png" alt="state of JavaScript 2022 æ»¡æ„åº¦æ’å"></p><p>state of JavaScript 2022 æ»¡æ„åº¦æ’å</p><p>ä¸Šå›¾æ˜¯ <a href="https://2022.stateofjs.com/zh-Hans/libraries/front-end-frameworks/" target="_blank" rel="noopener">State of JavaScript</a> 2022 å‰ç«¯æ¡†æ¶æ»¡æ„åº¦æ’åã€‚å‰ä¸‰ååˆ†åˆ«æ˜¯ <code>Solid</code>ã€<code>Svelte</code>ã€<code>Qwik</code>ã€‚æˆ‘ä»¬å¯ä»¥ç§°ä»–ä»¬ä¸ºæ¬¡ä¸–ä»£å‰ç«¯æ¡†æ¶çš„ä¸‰å¤§ä»£è¡¨ï¼Œå‰è¾ˆæ˜¯ <code>React</code>/<code>Angular</code>/<code>Vue</code>ã€‚<br>ç›®å‰ React/Augular/Vue è¿˜å æ®çš„ä¸»æµçš„å¸‚åœºåœ°ä½ï¼Œ ç°åœ¨æˆ‘ä»¬è¿˜ä¸çŸ¥é“ä¸‹ä¸€ä¸ªäº”å¹´ã€åå¹´è°ä¼šæˆä¸ºä¸»æµï¼Œæœ‰å¯èƒ½å‰è¾ˆä¼šè¢«åæµªæ‹æ­»åœ¨æ²™æ»©ä¸Šï¼Œ ä¹Ÿæœ‰å¯èƒ½ä½ å¤§çˆ·è¿˜æ˜¯ä½ å¤§çˆ·ã€‚</p><p>å°±åƒç¼–ç¨‹è¯­è¨€ä¸€æ ·ï¼Œå°½ç®¡æ¯å¹´éƒ½æœ‰æ–°çš„è¯­è¨€è¯ç”Ÿï¼Œä½†æ˜¯æ’¼åŠ¨ä¸»æµç¼–ç¨‹è¯­è¨€çš„åœ°ä½è°ˆä½•å®¹æ˜“ã€‚åœ¨ä¼ä¸šçº§é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬çš„æ€åº¦ä¼šè¶‹äºä¿å®ˆï¼Œé€‰å‹ä¼šåå‘ç¨³å®šã€å¯é ã€ç”Ÿæ€å®Œå–„çš„æŠ€æœ¯ï¼Œå› æ­¤ç•™ç»™æ–°æŠ€æœ¯çš„ç”Ÿå­˜ç©ºé—´å¹¶ä¸å¤šã€‚é™¤éæ˜¯é©å‘½æ€§çš„æŠ€æœ¯ï¼Œæˆ–è€…æœ‰å¤§å‚æ”¯æ’‘ï¼Œå¦åˆ™è¿™äº›æŠ€æœ¯æˆ–æ¡†æ¶åªä¼šåœç•™å°ä¼—åœˆå­å†…ã€‚</p><blockquote><p>æ¯”å¦‚æœ‰ä¸€ç‚¹é©å‘½æ€§ã€åˆæœ‰å¤§å‚æ”¯æ’‘çš„ Flutterã€‚</p></blockquote><p><br></p><p>é‚£ä¹ˆä»æ›´é«˜çš„è§’åº¦çœ‹ï¼Œè¿™äº›æ¬¡æ—¶ä»£çš„å‰ç«¯è§†å›¾æ¡†æ¶åœ¨å·å“ªäº›æ–¹å‘å‘¢ï¼Ÿæœ‰å“ªäº›æ˜¯é©å‘½æ€§çš„å‘¢?</p><p>å…ˆè¯´ä¸€ä¸‹æœ¬æ–‡çš„ç»“è®ºï¼š</p><ul><li>æ•´ä½“ä¸Šè§†å›¾ç¼–ç¨‹èŒƒå¼å·²ç»å›ºåŒ–</li><li>å±€éƒ¨ä¸Šä½“éªŒä¸Šå†…å·</li></ul><p><br><br><br></p><h1 id="è§†å›¾ç¼–ç¨‹èŒƒå¼å›ºåŒ–"><a href="#è§†å›¾ç¼–ç¨‹èŒƒå¼å›ºåŒ–" class="headerlink" title="è§†å›¾ç¼–ç¨‹èŒƒå¼å›ºåŒ–"></a>è§†å›¾ç¼–ç¨‹èŒƒå¼å›ºåŒ–</h1><p>ä» JQuery é€€å‡ºå†å²èˆå°ï¼Œå†åˆ° React ç­‰å æ®ä¸»æµå¸‚åœºã€‚è§†å›¾çš„ç¼–ç¨‹èŒƒå¼åŸºæœ¬å·²ç»ç¨³å®šä¸‹æ¥ï¼Œä¸ç®¡ä½ åœ¨å­¦ä¹ ä»€ä¹ˆè§†å›¾æ¡†æ¶ï¼Œæˆ‘ä»¬æ¥è§¦çš„æ¦‚å¿µæ¨¡å‹æ˜¯è¶‹åŒçš„ï¼Œæ— éæ˜¯å®ç°çš„æ‰‹æ®µã€å¼€å‘ä½“éªŒä¸Šå„æœ‰ç‰¹è‰²ï¼š</p><ul><li><strong>æ•°æ®é©±åŠ¨è§†å›¾</strong>ã€‚æ•°æ®æ˜¯ç°ä»£å‰ç«¯æ¡†æ¶çš„æ ¸å¿ƒï¼Œè§†å›¾æ˜¯æ•°æ®çš„æ˜ å°„ï¼Œ <code>View=f(State)</code> è¿™ä¸ªå…¬å¼åŸºæœ¬æˆç«‹ã€‚</li><li><strong>å£°æ˜å¼è§†å›¾</strong>ã€‚ç›¸è¾ƒäºä¸Šä¸€ä»£çš„ jQueryï¼Œç°ä»£å‰ç«¯æ¡†æ¶ä½¿ç”¨å£°æ˜å¼æè¿°è§†å›¾çš„ç»“æ„ï¼Œå³æè¿°ç»“æœè€Œä¸æ˜¯æè¿°è¿‡ç¨‹ã€‚</li><li><strong>ç»„ä»¶åŒ–è§†å›¾</strong>ã€‚ç»„ä»¶æ˜¯ç°ä»£å‰ç«¯æ¡†æ¶çš„ç¬¬ä¸€å…¬æ°‘ã€‚ç»„ä»¶æ¶‰åŠçš„æ¦‚å¿µæ— éæ˜¯ propsã€slotsã€eventsã€refã€Contextâ€¦</li></ul><p><br><br><br></p><h1 id="å±€éƒ¨ä½“éªŒå†…å·"><a href="#å±€éƒ¨ä½“éªŒå†…å·" class="headerlink" title="å±€éƒ¨ä½“éªŒå†…å·"></a>å±€éƒ¨ä½“éªŒå†…å·</h1><p>å›é¡¾ä¸€ä¸‹ 4 å¹´å‰å†™çš„ <strong><a href="https://juejin.cn/post/6844903865926549511" target="_blank" rel="noopener">æµ…è°ˆ React æ€§èƒ½ä¼˜åŒ–çš„æ–¹å‘</a></strong>ï¼Œç°åœ¨çœ‹æ¥ä¾æ—§ä¸è¿‡æ—¶ï¼Œå„å¤§æ¡†æ¶æ— éä¹Ÿæ˜¯å›´ç»•ç€è¿™äº›ã€Œæ–¹å‘ã€æ¥æ”¹å–„ã€‚</p><p>å½“ç„¶ï¼Œåœ¨ã€Œæ¡†æ¶å†…å·ã€ã€ã€Œæ—¢è¦åˆè¦è¿˜è¦ã€æ—¶ä»£ï¼Œæ–°çš„æ¡†æ¶è¦è„±é¢–è€Œå‡ºå¹¶ä¸å®¹æ˜“ï¼Œå®ƒæ—¢è¦æœåŠ¡å¥½å¼€å‘è€…(<code>å¼€å‘ä½“éªŒ</code>)ï¼Œåˆè¦æœåŠ¡å¥½å®¢æˆ·(<code>ç”¨æˆ·ä½“éªŒ</code>) ï¼Œ æ€§èƒ½ä¸å†æ˜¯æˆ‘ä»¬é€‰æ‹©æ¡†æ¶çš„é¦–è¦å› ç´ ã€‚</p><p><br></p><p>ä»¥ä¸‹æ˜¯ç¬”è€…æ€»ç»“çš„ï¼Œæ¬¡ä¸–ä»£è§†å›¾æ¡†æ¶çš„å†…å·æ–¹å‘:</p><ul><li><strong>ç”¨æˆ·ä½“éªŒ</strong><ul><li>æ€§èƒ½ä¼˜åŒ–<ul><li>ç²¾ç»†åŒ–æ¸²æŸ“ï¼šè¿™æ˜¯æ¬¡ä¸–ä»£æ¡†æ¶å†…å·çš„ä¸»è¦æˆ˜åœºï¼Œå®ƒä»¬çš„é¦–è¦ç›®çš„åŸºæœ¬æ˜¯å®ç°ä½æˆæœ¬çš„ç²¾ç»†åŒ–æ¸²æŸ“<ul><li>é¢„ç¼–è¯‘æ–¹æ¡ˆï¼šä»£è¡¨æœ‰ Svelteã€Solid</li><li>å“åº”å¼æ•°æ®ï¼šä»£è¡¨æœ‰ Svelteã€Solidã€Vueã€Signal(ä¸æ˜¯æ¡†æ¶)</li><li>åŠ¨é™åˆ†ç¦»</li></ul></li></ul></li><li>å¹¶å‘(Concurrent)ï¼šReact åœ¨è¿™ä¸ªæ–¹å‘ç‹¬æ³ä¸€æ ‘ã€‚</li><li>å» JavaScriptï¼šä¸ºäº†è·å¾—æ›´å¥½çš„é¦–å±ä½“éªŒï¼Œå„å¤§æ¡†æ¶å¼€å§‹ã€ŒæŠ›å¼ƒã€JavaScriptï¼Œéƒ½åœ¨æ¯”æ‹¼è°èƒ½æ›´å¿«åˆ°è¾¾ç”¨æˆ·çš„çœ¼å‰ï¼Œå¹¶ä¸”æ˜¯å®Œæ•´å¯äº¤äº’çš„å½¢æ€ã€‚</li></ul></li><li><strong>å¼€å‘ä½“éªŒ</strong><ul><li>Typescript å‹å¥½ï¼šä¸æ”¯æŒ Typescript åŸºæœ¬å°±æ˜¯ ca</li><li>å¼€å‘å·¥å…·é“¾/æ„å»ºä½“éªŒ: Viteã€Turbopackâ€¦ å¼€å‘çš„å·¥å…·é“¾ç›´æ¥å†³å®šäº†å¼€å‘ä½“éªŒ</li><li>å¼€å‘è€…å·¥å…·ï¼šæ¡†æ¶å°‘ä¸äº†å¼€å‘è€…å·¥å…·ï¼Œä» Vue Devtools å†åˆ° <a href="https://devtools.nuxtjs.org/" target="_blank" rel="noopener">Nuxt Devtools</a>ï¼Œé…·ç‚«çš„å¼€å‘è€…å·¥å…·æœªæ¥å¯èƒ½éƒ½æ˜¯æ ‡é…</li><li>å…ƒæ¡†æ¶: æ¯›å¯æˆ¿ä¸å†æµè¡Œï¼Œä»å‰åˆ°åã€å¤§è€Œå…¨çš„å…ƒæ¡†æ¶ç§°ä¸ºæ–°æ¬¢ï¼Œå†…å·æ—¶ä»£æˆ‘ä»¬åªåº”è¯¥å…³æ³¨ä¸šåŠ¡æœ¬èº«ã€‚ä»£è¡¨æœ‰ Nextjsã€Nuxtjs</li></ul></li></ul><p><br><br><br><br><br></p><h2 id="ç²¾ç»†åŒ–æ¸²æŸ“"><a href="#ç²¾ç»†åŒ–æ¸²æŸ“" class="headerlink" title="ç²¾ç»†åŒ–æ¸²æŸ“"></a>ç²¾ç»†åŒ–æ¸²æŸ“</h2><p><br><br><br></p><h3 id="é¢„ç¼–è¯‘æ–¹æ¡ˆ"><a href="#é¢„ç¼–è¯‘æ–¹æ¡ˆ" class="headerlink" title="é¢„ç¼–è¯‘æ–¹æ¡ˆ"></a>é¢„ç¼–è¯‘æ–¹æ¡ˆ</h3><p>Reactã€Vue è¿™äº›ä»¥ Virtual DOM ä¸ºä¸»çš„æ¸²æŸ“æ–¹å¼ï¼Œé€šå¸¸åªèƒ½åšåˆ°ç»„ä»¶çº§åˆ«çš„ç²¾ç»†åŒ–æ¸²æŸ“ã€‚<strong>è€Œæ¬¡ä¸–ä»£çš„ Svelteã€Solidjs ä¸çº¦è€ŒåŒåœ°æŠ›å¼ƒäº† Virtual DOMï¼Œé‡‡ç”¨é™æ€ç¼–è¯‘çš„æ‰‹æ®µï¼Œå°†ã€Œå£°æ˜å¼ã€çš„è§†å›¾å®šä¹‰ï¼Œè½¬è¯‘ä¸ºã€Œå‘½ä»¤å¼ã€çš„ DOM æ“ä½œ</strong>ã€‚</p><p>Svelte</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">  <span class="keyword">let</span> count = <span class="number">0</span></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">  <span class="function"><span class="keyword">function</span> <span class="title">handleClick</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="undefined">    count += 1</span></span><br><span class="line"><span class="undefined">  &#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">on:click</span>=<span class="string">"&#123;handleClick&#125;"</span>&gt;</span>Clicked &#123;count&#125; &#123;count === 1 ? 'time' : 'times'&#125;<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ç¼–è¯‘ç»“æœï¼š</p><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ....</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">create_fragment</span>(<span class="params">ctx</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> button</span><br><span class="line">  <span class="keyword">let</span> t0</span><br><span class="line">  <span class="keyword">let</span> t1</span><br><span class="line">  <span class="keyword">let</span> t2</span><br><span class="line">  <span class="keyword">let</span> t3_value = <span class="comment">/*count*/</span> (ctx[<span class="number">0</span>] === <span class="number">1</span> ? <span class="string">'time'</span> : <span class="string">'times'</span>) + <span class="string">''</span></span><br><span class="line">  <span class="keyword">let</span> t3</span><br><span class="line">  <span class="keyword">let</span> mounted</span><br><span class="line">  <span class="keyword">let</span> dispose</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    c() &#123;</span><br><span class="line">      button = element(<span class="string">'button'</span>)</span><br><span class="line">      t0 = text(<span class="string">'Clicked '</span>)</span><br><span class="line">      t1 = text(<span class="comment">/*count*/</span> ctx[<span class="number">0</span>])</span><br><span class="line">      t2 = space()</span><br><span class="line">      t3 = text(t3_value)</span><br><span class="line">    &#125;,</span><br><span class="line">    m(target, anchor) &#123;</span><br><span class="line">      insert(target, button, anchor)</span><br><span class="line">      append(button, t0)</span><br><span class="line">      append(button, t1)</span><br><span class="line">      append(button, t2)</span><br><span class="line">      append(button, t3)</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (!mounted) &#123;</span><br><span class="line">        dispose = listen(button, <span class="string">'click'</span>, <span class="comment">/*handleClick*/</span> ctx[<span class="number">1</span>])</span><br><span class="line">        mounted = <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    p(ctx, [dirty]) &#123;</span><br><span class="line">      <span class="keyword">if</span> (dirty &amp; <span class="comment">/*count*/</span> <span class="number">1</span>) set_data(t1, <span class="comment">/*count*/</span> ctx[<span class="number">0</span>])</span><br><span class="line">      <span class="keyword">if</span> (</span><br><span class="line">        dirty &amp; <span class="comment">/*count*/</span> <span class="number">1</span> &amp;&amp;</span><br><span class="line">        t3_value !== (t3_value = <span class="comment">/*count*/</span> (ctx[<span class="number">0</span>] === <span class="number">1</span> ? <span class="string">'time'</span> : <span class="string">'times'</span>) + <span class="string">''</span>)</span><br><span class="line">      )</span><br><span class="line">        set_data(t3, t3_value)</span><br><span class="line">    &#125;,</span><br><span class="line">    i: noop,</span><br><span class="line">    o: noop,</span><br><span class="line">    d(detaching) &#123;</span><br><span class="line">      <span class="keyword">if</span> (detaching) &#123;</span><br><span class="line">        detach(button)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      mounted = <span class="literal">false</span></span><br><span class="line">      dispose()</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">instance</span>(<span class="params">$$self, $$props, $$invalidate</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> count = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">handleClick</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    $$invalidate(<span class="number">0</span>, (count += <span class="number">1</span>))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> [count, handleClick]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">SvelteComponent</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(options) &#123;</span><br><span class="line">    <span class="keyword">super</span>()</span><br><span class="line">    init(<span class="keyword">this</span>, options, instance, create_fragment, safe_not_equal, &#123;&#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çœ‹åˆ°ï¼Œç®€æ´çš„æ¨¡æ¿æœ€ç»ˆè¢«è½¬ç§»æˆäº†åº•å±‚ DOM æ“ä½œçš„å‘½ä»¤åºåˆ—ã€‚</p><p>æˆ‘å†™æ–‡ç« æ¯”è¾ƒå–œæ¬¢æ¯”å–»ï¼Œè¿™ç§åœºæ™¯è®©æˆ‘æƒ³åˆ°ï¼Œç¼–ç¨‹è¯­è¨€å¯¹å†…å­˜çš„æ“ä½œï¼ŒDOM å°±æ˜¯æµè§ˆå™¨é‡Œé¢çš„ã€Œå†…å­˜ã€ï¼š</p><ul><li>Virtual DOM å°±æ˜¯é‚£äº›é‚£äº›å¸¦ GC çš„è¯­è¨€ï¼Œä½¿ç”¨è¿è¡Œæ—¶çš„æ–¹æ¡ˆæ¥å±è”½ DOM çš„æ“ä½œç»†èŠ‚ï¼Œè¿™ä¸ªæŠ½è±¡æ˜¯æœ‰ä»£ä»·çš„</li><li>é¢„ç¼–è¯‘æ–¹æ¡ˆåˆ™æ›´åƒ Rustï¼Œæ²¡æœ‰å¼•å…¥è¿è¡Œæ—¶ GC, ä½¿ç”¨äº†ä¸€å¥—ä¸¥æ ¼çš„æ‰€æœ‰æƒå’Œå¯¹è±¡ç”Ÿå‘½å‘¨æœŸç®¡ç†æœºåˆ¶ï¼Œè®©ç¼–è¯‘å™¨å¸®ä½ è½¬æ¢å‡ºå®‰å…¨çš„å†…å­˜æ“ä½œä»£ç ã€‚</li><li>æ‰‹åŠ¨æ“ä½œ DOM, å°±åƒ Cã€C++ è¿™ç±»åº•å±‚è¯­è¨€ï¼Œéœ€è¦å¼€å‘è€…æ‰‹åŠ¨ç®¡ç†å†…å­˜</li></ul><p>ä½¿ç”¨ Svelte/SolidJS è¿™äº›æ–¹æ¡ˆï¼Œå¯ä»¥åšåˆ°ä¿®æ”¹æŸä¸ªæ•°æ®ï¼Œç²¾ç»†å®šä½å¹¶ä¿®æ”¹ DOM èŠ‚ç‚¹ï¼ŒçŠ¹å¦‚æˆ‘ä»¬å½“å¹´æ‰‹åŠ¨æ“ä½œ DOM è¿™ä¹ˆç²¾ç»†ã€‚è€Œ Virtual DOM æ–¹æ¡ˆï¼Œåªèƒ½åˆ°ç»„ä»¶è¿™ä¸€å±‚çº§ï¼Œé™¤éä½ çš„ç»„ä»¶ç²’åº¦éå¸¸ç»†ã€‚</p><p><br><br><br><br><br></p><h3 id="å“åº”å¼æ•°æ®"><a href="#å“åº”å¼æ•°æ®" class="headerlink" title="å“åº”å¼æ•°æ®"></a>å“åº”å¼æ•°æ®</h3><p>å’Œç²¾ç»†åŒ–æ¸²æŸ“è„±ä¸å¼€èº«çš„è¿˜æœ‰<code>å“åº”å¼æ•°æ®</code>ã€‚</p><p>React ä¸€ç›´è¢«è¯Ÿç—…çš„ä¸€ç‚¹æ˜¯å½“æŸä¸ªç»„ä»¶çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå®ƒä¼šä»¥è¯¥ç»„ä»¶ä¸ºæ ¹ï¼Œé‡æ–°æ¸²æŸ“æ•´ä¸ªç»„ä»¶å­æ ‘ï¼Œå¦‚æœè¦é¿å…ä¸å¿…è¦çš„å­ç»„ä»¶çš„é‡æ¸²æŸ“ï¼Œéœ€è¦å¼€å‘è€…æ‰‹åŠ¨è¿›è¡Œä¼˜åŒ–(æ¯”å¦‚ <code>shouldComponentUpdate</code>ã€<code>PureComponent</code>ã€<code>memo</code>ã€<code>useMemo</code>/<code>useCallback</code>)  ã€‚åŒæ—¶ä½ å¯èƒ½ä¼šéœ€è¦ä½¿ç”¨ä¸å¯å˜çš„æ•°æ®ç»“æ„æ¥ä½¿å¾—ä½ çš„ç»„ä»¶æ›´å®¹æ˜“è¢«ä¼˜åŒ–ã€‚</p><p>åœ¨ Vue åº”ç”¨ä¸­ï¼Œç»„ä»¶çš„ä¾èµ–æ˜¯åœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­è‡ªåŠ¨è¿½è¸ªçš„ï¼Œæ‰€ä»¥ç³»ç»Ÿèƒ½ç²¾ç¡®çŸ¥æ™“å“ªä¸ªç»„ä»¶ç¡®å®éœ€è¦è¢«é‡æ¸²æŸ“ã€‚</p><p>è¿‘æœŸæ¯”è¾ƒç«çƒ­çš„ signal (ä¿¡å·ï¼ŒAngularã€Preactã€Qwikã€Solid ç­‰æ¡†æ¶éƒ½å¼•å…¥äº†è¯¥æ¦‚å¿µ)ï¼Œå¦‚æœè¯»è€…æ˜¯ Vue æˆ–è€… MobX ä¹‹ç±»çš„ç”¨æˆ·ï¼Œ Signal å¹¶ä¸æ˜¯æ–°çš„æ¦‚å¿µã€‚</p><p>æŒ‰ Vue å®˜æ–¹æ–‡æ¡£çš„è¯è¯´ï¼š<em>ä»æ ¹æœ¬ä¸Šè¯´ï¼Œä¿¡å·æ˜¯ä¸ Vue ä¸­çš„ ref ç›¸åŒçš„å“åº”æ€§åŸºç¡€ç±»å‹ã€‚å®ƒæ˜¯ä¸€ä¸ªåœ¨è®¿é—®æ—¶è·Ÿè¸ªä¾èµ–ã€åœ¨å˜æ›´æ—¶è§¦å‘å‰¯ä½œç”¨çš„å€¼å®¹å™¨ã€‚</em></p><p>ä¸ç®¡æ€æ ·ï¼Œå“åº”å¼æ•°æ®ä¸è¿‡æ˜¯<code>è§‚å¯Ÿè€…æ¨¡å¼</code>çš„ä¸€ç§å®ç°ã€‚ç›¸æ¯” React ä¸»å¯¼çš„é€šè¿‡ä¸å¯å˜æ•°æ®çš„æ¯”å¯¹æ¥æ ‡è®°é‡æ–°æ¸²æŸ“çš„èŒƒå›´ï¼Œå“åº”å¼æ•°æ®å¯ä»¥å®ç°æ›´ç»†ç²’åº¦çš„ç»‘å®šï¼›è€Œä¸”å“åº”å¼çš„å¦ä¸€é¡¹ä¼˜åŠ¿æ˜¯å®ƒçš„å¯ä¼ é€’æ€§(æœ‰äº›åœ°æ–¹ç§°ä¸º <code>Props ä¸‹é’»</code>(Props Drilling))ã€‚</p><p><br><br><br></p><h3 id="åŠ¨é™åˆ†ç¦»"><a href="#åŠ¨é™åˆ†ç¦»" class="headerlink" title="åŠ¨é™åˆ†ç¦»"></a>åŠ¨é™åˆ†ç¦»</h3><p>Vue 3 å°±æ˜¯åŠ¨é™ç»“åˆçš„å…¸å‹ä»£è¡¨ã€‚åœ¨æˆ‘çœ‹æ¥ Vue æ·±è°™ä¸­åº¸ä¹‹é“ï¼Œåœ¨å®ƒèº«ä¸Šæˆ‘ä»¬å¾ˆéš¾æ‰¾å‡ºçŸ­æ¿ã€‚</p><p>Vue çš„æ¨¡æ¿æ˜¯éœ€è¦é™æ€ç¼–è¯‘çš„ï¼Œè¿™ä½¿å¾—å®ƒå¯ä»¥åƒ Svelte ç­‰æ¡†æ¶ä¸€æ ·ï¼Œæœ‰è¾ƒå¤§çš„ä¼˜åŒ–ç©ºé—´ï¼›åŒæ—¶ä¿ç•™äº† Virtual DOM å’Œè¿è¡Œæ—¶ Reactivityï¼Œè®©å®ƒå…¼é¡¾äº†çµæ´»å’Œæ™®é€‚æ€§ã€‚</p><p>åŸºäºé™æ€çš„æ¨¡æ¿ï¼ŒVue 3 åšäº†å¾ˆå¤šä¼˜åŒ–ï¼Œç¬”è€…å°†å®ƒæ€»ç»“ä¸º<code>åŠ¨é™åˆ†ç¦»</code>å§ã€‚æ¯”å¦‚é™æ€æå‡ã€æ›´æ–°ç±»å‹æ ‡è®°ã€æ ‘ç»“æ„æ‰“å¹³ï¼Œæ— ééƒ½æ˜¯å°†æ¨¡æ¿ä¸­çš„é™æ€éƒ¨åˆ†å’ŒåŠ¨æ€éƒ¨åˆ†ä½œä¸€äº›åˆ†ç¦»ï¼Œé¿å…ä¸€äº›æ— æ„ä¹‰çš„æ›´æ–°æ“ä½œã€‚</p><p>æ›´é•¿è¿œçš„çœ‹ï¼Œå— SolidJS çš„å¯å‘ï¼Œ Vue æœªæ¥å¯èƒ½ä¹Ÿä¼šé€€å‡º Vapor æ¨¡å¼ï¼Œä¸ä¾èµ– Virtual DOM æ¥å®ç°æ›´åŠ ç²¾ç»†çš„æ¸²æŸ“ã€‚</p><p><br><br><br><br><br></p><h2 id="å†è°ˆç¼–è¯‘æ—¶å’Œè¿è¡Œæ—¶"><a href="#å†è°ˆç¼–è¯‘æ—¶å’Œè¿è¡Œæ—¶" class="headerlink" title="å†è°ˆç¼–è¯‘æ—¶å’Œè¿è¡Œæ—¶"></a>å†è°ˆç¼–è¯‘æ—¶å’Œè¿è¡Œæ—¶</h2><p>ç¼–è¯‘æ—¶å’Œè¿è¡Œæ—¶æ²¡æœ‰ä¼˜åŠ£ä¹‹åˆ†ï¼Œ ä¹Ÿä¸èƒ½è¯´çº¯ç¼–è¯‘çš„æ–¹æ¡ˆå°±å¿…å®šæ˜¯æœªæ¥çš„è¶‹åŠ¿ã€‚</p><p>è¿™å‡ å¹´é™¤äº†æ–°çš„ç¼–è¯‘æ—¶çš„æ–¹æ¡ˆå†’å‡ºæ¥ï¼Œå®£ä¼ è‡ªå·±æ˜¯æœªæ¥ï¼›ä¹Ÿæœ‰ä»ç¼–è¯‘æ—¶çš„ç„¦æ²¹å‘é‡Œçˆ¬å‡ºæ¥ï¼Œ è½¬åˆ°è¿è¡Œæ—¶æ–¹æ¡ˆçš„ï¼Œè¿™é‡Œé¢çš„å…¸å‹ä»£è¡¨å°±æ˜¯ Taroã€‚</p><p>Taro 2.0 ä¹‹å‰é‡‡ç”¨çš„æ˜¯é™æ€ç¼–è¯‘çš„æ–¹æ¡ˆï¼Œå³å°† â€™Reactâ€˜ ç»„ä»¶è½¬è¯‘ä¸ºå°ç¨‹åºåŸç”Ÿçš„ä»£ç :</p><p><img src="/images/fe-view-future/Untitled%201.png" alt="Untitled"></p><p>ä½†æ˜¯è¿™ä¸ªè½¬è¯‘å·¥ä½œé‡éå¸¸åºå¤§ï¼ŒJSX çš„å†™æ³•åƒå˜ä¸‡åŒ–ï¼Œéå¸¸çµæ´»ã€‚Taro åªèƒ½é‡‡ç”¨ <code>ç©·ä¸¾</code> çš„æ–¹å¼å¯¹ JSX å¯èƒ½çš„å†™æ³•è¿›è¡Œäº†ä¸€ ä¸€é€‚é…ï¼Œè¿™ä¸€éƒ¨åˆ†å·¥ä½œé‡å¾ˆå¤§ï¼Œå®é™…ä¸Š Taro æœ‰å¤§é‡çš„ Commit éƒ½æ˜¯ä¸ºäº†æ›´å®Œå–„çš„æ”¯æŒ JSX çš„å„ç§å†™æ³•ã€‚è¿™ä¹Ÿæ˜¯ Taro å®˜æ–¹æ”¾å¼ƒè¿™ç§æ¶æ„çš„åŸå› ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ <strong>Taro ä¹Ÿåªèƒ½è¦†ç›–æˆ‘ä»¬å¸¸è§çš„ JSX ç”¨æ³•ï¼Œè€Œä¸”æˆ‘ä»¬å¿…é¡»ä¸¥æ ¼éµå¾ª Taro è§„èŒƒæ‰èƒ½æ­£å¸¸é€šè¿‡ã€‚</strong></p><p>æœ‰éå¸¸å¤šçš„å±€é™ï¼š</p><ul><li>é™æ€çš„ JSX</li><li>ä¸æ”¯æŒé«˜é˜¶ç»„ä»¶</li><li>ä¸æ”¯æŒåŠ¨æ€ç»„ä»¶</li><li>ä¸æ”¯æŒæ“ä½œ JSX çš„ç»“æœ</li><li>ä¸æ”¯æŒ render function</li><li>ä¸èƒ½é‡æ–°å¯¼å‡ºç»„ä»¶</li><li>éœ€è¦éµå¾ª on<em>ã€render</em> çº¦æŸ</li><li>ä¸æ”¯æŒ Contextã€Fragmentã€props å±•å¼€ã€forwardRef</li><li>â€¦.</li></ul><p><a href="https://www.notion.so/Taro-React-65161e2a09f648c0ad1c69f314ff3cea?pvs=21" target="_blank" rel="noopener">æœ‰å¤ªå¤šå¤ªå¤šçš„çº¦æŸ</a>ï¼Œè¿™å·²ç»ä¸æ˜¯å¸¦ç€é•£é“è·³èˆäº†ï¼Œæ˜¯è¢«äº”èŠ±å¤§ç»‘äº†ã€‚</p><p><br></p><p>ä½¿ç”¨ç¼–è¯‘çš„æ–¹æ¡ˆä¸å¯é¿å…çš„å’Œå®é™…è¿è¡Œçš„ä»£ç æœ‰è¾ƒå¤§çš„ <code>Gap</code>ï¼Œæºç å’Œå®é™…è¿è¡Œçš„ä»£ç å­˜åœ¨è¾ƒå¤§çš„å·®åˆ«ä¼šå¯¼è‡´ä»€ä¹ˆï¼Ÿ</p><ul><li>æ¯”è¾ƒå·®çš„ Debug ä½“éªŒã€‚</li><li>æ¯”è¾ƒé»‘ç›’ã€‚</li></ul><p>æˆ‘ä»¬åœ¨æ­Œé¢‚ç¼–è¯‘å¼çš„æ–¹æ¡ˆï¼Œèƒ½ç»™æˆ‘ä»¬å¸¦æ¥å¤šå¤§çš„æ€§èƒ½æå‡ã€å¸¦æ¥å¤šä¹ˆç®€æ´çš„è¯­æ³•çš„åŒæ—¶ã€‚å¦ä¸€æ–¹é¢ï¼Œä¸€æ—¦æˆ‘ä»¬è¿›è¡Œè°ƒè¯•/ä¼˜åŒ–ï¼Œæˆ‘ä»¬ä¸å¾—ä¸è·¨è¶Šè¿™å±‚ Gapï¼Œå»äº†è§£å®ƒè½¬æ¢çš„é€»è¾‘å’Œåº•å±‚å®ç°ã€‚</p><p>è¿™æ˜¯ä¸€ä»¶æŒºçŸ›ç›¾çš„äº‹æƒ…ï¼Œå½“æˆ‘ä»¬ã€Œç²¾é€šã€è¿™äº›æ¡†æ¶çš„æ—¶å€™ï¼Œä¼°è®¡æˆ‘ä»¬å·²ç»æ˜¯ä¸€ä¸ª<code>äººè‚‰ç¼–è¯‘å™¨</code>äº†ã€‚</p><p>Taro 2.x é…åˆå°ç¨‹åºï¼Œ è¿™å¯¹å§é¾™å‡¤é›, å¯ä»¥å°†æ•´ä¸ªå¼€å‘ä½“éªŒæ‹‰åˆ°åœ°å¹³çº¿ä»¥ä¸‹ã€‚</p><p><br></p><p>å›åˆ°è¿™äº›ã€æ¬¡ä¸–ä»£ã€æ¡†æ¶ã€‚React/Vue/Angular è¿™äº›æ¡†æ¶å…ˆå…¥ä¸ºä¸»ï¼Œ åœ¨å®ƒä»¬çš„æ•™è‚²ä¸‹ï¼Œæˆ‘ä»¬å¯¹å‰ç«¯è§†å›¾å¼€å‘çš„æ¦‚å¿µå’Œç¼–ç¨‹èŒƒå¼çš„è®¤çŸ¥å·²ç»å›ºåŒ–ã€‚</p><p><img src="/images/fe-view-future/Untitled%202.png" alt="Untitled"></p><p>æ¯”å¦‚åœ¨ç¬”è€…çœ‹æ¥ Svelte æ˜¯è¿æ³•ç›´è§‰çš„ã€‚å› ä¸º JavaScript æœ¬èº«å¹¶ä¸æ”¯æŒè¿™ç§è¯­ä¹‰ã€‚Svelte è¦æ”¯æŒè¿™ç§è¯­ä¹‰éœ€è¦ä¸€ä¸ªç¼–è¯‘å™¨ï¼Œè€Œä½œä¸ºä¸€ä¸ª JavaScript å¼€å‘è€…ï¼Œæˆ‘ä¹Ÿéœ€è¦è¿›è¡Œå¿ƒæ™ºä¸Šçš„è½¬æ¢ã€‚</p><p>è€Œ SolidJS åˆ™å¥½å¾ˆå¤šï¼Œç›®ä¹‹æ‰€åŠéƒ½æ˜¯æˆ‘ä»¬ç†ŸçŸ¥çš„ä¸œè¥¿ã€‚å°½ç®¡ç¼–è¯‘åå¯èƒ½æ˜¯ä¸€ä¸ªå®Œå…¨ä¸ä¸€æ ·çš„ä¸œè¥¿ã€‚</p><blockquote><p>ğŸ’¡ Vue æ›¾ç»ä¹Ÿè¿‡ä¸€ä¸ªåä¸º<strong><a href="https://cn.vuejs.org/guide/extras/reactivity-transform.html" target="_blank" rel="noopener">å“åº”æ€§è¯­æ³•ç³–</a></strong>çš„å®éªŒæ€§åŠŸèƒ½æ¥æ¢ç´¢è¿™ä¸ªæ–¹å‘ï¼Œä½†æœ€åç”±äº<strong><a href="https://github.com/vuejs/rfcs/discussions/369#discussioncomment-5059028" target="_blank" rel="noopener">è¿™ä¸ªåŸå› </a></strong>ï¼ŒåºŸå¼ƒäº†ã€‚è¿™æ˜¯ä¸€æ¬¡æ˜æ™ºçš„å†³å®š</p></blockquote><p>å½“ç„¶ï¼Œå¹´è½»çš„æ¬¡ä¸–ä»£çš„å‰ç«¯å¼€å‘è€…å¯èƒ½ä¸è¿™ä¹ˆè®¤ä¸ºï¼Œä»–ä»¬æ¯•ç«Ÿæ²¡æœ‰ç»è¿‡æ—§ä¸–ä»£æ¡†æ¶çš„å…ˆå…¥ä¸ºä¸»å’Œæ´—ç¤¼ï¼Œä»–ä»¬æ›´èƒ½æ¥å—æ–°çš„å¼€å‘èŒƒå¼ï¼Œç„¶åæ‰›èµ·è¿™äº›æ——å¸œï¼Œè®©å®ƒä»¬æˆä¸ºæœªæ¥ä¸»æµã€‚</p><p>æ€»ç»“ã€‚çº¯ç¼–è¯‘çš„æ–¹èƒ½å¯ä»¥å¸¦æ¥æ›´ç®€æ´çš„è¯­æ³•ã€æ›´å¤šæ€§èƒ½ä¼˜åŒ–çš„ç©ºé—´ï¼Œç”šè‡³ä¹Ÿå¯ä»¥éšè—ä¸€äº›è·¨å¹³å°/å…¼å®¹æ€§çš„ç»†èŠ‚ã€‚å¦ä¸€æ–¹é¢ï¼Œæºç å’Œå®é™…ç¼–è¯‘ç»“æœä¹‹é—´çš„ Gapï¼Œå¯èƒ½ä¼šé€¼è¿«å¼€å‘è€…æˆä¸ºäººè‚‰ç¼–è¯‘å™¨ï¼Œå°¤å…¶åœ¨å¤æ‚çš„åœºæ™¯ï¼Œå¯¹å¼€å‘è€…çš„å¿ƒæ™ºè´Ÿæ‹…å¯èƒ½æ˜¯ç¿»å€çš„ã€‚</p><p>å¯¹äºæ¡†æ¶å¼€å‘è€…æ¥è¯´ï¼Œçº¯ç¼–è¯‘çš„æ–¹æ¡ˆå®ç°å¤æ‚åº¦ä¼šæ›´é«˜ï¼Œè¿™ä¹Ÿæ„å‘³ç€ï¼Œä¼šæœ‰è¾ƒé«˜è´¡çŒ®é—¨æ§›ï¼Œé—´æ¥ä¹Ÿä¼šå½±å“ç”Ÿæ€ã€‚</p><p><br><br><br><br><br></p><h2 id="å»-javascript"><a href="#å»-javascript" class="headerlink" title="å» JavaScript"></a>å» JavaScript</h2><p>é™¤äº†ç²¾ç»†åŒ–æ¸²æŸ“ï¼ŒWeb åº”ç”¨çš„é¦–å±ä½“éªŒä¹Ÿæ˜¯æ¡†æ¶å†…å·çš„é‡è¦æ–¹å‘ï¼Œè¿™ä¸ªä¸»è¦çš„å‘å±•è„‰ç»œï¼Œç¬”è€…åœ¨ <a href="https://juejin.cn/post/7241027834490437669" target="_blank" rel="noopener">ç°ä»£å‰ç«¯æ¡†æ¶çš„æ¸²æŸ“æ¨¡å¼</a> ä¸€æ–‡å·²ç»è¯¦ç»†ä»‹ç»ï¼Œæ¨èå¤§å®¶è¯»ä¸€ä¸‹ï¼š</p><p><img src="/images/fe-view-future/Untitled%203.png" alt="Untitled"></p><p>è¿™ä¸ªæ–¹å‘çš„å¼ºæœ‰åŠ›çš„ä»£è¡¨ä¸»è¦æœ‰ Astro(Island Architecture å²›å±¿æ¶æ„)ã€Next.js(React Server Component)ã€Qwik(Resumable å» Hydration)ã€‚</p><p>è¿™äº›æ¡†æ¶åŸºæœ¬éƒ½æ˜¯ç§‰æ‰¿ SSR ä¼˜å…ˆï¼Œåœ¨é¦–å±çš„åœºæ™¯ï¼ŒJavaScript æ˜¯ã€Œæœ‰å®³ã€çš„ï¼Œä¸ºäº†å°½é‡æ›´å°‘åœ°å‘æµè§ˆå™¨ä¼ é€’ JavaScriptï¼Œä»–ä»¬ç»å°½è„‘æ± ï¼š</p><ul><li>Astroï¼šâ€™é™æ€ HTMLâ€˜ä¼˜å…ˆï¼Œå¦‚æœæƒ³è¦ SPA ä¸€æ ·å®ç°å¤æ‚çš„äº¤äº’ï¼Œå¯ä»¥ç”³è¯·å¼€å¯ä¸€ä¸ªå²›å±¿ï¼Œè¿™ä¸ªå²›å±¿æ”¯æŒåœ¨å®¢æˆ·ç«¯è¿›è¡Œæ°´åˆå’Œæ¸²æŸ“ã€‚ä½ å¯ä»¥æŠŠå²›å±¿æƒ³è±¡æˆä¸€ä¸ª iframe ä¸€æ ·çš„ç©æ„ã€‚</li><li>React Server Component: åˆ’åˆ†æœåŠ¡ç«¯ç»„ä»¶å’Œå®¢æˆ·ç«¯ç»„ä»¶ï¼ŒæœåŠ¡ç«¯ç»„ä»¶ä»…åœ¨æœåŠ¡ç«¯è¿è¡Œï¼Œå®¢æˆ·ç«¯åªä¼šçœ‹åˆ°å®ƒçš„æ¸²æŸ“ç»“æœï¼ŒJavaScript æ‰§è¡Œä»£ç è‡ªç„¶ä¹Ÿä»…å­˜äºæœåŠ¡ç«¯ã€‚</li><li>Qwikï¼šæˆ‘è¦ç›´æ¥é©äº†æ°´åˆ(Hydration)çš„å‘½ï¼Œæˆ‘ä¸éœ€è¦æ°´åˆï¼Œéœ€è¦äº¤äº’çš„æ—¶å€™ï¼Œæˆ‘æƒ°æ€§ä»æœåŠ¡ç«¯æ‹‰å–äº‹ä»¶å¤„ç†å™¨ä¸å°±å¯ä»¥äº†â€¦</li></ul><p>ä¸å¾—ä¸è¯´ï¼Œã€Œå» JavaScriptã€çš„å„ç§è„‘æ´è¦æœ‰æ„æ€å¤šäº†ã€‚</p><p><br><br><br></p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æœ¬æ–‡ä¸»è¦è®²äº†æ¬¡ä¸–ä»£å‰ç«¯æ¡†æ¶çš„å†…å·æ–¹å‘ï¼Œç›®å‰æ¥çœ‹è¿˜å¤„äºé‡å˜çš„é˜¶æ®µï¼Œå¹¶æ²¡æœ‰è„±ç¦»ç°åœ¨ä¸»æµæ¡†æ¶çš„å¿ƒæ™ºæ¨¡å‹ï¼Œå› æ­¤æˆ‘ä»¬ä¸Šæ‰‹èµ·æ¥åŸºæœ¬ä¸ä¼šæœ‰éšœç¢ã€‚</p><p>ä½œä¸ºæ™®é€šå¼€å‘è€…ï¼Œæˆ‘ä»¬å¯ä»¥ç«™åœ¨æ›´é«˜çš„è§’åº¦å»å®¡è§†è¿™äº›æ¡†æ¶çš„å‘å±•ï¼Œé¿å…éšæ³¢é€æµå’Œæ— æ„ä¹‰çš„å†…å·ã€‚</p><p><br><br><br></p><h1 id="æ‰©å±•é˜…è¯»"><a href="#æ‰©å±•é˜…è¯»" class="headerlink" title="æ‰©å±•é˜…è¯»"></a>æ‰©å±•é˜…è¯»</h1><ul><li><a href="https://zhuanlan.zhihu.com/p/597473358" target="_blank" rel="noopener">æ–°æ—¶ä»£çš„ SSR æ¡†æ¶ç ´å±€è€…ï¼š<em>qwik</em></a></li><li><a href="https://cn.vuejs.org/guide/extras/rendering-mechanism.html" target="_blank" rel="noopener">Vue æ¸²æŸ“æœºåˆ¶</a></li><li><a href="https://cn.vuejs.org/guide/extras/reactivity-in-depth.html" target="_blank" rel="noopener">Vue æ·±å…¥å“åº”å¼ç³»ç»Ÿ</a></li><li><a href="https://2022.stateofjs.com/zh-Hans/libraries/front-end-frameworks/" target="_blank" rel="noopener">State of JavaScript</a></li><li><a href="https://juejin.cn/post/6844903865926549511" target="_blank" rel="noopener">æµ…è°ˆ React æ€§èƒ½ä¼˜åŒ–çš„æ–¹å‘</a></li><li><a href="https://zhuanlan.zhihu.com/p/350507037" target="_blank" rel="noopener">æ–°å…´å‰ç«¯æ¡†æ¶ Svelte ä»å…¥é—¨åˆ°åŸç†</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;img src=&quot;/images/fe-view-future/Untitled.png&quot; alt=&quot;state of JavaScript 2022 æ»¡æ„åº¦æ’å&quot;&gt;&lt;/p&gt;
&lt;p&gt;state of JavaScript 2022 æ»¡æ„åº¦æ’å&lt;/p&gt;
&lt;p&gt;ä¸Šå›¾æ˜¯ &lt;a 
      
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://bobi.ink/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>å…¨æ–° JavaScript è£…é¥°å™¨å®æˆ˜ä¸‹ç¯‡ï¼šå®ç°ä¾èµ–æ³¨å…¥</title>
    <link href="https://bobi.ink/2023/06/30/decorator-2/"/>
    <id>https://bobi.ink/2023/06/30/decorator-2/</id>
    <published>2023-06-29T16:00:00.000Z</published>
    <updated>2023-06-30T08:43:56.329Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/images/decorator-2/Untitled.jpeg" alt="cover"></p><p><br></p><p>ç³»åˆ—æ–‡ç« ï¼š</p><ul><li><a href="https://www.notion.so/Javascript-MobX-Vue-5e1c633167094d9784e602d66a5877f8?pvs=21" target="_blank" rel="noopener">å…¨æ–° Javascript è£…é¥°å™¨å®æˆ˜ä¸Šç¯‡ï¼šç”¨ MobX çš„æ–¹å¼æ‰“å¼€ Vue </a></li><li><a href="https://www.notion.so/JavaScript-0729df8081ec44b48f6f2e6ec7835120?pvs=21" target="_blank" rel="noopener">å…¨æ–° JavaScript è£…é¥°å™¨å®æˆ˜ä¸‹ç¯‡ï¼šå®ç°ä¾èµ–æ³¨å…¥</a></li></ul><p>ä¸Šä¸€ç¯‡<a href="https://www.notion.so/Javascript-MobX-Vue-5e1c633167094d9784e602d66a5877f8?pvs=21" target="_blank" rel="noopener">æ–‡ç« </a>æˆ‘ä»¬ä»‹ç»äº† JavaScript æœ€æ–°çš„è£…é¥°å™¨ææ¡ˆï¼Œä»¥åŠå®ƒå’Œæ—§ç‰ˆçš„åŒºåˆ«ã€‚è¿™ç¯‡æ–‡ç« æˆ‘ä»¬å°†ç»§ç»­æ·±å…¥è£…é¥°å™¨ï¼Œå°è¯•å®ç°ä¸€ä¸ªç®€æ˜“çš„ä¾èµ–æ³¨å…¥åº“ã€‚</p><p><br></p><p>è°ˆåˆ°è£…é¥°å™¨æˆ‘ä»¬æ€»ä¼šå¬åˆ° <code>reflect-metadata</code>, å°¤å…¶æ˜¯ç¤¾åŒºä¸Šçš„ä¾èµ–æ³¨å…¥åº“ï¼Œæ¯”å¦‚ <a href="https://github.com/inversify/InversifyJS" target="_blank" rel="noopener">inversify.js</a></p><p><br></p><p><img src="/images/decorator-2/Untitled.png" alt="inversify.js"></p><p><br></p><p><strong>æˆ‘ä»¬åœ¨ä¸Šä¸€ç¯‡æ–‡ç« çš„è£…é¥°å™¨å®ç°ä¸­ï¼Œä¼šç›´æ¥å»è½¬æ¢æˆ–è€…ä¿®æ”¹ç±»çš„ç»“æ„ï¼Œå¤§éƒ¨åˆ†åœºæ™¯è¿™å¹¶ä¸æ˜¯æœ€ä½³å®è·µã€‚</strong></p><p><strong>å¤§éƒ¨åˆ†æƒ…å†µä¸‹æˆ‘ä»¬åº”è¯¥åˆ©ç”¨è£…é¥°å™¨æ¥æ”¶é›†ä¸€äº›æ ‡æ³¨ä¿¡æ¯</strong>ï¼Œæ¯”å¦‚ MobX ç”¨è£…é¥°å™¨æ¥æ ‡æ³¨å“ªäº›æ˜¯ observableã€å“ªäº›æ˜¯ computedï¼›Inversify.js ç”¨ inject æ ‡æ³¨å“ªäº›å±æ€§éœ€è¦è¿›è¡Œæ³¨å…¥ï¼›Angular.js ä½¿ç”¨ Input/Output æ ‡è®°å±æ€§â€¦.</p><p>å¦‚æœæˆ‘ä»¬è¦é€šè¿‡è£…é¥°å™¨æ¥æ ‡è®°ç±»çš„åŸä¿¡æ¯ï¼Œé‚£å°±å¾—æ¥è®¤è¯†ä¸€ä¸‹ï¼šè£…é¥°å™¨çš„å¥½æ­å­ <code>reflect-metadata</code> ã€‚</p><p><br><br><br><br><br></p><h2 id="di-åº“ç»å¸¸æåŠçš„-reflect-metadata-åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#di-åº“ç»å¸¸æåŠçš„-reflect-metadata-åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="DI åº“ç»å¸¸æåŠçš„ reflect-metadata åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ"></a>DI åº“ç»å¸¸æåŠçš„ reflect-metadata åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>è¿™æ˜¯ä¸€ä¸ª JavaScript ææ¡ˆï¼Œä½†æ˜¯ä½œè€…å¹¶æ²¡æœ‰<a href="https://github.com/rbuckton/reflect-metadata/issues/96" target="_blank" rel="noopener">å°†å…¶æäº¤åˆ° TC39</a>ã€‚å®ƒçš„ç»§ä»»è€…ç°åœ¨æ˜¯ <a href="https://github.com/tc39/proposal-decorator-metadata" target="_blank" rel="noopener">Decorator Metadata</a>ï¼Œç°åœ¨å·²ç»è¿›å…¥äº† Stage 3 é˜¶æ®µï¼ŒTypescript ä¹Ÿå°†åœ¨ 5.2 ä¸­å®ç°è¿™ä¸ªææ¡ˆã€‚</p><p>Decorator Metadata ä¼šåœ¨ä¸‹æ–‡è¯¦ç»†ä»‹ç»ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ reflect-metadataã€‚</p><p>å…ˆæ¥çœ‹çœ‹ä½¿ç”¨å®ƒèƒ½ç”¨æ¥å¹²å•¥ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">test(&apos;reflect-metadata&apos;, () =&gt; &#123;</span><br><span class="line">  const key = &apos;myKey&apos;</span><br><span class="line"></span><br><span class="line">  // ğŸ”´ è£…é¥°å™¨è¯­æ³•</span><br><span class="line">  @Reflect.metadata(key, &apos;inClass&apos;)</span><br><span class="line">  class Foo &#123;</span><br><span class="line">    @Reflect.metadata(key, &apos;inStaticMember&apos;)</span><br><span class="line">    static staticMember = 1</span><br><span class="line"></span><br><span class="line">    @Reflect.metadata(key, &apos;inMember&apos;)</span><br><span class="line">    member = 2</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // ğŸ”´ ä¸Šè¿°è£…é¥°å™¨ç­‰ä»·äº</span><br><span class="line">  Reflect.defineMetadata(key, &apos;inClass&apos;, Foo)</span><br><span class="line">  Reflect.defineMetadata(key, &apos;inStaticMember&apos;, Foo, &apos;staticMember&apos;)</span><br><span class="line">  Reflect.defineMetadata(key, &apos;inMember&apos;, Foo.prototype, &apos;member&apos;)</span><br><span class="line"></span><br><span class="line">  // ğŸ”´ é™æ€æˆå‘˜</span><br><span class="line">  expect(Reflect.getMetadata(key, Foo)).toBe(&apos;inClass&apos;)</span><br><span class="line">  expect(Reflect.getMetadata(key, Foo, &apos;staticMember&apos;)).toBe(&apos;inStaticMember&apos;)</span><br><span class="line"></span><br><span class="line">  // ğŸ”´ å®ä¾‹æˆå‘˜ï¼Œ**éœ€è¦é€šè¿‡å®ä¾‹è·å–**</span><br><span class="line">  expect(Reflect.getMetadata(key, Foo, &apos;member&apos;)).toBeUndefined()</span><br><span class="line">  const foo = new Foo()</span><br><span class="line">  expect(Reflect.getMetadata(key, foo, &apos;member&apos;)).toBe(&apos;inMember&apos;)</span><br><span class="line">  // æˆ–è€…é€šè¿‡åŸå‹å¯¹è±¡è·å–</span><br><span class="line">  expect(Reflect.getMetadata(key, Foo.prototype, &apos;member&apos;)).toBe(&apos;inMember&apos;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><br><br><br></p><p>é€šè¿‡ä¸Šé¢çš„ ã€Œhello worldã€ æˆ‘ä»¬å¯ä»¥å‘ç°ï¼š</p><ol><li>å¯ä»¥ä½œä¸º<code>è£…é¥°å™¨</code>ä½¿ç”¨ã€‚è¿™ä¸ªè¡¨ç¤ºè¿™ä¸ªææ¡ˆå’Œè£…é¥°å™¨æœ‰ä¸è§£çš„æ¸Šæºï¼Œæ‰€ä»¥å½“æˆ‘ä»¬è°ˆåŠè£…é¥°å™¨çš„æ—¶å€™ï¼Œæ€»ä¼šçœ‹åˆ°å®ƒçš„èº«å½±ã€‚</li><li>å…ƒæ•°æ®? æ²¡é‚£ä¹ˆé«˜å¤§ä¸Šï¼Œå°±æ˜¯ä¸€äº› key/value å­˜å‚¨</li><li>æ‰©å±•äº† Reflect APIï¼Ÿä¸ºä»€ä¹ˆæ˜¯ Reflect API?</li><li>å…³äºå­˜å‚¨ä½ç½®ï¼Œç±»å’Œé™æ€æˆå‘˜å­˜å‚¨åœ¨ç±»ä¸Šï¼Œå®ä¾‹æˆå‘˜å­˜å‚¨åœ¨ç±»çš„åŸå‹ä¸Š(prototype)</li></ol><p><br></p><p>é€šè¿‡ä¸Šé¢çš„çš®æ¯›ï¼Œæˆ‘ä»¬ GET ä¸åˆ°å®ƒè¦è§£å†³ç—›ç‚¹æ˜¯å•¥ã€‚ä¸å°±æ˜¯å­˜å‚¨ä¸€äº›å…ƒæ•°æ®å˜›ï¼Œæˆ‘ä»¬ä¸éœ€è¦è¿™ä¸ª API ä¹Ÿå¯ä»¥åšåˆ°ï¼Œæ¯”å¦‚ MobX çš„è£…é¥°å™¨å°±æ˜¯æ”¾åœ¨åŸå‹ä¸Šçš„ä¸€ä¸ªéšè—è‡ªå®šä¹‰å±æ€§ä¸Šï¼š</p><p><br></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">export function storeAnnotation(prototype: any, key: PropertyKey, annotation: Annotation) &#123;</span><br><span class="line">  if (!hasProp(prototype, storedAnnotationsSymbol)) &#123;</span><br><span class="line">    addHiddenProp(prototype, storedAnnotationsSymbol, &#123;</span><br><span class="line">      // Inherit annotations</span><br><span class="line">      ...prototype[storedAnnotationsSymbol],</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  // ....</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br><br><br><br><br></p><p>å®é™…ä¸Šè¿™ä¸ªæ¦‚å¿µæ˜¯ä»å…¶ä»–è¯­è¨€å€Ÿé‰´çš„ï¼Œæ¯”å¦‚ä¸‹é¢ Java Spring ä¾èµ–æ³¨å…¥ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MovieRecommender</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> CustomerPreferenceDao customerPreferenceDao;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">MovieRecommender</span><span class="params">(CustomerPreferenceDao customerPreferenceDao)</span> </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.customerPreferenceDao = customerPreferenceDao;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ Java ä¸­ï¼Œå¯ä»¥é€šè¿‡å®ƒçš„ <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/package-summary.html" target="_blank" rel="noopener">Reflect API</a> å¯ä»¥è·å–åˆ°ç±»çš„<code>ç±»å‹ä¿¡æ¯</code>ï¼Œæ¯”å¦‚æ–¹æ³•ã€æ–¹æ³•çš„å‚æ•°ã€è¿”å›å€¼ç­‰ç±»å‹ä¿¡æ¯ã€‚</p><p>ç„¶è€Œï¼ŒJavaScript æ˜¯ä¸€é—¨å¼±ç±»å‹è¯­è¨€ï¼Œæ²¡æœ‰è¿™ç±»ä¿¡æ¯ã€‚æ‰€ä»¥æˆ‘ä»¬åœ¨å®ç°<code>ä¾èµ–æ³¨å…¥</code>æ—¶ï¼Œå¹¶ä¸èƒ½åšåˆ°åƒ Java é‚£ä¹ˆå¼ºå¤§ï¼š</p><p><br></p><p>Java:</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Engine</span> </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Autowired</span></span><br><span class="line">  <span class="keyword">private</span> Engine engine;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      engine.turnOn();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>vs Typescript</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">interface Engine &#123;&#125;</span><br><span class="line"></span><br><span class="line">@injectable()</span><br><span class="line">class Car &#123;</span><br><span class="line">  @inject(&apos;EngineKey&apos;)</span><br><span class="line">  private engine: Engine</span><br><span class="line">  start() &#123;</span><br><span class="line">    this.engine.turnOn()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p><strong>Java Spring å¯ä»¥è‡ªåŠ¨æ¨æ–­ç±»å‹æ¥è¿›è¡Œæ³¨å…¥</strong>ï¼Œè¿™ä¸ªç±»å‹å¯ä»¥æ˜¯æ¥å£ã€å…·ä½“çš„ç±»ã€æŠ½è±¡ç±»ç­‰ç­‰ã€‚è€Œç°åœ¨ JavaScript ä¸‹çš„ DI åº“ï¼Œæˆ‘ä»¬é€šå¸¸éœ€è¦æ˜¾å¼æŒ‡å®šä¸€ä¸ªæ ‡è¯†ç¬¦ï¼Œæˆ–è€…åªèƒ½æ˜¯ä¸€ä¸ªå…·ä½“çš„ç±»(ä¸æ”¯æŒæ¥å£)ï¼Œ ä¸€ç‚¹ä¹Ÿä¸å¤Ÿä¼˜é›…ã€‚</p><p>æ—¢ç„¶ç°åœ¨æœ‰äº† <code>Typescript</code> ï¼Œèƒ½ä¸èƒ½åšåˆ°å‘¢ï¼ŸTypescript æœ€ç»ˆä¹Ÿæ˜¯è½¬æ¢ä¸º JavaScript ï¼Œé»˜è®¤æƒ…å†µä¸‹<code>ç±»å‹ä¿¡æ¯</code>éƒ½ä¼šè¢«è£å‡æ‰ã€‚</p><p>è€Œ reflect-metadata çš„åˆè¡·è¿˜æ˜¯æƒ³å°† Java/C# è¿™ç±»è¯­è¨€çš„ Reflect èƒ½åŠ›å¸¦åˆ° JavaScriptã€‚<strong>å› æ­¤å°±æ‹Ÿå®šäº†è¿™æ ·ä¸€ä¸ªåè®®ï¼Œ è®© Typescript æˆ–è€…å…¶ä»–è½¬è¯‘åˆ° JavaScript å¼ºç±»å‹è¯­è¨€ï¼Œå¯ä»¥é€šè¿‡å®ƒå°†ç±»å‹ä¿¡æ¯ä¿ç•™ä¸‹æ¥ã€‚</strong></p><p><br></p><p>æ‰€ä»¥æˆ‘ä»¬çœ‹åˆ° Typescript æ˜¯å®ƒçš„ä¸»è¦æ¨åŠ¨è€…ã€‚æˆ‘ä»¬åœ¨ Typescript ä¸­å¯ä»¥é€šè¿‡å¼€å¯ <code>emitDecoratorMetadata</code> å®ç°è£…é¥°å™¨ç±»å‹ä¿¡æ¯çš„ä¿ç•™:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">interface Bar &#123;&#125;</span><br><span class="line"></span><br><span class="line">@d</span><br><span class="line">class Foo &#123;</span><br><span class="line">  @d</span><br><span class="line">  static staticMember = 1</span><br><span class="line"></span><br><span class="line">  @d</span><br><span class="line">  member = 2</span><br><span class="line"></span><br><span class="line">  @d</span><br><span class="line">  method(foo: number, bar: Bar, baz: Foo): string &#123;&#125;</span><br><span class="line"></span><br><span class="line">  constructor(a: Bar) &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è½¬æ¢ç»“æœï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var __metadata =</span><br><span class="line">  (this &amp;&amp; this.__metadata) ||</span><br><span class="line">  function (k, v) &#123;</span><br><span class="line">    if (typeof Reflect === &apos;object&apos; &amp;&amp; typeof Reflect.metadata === &apos;function&apos;)</span><br><span class="line">      return Reflect.metadata(k, v)</span><br><span class="line">  &#125;</span><br><span class="line">// çœç•¥éƒ¨åˆ†ä»£ç </span><br><span class="line">__decorate([d, __metadata(&apos;design:type&apos;, Object)], Foo.prototype, &apos;member&apos;, void 0)</span><br><span class="line">__decorate(</span><br><span class="line">  [</span><br><span class="line">    d,</span><br><span class="line">    __metadata(&apos;design:type&apos;, Function),</span><br><span class="line">    __metadata(&apos;design:paramtypes&apos;, [Number, Object, Foo]),</span><br><span class="line">    __metadata(&apos;design:returntype&apos;, String),</span><br><span class="line">  ],</span><br><span class="line">  Foo.prototype,</span><br><span class="line">  &apos;method&apos;,</span><br><span class="line">  null</span><br><span class="line">)</span><br><span class="line">__decorate([d, __metadata(&apos;design:type&apos;, Object)], Foo, &apos;staticMember&apos;, void 0)</span><br><span class="line">Foo = __decorate([d, __metadata(&apos;design:paramtypes&apos;, [Object])], Foo)</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çœ‹åˆ°å¤§éƒ¨åˆ†çš„ç±»å‹ä¿¡æ¯éƒ½ä¿ç•™ä¸‹æ¥äº†ï¼Œæ¯”å¦‚æˆå‘˜ç±»å‹ã€æ–¹æ³•çš„å‚æ•°/è¿”å›å€¼ç±»å‹ã€‚</p><p>ä½†æ˜¯å®ƒä¹Ÿæœ‰å±€é™æ€§ï¼Œæ¯”å¦‚æ¥å£ç­‰è‡ªå®šä¹‰ç±»å‹ä¾æ—§æ— æ³•ä¿ç•™ï¼Œæ¯•ç«Ÿ JavaScript å¹¶æ²¡æœ‰è¿™äº›æ¦‚å¿µã€‚è¿™ä¹Ÿç›´æ¥å†³å®šäº†ä¾æ—§æ— æ³•å’Œ Java è¿™ç§ã€ŒåŸç”Ÿã€å¼ºç±»å‹è¯­è¨€æ¯”è‚©ã€‚</p><p><br></p><blockquote><p>reflect-metadata å¯èƒ½ä»£è¡¨çš„æ˜¯ JavaScript ä½œä¸ºä¸€ä¸ªæ–°æ±‡ç¼–è¯­è¨€çš„è§‰æ‚Ÿï¼Œä½†æ˜¯ç›®å‰çš„äº‹å®ä¹Ÿè¯æ˜äº†è¿™æ¡è·¯æ¯”è¾ƒéš¾ã€‚å°±æ‹¿ Typescript æ¥è¯´ï¼Œä¿ç•™çš„ä¿¡æ¯æ¯”è¾ƒæœ‰é™ï¼Œè€Œä¸”è¿™ä¼šè®©å¼€å‘è€…çš„æŠ€æœ¯æ ˆä¸¥é‡ä¾èµ– Typescriptï¼Œå¦å¤–åƒ esbuildã€swcã€babel è¿™äº›è½¬è¯‘å™¨ä¹Ÿå¾ˆéš¾è·Ÿè¿›è¿™ç§ç‰¹æ€§ã€‚<br><br><br>å®é™…ä¸Šï¼Œç°åœ¨æµè¡Œçš„ DI åº“ï¼Œå¦‚ <code>inversify</code>ã€<code>tsyringe</code> å¯¹ Typescript <code>emitDecoratorMetadata</code> çš„ä¾èµ–ä¹Ÿå¾ˆå°ï¼Œå»æ‰åŸºæœ¬ä¸Šä¸å½±å“å…¶æœ‰æ•ˆè¿è¡Œã€‚</p></blockquote><blockquote></blockquote><p><br></p><p>æ€»ç»“, reflect-metadata è§†å›¾æä¾›ä¸€ä¸ªç±»(class)å…ƒä¿¡æ¯çš„å­˜å‚¨æ ‡å‡†ã€‚åœ¨ç¬”è€…å¼€æ¥ï¼Œä¸»è¦çš„æ„¿æ™¯æ˜¯ä¸ºä¸Šå±‚æ›´é«˜çº§çš„è¯­è¨€(æ¯”å¦‚ Typescript)ä¿ç•™é™æ€ç±»å‹ä¿¡æ¯æä¾›ä¸€ç§æ–¹å¼ã€‚å…¶æ¬¡ï¼Œæ™®é€šå¼€å‘è€…ä¹Ÿèƒ½ä½¿ç”¨è¿™ä¸ªæ ‡å‡†åŒ–çš„ API æ¥ç»™ç±»æ ‡æ³¨ä¿¡æ¯ã€‚</p><p><br><br><br><br><br></p><h2 id="decorator-metadata"><a href="#decorator-metadata" class="headerlink" title="Decorator Metadata"></a>Decorator Metadata</h2><p>å¦‚ä»Šçš„ Metadata ææ¡ˆå·²ç»ä»è£…é¥°å™¨ä¸­åˆ†ç¦»å‡ºæ¥ï¼Œç›®å‰ä¹Ÿè¿›å…¥äº† Stage 3 é˜¶æ®µã€‚ç»è¿‡é‡æ–°è®¾è®¡çš„ Metadata å’Œ reflect-metadata ä¸æ˜¯åŒä¸€ä¸ªç©æ„ã€‚</p><p>è¿™ä¸ªææ¡ˆéå¸¸ç®€å•ï¼Œå°±æ˜¯æ–°å¢äº†ä¸€ä¸ªå†…ç½® Symbol â€”â€” <code>Symbol.metadata</code>ã€‚åœ¨è£…é¥°å™¨çš„é…åˆå°†å…ƒæ•°æ®å­˜å‚¨åœ¨ç±»çš„ Symbol.metadata ä¸‹é¢:</p><p><br><br><br></p><p>é’ˆå¯¹è£…é¥°å™¨åè®®çš„æ‰©å±•:</p><figure class="highlight diff"><table><tr><td class="code"><pre><span class="line">type Decorator = (value: Input, context: &#123;</span><br><span class="line">  kind: string;</span><br><span class="line">  name: string | symbol;</span><br><span class="line">  access: &#123;</span><br><span class="line">    get?(): unknown;</span><br><span class="line">    set?(value: unknown): void;</span><br><span class="line">  &#125;;</span><br><span class="line">  isPrivate?: boolean;</span><br><span class="line">  isStatic?: boolean;</span><br><span class="line">  addInitializer?(initializer: () =&gt; void): void;</span><br><span class="line"><span class="addition">+ metadata?: Record&lt;string | number | symbol, unknown&gt;;</span></span><br><span class="line">&#125;) =&gt; Output | void;</span><br></pre></td></tr></table></figure><p><br></p><p>æ‰€æœ‰è£…é¥°å™¨çš„ context å¯¹è±¡æ–°å¢äº† metadata å¯¹è±¡ã€‚ metadata åªæ˜¯ä¸€ä¸ªæ™®é€šçš„å¯¹è±¡ï¼Œæ²¡ä»€ä¹ˆç‰¹åˆ«ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">function meta(key: string) &#123;</span><br><span class="line">  return (value: unknown, context: DecoratorContext) =&gt; &#123;</span><br><span class="line">    context.metadata![key] = true</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@meta(&apos;inClass&apos;)</span><br><span class="line">class Foo &#123;</span><br><span class="line">  @meta(&apos;inStaticMember&apos;)</span><br><span class="line">  static staticMember = 1</span><br><span class="line"></span><br><span class="line">  @meta(&apos;inMember&apos;)</span><br><span class="line">  member = 2</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// ç±»çš„æ‰€æœ‰è£…é¥°å™¨å…±äº«</span><br><span class="line">expect(Foo[Symbol.metadata]).toEqual(&#123;</span><br><span class="line">  inStaticMember: true,</span><br><span class="line">  inMember: true,</span><br><span class="line">  inClass: true,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><br><br><br></p><p>å°±æ˜¯è¿™ä¹ˆæœ´å®ä¸”æ— åã€‚å› ä¸º<strong>æ‰€æœ‰è£…é¥°å™¨éƒ½æ˜¯å…±äº«ä¸€ä¸ªå¯¹è±¡ç©ºé—´</strong>ï¼Œé¿å…å†²çªçš„èŒè´£å°±äº¤ç»™å¼€å‘è€…äº†ã€‚</p><p>å¤§æ¦‚æœ‰ä¸¤ç§æ–¹å¼ï¼š</p><ul><li>å‘½åç©ºé—´ã€‚æ¯”å¦‚å•çº¯ç”¨å­—ç¬¦ä¸² key <code>åº“åç§°.{æ˜¯å¦é™æ€}.{è£…é¥°å™¨ä½ç½®}.{å±æ€§å}</code>ï¼Œæˆ–è€…åˆ›å»ºä¸€ä¸ªç§æœ‰ Symbol æŒ‰åµŒå¥—çš„ç»“æ„å­˜å‚¨ã€‚</li><li><p>ç§æœ‰ç©ºé—´ã€‚ä»¥ä¸‹æ˜¯ MetaData ææ¡ˆä¸­çš„ä¾‹å­ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const PRIVATE_METADATA = new WeakMap();</span><br><span class="line"></span><br><span class="line">function meta(key, value) &#123;</span><br><span class="line">  return (_, context) =&gt; &#123;</span><br><span class="line">    let metadata = PRIVATE_METADATA.get(context.metadata);</span><br><span class="line"></span><br><span class="line">    if (!metadata) &#123;</span><br><span class="line">      metadata = &#123;&#125;;</span><br><span class="line">      PRIVATE_METADATA.set(context.metadata, metadata);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    metadata[key] = value;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@meta(&apos;a&apos; &apos;x&apos;)</span><br><span class="line">class C &#123;</span><br><span class="line">  @meta(&apos;b&apos;, &apos;y&apos;)</span><br><span class="line">  m() &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PRIVATE_METADATA.get(C[Symbol.metadata]).a; // &apos;x&apos;</span><br><span class="line">PRIVATE_METADATA.get(C[Symbol.metadata]).b; // &apos;y&apos;</span><br></pre></td></tr></table></figure></li></ul><p><br></p><p>Anywayï¼Œè§£å†³å‘½åå†²çªæœ‰æ— æ•°çš„åŠæ³•ã€‚</p><blockquote><p>ğŸ™‹  é‚£ <code>Typescript</code> çš„ <code>emitDecoratorMetadata</code> è¿˜æ”¯æŒå—ï¼Ÿæš‚æ—¶çœ‹åˆ°ç›¸å…³çš„è®¡åˆ’</p></blockquote><p><br><br><br><br><br></p><h2 id="ç®€å•ç†è§£ä¾èµ–æ³¨å…¥"><a href="#ç®€å•ç†è§£ä¾èµ–æ³¨å…¥" class="headerlink" title="ç®€å•ç†è§£ä¾èµ–æ³¨å…¥"></a>ç®€å•ç†è§£ä¾èµ–æ³¨å…¥</h2><p>ç°åœ¨å¼€å§‹å®æˆ˜éƒ¨åˆ†ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦äº†è§£ä¸€ä¸‹ä»€ä¹ˆæ˜¯ä¾èµ–æ³¨å…¥ï¼š</p><p><img src="/images/decorator-2/Untitled%201.png" alt="di"></p><p>ç†è§£ä¾èµ–æ³¨å…¥ï¼Œéœ€è¦ææ¸…æ¥šä»¥ä¸‹å‡ ä¸ªæ¦‚å¿µï¼š</p><ul><li><strong>æ¥å£(interface)ã€‚</strong>æ¥å£æ˜¯ä¸€ä¸ªåè®®ï¼Œæˆ–è€…æ˜¯ä¸€ä¸ªéœ€æ±‚ã€‚è¿™ä¸ªç”±â€™ç”²æ–¹â€˜æå‡ºæ¥ï¼Œæ¯”å¦‚æˆ‘ä»¬è¦ä¸€ä¸ªæ‰‹æœºï¼Œé‚£ä¹ˆèƒ½â€œæ‰“ç”µè¯â€ã€â€å‘çŸ­ä¿¡â€, å°±æ˜¯éœ€æ±‚ã€‚æ¥å£æ˜¯ä¸€ä¸ªæŠ½è±¡çš„ä¸œè¥¿ï¼Œå¹¶ä¸æ˜¯å…·ä½“çš„å®ç°ã€‚å¯¹äºæ¶ˆè´¹è€…æ¥è¯´å®ƒå¹¶ä¸å…³å¿ƒçš„å†…éƒ¨ç»†èŠ‚ã€æ˜¯æ€ä¹ˆåˆ¶é€ å‡ºæ¥çš„ã€‚</li><li><strong>å®ç°(implements)</strong>ã€‚æ»¡è¶³æ¥å£éœ€æ±‚çš„å…·ä½“å®ç°ï¼Œæ¯”å¦‚â€œæ‰‹æœºâ€è¿™ä¸ªæ¥å£çš„å®ç°ï¼Œå¯ä»¥æ˜¯ iphoneã€å°ç±³æ‰‹æœºã€åä¸ºæ‰‹æœºç­‰ç­‰ã€‚</li><li><strong>ä¾èµ–æ³¨å…¥</strong>ã€‚ä¾èµ–æ³¨å…¥çš„æ„æ€å°±æ˜¯<code>éœ€æ±‚è€…</code>æè¿°å¥½è‡ªå·±çš„<code>éœ€æ±‚</code>ï¼Œç„¶åç”±<code>ç»é”€å•†</code>æ¥æŸ¥æ‰¾<strong>ç¬¦åˆéœ€æ±‚</strong>çš„<code>å®ç°</code>ï¼Œç»™åˆ°éœ€æ±‚è€…ã€‚éœ€æ±‚è€…ä»å¤´åˆ°å°¾ï¼Œä¸ä¼šå»å…³å¿ƒè¿™ä¸ªéœ€æ±‚æ˜¯æ€ä¹ˆå»å®ç°çš„ï¼Œå®ƒåªå…³å¿ƒå®ƒè‡ªå·±è¦å¹²çš„äº‹æƒ…ã€‚</li><li><strong>ä¸‰ç§è§’è‰²</strong>:<ul><li><code>éœ€æ±‚è€…</code>ã€‚æˆ–è€…è¯´<code>æ¶ˆè´¹è€…</code></li><li><code>ç»é”€å•†</code>(å®¹å™¨)ã€‚æˆ‘ä»¬ä¹Ÿç§°ä¸ºå®¹å™¨ï¼Œä»–è´Ÿè´£åè°ƒéœ€æ±‚å’Œå®ç°ã€‚</li><li><code>ä¾›åº”å•†</code>ã€‚éœ€æ±‚çš„å…·ä½“å®ç°è€…ã€‚</li></ul></li></ul><p><br><br><br></p><p>å¯ä»¥é€šè¿‡ä¸€ä¸ªä¾‹å­(æ¥æº<a href="https://www.notion.so/wakeapp-framework-b08cb3cb5f8e49f597aa90bbb89a1641?pvs=21" target="_blank" rel="noopener">è¿™é‡Œ</a>)æ¥ç†è§£ä¸€ä¸‹ï¼š</p><p><br></p><ol><li><p>å®šä¹‰éœ€æ±‚(åè®®)</p><p>é¦–å…ˆå®šä¹‰éœ€æ±‚ï¼Œæè¿°æˆ‘ä»¬æœŸæœ›å¾—åˆ°ä¸€ä¸ªæ€æ ·çš„ä¸œè¥¿ã€‚</p><p>éœ€æ±‚é€šå¸¸ä½¿ç”¨ <code>interface</code> æ¥æè¿°ï¼Œå½“ç„¶ï¼Œè¿™å¹¶æ²¡æœ‰é™åˆ¶ã€‚ä½ è¦ä¸€ä¸ªç±»ä¹Ÿå¯ä»¥ã€å­—ç¬¦ä¸²ã€æ•°å­—ä¹Ÿå¯ä»¥ï¼Œå–å†³ä½ çš„éœ€æ±‚ã€‚</p><p>æ¯”å¦‚æˆ‘æƒ³è¦ä¸€ä¸ªæ‰‹æœº:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">interface IPhone &#123;</span><br><span class="line">  /**</span><br><span class="line">   * æ‰“ç”µè¯</span><br><span class="line">   */</span><br><span class="line">  call(num: string): void</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * å‘çŸ­ä¿¡</span><br><span class="line">   */</span><br><span class="line">  sendMessage(num: string, message: string): void</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨å†Œä½ çš„éœ€æ±‚å’Œæ ‡è¯†ç¬¦çš„ç»‘å®šå…³ç³»ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">declare global &#123;</span><br><span class="line">  interface DIMapper &#123;</span><br><span class="line">    &apos;DI.IPhone&apos;: IPhone</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>è¯·æ±‚æ³¨å…¥</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class WeChat &#123;</span><br><span class="line">  // æ³¨å…¥è¯·æ±‚</span><br><span class="line">  @inject(&apos;DI.IPhone&apos;)</span><br><span class="line">  myPhone: IPhone</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * æ‰“ç”µè¯è€å¦ˆ</span><br><span class="line">   */</span><br><span class="line">  callMom() &#123;</span><br><span class="line">    this.myPhone.call(&apos;137****110&apos;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>å®ç°éœ€æ±‚</p><p>æ¥ä¸‹æ¥å°±æ˜¯ä¾›åº”å•†æ¥å®ç°éœ€æ±‚äº†ã€‚é€šå¸¸ä½¿ç”¨ç±»æ¥å®ç°éœ€æ±‚ï¼š</p><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">@injectable()</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TheIPhone</span> <span class="title">implements</span> <span class="title">IPhone</span> </span>&#123;</span><br><span class="line">  call(num: string) &#123;</span><br><span class="line">    <span class="comment">// æ‹¨æ‰“ç”µè¯æµç¨‹</span></span><br><span class="line">  &#125;</span><br><span class="line">  sendMessage(num: string, <span class="attr">message</span>: string) &#123;</span><br><span class="line">    <span class="comment">// å‘é€çŸ­ä¿¡æµç¨‹</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>æ³¨å†Œå®ç°</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">configureDI((registerSingletonClass) =&gt; &#123;</span><br><span class="line">  registerSingletonClass(&apos;DI.IPhone&apos;, TheIPhone)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li></ol><p><br><br><br></p><p>å¦‚æœä½ ç†è§£äº†ä¸Šé¢çš„ä¾‹å­ï¼Œé‚£ä¹ˆä½ å·²ç»æ‡‚ä¾èµ–æ³¨å…¥äº†ã€‚ä¸è¿‡ï¼Œå½“ä½ æ¥è§¦åˆ°ä¾èµ–æ³¨å…¥çš„ç›¸å…³å®ç°åº“æ—¶ï¼Œè¿˜æœ‰å¬åˆ°è¿™äº›æ¦‚å¿µï¼š</p><ul><li><code>å®¹å™¨(Container)</code>ã€‚ å°±æ˜¯ä¸Šæ–‡æåˆ°çš„<code>ç»é”€å•†</code>ï¼Œç”¨æœ€ç®€å•æŠ€æœ¯æœ¯è¯­æ¥æè¿°çš„è¯ï¼Œä»–å°±æ˜¯ä¸€ä¸ª<code>å¯¹è±¡æ± </code>ã€‚ä»–è´Ÿè´£åè°ƒ<code>æ¶ˆè´¹è€…</code>éœ€æ±‚å’Œ<code>æä¾›å•†</code>çš„å®ç°ã€‚</li><li><code>ä½œç”¨åŸŸ(Scope)</code>ã€‚å°±æ˜¯å¯¹è±¡çš„å­˜æ´»æ—¶é—´å’Œæ´»åŠ¨èŒƒå›´<ul><li>å­˜æ´»æ—¶é—´ï¼šæ¯”è¾ƒå…¸å‹çš„æœ‰ singleton(å•ä¾‹)ã€request(è¯·æ±‚ï¼Œ è¿™ä¸ªä¸€å¥è¯è¯´ä¸æ¸…æ¥šï¼Œä½ å¯ä»¥ç±»æ¯”ä¸º ã€ŒHTTP è¯·æ±‚ã€ï¼Œè¿™äº›å¯¹è±¡ä»…åœ¨è¿™ä¸€æ¬¡ HTTP çš„è¯·æ±‚å‘¨æœŸå†…æœ‰æ•ˆ)ã€transient(ä¸´æ—¶ï¼Œå³æ¯æ¬¡ inject è¯·æ±‚éƒ½åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡)ã€‚å½“ç„¶ï¼Œæ ¹æ®å®é™…çš„åœºæ™¯è¿˜å¯ä»¥æ‰©å±•ï¼Œæ¯”å¦‚åœ¨ React ç»„ä»¶ç”Ÿå‘½å‘¨æœŸ</li><li>æ´»åŠ¨èŒƒå›´ï¼š å¾ˆå¤šä¾èµ–æ³¨å…¥åº“ä¸­ï¼Œå®¹å™¨ä¸æ˜¯ä¸€ä¸ªå•ä¸€çš„å¯¹è±¡ï¼Œè€Œæ˜¯ä¸€ä¸ªæ ‘çŠ¶çš„ç»“æ„ï¼Œå¦‚æœè¦é™åˆ¶æŸäº›å¯¹è±¡çš„æ´»åŠ¨èŒƒå›´ï¼Œæˆ–è€…è¦†ç›–å¯¹è±¡çš„å®ç°ï¼Œå¯ä»¥é€šè¿‡ Fork å­å®¹å™¨çš„å½¢å¼æ¥å®ç°éš”ç¦»ã€‚</li></ul></li><li><code>ç»‘å®š(binding)</code>ã€‚å³åè®®çš„ç»‘å®šï¼Œæ¯”å¦‚ä¸Šé¢çš„ä¾‹å­ä¸­æˆ‘ä»¬ä½¿ç”¨ <code>DI.IPhone</code> å­—ç¬¦ä¸²æ¥ç»‘å®šåè®®å’Œå®ç°ã€‚å…¶ä»–ç¼–ç¨‹è¯­è¨€å¯ä»¥åšå¾—æ›´åŠ çµæ´»ï¼Œåªéœ€è¦å£°æ˜ç±»å‹ï¼Œå®¹å™¨ä¼šæ ¹æ®ç±»å‹çš„å…¼å®¹æ€§æ¥åè°ƒæ³¨å…¥ã€‚</li></ul><p><br></p><p>å½“ç„¶ï¼Œä¸€ä¸ªç”Ÿäº§çº§åˆ«çš„ä¾èµ–æ³¨å…¥å®ç°è¿˜ä¼šæ¶‰åŠå¾ˆå¤šæŠ€æœ¯ç»†èŠ‚å’Œæ¦‚å¿µï¼Œæ¯”å¦‚å¾ªç¯ä¾èµ–ã€å¯¹è±¡æ„é€ å’Œææ„ã€å·¥å‚ã€å¼‚æ­¥åŠ è½½ã€å¯¹è±¡ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€ä¸­é—´ä»¶ã€æ ‡ç­¾(Tagged)ç­‰ç­‰ã€‚</p><p><br></p><p>ä¸è¿‡ä¸Šé¢æˆ‘ä»¬æŒæ¡çš„çŸ¥è¯†å·²ç»è¶³å¤Ÿè¦†ç›–æ­£å¸¸çš„å¼€å‘åœºæ™¯äº†ã€‚</p><p><br><br><br></p><p><strong>ä¾èµ–æ³¨å…¥çš„å¥½å¤„å°±ä¸å¤šè¯´äº†ï¼š</strong></p><ul><li>è§£è€¦ã€‚é¢å‘æ¥å£ç¼–ç¨‹ã€‚</li><li>å¯æ‰©å±•æ€§ã€‚æ¯ä¸ªä¾èµ–æ³¨å…¥çš„ç‚¹å°±æ˜¯ä¸€ä¸ªæ‰©å±•ç‚¹ã€‚</li><li>å¯æµ‹è¯•æ€§ã€‚å¯ä»¥è®©ç¨‹åºèŒè´£æ›´åŠ å•ä¸€ï¼Œå…³æ³¨çœŸæ­£éœ€è¦å…³æ³¨çš„å†…å®¹ã€‚å±è”½å¹²æ‰°ï¼Œè®©æ ¸å¿ƒé€»è¾‘æ›´å®¹æ˜“è¢«æµ‹è¯•ã€‚</li></ul><p><br><br><br><br><br></p><h2 id="ç»§ç»­æ¢ç´¢-typescript-è£…é¥°å™¨çš„èƒ½åŠ›è¾¹ç•Œ"><a href="#ç»§ç»­æ¢ç´¢-typescript-è£…é¥°å™¨çš„èƒ½åŠ›è¾¹ç•Œ" class="headerlink" title="ç»§ç»­æ¢ç´¢ Typescript è£…é¥°å™¨çš„èƒ½åŠ›è¾¹ç•Œ"></a>ç»§ç»­æ¢ç´¢ Typescript è£…é¥°å™¨çš„èƒ½åŠ›è¾¹ç•Œ</h2><p>åœ¨ä¸Šç¯‡<a href="https://www.notion.so/Javascript-MobX-Vue-5e1c633167094d9784e602d66a5877f8?pvs=21" target="_blank" rel="noopener">æ–‡ç« </a>ä¸­ï¼Œæˆ‘ä»¬æåˆ° Typescript å¯¹æ–°ç‰ˆçš„è£…é¥°å™¨æœ‰äº†æ›´ä¸¥æ ¼çš„æ£€æŸ¥ã€‚</p><p><br></p><p>å®ƒå¯ä»¥çº¦æŸè£…é¥°å™¨çš„ä½ç½®ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">declare function injectable&lt;T, Class extends abstract new (...args: any) =&gt; T&gt;(): (</span><br><span class="line">  value: Class,</span><br><span class="line">  context: ClassDecoratorContext&lt;Class&gt;</span><br><span class="line">) =&gt; void</span><br><span class="line"></span><br><span class="line">@injectable()</span><br><span class="line">class Foo &#123;</span><br><span class="line">  // @ts-expect-error âŒ åªèƒ½è£…é¥°ç±»</span><br><span class="line">  @injectable()</span><br><span class="line">  member = 1</span><br><span class="line"></span><br><span class="line">  // @ts-expect-error âŒ åªèƒ½è£…é¥°ç±»</span><br><span class="line">  @injectable()</span><br><span class="line">  method() &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p>è¿™è¿˜ä¸æ­¢ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å¯¹è¢«è£…é¥°çš„ç›®æ ‡å€¼è¿›è¡Œçº¦æŸã€‚ä»¥ä¾èµ–æ³¨å…¥çš„åœºæ™¯æ¥çœ‹, æ—§ç‰ˆçš„è£…é¥°å™¨å¾ˆéš¾åšåˆ°æ ¹æ®æ³¨å…¥çš„æ ‡è¯†ç¬¦æ¥çº¦æŸ<code>å®ç°</code>å’Œ<code>æ³¨å…¥</code>ã€‚ç°åœ¨æˆ‘ä»¬å¾ˆå®¹æ˜“åšåˆ°ï¼š</p><p>å…ˆæ¥æ„é€ <code>æ³¨å…¥æ ‡è¯†ç¬¦</code>çš„ç±»å‹(çµæ„Ÿæ¥æºäº <code>Vue</code> çš„ <code>provide/inject</code>)ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">export interface InjectionKey&lt;T&gt; extends Symbol &#123;&#125;</span><br></pre></td></tr></table></figure><p><br></p><p>ç°åœ¨å¯ä»¥è¿™æ ·å®šä¹‰æ ‡è¯†ç¬¦ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">// å®šä¹‰æ³¨å…¥çš„åè®®ï¼Œé¸Ÿç±»</span><br><span class="line">interface Bird &#123;</span><br><span class="line">  fly(): void</span><br><span class="line">  searchForFood(): void</span><br><span class="line">  breed(): void</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// å°†æ¥å£å’Œæ ‡è¯†ç¬¦å®ç°ç»‘å®š</span><br><span class="line">const BIRD_BINDING: InjectionKey&lt;Bird&gt; = Symbol(&apos;Bird&apos;)</span><br></pre></td></tr></table></figure><p><br></p><p>æˆ‘ä»¬å†æ¥å®šä¹‰ <code>injectable</code> è£…é¥°å™¨ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">declare function injectable&lt;T, Class extends abstract new (...args: any) =&gt; T&gt;(</span><br><span class="line">  // ä¼ å…¥ InjectionKey ç±»å‹ï¼Œæ¨æ–­å‡º T æ¥çº¦æŸ class</span><br><span class="line">  key: InjectionKey&lt;T&gt;</span><br><span class="line">): (value: Class, context: ClassDecoratorContext&lt;Class&gt;) =&gt; void</span><br></pre></td></tr></table></figure><p>æµ‹è¯•ä¸€ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">// @ts-expect-error âŒ æ²¡æœ‰å±¥è¡Œ Bird åè®®</span><br><span class="line">@injectable(BIRD_BINDING)</span><br><span class="line">class Eagle &#123;&#125;</span><br><span class="line"></span><br><span class="line">// âœ… å±¥è¡Œäº† Bird åè®®</span><br><span class="line">@injectable(BIRD_BINDING)</span><br><span class="line">class Pigeon implements Bird &#123;</span><br><span class="line">  fly() &#123;&#125;</span><br><span class="line">  searchForFood() &#123;&#125;</span><br><span class="line">  breed() &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ç°åœ¨å¯ä»¥å¯¹<code>å®ç°è€…</code>çš„<code>åè®®å±¥è¡Œ</code>è¿›è¡Œä¸¥æ ¼æ£€æŸ¥ã€‚</p><p><br><br><br></p><p>åŒç†æˆ‘ä»¬å¯ä»¥æ£€æŸ¥æ³¨å…¥ä¾§ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">declare function inject&lt;T&gt;(</span><br><span class="line">  key: InjectionKey&lt;T&gt;</span><br><span class="line">): (value: undefined, context: ClassFieldDecoratorContext&lt;unknown, T | undefined&gt;) =&gt; void</span><br><span class="line"></span><br><span class="line">declare function injectAll&lt;T&gt;(</span><br><span class="line">  key: InjectionKey&lt;T&gt;</span><br><span class="line">): (value: undefined, context: ClassFieldDecoratorContext&lt;unknown, T[] | undefined&gt;) =&gt; void</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class Zoo &#123;</span><br><span class="line">  // @ts-expect-error âŒ ç±»å‹ä¸åŒ¹é…</span><br><span class="line">  @inject(BIRD_BINDING)</span><br><span class="line">  private unknown?: number</span><br><span class="line"></span><br><span class="line">  // âœ…</span><br><span class="line">  @inject(BIRD_BINDING)</span><br><span class="line">  private bird?: Bird</span><br><span class="line"></span><br><span class="line">  // @ts-expect-error âŒ ç±»å‹ä¸åŒ¹é…</span><br><span class="line">  @injectAll(BIRD_BINDING)</span><br><span class="line">  private allBirds?: Bird</span><br><span class="line"></span><br><span class="line">  // âœ…</span><br><span class="line">  @injectAll(BIRD_BINDING)</span><br><span class="line">  private birds?: Bird[]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ˜¯ä¸æ˜¯å¾ˆé…·?ï¼</p><p><br><br><br><br><br></p><h2 id="å®æˆ˜"><a href="#å®æˆ˜" class="headerlink" title="å®æˆ˜"></a>å®æˆ˜</h2><p>æ¥ä¸‹æ¥æˆ‘ä»¬æŠŠä¸Šé¢è®²åˆ°çš„çŸ¥è¯†ç‚¹è¿ç”¨èµ·æ¥ï¼Œå®ç°ä¸€ä¸ªç®€æ˜“çš„ä¾èµ–æ³¨å…¥åº“ã€‚</p><p>ğŸ”´  è¿è¡Œç¯å¢ƒï¼šç”±äºä½¿ç”¨äº†è¾ƒæ–°çš„ç‰¹æ€§ï¼Œå…¶ä»–æ„å»ºå¹³å°æš‚æœªè·Ÿè¿›(åŒ…æ‹¬ Babelã€Vite)ã€‚ä¸‹é¢ä»£ç åŸºäº Typescript 5.2(next) + <code>jest</code> + <code>ts-jest</code> è¿è¡Œã€‚</p><p>ä¸ºäº†ç¡®ä¿è¿è¡Œï¼Œ éœ€è¦æ·»åŠ ä»¥ä¸‹ polyfillï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">// typescript polyfill</span><br><span class="line">declare global &#123;</span><br><span class="line">  interface SymbolConstructor &#123;</span><br><span class="line">    readonly metadata: unique symbol</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  interface Function &#123;</span><br><span class="line">    [Symbol.metadata]?: DecoratorMetadata</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">// runtime polyfill</span><br><span class="line">if (typeof Symbol.metadata === &apos;undefined&apos;) &#123;</span><br><span class="line">  // @ts-expect-error</span><br><span class="line">  Symbol.metadata = Symbol(&apos;Symbol.metadata&apos;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ğŸ’¡  åœ¨æ–°ç‰ˆçš„è£…é¥°å™¨ä¸­ï¼Œå®ç°ä¾èµ–æ³¨å…¥ä¸ä¸€å®šè¦ç”¨åˆ° Decorator Metadata, å¯ä»¥çœ‹è£…é¥°å™¨ææ¡ˆä¸­çš„<a href="https://github.com/tc39/proposal-decorators#access-and-metadata-sidechanneling" target="_blank" rel="noopener">ä¾‹å­</a>ã€‚</p></blockquote><p><br><br><br><br><br><br><br></p><h3 id="è£…é¥°å™¨-api"><a href="#è£…é¥°å™¨-api" class="headerlink" title="è£…é¥°å™¨ API"></a>è£…é¥°å™¨ API</h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬æŠŠå…³é”®çš„è£…é¥°å™¨ API å®šä¹‰å‡ºæ¥:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">// ğŸ”´ InjectionKey ç”¨äºå®šä¹‰ä¾èµ–æ³¨å…¥çš„æ ‡è¯†ç¬¦, å¯æ˜¯å®ç°æ ‡å¿—æœå’Œåè®®çš„ç»‘å®šï¼Œæˆ‘ä»¬åœ¨ä¸Šæ–‡ä»‹ç»è¿‡äº†</span><br><span class="line">export interface InjectionKey&lt;T&gt; extends Symbol &#123;&#125;</span><br><span class="line"></span><br><span class="line">// ğŸ”´ ä½œç”¨åŸŸç±»å‹, ä½œä¸ºç®€å•ç¤ºä¾‹ï¼Œæˆ‘ä»¬å°±æ”¯æŒä¸¤ç§ä½œç”¨åŸŸç±»å‹</span><br><span class="line">export enum Scope &#123;</span><br><span class="line">  Singleton,</span><br><span class="line">  Transient,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// ğŸ”´ ç±»è£…é¥°å™¨ï¼Œæ”¯æŒè¢«æ³¨å…¥çš„ç±»éƒ½éœ€è¦ä½¿ç”¨å®ƒæ¥è£…é¥°</span><br><span class="line">// å¯ä»¥æ¥å—ä¸€ä¸ª scopeï¼Œé»˜è®¤ä¸º å•ä¾‹</span><br><span class="line">export function injectable&lt;T, Class extends abstract new (...args: any) =&gt; T&gt;(</span><br><span class="line">  key: InjectionKey&lt;T&gt;,</span><br><span class="line">  scope?: Scope</span><br><span class="line">) &#123;</span><br><span class="line">  return (value: Class, context: ClassDecoratorContext&lt;Class&gt;) =&gt; &#123;</span><br><span class="line">    const metadata = getOrCreateMetadata(context.metadata)</span><br><span class="line"></span><br><span class="line">    if (metadata.injectable) &#123;</span><br><span class="line">      throw new Error(&apos;injectable is already defined&apos;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    metadata.injectable = key</span><br><span class="line">    metadata.scope = scope</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// ğŸ”´ å±æ€§è£…é¥°å™¨, å£°æ˜æ³¨å…¥</span><br><span class="line">export function inject&lt;T&gt;(key: InjectionKey&lt;T&gt;) &#123;</span><br><span class="line">  return (value: undefined, context: ClassFieldDecoratorContext&lt;unknown, T | undefined&gt;) =&gt; &#123;</span><br><span class="line">    injectToField(&#123; key, context &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// ğŸ”´ å±æ€§è£…é¥°å™¨, å£°æ˜æ³¨å…¥æ‰€æœ‰ç»‘å®š</span><br><span class="line">export function injectAll&lt;T&gt;(key: InjectionKey&lt;T&gt;) &#123;</span><br><span class="line">  return (value: undefined, context: ClassFieldDecoratorContext&lt;unknown, T[] | undefined&gt;) =&gt; &#123;</span><br><span class="line">    injectToField(&#123; key, multiple: true, context &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°è£…é¥°å™¨ä¸ä¼šå¯¹ç±»è¿›è¡Œæ”¹é€ ï¼Œåªæ˜¯åˆ©ç”¨ Decorator Metadata è¿›è¡Œä¸€äº›æ ‡æ³¨ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">// ğŸ”´ æˆ‘ä»¬å­˜å‚¨åœ¨ç±» Decorator Metadata çš„æ•°æ®</span><br><span class="line">interface InjectionMetadata &#123;</span><br><span class="line">  // ç±»æ˜¯å¦è£…é¥°äº† @injectable</span><br><span class="line">  injectable?: InjectionKey&lt;unknown&gt;</span><br><span class="line">  // ä½œç”¨åŸŸ</span><br><span class="line">  scope?: Scope</span><br><span class="line">  // ç±»éœ€è¦è¿›è¡Œæ³¨å…¥çš„å±æ€§</span><br><span class="line">  injections?: Map&lt;PropertyKey, Injection&gt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// ğŸ”´ ç±»å±æ€§æ³¨å…¥ä¿¡æ¯</span><br><span class="line">interface Injection &#123;</span><br><span class="line">  // å±æ€§å</span><br><span class="line">  key: InjectionKey&lt;unknown&gt;</span><br><span class="line">  // æ˜¯å¦è·å–å¤šä¸ªå®ä¾‹</span><br><span class="line">  multiple?: boolean</span><br><span class="line">  // è£…é¥°å™¨çš„ä¸Šä¸‹æ–‡</span><br><span class="line">  context: ClassFieldDecoratorContext</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// ğŸ”´ Decorator Metadata çš„ KEY, ä½¿ç”¨ Symbolï¼Œé¿å…å’Œå…¶ä»–åº“å†²çª</span><br><span class="line">const METADATA_KEY: unique symbol = Symbol(&apos;METADATA_KEY&apos;)</span><br><span class="line"></span><br><span class="line">// åˆå§‹åŒ– metadata</span><br><span class="line">function getOrCreateMetadata&lt;T&gt;(metadata: DecoratorMetadata): InjectionMetadata &#123;</span><br><span class="line">  if (metadata == null) &#123;</span><br><span class="line">    throw new Error(&apos;Decorator metadata is not defined&apos;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  return metadata[METADATA_KEY] ?? (metadata[METADATA_KEY] = &#123;&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// æ ‡è®°å±æ€§æ³¨å…¥</span><br><span class="line">function injectToField(injection: Injection) &#123;</span><br><span class="line">  const &#123; context &#125; = injection</span><br><span class="line"></span><br><span class="line">  if (context.static === true) &#123;</span><br><span class="line">    throw new Error(&apos;inject cannot be used on static fields&apos;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  const metadata = getOrCreateMetadata(context.metadata)</span><br><span class="line"></span><br><span class="line">  if (metadata.injections == null) &#123;</span><br><span class="line">    metadata.injections = new Map()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  if (metadata.injections.has(context.name)) &#123;</span><br><span class="line">    throw new Error(`inject is already defined for $&#123;context.name.toString()&#125;`)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  metadata.injections.set(context.name, injection)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æµ‹è¯•é©±åŠ¨å¼€å‘ï¼Œæˆ‘ä»¬å…ˆæŠŠæµ‹è¯•ç”¨ä¾‹å†™äº†ï¼Œä¹Ÿæ–¹ä¾¿è¯»è€…å¯¹æˆ‘ä»¬ API çš„ç”¨æ³•æœ‰åŸºæœ¬çš„äº†è§£ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">// å®šä¹‰åè®®</span><br><span class="line">interface Bird &#123;</span><br><span class="line">  fly(): void</span><br><span class="line">  searchForFood(): void</span><br><span class="line">  breed(): void</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">interface IZoo &#123;</span><br><span class="line">  getAllBirds(): Bird[]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// å®šä¹‰æ ‡è¯†ç¬¦ï¼Œå¹¶ç»‘å®šåè®®</span><br><span class="line">const BIRD_BINDING: InjectionKey&lt;Bird&gt; = Symbol.for(&apos;Bird&apos;)</span><br><span class="line">const ZOO_KEY: InjectionKey&lt;IZoo&gt; = Symbol.for(&apos;Zoo&apos;)</span><br><span class="line"></span><br><span class="line">// ...</span><br><span class="line"></span><br><span class="line">test(&apos;property inject&apos;, () =&gt; &#123;</span><br><span class="line">  // ğŸ”´ ä½¿ç”¨ @injectable æ ‡æ³¨æ”¯æŒæ³¨å…¥çš„ç±»</span><br><span class="line">  @injectable(BIRD_BINDING)</span><br><span class="line">  class MyBird &#123;</span><br><span class="line">    fly() &#123;&#125;</span><br><span class="line">    searchForFood() &#123;&#125;</span><br><span class="line">    breed() &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  @injectable(BIRD_BINDING)</span><br><span class="line">  class MyBird2 &#123;</span><br><span class="line">    fly() &#123;&#125;</span><br><span class="line">    searchForFood() &#123;&#125;</span><br><span class="line">    breed() &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  @injectable(ZOO_KEY)</span><br><span class="line">  class Zoo implements IZoo &#123;</span><br><span class="line">    // ğŸ”´ è·å–æ‰€æœ‰ Bird å®ä¾‹</span><br><span class="line">    @injectAll(BIRD_BINDING)</span><br><span class="line">    birds?: Bird[]</span><br><span class="line"></span><br><span class="line">    getAllBirds() &#123;</span><br><span class="line">      return this.birds!</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // ğŸ”´ æ³¨å†Œåˆ°å®¹å™¨</span><br><span class="line">  const container = new Container()</span><br><span class="line">  container.bind(BIRD_BINDING, MyBird)</span><br><span class="line">  container.bind(BIRD_BINDING, MyBird2)</span><br><span class="line">  container.bind(ZOO_KEY, Zoo)</span><br><span class="line"></span><br><span class="line">  // æµ‹è¯•</span><br><span class="line">  const zoo = container.get(ZOO_KEY)</span><br><span class="line"></span><br><span class="line">  expect(zoo).toBeInstanceOf(Zoo)</span><br><span class="line">  expect(zoo.getAllBirds().length).toBe(2)</span><br><span class="line">  expect(zoo.getAllBirds()[0]).toBeInstanceOf(MyBird)</span><br><span class="line">  expect(zoo.getAllBirds()[1]).toBeInstanceOf(MyBird2)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><br><br><br><br><br></p><h3 id="å®¹å™¨å®ç°"><a href="#å®¹å™¨å®ç°" class="headerlink" title="å®¹å™¨å®ç°"></a>å®¹å™¨å®ç°</h3><p>æ¥ä¸‹æ¥å°±æ˜¯å®ç°å®¹å™¨äº†</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">type Ctor&lt;T = unknown&gt; = new (...args: any) =&gt; T</span><br><span class="line"></span><br><span class="line">export class Container &#123;</span><br><span class="line">  // å­˜å‚¨ç»‘å®šå…³ç³»</span><br><span class="line">  private bindings: Map&lt;InjectionKey&lt;unknown&gt;, Ctor[]&gt; = new Map()</span><br><span class="line">  // å•ä¾‹å¯¹è±¡æ± </span><br><span class="line">  private pools: Map&lt;Ctor, unknown&gt; = new Map()</span><br><span class="line"></span><br><span class="line">  // ğŸ”´ ç»‘å®šï¼Œä¼ å…¥ InjectionKey å’Œ ç±»å®ç°</span><br><span class="line">  bind&lt;T&gt;(key: InjectionKey&lt;T&gt;, impl: new (...args: any) =&gt; T) &#123;</span><br><span class="line">    // è£…é¥°å™¨ä¿¡æ¯æ£€æŸ¥</span><br><span class="line">    if (impl[Symbol.metadata] == null) &#123;</span><br><span class="line">      throw new Error(`No metadata found for $&#123;impl.name&#125;`)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    const metadata = impl[Symbol.metadata]![METADATA_KEY] as InjectionMetadata | undefined</span><br><span class="line"></span><br><span class="line">    if (metadata == null || metadata.injectable == null) &#123;</span><br><span class="line">      throw new Error(`No injectable found for $&#123;impl.name&#125;`)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // å­˜å‚¨</span><br><span class="line">    if (this.bindings.has(key)) &#123;</span><br><span class="line">      this.bindings.get(key)!.push(impl)</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      this.bindings.set(key, [impl])</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // ğŸ”´ è·å–å®ä¾‹</span><br><span class="line">  get&lt;T&gt;(key: InjectionKey&lt;T&gt;): T &#123;</span><br><span class="line">    return this.resolve(key, false) as T</span><br><span class="line">  &#125;</span><br><span class="line">  // ğŸ”´ è·å–æ‰€æœ‰å®ä¾‹</span><br><span class="line">  getAll&lt;T&gt;(key: InjectionKey&lt;T&gt;): T[] &#123;</span><br><span class="line">    return this.resolve(key, true) as T[]</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * ğŸ”´ å¯¹è±¡æŸ¥æ‰¾</span><br><span class="line">   */</span><br><span class="line">  private resolve(key: InjectionKey&lt;unknown&gt;, multiple: boolean): unknown &#123;</span><br><span class="line">    const binding = this.bindings.get(key)</span><br><span class="line"></span><br><span class="line">    if (binding == null) &#123;</span><br><span class="line">      throw new Error(`No binding found for $&#123;key.toString()&#125;`)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (!multiple &amp;&amp; binding.length &gt; 1) &#123;</span><br><span class="line">      throw new Error(`Multiple bindings found for $&#123;key.toString()&#125;`)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return multiple</span><br><span class="line">      ? binding.map((impl) =&gt; this.createInstance(impl))</span><br><span class="line">      : this.createInstance(binding[0])</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * ğŸ”´ å¯¹è±¡å®ä¾‹åŒ–</span><br><span class="line">   */</span><br><span class="line">  private createInstance(impl: Ctor): unknown &#123;</span><br><span class="line">    const metadata = impl[Symbol.metadata]![METADATA_KEY] as InjectionMetadata</span><br><span class="line">    const &#123; scope = Scope.Singleton, injections &#125; = metadata</span><br><span class="line"></span><br><span class="line">    // å•ä¾‹</span><br><span class="line">    if (scope === Scope.Singleton &amp;&amp; this.pools.has(impl)) &#123;</span><br><span class="line">      return this.pools.get(impl)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // å®ä¾‹åŒ–</span><br><span class="line">    const instance = new impl()</span><br><span class="line"></span><br><span class="line">    // ä¾èµ–æ³¨å…¥ï¼Œé€’å½’è°ƒç”¨</span><br><span class="line">    if (injections != null) &#123;</span><br><span class="line">      for (const injection of injections.values()) &#123;</span><br><span class="line">        const &#123; key, context, multiple &#125; = injection</span><br><span class="line">        const value = multiple ? this.getAll(key) : this.get(key)</span><br><span class="line">        // ğŸ”´ åˆ©ç”¨æ–°ç‰ˆè£…é¥°å™¨çš„ access å®ç°æ³¨å…¥</span><br><span class="line">        context.access.set(instance, value)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (scope === Scope.Singleton) &#123;</span><br><span class="line">      this.pools.set(impl, instance)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return instance</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p>æ•´ä¸ªä»£ç éå¸¸ç®€å•ï¼Œè¿™é‡Œå¯¹æ–°ç‰ˆè£…é¥°å™¨çš„å¦™ç”¨åœ¨äº <code>context.access.set(instance, value)</code> , ç”¨èµ·æ¥éå¸¸æ–¹ä¾¿ï¼Œæˆ‘ä»¬ä¸éœ€è¦å…³å¿ƒå±æ€§çš„å­˜å‚¨è¿‡ç¨‹ï¼Œæ¯”å¦‚<code>ç§æœ‰å±æ€§</code>ã€‚</p><p><br></p><p>ä¸Šé¢çš„ä»£ç æœ‰ä¸€ä¸ªé—®é¢˜æ²¡æœ‰è§£å†³ï¼Œå°±æ˜¯<code>å¾ªç¯ä¾èµ–</code>ã€‚æˆ‘ä»¬å†™ä¸€ä¸ªæµ‹è¯•æ¥å¤ç°ä¸€ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">test(&apos;cycle dependency&apos;, () =&gt; &#123;</span><br><span class="line">  const container = new Container()</span><br><span class="line"></span><br><span class="line">  const A_KEY: InjectionKey&lt;A&gt; = Symbol(&apos;A&apos;)</span><br><span class="line">  const B_KEY: InjectionKey&lt;B&gt; = Symbol(&apos;B&apos;)</span><br><span class="line"></span><br><span class="line">  @injectable(A_KEY)</span><br><span class="line">  class A &#123;</span><br><span class="line">    @inject(B_KEY)</span><br><span class="line">    b?: B</span><br><span class="line"></span><br><span class="line">    constructor() &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  @injectable(B_KEY)</span><br><span class="line">  class B &#123;</span><br><span class="line">    @inject(A_KEY)</span><br><span class="line">    a?: A</span><br><span class="line"></span><br><span class="line">    constructor() &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  container.bind(A_KEY, A)</span><br><span class="line">  container.bind(B_KEY, B)</span><br><span class="line"></span><br><span class="line">  const a = container.get(A_KEY)</span><br><span class="line">  expect(a).toBeInstanceOf(A)</span><br><span class="line">  const b = container.get(B_KEY)</span><br><span class="line">  expect(b).toBeInstanceOf(B)</span><br><span class="line">  expect(a.b).toBe(b)</span><br><span class="line">  expect(b.a).toBe(a)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„æµ‹è¯•ç”¨ä¾‹ä¼šå‡ºç°<code>è°ƒç”¨æ ˆæº¢å‡º</code>ã€‚å› ä¸º A â†’ B ä¹‹é—´å‡ºç°äº†å¾ªç¯ä¾èµ–ã€‚è¿™ä¸ªä¹Ÿå¥½åŠï¼Œæˆ‘ä»¬æ–°å¢ä¸€ä¸ªç¼“å­˜å±æ€§ï¼Œå­˜å‚¨æ­£åœ¨å®ä¾‹åŒ–çš„å¯¹è±¡ï¼Œå¯ä»¥ç®€å•è§£å†³é—®é¢˜ï¼š</p><figure class="highlight diff"><table><tr><td class="code"><pre><span class="line">export class Container &#123;</span><br><span class="line"><span class="addition">+ // æ­£åœ¨åˆ›å»ºçš„å¯¹è±¡</span></span><br><span class="line"><span class="addition">+ private creating: Map&lt;Ctor, unknown&gt; = new Map()</span></span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * å¯¹è±¡å®ä¾‹åŒ–</span><br><span class="line">   */</span><br><span class="line">  private createInstance(impl: Ctor): unknown &#123;</span><br><span class="line"><span class="addition">+   if (this.creating.has(impl)) &#123;</span></span><br><span class="line"><span class="addition">+     return this.creating.get(impl)</span></span><br><span class="line"><span class="addition">+   &#125;</span></span><br><span class="line">    // ...</span><br><span class="line"><span class="addition">+   // å®ä¾‹åŒ–</span></span><br><span class="line"><span class="addition">+   const instance = new impl()</span></span><br><span class="line"><span class="addition">+   // ç¼“å­˜</span></span><br><span class="line"><span class="addition">+   this.creating.set(impl, instance)</span></span><br><span class="line"></span><br><span class="line"><span class="addition">+   try &#123;</span></span><br><span class="line">      // ä¾èµ–æ³¨å…¥</span><br><span class="line">      if (injections != null) &#123;</span><br><span class="line">        for (const injection of injections.values()) &#123;</span><br><span class="line">          const &#123; key, context, multiple &#125; = injection</span><br><span class="line">          const value = multiple ? this.getAll(key) : this.get(key)</span><br><span class="line">          context.access.set(instance, value)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      if (scope <span class="comment">=== Scope.Singleton) &#123;</span></span><br><span class="line">        this.pools.set(impl, instance)</span><br><span class="line">      &#125;</span><br><span class="line"><span class="addition">+   &#125; finally &#123;</span></span><br><span class="line"><span class="addition">+     this.creating.delete(impl)</span></span><br><span class="line"><span class="addition">+   &#125;</span></span><br><span class="line"></span><br><span class="line">    return instance</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢å°±æ˜¯è£…é¥°å™¨çš„æ ¸å¿ƒé€»è¾‘äº†ã€‚å¦‚æœä½ å¯¹ç”Ÿäº§çº§åˆ« DI åº“æ„Ÿå…´è¶£ï¼Œå¯ä»¥æ·±å…¥çœ‹ä¸‹æ‰©å±•é˜…è¯»æåŠçš„å¼€æºå®ç°ã€‚</p><p>ä¸Šé¢ç›¸å…³æºç å¯ä»¥åœ¨<a href="https://github.com/ivan-94/decoractor-in-action/tree/new-di/src/di" target="_blank" rel="noopener">è¿™é‡Œ</a>æ‰¾åˆ°ã€‚</p><p><br><br><br><br><br></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æœ¬æ–‡å›é¡¾äº†è£…é¥°å™¨çš„è€æ­æ¡£ <code>reflect-metadata</code> çš„å†å²ï¼Œå®ƒçš„æ„¿æ™¯ç»™è£…é¥°å™¨æä¾›æ ‡å‡†åŒ–çš„å…ƒæ•°æ®å­˜å‚¨æœåŠ¡ï¼Œæ›´é•¿è¿œæ¥æ„¿æ™¯æ˜¯ç»™ JavaScript çš„ä¸Šå±‚è¯­è¨€æä¾›ä¿ç•™é™æ€ä¿¡æ¯çš„æ¥å£ã€‚</p><p>ä½†å®ƒæœ€ç»ˆæ²¡æœ‰æäº¤ç»™ tc39, ç°åœ¨éšç€æ–°çš„è£…é¥°å™¨æ ‡å‡†çš„å‘å±•ï¼Œå·²ç»è¢« <code>Decorator Metadata</code> ææ¡ˆå–ä»£ã€‚<code>Decorator Metadata</code> ç›¸æ¯” reflect-metadata ç®€åŒ–å¾ˆå¤šï¼Œå°±æ˜¯æ–°å¢äº† <code>Symbol.metadata</code>, é…åˆè£…é¥°å™¨ context.metadataï¼Œå¼€å‘è€…å¯ä»¥å­˜å‚¨ä»»æ„å…ƒæ•°æ®ã€‚</p><p>æ¥ç€æˆ‘ä»¬ç»§ç»­æ¢ç´¢äº† Typescript å¯¹è£…é¥°å™¨ç±»å‹æ£€æŸ¥çš„å¢å¼ºï¼Œå¯ä»¥è®©æˆ‘ä»¬å†™å‡ºæ›´å®‰å…¨çš„ä»£ç ã€‚å°¤å…¶åœ¨ DI è¿™ä¸ªåœºæ™¯ã€‚</p><p>æœ€åæˆ‘ä»¬å°†ä¸Šé¢å­¦åˆ°çš„çŸ¥è¯†èä¼šè´¯é€šï¼Œå¼€å‘äº†ä¸€ä¸ªç®€æ˜“çš„ä¾èµ–æ³¨å…¥å®ç°ã€‚</p><p><br><br><br><br><br></p><h2 id="æ‰©å±•é˜…è¯»"><a href="#æ‰©å±•é˜…è¯»" class="headerlink" title="æ‰©å±•é˜…è¯»"></a>æ‰©å±•é˜…è¯»</h2><ul><li>Decorator<br><a href="https://github.com/tc39/proposal-decorators" target="_blank" rel="noopener">https://github.com/tc39/proposal-decorators</a></li><li>Decorator Metadata<br><a href="https://github.com/tc39/proposal-decorator-metadata" target="_blank" rel="noopener">https://github.com/tc39/proposal-decorator-metadata</a></li><li>reflect-metadata<br><a href="https://github.com/rbuckton/reflect-metadata" target="_blank" rel="noopener">https://github.com/rbuckton/reflect-metadata</a><ul><li><a href="https://dev.to/svehla/why-reflect-metadata-suc-s-5fal" target="_blank" rel="noopener">Why reflect-metadata suc*s</a></li><li><a href="https://www.typescriptlang.org/docs/handbook/decorators.html" target="_blank" rel="noopener">Typescript Experimental Decorator</a></li><li><a href="https://medium.com/jspoint/introduction-to-reflect-metadata-package-and-its-ecmascript-proposal-8798405d7d88" target="_blank" rel="noopener">Introduction to â€œreflect-metadataâ€ package and its ECMAScript proposal</a></li></ul></li><li>DI å®ç°<br><a href="https://github.com/inversify/InversifyJS" target="_blank" rel="noopener">https://github.com/inversify/InversifyJS</a><br><a href="https://github.com/microsoft/tsyringe" target="_blank" rel="noopener">https://github.com/microsoft/tsyringe</a><br><a href="https://github.com/midwayjs/injection" target="_blank" rel="noopener">https://github.com/midwayjs/injection</a><br><a href="https://github.com/jeffijoe/awilix" target="_blank" rel="noopener">https://github.com/jeffijoe/awilix</a><br><a href="https://github.com/typestack/typedi" target="_blank" rel="noopener">https://github.com/typestack/typedi</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;img src=&quot;/images/decorator-2/Untitled.jpeg&quot; alt=&quot;cover&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;ç³»åˆ—æ–‡ç« ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.notion.so/Javascript
      
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://bobi.ink/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>å…¨æ–° Javascript è£…é¥°å™¨å®æˆ˜ä¸Šç¯‡ï¼šç”¨ MobX çš„æ–¹å¼æ‰“å¼€ Vue</title>
    <link href="https://bobi.ink/2023/06/26/decorator/"/>
    <id>https://bobi.ink/2023/06/26/decorator/</id>
    <published>2023-06-25T16:00:00.000Z</published>
    <updated>2023-06-30T08:35:21.851Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/images/decorator/Untitled.jpeg" alt="cover"></p><p>å»å¹´ä¸‰æœˆä»½<a href="https://github.com/tc39/proposal-decorators" target="_blank" rel="noopener">è£…é¥°å™¨ææ¡ˆ</a>è¿›å…¥äº† Stage 3 é˜¶æ®µï¼Œè€Œä»Šå¹´ä¸‰æœˆä»½ Typescript åœ¨ 5.0 ä¹Ÿæ­£å¼æ”¯æŒäº† <a href="https://github.com/tc39/proposal-decorators/tree/8ca65c046dd5e9aa3846a1fe5df343a6f7efd9f8" target="_blank" rel="noopener"></a>ã€‚è£…é¥°å™¨ææ¡ˆè·ç¦»æ­£å¼çš„è¯­è¨€æ ‡å‡†ï¼Œåªå·®ä¸´é—¨ä¸€è„šã€‚</p><p>è¿™ä¹Ÿæ„å‘³ç€æ—§ç‰ˆçš„è£…é¥°å™¨(Stage 1) å°†é€æ¸é€€å‡ºå†å²èˆå°ã€‚ç„¶è€Œæ—§ç‰ˆçš„è£…é¥°å™¨å·²ç»è¢«å¹¿æ³›çš„ä½¿ç”¨ï¼Œæ¯”å¦‚ MobXã€Angularã€NestJSâ€¦ æœªæ¥è¾ƒé•¿çš„ä¸€æ®µæ—¶é—´å†…ï¼Œéƒ½ä¼šæ˜¯æ–°æ—§å¹¶å­˜çš„å±€é¢ã€‚</p><p><br></p><p>æœ¬æ–‡å°†æŠŠè£…é¥°å™¨è¯­æ³•å¸¦åˆ° <code>Vue Reactivity API</code> ä¸­ï¼Œè®©æˆ‘ä»¬å¯ä»¥åƒ MobX ä¸€æ ·ï¼Œä½¿ç”¨ç±»æ¥å®šä¹‰æ•°æ®æ¨¡å‹, ä¾‹å¦‚:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class Counter &#123;</span><br><span class="line">  @observable</span><br><span class="line">  count = 1</span><br><span class="line"></span><br><span class="line">  @computed</span><br><span class="line">  get double() &#123;</span><br><span class="line">    return this.count * 2</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  add = () =&gt; &#123;</span><br><span class="line">    this.count++</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p>åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½“ä¼šåˆ°æ–°æ—§è£…é¥°å™¨ç‰ˆæœ¬ä¹‹é—´çš„å·®å¼‚å’Œå®è·µä¸­çš„å„ç§é™·é˜±ã€‚</p><p><br><br><br></p><h2 id="æ¦‚è§ˆ"><a href="#æ¦‚è§ˆ" class="headerlink" title="æ¦‚è§ˆ"></a>æ¦‚è§ˆ</h2><p><img src="/images/decorator/Untitled.png" alt="æ€ç»´å¯¼å›¾"></p><p>å…³äºè£…é¥°å™¨çš„ä¸»è¦ API éƒ½åœ¨ä¸Šè¿°æ€ç»´å¯¼å›¾ä¸­ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œè¯»è€…å¯ä»¥é€šè¿‡ä¸‹æ–‡ã€Œæ‰©å±•é˜…è¯»ã€ä¸­æåŠçš„é“¾æ¥æ¥æ·±å…¥äº†è§£å®ƒä»¬ã€‚</p><p><br><br><br></p><h2 id="legacy"><a href="#legacy" class="headerlink" title="Legacy"></a>Legacy</h2><p>é¦–å…ˆï¼Œæˆ‘ä»¬ä½¿ç”¨æ—§çš„è£…é¥°å™¨æ¥å®ç°ç›¸å…³çš„åŠŸèƒ½ã€‚</p><p>åœ¨ Typescript ä¸‹ï¼Œéœ€è¦é€šè¿‡ <code>experimentalDecorators</code> æ¥å¯ç”¨è£…é¥°å™¨è¯­æ³•:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;compilerOptions&quot;: &#123;</span><br><span class="line">    &quot;experimentalDecorators&quot;: true</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœä½¿ç”¨ Babel 7 ï¼Œé…ç½®å¤§æ¦‚å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;plugins&quot;: [</span><br><span class="line">    [&quot;@babel/plugin-proposal-decorators&quot;, &#123; &quot;version&quot;: &quot;legacy&quot; &#125;]</span><br><span class="line">    [&quot;@babel/plugin-transform-class-properties&quot;, &#123;&quot;loose&quot;: true &#125;]</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br><br><br></p><h3 id="observable"><a href="#observable" class="headerlink" title="@observable"></a>@observable</h3><p>æˆ‘ä»¬å…ˆæ¥å®ç° <code>@observable</code> è£…é¥°å™¨ï¼Œå®ƒåªèƒ½ä½œç”¨äºã€Œ<code>ç±»å±æ€§æˆå‘˜</code>ã€ï¼Œæ¯”å¦‚:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class Counter &#123;</span><br><span class="line">  @observable</span><br><span class="line">  count = 1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const counter = new Counter()</span><br><span class="line">expect(counter.count).toBe(1)</span><br></pre></td></tr></table></figure><p>å±æ€§å€¼å¯ä»¥æ˜¯<code>åŸå§‹ç±»å‹</code>æˆ–è€…<code>å¯¹è±¡ç±»å‹</code>ï¼Œæ²¡æœ‰é™åˆ¶ã€‚</p><p>ä¸ºäº†è®© Vue çš„è§†å›¾å¯ä»¥å“åº”å®ƒçš„å˜åŒ–ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>ref</code> æ¥åŒ…è£…å®ƒã€‚<code>ref</code> åˆšå¥½ç¬¦åˆæˆ‘ä»¬çš„éœ€æ±‚ï¼Œå¯ä»¥æ”¾ç½®åŸå§‹ç±»å‹ï¼Œä¹Ÿå¯ä»¥æ˜¯å¯¹è±¡, <code>ref</code> ä¼šå°†å…¶åŒ…è£…ä¸º <code>reactive</code> ã€‚</p><p><br></p><p>åˆæ­¥å®ç°å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">export const observable: PropertyDecorator = function (target, propertyKey) &#123;</span><br><span class="line">  if (typeof target === &apos;function&apos;) &#123;</span><br><span class="line">    throw new Error(&apos;Observable cannot be used on static properties&apos;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  if (arguments.length &gt; 2 &amp;&amp; arguments[2] != null) &#123;</span><br><span class="line">    throw new Error(&apos;Observable cannot be used on methods&apos;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  const accessor: Initializer = (self) =&gt; &#123;</span><br><span class="line">    const value = ref()</span><br><span class="line"></span><br><span class="line">    return &#123;</span><br><span class="line">      get() &#123;</span><br><span class="line">        return unref(value)</span><br><span class="line">      &#125;,</span><br><span class="line">      set(val) &#123;</span><br><span class="line">        value.value = val</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // å®šä¹‰getter /setter é•¿è¿œ</span><br><span class="line">  Object.defineProperty(target, propertyKey, &#123;</span><br><span class="line">    enumerable: true,</span><br><span class="line">    configurable: true,</span><br><span class="line">    get: function () &#123;</span><br><span class="line">      // æƒ°æ€§åˆå§‹åŒ–</span><br><span class="line">      return initialIfNeed(this, propertyKey, accessor).get()</span><br><span class="line">    &#125;,</span><br><span class="line">    set: function (value) &#123;</span><br><span class="line">      initialIfNeed(this, propertyKey, accessor).set(value)</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è§£é‡Šä¸€ä¸‹ä¸Šé¢çš„ä»£ç ï¼š</p><ul><li>å°†è£…é¥°å™¨çš„ç±»å‹è®¾ç½®ä¸º <code>PropertyDecorator</code>ã€‚<blockquote><p>ğŸ“¢ å¯¹åº”çš„ç±»å‹è¿˜æœ‰ï¼š ClassDecoratorã€MethodDecoratorã€ParameterDecorator<br><br></p><p>âš ï¸ æ—§ç‰ˆ<em>è£…é¥°å™¨ä½¿ç”¨ä½ç½®ä¸Š Typescript å¹¶æ²¡ä½œç±»å‹æ£€æŸ¥ï¼Œè£…é¥°å™¨å¯ä»¥éšæ„ç”¨åœ¨ç±»ã€æ–¹æ³•ã€å±æ€§å„ç§ä½ç½®ä¸Š</em>ã€‚<br><br></p></blockquote></li><li>å¯ä»¥é€šè¿‡ <code>target</code> çš„ç±»å‹ï¼Œæ¥åˆ¤æ–­è£…é¥°å™¨ä½œç”¨äº<code>é™æ€æˆå‘˜</code>ä¸Šè¿˜æ˜¯<code>å®ä¾‹æˆå‘˜</code>ä¸Šã€‚å¦‚æœæ˜¯é™æ€æˆå‘˜ï¼Œtarget æ˜¯ç±»æœ¬èº«ï¼›å¦‚æœæ˜¯å®ä¾‹æˆå‘˜ï¼Œtarget ä¸ºç±»çš„<code>åŸå‹å¯¹è±¡(prototype)</code></li><li><p><code>å±æ€§è£…é¥°å™¨</code>åªä¼šæ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼šç±»å’Œå±æ€§åã€‚å› ä¸ºå±æ€§åœ¨æ„é€ å‡½æ•°ä¸­åˆ›å»º, åœ¨ç±»å®šä¹‰é˜¶æ®µï¼Œè·å–ä¸åˆ°æ›´å¤šä¿¡æ¯ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class A &#123;</span><br><span class="line">  foo = 1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// transpile to</span><br><span class="line">class A &#123;</span><br><span class="line">  constructor() &#123;</span><br><span class="line">    this.foo = 1</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªæ–°çš„ <code>getter</code>/<code>setter</code> æˆå‘˜, è¿™æ ·å¤–éƒ¨æ‰èƒ½é€æ˜åœ°ä½¿ç”¨ ref, ä¸éœ€è¦åŠ ä¸Š <code>.value</code> åç¼€</p></li><li><p><code>æƒ°æ€§åˆå§‹åŒ–</code> refã€‚æ—§ç‰ˆçš„è£…é¥°å™¨å¹¶æ²¡æœ‰æä¾› <code>addInitializer</code> è¿™æ ·çš„åˆå§‹åŒ–é’©å­ï¼Œæˆ‘ä»¬æ›²çº¿æ•‘å›½ï¼Œä½¿ç”¨æƒ°æ€§åˆå§‹åŒ–çš„æ–¹å¼ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const REACTIVE_CACHE = Symbol(&apos;reactive_cache&apos;)</span><br><span class="line">export interface ReactiveAccessor &#123;</span><br><span class="line">  get(): any</span><br><span class="line">  set(value: any): void</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function getReactiveCache(target: any): Record&lt;string | symbol, any&gt; &#123;</span><br><span class="line">  if (!hasProp(target, REACTIVE_CACHE)) &#123;</span><br><span class="line">    addHiddenProp(target, REACTIVE_CACHE, &#123;&#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  return target[REACTIVE_CACHE]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export type Initializer = (target: any) =&gt; ReactiveAccessor</span><br><span class="line"></span><br><span class="line">export function initialIfNeed(target: any, key: string | symbol, initializer: Initializer) &#123;</span><br><span class="line">  const cache = getReactiveCache(target)</span><br><span class="line">  // å¦‚æœå±æ€§æœªå®šä¹‰ï¼Œå°±æ‰§è¡Œåˆå§‹åŒ–</span><br><span class="line">  if (!hasProp(cache, key)) &#123;</span><br><span class="line">    cache[key] = initializer(target)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  return cache[key]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><pre><code>è¿™é‡Œæˆ‘ä»¬å°†ä¿¡æ¯ç¼“å­˜åœ¨ REACTIVE_CACHE å­—æ®µä¸­ï¼Œå®ç°æƒ°æ€§åˆå§‹åŒ–ã€‚</code></pre></li></ul><p><br><br><br><br><br></p><p>å†™ä¸ªå•å…ƒæµ‹è¯•çœ‹çœ‹:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">test(&apos;base type&apos;, () =&gt; &#123;</span><br><span class="line">  class A &#123;</span><br><span class="line">    @observable</span><br><span class="line">    str = &apos;str&apos;</span><br><span class="line"></span><br><span class="line">    @observable</span><br><span class="line">    num = 1</span><br><span class="line"></span><br><span class="line">    @observable</span><br><span class="line">    withoutInitialValue: any</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  const a = new A()</span><br><span class="line"></span><br><span class="line">  let str</span><br><span class="line">  let num</span><br><span class="line">  let withoutInitialValue</span><br><span class="line">  // ğŸ”´ åˆå§‹å€¼åº”è¯¥æ­£å¸¸è¢«è®¾ç½®</span><br><span class="line">  expect(a.str).toBe(&apos;str&apos;)</span><br><span class="line">  expect(a.num).toBe(1)</span><br><span class="line">  expect(a.withoutInitialValue).toBe(undefined)</span><br><span class="line"></span><br><span class="line">  // ğŸ”´ å±æ€§çš„å˜åŠ¨åº”è¯¥è¢«æ£€æµ‹</span><br><span class="line">  watchSyncEffect(() =&gt; &#123;</span><br><span class="line">    str = a.str</span><br><span class="line">  &#125;)</span><br><span class="line">  watchSyncEffect(() =&gt; &#123;</span><br><span class="line">    num = a.num</span><br><span class="line">  &#125;)</span><br><span class="line">  watchSyncEffect(() =&gt; &#123;</span><br><span class="line">    withoutInitialValue = a.withoutInitialValue</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  a.str = &apos;new str&apos;</span><br><span class="line">  a.num = 2</span><br><span class="line">  a.withoutInitialValue = &apos;withoutInitialValue&apos;</span><br><span class="line"></span><br><span class="line">  expect(str).toBe(&apos;new str&apos;)</span><br><span class="line">  expect(num).toBe(2)</span><br><span class="line">  expect(withoutInitialValue).toBe(&apos;withoutInitialValue&apos;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><br></p><p>ğŸ’¥ åœ¨è¾ƒæ–°çš„æ„å»ºå·¥å…·ä¸­(æ¯”å¦‚ vite)ï¼Œä¸Šè¿°çš„æµ‹è¯•å¤§æ¦‚ç‡æ— æ³•é€šè¿‡ï¼ä¸ºä»€ä¹ˆï¼Ÿ</p><p><br></p><p><strong>ç»è¿‡è°ƒè¯•ä¼šå‘ç°æˆ‘ä»¬åœ¨ observable ä¸­çš„ <code>defineProperty</code> å¹¶æ²¡æœ‰ç”Ÿæ•ˆï¼Ÿ</strong></p><p><br><br><br></p><p>é€šè¿‡é˜…è¯» Vite çš„æ–‡æ¡£å¯ä»¥æ‰¾åˆ°ä¸€äº›çº¿ç´¢ï¼Œå³ Typescript çš„ <code>[useDefineForClassFields](https://cn.vitejs.dev/guide/features.html#usedefineforclassfields)</code>:</p><blockquote><p>ä» Vite v2.5.0 å¼€å§‹ï¼Œå¦‚æœ TypeScript çš„ target æ˜¯  <code>ESNext</code>  æˆ–  <code>ES2022</code>  åŠæ›´æ–°ç‰ˆæœ¬ï¼Œæ­¤é€‰é¡¹é»˜è®¤å€¼åˆ™ä¸º  <code>true</code>ã€‚è¿™ä¸  <strong><code>[tsc</code> v4.3.2 åŠä»¥åç‰ˆæœ¬çš„è¡Œä¸º](<a href="https://github.com/microsoft/TypeScript/pull/42663" target="_blank" rel="noopener">https://github.com/microsoft/TypeScript/pull/42663</a>)</strong>  ä¸€è‡´ã€‚è¿™ä¹Ÿæ˜¯æ ‡å‡†çš„ ECMAScript çš„è¿è¡Œæ—¶è¡Œä¸º</p></blockquote><p><br></p><p><code>useDefineForClassFields</code> ä¼šæ”¹å˜<code>ç±»å®ä¾‹å±æ€§</code>çš„å®šä¹‰æ–¹å¼ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class A &#123;</span><br><span class="line">  foo = 1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// æ—§</span><br><span class="line">class A &#123;</span><br><span class="line">  constructor() &#123;</span><br><span class="line">    this.foo = 1</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// æ–°ï¼šuseDefineForClassFields</span><br><span class="line">class A &#123;</span><br><span class="line">  constructor() &#123;</span><br><span class="line">    Object.defineProperty(this, &apos;foo&apos;, &#123;</span><br><span class="line">      enumerable: true,</span><br><span class="line">      configurable: true,</span><br><span class="line">      writable: true,</span><br><span class="line">      value: 1,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬è£…é¥°å™¨å†…çš„ <code>defineProperty</code> æ— æ³•ç”Ÿæ•ˆçš„åŸå› ã€‚</p><p><br><br><br></p><p>è§£å†³åŠæ³•ï¼š</p><p>æ–¹æ³• 1ï¼š æ˜¾å¼å…³é—­æ‰ useDefineForClassFieldsã€‚å¦‚æœæ˜¯ Babel éœ€è¦é…ç½® <code>@babel/plugin-transform-class-properties</code> çš„ <code>loose</code> ä¸º trueï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;plugins&quot;: [</span><br><span class="line">    [&quot;@babel/plugin-proposal-decorators&quot;, &#123; &quot;version&quot;: &quot;legacy&quot; &#125;]</span><br><span class="line">    [&quot;@babel/plugin-transform-class-properties&quot;, &#123;&quot;loose&quot;: true &#125;]</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br><br><br></p><p>æ–¹æ³• 2ï¼š æˆ–è€…æ¨¡ä»¿ <a href="https://www.mobxjs.com/enabling-decorators" target="_blank" rel="noopener">MobX V6</a> çš„ API:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class TodoList &#123;</span><br><span class="line">  @observable todos = []</span><br><span class="line"></span><br><span class="line">  @computed</span><br><span class="line">  get unfinishedTodoCount() &#123;</span><br><span class="line">    return this.todos.filter((todo) =&gt; !todo.finished).length</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  constructor() &#123;</span><br><span class="line">    makeObservable(this)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>MobX çš„ observableã€computed ç­‰è£…é¥°å™¨åªæ˜¯æ”¶é›†äº†ä¸€äº›<strong><code>æ ‡è®°ä¿¡æ¯</code>ï¼Œ</strong> æœ¬èº«ä¸ä¼šå¯¹ç±»è¿›è¡Œè½¬æ¢ï¼ŒçœŸæ­£è¿›è¡Œè½¬æ¢æ˜¯åœ¨ <code>makeObservable</code> ä¸­è¿›è¡Œçš„ï¼Œ è€Œ <code>makeObservable</code> çš„æ‰§è¡Œæ—¶æœºæ˜¯åœ¨æ‰€æœ‰å±æ€§éƒ½åˆå§‹åŒ–å®Œæ¯•ä¹‹åã€‚</p><p>ç”±äºæœ¬æ–‡åªå…³æ³¨è£…é¥°å™¨çš„èƒ½åŠ›ï¼Œè¿™é‡Œå°±ä¸å±•å¼€äº†ï¼Œæœ‰å…´è¶£çš„è¯»è€…å¯ä»¥çœ‹ä¸‹ MobX çš„æºç ã€‚</p><p><br><br><br><br><br></p><h3 id="computed"><a href="#computed" class="headerlink" title="@computed"></a>@computed</h3><p>æŒ‰ç…§åŒæ ·çš„æ–¹æ³•ï¼Œæˆ‘ä»¬æ¥å®ç°ä¸€ä¸‹ <code>@computed</code> è£…é¥°å™¨ï¼ŒMobX çš„ computed å’Œ Vue çš„ computed æ¦‚å¿µåŸºæœ¬ä¸€è‡´ï¼Œå°±æ˜¯ç”¨æ¥åšè¡ç”Ÿæ•°æ®çš„è®¡ç®—ã€‚</p><p><br></p><p>@computed åªèƒ½åº”ç”¨åœ¨ <code>getter</code> ä¸Šé¢:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">export const computed: MethodDecorator = function (target, propertyKey, descriptor) &#123;</span><br><span class="line">  // ä¸æ”¯æŒ static</span><br><span class="line">  if (typeof target === &apos;function&apos;) &#123;</span><br><span class="line">    throw new Error(&apos;computed cannot be used on static member&apos;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // å¿…é¡»æ˜¯ getter</span><br><span class="line">  if (</span><br><span class="line">    descriptor == null ||</span><br><span class="line">    typeof descriptor !== &apos;object&apos; ||</span><br><span class="line">    typeof descriptor.get !== &apos;function&apos;</span><br><span class="line">  ) &#123;</span><br><span class="line">    throw new Error(&apos;computed can only be used on getter&apos;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  const initialGetter = descriptor.get</span><br><span class="line">  const accessor: Initializer = (self) =&gt; &#123;</span><br><span class="line">    const value = vueComputed(() =&gt; initialGetter.call(self))</span><br><span class="line"></span><br><span class="line">    return &#123;</span><br><span class="line">      get() &#123;</span><br><span class="line">        return unref(value)</span><br><span class="line">      &#125;,</span><br><span class="line">      set() &#123;</span><br><span class="line">        // readonly</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  descriptor.get = function () &#123;</span><br><span class="line">    // æƒ°æ€§åˆå§‹åŒ–</span><br><span class="line">    return initialIfNeed(this, propertyKey, accessor).get()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>getter/setter/method è£…é¥°å™¨çš„ç”¨æ³•ä¸€è‡´ã€‚ä¼šæ¥æ”¶ <code>descriptor</code> ä½œä¸ºç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹ <code>descriptor</code> è¿›è¡Œä¿®æ”¹ï¼Œæˆ–è€…è¿”å›ä¸€ä¸ªæ–°çš„ <code>descriptor</code>ã€‚</li><li>æˆ‘ä»¬ä½¿ç”¨ vue çš„ computed API å¯¹ getter å‡½æ•°è¿›è¡Œç®€å•åŒ…è£…ã€‚</li></ul><p><br><br><br></p><p>æµ‹è¯•ä¸€ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">test(&apos;computed&apos;, () =&gt; &#123;</span><br><span class="line">  const count = ref(0)</span><br><span class="line">  class A &#123;</span><br><span class="line">    @computed</span><br><span class="line">    get double() &#123;</span><br><span class="line">      return count.value * 2</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  const a = new A()</span><br><span class="line">  let value</span><br><span class="line">  watchSyncEffect(() =&gt; &#123;</span><br><span class="line">    value = a.double</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  expect(value).toBe(0)</span><br><span class="line">  count.value++</span><br><span class="line">  expect(value).toBe(2)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>Ok, æ²¡é—®é¢˜ï¼Œå¯ä»¥æ­£å¸¸è¿è¡Œã€‚æˆ‘ä»¬é…åˆç»„ä»¶çš„å®é™…åœºæ™¯å†æµ‹è¯•çœ‹çœ‹ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">test(&apos;render&apos;, () =&gt; &#123;</span><br><span class="line">  class A &#123;</span><br><span class="line">    @observable</span><br><span class="line">    count = 1</span><br><span class="line"></span><br><span class="line">    @computed</span><br><span class="line">    get double() &#123;</span><br><span class="line">      return this.count * 2</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  let count</span><br><span class="line">  const a = new A()</span><br><span class="line"></span><br><span class="line">  const Comp = defineComponent(&#123;</span><br><span class="line">    setup() &#123;</span><br><span class="line">      watchSyncEffect(() =&gt; &#123;</span><br><span class="line">        count = a.double</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">      return () =&gt; &#123;</span><br><span class="line">        /* ignore */</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  const &#123; unmount &#125; = render(Comp)</span><br><span class="line"></span><br><span class="line">  let count2</span><br><span class="line">  watchSyncEffect(() =&gt; &#123;</span><br><span class="line">    count2 = a.double</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  expect(count).toBe(2)</span><br><span class="line">  expect(count2).toBe(2)</span><br><span class="line"></span><br><span class="line">  a.count++</span><br><span class="line">  expect(count).toBe(4)</span><br><span class="line">  expect(count2).toBe(4)</span><br><span class="line"></span><br><span class="line">  // ğŸ”´ å¸è½½</span><br><span class="line">  unmount()</span><br><span class="line"></span><br><span class="line">  a.count++</span><br><span class="line">  expect(count).toBe(4)</span><br><span class="line">  // ğŸ’¥ received 4</span><br><span class="line">  expect(count2).toBe(6)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><br></p><p>ä¸Šé¢çš„ç”¨ä¾‹æ²¡æœ‰é€šè¿‡ï¼Œ<strong>åœ¨ç»„ä»¶å¸è½½ä¹‹åï¼Œ@computed è£…é¥°çš„ double å°±å¤±å»äº†å“åº”æ€§</strong>ã€‚Why?</p><p><br><br><br></p><p>è§£å†³è¿™ä¸ªé—®é¢˜ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£ä¸€ä¸‹ <code>[effectScope](https://cn.vuejs.org/api/reactivity-advanced.html#effectscope)</code>, <code>effectScope</code> åˆ›å»ºä¸€ä¸ª <code>effect ä½œç”¨åŸŸ</code>ï¼Œå¯ä»¥æ•è·å…¶ä¸­æ‰€åˆ›å»ºçš„å“åº”å¼å‰¯ä½œç”¨ (å³è®¡ç®—å±æ€§å’Œä¾¦å¬å™¨)ï¼Œè¿™æ ·æ•è·åˆ°çš„å‰¯ä½œç”¨å¯ä»¥ä¸€èµ·å¤„ç†å’Œé”€æ¯ã€‚</p><p><br></p><p><strong>Vue <code>setup</code> å°±æ˜¯åŒ…è£…åœ¨ effectScope ä¹‹ä¸‹ï¼Œå¦‚æœæˆ‘ä»¬çš„ computed åœ¨ setup ä¸‹è¢«åˆå§‹åŒ–ï¼Œå°±ä¼šè¢« setup æ•è·ï¼Œå½“ç»„ä»¶å¸è½½æ—¶å°±ä¼šè¢«éšä¹‹æ¸…ç†æ‰</strong>ã€‚</p><p><br></p><p>æˆ‘ä»¬çš„ <code>@computed</code> æ˜¯ä¸ºå…¨å±€ä½œç”¨åŸŸè®¾è®¡çš„ï¼Œä¸èƒ½å› ä¸ºæŸä¸ªç»„ä»¶å¸è½½è€Œè¢«é”€æ¯æ‰ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦è‡ªå·±æ„é€ ä¸€ä¸ªç‹¬ç«‹çš„ <code>æ‚¬æŒ‚ effectScope</code> (<code>Detached effectScope</code> )ï¼š</p><figure class="highlight diff"><table><tr><td class="code"><pre><span class="line">const accessor: Initializer = (self) =&gt; &#123;</span><br><span class="line"><span class="addition">+   // true æ ‡è®°ä¸º detached</span></span><br><span class="line"><span class="addition">+   const scope = effectScope(true)</span></span><br><span class="line"><span class="deletion">-   const value = vueComputed(() =&gt; initialGetter.call(self))</span></span><br><span class="line"><span class="addition">+   const value = scope.run(() =&gt; vueComputed(() =&gt; initialGetter.call(self)))</span></span><br><span class="line"></span><br><span class="line">    return &#123;</span><br><span class="line">      get() &#123;</span><br><span class="line">        return unref(value)</span><br><span class="line">      &#125;,</span><br><span class="line">      set() &#123;</span><br><span class="line">        // readonly</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p><br></p><blockquote><p>ğŸ’¡ watch ä¹Ÿä¼šæœ‰ç›¸åŒçš„é—®é¢˜ï¼Œè¯»è€…å¯ä»¥è‡ªè¡Œå°è¯•ä¸€ä¸‹</p></blockquote><p><br></p><p>ğŸ’¥ <strong>ä¼šä¸ä¼šå†…å­˜æ³„éœ²ï¼Ÿ</strong>ç†è®ºä¸Šä¼šæ³„éœ²ï¼Œå–å†³äºè¢« computed è®¢é˜…çš„æ•°æ®æºã€‚å¦‚æœè¯¥è®¢é˜…æºé•¿æœŸæœªé‡Šæ”¾ï¼Œå¯èƒ½ä¼šå‡ºç°å†…å­˜æ³„éœ²ã€‚<br><br></p><p>è§£å†³åŠæ³•æ˜¯å°†å¯¹åº”çš„<code>ç±»å®ä¾‹</code>å’Œ<code>ç»„ä»¶</code>çš„ç”Ÿå‘½å‘¨æœŸç»‘å®šã€‚å½“ç»„ä»¶é‡Šæ”¾æ—¶ï¼Œè°ƒç”¨ç±»å®ä¾‹çš„é‡Šæ”¾æ–¹æ³•ï¼Œä¾‹å¦‚ï¼š</p><p><br></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const providerStore = &lt;T,&gt;(store: new () =&gt; T): T =&gt; &#123;</span><br><span class="line">  const instance = new store()</span><br><span class="line">  // å°†ç»„ä»¶çš„ effectScope ä¼ å…¥å®ä¾‹ä¸­è¿›è¡Œç»‘å®š</span><br><span class="line">  instance.__effect_scope__ = getCurrentScope()</span><br><span class="line">  return instance</span><br><span class="line">&#125;</span><br><span class="line">// computed å®ç°è°ƒæ•´</span><br><span class="line">const scope = target.__effect_scope__ ?? effectScope(true)</span><br><span class="line">// åœ¨ setup ä¸­è°ƒç”¨</span><br><span class="line">const store = providerStore(Store)</span><br></pre></td></tr></table></figure><p><br><br>æ¯”å¦‚ <code>å…¨å±€Store</code> å¯ä»¥å’Œ <code>Vue App</code> ç»‘å®šï¼Œ<code>é¡µé¢ Store</code> å¯ä»¥å’Œ<code>é¡µé¢ç»„ä»¶</code>ç»‘å®šã€‚<br><br><br>ğŸ”´ <strong>MobX computed å¹¶æ²¡æœ‰è¯¥é—®é¢˜ï¼ŒMobX çš„ computed åœ¨<code>è®¢é˜…è€…</code>æ¸…ç©ºæ—¶ï¼Œä¼šã€Œ<code>æŒ‚èµ·</code>(suspend)ã€ï¼Œæ¸…ç©ºè‡ªå·±çš„<code>è®¢é˜…</code>(é™¤éæ˜¾å¼è®¾ç½®äº† keepAlive)ï¼Œä»è€Œå¯ä»¥è§„é¿è¿™ç§å†…å­˜æ³„éœ²ã€‚è¯¦è§<a href="https://github.com/mobxjs/mobx/blob/27efa3cc637e3195589874990c23d4de82c12072/packages/mobx/src/core/observable.ts%23L124" target="_blank" rel="noopener">è¿™é‡Œ</a>ã€‚<br>åªèƒ½çœ‹åç»­ Vue å®˜æ–¹æ˜¯å¦ä¹Ÿä½œç±»ä¼¼çš„æ”¯æŒäº†ã€‚</strong></p><p><br><br><br></p><hr><p><br><br><br></p><h2 id="new"><a href="#new" class="headerlink" title="New"></a>New</h2><p>2022/3 è£…é¥°å™¨è®®æ¡ˆæ­£å¼è¿›å…¥ Stage 3 é˜¶æ®µï¼ŒæŒ‰ç…§æƒ¯ä¾‹ï¼ŒTypescript ä¹Ÿåœ¨ 5.0 ç‰ˆæœ¬åŠ å…¥äº†è¯¥åŠŸèƒ½ã€‚</p><p>æ–°ç‰ˆè£…é¥°å™¨å¤–å½¢å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">type Decorator = (</span><br><span class="line">  value: Input,</span><br><span class="line">  context: &#123;</span><br><span class="line">    kind: string</span><br><span class="line">    name: string | symbol</span><br><span class="line">    access: &#123;</span><br><span class="line">      get?(): unknown</span><br><span class="line">      set?(value: unknown): void</span><br><span class="line">    &#125;</span><br><span class="line">    private?: boolean</span><br><span class="line">    static?: boolean</span><br><span class="line">    addInitializer?(initializer: () =&gt; void): void</span><br><span class="line">  &#125;</span><br><span class="line">) =&gt; Output | void</span><br></pre></td></tr></table></figure><p><br></p><p>ç›¸æ¯”æ—§ç‰ˆçš„è£…é¥°å™¨ï¼Œæ–°ç‰ˆçš„ API å½¢å¼ä¸Šæ›´åŠ ç»Ÿä¸€äº†ï¼Œå¹¶ä¸”æä¾›äº†ä¸€äº›ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œå¯¹äºå¼€å‘è€…æ¥è¯´æ›´åŠ ä¾¿åˆ©ã€‚</p><p><br><br><br></p><p>æ ¸å¿ƒçš„å˜åŒ–å¦‚ä¸‹ï¼š</p><ul><li><p>å½¢å¼ä¸Šæ›´åŠ ç»Ÿä¸€ï¼Œä¸ç®¡æ˜¯ä»€ä¹ˆä½ç½®ï¼Œéƒ½éµå¾ª <code>(value, context) â‡’ output | void</code>ï¼Œ è¿™ä¸ªå¿ƒæ™ºä¸Šæ›´æ¥è¿‘<code>ç®¡é“(pipe)</code>, æ¥æ”¶ä¸€ä¸ª Value , å¯ä»¥è¿”å›ä¸€ä¸ªæ–°çš„ Value æ¥<strong>æ›¿æ¢æ—§çš„ Value</strong>ã€‚<br><img src="/images/decorator/Untitled%201.png" alt="linux ç®¡é“"><br>linux ç®¡é“</p><p><br></p></li><li><p><code>context</code> æä¾›äº†å¿…è¦çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œå¯¹å¼€å‘è€…æ¥è¯´æ›´åŠ ä¾¿åˆ©ï¼Œå¯ä»¥å¿«é€Ÿåˆ¤æ–­è£…é¥°å™¨çš„ç±»å‹ã€æ˜¯å¦ä¸ºé™æ€å±æ€§ã€ç§æœ‰å±æ€§ç­‰ç­‰ã€‚</p></li><li><p>æ›´å€¾å‘äºå°†è£…é¥°å™¨å½“åšä¸€ä¸ªçº¯å‡½æ•°(ç®¡é“ã€è½¬æ¢å™¨)æ¥ä½¿ç”¨ï¼Œå°½é‡ä¸åŒ…å«å‰¯ä½œç”¨(æ¯”å¦‚ä¿®æ”¹ç±»çš„ç»“æ„)ã€‚</p><p><br></p><p><strong>ä¸ºäº†é™åˆ¶å‰¯ä½œç”¨ï¼Œè£…é¥°å™¨åŸºæœ¬ä¸Šå±è”½äº†ä¸€äº›åº•å±‚ç»†èŠ‚ï¼Œæ¯”å¦‚ descriptorï¼Œæ„é€ å‡½æ•°ã€åŸå‹å¯¹è±¡ï¼Œè¿™äº›åœ¨æ–°çš„è£…é¥°å™¨ä¸­åŸºæœ¬æ‹¿ä¸åˆ°ã€‚</strong></p><p><br></p><p>å‰¯ä½œç”¨åªèƒ½åœ¨ <code>context.addInitializer</code> ä¸­è°ƒç”¨ï¼Œä½†æ˜¯èƒ½åŠ›ä¹Ÿéå¸¸æœ‰é™ã€‚å°±æ‹¿<code>å±æ€§è£…é¥°å™¨</code>æ¥ä¸¾ä¾‹ï¼Œinitializer é€šå¸¸åœ¨ class å†…ç½®çš„ defineProperty ä¹‹å‰è°ƒç”¨ï¼Œå¦‚æœä½ åœ¨ <code>initializer</code> ä¸­ä½¿ç”¨äº† <code>defineProperty</code>ï¼Œé‚£ä¹ˆå°†è¢«è¦†ç›–:</p><p>ä»¥ Typescript çš„ç¼–è¯‘ç»“æœä¸ºä¾‹ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class Bar &#123;</span><br><span class="line">  @d</span><br><span class="line">  foo = 1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// ç¼–è¯‘ç»“æœï¼š</span><br><span class="line">let Bar = (() =&gt; &#123;</span><br><span class="line">    var _a;</span><br><span class="line">    let _instanceExtraInitializers_1 = [];</span><br><span class="line">    let _foo_decorators;</span><br><span class="line">    let _foo_initializers = [];</span><br><span class="line">    return _a = class Bar &#123;</span><br><span class="line">            constructor() &#123;</span><br><span class="line">                // ğŸ”´ â‘¢ å®šä¹‰å±æ€§</span><br><span class="line">                Object.defineProperty(this, &quot;foo&quot;, &#123;</span><br><span class="line">                    enumerable: true,</span><br><span class="line">                    configurable: true,</span><br><span class="line">                    writable: true,</span><br><span class="line">                    value:</span><br><span class="line">                      // ğŸ”´ â‘  å…ˆæ‰§è¡Œå…¶ä»–è£…é¥°å™¨çš„ addInitializer å›è°ƒ</span><br><span class="line">                      (__runInitializers(this, _instanceExtraInitializers_1),</span><br><span class="line">                        // ğŸ”´ â‘¡ å±æ€§è£…é¥°å™¨çš„ initializer</span><br><span class="line">                        __runInitializers(this, _foo_initializers, 1))</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        (() =&gt; &#123;</span><br><span class="line">            _foo_decorators = [d];</span><br><span class="line">            __esDecorate(null, null, _foo_decorators, &#123; kind: &quot;field&quot;, name: &quot;foo&quot;, static: false, private: false, access: &#123; has: obj =&gt; &quot;foo&quot; in obj, get: obj =&gt; obj.foo, set: (obj, value) =&gt; &#123; obj.foo = value; &#125; &#125; &#125;, _foo_initializers, _instanceExtraInitializers_1);</span><br><span class="line">        &#125;)(),</span><br><span class="line">        _a;</span><br></pre></td></tr></table></figure></li></ul><p><br></p><p>è¿™æ ·åšçš„å¥½å¤„ï¼Œç¬”è€…è®¤ä¸ºä¸»è¦æœ‰ä»¥ä¸‹å‡ ç‚¹:</p><ul><li>æ€§èƒ½ä¼˜åŒ–ï¼šæ—§ç‰ˆçš„è£…é¥°å™¨å¯ä»¥å¯¹ class è¿›è¡Œé­”æ”¹ï¼Œè¿™å°±å¯¼è‡´äº†å¼•æ“åœ¨è§£æå®Œ Class ä½“åå†å»æ‰§è¡Œè£…é¥°å™¨æ—¶ï¼Œæœ€ç»ˆçš„ Class ç»“æ„å¯èƒ½å‘ç”Ÿè¾ƒå¤§çš„æ”¹å˜ï¼Œå¯¼è‡´å¼•æ“çš„ä¼˜åŒ–æ— æ³•ç”Ÿæ•ˆï¼ˆæ¥æºï¼š<a href="https://developer.aliyun.com/article/892441" target="_blank" rel="noopener">ECMAScript åŒæœˆæŠ¥å‘Šï¼šè£…é¥°å™¨ææ¡ˆè¿›å…¥ Stage 3</a>ï¼‰ã€‚</li><li>å› ä¸ºæ—§ç‰ˆå¯èƒ½ä¼šå¯¹ç±»çš„ç»“æ„è¿›è¡Œç ´åæ€§é­”æ”¹ï¼Œè¿™ç§å‰¯ä½œç”¨å¯èƒ½å¯¼è‡´å¤šä¸ªè£…é¥°å™¨ç»„åˆæ—¶ï¼Œæœ‰éš¾ä»¥é¢„æœŸçš„é—®é¢˜ã€‚</li><li>æ›´å®¹æ˜“æµ‹è¯•</li></ul><p><br></p><p><strong>å¦å¤– Typescript é’ˆå¯¹æ–°çš„è£…é¥°å™¨ä¹Ÿæä¾›äº†æ›´ä¸¥æ ¼çš„ç±»å‹æ£€æŸ¥ï¼Œæ¯”å¦‚å¯ä»¥çº¦æŸè£…é¥°å™¨ä½¿ç”¨çš„ä½ç½®ï¼Œæ—§ç‰ˆå¯ä»¥ä½¿ç”¨åœ¨ä»»æ„ä½ç½®ï¼Œåªèƒ½é€šè¿‡è¿è¡Œæ—¶è¿›è¡Œæ£€æŸ¥</strong>ã€‚</p><p><img src="/images/decorator/Untitled%202.png" alt="Typescript ä¸ºæ–°ç‰ˆè£…é¥°å™¨æä¾›äº†æ›´ä¸¥æ ¼çš„ç±»å‹æ£€æŸ¥"></p><p>Typescript ä¸ºæ–°ç‰ˆè£…é¥°å™¨æä¾›äº†æ›´ä¸¥æ ¼çš„ç±»å‹æ£€æŸ¥</p><p><br></p><blockquote><p>ğŸ’¡  ç›®å‰è£…é¥°å™¨è¿˜æœªæˆä¸ºæ­£å¼çš„è¯­è¨€ç‰¹æ€§ï¼Œä¸æ’é™¤åé¢è¿˜æœ‰ç‰¹æ€§å˜æ›´ã€‚</p></blockquote><p><br></p><blockquote><p>ğŸ’¡  æˆªæ­¢è‡³æ–‡ç« å‘å¸ƒçš„æ—¶é—´ï¼ŒVite ä½¿ç”¨æ–°ç‰ˆè£…é¥°å™¨è¿˜æœ‰ä¸€äº›é—®é¢˜ã€‚æœ¬æ–‡ä½¿ç”¨ Babel + Jest æ¥æµ‹è¯•ç›¸å…³ä»£ç ã€‚</p></blockquote><p><br><br><br><br><br></p><h3 id="observable-1"><a href="#observable-1" class="headerlink" title="@observable"></a>@observable</h3><p>æ–°ç‰ˆçš„<code>å±æ€§è£…é¥°å™¨</code> API å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">type ClassFieldDecorator = (</span><br><span class="line">  value: undefined,</span><br><span class="line">  context: &#123;</span><br><span class="line">    kind: &apos;field&apos;</span><br><span class="line">    name: string | symbol</span><br><span class="line">    access: &#123; get(): unknown; set(value: unknown): void &#125;</span><br><span class="line">    static: boolean</span><br><span class="line">    private: boolean</span><br><span class="line">  &#125;</span><br><span class="line">) =&gt; (initialValue: unknown) =&gt; unknown | void</span><br></pre></td></tr></table></figure><ul><li>value å§‹ç»ˆä¸º undefinedï¼Œå› ä¸ºå±æ€§åœ¨ç±»å®šä¹‰æ—¶ä¸å­˜åœ¨ï¼Œæ— æ³•è·å–åˆ°åˆå§‹å€¼</li><li>context æ²¡æœ‰ <code>addInitializer</code> ã€‚å±æ€§è£…é¥°å™¨çš„è¿”å›å€¼æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå®é™…ä¸Šå°±æ˜¯ä¸€ä¸ª <code>initializer</code></li><li>è®¿é—®ä¸åˆ°ç±»å’Œç±»çš„åŸå‹</li><li>åœ¨ initializer ä¸­ä¹Ÿä¸èƒ½è°ƒç”¨ definePropertyã€‚åŸå› è§ä¸Šæ–‡</li></ul><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>å±æ€§è£…é¥°å™¨åŸºæœ¬ä¸Šå µæ­»äº†æˆ‘ä»¬å»æ”¹é€ å±æ€§çš„æœºä¼š</strong>â€¦</p><p><br><br><br></p><hr><p><br></p><p>ä¸”æ…¢ï¼Œè·Ÿéšè£…é¥°å™¨å‘å¸ƒçš„è¿˜æœ‰ä¸€ä¸ª<code>è‡ªåŠ¨è®¿é—®å™¨</code>(Auto Accessor)çš„ç‰¹æ€§(ğŸ™‚  è¶Šæ¥è¶Šåƒ Javaã€C# äº†ï¼‰</p><p>è‡ªåŠ¨è®¿é—®å™¨ä½¿ç”¨ <code>accessor</code> å…³é”®å­—å®šä¹‰ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class C &#123;</span><br><span class="line">  accessor x = 1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç›¸å½“äºï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class C &#123;</span><br><span class="line">  #x = 1</span><br><span class="line"></span><br><span class="line">  get x() &#123;</span><br><span class="line">    return this.#x</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  set x(val) &#123;</span><br><span class="line">    this.#x = val</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æœ‰å•¥ç”¨ï¼Ÿç¨å®‰å‹¿èºï¼Œå®ƒåœ¨è£…é¥°å™¨åœºæ™¯æœ‰å¤§ç”¨ï¼Œå…ˆæ¥çœ‹ä¸‹å®ƒçš„ API:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">type ClassAutoAccessorDecorator = (</span><br><span class="line">  value: &#123;</span><br><span class="line">    get: () =&gt; unknown;</span><br><span class="line">    set(value: unknown) =&gt; void;</span><br><span class="line">  &#125;,</span><br><span class="line">  context: &#123;</span><br><span class="line">    kind: &quot;accessor&quot;;</span><br><span class="line">    name: string | symbol;</span><br><span class="line">    access: &#123; get(): unknown, set(value: unknown): void &#125;;</span><br><span class="line">    static: boolean;</span><br><span class="line">    private: boolean;</span><br><span class="line">    addInitializer(initializer: () =&gt; void): void;</span><br><span class="line">  &#125;</span><br><span class="line">) =&gt; &#123;</span><br><span class="line">  get?: () =&gt; unknown;</span><br><span class="line">  set?: (value: unknown) =&gt; void;</span><br><span class="line">  init?: (initialValue: unknown) =&gt; unknown;</span><br><span class="line">&#125; | void;</span><br></pre></td></tr></table></figure><ul><li>value æ¥æ”¶ getter å’Œ setter</li><li>å¯ä»¥è¿”å›æ–°çš„ getter å’Œ setter</li><li>init å¯ä»¥å¯¹åˆå§‹å€¼è¿›è¡Œ<strong>_è½¬æ¢_</strong>ã€‚</li></ul><p><br><br><br></p><p>å®ƒçš„å¦™ç”¨åœ¨äºï¼Œæˆ‘ä»¬å¯ä»¥ã€Œå…µä¸è¡€åˆƒã€(ä¸æ”¹å˜ç»“æ„æˆ–è€…æ–°å¢å±æ€§)åœ°å®ç°æ‹¦æˆªï¼Œçœ‹çœ‹æˆ‘ä»¬ observable çš„å®ç°å°±çŸ¥é“äº†ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">export function observable&lt;This, Value&gt;(</span><br><span class="line">  value: ClassAccessorDecoratorTarget&lt;This, Value&gt;,</span><br><span class="line">  context: ClassAccessorDecoratorContext&lt;This, Value&gt;</span><br><span class="line">): ClassAccessorDecoratorResult&lt;This, Value&gt; | void &#123;</span><br><span class="line">  if (context.kind !== &apos;accessor&apos;) &#123;</span><br><span class="line">    throw new Error(&apos;observable can only be used on accessor&apos;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  if (context.static) &#123;</span><br><span class="line">    throw new Error(&apos;observable can not be used on static accessor&apos;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  return &#123;</span><br><span class="line">    init(val) &#123;</span><br><span class="line">      return ref(val)</span><br><span class="line">    &#125;</span><br><span class="line">    get() &#123;</span><br><span class="line">      return (value.get.call(this) as Ref&lt;Value&gt;).value</span><br><span class="line">    &#125;,</span><br><span class="line">    set(val) &#123;</span><br><span class="line">      const ref = value.get.call(this) as Ref&lt;Value&gt;</span><br><span class="line"></span><br><span class="line">      ref.value = val</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><ul><li>é€šè¿‡ <code>context</code>ï¼Œæˆ‘ä»¬å¯ä»¥æ›´æ–¹ä¾¿åœ°åˆ¤æ–­æ˜¯å¦æ˜¯é™æ€æˆå‘˜ã€æ˜¯å¦è£…é¥°åœ¨é¢„æœŸçš„ä½ç½®</li><li>ä¸Šè¿°ä»£ç æˆ‘ä»¬æ²¡æœ‰ä¿®æ”¹ä»»ä½•ç±»çš„ç»“æ„ã€æ–°å¢ä»»ä½•å±æ€§ã€‚æˆ‘ä»¬ç›´æ¥åœ¨ init ä¸­å°†åˆå§‹å€¼è½¬æ¢ä¸º ref, ç›¸å¯¹åº”çš„ getter/setter ä¹Ÿä½œç®€å•çš„æ”¹é€ ã€‚</li></ul><p><br></p><p>å¾ˆç®€å•æ˜¯ä¸æ˜¯ï¼Ÿåªä¸è¿‡ï¼Œè¿™ä¸ªå¯¹å·²æœ‰çš„ä»£ç å€¾å…¥æ€§å¤ªå¤§äº†ï¼Œæ‰€æœ‰ç›¸å…³çš„å±æ€§éƒ½éœ€è¦ä¿®æ”¹ä¸º <code>accessor</code>, ä½†å¯¹äº API ä½¿ç”¨è€…æ¥è¯´æ²¡ä»€ä¹ˆåŒºåˆ«ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class A &#123;</span><br><span class="line">  @observable</span><br><span class="line">  accessor obj = &#123;</span><br><span class="line">    count: 1,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br><br><br><br><br></p><h3 id="computed-1"><a href="#computed-1" class="headerlink" title="@computed"></a>@computed</h3><p>Getter è£…é¥°å™¨å’Œ Setterã€Method è£…é¥°å™¨ç±»å‹åŸºæœ¬ä¸€è‡´ï¼š</p><p><br></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">type ClassGetterDecorator = (</span><br><span class="line">  value: Function,</span><br><span class="line">  context: &#123;</span><br><span class="line">    kind: &apos;getter&apos;</span><br><span class="line">    name: string | symbol</span><br><span class="line">    access: &#123; get(): unknown &#125;</span><br><span class="line">    static: boolean</span><br><span class="line">    private: boolean</span><br><span class="line">    addInitializer(initializer: () =&gt; void): void</span><br><span class="line">  &#125;</span><br><span class="line">) =&gt; Function | void</span><br></pre></td></tr></table></figure><p><br><br><br></p><p>ç›´æ¥æ¥çœ‹ computed å®ç°ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">export function computed&lt;This, Return, Value extends () =&gt; Return&gt;(</span><br><span class="line">  value: Value,</span><br><span class="line">  context: ClassGetterDecoratorContext&lt;This, Return&gt;</span><br><span class="line">): Value | void &#123;</span><br><span class="line">  if (context.static) &#123;</span><br><span class="line">    throw new Error(&apos;computed cannot be used on static member&apos;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  if (context.kind !== &apos;getter&apos;) &#123;</span><br><span class="line">    throw new Error(&apos;computed can only be used on getter&apos;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  context.addInitializer(function (this: unknown) &#123;</span><br><span class="line">    const scope = effectScope(true)</span><br><span class="line"></span><br><span class="line">    const val = scope.run(() =&gt; vueComputed(() =&gt; value.call(this)))</span><br><span class="line"></span><br><span class="line">    Object.defineProperty(this, context.name, &#123;</span><br><span class="line">      configurable: true,</span><br><span class="line">      enumerable: false,</span><br><span class="line">      get() &#123;</span><br><span class="line">        return unref(val)</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br><br><br></p><p>é€šè¿‡ <code>addInitializer</code> æ¥æ·»åŠ åˆå§‹åŒ–é€»è¾‘(å‰¯ä½œç”¨)ï¼Œ this ä¸ºå½“å‰ç±»çš„å®ä¾‹ã€‚æ—§ç‰ˆçš„è£…é¥°å™¨å¹¶æ²¡æœ‰æä¾›ç±»ä¼¼çš„æ—¶æœºï¼Œæˆ‘ä»¬åªèƒ½é€šè¿‡<code>æƒ°æ€§åˆå§‹åŒ–</code>å»æ¨¡æ‹Ÿè¿™ç§æ•ˆæœã€‚</p><p><br></p><p>ä¸è¿‡ä¸Šé¢çš„ç¨‹åºä¹Ÿæœ‰ä¸ªæ½œåœ¨çš„ BUG, æˆ‘ä»¬åœ¨æ–°å»ºä¸€ä¸ª log è£…é¥°å™¨ï¼Œç»„åˆåœ¨ä¸€èµ·çœ‹çœ‹ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">function log(value: Function, context: ClassGetterDecoratorContext) &#123;</span><br><span class="line">  return function (this: unknown) &#123;</span><br><span class="line">    console.log(&apos;start calling...&apos;)</span><br><span class="line">    return value.apply(this)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class A &#123;</span><br><span class="line">  @observable</span><br><span class="line">  accessor count = 1</span><br><span class="line"></span><br><span class="line">  @log</span><br><span class="line">  @computed</span><br><span class="line">  get double() &#123;</span><br><span class="line">    return this.count * 2</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œä¸Šè¿°ä»£ç ï¼Œæˆ‘ä»¬ä¼šå‘ç°å¹¶æ²¡æœ‰æ‰“å° <code>start calling...</code> é‚ªæ¶çš„å‰¯ä½œç”¨â€¦</p><p><br><br><br></p><p>ä¸»è¦åŸå› æ˜¯ä¸Šè¿°ä»£ç æˆ‘ä»¬åœ¨ <code>addInitializer</code> ä¸­å¼•ç”¨çš„ â€˜valueâ€™ æ˜¯ç±»åŸå§‹çš„ getter å€¼ï¼Œè€Œæˆ‘ä»¬åˆé‡æ–°ç”¨ defineProperty è¦†ç›–äº†å±æ€§ï¼Œå¯¼è‡´ @log è£…é¥°çš„å€¼ä¸¢å¤±äº†ã€‚</p><p><br></p><p>å®é™…ä¸Šåœ¨æ–°ç‰ˆçš„è£…é¥°å™¨ä¸­ï¼Œæ›´ç¬¦åˆè§„èŒƒçš„ç”¨æ³•æ˜¯ï¼š<strong>è¿”å›æ–°çš„å€¼æ¥æ›¿æ¢æ—§çš„å€¼</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const COMPUTED_CACHE: unique symbol = Symbol(&apos;computed_cache&apos;)</span><br><span class="line"></span><br><span class="line">export function computed&lt;This, Return, Value extends () =&gt; Return&gt;(</span><br><span class="line">  value: Value,</span><br><span class="line">  context: ClassGetterDecoratorContext&lt;This, Return&gt;</span><br><span class="line">): Value | void &#123;</span><br><span class="line">  // ...</span><br><span class="line"></span><br><span class="line">  // ğŸ”´ åˆå§‹åŒ–ç¼“å­˜å¯¹è±¡</span><br><span class="line">  context.addInitializer(function (this: unknown) &#123;</span><br><span class="line">    if (!Object.prototype.hasOwnProperty.call(this, COMPUTED_CACHE)) &#123;</span><br><span class="line">      Object.defineProperty(this, COMPUTED_CACHE, &#123;</span><br><span class="line">        configurable: true,</span><br><span class="line">        enumerable: false,</span><br><span class="line">        value: new Map(),</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  return function (this: Object) &#123;</span><br><span class="line">    const cache = this[COMPUTED_CACHE] as Map&lt;string | symbol, Ref&lt;Return&gt;&gt;</span><br><span class="line">    if (!cache.has(context.name)) &#123;</span><br><span class="line">      // ğŸ”´ æƒ°æ€§åˆå§‹åŒ–</span><br><span class="line">      const scope = effectScope(true)</span><br><span class="line"></span><br><span class="line">      const val = scope.run(() =&gt; vueComputed(() =&gt; value.call(this)))!</span><br><span class="line"></span><br><span class="line">      cache.set(context.name, val)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return unref(cache.get(context.name))</span><br><span class="line">  &#125; as Value</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p>ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬è¿”å›çš„æ–°çš„å‡½æ•°æ¥å–ä»£åŸæœ‰çš„ <code>getter</code>ï¼Œå¦å¤–åœ¨ <code>addInitializer</code> ä¸­åˆå§‹åŒ–ç¼“å­˜å±æ€§ã€‚æˆ‘ä»¬å»ºè®®åœ¨ <code>addInitializer</code> ä¸­ä¸€æ¬¡æ€§å°†éœ€è¦çš„å±æ€§éƒ½åˆå§‹åŒ–å®Œæ¯•ï¼Œé¿å…åœ¨ getter ä¸­åŠ¨æ€å»æ·»åŠ æ–°çš„å±æ€§ï¼Œ<a href="https://mathiasbynens.be/notes/shapes-ics" target="_blank" rel="noopener">åˆ©å¥½ JavaScript å¼•æ“çš„ä¼˜åŒ–</a>ã€‚</p><p><br></p><p>è¿™æ ·åšçš„å¥½å¤„æ˜¯æ›´ç¬¦åˆæ–°ç‰ˆè£…é¥°å™¨çš„å¿ƒæ™ºå’Œè®¾è®¡æ„å›¾ï¼Œä¹Ÿå¯ä»¥ä¿è¯è£…é¥°å™¨æŒ‰ç…§ç»„åˆçš„é¡ºåºè°ƒç”¨ã€‚</p><p><br><br><br></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æœ¬æ–‡ä¸»è¦è¯¦ç»†å¯¹æ¯”äº†æ–°ç‰ˆå’Œæ—§ç‰ˆçš„è£…é¥°å™¨å·®å¼‚ï¼Œé€šè¿‡å®æˆ˜å°†è£…é¥°å™¨çš„èƒ½åŠ›å’Œé™·é˜±æŒ–æ˜å‡ºæ¥ã€‚</p><p><br></p><p>æ€»å¾—æ¥è¯´ï¼Œæ–°ç‰ˆçš„è£…é¥°å™¨æ›´åŠ ç»Ÿä¸€ç›´è§‚ã€æ›´å®¹æ˜“å…¥æ‰‹ï¼Œåœ¨èƒ½åŠ›ä¸Šä¹Ÿå…‹åˆ¶åœ°æ”¶æ•›äº†ã€‚ä¸è¿‡ç›®å‰ç¤¾åŒºä¸Šå¤§é‡çš„åº“å’Œæ¡†æ¶è¿˜åœç•™åœ¨ Stage 1 è£…é¥°å™¨ï¼Œå‡çº§å’Œæ”¹é€ éœ€è¦è¾ƒå¤§çš„æˆæœ¬ï¼Œæˆ‘ä»¬å¯ä»¥æš‚æ—¶è§‚æœ›è§‚æœ›ã€‚</p><p><br></p><p>ä¸‹ä¸€æ­¥ï¼šè£…é¥°å™¨æ¯”è¾ƒå¤æ‚çš„åº”ç”¨æ˜¯ä¾èµ–æ³¨å…¥ï¼Œå½“å‰çš„ä¾èµ–æ³¨å…¥åº“éƒ½æ·±åº¦ä¾èµ– <code>reflect-metadata</code> æ¥å®ç°ã€‚è€Œ <a href="https://github.com/tc39/proposal-decorator-metadata?spm=a2c6h.12873639.article-detail.8.68bd13c4Dt6Qt7" target="_blank" rel="noopener">Decorator Metadata</a> ç›®å‰ä¹Ÿè¿›å…¥äº† Stage 3 é˜¶æ®µï¼Œå¾ˆå¿«å°±ä¼šå’Œæˆ‘ä»¬è§é¢(Typescript 5.2)ï¼Œå±Šæ—¶æˆ‘ä»¬å†èŠèŠå¦‚ä½•å®ç°ä¾èµ–æ³¨å…¥(ğŸ¶ çœ‹ä½ ä»¬çš„ç‚¹èµ)ã€‚</p><p><br><br><br></p><h2 id="æ‰©å±•é˜…è¯»"><a href="#æ‰©å±•é˜…è¯»" class="headerlink" title="æ‰©å±•é˜…è¯»"></a>æ‰©å±•é˜…è¯»</h2><ul><li><strong><a href="https://github.com/tc39/proposal-decorators" target="_blank" rel="noopener">proposal-decorators</a></strong></li><li><a href="https://www.typescriptlang.org/docs/handbook/release-notes/typescript-5-0.html" target="_blank" rel="noopener">Typescript 5.0</a> å‘å¸ƒæ—¥å¿—</li><li><a href="https://mp.weixin.qq.com/s/QnWez2sEWuL8j8GVDmBNTA" target="_blank" rel="noopener">TypeScript 5.0 å°†æ”¯æŒå…¨æ–°çš„è£…é¥°å™¨å†™æ³•ï¼</a></li><li><a href="https://developer.aliyun.com/article/892441" target="_blank" rel="noopener">ECMAScript åŒæœˆæŠ¥å‘Šï¼šè£…é¥°å™¨ææ¡ˆè¿›å…¥ Stage 3</a></li><li><a href="https://cn.vitejs.dev/guide/features.html#usedefineforclassfields" target="_blank" rel="noopener">vite typescript <code>useDefineForClassFields</code></a></li><li><a href="https://babeljs.io/docs/babel-plugin-proposal-decorators" target="_blank" rel="noopener">@babel/plugin-proposal-decorators</a></li><li>Javascript å¼•æ“ä¼˜åŒ–æœºåˆ¶:<ul><li><a href="https://mathiasbynens.be/notes/shapes-ics" target="_blank" rel="noopener">JavaScript engine fundamentals: Shapes and Inline Caches</a></li><li><a href="https://mathiasbynens.be/notes/prototypes" target="_blank" rel="noopener">JavaScript engine fundamentals: optimizing prototypes</a></li></ul></li><li><a href="https://cn.mobx.js.org/refguide/action.html" target="_blank" rel="noopener">MobX</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;img src=&quot;/images/decorator/Untitled.jpeg&quot; alt=&quot;cover&quot;&gt;&lt;/p&gt;
&lt;p&gt;å»å¹´ä¸‰æœˆä»½&lt;a href=&quot;https://github.com/tc39/proposal-decorators&quot; target=&quot;_blank&quot;
      
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://bobi.ink/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>ç¨‹åºå‘˜çš„å¿«ä¹ä¸è‹¦æ¼</title>
    <link href="https://bobi.ink/2023/06/21/happiness/"/>
    <id>https://bobi.ink/2023/06/21/happiness/</id>
    <published>2023-06-20T16:00:00.000Z</published>
    <updated>2023-06-21T10:28:32.450Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/images/happiness/Untitled.jpeg" alt="Universe"></p><blockquote><p>â€œ<strong>æˆ‘ä»¬æœä¹æ™šäº”ä¸Šç­ä¸‹ç­ï¼Œå°±æ˜¯ä¸ºäº†æœ‰æœä¸€æ—¥å»æ¢ç´¢å®‡å®™çš„</strong>â€<br>    â€”â€” å®‡å®™æ¢ç´¢ç¼–è¾‘éƒ¨</p></blockquote><p>éšç€å¤§ç¯å¢ƒçš„ä¸‹è¡Œï¼Œäº’è”ç½‘è¡Œä¸šä¹Ÿå—åˆ°ä¸€å®šçš„å†²å‡»ï¼Œå“€é¸¿éé‡ã€‚</p><p>ç¬”è€…ä¹Ÿæ²¡æœ‰å¹¸å…ï¼ŒåŸ¹å…»èµ·æ¥çš„äººé©¬é™†ç»­è¢«ä¼˜åŒ–ï¼Œç•™ä¸‹ä¸€ä¸¢å…‰æ†å¸ä»¤ï¼Œæˆ‘ä¹Ÿå›åˆ°çš„ä¸šåŠ¡ä¸€çº¿ï¼Œå¿ƒé‡Œå¾ˆä¸æ˜¯æ»‹å‘³ã€‚ç•™ä¸‹æ¥çš„äººï¼Œä¹Ÿä¸çŸ¥é“è¿™è‰˜èˆ¹ä»€ä¹ˆæ—¶å€™ä¼šæ²‰æ²¡â€¦ ä¸ºäº†æ´»å‘½è€Œæ‹¼å‘½æŒ£æ‰ï¼ˆå†…å·ï¼‰</p><p>è´Ÿé¢æƒ…ç»ªå’Œç„¦è™‘ä¸åœä¾µæ‰°ï¼Œä»¥è‡³äºæ€€ç–‘ï¼Œå½“åˆé€‰çš„è¿™æ¡è·¯æ˜¯ä¸æ˜¯æ­£ç¡®çš„ã€‚</p><p>æ¡èµ·ä¹°äº†å¤šå¹´ï¼Œä½†æ˜¯ä¸€ç›´æ²¡çœ‹çš„<code>ã€Šäººæœˆç¥è¯ã€‹</code>,  å¼€ç¯‡å°±è®²äº†ç¨‹åºå‘˜è¿™ä¸ªèŒä¸šçš„ä¹è¶£å’Œè‹¦æ¼ï¼Œé¢‡æœ‰å…±é¸£ï¼Œæ‰€ä»¥æ‹¿å‡ºæ¥ç»™å¤§å®¶åˆ†äº«</p><p>ä¸ç®¡è¿‡å»å¤šå°‘å¹´ï¼Œä¸ç®¡ä½ çš„ç¨‹åºè½½ä½“æ˜¯çº¸å¸¦ã€è¿˜æ˜¯ JavaScriptï¼Œä¸ç®¡ç¨‹åºè·‘åœ¨é«˜å¯¹æ¯”(high contract)çš„ç»ˆç«¯ã€è¿˜æ˜¯ iPhoneï¼Œç¨‹åºå‘˜çš„å¿«ä¹å’Œçƒ¦æ¼å¹¶æ²¡æœ‰å˜åŒ–ã€‚</p><p>å°½ç®¡å›½å†…è½¯ä»¶è¡Œä¸šçœ‹èµ·æ¥ä¸æ˜¯é‚£ä¹ˆå¥åº·ã€‚æˆ‘ç›¸ä¿¡å¾ˆå¤šäººçœŸæ­£çƒ­çˆ±çš„æ˜¯ç¼–ç¨‹ï¼Œè€Œä¸ä»…ä»…æ˜¯ä¸€ä»½å·¥ä½œï¼Œå°±æ˜¯é‚£ç§çº¯ç²¹çš„çƒ­çˆ±ã€‚ä½ æœ‰æ²¡æœ‰ï¼š</p><ul><li>ä¸ºäº†ä¿®æ”¹ä¸€ä¸ª Bugï¼ŒèŒ¶é¥­ä¸æ€</li><li>ä¸ºäº†ä¸€ä¸ª ideaï¼Œå¯ä»¥å‡Œæ™¨çˆ¬èµ·æ¥ï¼Œå†³æˆ˜åˆ°å¤©äº®</li><li>æˆ‘ä»¬äº«å—æ²¡æœ‰äººæ‰“æ‰°çš„åˆå</li><li>æ¢¦æƒ³ç€å‚ä¸åˆ°ä¸€ä¸ªä¼Ÿå¤§çš„å¼€æºé¡¹ç›®</li><li>æœ‰å¼ºçƒˆçš„åˆ†äº«æ¬²ï¼Œå¸Œæœ›æˆ‘ä»¬çš„ä½œå“å¯ä»¥å¸®åŠ©åˆ°æ›´å¤šäºº, å¸Œæœ›èƒ½å¾—åˆ°ç”¨æˆ·çš„åé¦ˆï¼Œå³ä½¿æ˜¯ä¸€ä¸ªç‚¹èµ</li><li>â€¦</li></ul><p><br><br><br></p><h2 id="æˆ‘ä»¬çš„å¿«ä¹"><a href="#æˆ‘ä»¬çš„å¿«ä¹" class="headerlink" title="æˆ‘ä»¬çš„å¿«ä¹"></a>æˆ‘ä»¬çš„å¿«ä¹</h2><blockquote><p>ã€Šäººæœˆç¥è¯ã€‹ï¼š</p><p>é¦–å…ˆï¼Œ<strong>è¿™ç§å¿«ä¹æ˜¯ä¸€ç§åˆ›å»ºäº‹ç‰©çš„çº¯ç²¹å¿«ä¹</strong>ã€‚å¦‚åŒå°å­©åœ¨ç©æ³¥å·´æ—¶æ„Ÿåˆ°å¿«ä¹ä¸€æ ·ï¼Œæˆå¹´äººå–œæ¬¢åˆ›å»ºäº‹ç‰©ï¼Œç‰¹åˆ«æ˜¯è‡ªå·±è¿›è¡Œè®¾è®¡ã€‚æˆ‘æƒ³è¿™ç§å¿«ä¹æ˜¯ä¸Šå¸åˆ›é€ ä¸–ç•Œçš„æŠ˜å°„ï¼Œä¸€ç§å‘ˆç°åœ¨æ¯ç‰‡ç‹¬ç‰¹çš„ã€å´­æ–°çš„æ ‘å¶å’Œé›ªèŠ±ä¸Šçš„å–œæ‚¦ã€‚<br><br><br>å…¶æ¬¡ï¼Œ<strong>è¿™ç§å¿«ä¹æ¥è‡ªäºå¼€å‘å¯¹ä»–äººæœ‰ç”¨çš„ä¸œè¥¿</strong>ã€‚å†…å¿ƒæ·±å¤„ï¼Œæˆ‘ä»¬æœŸæœ›æˆ‘ä»¬çš„åŠ³åŠ¨æˆæœèƒ½å¤Ÿè¢«ä»–äººä½¿ç”¨ï¼Œå¹¶èƒ½å¯¹ä»–ä»¬æœ‰æ‰€å¸®åŠ©ã€‚ä»è¿™ä¸€è§’åº¦è€Œè¨€ï¼Œè¿™åŒå°å­©ç”¨ç²˜å£«ä¸ºâ€œçˆ¸çˆ¸çš„åŠå…¬å®¤â€æåˆ¶é“…ç¬”ç›’æ²¡æœ‰ä»»ä½•æœ¬è´¨çš„åŒºåˆ«ã€‚<br><br><br>ç¬¬ä¸‰ï¼Œ<strong>å¿«ä¹æ¥è‡ªäºæ•´ä¸ªè¿‡ç¨‹ä½“ç°å‡ºçš„ä¸€è‚¡å¼ºå¤§çš„é­…åŠ›â€”â€”å°†ç›¸äº’å•®åˆçš„é›¶éƒ¨ä»¶ç»„è£…åœ¨ä¸€èµ·ï¼Œçœ‹åˆ°å®ƒä»¬ä»¥ç²¾å¦™çš„æ–¹å¼è¿è¡Œç€ï¼Œå¹¶æ”¶åˆ°äº†é¢„æœŸçš„æ•ˆæœã€‚</strong>æ¯”èµ·å¼¹çƒæ¸¸æˆæœºæˆ–è‡ªåŠ¨ç”µå”±æœºæ‰€å…·æœ‰çš„è¿·äººé­…åŠ›ï¼Œç¨‹åºåŒ–çš„è®¡ç®—æœºæ¯«ä¸é€Šè‰²ã€‚<br><br><br>ç¬¬å››ï¼Œ<strong>è¿™ç§å¿«ä¹æ˜¯æŒç»­å­¦ä¹ çš„å¿«ä¹ï¼Œå®ƒæ¥è‡ªäºè¿™é¡¹å·¥ä½œçš„éé‡å¤ç‰¹æ€§</strong>ã€‚äººä»¬æ‰€é¢ä¸´çš„é—®é¢˜æ€»æœ‰è¿™æ ·é‚£æ ·çš„ä¸åŒï¼Œå› è€Œè§£å†³é—®é¢˜çš„äººå¯ä»¥ä»ä¸­å­¦ä¹ æ–°çš„äº‹ç‰©ï¼Œæœ‰æ—¶æ˜¯å®è·µä¸Šçš„ï¼Œæœ‰æ—¶æ˜¯ç†è®ºä¸Šçš„ï¼Œæˆ–è€…å…¼è€Œæœ‰ä¹‹ã€‚<br><br><br>æœ€åï¼Œ<strong>è¿™ç§å¿«ä¹è¿˜æ¥è‡ªäºåœ¨æ˜“äºé©¾é©­çš„ä»‹è´¨ä¸Šå·¥ä½œ</strong>ã€‚ç¨‹åºå‘˜ï¼Œå°±åƒè¯—äººä¸€æ ·ï¼Œå‡ ä¹ä»…ä»…åœ¨å•çº¯çš„æ€è€ƒä¸­å·¥ä½œã€‚ç¨‹åºå‘˜å‡­ç©ºåœ°è¿ç”¨è‡ªå·±çš„æƒ³è±¡ï¼Œæ¥å»ºé€ è‡ªå·±çš„â€œåŸå ¡â€ã€‚å¾ˆå°‘æœ‰åˆ›é€ ä»‹è´¨å¦‚æ­¤çµæ´»ï¼Œå¦‚æ­¤æ˜“äºç²¾ç‚¼å’Œé‡å»ºï¼Œå¦‚æ­¤å®¹æ˜“å®ç°æ¦‚å¿µä¸Šçš„è®¾æƒ³(ä¸è¿‡æˆ‘ä»¬å°†ä¼šçœ‹åˆ°ï¼Œå®¹æ˜“é©¾é©­çš„ç‰¹æ€§ä¹Ÿæœ‰å®ƒè‡ªå·±çš„é—®é¢˜)ã€‚<br><br><br>ç„¶è€Œç¨‹åºæ¯•ç«åŒè¯—æ­Œä¸åŒï¼Œå®ƒæ˜¯å®å®åœ¨åœ¨çš„ä¸œè¥¿;å®ƒå¯ä»¥ç§»åŠ¨å’Œè¿è¡Œï¼Œèƒ½ç‹¬ç«‹äº§ç”Ÿå¯è§çš„è¾“å‡º;å®ƒèƒ½æ‰“å°ç»“æœï¼Œç»˜åˆ¶å›¾å½¢ï¼Œå‘å‡ºå£°éŸ³ï¼Œç§»åŠ¨æ”¯æ¶ã€‚ç¥è¯å’Œä¼ è¯´ä¸­çš„é­”æœ¯åœ¨æˆ‘ä»¬çš„æ—¶ä»£å·²å˜æˆç°å®ã€‚åœ¨é”®ç›˜ä¸Šé”®å…¥æ­£ç¡®çš„å’’è¯­ï¼Œå±å¹•ä¼šæ´»åŠ¨ã€å˜å¹»ï¼Œæ˜¾ç¤ºå‡ºå‰æ‰€æœªæœ‰çš„ä¹Ÿä¸å¯èƒ½å­˜åœ¨çš„äº‹ç‰©ã€‚</p></blockquote><p><br></p><p>ç¼–ç¨‹å°±æ˜¯ä¸€ç§çº¯ç²¹åˆ›é€ çš„å¿«ä¹ï¼Œè€Œä¸”å®ƒçš„æˆæœ¬å¾ˆä½ï¼Œæˆ‘ä»¬åªéœ€è¦ä¸€å°ç”µè„‘ï¼Œä¸€ä¸ªè¶æ‰‹çš„ç¼–è¾‘å™¨ï¼Œä¸€æ®µä¸è¢«äººæ‰“æ‰°çš„æ•´å—æ—¶é—´ï¼Œç„¶åè¿›å…¥å¿ƒæµçŠ¶æ€ï¼Œè„‘æµ·ä¸­çš„æƒ³æ³•è½¬æ¢æˆå±å¹•ä¸Šé—ªçƒçš„å­—ç¬¦ã€‚<br>è¿™æ˜¯å¤šå·´èƒºå¸¦ç»™æˆ‘ä»¬çš„å¿«ä¹ã€‚</p><p><img src="/images/happiness/Untitled.png" alt="é£æœºå¼•æ“"></p><p><br><br><br></p><p>æˆ‘ä»¬ä¹Ÿæœ‰ã€Œ<code>æœºæ¢°å´‡æ‹œ</code>ã€ï¼Œè½¯ä»¶ä¸äºšäºä¼ ç»Ÿçš„æœºæ¢°çš„å¤æ‚æ„é€ ã€‚ å®ƒè¿œæ¯”å¤–ç•Œæƒ³è±¡çš„è¦å¤æ‚å’Œè‹›åˆ»ï¼Œè€Œæˆ‘ä»¬äº«å—å°†æ— æ•°é›¶éƒ¨ä»¶æœ‰æœºç»„åˆèµ·æ¥ï¼Œç‚¹å‡»â€”â€”æˆåŠŸè¿è¡Œçš„å¿«æ„Ÿã€‚</p><p>æˆ‘ä»¬äº«å—å¤æ‚çš„é—®é¢˜ï¼Œè¢«æŠ½è±¡ã€æ‹†è§£æˆä¸€ä¸ªä¸ªç®€å•çš„é—®é¢˜ï¼Œ è®¤çœŸæç»˜åˆ†å±‚çš„å¼§çº¿ä»¥åŠæ¯ä¸ªæ¨¡å—è½®å»“ï¼Œè°¨æ…è®¾è®¡å®ƒçš„æ¯ä¸ªé”¯é½¿å’Œæ¥å£ã€‚</p><p>æˆ‘ä»¬å´‡å°šæœ‰åºï¼Œèµèµæ¸…æ™°çš„è¾¹ç•Œï¼Œ ä¸ºçš„å°±æ˜¯æˆ‘ä»¬åˆ›é€ çš„ä¸–ç•Œèƒ½å¤Ÿç¨³å®šå‘å±•ã€‚</p><p><br></p><p>æˆ‘ä»¬è®¤ä¸ºæ‡’æƒ°æ˜¯æˆ‘ä»¬çš„ä¼˜ç‚¹ï¼Œæˆ‘ä»¬ä¹Ÿå´‡æ‹œè‡ªåŠ¨åŒ–ï¼Œäº«å—æˆ‘ä»¬æ•°æ®é€šè¿‡æˆ‘ä»¬å»ºè®¾çš„ç®¡é“åœ¨ä¸åŒæ¨¡å—ã€ç³»ç»Ÿæˆ–è€…æœºå™¨ä¸­ä¼ é€’å’ŒåŠ å·¥ï¼›äº«å—ç¨‹åºåƒå¤šç±³è¯ºéª¨ç‰Œä¸€æ ·ï¼Œè‡ªåŠ¨æ„å»ºã€æµ‹è¯•ã€å‘å¸ƒã€éƒ¨ç½²ã€åˆ†å‘åˆ°æ¯ä¸ªç”¨æˆ·çš„æ‰‹ä¸­ï¼Œä¼˜é›…åœ°è·‘èµ·æ¥ã€‚</p><p>å› ä¸ºæ‡’ï¼Œæˆ‘ä»¬æ—¶å¸¸è¿½æ±‚åˆ›é€ å‡ºèƒ½å¤Ÿå–ä»£è‡ªå·±çš„å·¥å…·ï¼Œè®©æˆ‘ä»¬èƒ½è…¾å‡ºæ—¶é—´åœ¨æ–°çš„ä¸–ç•Œæ¢ç´¢ã€‚æ¯”å¦‚å¯ä»¥åˆ¶é€ å‡ºæˆ‘ä»¬çš„ <a href="https://baike.baidu.com/item/MOSS/23288071?fr=aladdin" target="_blank" rel="noopener">Moss</a>ï¼Œå¸®æˆ‘ä»¬æ²»ç†è®©æ¯ä¸ªç¨‹åºçš„ç”Ÿå‘½å‘¨æœŸï¼Œè®©å®ƒä»¬ä¼˜é›…åœ°æ­»å»åˆé‡ç”Ÿã€‚</p><p><br></p><p>æˆ‘ä»¬æ˜¯ä¸€ç¾¤ä¹äºåˆ†äº«å’Œå­¦ä¹ çš„ç¾¤ä½“ï¼Œæœ‰ç¹è£çš„æŠ€æœ¯ç¤¾åŒºã€å„ç§æŠ€æœ¯å¤§ä¼šã€æŠ€æœ¯ç¾¤â€¦</p><p>ä¸ç®¡æ˜¯åˆ†äº«è¿˜æ˜¯ç¼–ç¨‹æœ¬èº«ï¼Œå…¶å®éƒ½æ˜¯å¸Œæœ›æˆ‘ä»¬çš„ä½œå“èƒ½è¢«å…¶ä»–äººç”¨åˆ°ï¼Œèƒ½äº§ç”Ÿä»·å€¼ï¼š</p><ul><li>æˆ‘ä»¬éƒ½æœ‰å¼€æºæ¢¦ï¼Œå¤šå°‘äººæ¢¦æƒ³ç€èƒ½å‚ä¸é‚£äº›å¹¿ä¸ºäººçŸ¥å¼€æºé¡¹ç›®ã€‚å¾ˆå°‘æœ‰å“ªä¸ªè¡Œä¸šï¼Œæœ‰è¿™ä¹ˆä¸€ç¾¤äºº,  èƒ½å¤Ÿè‡ªæˆ‘ç»„ç»‡ï¼Œç”¨çˆ±å‘ç”µã€å®Œå…¨é€æ˜åœ°åšå‡ºä¸€ä¸ªä¸ªä¼Ÿå¤§çš„ä½œå“ã€‚</li><li>æˆ‘ä»¬æ€»ä¼šæ€€æ£ç€ä¹è§‚çš„è®¾æƒ³ï¼ŒåŸºäºè¿™ç§è®¾æƒ³ï¼Œæˆ‘ä»¬ä¼šè¶‹å‘æ‰“é€ æ›´å®Œç¾çš„ä½œå“ï¼Œæƒ³è±¡æœªæ¥å„ç§é«˜å¹¶å‘ã€æç«¯çš„åœºæ™¯ï¼Œæˆ‘ä»¬çš„ç¨‹åºèƒ½å¤Ÿæ¸¸åˆƒæœ‰ä½™ã€‚</li><li>æˆ‘ä»¬æ€»æ˜¯ä¸æ»¡è¶³äºç°æœ‰çš„ä¸œè¥¿ï¼Œä¹äºä¸åœåœ°æ”¹è¿›ï¼Œé€ å‡ºæ›´å¤šçš„è½®å­ï¼Œç”šè‡³ä¸æƒœä»£ä»·æ¨ç¿»é‡æ¥</li><li>æˆ‘ä»¬æ›´ä¼šæ‡Šæ¼ï¼Œè‡ªå·±æŠ•å…¥å¤§é‡ç²¾åŠ›çš„é¡¹ç›®ï¼Œæ— äººé—®æ´¥ï¼Œç”šè‡³èƒæ­»è…¹ä¸­ã€‚</li></ul><p><br></p><p>çœ‹ç€å®ƒä»¬ï¼Œä»ç®€å•åˆ°ç¹æ‚ï¼Œè¿™æ˜¯ä¸€ç§è¿­ä»£çš„å¿«ä¹ã€‚</p><p><br><br><br><br><br></p><h2 id="æˆ‘ä»¬çš„è‹¦æ¼"><a href="#æˆ‘ä»¬çš„è‹¦æ¼" class="headerlink" title="æˆ‘ä»¬çš„è‹¦æ¼"></a>æˆ‘ä»¬çš„è‹¦æ¼</h2><blockquote><p>ã€Šäººæœˆç¥è¯ã€‹<br>ç„¶è€Œè¿™ä¸ªè¿‡ç¨‹å¹¶ä¸å…¨éƒ½æ˜¯å¿«ä¹çš„ã€‚æˆ‘ä»¬åªæœ‰äº‹å…ˆäº†è§£ä¸€äº›ç¼–ç¨‹å›ºæœ‰çš„è‹¦æ¼ï¼Œè¿™æ ·ï¼Œå½“å®ƒä»¬çœŸçš„å‡ºç°æ—¶ï¼Œæ‰èƒ½æ›´åŠ å¦ç„¶åœ°é¢å¯¹ã€‚<br><br><br>é¦–å…ˆï¼Œ<strong>è‹¦æ¼æ¥è‡ªè¿½æ±‚å®Œç¾</strong>ã€‚å› ä¸ºè®¡ç®—æœºæ˜¯ä»¥è¿™æ ·çš„æ–¹å¼æ¥å˜æˆæ³•çš„: å¦‚æœå’’è¯­ä¸­çš„ä¸€ä¸ªå­—ç¬¦ã€ä¸€ä¸ªåœé¡¿ï¼Œæ²¡æœ‰ä¸æ­£ç¡®çš„å½¢å¼ä¸€è‡´ï¼Œé­”æœ¯å°±ä¸ä¼šå‡ºç°(ç°å®ä¸­ï¼Œå¾ˆå°‘æœ‰äººç±»æ´»åŠ¨ä¼šè¦æ±‚å¦‚æ­¤å®Œç¾ï¼Œæ‰€ä»¥äººç±»å¯¹å®ƒæœ¬æ¥å°±ä¸ä¹ æƒ¯)ã€‚å®é™…ä¸Šï¼Œæˆ‘è®¤ä¸ºï¼Œå­¦ä¹ ç¼–ç¨‹æœ€å›°éš¾çš„éƒ¨åˆ†ï¼Œæ˜¯å°†åšäº‹çš„æ–¹å¼å‘è¿½æ±‚å®Œç¾çš„æ–¹å‘è°ƒæ•´â€ã€‚</p><p><br><br>å…¶æ¬¡ï¼Œ<strong>è‹¦æ¼æ¥è‡ªç”±ä»–äººæ¥è®¾å®šç›®æ ‡ã€ä¾›ç»™èµ„æºå’Œæä¾›ä¿¡æ¯</strong>ã€‚ç¼–ç¨‹äººå‘˜å¾ˆå°‘èƒ½æ§åˆ¶å·¥ä½œç¯å¢ƒå’Œå·¥ä½œç›®æ ‡ã€‚ç”¨ç®¡ç†çš„æœ¯è¯­æ¥è¯´ï¼Œä¸ªäººçš„æƒå¨å’Œä»–æ‰€æ‰¿æ‹…çš„è´£ä»»æ˜¯ä¸ç›¸é…çš„ã€‚ä¸è¿‡ï¼Œä¼¼ä¹åœ¨æ‰€æœ‰çš„é¢†åŸŸä¸­ï¼Œå¯¹è¦å®Œæˆçš„å·¥ä½œï¼Œå¾ˆå°‘èƒ½æä¾›ä¸è´£ä»»ç›¸ä¸€è‡´çš„æ­£å¼æƒå¨ã€‚è€Œç°å®æƒ…å†µä¸­ï¼Œå®é™…(ç›¸å¯¹äºå½¢å¼)çš„æƒå¨æ¥è‡ªäºæ¯æ¬¡ä»»åŠ¡çš„å®Œæˆã€‚</p><p><strong>å¯¹äºç³»ç»Ÿç¼–ç¨‹äººå‘˜è€Œè¨€ï¼Œå¯¹å…¶ä»–äººçš„ä¾èµ–æ˜¯ä¸€ä»¶éå¸¸ç—›è‹¦çš„äº‹æƒ…</strong>ã€‚ä»–ä¾é å…¶ä»–äººçš„ç¨‹åºï¼Œè€Œè¿™äº›ç¨‹åºå¾€å¾€è®¾è®¡å¾—å¹¶ä¸åˆç†ã€å®ç°æ‹™åŠ£ã€å‘å¸ƒä¸å®Œæ•´(æ²¡æœ‰æºä»£ç æˆ–æµ‹è¯•ç”¨ä¾‹)æˆ–è€…æ–‡æ¡£è®°å½•å¾—å¾ˆç³Ÿã€‚æ‰€ä»¥ï¼Œç³»ç»Ÿç¼–ç¨‹äººå‘˜ä¸å¾—ä¸èŠ±è´¹æ—¶é—´å»ç ”ç©¶å’Œä¿®æ”¹ï¼Œè€Œå®ƒä»¬åœ¨ç†æƒ³æƒ…å†µä¸‹æœ¬åº”è¯¥æ˜¯å¯æ‹¿çš„ã€å®Œæ•´çš„ã€‚</p><p><br><br>ä¸‹ä¸€ä¸ªè‹¦æ¼ â€”â€” <strong>æ¦‚å¿µæ€§è®¾è®¡æ˜¯æœ‰è¶£çš„ï¼Œä½†å¯»æ‰¾çç¢çš„bugå´æ˜¯ä¸€é¡¹é‡å¤æ€§çš„æ´»åŠ¨</strong>ã€‚ä¼´éšç€åˆ›é€ æ€§æ´»åŠ¨çš„ï¼Œå¾€å¾€æ˜¯æ¯ç‡¥æ²‰é—·çš„æ—¶é—´å’Œè‰°è‹¦çš„åŠ³åŠ¨ã€‚ç¨‹åºç¼–åˆ¶å·¥ä½œä¹Ÿä¸ä¾‹å¤–ã€‚</p><p><br><br>å¦<strong>å¤–ï¼Œäººä»¬å‘ç°è°ƒè¯•å’ŒæŸ¥é”™å¾€å¾€æ˜¯çº¿æ€§æ”¶æ•›çš„ï¼Œæˆ–è€…æ›´ç³Ÿç³•çš„æ˜¯ï¼Œå…·æœ‰äºŒæ¬¡æ–¹çš„å¤æ‚åº¦</strong>ã€‚ç»“æœï¼Œæµ‹è¯•ä¸€æ‹–å†æ‹–ï¼Œå¯»æ‰¾æœ€åä¸€ä¸ªé”™è¯¯æ¯”ç¬¬ä¸€ä¸ªé”™è¯¯å°†èŠ±è´¹æ›´å¤šçš„æ—¶é—´ã€‚</p><p><br><br>æœ€åä¸€ä¸ªè‹¦æ¼ï¼Œæœ‰æ—¶ä¹Ÿæ˜¯ä¸€ç§æ— å¥ˆ â€”â€” <strong>å½“æŠ•å…¥äº†å¤§é‡è¾›è‹¦çš„åŠ³åŠ¨ï¼Œäº§å“åœ¨å³å°†å®Œæˆæˆ–è€…ç»ˆäºå®Œæˆçš„æ—¶å€™ï¼Œå´å·±æ˜¾å¾—é™ˆæ—§è¿‡æ—¶</strong>ã€‚å¯èƒ½æ˜¯åŒäº‹å’Œç«äº‰å¯¹æ‰‹å·±åœ¨è¿½é€æ–°çš„ã€æ›´å¥½çš„æ„æ€;ä¹Ÿè®¸æ›¿ä»£æ–¹æ¡ˆä¸ä»…ä»…æ˜¯åœ¨æ„æ€ï¼Œè€Œä¸”å·±ç»åœ¨å®‰æ’äº†ã€‚<br><br></p></blockquote><p>å‰é˜µå­è¯»åˆ°äº† @<a href="https://www.zhihu.com/people/doodlewind" target="_blank" rel="noopener">doodlewind</a> çš„ <a href="https://zhuanlan.zhihu.com/p/595759878" target="_blank" rel="noopener">å…¨èŒå¼€æºï¼Œå‡ºæµ·åˆ›ä¸šï¼šæˆ‘çš„ 2022</a>ï¼Œè¯´çš„æ˜¯ä»– all in å»åš AFFiNE ã€‚æˆ‘çœ¼é‡Œåªæœ‰ç¾¡æ…•å•Šï¼Œèƒ½å¤Ÿæ‰¾åˆ° all in çš„äº‹ä¸šâ€¦</p><p><br><br><br></p><p>è¿™äº›å¹´ OKR ä¹Ÿå¾ˆç«ï¼Œæˆ‘ä»¬å…¬å¸ä¹Ÿè·Ÿé£äº†ä¸€å¹´; åé¢åˆå›åˆ°äº† KPIï¼Œè½°è½°çƒˆçƒˆæå…¨å‘˜KPI, æŠ“ç€æ¯ä¸ªäºº,  è¦å®šè‡ªå·±çš„å…¨å¹´KPI;  åå¹´è£å‘˜ï¼ŒKPI å°±ä¸å†æèµ·äº†â€¦</p><p>è¿™ä¸‰ä¸ªé˜¶æ®µçš„æ¼”å˜å¾ˆæœ‰æ„æ€ï¼Œç¬¬ä¸€ä¸ªé˜¶æ®µï¼ŒæœŸæœ›é€šè¿‡ OKR ä¸Šä¸‹æ‰“é€šï¼Œå°†ç›®æ ‡æ†åœ¨ä¸€èµ·ï¼Œè®©å›¢é˜Ÿè‡ªå·±é©±åŠ¨è‡ªå·±ã€‚å®é™…ä¸Šå®æ–½èµ·æ¥å¾ˆéš¾ï¼Œè®©å›¢é˜Ÿå’Œä¸ªäººè‡ªæˆ‘é©±åŠ¨èµ·æ¥å¹¶ä¸æ˜¯ä¸€ä»¶å®¹æ˜“çš„äº‹æƒ…ï¼Œè™½ç„¶ç”¨çš„æ˜¯ OKRï¼Œä½†å†…æ ¸è¿˜æ˜¯ KPIï¼Œæˆ–è€…è¯´ OKR å˜æˆäº†é¢†å¯¼çš„ OKRã€‚<br>åé¢å°±å˜æˆäº† KPI, é™å®šå›¢é˜Ÿè¦æ‰¿æ‹…å¤šå°‘é”€å”®é¢ï¼Œäº¤ä»˜å¤šå°‘é¡¹ç›®ï¼›<br>å†åæ¥ KPI éƒ½æ²¡æœ‰äº†ï¼Œæ¢æˆè¦æ±‚æ¯ä¸ªäººè®¾å®šè‡ªå·±å·¥ä½œæ—¥å†ï¼Œä¸èƒ½ç©ºè½¬ï¼Œå“ªé‡Œé¡¹ç›®ç¼ºèµ„æºï¼Œå°±è°ƒé…åˆ°å“ªé‡Œï¼Œå½»åº•æ²¦ä¸ºäº†äººçŸ¿â€¦</p><p>èƒ½è®©æˆ‘ä»¬ all in çš„äº‹æƒ…ï¼Œé¦–å…ˆå¾—æ˜¯æˆ‘ä»¬è®¤åŒçš„äº‹æƒ…ï¼Œå…¶æ¬¡æˆ‘ä»¬èƒ½åœ¨è¿™ä»¶äº‹æƒ…ä¸Šæ·±åº¦å‚ä¸å’Œå‘æŒ¥ä»·å€¼ï¼Œå¹¶è·å¾—é¢„æœŸçš„å›æŠ¥ã€‚è¿™æ‰èƒ½å®ç°ã€Œè‡ªæˆ‘é©±åŠ¨ã€</p><p>å¯¹äºå¤§éƒ¨åˆ†äººæ¥è¯´ï¼Œå¾ˆå°‘æœ‰è¿™ç§å·¥ä½œæœºä¼šï¼Œå”¯ä¸€å€¼å¾— all inçš„ï¼Œææ€•å°±åªæœ‰è‡ªå·±äº†ã€‚</p><p><br><br><br></p><p>æ‰€ä»¥ç¨‹åºå‘˜çš„è‹¦æ¼å¾ˆå¤šï¼Œè™½ç„¶ç¼–ç¨‹æ˜¯ä¸€ä¸ªåˆ›é€ æ€§çš„å·¥ä½œï¼Œä½†æ˜¯æˆ‘ä»¬çš„å·¥ä½œæ˜¯ç”±å…¶ä»–äººæ¥è®¾å®šç›®æ ‡å’Œæä¾›èµ„æºçš„ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬åªä¸è¿‡æ˜¯å›°åœ¨æ•æ·å¾ªç¯é‡Œé¢çš„ä¸€é¢—èºä¸é’‰ï¼Œæ¯å¤©åœ¨æ—©ä¼šä¸Šæœºæ¢°å¤è¯»ç€ï¼šæ˜¨å¤©å¹²äº†ä»€ä¹ˆï¼Œä»Šå¤©è¦å¹²ä»€ä¹ˆã€‚<br>ä¼ä¸šæ€»ä¼šæƒ³æ³•è®¾æ³•é‡åŒ–æˆ‘ä»¬çš„å·¥ä½œï¼Œæœ€å¥½æ˜¯åƒæµæ°´çº¿ä¸€æ ·é€æ˜ã€å¯é¢„æµ‹ã€‚</p><p><br></p><p>åŸ¹è®­æœºæ„å››ä¸ªæœˆå°±èƒ½å°†é«˜ä¸­ç”Ÿæ‰“é€ æˆå¯ä»¥ä¸Šå²—æ•²ä»£ç çš„ç¨‹åºå‘˜ã€‚æˆ‘ä»¬è¿™ä¸ªè¡Œä¸šå·²ç»ä¸å­˜åœ¨æˆ‘ä»¬æƒ³è±¡ä¸­é«˜é—¨æ§›ã€‚ç¨‹åºå‘˜å¯èƒ½å°±æ˜¯æ–°æ—¶ä»£çš„è“é¢†å·¥äººï¼Œå¦‚æœæˆ‘ä»¬çš„å·¥ä½œæ˜¯é‡å¤çš„ã€å¯é¢„è§çš„ï¼Œé‚£æœ¬è´¨ä¸Šå°±æ²¡ä»€ä¹ˆåŒºåˆ«äº†ã€‚</p><hr><p><br></p><p>è¿½æ±‚å®Œç¾æ˜¯å¥½äº‹ï¼Œä¹Ÿæ˜¯åäº‹ã€‚è‹›åˆ»çš„ç¼–è¯‘å™¨ä¼šæé«˜å¼€å‘çš„é—¨æ§›ï¼Œä½†åŒæ ·å¯ä»¥é™ä½æˆ‘ä»¬çŠ¯é”™çš„æ¦‚ç‡ã€‚</p><p>è®¡ç®—æœºå‡ ä¹ä¸ä¼šçŠ¯é”™çš„ï¼Œåªæ˜¯æˆ‘ä»¬ä¸æ‡‚å®ƒï¼Œè€Œäººç»å¸¸ä¼šçŠ¯é”™ã€‚ç›¸æ¯”è‹›åˆ»çš„è®¡ç®—æœºï¼Œäººæ›´åŠ å¯æ€•ï¼š</p><ul><li>åº”ä»˜é¢†å¯¼æˆ–äº§å“æ‹è„‘è¢‹çš„éœ€æ±‚</li><li>æ¥æ‰‹å±å±±ä»£ç </li><li>æµªè´¹æ—¶é—´çš„ä¼šè®®</li><li>ç‹¼æ€§æ–‡åŒ–</li><li>â€¦</li></ul><p><br><br><br></p><hr><p><br></p><p>è¿˜æœ‰ä¸€ä¸ªè‹¦æ¼æ˜¯æŠ€æœ¯çš„å‘å±•å®åœ¨å¤ªå¿«äº†ï¼Œæ—¶å°šçš„é¡¹ç›®ç”Ÿå‘½å‘¨æœŸå¤ªçŸ­ï¼Œè€Œç¨‹åºå‘˜åˆæ˜¯ä¸€ç¾¤å–œæ–°åŒæ—§çš„ç¾¤ä½“ã€‚</p><p>æ¯”å¦‚åœ¨å‰ç«¯ï¼Œå¯èƒ½ä¸¤ä¸‰å¹´å‰çš„é¡¹ç›®å°±å¯ä»¥è¢«å®šä¹‰ä¸ºâ€è€å¤è‘£â€äº†ï¼Œä¸Šä¸‹æ–‡åˆ‡æ¢åˆ°è¿™ç§é¡¹ç›®ä¼šæ¯”è¾ƒç—›è‹¦ã€‚ä¸å¹¸çš„æ˜¯ï¼Œè¿™äº›è€å¤è‘£å¯èƒ½ä¼šå› ä¸ºæŸäº›ç¨‹åºå‘˜çš„åè§ï¼Œå‡ºç°ç ´çª—æ•ˆåº”ï¼Œæ…¢æ…¢æ²¦ä¸ºå±å±±ã€‚</p><p>æˆ‘ä»¬è™½ç„¶è‹¦æ¼äºé¡¹ç›®çš„è…è´¥ï¼Œè€Œå¤§å¤šæ•°æƒ…å†µæˆ‘ä»¬ä¹Ÿæ˜¯æ¨æ‰‹ã€‚</p><p><br></p><p>æˆ‘ä»¬è¿˜æœ‰å¾ˆå¤šè‹¦æ¼ï¼š</p><ul><li>35 å²å±æœºï¼Œç»§ç»­åšæŠ€æœ¯è¿˜æ˜¯è½¬ç®¡ç†</li><li>é¢è¯•çš„å…«è‚¡æ–‡</li><li>å†…å·</li><li>è¢« AI å–ä»£</li><li>â€¦</li></ul><p><br><br><br></p><p>å¯¹äºè¯»è€…æ¥è¯´ï¼Œæ˜¯å¿«ä¹å¤šä¸€äº›å‘¢ï¼Ÿè¿˜æ˜¯è‹¦æ¼å¤šä¸€äº›å‘¢ï¼Ÿ</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;img src=&quot;/images/happiness/Untitled.jpeg&quot; alt=&quot;Universe&quot;&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;â€œ&lt;strong&gt;æˆ‘ä»¬æœä¹æ™šäº”ä¸Šç­ä¸‹ç­ï¼Œå°±æ˜¯ä¸ºäº†æœ‰æœä¸€æ—¥å»æ¢ç´¢å®‡å®™çš„&lt;/strong&gt;â€&lt;br&gt;    â€”â€” å®‡å®™æ¢
      
    
    </summary>
    
      <category term="ç¨‹åºäººç”Ÿ" scheme="https://bobi.ink/categories/%E7%A8%8B%E5%BA%8F%E4%BA%BA%E7%94%9F/"/>
    
    
  </entry>
  
  <entry>
    <title>å‰ç«¯å¦‚ä½•ç ´è§£ CRUD çš„å¾ªç¯</title>
    <link href="https://bobi.ink/2023/06/16/crud/"/>
    <id>https://bobi.ink/2023/06/16/crud/</id>
    <published>2023-06-15T16:00:00.000Z</published>
    <updated>2023-06-16T02:05:00.408Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/images/crud/Untitled.jpeg" alt="Untitled"></p><p>æ®è¯´ï¼Œè¥¿è¥¿å¼—æ–¯æ˜¯ä¸€ä¸ªéå¸¸èªæ˜çš„å›½ç‹ï¼Œä½†ä»–ä¹Ÿéå¸¸è‡ªè´Ÿå’Œç‹‚å¦„ã€‚ä»–ç”šè‡³æ•¢æ¬ºéª—ç¥çµï¼Œå¹¶æŠŠæ­»è€…å¸¦å›äººé—´ã€‚ä¸ºæ­¤ï¼Œä»–è¢«å®™æ–¯ï¼ˆZeusï¼‰æƒ©ç½šï¼Œè¢«è¿«æ¯å¤©æ¨ç€ä¸€å—å·¨çŸ³ä¸Šå±±ï¼Œä½†åœ¨æ¥è¿‘å±±é¡¶æ—¶ï¼Œå·¨çŸ³æ€»æ˜¯ä¼šæ»šè½ä¸‹æ¥ï¼Œä»–ä¸å¾—ä¸é‡æ–°å¼€å§‹æ¨çŸ³å¤´ï¼Œæ°¸è¿œå›°åœ¨è¿™ä¸ªå¾ªç¯ä¸­â€¦</p><p>å¾ˆå¤šå¼€å‘å·¥ä½œä¹Ÿå¦‚æ­¤å•è°ƒè€Œä¹å‘³ï¼Œæ¯”å¦‚ä»Šå¤©è¦è®²çš„ä¸­åå°å¼€å‘çš„åœºæ™¯ã€‚ä¸­åå°ä¸šåŠ¡åŸºæœ¬ä¸Šå°±æ˜¯ä¸€äº›æ•°æ®çš„å¢åˆ æ”¹æŸ¥ã€å›¾è¡¨ï¼ŒæŠ€æœ¯å«é‡ä¸é«˜ï¼Œæ¯”è¾ƒå®¹æ˜“èŒƒå¼åŒ–ã€‚</p><p>å‰ç«¯å¦‚ä½•ç ´é™¤ CRUD çš„å•è°ƒå¾ªç¯å‘¢ï¼Ÿ</p><p><br><br><br><br><br></p><h2 id="ä½ä»£ç "><a href="#ä½ä»£ç " class="headerlink" title="ä½ä»£ç "></a>ä½ä»£ç </h2><p>è¿‡å»å‡ å¹´å‰ç«¯çš„ä½ä»£ç å¾ˆç«ï¼Œè¿™äº›<code>ä½ä»£ç å¹³å°</code>é€šå¸¸æ”¯æŒåˆ›å»º<code>æ•°æ®æ¨¡å‹</code>åï¼Œä¸€é”®ç”Ÿæˆå¯¹åº”çš„å¢åˆ æ”¹æŸ¥é¡µé¢ï¼š</p><p><br></p><p><img src="/images/crud/Untitled.png" alt="Untitled"></p><p><br></p><aside><br>ğŸ’¡ æœ¬æ–‡æåŠçš„ä½ä»£ç æ˜¯<code>ç‹­ä¹‰</code>çš„<code>ä½ä»£ç </code>ï¼Œä½ å¯ä»¥è®¤ä¸ºå°±æ˜¯<code>å¯è§†åŒ–æ­å»ºå¹³å°</code>ã€‚<br><br></aside><p><br></p><p>ä½ä»£ç åœ¨è¿‡å»å‡ å¹´å°±æ˜¯ ã€Œé›·å£°å¤§ï¼Œé›¨ç‚¹å°ã€ï¼Œè·Ÿç°åœ¨çš„ AI é¢‡ä¸ºç›¸ä¼¼ã€‚</p><p>ä¸ç®¡æ˜¯å¤§å‚è¿˜æ˜¯å°å‚éƒ½åœ¨æä½ä»£ç ï¼ŒåŒ…æ‹¬ç¬”è€…ä¹Ÿå‚ä¸è¿‡å‡ ä¸ªä½ä»£ç é¡¹ç›®ï¼Œä½†æ˜¯å°å‚æ”¯æ’‘ä¸èµ·æ¥è¿™æ ·çš„èµ„æºæŠ•å…¥ï¼Œæœ€åéƒ½èƒæ­»è…¹ä¸­ã€‚æˆ‘ç›¸ä¿¡å¾ˆå¤šè¯»è€…ä¹Ÿç»å†è¿‡è¿™ç§æƒ…å†µã€‚<br>å¤§éƒ¨åˆ†å…¬å¸åªæ˜¯å°¾éšå¸‚åœºè¥é”€å™±å¤´ï¼Œç›²ç›®è·Ÿé£ï¼Œå‹æ ¹å°±æ²¡æœ‰åšè¿™ç§ä½ä»£ç å¹³å°èµ„æºå‡†å¤‡å’Œæ²‰æ·€ã€‚</p><p>ä½œä¸ºå‰ç«¯ï¼Œèƒ½å‚ä¸åˆ°ä½ä»£ç é¡¹ç›®çš„å¼€å‘æ˜¯ä¸€ä»¶éå¸¸å…´å¥‹çš„äº‹æƒ…ï¼Œæ¯•ç«Ÿæ˜¯å°‘æ•°å‰ç«¯èƒ½ä¸»å¯¼çš„é¡¹ç›®ï¼Œæ¶æ„ã€ç»„ä»¶è®¾è®¡ã€ç¼–è¾‘å™¨çš„å®ç°å¯ç©æ€§å¾ˆé«˜ï¼Œå¯ä»¥è·ŸåŒè¡Œå¹å¾ˆä¹…ã€‚</p><p>ä½œä¸ºç”¨æˆ·(å¼€å‘è€…)å‘¢ï¼Ÿå¯èƒ½ä¼š<a href="https://www.zhihu.com/question/561025857" target="_blank" rel="noopener">æ’æ–¥å’Œè´¨ç–‘</a>ï¼Œä¸ç®¡æ€ä¹ˆè¯´ï¼Œå®ƒå¹¶æ²¡æœ‰å‘æŒ¥å¸‚åœºæ‰€æœŸæœ›çš„ä»·å€¼ã€‚</p><p><br></p><p>æœ€ä¸»è¦çš„åŸå› æ˜¯ï¼š<strong>å®ƒè§£å†³ä¸äº†å¤æ‚çš„é—®é¢˜</strong>ã€‚</p><p><br></p><p>ä½ä»£ç ç›´è§‚ã€é—¨æ§›ä½ï¼Œ å‰æœŸå¼€å‘ç¡®å®å¾ˆçˆ½ï¼Œå¯è§†åŒ–æ•°æ®å»ºæ¨¡ã€æ‹–æ‹‰æ‹½ç”Ÿæˆé¡µé¢ã€æµç¨‹ç¼–æ’ï¼Œå¾ˆå¿«å°±å¯ä»¥æŠŠä¸€äº›ç®€å•çš„ä¸šåŠ¡å¼€å‘å‡ºæ¥ã€‚</p><p>ç„¶è€Œè½¯ä»¶ç¼–ç æœ¬èº«å ç”¨ç ”å‘æµç¨‹çš„æ¯”ä¾‹ï¼Œæ® <code>ChatGPT</code> ä¼°ç®—å¤§çº¦åªæœ‰ 20% ~ 30%ã€‚è€Œä¸”ä¸šåŠ¡æŒç»­å˜åŒ–ï¼Œä»£ç ä¹Ÿéœ€è¦æŒç»­è¿­ä»£ã€‚è¯•æƒ³ä¸€ä¸‹å¦‚ä½•åœ¨è¿™äº›ä½ä»£ç å¹³å°ä¸Šè¿›è¡Œé‡æ„å’Œæ£€ç´¢ï¼Ÿ</p><p><br><br><br></p><p>æ€»çš„æ¥è¯´ï¼Œæœ‰ä¸€äº›ç¼ºç‚¹ï¼š</p><ul><li><p><strong>å¤æ‚çš„ä¸šåŠ¡é€»è¾‘ç”¨ä½ä»£ç å¯èƒ½ä¼šæ›´åŠ å¤æ‚ã€‚</strong>ä½ä»£ç åº”è¯¥æ˜¯ç‰¹å®šé¢†åŸŸé—®é¢˜çš„ç®€åŒ–å’ŒæŠ½è±¡ï¼Œå¦‚æœåªæ˜¯å•çº¯å°†åŸæœ‰çš„ç¼–ç å·¥ä½œè½¬æ¢ä¸º GUI çš„æ¨¡å¼ï¼Œå¹¶æ²¡æœ‰å¤šå¤§æ„ä¹‰ã€‚</p><p>  ä¾‹å¦‚æµç¨‹ç¼–æ’ï¼Œè‹¥è¦ç”¨å®ƒä»é›¶æ­å»ºä¸€ä¸ªå¤æ‚çš„æµç¨‹ï¼Œå¦‚æœç…§æ¬<code>æŠ€æœ¯è¯­è¨€</code>å»è¡¨è¾¾å®ƒï¼Œé‚£æœ‰å¯èƒ½æ˜¯ä¸ªåœ°ç‹±ï¼š</p><p>  <img src="/images/crud/Untitled%201.png" alt="Untitled"></p><p>  ç†æƒ³çš„<strong>æµç¨‹ç¼–æ’çš„èŠ‚ç‚¹åº”è¯¥æ˜¯æŠ½è±¡ç¨‹åº¦æ›´é«˜çš„ã€å†…èšçš„<code>ä¸šåŠ¡èŠ‚ç‚¹</code>ï¼Œæ¥è¡¨è¾¾<code>ä¸šåŠ¡æµç¨‹</code>çš„æµè½¬ã€‚ç„¶è€Œ</strong>è¿™äº›èŠ‚ç‚¹çš„è®¾è®¡å’Œå¼€å‘å…¶å®æ˜¯ä¸€ä»¶éå¸¸æœ‰æŒ‘æˆ˜æ€§çš„äº‹æƒ…ã€‚</p></li><li><p><strong>è½¯ä»¶å·¥ç¨‹æ˜¯æŒç»­æ¼”è¿›çš„ï¼Œåœ¨å¯ç»´æŠ¤æ€§æ–¹é¢ï¼Œç›®å‰å¸‚é¢ä¸Šçš„ä½ä»£ç å¹³å°å¹¶ä¸èƒ½æä¾›å¯é çš„è¾…åŠ©å’ŒéªŒè¯ã€‚</strong>å› æ­¤ä¼ä¸šå¾ˆéš¾å°†æ ¸å¿ƒçš„ç¨³æ€ä¸šåŠ¡äº¤ç»™è¿™äº›å¹³å°ã€‚</p></li><li>è¿˜æœ‰å¾ˆå¤šâ€¦ å¹³å°é”å®šï¼Œç¼ºä¹æ ‡å‡†ï¼Œæ€§èƒ½é—®é¢˜ã€å¤ç”¨ã€æ‰©å±•æ€§ã€å®‰å…¨é—®é¢˜ã€é»‘ç›’ï¼Œå¯è¿ç§»æ€§ï¼Œç ”å‘æˆæœ¬é«˜ï¼Œå¯é¢„æµ‹æ€§/å¯è°ƒè¯•æ€§å·®ï¼Œé«˜å¯ç”¨ï¼Œç‰ˆæœ¬ç®¡ç†ï¼Œä¸èƒ½è‡ªåŠ¨åŒ–â€¦</li></ul><p><br><br><br></p><p>å½“ç„¶ï¼Œä½ä»£ç æœ‰ä½ä»£ç çš„é€‚ç”¨åœºæ™¯ï¼Œæ¯”å¦‚è§£å†³ç‰¹å®šé¢†åŸŸé—®é¢˜(è¥é”€æ´»åŠ¨é¡µé¢ï¼Œæµ·æŠ¥ï¼Œæ•°æ®å¤§å±ï¼Œè¡¨å•å¼•æ“ã€å•†åŸè£…ä¿®ã€ä¸»é¡µ)ï¼ŒPOC éªŒè¯ã€‚<strong>å³ä¸€äº›ä¸´æ—¶çš„/éæ ¸å¿ƒçš„æ•æ€ä¸šåŠ¡</strong>ã€‚</p><aside><br>ğŸ’¡ ç›®å‰æœ‰äº›ä½ä»£ç å¹³å°ä¹Ÿæœ‰ã€Œå‡ºç èƒ½åŠ›ã€ï¼Œè®©äºŒå¼€æœ‰äº†ä¸€å®šçš„å¯è¡Œæ€§ã€‚<br><br></aside><aside><br>ğŸ’¡ AI å¢å¼ºåçš„ä½ä»£ç å¯èƒ½ä¼šæ›´åŠ å¼ºå¤§ã€‚ä½†ç¬”è€…ä¾æ—§ä¿æŒè§‚æœ›çš„æ€åº¦ï¼Œæ¯•ç«Ÿå‡†ç¡®åœ°æè¿°è½¯ä»¶éœ€æ±‚ï¼Œæœ¬èº«å°±æ˜¯å°±æ˜¯è½¯ä»¶ç ”å‘çš„éš¾é¢˜ä¹‹ä¸€ï¼Œä¸ç„¶æˆ‘ä»¬ä¹Ÿä¸éœ€è¦ DDDä¸­çš„å„ç§æ–¹æ³•è®ºï¼Œå¼€å„ç§æ‹‰é€šä¼šï¼Œæˆ–è®¸ä¹Ÿä¸éœ€è¦éœ€æ±‚åˆ†æå¸ˆï¼Œäº§å“â€¦<br><br>éä¸“ä¸šç”¨æˆ·ç›´æ¥æè¿°éœ€æ±‚æ¥äº§å‡ºè½¯ä»¶ï¼Œå¤§å¤šæ˜¯ä¸åˆ‡å®é™…çš„è‡†æƒ³<br></aside><p><br><br><br><br><br></p><h2 id="ä¸­é—´å½¢æ€"><a href="#ä¸­é—´å½¢æ€" class="headerlink" title="ä¸­é—´å½¢æ€"></a>ä¸­é—´å½¢æ€</h2><p>æœ‰æ²¡æœ‰ä»‹äºå¯è§†åŒ–ä½ä»£ç å¹³å°å’Œä¸“ä¸šä»£ç ä¹‹é—´çš„ä¸­é—´å½¢æ€ï¼Ÿæ—¢èƒ½ä¿æŒåƒä½ä»£ç å¹³å°æ˜“ç”¨æ€§ï¼ŒåŒæ—¶ç»´æŒä»£ç çš„çµæ´»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</p><p>æˆ‘æƒ³é‚£å°±æ˜¯ DSL(<code>domain-specific language</code>) å§? <strong>DSL èƒŒåä½“ç°çš„æ˜¯å¯¹ç‰¹å®šé¢†åŸŸé—®é¢˜çš„æŠ½è±¡ï¼Œå…¶å½¢å¼å’Œè¯­æ³•å€’æ˜¯æ¬¡è¦çš„ã€‚</strong></p><aside><br>ğŸ’¡ DSL çš„å½¢å¼æœ‰å¾ˆå¤šï¼Œå¯ä»¥åˆ›å»ºä¸€é—¨æ–°çš„å¾®è¯­è¨€(æ¯”å¦‚ SQL, GraphQL)ï¼›å¯ä»¥æ˜¯ä¸€ä¸ª JSON æˆ–è€… YAML å½¢å¼ï¼›ä¹Ÿå¯ä»¥åŸºäºä¸€é—¨ç°æœ‰çš„<code>å…ƒè¯­è¨€</code>(æ¯”å¦‚ Rubyã€Groovyï¼ŒRustâ€¦)æ¥åˆ›å»ºï¼Œè¿™äº›å…ƒè¯­è¨€ï¼Œæä¾›çš„å…ƒç¼–ç¨‹èƒ½åŠ›ï¼Œå¯ä»¥ç®€æ´ä¼˜é›…åœ°è¡¨è¾¾é¢†åŸŸé—®é¢˜ï¼ŒåŒæ—¶èƒ½å¤Ÿå¤ç”¨<code>å…ƒè¯­è¨€</code> æœ¬èº«çš„è¯­è¨€èƒ½åŠ›å’ŒåŸºç¡€è®¾æ–½ã€‚<br><br></aside><p><strong>ä¸¥æ ¼ä¸Šå¯è§†åŒ–ä½ä»£ç å¹³å°ä¹Ÿæ˜¯ä¸€ç§â€˜å¯è§†åŒ–â€™ çš„ DSLï¼Œç¬”è€…è®¤ä¸ºå®ƒçš„å±€é™æ€§æ›´å¤šè¿˜æ˜¯æ¥æºâ€˜å¯è§†åŒ–â€™ï¼Œç›¸å¯¹çš„ï¼Œå®ƒä¼˜ç‚¹ä¹Ÿå¤§å¤šæ¥æºâ€™å¯è§†åŒ–â€˜</strong>ã€‚</p><blockquote><p>è¿™åˆç‰µæ‰¯åˆ°äº†æŒç»­äº†åŠä¸ªå¤šä¸–çºªçš„ï¼š GUI vs CLIï¼ˆç¨‹åºåŒ–/æ–‡æœ¬åŒ–ï¼‰ ä¹‹äº‰ã€‚è¿™ä¸ªåœ¨ã€ŠUNIX ç¼–ç¨‹è‰ºæœ¯ã€‹ä¸­æœ‰æ·±å…¥çš„æ¢è®¨ã€‚å‘½ä»¤è¡Œå’Œå‘½ä»¤è¯­è¨€æ¯”èµ·å¯è§†åŒ–æ¥å£æ¥è¯´ï¼Œæ›´å…·è¡¨è¾¾åŠ›ï¼Œå°¤å…¶æ˜¯é’ˆå¯¹å¤æ‚çš„ä»»åŠ¡ã€‚å¦å¤–å‘½ä»¤è¡Œæ¥å£å…·æœ‰é«˜åº¦è„šæœ¬åŒ–çš„èƒ½åŠ›ã€‚ç¼ºç‚¹å°±æ˜¯éœ€è¦è´¹åŠ²åœ°è®°å¿†ï¼Œæ˜“ç”¨æ€§å·®ï¼Œé€æ˜åº¦ä½ã€‚å½“é—®é¢˜è§„æ¨¡å˜å¤§ã€ç¨‹åºçš„è¡Œä¸ºæ—¥è¶‹å•ä¸€ã€è¿‡ç¨‹åŒ–å’Œé‡å¤æ—¶ï¼Œ CLI ä¹Ÿå¸¸èƒ½å‘æŒ¥ä½œç”¨ã€‚<br><br><br>å¦‚æœæŒ‰ç…§<code>å‹å¥½åº¦</code>å’Œé—®é¢˜åŸŸçš„<code>å¤æ‚åº¦/è§„æ¨¡</code>ä¸¤ä¸ªç»´åº¦æ¥åˆ’åˆ†ï¼Œå¯ä»¥æ‹‰å‡ºä»¥ä¸‹æ›²çº¿ï¼š<br><br><br><img src="/images/crud/Untitled%202.png" alt="Untitled"></p><p>ä¸­é—´ä¼šå‡ºç°ä¸€ä¸ªäº¤å‰ç‚¹ï¼Œåœ¨è¿™ä¸ªäº¤å‰ç‚¹ä¹‹åï¼Œå‘½ä»¤è¡Œçš„ç®€è¦è¡Œå’Œè¡¨è¾¾åŠ›å˜å¾—è¦æ¯”é¿å…è®°å¿†è´Ÿæ‹…æ›´æœ‰ä»·å€¼ã€‚</p><p>ã€Šå Mac æ¥å£ã€‹ä¸€ä¹¦ä¸­ä¹Ÿè¿›è¡Œäº†æ€»ç»“ï¼šå¯è§†åŒ–æ¥å£åœ¨å¤„ç†å°æ•°é‡ç‰©ä½“ç®€å•è¡Œä¸ºçš„æƒ…å†µä¸‹ï¼Œå·¥ä½œçš„å¾ˆå¥½ï¼Œä½†æ˜¯å½“è¡Œä¸ºæˆ–ç‰©ä½“çš„æ•°é‡å¢åŠ æ˜¯ï¼Œç›´æ¥æ“ä½œå¾ˆå¿«å°±ç¼–ç¨‹æœºæ¢°é‡å¤çš„è‹¦å·®â€¦</p></blockquote><p><strong>ä¹Ÿå°±æ˜¯è¯´ï¼ŒDSL çš„å½¢å¼ä¼šçº¦æŸ DSL æœ¬èº«çš„è¡¨è¾¾èƒ½åŠ›ã€‚</strong></p><p><br></p><p>æ­£å¦‚å‰æ–‡è¯´çš„ï¼Œå¦‚æœâ€˜ä½ä»£ç â€™ä»…ä»…æ˜¯å°†åŸæœ¬çš„ç¼–ç å·¥ä½œè½¬æ¢ä¸º GUI å½¢å¼ï¼Œå…¶å®å¹¶æ²¡æœ‰å¤šå¤§æ„ä¹‰ï¼Œå› ä¸ºæ²¡æœ‰æŠ½è±¡ã€‚</p><p>åä¾‹ï¼š</p><p><img src="/images/crud/Untitled%203.png" alt="JSON GUI vs  JSON"></p><p>JSON GUI vs JSON</p><p><br><br><br></p><p>æ­£ä¾‹ï¼š VSCode æ¡ˆä¾‹</p><p><img src="/images/crud/Untitled%204.png" alt="Untitled"></p><p><img src="/images/crud/Untitled%205.png" alt="Untitled"></p><p>å……åˆ†åˆ©ç”¨ GUI çš„ä¼˜åŠ¿ï¼Œæä¾›æ›´å¥½çš„ç›®å½•ç»„ç»‡ã€æ–‡æœ¬æç¤ºã€æ•°æ®å½•å…¥çš„çº¦æŸå’Œæ ¡éªŒã€‚</p><p><br><br><br></p><p>æˆ‘ä»¬å¯èƒ½ä¼šè¯´ GUI å½¢å¼ç”¨æˆ·ä½“éªŒæ›´å¥½ï¼Œé—¨æ§›ä½æ›´ä½ï¼Œä¸ç”¨å…³å¿ƒåº•å±‚çš„ç»†èŠ‚ã€‚<strong>å…¶å®å¹¶ä¸ä¸€å®šæ˜¯ GUI å¸¦æ¥çš„ï¼Œè€Œæ˜¯æŠ½è±¡åçš„ç»“æœã€‚GUI åªä¸è¿‡æ˜¯ä¸€ç§æ¥å£å½¢å¼</strong>ã€‚</p><p><br></p><p>å›åˆ°æ­£é¢˜ï¼Œä¸ºäº†æ‘†è„±ç®¡ç†åå° CRUD çš„ ã€Œè¥¿è¥¿å¼—æ–¯ä¹‹çŸ³ã€ï¼š æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ª DSLï¼Œè¿™ä¸ª DSL æŠ½è±¡äº†ç®¡ç†ç«¯çš„å„ç§åœºæ™¯ï¼Œå°†ç¹ççš„å®ç°ç»†èŠ‚ã€é‡å¤çš„å·¥ä½œå°è£…èµ·æ¥ï¼Œæš´éœ²ç®€æ´è€Œä¼˜é›…çš„ç”¨æˆ·æ¥å£(User Interface)ã€‚</p><aside><br>ğŸ’¡ å°ç»“ã€‚DSL æ˜¯å¯è§†åŒ–ä½ä»£ç ä¸ pro code ä¹‹é—´çš„ä¸­é—´ä¸­é—´å½¢æ€ï¼Œæƒè¡¡äº†æ˜“ç”¨æ€§/çµæ´»æ€§å’Œå®ç°æˆæœ¬ã€‚DSL çš„å½¢å¼ä¼šç›´æ¥å½±å“å®ƒçš„è¡¨è¾¾èƒ½åŠ›ï¼Œä½†æ¯”å½¢å¼æ›´é‡è¦çš„æ˜¯ DSL å¯¹ç‰¹å®šé—®é¢˜åŸŸçš„æŠ½è±¡ã€‚<br><br>æˆ‘ä»¬ä¸å¿…é‡æ–°å‘æ˜ä¸€é—¨è¯­è¨€ï¼Œè€Œæ˜¯å¤ç”¨å…ƒè¯­è¨€çš„èƒ½åŠ›å’Œç”Ÿæ€ï¼Œè¿™åŸºæœ¬ä¸Šæ˜¯é›¶æˆæœ¬ã€‚<br></aside><p><br><br><br><br><br><br><br></p><h2 id="æŠ½è±¡è¿‡ç¨‹"><a href="#æŠ½è±¡è¿‡ç¨‹" class="headerlink" title="æŠ½è±¡è¿‡ç¨‹"></a>æŠ½è±¡è¿‡ç¨‹</h2><p>å…¸å‹çš„å¢åˆ æ”¹æŸ¥é¡µé¢ï¼š</p><p><img src="/images/crud/Untitled%206.png" alt="Untitled"></p><p>åˆ†æè¿‡ç¨‹ï¼š</p><ol><li>åç«¯å¢åˆ æ”¹æŸ¥ä¸»è¦ç”±ä¸¤å¤§ç»„ä»¶ç»„æˆ: <code>è¡¨å•</code>å’Œ<code>è¡¨æ ¼</code>ã€‚</li><li>è€Œè¡¨å•å’Œè¡¨æ ¼åˆç”±æ›´åŸå­çš„â€™<code>å­—æ®µ</code>â€™ç»„æˆã€‚å­—æ®µçš„ç±»å‹å†³å®šäº†å­˜å‚¨ç±»å‹ã€å½•å…¥æ–¹å¼ã€å’Œå±•ç¤ºæ–¹å¼</li><li>å­—æ®µæœ‰ä¸¤ç§å½¢æ€ï¼š<code>ç¼–è¾‘æ€</code>å’Œ<code>é¢„è§ˆæ€</code>ã€‚è¡¨æ ¼åˆ—ã€è¯¦æƒ…é¡µé€šå¸¸æ˜¯é¢„è§ˆæ€ï¼Œè€Œè¡¨å•å’Œè¡¨æ ¼ç­›é€‰åˆ™ä½¿ç”¨ç¼–è¾‘æ€ã€‚</li></ol><p><br></p><p><img src="/images/crud/Untitled%207.png" alt="Untitled"></p><p>å€Ÿé‰´ä½ä»£ç å¹³å°çš„<code>ç»„ä»¶åº“</code>/<code>èŠ‚ç‚¹åº“</code>ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™äº›â€˜å­—æ®µâ€™ æå–å‡ºæ¥ï¼Œ ä½œä¸ºè¡¨å•å’Œè¡¨æ ¼çš„â€˜åŸå­â€™å•ä½ï¼Œ è¿™é‡Œæˆ‘ä»¬ç»™å®ƒå–ä¸ªåå­—ï¼Œå°±å«<code>åŸä»¶</code>(<code>Atomic</code>)å§ã€‚</p><p><img src="/images/crud/Untitled%208.png" alt="Untitled"></p><p><code>åŸä»¶</code>å°†å–ä»£ç»„ä»¶åº“é‡Œé¢çš„<code>è¡¨å•ç»„ä»¶</code>ï¼Œä½œä¸ºæˆ‘ä»¬ <code>CRUD</code> é¡µé¢çš„<strong>æœ€å°ç»„æˆå•ä½</strong>ã€‚å®ƒæœ‰ä¸”åªæœ‰èŒè´£ï¼š</p><p><img src="/images/crud/Untitled%209.png" alt="Untitled"></p><ul><li>æ•°æ®ç±»å‹å’Œæ ¡éªŒã€‚åŸä»¶ä»£è¡¨çš„æ˜¯ä¸€ç§æ•°æ®ç±»å‹ï¼Œå¯ä»¥æ˜¯<code>åŸºç¡€ç±»å‹</code>ï¼Œæ¯”å¦‚æ•°å­—ã€å­—ç¬¦ä¸²ã€å¸ƒå°”å€¼ã€æšä¸¾ï¼›ä¹Ÿå¯ä»¥æ˜¯åŸºç¡€ç±»å‹ä¸ŠåŠ äº†ä¸€äº›çº¦æŸå’Œäº¤äº’ï¼Œæ¯”å¦‚é‚®ä»¶ã€æ‰‹æœºå·ç ã€é“¾æ¥ï¼›ç”šè‡³å¯èƒ½æœ‰<code>ä¸šåŠ¡å±æ€§</code>ï¼Œæ¯”å¦‚ç”¨æˆ·ï¼Œå•†å“ï¼Œè®¢å•ï¼ŒäºŒç»´ç ã€‚</li><li>æ•°æ®çš„é¢„è§ˆã€‚</li><li>æ•°æ®çš„å½•å…¥ï¼Œä¸¥æ ¼çº¦æŸä¸º <code>value</code>/<code>onChange</code> åè®®ã€‚å¥½å¤„æ˜¯æ–¹ä¾¿è¿›è¡ŒçŠ¶æ€ç®¡ç†ï¼Œå¯èƒ½ä¿è¯åŸä»¶å®ç°çš„ç»Ÿä¸€æ€§ã€‚</li></ul><p><br><br><br></p><p>æ¥ç€ç»„åˆåŸä»¶æ¥å®ç°è¡¨å•å’Œè¡¨æ ¼ç»„ä»¶ï¼Œæ»¡è¶³ CRUD åœºæ™¯ï¼š</p><p><img src="/images/crud/Untitled%2010.png" alt="Untitled"></p><p>ç†æƒ³çŠ¶æ€ä¸‹ï¼Œæˆ‘ä»¬ä»…éœ€å£°æ˜å¼åœ°æŒ‡å®šè¡¨æ ¼çš„åˆ—å’ŒåŸä»¶ç±»å‹ï¼Œå…¶ä½™çš„æŠ€æœ¯ç»†èŠ‚åº”è¯¥éšè—èµ·æ¥ã€‚è¡¨æ ¼ä¼ªä»£ç ç¤ºä¾‹ï¼š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºåŒ…å« åç§°ã€åˆ›å»ºæ—¶é—´ã€çŠ¶æ€ä¸‰åˆ—çš„è¡¨æ ¼ï¼Œå…¶ä¸­å¯ä»¥æœç´¢åç§°å’Œåˆ›å»ºæ—¶é—´</span></span><br><span class="line">Table(</span><br><span class="line">  columns(</span><br><span class="line">    column(åç§°ï¼Œname, queryable=<span class="literal">true</span>)</span><br><span class="line">    column(åˆ›å»ºæ—¶é—´, created, data-range, queryable=<span class="literal">true</span>)</span><br><span class="line">    column(çŠ¶æ€, status, select, options=[&#123;label: å¯ç”¨ï¼Œvalue: 1, &#123;label: ç¦ç”¨ï¼Œ value: 0&#125;&#125;])</span><br><span class="line">  )</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p><br></p><p>è¡¨å•ä¼ªä»£ç ç¤ºä¾‹ï¼š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºåŒ…å« åç§°ã€çŠ¶æ€ã€åœ°å€çš„è¡¨å•</span></span><br><span class="line">Form(</span><br><span class="line">  item(åç§°ï¼Œname, required=<span class="literal">true</span>)</span><br><span class="line">  item(çŠ¶æ€ï¼Œstatus, select, options=[&#123;label: å¯ç”¨ï¼Œvalue: 1, &#123;label: ç¦ç”¨ï¼Œ value: 0&#125;&#125;])</span><br><span class="line">  item(åœ°å€, address, address)</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p><br></p><p>å¦‚ä¸Šæ‰€ç¤ºï¼Œæœ¬è´¨ä¸Šï¼Œå¼€å‘è€…å°±åº”è¯¥åªå…³æ³¨ä¸šåŠ¡æ•°æ®æœ¬èº«ï¼Œè€Œåº”è¯¥å¿½ç•¥æ‰å‰ç«¯æŠ€æœ¯å®ç°çš„å™ªéŸ³(æ¯”å¦‚çŠ¶æ€ç®¡ç†ã€å±•ç¤ºé£æ ¼ã€åˆ†é¡µã€å¼‚å¸¸å¤„ç†ç­‰ç­‰)ã€‚</p><p><br><br><br></p><p>è¡¨æ ¼å’Œè¡¨å•ä¸ºäº†é€‚åº”ä¸åŒçš„éœ€æ±‚ï¼Œè¿˜ä¼šè¡ç”Ÿå‡ºä¸åŒçš„å±•ç°å½¢å¼ï¼š</p><p><img src="/images/crud/Untitled%2011.png" alt="Untitled"></p><p><code>åŸä»¶</code> + <code>æ ¸å¿ƒçš„è¡¨å•/è¡¨æ ¼èƒ½åŠ›</code> + <code>åœºæ™¯/å±•ç¤ºå½¢å¼</code>ï¼Œä¸€å¥—ã€Œç»„åˆæ‹³ã€ä¸‹æ¥ï¼ŒåŸºæœ¬å°±å¯ä»¥æ»¡è¶³å¸¸è§çš„åå° CRUD éœ€æ±‚äº†ã€‚</p><p><br><br><br><br><br></p><h2 id="çº¦å®šå¤§äºé…ç½®"><a href="#çº¦å®šå¤§äºé…ç½®" class="headerlink" title="çº¦å®šå¤§äºé…ç½®"></a>çº¦å®šå¤§äºé…ç½®</h2><p>å‰ç«¯çš„åœ¨ç ”å‘æµç¨‹ä¸­ç›¸å¯¹ä¸‹æ¸¸ï¼Œå¦‚æœä¸Šæ¸¸çš„äº§å“å®šä¹‰ï¼ŒUI è®¾è®¡ï¼Œåç«¯åè®®æ²¡æœ‰ä¿æŒä¸€è‡´æ€§ï¼Œå°±ä¼šè‹¦äºåº”ä»˜å„ç§æ··ä¹±çš„å·®å¼‚ï¼Œå¤ç”¨æ€§å°†æ— ä»è°ˆèµ·ã€‚</p><p>ä¸ºäº†æœ€å°åŒ–æ ·æ¿ä»£ç å’Œæ²Ÿé€šæˆæœ¬ï¼Œå®ç°å¼€ç®±å³ç”¨çš„æ•ˆæœã€‚æˆ‘ä»¬æœ€å¥½æ‹‰é€šä¸Šä¸‹æ¸¸ï¼Œå°†ç›¸å…³çš„è§„èŒƒç¡®å®šä¸‹æ¥ï¼Œå‰ç«¯å¼€å‘è€…åº”è¯¥æ‰®æ¼”å¥½ä¸²è”çš„è§’è‰²ã€‚</p><p><br></p><p>è¿™äº›è§„èŒƒåŒ…å«ä½†ä¸é™äºï¼š</p><ul><li>é¡µé¢çš„å¸ƒå±€</li><li>UI é£æ ¼</li><li>æç¤ºè¯­</li><li>éªŒè¯è§„åˆ™</li><li>æ•°æ®çš„å­˜å‚¨æ ¼å¼</li><li>é€šç”¨çš„æ¥å£(æ¯”å¦‚æ–‡ä»¶ä¸Šä¼ ï¼Œå¯¼å…¥å¯¼å‡º)</li><li>â€¦</li></ul><p><img src="/images/crud/Untitled%2012.png" alt="Untitled"></p><p>ç»„ä»¶åº“å¯ä»¥å†…ç½®è¿™äº›çº¦å®šï¼Œæˆ–è€…æä¾›å…¨å±€çš„é…ç½®æ–¹å¼ã€‚è¿™äº›è§„èŒƒå›ºåŒ–åï¼Œæˆ‘ä»¬å°±äº«å—å¼€ç®±å³ç”¨çš„å¿«æ„Ÿäº†ã€‚</p><p><br><br><br><br><br></p><h2 id="å®ç°ç¤ºä¾‹"><a href="#å®ç°ç¤ºä¾‹" class="headerlink" title="å®ç°ç¤ºä¾‹"></a>å®ç°ç¤ºä¾‹</h2><p>åŸºäºä¸Šè¿°æ€æƒ³ï¼Œæˆ‘ä»¬å¼€å‘äº†ä¸€å¥—<a href="https://wakeadmin.wakedata.com/components-doc/" target="_blank" rel="noopener">ç»„ä»¶åº“</a>(åŸºäº Vue å’Œ element-ui)ï¼Œé…åˆä¸€å¥—ç®€æ´çš„ DSLï¼Œæ¥å¿«é€Ÿå¼€å‘ CRUD é¡µé¢ã€‚</p><p><br></p><aside><br>ğŸ’¡ <strong><em>è¿™å¥—ç»„ä»¶åº“è€¦åˆäº†æˆ‘ä»¬è‡ªå·±çš„çº¦å®š</em></strong>ã€‚å› æ­¤å¯èƒ½ä¸é€‚ç”¨äºå¤–éƒ¨é€šç”¨çš„åœºæ™¯ã€‚æœ¬æ–‡çš„æ„ä¹‰æ›´å¤šæ˜¯æƒ³å¯å‘è¯»è€…ï¼Œå»æ„å»ºé€‚åˆè‡ªå·±çš„ä¸€å¥—è§£å†³æ–¹æ¡ˆã€‚<br><br></aside><p><strong>åˆ—è¡¨é¡µå®šä¹‰ï¼š</strong></p><p><img src="/images/crud/Untitled%2013.png" alt="Untitled"></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import &#123; defineFatTable &#125; from &apos;@wakeadmin/components&apos;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * è¡¨æ ¼é¡¹ç±»å‹</span><br><span class="line"> */</span><br><span class="line">export interface Item &#123;</span><br><span class="line">  id: number</span><br><span class="line">  name: string</span><br><span class="line">  createDate: number</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export const MyTable = defineFatTable&lt;Item&gt;((&#123; column &#125;) =&gt; &#123;</span><br><span class="line">  // å¯ä»¥åœ¨è¿™é‡Œæ”¾ç½® Vue hooks</span><br><span class="line">  return () =&gt; (&#123;</span><br><span class="line">    async request(params) &#123;</span><br><span class="line">      /* æ•°æ®è·å–ï¼Œè‡ªåŠ¨å¤„ç†å¼‚å¸¸å’ŒåŠ è½½çŠ¶æ€ */</span><br><span class="line">    &#125;,</span><br><span class="line">    // åˆ é™¤æ“ä½œ</span><br><span class="line">    async remove(list, ids) &#123;</span><br><span class="line">      /*åˆ—åˆ é™¤*/</span><br><span class="line">    &#125;,</span><br><span class="line">    // è¡¨æ ¼åˆ—</span><br><span class="line">    columns: [</span><br><span class="line">      // queryable æ ‡è®°ä¸ºæŸ¥è¯¢å­—æ®µ</span><br><span class="line">      column(&#123; prop: &apos;name&apos;, label: &apos;åç§°&apos;, queryable: true &#125;),</span><br><span class="line">      column(&#123; prop: &apos;createDate&apos;, valueType: &apos;date-range&apos;, label: &apos;åˆ›å»ºæ—¶é—´&apos;, queryable: true &#125;),</span><br><span class="line">      column(&#123;</span><br><span class="line">        type: &apos;actions&apos;,</span><br><span class="line">        label: &apos;æ“ä½œ&apos;,</span><br><span class="line">        actions: [&#123; name: &apos;ç¼–è¾‘&apos; &#125;, &#123; name: &apos;åˆ é™¤&apos;, onClick: (table, row) =&gt; table.remove(row) &#125;],</span><br><span class="line">      &#125;),</span><br><span class="line">    ],</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>è¯­æ³•ç±»ä¼¼äº Vue defineComponentï¼Œä¼ å…¥ä¸€ä¸ªâ€™setupâ€™, ã€‚è¿™ä¸ª setup ä¸­å¯ä»¥æ”¾ç½®ä¸€äº›é€»è¾‘å’ŒçŠ¶æ€æˆ–è€… Vue hooksï¼Œå°±å’Œ Vue defineComponent å®šä¹‰ä¸€æ ·çµæ´»ã€‚</p><p>è¿”å›å…³äºè¡¨æ ¼ç»“æ„çš„â€å£°æ˜â€ã€‚æœ€ä¼˜çš„æƒ…å†µä¸‹ï¼Œå¼€å‘è€…åªéœ€è¦å®šä¹‰è¡¨æ ¼ç»“æ„å’Œåç«¯æ¥å£ï¼Œå…¶ä½™çš„äº¤ç”±ç»„ä»¶åº“å¤„ç†ã€‚</p><p>å½“ç„¶å¤æ‚çš„å®šåˆ¶åœºæ™¯ä¹Ÿèƒ½æ»¡è¶³ï¼Œè¿™é‡Œå¯ä»¥ä½¿ç”¨ JSXï¼Œç›‘å¬äº‹ä»¶ï¼Œä¼ é€’ç»„ä»¶æ”¯æŒçš„ä»»æ„ props å’Œ slotsã€‚</p><p><br><br><br></p><p><strong>è¡¨å•é¡µç¤ºä¾‹:</strong></p><p><img src="/images/crud/Untitled%2014.png" alt="Untitled"></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import &#123; defineFatForm &#125; from &apos;@wakeadmin/components&apos;</span><br><span class="line">import &#123; ElMessageBox &#125; from &apos;element-plus&apos;</span><br><span class="line"></span><br><span class="line">export default defineFatForm&lt;&#123;</span><br><span class="line">  // ğŸ”´ è¿™é‡Œçš„æ³›å‹å˜é‡å¯ä»¥å®šä¹‰è¡¨å•æ•°æ®ç»“æ„</span><br><span class="line">  name: string</span><br><span class="line">  nickName: string</span><br><span class="line">&#125;&gt;((&#123; item, form, consumer, group &#125;) =&gt; &#123;</span><br><span class="line">  // ğŸ”´ è¿™é‡Œå¯ä»¥æ”¾ç½® Vue Hooks</span><br><span class="line"></span><br><span class="line">  // è¿”å›è¡¨å•å®šä¹‰</span><br><span class="line">  return () =&gt; (&#123;</span><br><span class="line">    // FatForm props å®šä¹‰</span><br><span class="line">    initialValue: &#123;</span><br><span class="line">      name: &apos;ivan&apos;,</span><br><span class="line">      nickName: &apos;ç‹—è›‹&apos;,</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    submit: async (values) =&gt; &#123;</span><br><span class="line">      await ElMessageBox.confirm(&apos;ç¡®è®¤ä¿å­˜&apos;)</span><br><span class="line">      console.log(&apos;ä¿å­˜æˆåŠŸ&apos;, values)</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    // ğŸ”´ å­èŠ‚ç‚¹</span><br><span class="line">    children: [</span><br><span class="line">      item(&#123; prop: &apos;name&apos;, label: &apos;è´¦å·å&apos; &#125;),</span><br><span class="line">      item(&#123;</span><br><span class="line">        prop: &apos;nickName&apos;,</span><br><span class="line">        label: &apos;æ˜µç§°&apos;,</span><br><span class="line">      &#125;),</span><br><span class="line">    ],</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><aside><br>ğŸ’¡ å’Œ tailwind é…åˆé£Ÿç”¨æ›´é¦™ã€‚æˆ‘ä»¬å‡è®¾æ•´ä½“çš„é¡µé¢æ˜¯ç¬¦åˆUIè§„èŒƒçš„ï¼Œç»†å¾®çš„è°ƒæ•´ä½¿ç”¨ tw ä¼šå¾ˆæ–¹ä¾¿<br><br></aside><p><br><br><br></p><p><strong>å…¨å±€é…ç½®ï¼š</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import &#123; provideFatConfigurable &#125; from &apos;@wakeadmin/components&apos;</span><br><span class="line">import &#123; Message &#125; from &apos;element-ui&apos;</span><br><span class="line"></span><br><span class="line">export function injectFatConfigurations() &#123;</span><br><span class="line">  provideFatConfigurable(&#123;</span><br><span class="line">    // ...</span><br><span class="line">    // ç»Ÿä¸€å¤„ç† images åŸä»¶ä¸Šä¼ </span><br><span class="line">    aImagesProps: &#123;</span><br><span class="line">      action: &apos;/upload&apos;,</span><br><span class="line">    &#125;,</span><br><span class="line">    // ç»Ÿä¸€ date-range åŸä»¶å±æ€§</span><br><span class="line">    aDateRangeProps: &#123;</span><br><span class="line">      rangeSeparator: &apos;è‡³&apos;,</span><br><span class="line">      startPlaceholder: &apos;å¼€å§‹æ—¥æœŸ&apos;,</span><br><span class="line">      endPlaceholder: &apos;ç»“æŸæ—¥æœŸ&apos;,</span><br><span class="line">      valueFormat: &apos;yyyy-MM-dd&apos;,</span><br><span class="line">      shortcuts: [</span><br><span class="line">        &#123;</span><br><span class="line">          text: &apos;æœ€è¿‘ä¸€å‘¨&apos;,</span><br><span class="line">          onClick(picker: any) &#123;</span><br><span class="line">            picker.$emit(&apos;pick&apos;, getTime(7))</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          text: &apos;æœ€è¿‘ä¸€ä¸ªæœˆ&apos;,</span><br><span class="line">          onClick(picker: any) &#123;</span><br><span class="line">            picker.$emit(&apos;pick&apos;, getTime(30))</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          text: &apos;æœ€è¿‘ä¸‰ä¸ªæœˆ&apos;,</span><br><span class="line">          onClick(picker: any) &#123;</span><br><span class="line">            picker.$emit(&apos;pick&apos;, getTime(90))</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">      ],</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br><br><br></p><p>æ›´å¤šç¤ºä¾‹å’Œæ·±å…¥è®²è§£è§<a href="https://wakeadmin.wakedata.com/components-doc/" target="_blank" rel="noopener">è¿™é‡Œ</a>ã€‚</p><p><br><br><br><br><br></p><h2 id="æ›´å¤šå®ç°"><a href="#æ›´å¤šå®ç°" class="headerlink" title="æ›´å¤šå®ç°"></a>æ›´å¤šå®ç°</h2><p>å‰ç«¯ç¤¾åŒºæœ‰å¾ˆå¤šç±»ä¼¼çš„äº§å“ï¼Œæ¯”å¦‚ï¼š</p><ul><li><a href="https://xrender.fun/" target="_blank" rel="noopener">XRender</a>ã€‚ä¸­åå°ã€Œè¡¨å•/è¡¨æ ¼/å›¾è¡¨ã€å¼€ç®±å³ç”¨è§£å†³æ–¹æ¡ˆ</li><li><a href="https://procomponents.ant.design/docs/intro" target="_blank" rel="noopener">Antd ProComponents</a>ã€‚ProComponents æ˜¯åŸºäº Ant Design è€Œå¼€å‘çš„æ¨¡æ¿ç»„ä»¶ï¼Œæä¾›äº†æ›´é«˜çº§åˆ«çš„æŠ½è±¡æ”¯æŒï¼Œå¼€ç®±å³ç”¨ã€‚å¯ä»¥æ˜¾è‘—çš„æå‡åˆ¶ä½œ CRUD é¡µé¢çš„æ•ˆç‡ï¼Œæ›´åŠ ä¸“æ³¨äºé¡µé¢</li><li><a href="https://github.com/baidu/amis" target="_blank" rel="noopener">ç™¾åº¦ Amis</a> ã€‚ ç”¨ JSON ä½œä¸º DSLï¼Œæ¥æè¿°ç•Œé¢</li></ul><p>è¯»è€…ä¸å¦¨å¤šå‚è€ƒå‚è€ƒã€‚</p><p><br><br><br><br><br></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ç®€å•æ¥è¯´ï¼Œæˆ‘ä»¬å°±æ˜¯ä»æä¾›ã€Œ<strong>æ¯›å¯æˆ¿</strong>ã€å‡çº§åˆ°äº†ã€Œ<strong>ç²¾è£…æˆ¿</strong>ã€ï¼Œç²¾è£…æˆ¿çš„è®¾è®¡åŸºäºæˆ‘ä»¬å¯¹å¸‚åœºéœ€æ±‚çš„å……åˆ†è°ƒç ”å’Œé¢„åˆ¤ã€‚ç›®çš„æ˜¯å¯¹äº 80% çš„ç”¨æˆ·åœºæ™¯ï¼Œå¯ä»¥å®ç°æ‹åŒ…å…¥ä½ï¼Œå½“ç„¶ä¹Ÿå…è®¸ç”¨æˆ·åœ¨çº¦æŸçš„èŒƒå›´å†…æ”¹è£…ã€‚</p><p>æœ¬æ–‡ä¸»è¦é˜è¿°çš„è§‚ç‚¹ï¼š</p><ul><li>ä½ä»£ç å¹³å°çš„é«˜æ•ˆå’Œæ˜“ç”¨å¤§å¤šæ¥æºäºæŠ½è±¡ï¼Œè€Œä¸ä¸€å®šæ˜¯ GUIï¼ŒGUI â‰  ä½ä»£ç ã€‚</li><li>æ‘†è„±ã€Œè¥¿è¥¿å¼—æ–¯ä¹‹çŸ³ã€ è€ƒéªŒçš„æ˜¯å¼€å‘è€…çš„æŠ½è±¡èƒ½åŠ›ï¼Œè¯†åˆ«ä»£ç ä¸­å›ºåŒ–/é‡å¤çš„é€»è¾‘ã€‚å°†æ¨¡å¼æå–å‡ºæ¥ï¼ŒåŒæ—¶å°è£…æ‰åº•å±‚çš„å®ç°ç»†èŠ‚ã€‚æœ€ç»ˆçš„ç›®çš„æ˜¯è®©å¼€å‘è€…å°†æ³¨æ„åŠ›å…³æ³¨åˆ°ä¸šåŠ¡æœ¬èº«ï¼Œè€Œä¸æ˜¯æŠ€æœ¯å®ç°ç»†èŠ‚ã€‚</li><li>ç”¨å£°æ˜å¼ã€ç²¾ç®€ã€é«˜åº¦æŠ½è±¡ DSL æè¿°ä¸šåŠ¡ ã€‚DSL çš„å½¢å¼ä¼šçº¦æŸä»–çš„è¡¨è¾¾èƒ½åŠ›ï¼Œæˆ‘ä»¬å¹¶ä¸ä¸€å®šè¦åˆ›å»ºä¸€é—¨æ–°çš„è¯­è¨€ï¼Œæœ€ç®€å•çš„æ˜¯å¤ç”¨å…ƒè¯­è¨€çš„ç”Ÿæ€å’Œèƒ½åŠ›ã€‚</li><li>çº¦å®šå¤§äºé…ç½®ã€‚è®¾è®¡é£æ ¼ã€äº¤äº’æµç¨‹ã€æ•°æ®å­˜å‚¨ç­‰ä¿æŒä¸€è‡´æ€§ï¼Œæ‰èƒ½ä¿è¯æŠ½è±¡æ”¶ç›Šçš„æœ€å¤§åŒ–ã€‚å› æ­¤è§„èŒƒå¾ˆé‡è¦ã€‚è¿™éœ€è¦æˆ‘ä»¬å’Œè®¾è®¡ã€äº§å“ã€åç«¯æ·±å…¥æ²Ÿé€šï¼Œè¾¾æˆä¸€è‡´ã€‚</li><li>æ²‰æ·€åŸä»¶ã€‚ä½ä»£ç å¹³å°çš„æ•ˆç‡å–å†³äºå¹³å°æä¾›çš„ç»„ä»¶èƒ½åŠ›ã€æ•°é‡å’Œç²’åº¦ã€‚æ¯”å¦‚å‰ç«¯çš„ç»„ä»¶åº“ï¼Œäº¦æˆ–è€…æµç¨‹å¼•æ“çš„èŠ‚ç‚¹ï¼Œéƒ½å±äºåŸä»¶çš„èŒƒç•´ã€‚</li><li>è¦æ±‚ä¸è¦å¤ªé«˜ï¼Œè¿™å¹¶ä¸æ˜¯ä¸€ä¸ªä¸‡ç²¾æ²¹æ–¹æ¡ˆï¼Œæˆ‘ä»¬æœŸæœ›èƒ½æ»¡è¶³ 80% å¸¸è§çš„åœºæ™¯ï¼Œè¿™å·²ç»æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æˆç»©ã€‚è‡³äºé‚£ 20% çš„ä¸ªæ€§éœ€æ±‚ï¼Œè¿˜æ˜¯ä»æ¯›å¯æˆ¿æèµ·å§ã€‚</li></ul><p><br><br><br><br><br></p><h2 id="æ‰©å±•é˜…è¯»"><a href="#æ‰©å±•é˜…è¯»" class="headerlink" title="æ‰©å±•é˜…è¯»"></a>æ‰©å±•é˜…è¯»</h2><ul><li><a href="https://github.com/ascoders/weekly/issues/319" target="_blank" rel="noopener">ç²¾è¯»ã€Šä½ä»£ç é€»è¾‘ç¼–æ’ã€‹</a></li><li>UNIX ç¼–ç¨‹è‰ºæœ¯</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;img src=&quot;/images/crud/Untitled.jpeg&quot; alt=&quot;Untitled&quot;&gt;&lt;/p&gt;
&lt;p&gt;æ®è¯´ï¼Œè¥¿è¥¿å¼—æ–¯æ˜¯ä¸€ä¸ªéå¸¸èªæ˜çš„å›½ç‹ï¼Œä½†ä»–ä¹Ÿéå¸¸è‡ªè´Ÿå’Œç‹‚å¦„ã€‚ä»–ç”šè‡³æ•¢æ¬ºéª—ç¥çµï¼Œå¹¶æŠŠæ­»è€…å¸¦å›äººé—´ã€‚ä¸ºæ­¤ï¼Œä»–è¢«å®™æ–¯ï¼ˆZeusï¼‰æƒ©ç½šï¼Œè¢«è¿«æ¯å¤©æ¨ç€ä¸€å—å·¨çŸ³ä¸Šå±±ï¼Œ
      
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://bobi.ink/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>å¦‚ä½•å®ç°æ”¯æŒè·¨ Vue 2/3 çš„ç»„ä»¶åº“</title>
    <link href="https://bobi.ink/2023/06/11/component-for-vue2-3/"/>
    <id>https://bobi.ink/2023/06/11/component-for-vue2-3/</id>
    <published>2023-06-10T16:00:00.000Z</published>
    <updated>2023-06-11T14:21:51.353Z</updated>
    
    <content type="html"><![CDATA[<p><br></p><p><img src="/images/component-for-vue2-3/Untitled.jpeg" alt="Untitled"></p><p>Vue 3 å·²ç»<a href="https://vue-js.com/topic/5f65624c96b2cb0032c38550" target="_blank" rel="noopener">å‘å¸ƒ</a>ä¸‰å¹´ï¼Œæˆ‘ä»¬æœ‰è¾ƒå¤šé¡¹ç›®è¿˜åœç•™åœ¨ Vue 2ã€‚Vue 3 çš„å‡çº§æ˜¯æ¯”è¾ƒå‰²è£‚çš„ã€‚</p><p>æˆ‘ä»¬ä¸»è¦åšçš„æ˜¯ <code>2B</code> ä¸šåŠ¡ï¼Œé¡¹ç›®ã€æ¨¡å—ã€åˆ†æ”¯éƒ½éå¸¸å¤šï¼Œå‡çº§çš„æˆæœ¬å’Œé£é™©éƒ½æ¯”è¾ƒé«˜ã€‚</p><p>æˆ‘ä»¬ç›®å‰çš„ç­–ç•¥æ˜¯ â€œæ–°æ—§å¹¶å­˜ï¼Œæ¸è¿›å¼å‡çº§â€ï¼Œ æ—§çš„é¡¹ç›®å°±å°½é‡ä¸å˜äº†ï¼Œæ–°çš„é¡¹ç›®å¼ºåˆ¶ä½¿ç”¨æ–°çš„æŠ€æœ¯æ ˆã€‚åˆ©ç”¨<code>å¾®å‰ç«¯</code>æ¶æ„ï¼Œæ–°æ—§åº”ç”¨å¯ä»¥çµæ´»åœ°ç»„åˆèµ·æ¥ã€‚</p><p>å› æ­¤æˆ‘ä»¬çš„ä¸šåŠ¡ç»„ä»¶åº“ã€å·¥å…·åº“ä¹‹ç±»éœ€è¦è€ƒè™‘å…¼å®¹æ—§çš„ Vue 2 é¡¹ç›®ã€‚è¿™ç¯‡æ–‡ç« ï¼Œå°±å‘å¤§å®¶å±•ç¤ºæˆ‘ä»¬å¼€å‘è·¨ç‰ˆæœ¬ç»„ä»¶åº“ï¼Œå…¶ä¸­çš„å†³ç­–å’Œå®ç°è¿‡ç¨‹ã€‚</p><p><br><br><br></p><h2 id="æ–¹æ¡ˆå†³ç­–"><a href="#æ–¹æ¡ˆå†³ç­–" class="headerlink" title="æ–¹æ¡ˆå†³ç­–"></a>æ–¹æ¡ˆå†³ç­–</h2><p>å®ç°è·¨ç‰ˆæœ¬çš„ç»„ä»¶éƒ½å¤šç§æ–¹æ¡ˆï¼Œä¸‹é¢åˆ—ä¸¾åˆ†æå‡ ç§ä¸»è¦æ–¹æ¡ˆï¼š</p><p><br></p><p><strong>æ–¹æ¡ˆä¸€ï¼šä½¿ç”¨ Vue SFC / æ¨¡æ¿</strong></p><p>å•çº¯ä»å¤–è§‚ä¸Šçœ‹ Vue 2 / 3 åœ¨æ¨¡æ¿çš„è¯­æ³•ä¸Š<a href="https://v3-migration.vuejs.org/zh/breaking-changes/v-model.html" target="_blank" rel="noopener">å·®åˆ«å¹¶ä¸å¤§</a>ã€‚åœ¨ <a href="https://blog.vuejs.org/posts/vue-2-7-naruto" target="_blank" rel="noopener">Vue 2.7</a> å¼€å§‹å†…ç½®äº†å¯¹ <code>script setup</code> ä¹Ÿæœ‰äº†è¾ƒå¥½çš„æ”¯æŒã€‚</p><p>ç†è®ºä¸Šï¼Œæˆ‘ä»¬å¯ä»¥ç¼–å†™ä¸€ä»½ä»£ç ï¼Œç„¶ååˆ†åˆ«é’ˆå¯¹ 2 / 3 ç¼–è¯‘ä¸¤ä»½è¾“å‡ºã€‚</p><p><img src="/images/component-for-vue2-3/Untitled.png" alt="æ€»ä½“æµç¨‹å¦‚ä¸Š"></p><p>æ€»ä½“æµç¨‹å¦‚ä¸Š</p><p><strong>ç¬”è€…æä¾›äº†ä¸€ä¸ªç®€å•çš„ DEMO æ¥éªŒè¯äº†è¿™ä¸ªæ–¹æ¡ˆçš„å¯è¡Œæ€§ï¼Œè¯¦è§<a href="https://github.com/wakeadmin/cvv-sfc-demo" target="_blank" rel="noopener">è¿™é‡Œ</a>ã€‚</strong></p><ul><li>ä¼˜ç‚¹<ul><li>æ¨¡æ¿æ˜¯ Vue çš„ç¬¬ä¸€å…¬æ°‘ï¼Œä¸éœ€è¦ä¸ºäº†å…¼å®¹ä¸åŒç‰ˆæœ¬æ”¹å˜åŸæœ‰çš„å¼€å‘ä¹ æƒ¯ã€‚å­¦ä¹ æˆæœ¬æ¯”è¾ƒä½</li><li>æ”¯æŒé™æ€ç¼–è¯‘ï¼Œæ¯”å¦‚å¯ä»¥é’ˆå¯¹ä¸åŒçš„ç‰ˆæœ¬è¿›è¡Œæ¡ä»¶ç¼–è¯‘ï¼Œ<strong>ä¼˜åŒ–åŒ…ä½“ç§¯</strong>ã€‚å¦å¤–å¯ä»¥<strong>ä¿ç•™<a href="https://cn.vuejs.org/guide/extras/rendering-mechanism.html#compiler-informed-virtual-dom" target="_blank" rel="noopener">Vue æ¨¡æ¿ç¼–è¯‘ä¼˜åŒ–</a>æœºåˆ¶</strong>ã€‚</li><li>ä½¿ç”¨å…¬å¼€æ ‡å‡†è¯­æ³•ï¼Œä¸éœ€è¦ hack æˆ–è€…å…³å¿ƒå¤ªå¤šæ¡†æ¶åº•å±‚çš„å·®å¼‚ã€‚</li></ul></li><li>ç¼ºç‚¹<ul><li>æ„å»ºç›¸å¯¹å¤æ‚ï¼Œéœ€è¦ä¸¤ä»½ä»£ç è¾“å‡ºã€‚</li><li>çµæ´»æ€§è¾ƒå·®ã€‚æ¨¡æ¿è¯­æ³•å·®å¼‚å¾ˆå°ï¼Œä½†ä¸ä»¥ä¸ºç€æ²¡æœ‰å·®å¼‚ï¼Œå½“éœ€è¦å¤„ç†æŸäº›è·¨ç‰ˆæœ¬å·®å¼‚æ—¶å¯èƒ½ä¼šæ¯”è¾ƒæ£˜æ‰‹ã€‚æ¯”å¦‚<a href="https://v3-migration.vuejs.org/zh/breaking-changes/render-function-api.html" target="_blank" rel="noopener">å‘ä¸‹é€ä¼ äº‹ä»¶ã€props æˆ–è€… slots</a> , <a href="https://v3-migration.vuejs.org/zh/breaking-changes/v-bind.html" target="_blank" rel="noopener">v-bind.sync åºŸå¼ƒäº†</a> ã€<a href="https://v3-migration.vuejs.org/zh/breaking-changes/key-attribute.html" target="_blank" rel="noopener">template v-for key</a> <strong>ã€</strong>v-model åè®®å˜åŒ–ã€‚</li><li>âš ï¸ è¯­æ³•å›ºåŒ–ï¼Œä¸ºäº†å…¼å®¹ Vue 2ï¼Œtemplate è¯­æ³•éœ€è¦åœç•™åœ¨ Vue 3.0ï¼Œè¿™æ„å‘³ç€åç»­å‘å¸ƒçš„æ–°ç‰¹æ€§å¯èƒ½æ— æ³•ä½¿ç”¨ï¼Œæ¯”å¦‚ <code>defineModel</code>ï¼Œ<code>defineOptions</code>ã€‚</li></ul></li></ul><p><br><br><br><br><br></p><p><strong>æ–¹æ¡ˆ 2ï¼š æ¸²æŸ“å‡½æ•°</strong></p><p>Vue 2 å’Œ Vue 3 éƒ½æ”¯æŒæ¸²æŸ“å‡½æ•°ï¼Œä½†æ˜¯ä¸¤è€…ä¹‹é—´æœ‰éå¸¸å¤§çš„å·®å¼‚ã€‚<strong>è¯¦ç»†çš„å·®å¼‚å¯¹æ¯”å¯ä»¥çœ‹ç¬”è€…æ•´ç†çš„è¿™ç¯‡æ–‡æ¡£ï¼š <a href="https://www.notion.so/Vue-2-3-302cbe0e37794345bbfbd89e32d617db?pvs=21" target="_blank" rel="noopener">Vue 2/3 æ¸²æŸ“å‡½æ•°å·®å¼‚ä»¥åŠå…¼å®¹æ–¹æ¡ˆ</a></strong></p><p><br></p><p><strong>é‚£ Vue å®˜æ–¹çš„ JSX æ’ä»¶å‘¢ï¼Ÿ</strong></p><p>Vue 2/3 JSX Babel (<strong><a href="https://github.com/vuejs/jsx-vue2" target="_blank" rel="noopener">jsx-vue2</a>ã€<a href="https://github.com/vuejs/babel-plugin-jsx" target="_blank" rel="noopener">babel-plugin-jsx</a></strong>)æ’ä»¶åŠ äº†ä¸€äº›è¯­æ³•ç³–ï¼Œæ¥ç®€åŒ–æ¸²æŸ“å‡½æ•°çš„ç¼–å†™ï¼Œä½†æ˜¯è¿™ä¸¤ä¸ªæ’ä»¶çš„è¯­æ³•å®Œå…¨æ˜¯ä¸¤ä¸ªä¸œè¥¿ã€‚</p><p>å› æ­¤è¿™ä¸ªæ–¹æ¡ˆä¸åœ¨æˆ‘ä»¬çš„è€ƒè™‘ä¹‹åˆ—ã€‚</p><p><br><br><br><br><br></p><p><strong>æ–¹æ¡ˆ 3ï¼šæ ‡å‡†çš„ JSX</strong></p><p>é‚£ä¸ºä»€ä¹ˆä¸ç”¨æ ‡å‡†çš„ <code>JSX</code> å‘¢ï¼Ÿä½¿ç”¨ç»Ÿä¸€çš„ JSX è¯­æ³•ï¼Œè½¬æ¢ä¸ºä¸åŒç‰ˆæœ¬çš„æ¸²æŸ“å‡½æ•°ã€‚</p><p><img src="/images/component-for-vue2-3/Untitled%201.png" alt="Untitled"></p><p>ä½¿ç”¨æ ‡å‡†çš„ JSX è¯­æ³•ï¼Œæ„å‘³ç€ï¼š</p><ul><li><p>ä¸éœ€è¦ä»»ä½• <code>Babel</code> æ’ä»¶ï¼Œèƒ½å¤Ÿè¢«å¸‚é¢ä¸Šä¸»æµçš„ç¼–è¯‘å™¨(å¦‚ tscï¼Œ swcï¼Œesbuild)ç›´æ¥å¤„ç†ã€‚<br>ä¾‹å¦‚ Typescript</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">/** tsconfig.json */</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"compilerOptions"</span>: &#123;</span><br><span class="line">    <span class="attr">"jsx"</span>: <span class="string">"react-jsx"</span>,</span><br><span class="line">    <span class="attr">"jsxImportSource"</span>: <span class="string">"JSX è¿è¡Œæ—¶åç§°"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>åœ¨<strong>è¿è¡Œæ—¶</strong>è½¬æ¢åˆ°å¯¹åº”ç‰ˆæœ¬çš„æ¸²æŸ“å‡½æ•°ã€‚</p></li><li>Typescript friendlyã€‚çº¯ TSXï¼Œä¸éœ€è¦é¢å¤–æ’ä»¶(æ¯”å¦‚ <code>Volar</code>)è¾…åŠ©ã€‚</li><li><p>ä½¿ç”¨ä¹ æƒ¯ä¸Šæ¥è¿‘ <code>React</code>ã€‚</p><figure class="highlight diff"><table><tr><td class="code"><pre><span class="line">/** ğŸ”´ 1. äº‹ä»¶è®¢é˜…  **/</span><br><span class="line">// ğŸ¤®</span><br><span class="line"><span class="deletion">- &lt;input vOn:click=&#123;this.newTodoText&#125; /&gt;</span></span><br><span class="line"><span class="deletion">- &lt;input vOn:click_stop_prevent=&#123;this.newTodoText&#125; /&gt;</span></span><br><span class="line">// ğŸ‘ ä½¿ç”¨ on* æ³¨å†Œæ—¶é—´</span><br><span class="line"><span class="addition">+ &lt;input onClick=&#123;this.newTodoText&#125; /&gt;</span></span><br><span class="line"></span><br><span class="line">/** ğŸ”´ 2. æ²¡æœ‰æŒ‡ä»¤  **/</span><br><span class="line">// ğŸ¤®</span><br><span class="line"><span class="deletion">- &lt;input v-show=&#123;this.visible&#125; /&gt;</span></span><br><span class="line"><span class="deletion">- &lt;input vModel=&#123;this.newTodoText&#125; /&gt;</span></span><br><span class="line"><span class="deletion">- &lt;input vModel_trim=&#123;this.newTodoText&#125; /&gt;</span></span><br><span class="line"><span class="deletion">- &lt;A v-model=&#123;[val, "argument", ["modifier"]]&#125; /&gt;</span></span><br><span class="line"><span class="deletion">- &lt;a v-loading=&#123;val&#125; /&gt;;</span></span><br><span class="line"></span><br><span class="line">// ğŸ‘ æ²¡æœ‰è¯­æ³•ç³–</span><br><span class="line"><span class="addition">+ &lt;input modelValue=&#123;val&#125; onUpdate:modelValue=&#123;handleValChange&#125; /&gt;</span></span><br><span class="line"><span class="addition">+ &lt;input style=&#123;&#123;display: this.visible ? 'block' : 'none' &#125;&#125; /&gt;</span></span><br><span class="line"><span class="addition">+ &lt;a &#123;...withDirectives([[vLoading, val]])&#125;&gt;</span></span><br><span class="line"></span><br><span class="line">/** ğŸ”´ 3. slots  **/</span><br><span class="line">// ğŸ¤®</span><br><span class="line"><span class="deletion">- &lt;MyComponent&gt;</span></span><br><span class="line"><span class="deletion">-   &lt;header slot="header"&gt;header&lt;/header&gt;</span></span><br><span class="line"><span class="deletion">-   &lt;footer slot="footer"&gt;footer&lt;/footer&gt;</span></span><br><span class="line"><span class="deletion">- &lt;/MyComponent&gt;</span></span><br><span class="line"><span class="deletion">-</span></span><br><span class="line"><span class="deletion">- const scopedSlots = &#123;</span></span><br><span class="line"><span class="deletion">-   header: () =&gt; &lt;header&gt;header&lt;/header&gt;,</span></span><br><span class="line"><span class="deletion">-   footer: () =&gt; &lt;footer&gt;footer&lt;/footer&gt;</span></span><br><span class="line"><span class="deletion">- &#125;</span></span><br><span class="line"><span class="deletion">-</span></span><br><span class="line"><span class="deletion">- &lt;MyComponent scopedSlots=&#123;scopedSlots&#125; /&gt;</span></span><br><span class="line"></span><br><span class="line">// ğŸ‘ å¯¹é½ vue 3</span><br><span class="line"><span class="addition">+ const App = &#123;</span></span><br><span class="line"><span class="addition">+   setup() &#123;</span></span><br><span class="line"><span class="addition">+     const slots = &#123;</span></span><br><span class="line"><span class="addition">+       bar: () =&gt; &lt;span&gt;B&lt;/span&gt;,</span></span><br><span class="line"><span class="addition">+     &#125;;</span></span><br><span class="line"><span class="addition">+     return () =&gt; (</span></span><br><span class="line"><span class="addition">+       &lt;A v-slots=&#123;slots&#125;&gt;</span></span><br><span class="line"><span class="addition">+         &lt;div&gt;A&lt;/div&gt;</span></span><br><span class="line"><span class="addition">+       &lt;/A&gt;</span></span><br><span class="line"><span class="addition">+     );</span></span><br><span class="line"><span class="addition">+   &#125;,</span></span><br><span class="line"><span class="addition">+ &#125;;</span></span><br></pre></td></tr></table></figure></li></ul><p><br><br><br></p><ul><li><p>ä¼˜ç‚¹</p><ul><li>æ„å»ºå¾ˆç®€å•ï¼Œä½¿ç”¨æ ‡å‡†çš„ JSX åªéœ€æ„å»ºä¸€æ¬¡ã€‚ä¸éœ€è¦å¼•å…¥ç‰¹å®šçš„ç¼–è¯‘å™¨ï¼Œä½¿ç”¨ <code>Typescript CLI</code>ï¼Œ<code>esbuild</code> å°±å¯ä»¥ç›´æ¥ç¼–è¯‘ã€‚</li><li>Typescript Friendly, å¦å¤–ç›¸æ¯” <code>vue-tsc</code> ç¼–è¯‘ç»“æœä¼šå¥½ä¸€ç‚¹ã€‚</li><li>çµæ´»æ€§ã€‚æ¯‹åº¸ç½®ç–‘ï¼Œ<code>JSX</code> çš„çµæ´»æ€§ï¼Œå¯æ“è¡Œæ€§å¤ªå¼ºäº†ã€‚</li><li>ç›¸å¯¹æ¨¡æ¿ç¼–è¯‘æ¥è¯´ï¼Œå¯æ§ä¸€ç‚¹(Hackable)ã€‚</li><li>å¯ä»¥æ›¿æ¢å®˜æ–¹çš„ JSX åº“ï¼Œé™¤äº†æœ¬æ–‡ä»‹ç»çš„<code>è·¨ç‰ˆæœ¬ç»„ä»¶åº“</code>åœºæ™¯ï¼Œåœ¨æ—¥å¸¸ Vue 2/3 åº”ç”¨å¼€å‘ä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨å•Šã€‚</li></ul></li><li><p>ç¼ºç‚¹</p><ul><li>ä½¿ç”¨ <code>JSX</code> åˆ™æ„å‘³ç€æ”¾å¼ƒ<a href="https://cn.vuejs.org/guide/extras/rendering-mechanism.html#compiler-informed-virtual-dom" target="_blank" rel="noopener">æ¨¡æ¿ç¼–è¯‘ä¼˜åŒ–</a>çš„æœºä¼šï¼Œæ¯”å¦‚åŠ¨æ€èŠ‚ç‚¹æ ‡æ³¨ï¼Œé¢„å­—ç¬¦ä¸²åŒ–ï¼Œç¼“å­˜ï¼Œé™æ€æå‡ç­‰ç­‰ã€‚</li><li>ä¸ºäº†æŠ¹å¹³ç‰ˆæœ¬ä¹‹é—´çš„å·®å¼‚ï¼Œå¤šäº†ä¸€å±‚æŠ½è±¡è½¬æ¢(ä¸»è¦æ˜¯ Vue 2 ä¸Š)ï¼Œä¼šæœ‰ä¸€äº›æ€§èƒ½æŸè€—ã€‚</li><li>å®ç°ä¸Šéœ€è¦ç†ŸçŸ¥ä¸¤ä¸ªç‰ˆæœ¬ä¹‹é—´çš„å·®å¼‚æ€§ã€‚æ¯”è¾ƒ hack</li><li>å¯è¯»æ€§è¾ƒå·®ï¼Œç›¸æ¯” <code>React</code> ç®€æ´çš„ Apiï¼ŒVue ä¸Šçš„ä¸€äº›ç‰¹æ®Šçš„æ¡†æ¶ç‰¹æ€§ï¼Œè¿˜æ˜¯ä¼šè®©ä»£ç æœ‰äº›ä¸å¤ªä¼˜é›…ï¼Œæ¯”å¦‚æŒ‡ä»¤ã€Slot</li></ul></li></ul><p>åé¢æˆ‘ä»¬é€‰æ‹©äº† <code>JSX</code> æ–¹æ¡ˆï¼Œå› ä¸ºå®ç°èµ·æ¥æ›´ç®€å•ï¼Œæ–¹æ¡ˆæ›´åŠ å¯æ§ï¼Œå°¤å…¶æ˜¯åº”å¯¹åç»­çš„ç‰ˆæœ¬æ›´æ–°ã€‚</p><p><br><br><br><br><br></p><h2 id="ç­–ç•¥"><a href="#ç­–ç•¥" class="headerlink" title="ç­–ç•¥"></a>ç­–ç•¥</h2><p>æ„å»ºè·¨ç‰ˆæœ¬çš„ç»„ä»¶åº“ï¼Œéœ€è¦è€ƒè™‘çš„ä¸ä»…ä»…æ˜¯ç»„ä»¶è¯­æ³•é—®é¢˜ã€‚Vue 2/3 ä»åº•å±‚çš„ API åˆ°æ¸²æŸ“å‡½æ•°ã€å†åˆ°åº”ç”¨å±‚çš„ç»„ä»¶åº“ã€è·¯ç”±ã€å¤šè¯­è¨€ç­‰ç­‰ï¼Œéƒ½å‡ºç°äº†å‰²è£‚ã€‚æˆ‘ä»¬å¾—å…¼é¡¾è¿™äº›å˜åŒ–ã€‚</p><p><br></p><ol><li><strong>åˆ†å±‚ç­–ç•¥</strong></li></ol><p><img src="/images/component-for-vue2-3/Untitled%202.png" alt="Untitled"></p><p>æˆ‘ä»¬æŒ‰ç…§å¼•ç”¨å…³ç³»è¿›è¡Œåˆ†å±‚ï¼š</p><ul><li><strong><code>API å±‚</code></strong>ã€‚å¥½åœ¨ Vue 3 å¤§éƒ¨åˆ†ç‰¹æ€§(ä¸»è¦æ˜¯ <code>Composition API</code> å’Œ <code>defineComponent</code>) å·²ç»ä¸‹æ”¾åˆ°äº† Vue 2ï¼Œæˆ‘ä»¬åªéœ€è¦ä½¿ç”¨ <a href="https://github.com/vueuse/vue-demi" target="_blank" rel="noopener">vue-demi</a> å°±å¯ä»¥æ— ç¼ä½¿ç”¨è¿™äº›æ ¸å¿ƒçš„ APIã€‚<br>ç›¸å¯¹åº”çš„ï¼Œä¸Šå±‚çš„ç»„ä»¶åº“ã€é€‚é…å™¨ä»£ç ç¦æ­¢ç›´æ¥å¯¼å…¥ â€˜vueâ€™</li><li><strong><code>è§†å›¾è¯­æ³•å±‚</code></strong>ã€‚å°±å¦‚ä¸Šæ–‡è¯´çš„ï¼Œæˆ‘ä»¬ä¼šå°è£…ä¸€ä¸ª jsx-runtime, æŠ¹å¹³ Vue 2/3 åœ¨æ¸²æŸ“å‡½æ•°ä¸Šçš„å·®å¼‚ã€‚</li><li><strong><code>é€‚é…å™¨å±‚</code></strong>ã€‚åº”ç”¨å±‚çš„å„ç§ç±»åº“çš„é€‚é…ã€‚æ¯”å¦‚æˆ‘ä»¬å…¬å¸ä¸»è¦ä½¿ç”¨ element-ui, æ–°æ—§ç‰ˆæœ¬çš„å·®å¼‚ä¼šåœ¨ element-adapter ä¸­å¤„ç†ï¼Œå¹¶æš´éœ²ç»Ÿä¸€æ¥å£ã€‚</li><li><strong><code>ç»„ä»¶åº“å±‚</code></strong>ã€‚æœ€åæˆ‘ä»¬çš„ç»„ä»¶åº“åŸºäºä¸‹å±‚æä¾›çš„æŠ½è±¡èƒ½åŠ›ï¼Œå®ç°è·¨ç‰ˆæœ¬ã€‚</li><li><strong><code>åº”ç”¨</code></strong>ã€‚ä¸Šå±‚çš„ Vue 2 / 3 åº”ç”¨ã€‚ä¸‹å±‚çš„é€‚é…å™¨ï¼Œä¼šæ ¹æ®åº”ç”¨ä½¿ç”¨çš„ Vue ç‰ˆæœ¬ï¼ŒåŠ¨æ€åˆ‡æ¢é€‚é…ã€‚</li></ul><p><br><br><br></p><p><strong>2) æ–°ç‰ˆæœ¬ä¼˜å…ˆç­–ç•¥</strong></p><p>åœ¨å°è£…é€‚é…å™¨ æˆ–è€… jsx-runtime æ—¶ï¼Œå½“æ–°æ—§ç‰ˆæœ¬å‡ºç°å·®å¼‚æ—¶ï¼Œæˆ‘ä»¬å¦‚ä½•æŠ‰æ‹©ï¼Ÿ</p><p>è¿™é‡Œé‡‡ç”¨çš„æ˜¯â€œæ–°ç‰ˆæœ¬ä¼˜å…ˆâ€çš„ç­–ç•¥ï¼Œä¸¾ä¸€äº›ä¾‹å­ï¼š</p><ul><li>JSX çš„è¯­æ³•å¯¹é½ Vue 3 çš„æ¸²æŸ“å‡½æ•°ã€‚</li><li>åªä½¿ç”¨ Composition API</li><li>åªä½¿ç”¨ defineComponent</li></ul><p>æ¢å¥è¯è¯´ï¼Œå¦‚æœæƒ…å†µå…è®¸ï¼Œæˆ‘ä»¬å§‹ç»ˆä»¥ Vue 3 ä¸ºåŸºå‡†ã€‚</p><p><br><br><br></p><p><strong>3) çŸ­æ¿ä¼˜å…ˆç­–ç•¥</strong></p><p>çŸ­æ¿å¯¹é½æ˜¯å®ç°å…¼å®¹çš„åŸºç¡€ç­–ç•¥ï¼Œä¸»è¦åˆ†ä¸¤ä¸ªæ–¹é¢ï¼š</p><ul><li>å‰Šå¤´: å¹¶ä¸æ˜¯æ‰€æœ‰ Vue 3 çš„ç‰¹æ€§éƒ½èƒ½ä¸‹æ”¾åˆ° Vue 2, æ¯”å¦‚ <code>Fragment</code>ã€<code>Teleport</code>ã€<code>Suspense</code>/<code>await setup</code>ã€‚æˆ‘ä»¬åªèƒ½æ”¾å¼ƒè¿™äº›åŠŸèƒ½ã€‚</li><li>è¡¥å°¾ï¼šé’ˆå¯¹ä¸€äº› Vue 2 çš„çŸ­æ¿ï¼Œéœ€è¦ä¸€äº›é¢å¤–çš„å·¥ä½œï¼Œæ¯”å¦‚ <a href="https://cn.vuejs.org/v2/guide/reactivity.html" target="_blank" rel="noopener">Vue 2 å“åº”å¼ç³»ç»Ÿçš„å±€é™æ€§</a>ã€‚</li></ul><p><br><br><br></p><p><strong>4) å›é€€ç­–ç•¥</strong></p><p>å¯¹äºä¸€äº›æ— æ³•æŠ¹å¹³çš„å·®å¼‚ï¼Œå¯ä»¥æŒ‰ç…§ä¸åŒçš„ç‰ˆæœ¬ç‰¹æ®Šå¤„ç†ã€‚å¯ä»¥ä½¿ç”¨ vue-demi çš„ <code>isVue2</code> æ¥åˆ†æ¡ä»¶å¤„ç†ã€‚</p><p><br><br><br><br><br></p><h2 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h2><h3 id="api-å…¼å®¹ï¼švue-demi"><a href="#api-å…¼å®¹ï¼švue-demi" class="headerlink" title="API å…¼å®¹ï¼švue demi"></a>API å…¼å®¹ï¼švue demi</h3><p><a href="https://github.com/vueuse/vue-demi" target="_blank" rel="noopener">vue-demi</a> ä¸ºå®ç°è·¨ Vue ç‰ˆæœ¬çš„åº“æä¾›åŸºç¡€çš„æ”¯æŒã€‚å®ƒçš„ä¸»è¦ç­–ç•¥ï¼š</p><ul><li><code>&lt;=2.6</code>: å¯¼å‡º  <code>vue</code> + <code>@vue/composition-api</code>.</li><li><code>2.7</code>: å¯¼å‡º  <code>vue</code> ( Vue 2.7 å†…ç½®æ”¯æŒ Composition API).</li><li><code>&gt;=3.0</code>: å¯¼å‡º  <code>vue</code>, æ¨¡æ‹Ÿäº† Vue 2 çš„<code>set</code> ã€ <code>del</code> API.</li></ul><p>vue-demi çš„å®ç°å¾ˆç®€å•ï¼Œå°±æ˜¯åœ¨ npm çš„ <code>postinstall</code> é’©å­ä¸­ï¼Œåˆ¤æ–­å½“å‰ç¯å¢ƒå®‰è£…çš„ vue åº“ç‰ˆæœ¬ï¼Œå†³å®šå¯¼å…¥çš„åº“ã€‚</p><p>åœ¨æˆ‘ä»¬çš„åœºæ™¯ä¸­ï¼Œé™¤äº† Composition API å’Œä¸€äº›åŸºç¡€ç±»å‹ä¿¡æ¯è¿˜ä¸å¤Ÿï¼Œæˆ‘ä»¬ Fork äº† vue-demi æ¥æ‰©å……äº†ä¸€äº›å¡«å……ç‰©ï¼Œè¿›ä¸€æ­¥æŠ¹å¹³ä¸€äº›å·®å¼‚ã€‚</p><p><br><br><br><br><br></p><h3 id="æ¸²æŸ“è¯­æ³•ï¼šjsx-runtime-çš„å®ç°"><a href="#æ¸²æŸ“è¯­æ³•ï¼šjsx-runtime-çš„å®ç°" class="headerlink" title="æ¸²æŸ“è¯­æ³•ï¼šJSX runtime çš„å®ç°"></a>æ¸²æŸ“è¯­æ³•ï¼šJSX runtime çš„å®ç°</h3><p>JSX runtime çš„å®ç°å¹¶ä¸æ¶‰åŠå¤ªå¤æ‚çš„æŠ€æœ¯ï¼Œä¸»è¦è¿˜æ˜¯å¤„ç†æ¸²æŸ“å‡½æ•°çš„ç¹ç API å·®å¼‚ã€‚</p><p>æ–‡ç« ç¯‡å¹…æœ‰é™ï¼Œè¿™é‡Œæˆ‘å°±ä¸å±•å¼€è®²ç»†èŠ‚äº†ã€‚<strong>âš ï¸ å®Œæ•´çš„å·®å¼‚å¯¹æ¯”å’Œåº”å¯¹æ–¹å¼å¯ä»¥çœ‹è¿™é‡Œ</strong>ï¼š</p><p><br></p><p><a href="https://www.notion.so/Vue-2-3-302cbe0e37794345bbfbd89e32d617db?pvs=21" target="_blank" rel="noopener">ğŸ‰Vue 2 / 3 æ¸²æŸ“å‡½æ•°çš„å·®å¼‚ ğŸ‰</a></p><p><br></p><p>ç®€å•æ¥è¯´ï¼Œæˆ‘ä»¬çš„ JSX è¯­æ³•ä»¥ Vue 3 ä¸ºåŸºå‡†ï¼Œä¸»è¦æ¶‰åŠäº‹ä»¶è®¢é˜…ã€slotsã€æŒ‡ä»¤çš„è½¬æ¢ã€‚</p><p><br></p><p><img src="/images/component-for-vue2-3/Untitled%203.png" alt="Untitled"></p><p>å…·ä½“å®ç°å¯ä»¥çœ‹<a href="https://github.com/wakeadmin/tools/tree/main/packages/h" target="_blank" rel="noopener">è¿™é‡Œ</a></p><p><br><br><br><br><br></p><h3 id="ç»„ä»¶å®šä¹‰ä¸-typescript-æ”¯æŒ"><a href="#ç»„ä»¶å®šä¹‰ä¸-typescript-æ”¯æŒ" class="headerlink" title="ç»„ä»¶å®šä¹‰ä¸ Typescript æ”¯æŒ"></a>ç»„ä»¶å®šä¹‰ä¸ Typescript æ”¯æŒ</h3><p>Typescript + Volar å°±æ˜¯ä¸€é—¨ç„å­¦ï¼Œç±»å‹â€˜ä½“æ“â€™å‡ ä¹å æ®äº†å¼€å‘çš„ä¸‰åˆ†ä¹‹ä¸€æ—¶é—´ã€‚ä¸»è¦é—®é¢˜ï¼š</p><ul><li>Vue 2/3 ç±»å‹å®šä¹‰å’Œå¯¼å‡ºæœ‰ç»†å¾®çš„å·®åˆ«ã€‚æˆ‘ä»¬çš„ jsx-runtime è¦æ±‚ä¸€è‡´çš„ç±»å‹ã€‚</li><li>JSX çš„ slots ä¸æ”¯æŒç±»å‹æ£€æŸ¥ã€‚æ¸²æŸ“å‡½æ•°æ¯•ç«Ÿä¸æ˜¯ Vue çš„ç¬¬ä¸€å…¬æ°‘ï¼Œslots åœ¨ JSX ä¸‹æ— æ³•ç±»å‹æ£€æŸ¥ã€‚</li><li>ä¸ºäº†å…¼å®¹ options API, <code>defineComponent</code> ç±»å‹å®šä¹‰å’Œæ¨å¯¼æ¯”è¾ƒ<a href="https://github.com/vuejs/core/blob/a95e612b252ae59eaf56e0b8ddba66948d4ac20e/packages/runtime-core/src/apiDefineComponent.ts#L44" target="_blank" rel="noopener">å¤æ‚</a>ã€‚</li><li>æ³›å‹ç»„ä»¶å®ç°æ¯”è¾ƒå¤æ‚ï¼ŒVolar æ³›å‹çš„æ”¯æŒä¹Ÿæ¯”è¾ƒç„å­¦ã€‚</li></ul><p><br><br><br></p><p>ä¸ºäº†èƒ½å¤Ÿæ›´å¥½åœ°å®šä¹‰è·¨ç‰ˆæœ¬çš„ç»„ä»¶ï¼Œæä¾›æ›´å¥½çš„ç±»å‹æ”¯æŒï¼Œæˆ‘ä»¬æ‰“ç®—ç®€åŒ– <code>defineComponent</code>ã€‚ä¸ºäº†é¿å…å‘½åå†²çªï¼Œå°šä¸”å‘½åä¸º <code>declareComponent</code> å§, è¿™ä¸ªå‡½æ•°æœ‰ä»¥ä¸‹èŒè´£ï¼š</p><ul><li>ä¸ºå®ç°è·¨ç‰ˆæœ¬æ”¯æŒæä¾›å¿…è¦çº¦æŸã€‚<code>declareComponent</code> è£å‰ªæ‰äº† <code>Options API</code>, åªä¿ç•™ setupã€propsã€render ç­‰å±æ€§ã€‚å¼ºåˆ¶èµ° <code>Composition API</code>ã€‚</li><li>ä¸º JSX (æ¯”å¦‚ v-slots å±æ€§)æä¾›æ›´å¥½ç±»å‹æ£€æŸ¥æ”¯æŒ</li><li>åŒæ—¶å…¼å®¹ vue template çš„ç±»å‹æ£€æŸ¥ (<code>volar</code>)ã€‚</li><li>åœ¨è¿è¡Œæ—¶æŠ¹å¹³ä¸€äº›è·¨ç‰ˆæœ¬çš„å·®å¼‚ã€‚ç»å¤§éƒ¨åˆ†å·®å¼‚ï¼ŒVue 2.7 åœ¨ <code>defineComponent</code> æ–¹æ³•å†…éƒ¨å·²ç»æŠ¹å¹³äº†ã€‚è¿˜æœ‰ä¸€äº› <code>inheritAttrs</code> å¸¦æ¥çš„<a href="https://www.notion.so/Vue-2-3-302cbe0e37794345bbfbd89e32d617db?pvs=21" target="_blank" rel="noopener">éšå¼å·®å¼‚</a>ï¼Œ<strong>declareComponent ç›´æ¥å…³é—­äº† <code>inheritAttrs</code></strong> ã€‚</li><li>è¡¥å…¨çŸ­æ¿ï¼Œå¹¶ä¸”å‘ä¸‹ä¿æŒå…¼å®¹ã€‚Vue 2 å·²ç»ä¸æ›´æ–°äº†ï¼Œæˆ‘ä»¬æƒ³è¦æ”¯æŒä¸€äº›æ–°çš„ç‰¹æ€§ï¼Œæ¯”å¦‚æ³›å‹ã€‚</li></ul><p><br></p><p>ä½¿ç”¨ç¤ºä¾‹ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const Counter = declareComponent(&#123;</span><br><span class="line">  name: &apos;Counter&apos;,</span><br><span class="line">  // å®šä¹‰ props</span><br><span class="line">  props: declareProps&lt;&#123;</span><br><span class="line">    initialValue: number</span><br><span class="line">  &#125;&gt;(</span><br><span class="line">    // âš ï¸ å’Œ defineComponent ä¸€æ ·ï¼Œæˆ‘ä»¬è¿˜æ˜¯éœ€è¦æ˜¾å¼å®šä¹‰ props, å¦åˆ™ä¼šè¢«å½“åš attrs</span><br><span class="line">    [&apos;initialValue&apos;]</span><br><span class="line">  ),</span><br><span class="line"></span><br><span class="line">  // å®šä¹‰äº‹ä»¶</span><br><span class="line">  emits: declareEmits&lt;&#123; change: (value: number) =&gt; void &#125;&gt;(),</span><br><span class="line"></span><br><span class="line">  // å®šä¹‰æ’æ§½</span><br><span class="line">  // slots: declareSlots&lt;&#123; foo: &#123; a: number &#125; &#125;&gt;(),</span><br><span class="line"></span><br><span class="line">  // setup</span><br><span class="line">  setup(props, &#123; emit &#125;) &#123;</span><br><span class="line">    const count = ref(props.initialValue)</span><br><span class="line">    const handleClick = () =&gt; &#123;</span><br><span class="line">      count.value++</span><br><span class="line"></span><br><span class="line">      emit(&apos;change&apos;, count.value)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return () =&gt; (</span><br><span class="line">      &lt;div title=&quot;count&quot; onClick=&#123;handleClick&#125;&gt;</span><br><span class="line">        count: &#123;count.value&#125;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><br><br><br></p><p>ä¸ºäº†å®ç°è¿™ä¸ªç›®æ ‡ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹ <code>Volar</code> æ˜¯å¦‚ä½•æ¨æ–­ç»„ä»¶çš„ç±»å‹ï¼š</p><p><br></p><p>å¤§è‡´çš„æ¨å¯¼è¿‡ç¨‹å¦‚ä¸‹, å…¶æ¬¡å¯ä»¥å‚è€ƒ <code>vue-tsc</code> çš„ç¼–è¯‘è¾“å‡ºæˆ–è€… Vue <code>defineComponent</code> çš„ç±»å‹å£°æ˜ã€‚</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">// https://github.com/vuejs/language-tools/blob/71240c78f1a205605f4c079a299b2701250ef9be/packages/vue-component-type-helpers/index.d.ts#L5</span><br><span class="line">export type ComponentProps&lt;T&gt; = T extends new () =&gt; &#123; $props: infer P &#125;</span><br><span class="line">  ? NonNullable&lt;P&gt;</span><br><span class="line">  : T extends (props: infer P, ...args: any) =&gt; any</span><br><span class="line">  ? P</span><br><span class="line">  : &#123;&#125;</span><br><span class="line"></span><br><span class="line">export type ComponentSlots&lt;T&gt; = T extends new () =&gt; &#123; $slots: infer S &#125;</span><br><span class="line">  ? NonNullable&lt;S&gt;</span><br><span class="line">  : T extends (props: any, ctx: &#123; slots: infer S &#125;, ...args: any) =&gt; any</span><br><span class="line">  ? NonNullable&lt;S&gt;</span><br><span class="line">  : &#123;&#125;</span><br><span class="line"></span><br><span class="line">export type ComponentEmit&lt;T&gt; = T extends new () =&gt; &#123; $emit: infer E &#125;</span><br><span class="line">  ? NonNullable&lt;E&gt;</span><br><span class="line">  : T extends (props: any, ctx: &#123; emit: infer E &#125;, ...args: any) =&gt; any</span><br><span class="line">  ? NonNullable&lt;E&gt;</span><br><span class="line">  : &#123;&#125;</span><br><span class="line"></span><br><span class="line">export type ComponentExposed&lt;T&gt; = T extends new () =&gt; infer E</span><br><span class="line">  ? E</span><br><span class="line">  : T extends (props: any, ctx: &#123; expose(exposed: infer E): any &#125;, ...args: any) =&gt; any</span><br><span class="line">  ? NonNullable&lt;E&gt;</span><br><span class="line">  : &#123;&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Vue 2.x</span><br><span class="line"> */</span><br><span class="line">export type Vue2ComponentSlots&lt;T&gt; = T extends new () =&gt; &#123; $scopedSlots: infer S &#125;</span><br><span class="line">  ? NonNullable&lt;S&gt;</span><br><span class="line">  : T extends (props: any, ctx: &#123; slots: infer S &#125;, ...args: any) =&gt; any</span><br><span class="line">  ? NonNullable&lt;S&gt;</span><br><span class="line">  : &#123;&#125;</span><br></pre></td></tr></table></figure><p><br></p><p>ç®€å•æ¥è¯´ <code>defineComponent</code> æ–¹æ³•æœ€ç»ˆè¾“å‡ºçš„ç»„ä»¶çš„ç±»å‹å¤–è§‚é•¿è¿™æ ·ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">type YourComponent = new (...args: any[]): &#123;</span><br><span class="line">  $props: Props ç±»å‹</span><br><span class="line">  $emit: äº‹ä»¶ç±»å‹</span><br><span class="line">  $slots: æ’æ§½ç±»å‹</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ğŸ’¡ é‚£ Typescript çš„ JSX æ€ä¹ˆå¯¹ç»„ä»¶è¿›è¡Œç±»å‹æ£€æŸ¥å‘¢ï¼Ÿè¿™ä¸ªå¯ä»¥å‚è€ƒ Typescript çš„ <a href="https://www.typescriptlang.org/docs/handbook/jsx.html" target="_blank" rel="noopener">JSX æ–‡æ¡£</a>ï¼Œè¿˜æœ‰ Vue çš„ JSX <a href="https://github.com/vuejs/core/blob/a95e612b252ae59eaf56e0b8ddba66948d4ac20e/packages/vue/jsx.d.ts#L3" target="_blank" rel="noopener">ç±»å‹å®šä¹‰</a>ã€‚ç®€å•è¯´ä¹Ÿæ˜¯ä»ä¸Šè¿°çš„ <code>$props</code> ä¸­æ¨å¯¼çš„ã€‚</p></blockquote><p><br><br><br></p><p>æˆ‘ä»¬çš„ <code>declareComponent</code> åªè¦ä¿æŒå’Œä¸Šé¢çš„ç±»å‹å…¼å®¹ï¼Œå°±å¯ä»¥è®© <code>volar</code> åœ¨ vue template ä¸‹è¿›è¡Œç±»å‹æ£€æŸ¥äº†ã€‚</p><p><br></p><p>å› ä¸ºåˆ¨é™¤æ‰äº†ä¸å¿…è¦çš„ Options API, ç›¸æ¯” defineComponent, ç±»å‹å®šä¹‰å¯ä»¥ç®€åŒ–å¾ˆå¤š:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">export function declareComponent&lt;</span><br><span class="line">  Props extends &#123;&#125; = &#123;&#125;,</span><br><span class="line">  Emit extends &#123;&#125; = &#123;&#125;,</span><br><span class="line">  Expose extends &#123;&#125; = &#123;&#125;,</span><br><span class="line">  Slots extends &#123;&#125; = &#123;&#125;</span><br><span class="line">&gt;(</span><br><span class="line">  options: SimpleComponentOptions&lt;Props, Emit, Expose, Slots&gt;</span><br><span class="line">): DefineComponent&lt;Props, Emit, Expose, Slots&gt; &#123;</span><br><span class="line">  /// .. å®ç°å¿½ç•¥ï¼Œç®€å•å°è£… defineComponent</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// ğŸ”´ ç®€åŒ– defineComponent API, åªä¿ç•™ Composition API</span><br><span class="line">export type SimpleComponentOptions&lt;</span><br><span class="line">  Props extends &#123;&#125;,</span><br><span class="line">  Emit extends &#123;&#125;,</span><br><span class="line">  Expose extends &#123;&#125;,</span><br><span class="line">  Slots extends &#123;&#125;</span><br><span class="line">&gt; = &#123;</span><br><span class="line">  name?: string</span><br><span class="line">  props?: Props</span><br><span class="line">  emits?: Emit</span><br><span class="line">  slots?: Slots</span><br><span class="line">  expose?: Expose</span><br><span class="line">  setup: (</span><br><span class="line">    props: Props,</span><br><span class="line">    ctx: SetupContext&lt;Emit, DefaultSlots &amp; Slots, Expose, Data&gt;</span><br><span class="line">  ) =&gt; Promise&lt;RenderFunction | void&gt; | RenderFunction | void</span><br><span class="line">  inheritAttrs?: boolean</span><br><span class="line">  serverPrefetch?(): Promise&lt;any&gt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export interface ComponentInstance&lt;</span><br><span class="line">  Props extends &#123;&#125;,</span><br><span class="line">  Emit extends &#123;&#125;,</span><br><span class="line">  Expose extends &#123;&#125;,</span><br><span class="line">  Slots extends &#123;&#125;</span><br><span class="line">&gt; &#123;</span><br><span class="line">  // props å®šä¹‰</span><br><span class="line">  $props: Props &amp;</span><br><span class="line">    // ğŸ”´ å°† emit è½¬æ¢ä¸º on* å½¢å¼ï¼Œæ–¹ä¾¿ JSX åœºæ™¯ä½¿ç”¨</span><br><span class="line">    EmitsToProps&lt;Emit&gt; &amp; &#123; &apos;v-slots&apos;?: Partial&lt;VSlotType&lt;Slots&gt;&gt; &#125; &amp; &#123;</span><br><span class="line">      // ğŸ”´ æ‰©å±•äº† v-slots çš„å®šä¹‰ï¼Œæ–¹ä¾¿ JSX åœºæ™¯ä½¿ç”¨</span><br><span class="line">      &apos;v-children&apos;?: VChildrenType&lt;Slots&gt;</span><br><span class="line">    &#125; &amp; &#123;</span><br><span class="line">      ref?: RefType&lt;Expose | Expose[]&gt;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  // ğŸ”´ æ”¯æŒ volar æ¨æ–­ slots</span><br><span class="line">  $slots: VSlotType&lt;Slots&gt;</span><br><span class="line">  // ğŸ”´ æ”¯æŒ volar æ¨æ–­ äº‹ä»¶</span><br><span class="line">  $emit: EmitFn&lt;Emit&gt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// å¯ä»¥å¯¹æ¯” Vue çš„ DefineComponent çœ‹çœ‹</span><br><span class="line">export interface DefineComponent&lt;</span><br><span class="line">  Props extends &#123;&#125;,</span><br><span class="line">  Emit extends &#123;&#125;,</span><br><span class="line">  Expose extends &#123;&#125;,</span><br><span class="line">  Slots extends &#123;&#125;</span><br><span class="line">&gt; &#123;</span><br><span class="line">  new (...args: any[]): ComponentInstance&lt;Props, Emit, Expose, Slots&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>é‚£æ€ä¹ˆæ”¯æŒæ³›å‹ç»„ä»¶å—ï¼Ÿ</strong></p><p><br><br><br><br><br></p><h3 id="æ³›å‹ç»„ä»¶"><a href="#æ³›å‹ç»„ä»¶" class="headerlink" title="æ³›å‹ç»„ä»¶"></a><strong>æ³›å‹ç»„ä»¶</strong></h3><blockquote><p>Volar éœ€è¦å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬ã€‚</p></blockquote><blockquote><p>Volar çš„æ³›å‹æ”¯æŒæ¯”è¾ƒç„å­¦ï¼Œæˆ‘å»ºè®®ä¸è¦éšæ„å°è¯•ï¼</p></blockquote><p>Vue 3.3 å®˜æ–¹æ­£å¼æ”¯æŒäº†<a href="https://blog.vuejs.org/posts/vue-3-3" target="_blank" rel="noopener">æ³›å‹ SFC</a> å’Œ defineComponent, ç¬”è€…å®æµ‹ Volar è¿™å—æ”¯æŒè¿˜æœ‰å¾…æ”¹è¿›ã€‚ä½†æ˜¯ä¸å¦¨ç¢æˆ‘ä»¬è¿›è¡Œåˆæ­¥çš„å°è¯•ã€‚</p><p>ä¸Šæ–‡çš„ <code>declareComponent</code> å†™æ³•æ˜¯ä¸æ”¯æŒæ³›å‹ç»„ä»¶çš„ã€‚æœ‰ä¸¤ç§æ–¹å¼å¯ä»¥å®ç°æ³›å‹ç»„ä»¶çš„å£°æ˜ï¼Œå…ˆæ¥çœ‹ä¸€ä¸ªæ¯”è¾ƒç®€å•çš„ï¼š</p><ol><li><p><strong>ç±»å‹æ–­è¨€</strong></p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">// ğŸ”´ ä½¿ç”¨æ³›å‹å®šä¹‰ propsã€emit å’Œ expose ç­‰ç±»å‹</span><br><span class="line">interface Props&lt;T&gt; &#123;</span><br><span class="line">  list: T[]</span><br><span class="line">  filter: (item: T) =&gt; boolean</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// ğŸ“¢ è¿™é‡Œè¦ç”¨ type</span><br><span class="line">type Emit&lt;T&gt; = &#123;</span><br><span class="line">  add: (item: T) =&gt; void</span><br><span class="line">  change: (list: T[]) =&gt; void</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">type Expose&lt;T&gt; = &#123;</span><br><span class="line">  open: (item: T) =&gt; void</span><br><span class="line">  list: T[]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">type Slots&lt;T&gt; = &#123;</span><br><span class="line">  foo: (list: T[]) =&gt; any</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const GenericBar = declareComponent(&#123;</span><br><span class="line">  props: declareProps&lt;Props&lt;any&gt;&gt;([]),</span><br><span class="line">  emits: declareEmits&lt;Emit&lt;any&gt;&gt;(),</span><br><span class="line">  expose: declareExpose&lt;Expose&lt;any&gt;&gt;(),</span><br><span class="line">  slots: declareSlots&lt;Slots&lt;any&gt;&gt;(),</span><br><span class="line">  setup(props, ctx) &#123;</span><br><span class="line">    expectType&lt;any[]&gt;(props.list)</span><br><span class="line">    ctx.emit(&apos;change&apos;, [])</span><br><span class="line">    ctx.slots.foo?.([])</span><br><span class="line">    ctx.expose(&#123;</span><br><span class="line">      list: [],</span><br><span class="line">      open() &#123;</span><br><span class="line">        // ignore</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line">    return &#123;&#125; as any</span><br><span class="line">  &#125;,</span><br><span class="line">  // ğŸ”´ é‡æ–°æ–­è¨€ï¼Œæ”¯æŒ æ³›å‹</span><br><span class="line">&#125;) as new &lt;T&gt;(...args: any[]) =&gt; ComponentInstance&lt;Props&lt;T&gt;, Emit&lt;T&gt;, Expose&lt;T&gt;, Slots&lt;T&gt;&gt;</span><br><span class="line"></span><br><span class="line">// æµ‹è¯•</span><br><span class="line">;&lt;GenericBar</span><br><span class="line">  list=&#123;[1, 2]&#125;</span><br><span class="line">  filter=&#123;(i) =&gt; &#123;</span><br><span class="line">    expectType&lt;number&gt;(i)</span><br><span class="line">    return true</span><br><span class="line">  &#125;&#125;</span><br><span class="line">  onAdd=&#123;(i) =&gt; &#123;</span><br><span class="line">    expectType&lt;number&gt;(i)</span><br><span class="line">  &#125;&#125;</span><br><span class="line">  onChange=&#123;(i) =&gt; &#123;</span><br><span class="line">    expectType&lt;number[]&gt;(i)</span><br><span class="line">  &#125;&#125;</span><br><span class="line">  v-slots=&#123;&#123;</span><br><span class="line">    foo(i) &#123;</span><br><span class="line">      expectType&lt;number[]&gt;(i)</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;&#125;</span><br><span class="line">&gt;&lt;/GenericBar&gt;</span><br></pre></td></tr></table></figure><p> <br></p><p>ä¸Šé¢çš„æ–¹å¼åœ¨ JSX è¡¨ç°æ­£å¸¸ï¼Œ<strong>ä½†æ˜¯ç›®å‰ Volar åœ¨ vue template å¹¶ä¸æ”¯æŒã€‚</strong></p><blockquote><p>ğŸ’¡ <strong>è¿™é‡Œä¹Ÿæœ‰ä¸€äº›å†·çŸ¥è¯†ã€‚</strong>å‡è®¾ ç›®æ ‡ç±»å‹çº¦æŸäº† <code>Index Signature</code>, æ¯”å¦‚ <code>{[key: string]: Function }</code>, é‚£ä¹ˆ <code>interface</code> æ˜¯æ— æ³•èµ‹å€¼ç»™å®ƒçš„ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt; interface Indexed &#123;</span><br><span class="line">&gt;   [key: string]: Function</span><br><span class="line">&gt; &#125;</span><br><span class="line">&gt;</span><br><span class="line">&gt; interface Foo &#123;</span><br><span class="line">&gt;   hello: () =&gt; void</span><br><span class="line">&gt; &#125;</span><br><span class="line">&gt;</span><br><span class="line">&gt; declare let a: Indexed</span><br><span class="line">&gt; declare let b: Foo</span><br><span class="line">&gt;</span><br><span class="line">&gt; a = b // ğŸš¨ Index signature for type &apos;string&apos; is missing in type &apos;Foo&apos;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></blockquote><blockquote><p>å¦‚æœä½¿ç”¨ <code>type</code> åˆ›å»ºç±»å‹å°±å¯ä»¥:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&gt; type Bar = &#123;</span><br><span class="line">&gt;   hello: () =&gt; void</span><br><span class="line">&gt; &#125;</span><br><span class="line">&gt;</span><br><span class="line">&gt; declare let c: Bar</span><br><span class="line">&gt; a = c // it&apos;s work</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></blockquote><blockquote><p>ç¬”è€…æ¨æµ‹ï¼Œåº”è¯¥<strong>æ˜¯ interface å…è®¸ <a href="https://www.typescriptlang.org/docs/handbook/declaration-merging.html#merging-interfaces" target="_blank" rel="noopener">åˆå¹¶</a>ï¼Œä¸æ˜¯é™æ€çš„ï¼Œå› æ­¤ä¸èƒ½å®‰å…¨åœ°æ»¡è¶³ Index Signature çš„çº¦æŸ</strong>ã€‚</p><p>äº†è§£æ›´å¤šï¼š</p><p><a href="https://stackoverflow.com/questions/60697214/how-to-fix-index-signature-is-missing-in-type-error" target="_blank" rel="noopener">How to fix â€œIndex signature is missing in typeâ€ error?</a></p></blockquote><p> <br><br> <br></p></li><li><p><strong>å‡½æ•°å½¢å¼</strong></p><p>Vue 3.3 çš„ <code>defineComponent</code> æ–°å¢äº†ä¸€ç§<a href="https://cn.vuejs.org/api/general.html#definecomponent" target="_blank" rel="noopener">å‡½æ•°ç­¾åå½¢å¼</a>ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">const Comp = defineComponent(</span><br><span class="line">  &lt;T extends string | number&gt;(props: &#123; msg: T; list: T[] &#125;) =&gt; &#123;</span><br><span class="line">    // å°±åƒåœ¨ &lt;script setup&gt; ä¸­ä¸€æ ·ä½¿ç”¨ç»„åˆå¼ API</span><br><span class="line">    const count = ref(0)</span><br><span class="line"></span><br><span class="line">    return () =&gt; &#123;</span><br><span class="line">      // æ¸²æŸ“å‡½æ•°æˆ– JSX</span><br><span class="line">      return &lt;div&gt;&#123;count.value&#125;&lt;/div&gt;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  // å»æ‰æ³¨é‡Šï¼Œæ³›å‹ä¼šå¤±æ•ˆ</span><br><span class="line">  // ç›®å‰ä»ç„¶éœ€è¦æ‰‹åŠ¨å£°æ˜è¿è¡Œæ—¶çš„ props</span><br><span class="line">  // &#123;</span><br><span class="line">  //  props: [&apos;msg&apos;, &apos;list&apos;]</span><br><span class="line">  /// &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>å°´å°¬çš„æ˜¯ï¼ŒVue ç»„ä»¶å¿…é¡»æ˜¾å¼å®šä¹‰ props å‚æ•°ï¼Œä¸ç„¶ä¼šè¢«å½“åš attrs å¤„ç†ã€‚æ‰€ä»¥ï¼Œå½“ä½ å°†ä¸Šé¢çš„<strong>props å‚æ•°æ³¨é‡Šå»æ‰æ—¶ï¼Œæ³›å‹å°±ä¼šå¤±æ•ˆäº† ğŸ˜€</strong> ã€‚</p><p>å¦å¤–ä¸€ä»¶å°´å°¬çš„äº‹æƒ…æ˜¯ï¼Œæˆªæ­¢ç›®å‰ä¸ºæ­¢ï¼Œç”¨ä¸Šé¢è¯­æ³•åˆ›å»ºçš„ç»„ä»¶ï¼Œåœ¨ Volar ä¸Šå¹¶ä¸èƒ½å¾—åˆ°å¾ˆå¥½çš„æ”¯æŒ(åªèƒ½æ­£ç¡®æ¨æ–­ props)ã€‚</p><p><br></p><p>ä½†ä½¿ç”¨ <a href="https://cn.vuejs.org/api/sfc-script-setup.html#generics" target="_blank" rel="noopener">SFC æ³›å‹è¯­æ³•</a> åˆ™ä¼šè¡¨ç°å¥½ä¸€ç‚¹ã€‚SFC æœ‰ä»€ä¹ˆç‰¹æ®Šï¼Ÿ</p><p>æˆ‘ä½¿ç”¨ vue-tsc å°†ç»„ä»¶ç¼–è¯‘äº†ä¸€ä¸‹ï¼Œå¤§æ¦‚ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">declare const _default: &lt;T&gt;(</span><br><span class="line">  // ğŸ”´ props ç±»å‹</span><br><span class="line">  __VLS_props: &#123;</span><br><span class="line">    list: T[]</span><br><span class="line">    filter: (item: T) =&gt; boolean</span><br><span class="line">  &#125; &amp; VNodeProps &amp;</span><br><span class="line">    AllowedComponentProps &amp;</span><br><span class="line">    ComponentCustomProps,</span><br><span class="line"></span><br><span class="line">  // ğŸ”´ context ç±»å‹</span><br><span class="line">  __VLS_ctx?:</span><br><span class="line">    | Pick&lt;</span><br><span class="line">        &#123;</span><br><span class="line">          props: &#123;</span><br><span class="line">            list: T[]</span><br><span class="line">            filter: (item: T) =&gt; boolean</span><br><span class="line">          &#125;</span><br><span class="line">          expose(exposed: &#123; data: Ref&lt;T[] | null | undefined&gt; &#125;): void</span><br><span class="line">          attrs: any</span><br><span class="line">          slots: &#123;</span><br><span class="line">            foo: (scope: &#123; list: T[] &#125;) =&gt; any</span><br><span class="line">          &#125;</span><br><span class="line">          emit: &#123;</span><br><span class="line">            change: [T[]]</span><br><span class="line">            foo: [T, number]</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &apos;attrs&apos; | &apos;emit&apos; | &apos;slots&apos;</span><br><span class="line">      &gt;</span><br><span class="line">    | undefined</span><br><span class="line">) =&gt; // ğŸ”´ è¿”å›å€¼</span><br><span class="line">VNode &amp; &#123;</span><br><span class="line">  __ctx?:</span><br><span class="line">    | &#123;</span><br><span class="line">        props: &#123;</span><br><span class="line">          list: T[]</span><br><span class="line">          filter: (item: T) =&gt; boolean</span><br><span class="line">        &#125;</span><br><span class="line">        expose(exposed: &#123; data: Ref&lt;T[] | null | undefined&gt; &#125;): void</span><br><span class="line">        attrs: any</span><br><span class="line">        slots: &#123;</span><br><span class="line">          foo: (scope: &#123; list: T[] &#125;) =&gt; any</span><br><span class="line">        &#125;</span><br><span class="line">        emit: &#123;</span><br><span class="line">          change: [T[]]</span><br><span class="line">          foo: [T, number]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    | undefined</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>SFC çš„ç¼–è¯‘ç»“æœå¤šå‡ºäº† <code>__ctx</code> å­—æ®µï¼Œå®é™…ä¸Š Volar å°±æ˜¯ä» __ctx ä¸­æå–äº†ç›¸å…³ç±»å‹ã€‚</p><aside><br>ğŸ’¡ __ctx åº”è¯¥æ˜¯ volar çš„å†…éƒ¨å®ç°ç»†èŠ‚ï¼Œä¸æ’é™¤åé¢ä¼šå˜åŠ¨<br><br></aside><p>é‚£æˆ‘ä»¬ç°åœ¨å°±æ¨¡ä»¿å®ƒï¼Œé‡æ„ä¸€ä¸‹ <code>declareComponent</code> çš„ç­¾å:</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">export interface DefineComponentContext&lt;</span><br><span class="line">  Emit extends ObjectEmitsOptions = &#123;&#125;,</span><br><span class="line">  Expose extends &#123;&#125; = &#123;&#125;,</span><br><span class="line">  Slots extends &#123; [key: string]: Function &#125; = &#123;&#125;,</span><br><span class="line">  Attrs extends &#123;&#125; = &#123;&#125;</span><br><span class="line">&gt; &#123;</span><br><span class="line">  attrs: Attrs</span><br><span class="line">  slots: Slots</span><br><span class="line">  emit: EmitFn&lt;Emit&gt;</span><br><span class="line">  expose: ExposeFn&lt;Expose&gt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export function declareComponent&lt;</span><br><span class="line">  Props extends &#123;&#125;,</span><br><span class="line">  Emit extends ObjectEmitsOptions = &#123;&#125;,</span><br><span class="line">  Expose extends &#123;&#125; = &#123;&#125;,</span><br><span class="line">  Slots extends &#123; [key: string]: Function &#125; = &#123;&#125;,</span><br><span class="line">  Attrs extends &#123;&#125; = &#123;&#125;</span><br><span class="line">&gt;(</span><br><span class="line">  setup: (</span><br><span class="line">    props: Props,</span><br><span class="line">    ctx: DefineComponentContext&lt;Emit, Expose, Slots, Attrs&gt;</span><br><span class="line">  ) =&gt; Promise&lt;RenderFunction | void&gt; | RenderFunction | void,</span><br><span class="line">  options?: &#123;</span><br><span class="line">    props?: Array&lt;keyof Props&gt; | ComponentObjectPropsOptions&lt;Partial&lt;Props&gt;&gt;</span><br><span class="line">    name?: string</span><br><span class="line">    inheritAttrs?: boolean</span><br><span class="line">    serverPrefetch?(): Promise&lt;any&gt;</span><br><span class="line">  &#125;</span><br><span class="line">): (</span><br><span class="line">  props: PropsType&lt;Props, Emit, Slots, Expose&gt;,</span><br><span class="line">  ctx: DefineComponentContext&lt;Emit, Expose, Slots, Attrs&gt;</span><br><span class="line">) =&gt; VNode &amp; &#123;</span><br><span class="line">  // ğŸ›‘</span><br><span class="line">  __ctx: &#123;</span><br><span class="line">    emit: EmitFn&lt;Emit&gt;</span><br><span class="line">    slots: Slots</span><br><span class="line">    expose: ExposeFn&lt;Expose&gt;</span><br><span class="line">    attrs: Attrs</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ç¤ºä¾‹ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">function Foo&lt;T&gt;(</span><br><span class="line">  props: &#123; list: T[]; filter: (item: T) =&gt; boolean &#125;,</span><br><span class="line">  ctx: DefineComponentContext&lt;</span><br><span class="line">    &#123; change: (list: T[]) =&gt; void; add: (item: T) =&gt; void &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      open: (item: T) =&gt; void</span><br><span class="line">      list: T[]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      foo: (list: T[]) =&gt; any</span><br><span class="line">    &#125;</span><br><span class="line">  &gt;</span><br><span class="line">) &#123;</span><br><span class="line">  return () =&gt; &#123;</span><br><span class="line">    // render</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// âš ï¸ props è¿˜æ˜¯è¦å®šä¹‰</span><br><span class="line">Foo.props = [&apos;list&apos;, &apos;filter&apos;]</span><br><span class="line"></span><br><span class="line">export default declareComponent(Foo)</span><br></pre></td></tr></table></figure><p>ç›®å‰ Volar åœ¨æ³›å‹çš„æ”¯æŒä¸Šè¿˜æœ‰ä¸å°‘çš„å‘ã€‚æ¯”å¦‚ä¸Šé¢çš„ç¤ºä¾‹ä¸­äº‹ä»¶å¤„ç†å™¨çš„æ³›å‹å˜é‡ä¼šæ¨æ–­ä¸º unknownã€‚è®©å­å¼¹å†é£ä¸€ä¼šå§ã€‚</p></li></ol><p><br><br><br><br><br> </p><h3 id="element-adapter"><a href="#element-adapter" class="headerlink" title="element-adapter"></a>element-adapter</h3><p>å®ç°çš„åŸç†å’Œ vue-demi ç±»ä¼¼ï¼Œåœ¨ postinstall æ—¶å†³å®šä½¿ç”¨å“ªä¸ªç‰ˆæœ¬ã€‚é¡¹ç›®çš„ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">scripts/             <span class="comment"># å’Œ vue-demi ä¸€æ ·ï¼Œå®ç°äº† postinstall å’Œåˆ‡æ¢ CLI</span></span><br><span class="line">  postinstall.mjs</span><br><span class="line">  switch-cli.mjs</span><br><span class="line">src/</span><br><span class="line">  shared/</span><br><span class="line">  v2/                <span class="comment"># element-ui å¯¼å‡º</span></span><br><span class="line">    components/</span><br><span class="line">      Table.js</span><br><span class="line">      Slide.js</span><br><span class="line">      ...</span><br><span class="line">  v3/                <span class="comment"># element-plus å¯¼å‡º</span></span><br><span class="line">    components/</span><br><span class="line">      ...</span><br><span class="line">types/               <span class="comment"># é‡æ–°å£°æ˜ç»„ä»¶çš„ç±»å‹ä¿¡æ¯ã€‚</span></span><br><span class="line">  alert.d.ts</span><br><span class="line">  ...</span><br></pre></td></tr></table></figure><p><br> </p><p>å¤§éƒ¨åˆ†ç»„ä»¶ä¸éœ€è¦ç‰¹æ®Šå¤„ç†ï¼Œé‡æ–°å¯¼å‡ºå°±è¡Œï¼š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">export</span> &#123; Button &#125; from <span class="string">'element-ui'</span>;</span><br></pre></td></tr></table></figure><p><br> </p><p>æœ‰ä¸€äº›ç»„ä»¶å‚æ•°åç§°å‘ç”Ÿäº†å˜åŒ–ï¼Œåˆ™ä»¥ element-plus ä¸ºåŸºå‡†åšä¸€ä¸‹è°ƒæ•´ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import &#123; TimePicker as ElTimePicker &#125; from &apos;element-ui&apos;</span><br><span class="line">import &#123; h &#125; from &apos;@wakeadmin/h&apos;</span><br><span class="line"></span><br><span class="line">import &#123; normalizeDateFormat &#125; from &apos;../../shared/date-format&apos;</span><br><span class="line"></span><br><span class="line">export const TimePicker = &#123;</span><br><span class="line">  functional: true,</span><br><span class="line">  render(_, context) &#123;</span><br><span class="line">    const &#123; format, selectableRange, valueFormat, ...other &#125; = context.props</span><br><span class="line"></span><br><span class="line">    // vue3 pickerOptions æå–åˆ°äº†å…¨å±€</span><br><span class="line">    other.pickerOptions = &#123;</span><br><span class="line">      ...other.pickerOptions,</span><br><span class="line">      format: format &amp;&amp; normalizeDateFormat(format),</span><br><span class="line">      selectableRange,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (valueFormat) &#123;</span><br><span class="line">      other.valueFormat = normalizeDateFormat(valueFormat)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return h(</span><br><span class="line">      ElTimePicker,</span><br><span class="line">      Object.assign(&#123;&#125;, context.data, &#123; props: other, attrs: undefined &#125;),</span><br><span class="line">      context.slots()</span><br><span class="line">    )</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br> </p><p>å¦å¤–ï¼Œæˆ‘ä»¬ä¹Ÿä¼šç§»æ¤ä¸€äº› element-plus çš„æ–°ç»„ä»¶ï¼Œæ¯”å¦‚ <code>TreeSelect</code>ã€‚</p><p>å¯¹äº icon è¿™ç±»å·®å¼‚æ¯”è¾ƒå¤§ï¼Œæˆ‘ä»¬ç›´æ¥æ”¾å¼ƒäº†ã€‚å¯ä»¥ä½¿ç”¨å¤–éƒ¨å›¾æ ‡åº“æˆ–è€… SVG ç»„ä»¶åº“ï¼ˆå‚è€ƒè¿™ä¸ª<a href="https://github.com/wakeadmin/tools/tree/main/packages/icons" target="_blank" rel="noopener">å®ç°</a>è·¨ç‰ˆæœ¬çš„ SVG å›¾æ ‡åº“ï¼‰ã€‚</p><p><br><br><br><br><br> </p><h3 id="router-adapter"><a href="#router-adapter" class="headerlink" title="router-adapter"></a>router-adapter</h3><p>æˆ‘ä»¬çš„ç»„ä»¶åº“æ˜¯å¯èƒ½ä¼šæ¶‰åŠåˆ°è·¯ç”±çš„è®¢é˜…å’Œæ“ä½œã€‚å› ä¸º vue-router API å·®å¼‚å¹¶ä¸å¤§ï¼Œå¤„ç†èµ·æ¥ä¼šç®€å•å¾ˆå¤šã€‚</p><p>ä¸ç®¡æ˜¯ vue 2 è¿˜æ˜¯ 3ï¼Œvue-router éƒ½ä¼šåœ¨ç»„ä»¶å®ä¾‹ä¸ŠæŒ‚è½½ç›¸å…³çš„ API, æˆ‘ä»¬ç›´æ¥è·å–å°±è¡Œï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">export interface RouteLike &#123;</span><br><span class="line">  query: Record&lt;string, any&gt;</span><br><span class="line">  params: Record&lt;string, any&gt;</span><br><span class="line">  hash: string</span><br><span class="line">  path: string</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export type RouteLocation =</span><br><span class="line">  | string</span><br><span class="line">  | &#123;</span><br><span class="line">      query?: Record&lt;string, any&gt;</span><br><span class="line">      hash?: string</span><br><span class="line">      path?: string</span><br><span class="line">      name?: string</span><br><span class="line">      params?: Record&lt;string, any&gt;</span><br><span class="line">      replace?: boolean</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">export interface RouterLike &#123;</span><br><span class="line">  push(to: RouteLocation): Promise&lt;any&gt;</span><br><span class="line">  replace(to: RouteLocation): Promise&lt;any&gt;</span><br><span class="line">  back(): void</span><br><span class="line">  forward(): void</span><br><span class="line">  go(delta: number): void</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export function useRouter() &#123;</span><br><span class="line">  const instance = getCurrentInstance()</span><br><span class="line"></span><br><span class="line">  if (isVue2) &#123;</span><br><span class="line">    return (instance?.proxy?.$root as &#123; $router: RouterLike &#125; | undefined)?.$router</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    return (instance?.root?.proxy as unknown as &#123; $router: RouterLike &#125;)?.$router</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// ... useRoute åŒç†</span><br></pre></td></tr></table></figure><p><br> </p><p>å…¶ä»–çš„åº“å¯ä»¥é‡‡å–ç±»ä¼¼çš„ç­–ç•¥ã€‚</p><p><br><br><br><br><br> </p><h3 id="ğŸ‰-å¼€æº-ğŸ‰"><a href="#ğŸ‰-å¼€æº-ğŸ‰" class="headerlink" title="ğŸ‰ å¼€æº ğŸ‰"></a>ğŸ‰ å¼€æº ğŸ‰</h3><p>å€Ÿç€è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬ä¹Ÿå°†ç›¸å…³çš„<a href="https://github.com/wakeadmin" target="_blank" rel="noopener">ç¨‹åºå¼€æºäº†</a>! å¸Œæœ›èƒ½å¸®åŠ©åˆ°å¤§å®¶ï¼</p><ul><li><a href="https://github.com/wakeadmin/tools/tree/main/packages/h" target="_blank" rel="noopener">jsx-runtime å®ç°</a></li><li><a href="https://github.com/wakeadmin/components" target="_blank" rel="noopener">ç»„ä»¶åº“å®ç°</a></li></ul><p>æ¬¢è¿ Fork Star PR</p><p><br><br><br><br><br> </p><h2 id="æ‰©å±•é˜…è¯»"><a href="#æ‰©å±•é˜…è¯»" class="headerlink" title="æ‰©å±•é˜…è¯»"></a>æ‰©å±•é˜…è¯»</h2><ul><li><a href="https://www.notion.so/Vue-2-3-302cbe0e37794345bbfbd89e32d617db?pvs=21" target="_blank" rel="noopener">Vue 2/3 æ¸²æŸ“å‡½æ•°å·®å¼‚ä»¥åŠå…¼å®¹æ–¹æ¡ˆ</a></li><li><a href="https://github.com/vuejs/core/pull/7963" target="_blank" rel="noopener">feat(types): <code>defineComponent()</code> with generics support</a></li><li><a href="https://cn.vitejs.dev/config/" target="_blank" rel="noopener">vitejs</a></li><li><a href="https://github.com/vitejs/vite-plugin-vue" target="_blank" rel="noopener">https://github.com/vitejs/vite-plugin-vue</a></li><li><a href="https://github.com/vitejs/vite-plugin-vue2" target="_blank" rel="noopener">https://github.com/vitejs/vite-plugin-vue2</a></li><li><a href="https://github.com/vuejs/babel-plugin-jsx" target="_blank" rel="noopener">https://github.com/vuejs/babel-plugin-jsx</a></li><li><a href="https://github.com/vuejs/jsx-vue2" target="_blank" rel="noopener">https://github.com/vuejs/jsx-vue2</a></li><li><a href="https://github.com/vuejs/language-tools" target="_blank" rel="noopener">https://github.com/vuejs/language-tools</a></li><li><a href="https://github.com/vuejs/vue-loader/" target="_blank" rel="noopener">https://github.com/vuejs/vue-loader/</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/images/component-for-vue2-3/Untitled.jpeg&quot; alt=&quot;Untitled&quot;&gt;&lt;/p&gt;
&lt;p&gt;Vue 3 å·²ç»&lt;a href=&quot;https://vue-js.com/topic/5f6562
      
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://bobi.ink/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>ç°ä»£å‰ç«¯æ¡†æ¶çš„æ¸²æŸ“æ¨¡å¼</title>
    <link href="https://bobi.ink/2023/06/05/render-patterns/"/>
    <id>https://bobi.ink/2023/06/05/render-patterns/</id>
    <published>2023-06-04T16:00:00.000Z</published>
    <updated>2023-06-05T03:25:04.885Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡ä¸»è¦å‚è€ƒçš„å†…å®¹æ¥æºæ˜¯<a href="https://www.patterns.dev/" target="_blank" rel="noopener">patterns.dev</a>ã€‚è¿™ä¸ªç½‘ç«™æ”¶å½•äº†è®¸å¤šå®ç”¨çš„å‰ç«¯è®¾è®¡æ¨¡å¼ï¼Œå¤§å®¶èµ¶ç´§æ”¶è—èµ·æ¥ï¼</p></blockquote><p><br></p><p>React å‘å¸ƒå·²ç»åå¹´äº†ï¼Œç¬”è€…æ¥è§¦å‰ç«¯å·®ä¸å¤šä¹Ÿæœ‰åå¹´æ—¶é—´äº†ã€‚è¯´å®è¯ï¼Œå¦‚æœæ²¡æœ‰ <a href="https://search.douban.com/book/subject_search?search_text=head+first&amp;cat=1001" target="_blank" rel="noopener">Head First ç³»åˆ—å›¾ä¹¦</a>ï¼Œæˆ‘å¯èƒ½éƒ½æ²¡æœ‰èµ°ä¸Šç¼–ç¨‹è¿™æ¡é“è·¯ã€‚</p><p><br></p><p><img src="/images/render-patterns/Untitled.png" alt="Head first"><br>Head first</p><p><br></p><p>å°½ç®¡ç°åœ¨çœ‹æ¥è¿™ç³»åˆ—å›¾ä¹¦å†…å®¹å¯èƒ½è¿‡æ—¶äº†ã€‚</p><p>Head First ç³»åˆ—å›¾ä¹¦è®©æˆ‘çŸ¥é“ï¼ŒåŸæ¥ç¼–ç¨‹ä¹Ÿå¯ä»¥è¿™ä¹ˆé€šä¿—æ˜“æ‡‚çš„ï¼Œå¯¹äºåˆšæ¥è§¦è¿™ä¸ªé¢†åŸŸçš„åŒå­¦æ¥è¯´ï¼Œä»è¿™é‡Œå¯ä»¥è·å¾—å¾ˆå¤šä¿¡å¿ƒå’Œæˆå°±æ„Ÿã€‚<br>è¿™ç§é£æ ¼ä¹Ÿä¸€ç›´å½±å“ç€æˆ‘ï¼Œå­¦ä¹ å’Œå·¥ä½œã€ä¼ é“æˆä¸šè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä¼šåŠªåŠ›æŠŠå¤æ‚çš„äº‹æƒ…ç®€åŒ–ã€é€šä¿—åŒ–ï¼Œæç‚¼æœ¬è´¨ã€‚</p><p><br><br><br></p><p>è¿™åå¹´ï¼Œå‰ç«¯æ¸²æŸ“æ–¹å¼ä¸€ç›´åœ¨æ¼”è¿›ï¼Œæˆ‘è§‰å¾—å¤§æ¦‚å¯ä»¥åˆ†ä¸ºä»¥ä¸‹ä¸‰ä¸ªé˜¶æ®µï¼š</p><p><img src="/images/render-patterns/Untitled%201.png" alt="Untitled"></p><ul><li>ä¼ ç»Ÿ SSR: é‚£æ—¶å€™å‰ç«¯è¿˜æ²¡æœ‰åˆ†ç¦»ï¼Œåœ¨ JSPã€ASPã€Ruby on Railsã€Django è¿™äº› MVC æ¡†æ¶ä¸‹ï¼Œé€šè¿‡æ¨¡æ¿æ¥æ¸²æŸ“é¡µé¢ã€‚jQuery æ˜¯è¿™ä¸ªé˜¶æ®µçš„ä¸»è§’</li><li>å‰åç«¯åˆ†ç¦»ï¼šä» Node.js å‘å¸ƒï¼Œåˆ°ç›®å‰ä¸ºæ­¢ï¼Œæ˜¯å‰ç«¯å‘å±•æœ€è¿…é€Ÿçš„ 10 å¹´ã€‚<br>å‰åç«¯åˆ†ç¦»çš„å…¸å‹ä»£è¡¨æ˜¯ Angular å’Œ Reactã€Vue ç­‰æ¡†æ¶ï¼Œæˆ‘è§‰å¾—ï¼Œä¿ƒè¿›å‰åç«¯åˆ†ç¦»çš„ä¸»è¦åŸå› è¿˜æ˜¯<strong>éšç€éœ€æ±‚çš„å¤æ‚åŒ–ï¼Œåˆ†å·¥ç²¾ç»†åŒ–äº†</strong>ã€‚ å‰ç«¯å¯ä»¥ä¸“æ³¨äº UI çš„è®¾è®¡å’Œäº¤äº’é€»è¾‘ã€‚åç«¯åªéœ€è¦æä¾› APIï¼Œä¸éœ€è¦å…³å¿ƒå‰ç«¯çš„å…·ä½“å®ç°ã€‚</li><li>åŒæ„å‰ç«¯ï¼šè¿™å‡ å¹´å‰ç«¯æ¡†æ¶çš„å‘å±•è¿›å…¥çš„æ·±æ°´åŒºï¼Œéšç€äº‘åŸç”Ÿã€å®¹å™¨æŠ€æœ¯ã€Serverlessã€è¾¹ç¼˜è®¡ç®—ç­‰åº•å±‚æŠ€æœ¯è®¾æ–½çš„æ™®åŠï¼Œä¹Ÿè®©â€˜å‰ç«¯â€™ç”Ÿå­˜èŒƒå›´å»¶å±•åˆ°æœåŠ¡ç«¯ã€‚å‰ç«¯å¼€å§‹å¯»æ±‚ <code>UX</code> å’Œ <code>DX</code> çš„å¹³è¡¡ç‚¹</li></ul><p><br><br><br><br><br></p><p>é€šè¿‡è¿™ç¯‡æ–‡ç« ï¼Œä½ å°±å¯ä»¥çŸ¥é“è¿‘äº›å¹´å‰ç«¯æ¸²æŸ“æ¨¡å¼çš„æ¼”å˜ã€‚</p><p>åºŸè¯ä¸å¤šè¯´ï¼Œç›´æ¥å¼€å§‹å§ã€‚</p><p><br><br><br><br><br></p><h2 id="csr-å®¢æˆ·ç«¯æ¸²æŸ“"><a href="#csr-å®¢æˆ·ç«¯æ¸²æŸ“" class="headerlink" title="CSR - å®¢æˆ·ç«¯æ¸²æŸ“"></a>CSR - å®¢æˆ·ç«¯æ¸²æŸ“</h2><p><img src="/images/render-patterns/Untitled%202.png" alt="Untitled"></p><p>è¿™ä¸ªæˆ‘ä»¬å†ç†Ÿæ‚‰ä¸è¿‡äº†ï¼Œ å³å‰ç«¯é¡µé¢åœ¨æµè§ˆå™¨ä¸­æ¸²æŸ“ï¼ŒæœåŠ¡ç«¯ä»…ä»…æ˜¯é™æ€èµ„æºæœåŠ¡å™¨(æ¯”å¦‚ nginx)ã€‚</p><p>åˆå§‹çš„ HTML æ–‡ä»¶åªæ˜¯ä¸€ä¸ªç©ºå£³ï¼Œæˆ‘ä»¬éœ€è¦ç­‰å¾… JavaScript åŒ…åŠ è½½å’Œæ‰§è¡Œå®Œæ¯•ï¼Œæ‰èƒ½è¿›è¡Œäº¤äº’ï¼Œç™½å±æ—¶é—´æ¯”è¾ƒé•¿ã€‚</p><ul><li>ä¼˜ç‚¹<ul><li>éƒ¨ç½²ç®€å•</li><li>é¡µé¢è¿‡æ¸¡ã€åŠŸèƒ½äº¤äº’å‹å¥½</li><li>é€‚åˆå¤æ‚äº¤äº’å‹åº”ç”¨ç¨‹åºå¼€å‘</li></ul></li><li>ç¼ºç‚¹<ul><li><code>SEO</code> ä¸å‹å¥½</li><li>ç™½å±æ—¶é—´é•¿</li><li>å¯èƒ½éœ€è¦å¤æ‚çš„çŠ¶æ€ç®¡ç†ã€‚æ—¶è‡³ä»Šæ—¥ï¼ŒçŠ¶æ€ç®¡ç†æ–¹é¢çš„è½®å­è¿˜åœ¨ä¸åœåœ°é€ </li></ul></li></ul><p><br><br><br><br><br></p><h2 id="ssr-æœåŠ¡ç«¯æ¸²æŸ“"><a href="#ssr-æœåŠ¡ç«¯æ¸²æŸ“" class="headerlink" title="SSR - æœåŠ¡ç«¯æ¸²æŸ“"></a>SSR - æœåŠ¡ç«¯æ¸²æŸ“</h2><p><img src="/images/render-patterns/Untitled%203.png" alt="Untitled"></p><p>ä¸ºäº†è§£å†³ SEO å’Œç™½å±é—®é¢˜ï¼Œå„å¤§æ¡†æ¶å¼€å§‹æ”¯æŒåœ¨æœåŠ¡ç«¯æ¸²æŸ“ HTML å­—ç¬¦ä¸²ã€‚</p><p>SSR æŠŠæ•°æ®æ‹‰å–æ”¾åˆ°äº†æœåŠ¡ç«¯ï¼Œå› ä¸ºç¦»æ•°æ®æºæ¯”è¾ƒè¿‘ï¼Œæ•°æ®æ‹‰å–çš„é€Ÿåº¦ä¼šå¿«ä¸€ç‚¹ã€‚ä½†è¿™ä¹Ÿä¸æ˜¯å®Œå…¨æ²¡æœ‰å‰¯ä½œç”¨ï¼Œå› ä¸ºéœ€è¦åœ¨æœåŠ¡ç«¯ç­‰å¾…æ•°æ®å°±ç»ª, <code>TTFB(Time to First Byte)</code> ç›¸æ¯” CSR ä¼šé•¿ä¸€ç‚¹ã€‚</p><p>SSR åªæ˜¯ç»™æˆ‘ä»¬å‡†å¤‡å¥½äº†åˆå§‹çš„æ•°æ®å’Œ HTML, å®é™…ä¸Šå’Œ CSR ä¸€æ ·ï¼Œæˆ‘ä»¬è¿˜æ˜¯éœ€è¦åŠ è½½å®Œæ•´çš„<code>å®¢æˆ·ç«¯ç¨‹åº</code>ï¼Œç„¶ååœ¨æµè§ˆå™¨ç«¯é‡æ–°æ¸²æŸ“ä¸€é(æ›´ä¸“ä¸šçš„è¯´æ˜¯ <code>Hydration  æ°´åˆ/æ³¨æ°´</code>)ï¼Œæ‰èƒ½è®© DOM æœ‰äº¤äº’èƒ½åŠ›ã€‚</p><p><strong>ä¹Ÿå°±è¯´ï¼Œ <code>FCP(First Contentful Paint)</code> ç›¸æ¯” CSR æå‰äº†, ä½†æ˜¯ <code>TTI(Time to Interactive)</code> å¹¶æ²¡æœ‰å¤ªå¤šå·®åˆ«ã€‚åªæ˜¯ç”¨æˆ·å¯ä»¥æ›´å¿«åœ°çœ‹åˆ°å†…å®¹äº†ã€‚</strong></p><blockquote><p>hydration çš„ä¸»è¦ç›®çš„æ˜¯æŒ‚è½½äº‹ä»¶å¤„ç†å™¨ã€è§¦å‘å‰¯ä½œç”¨ç­‰ç­‰</p></blockquote><p>ä¼˜ç‚¹</p><ul><li>SEO å‹å¥½</li><li>ç”¨æˆ·å¯ä»¥æ›´å¿«çœ‹åˆ°å†…å®¹äº†</li></ul><p>ç¼ºç‚¹</p><ul><li>éƒ¨ç½²ç¯å¢ƒè¦æ±‚ã€‚éœ€è¦ Nodejs ç­‰ JavaScript æœåŠ¡ç«¯è¿è¡Œç¯å¢ƒ</li><li>éœ€è¦åŒ…å«å®Œæ•´çš„ JavaScript å®¢æˆ·ç«¯æ¸²æŸ“ç¨‹åºï¼Œ<code>TTI</code> è¿˜æœ‰æ”¹å–„ç©ºé—´</li></ul><p><br><br><br><br><br><br><br></p><h2 id="ssg-é™æ€ç”Ÿæˆ"><a href="#ssg-é™æ€ç”Ÿæˆ" class="headerlink" title="SSG - é™æ€ç”Ÿæˆ"></a>SSG - é™æ€ç”Ÿæˆ</h2><p><img src="/images/render-patterns/Untitled%204.png" alt="Untitled"></p><p>å¯¹äºå®Œå…¨é™æ€çš„é¡µé¢ï¼Œæ¯”å¦‚åšå®¢ï¼Œå…¬å¸ä¸»é¡µç­‰ç­‰ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ SSG é™æ€æ¸²æŸ“ã€‚</p><p>å’Œ SSR çš„åŒºåˆ«æ˜¯ï¼ŒSSG æ˜¯åœ¨<code>æ„å»ºæ—¶</code>æ¸²æŸ“çš„ã€‚</p><p>å’Œ CSR ä¸€æ ·ï¼Œå› ä¸ºæ˜¯é™æ€çš„ï¼Œæ‰€ä»¥åœ¨æœåŠ¡ç«¯ä¸éœ€è¦æ¸²æŸ“è¿è¡Œæ—¶ï¼Œéƒ¨ç½²åœ¨é™æ€æœåŠ¡å™¨å°±è¡Œäº†ã€‚</p><p>VuePressã€VitePressã€Gatsbyã€Docusaurus è¿™äº›æ¡†æ¶éƒ½å±äº SSG çš„èŒƒç•´ã€‚</p><p><br><br><br></p><p>ä¼˜ç‚¹</p><ul><li>ç›¸æ¯” SSR, å› ä¸ºä¸éœ€è¦æœåŠ¡ç«¯è¿è¡Œæ—¶ã€æ•°æ®æ‹‰å–ï¼ŒTTFB/FCP ç­‰éƒ½ä¼šæå‰ã€‚</li></ul><p>ç¼ºç‚¹</p><ul><li>å’Œ SSR ä¸€æ ·ï¼Œä¹Ÿæœ‰å®¢æˆ·ç«¯æ¸²æŸ“ç¨‹åºã€éœ€è¦è¿›è¡Œ Hydrateã€‚<br>å¯¹äº<code>å†…å®¹ä¸ºä¸­å¿ƒ</code>çš„ç«™ç‚¹æ¥è¯´ï¼Œå®é™…ä¸Šå¹¶ä¸éœ€è¦å¤ªå¤šäº¤äº’ï¼Œå®¢æˆ·ç«¯ç¨‹åºè¿˜æœ‰è¾ƒå¤§å‹ç¼©çš„ç©ºé—´ã€‚</li><li>åœ¨æ„å»ºæ—¶æ¸²æŸ“ï¼Œå¦‚æœå†…å®¹å˜æ›´ï¼Œéœ€è¦é‡æ–°æ„å»ºï¼Œæ¯”è¾ƒéº»çƒ¦</li></ul><p><br><br><br><br><br><br><br></p><h2 id="isg-å¢é‡é™æ€ç”Ÿæˆ"><a href="#isg-å¢é‡é™æ€ç”Ÿæˆ" class="headerlink" title="ISG - å¢é‡é™æ€ç”Ÿæˆ"></a>ISG - å¢é‡é™æ€ç”Ÿæˆ</h2><p><img src="/images/render-patterns/Untitled%205.png" alt="Untitled"></p><p>ISG æ˜¯ SSG çš„å‡çº§ç‰ˆã€‚è§£å†³ SSG å†…å®¹å˜æ›´ç¹çé—®é¢˜ã€‚</p><p>ISG ä¾æ—§ä¼šåœ¨æ„å»ºæ—¶é¢„æ¸²æŸ“é¡µé¢ï¼Œä½†æ˜¯è¿™é‡Œå¤šå‡ºäº†ä¸€ä¸ª<code>æœåŠ¡ç«¯è¿è¡Œæ—¶</code>ï¼Œè¿™ä¸ªè¿è¡Œæ—¶ä¼šæŒ‰ç…§ä¸€å®šçš„è¿‡æœŸ/åˆ·æ–°ç­–ç•¥(é€šå¸¸ä¼šä½¿ç”¨ <strong><a href="https://web.dev/stale-while-revalidate/" target="_blank" rel="noopener">stale-while-revalidate</a></strong> )æ¥é‡æ–°ç”Ÿæˆé¡µé¢ã€‚</p><p><br><br><br><br><br><br><br></p><h2 id="progressive-hydration-æ¸è¿›æ°´åˆ"><a href="#progressive-hydration-æ¸è¿›æ°´åˆ" class="headerlink" title="Progressive Hydration - æ¸è¿›æ°´åˆ"></a>Progressive Hydration - æ¸è¿›æ°´åˆ</h2><p><img src="/images/render-patterns/Untitled%206.png" alt="Untitled"></p><p>ä¸Šæ–‡æåˆ°ï¼Œå¸¸è§„çš„ SSR é€šå¸¸éœ€è¦å®Œæ•´åŠ è½½å®¢æˆ·ç«¯ç¨‹åº(ä¸Šå›¾çš„ bundle.js)ï¼Œæ°´åˆä¹‹åæ‰èƒ½å¾—åˆ°å¯äº¤äº’é¡µé¢ï¼Œè¿™å°±å¯¼è‡´ <code>TTI</code> ä¼šåæ™šã€‚</p><p>æœ€ç›´æ¥çš„è§£å†³åŠæ³•å°±æ˜¯å‹ç¼©å®¢æˆ·ç«¯ç¨‹åºçš„ä½“ç§¯ã€‚é‚£ä¹ˆè‡ªç„¶ä¼šæƒ³åˆ°ä½¿ç”¨<code>ä»£ç åˆ†å‰²</code>(code splitting)æŠ€æœ¯ã€‚<br><code>æ¸è¿›å¼æ°´åˆ ï¼ˆProgressive Hydration ï¼‰</code> å°±æ˜¯è¿™ä¹ˆæ¥çš„ã€‚</p><p>å¦‚ä¸Šå›¾ï¼Œæˆ‘ä»¬ä½¿ç”¨<code>ä»£ç åˆ†å‰²</code>çš„æ–¹å¼ï¼Œå°† Fooã€Bar æŠ½å–ä¸º<code>å¼‚æ­¥ç»„ä»¶</code>ï¼ŒæŠ½å–å<code>ä¸»åŒ…</code>çš„ä½“ç§¯ä¸‹é™äº†ï¼Œ<code>TTI</code> å°±å¯ä»¥æå‰äº†ã€‚</p><p>è€Œ Fooã€Bar å¯ä»¥æŒ‰ç…§ä¸€å®šçš„ç­–ç•¥æ¥æŒ‰éœ€åŠ è½½å’Œæ°´åˆï¼Œæ¯”å¦‚åœ¨è§†å£å¯è§æ—¶ã€æµè§ˆå™¨ç©ºé—²æ—¶ï¼Œæˆ–è€…äº¤ç»™ <code>React Concurrent Mode</code> æ ¹æ®äº¤äº’çš„ä¼˜å…ˆçº§æ¥åŠ è½½ã€‚</p><p>React 18 å®˜æ–¹æ”¯æŒäº†æ¸è¿›å¼æ°´åˆï¼ˆå®˜æ–¹å« <code>Selective Hydration</code>ï¼‰ã€‚</p><p>è¦æ·±å…¥äº†è§£ Progress Hydration, å¯ä»¥çœ‹è¿™ä¸ª<a href="https://www.youtube.com/watch?v=k-A2VfuUROg&amp;t=960s" target="_blank" rel="noopener">è§†é¢‘</a>ã€‚</p><p><br><br><br><br><br></p><h2 id="ssr-with-streaming-æµå¼-ssr"><a href="#ssr-with-streaming-æµå¼-ssr" class="headerlink" title="SSR with streaming - æµå¼ SSR"></a>SSR with streaming - æµå¼ SSR</h2><p><img src="/images/render-patterns/Untitled%207.png" alt="Untitled"></p><p>è¿™ä¸ªå¾ˆå¥½ç†è§£ã€‚å°¤å…¶æ˜¯åœ¨æœ€è¿‘ <code>ChatGPT</code> è¿™ä¹ˆç«ã€‚ChatGPT API æœ‰ä¸¤ç§å“åº”æ¨¡å¼ï¼šæ™®é€šå“åº”ã€æµå¼å“åº”</p><ul><li><a href="https://react.dev/reference/react-dom/server/renderToString" target="_blank" rel="noopener">renderToString</a> â†’ æ™®é€šå“åº”ã€‚å³ SSR ä¼šç­‰å¾…å®Œæ•´çš„ HTML æ¸²æŸ“å®Œæ¯•åï¼Œæ‰ç»™å®¢æˆ·ç«¯å‘é€ç¬¬ä¸€ä¸ªå­—èŠ‚ã€‚</li><li><a href="https://react.dev/reference/react-dom/server/renderToNodeStream" target="_blank" rel="noopener">renderToNodeStream</a> â†’ æµå¼å“åº”ã€‚æ¸²æŸ“å¤šå°‘ï¼Œå°±å‘é€å¤šå°‘ã€‚å°±åƒ ChatGPT èŠå¤©æ¶ˆæ¯ä¸€æ ·ï¼Œä¸€ä¸ªå­—ä¸€ä¸ªå­—çš„è¹¦ï¼Œå°½ç®¡æ¥æ”¶å®Œæ•´æ¶ˆæ¯çš„æ—¶é—´å¯èƒ½å·®ä¸å¤šï¼Œç”¨æˆ·ä½“éªŒå´ç›¸å·®ç”šè¿œã€‚</li></ul><p>æµè§ˆå™¨èƒ½å¤Ÿå¾ˆå¥½åœ°å¤„ç† HTML æµï¼Œå¿«é€Ÿåœ°å°†å†…å®¹å‘ˆç°ç»™ç”¨æˆ·ï¼Œè€Œä¸æ˜¯ç™½å±å¹²ç­‰ã€‚</p><p>ä¸‹é¢è¿™å¼ å›¾å¯ä»¥æ›´ç›´è§‚æ„Ÿå—ä¸¤è€…åŒºåˆ«ï¼š</p><p><img src="/images/render-patterns/Untitled%208.png" alt="æ¥æºï¼š[https://mxstbr.com/thoughts/streaming-ssr/](https://mxstbr.com/thoughts/streaming-ssr/)"></p><p>æ¥æºï¼š<a href="https://mxstbr.com/thoughts/streaming-ssr/" target="_blank" rel="noopener">https://mxstbr.com/thoughts/streaming-ssr/</a></p><p>å¯¹äºå¸¸è§„çš„æµå¼ SSRï¼Œä¼˜åŒ–æ•ˆæœå¯èƒ½æ²¡æœ‰æˆ‘ä»¬æƒ³è±¡çš„é‚£ä¹ˆæ˜æ˜¾ã€‚<strong>å› ä¸ºæ¡†æ¶è¿˜æ˜¯å¾—ç­‰æ•°æ®æ‹‰å–å®Œæˆä¹‹åæ‰èƒ½å¼€å§‹æ¸²æŸ“</strong>ã€‚å› æ­¤ï¼Œé™¤éæ˜¯æ¯”è¾ƒå¤æ‚ã€é•¿åºåˆ—çš„ HTML æ ‘ï¼Œè‡³ä¸Šè€Œä¸‹éœ€è¦è¾ƒé•¿æ—¶é—´çš„æ¸²æŸ“ï¼Œå¦åˆ™æ•ˆæœå¹¶ä¸æ˜æ˜¾ã€‚</p><p><br><br><br></p><p>ä¼˜ç‚¹</p><ul><li>ç›¸æ¯”æ™®é€šå“åº”ï¼Œæµå¼å“åº”å¯ä»¥æå‰ TTFB å’Œ FCP, æµè§ˆå™¨ä¸ç”¨ç©ºè½¬ç­‰å¾…ï¼Œå¯ä»¥è¿ç»­ç»˜åˆ¶ã€‚</li></ul><p>ç¼ºç‚¹</p><ul><li><strong>æ•°æ®æ‹‰å–æ˜¯ TTFB/FCP çš„ä¸»è¦é˜»å¡åŸå› ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä¸‹æ–‡çš„ <code>Selective Hydration</code> å¦‚ä½•å·§å¦™åœ°è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</strong></li></ul><p><br><br><br><br><br></p><h2 id="selective-hydration-é€‰æ‹©æ€§æ°´åˆ"><a href="#selective-hydration-é€‰æ‹©æ€§æ°´åˆ" class="headerlink" title="Selective Hydration - é€‰æ‹©æ€§æ°´åˆ"></a>Selective Hydration - é€‰æ‹©æ€§æ°´åˆ</h2><p><img src="/images/render-patterns/Untitled%209.png" alt="Untitled"></p><p><code>é€‰æ‹©æ€§æ°´åˆï¼ˆProgressive Hydrationï¼‰</code> æ˜¯ <code>æ¸è¿›å¼æ°´åˆ(Progressive Hydration)</code> å’Œ <code>æµå¼SSR(SSR with Streaming)</code> çš„å‡çº§ç‰ˆã€‚<strong>ä¸»è¦é€šè¿‡é€‰æ‹©æ€§åœ°è·³è¿‡â€˜<code>æ…¢ç»„ä»¶</code>â€™ï¼Œé¿å…é˜»å¡ï¼Œæ¥å®ç°æ›´å¿«çš„ HTML è¾“å‡ºï¼Œ ä»è€Œè®©æµå¼å“åº”å‘æŒ¥åº”æœ‰çš„ä½œç”¨ã€‚</strong></p><blockquote><p><code>æ…¢ç»„ä»¶</code>é€šå¸¸æŒ‡çš„æ˜¯ï¼šéœ€è¦å¼‚æ­¥è·å–æ•°æ®ã€ä½“ç§¯è¾ƒå¤§ã€æˆ–è€…æ˜¯è®¡ç®—é‡æ¯”è¾ƒå¤æ‚çš„ç»„ä»¶ã€‚</p></blockquote><p>æ¯”è¾ƒå…¸å‹çš„<code>æ…¢ç»„ä»¶</code>æ˜¯å¼‚æ­¥æ•°æ®è·å–çš„ç»„ä»¶, å¦‚ä¸‹å›¾ï¼Œæœªå¼€å¯ Selective Hydration çš„æƒ…å†µï¼Œä¼šç­‰å¾…æ‰€æœ‰å¼‚æ­¥ä»»åŠ¡å®Œæˆåæ‰å¼€å§‹è¾“å‡ºï¼Œè€Œ Selective Hydration å¯ä»¥è·³è¿‡è¿™äº›ç»„ä»¶ï¼Œç­‰å¾…å®ƒä»¬å°±ç»ªåï¼Œç»§ç»­è¾“å‡ºã€‚</p><p><img src="/images/render-patterns/Untitled%2010.png" alt="Untitled"></p><p>æˆ‘ä»¬å¯ä»¥åœ¨æœ€æ–°çš„ Next.js(å½“å‰æ˜¯ 13.4) æ¼”ç¤ºä¸€ä¸‹ã€‚</p><details><br> <summary>æ²¡æœ‰å¼€å¯ Selective Hydration çš„ Demo:</summary><br><br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">function delay(time: number) &#123;</span><br><span class="line">  return new Promise((resolve) =&gt; setTimeout(resolve, time))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * è·å–å…³é”®æ•°æ®</span><br><span class="line"> */</span><br><span class="line">function getCrucialData() &#123;</span><br><span class="line">  return delay(1000).then(() =&gt; &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      data: Math.random(),</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function getData(time: number) &#123;</span><br><span class="line">  return delay(time).then(() =&gt; &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      data: Math.random(),</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const Foo = async () =&gt; &#123;</span><br><span class="line">  const data = await getData(1000)</span><br><span class="line"></span><br><span class="line">  return &lt;div&gt;foo: &#123;data.data&#125;&lt;/div&gt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const Bar = async () =&gt; &#123;</span><br><span class="line">  const data = await getData(2000)</span><br><span class="line"></span><br><span class="line">  return &lt;div&gt;bar: &#123;data.data&#125;&lt;/div&gt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * é¡µé¢ ğŸ”´</span><br><span class="line"> *</span><br><span class="line"> */</span><br><span class="line">export default async function WithoutSelective() &#123;</span><br><span class="line">  // è·å–å…³é”®æ•°æ®</span><br><span class="line">  const crucialData = await getCrucialData()</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;h1&gt;Without Selective&lt;/h1&gt;</span><br><span class="line">      &lt;p&gt;This page is rendered without Selective Hydration.&lt;/p&gt;</span><br><span class="line">      &lt;p&gt;crucial data: &#123;crucialData.data&#125;&lt;/p&gt;</span><br><span class="line">      &lt;Foo&gt;&lt;/Foo&gt;</span><br><span class="line">      &lt;Bar&gt;&lt;/Bar&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><br>è¿è¡Œç»“æœï¼šæµè§ˆå™¨ç­‰å¾…å“åº”çš„æ—¶é—´ä¸º 3s<br><img src="/images/render-patterns/Untitled%2011.png" alt="Untitled"><br>å³æ‰€æœ‰<code>æœåŠ¡ç«¯ç»„ä»¶ï¼ˆServer Componentï¼‰</code> å°±ç»ªåæ‰ä¼šæœ‰å®é™…çš„å†…å®¹è¾“å‡ºã€‚<br><br></details><p><br><br><br></p><p>å¼€å¯ Selective Hydration å¾ˆç®€å•ï¼Œæˆ‘ä»¬åªéœ€è¦ç”¨ Suspend åŒ…è£¹èµ·æ¥ï¼Œæç¤º React è¿™å¯èƒ½æ˜¯ä¸€ä¸ªâ€˜æ…¢ç»„ä»¶â€™ï¼Œå¯ä»¥è·³è¿‡ä»–ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">export default async function WithoutSelective() &#123;</span><br><span class="line">  // è·å–å…³é”®æ•°æ®</span><br><span class="line">  const crucialData = await getCrucialData()</span><br><span class="line"></span><br><span class="line">  return (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;h1&gt;Without Selective&lt;/h1&gt;</span><br><span class="line">      &lt;p&gt;This page is rendered without Selective Hydration.&lt;/p&gt;</span><br><span class="line">      &lt;p&gt;crucial data: &#123;crucialData.data&#125;&lt;/p&gt;</span><br><span class="line">      &lt;Suspense fallback=&quot;foo loading&quot;&gt;</span><br><span class="line">        &lt;Foo&gt;&lt;/Foo&gt;</span><br><span class="line">      &lt;/Suspense&gt;</span><br><span class="line">      &lt;Suspense fallback=&quot;bar loading&quot;&gt;</span><br><span class="line">        &lt;Bar&gt;&lt;/Bar&gt;</span><br><span class="line">      &lt;/Suspense&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p>ç°åœ¨æ¥çœ‹è¿è¡Œç»“æœï¼š</p><p><img src="/images/render-patterns/Untitled%2012.png" alt="Untitled"></p><p>æ˜æ˜¾ TTFB æå‰äº†ï¼ä½†æ˜¯å®Œæ•´çš„è¯·æ±‚æ—¶é—´æ²¡å˜ã€‚</p><p><br></p><p>å½“ Foo å’Œ Bar å°±ç»ªåï¼ŒNext.js ä¼šå°†æ¸²æŸ“ç»“æœå†™å…¥æµä¸­ã€‚æ€ä¹ˆåšåˆ°çš„ï¼Ÿ</p><p><br></p><p>çœ‹ä¸€çœ¼ HTML å°±çŸ¥é“äº†ï¼š</p><p><img src="/images/render-patterns/Untitled%2013.png" alt="Untitled"></p><p>å¯¹äº<code>æ…¢ç»„ä»¶</code>ï¼ŒReact ä¼šå…ˆæ¸²æŸ“ Suspend çš„ fallback å†…å®¹ï¼Œå¹¶ç•™ä¸€ä¸ªæ’æ§½ã€‚</p><p>ç»§ç»­å¾€ä¸‹çœ‹ï¼Œå¯ä»¥çœ‹åˆ° Fooã€Bar çš„æ¸²æŸ“ç»“æœï¼š</p><p><img src="/images/render-patterns/Untitled%2014.png" alt="Untitled"></p><p>æ¥ç€å°†æ¸²æŸ“ç»“æœæ›¿æ¢æ‰æ’æ§½ã€‚ç”¨äºåç»­çš„æ°´åˆã€‚</p><p><br><br><br><br><br></p><p>æ€»ä¹‹ï¼Œåœ¨æœåŠ¡ç«¯ï¼ŒSelective Hydration åœ¨ SSR With Streaming çš„åŸºç¡€ä¸Šï¼Œé€šè¿‡é€‰æ‹©æ€§åœ°è·³è¿‡ä¸€äº›ä½ä¼˜å…ˆçº§çš„æ…¢ç»„ä»¶æ¥ä¼˜åŒ–äº† TTFB(ä¸»è¦çš„ï¼Œç›¸å¯¹äº FCP ç­‰æŒ‡æ ‡ä¹Ÿä¼˜åŒ–äº†)ï¼Œæ›´å¿«åœ°å‘ç”¨æˆ·å‘ˆç°é¡µé¢ã€‚</p><p>åœ¨å®¢æˆ·ç«¯ Selective Hydration çš„è¿è¡Œè¿‡ç¨‹åŒ Progressive Hydration ã€‚</p><p>å…³äº Selective Hydration ç»†èŠ‚ï¼Œå¯ä»¥é˜…è¯»ä»¥ä¸‹æ–‡ç« ï¼š</p><ul><li><a href="https://github.com/reactwg/react-18/discussions/130" target="_blank" rel="noopener">New in 18: Selective Hydration</a></li><li><a href="https://github.com/reactwg/react-18/discussions/37" target="_blank" rel="noopener">New Suspense SSR Architecture in React 18</a></li></ul><p><br><br><br><br><br><br><br></p><h2 id="islands-architecture-å²›å±¿æ¶æ„"><a href="#islands-architecture-å²›å±¿æ¶æ„" class="headerlink" title="Islands Architecture - å²›å±¿æ¶æ„"></a>Islands Architecture - å²›å±¿æ¶æ„</h2><p><img src="/images/render-patterns/Untitled%2015.png" alt="Untitled"></p><p>è¿‘ä¸¤å¹´ï¼Œ<strong>å» JavaScript æˆä¸ºä¸€æ³¢å°è¶‹åŠ¿</strong>ï¼Œè¿™å…¶ä¸­çš„å…¸å‹ä»£è¡¨æ˜¯ <code>Islands Architecture</code> (å²›å±¿æ¶æ„)å’Œ <code>React Server Component</code>(RSC, React æœåŠ¡ç«¯ç»„ä»¶)ã€‚</p><p>å®ƒä»¬ä¸»å¼ æ˜¯ï¼š<strong>åœ¨æœåŠ¡ç«¯æ¸²æŸ“ï¼Œç„¶åå»æ‰ä¸å¿…è¦ JavaScript</strong></p><p>å²›å±¿æ¶æ„çš„ä¸»è¦ä»£è¡¨æ˜¯ <code>Astro</code>ã€‚å¦‚ä¸Šå›¾ï¼ŒAstro åœ¨æœåŠ¡ç«¯æ¸²æŸ“åï¼Œ<strong>é»˜è®¤æƒ…å†µä¸‹ï¼Œåœ¨å®¢æˆ·ç«¯ä¾§æ²¡æœ‰å®¢æˆ·ç«¯ç¨‹åºå’Œæ°´åˆçš„è¿‡ç¨‹ã€‚è€Œå¯¹äºéœ€è¦ JavaScript å¢å¼ºï¼Œå®ç°åŠ¨æ€äº¤äº’çš„ç»„ä»¶ï¼Œéœ€è¦æ˜¾å¼æ ‡è®°ä¸ºå²›å±¿ã€‚</strong></p><p><br></p><p>è¿™æœ‰ç‚¹ç±»ä¼¼ Progressive Hydration çš„æ„æ€ã€‚ä½†æ˜¯è¿˜æ˜¯æœ‰å¾ˆå¤§çš„å·®åˆ«ï¼š</p><ul><li>å²›å±¿æ˜¯åœ¨<code>å» JavaScript</code> è¿™ä¸ªèƒŒæ™¯ä¸‹çš„äº¤äº’å¢å¼ºæ‰‹æ®µã€‚æŒ‰ Astro è§£é‡Šæ˜¯ï¼š ä½ å¯ä»¥å°†â€˜å²›å±¿â€™æƒ³è±¡æˆåœ¨ä¸€ç‰‡ç”±<em>é™æ€ï¼ˆä¸å¯äº¤äº’ï¼‰çš„ HTML</em> é¡µé¢ä¸­çš„<em>åŠ¨æ€å²›å±¿</em></li><li>æ¯ä¸ªå²›å±¿éƒ½æ˜¯ç‹¬ç«‹åŠ è½½ã€å±€éƒ¨æ°´åˆã€‚è€Œ Progressive Hydration æ˜¯æ•´æ£µæ ‘æ°´åˆçš„åˆ†æ”¯ï¼Œåªä¸è¿‡å»¶åäº†ã€‚</li><li>å²›å±¿å¯ä»¥æ¡†æ¶æ— å…³ã€‚</li></ul><p><br></p><p>å» JavaScript åï¼Œå¯ä»¥ç¼“è§£å…¸å‹çš„ SSR <code>TTI</code> é—®é¢˜ã€‚<strong>ä½†æ˜¯å²›å±¿æ¶æ„å¹¶ä¸èƒ½é€šåƒæ‰€æœ‰çš„åœºæ™¯ï¼Œæœ€æ“…é•¿çš„æ˜¯â€å†…å®¹ä¸ºä¸­å¿ƒâ€œçš„ç«™ç‚¹ï¼Œå³å½“é™æ€çš„é¡µé¢æ¯”é‡è¿œé«˜äºåŠ¨æ€æ¯”é‡æ—¶ï¼Œå» JavaScript çš„æ”¶ç›Šæ‰æ˜¯æ˜¾è‘—çš„ã€‚</strong></p><p><br><br><br><br><br></p><h2 id="react-server-component-react-æœåŠ¡ç«¯ç»„ä»¶"><a href="#react-server-component-react-æœåŠ¡ç«¯ç»„ä»¶" class="headerlink" title="React Server Component - React æœåŠ¡ç«¯ç»„ä»¶"></a>React Server Component - React æœåŠ¡ç«¯ç»„ä»¶</h2><p><img src="/images/render-patterns/Untitled%2016.png" alt="Untitled"></p><p>åœ¨ç¬”è€…çœ‹æ¥ï¼Œ<code>React Server Component(RSC)</code> æœ¬è´¨ä¸Šå’Œå²›å±¿æ¶æ„çš„ç›®çš„æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯å» JavaScriptã€‚åªæ˜¯å®ç°çš„æ‰‹æ®µä¸åŒã€‚</p><p><br></p><p>è¿™æ˜¯ Next.js å®˜æ–¹æ–‡æ¡£çš„ç¤ºä¾‹å›¾ï¼šå’Œå²›å±¿æ¶æ„ç±»ä¼¼ï¼Œå¯¹äºé™æ€çš„å†…å®¹æ¨èä½¿ç”¨ <code>Server Component (SC),</code> è€Œéœ€è¦äº¤äº’å¢å¼ºçš„ï¼Œå¯ä»¥ä½¿ç”¨ <code>Client Component (CC)</code>ã€‚</p><p><img src="/images/render-patterns/Untitled%2017.png" alt="Untitled"></p><p><br></p><p>é¡¾åæ€ä¹‰ï¼ŒRSC <strong>å°±æ˜¯åªèƒ½åœ¨æœåŠ¡ç«¯è¿è¡Œçš„ç»„ä»¶</strong>ã€‚ä¸‹é¢ç®€å•å¯¹æ¯”ä¸€ä¸‹ä¸¤è€…çš„åŒºåˆ«ï¼š</p><table><thead><tr><th></th><th>Server Component</th><th>Client Component</th></tr></thead><tbody><tr><td>è¿è¡Œç¯å¢ƒ</td><td>æœåŠ¡ç«¯</td><td>- æœåŠ¡ç«¯ + å®¢æˆ·ç«¯</td></tr><tr><td>- ä»…å®¢æˆ·ç«¯</td></tr><tr><td>JavaScript</td><td>æœåŠ¡ç«¯ç»„ä»¶ä¾èµ–çš„ç›¸å…³ç¨‹åºå¯¹å®¢æˆ·ç«¯ä¸å¯è§ã€‚</td></tr><tr><td>åœ¨è¿™é‡Œå®ç°äº† â€˜å» JavaScriptâ€™</td><td>éœ€è¦æ‰“åŒ…åˆ†å‘ç»™å®¢æˆ·ç«¯</td></tr><tr><td>æ°´åˆ</td><td>ä¸éœ€è¦æ°´åˆ</td><td>éœ€è¦æ°´åˆ</td></tr><tr><td>æ”¯æŒ async</td><td>Y</td><td>N</td></tr><tr><td>æ”¯æŒçŠ¶æ€(state, context)</td><td>N</td><td>Y</td></tr><tr><td>æ”¯æŒäº‹ä»¶ã€å‰¯ä½œç”¨</td><td>N</td><td>Y</td></tr></tbody></table><blockquote><p>RSC ä¼˜ç‚¹ç±»ä¼¼ React Hooks å‡ºæ¥ä¹‹å‰çš„<a href="https://web.archive.org/web/20170621181013/https://facebook.github.io/react/docs/components-and-props.html" target="_blank" rel="noopener">å‡½æ•°ç»„ä»¶</a>: å°±æ˜¯ä¸€ä¸ªæ™®é€šçš„å‡½æ•°ï¼Œä¸èƒ½ä½¿ç”¨ hooksï¼Œæ²¡æœ‰çŠ¶æ€ï¼Œåªä¼šè¢«è°ƒç”¨ä¸€æ¬¡ã€‚</p></blockquote><p>ä½ å¯ä»¥é€šè¿‡ <a href="https://nextjs.org/docs/getting-started/react-essentials" target="_blank" rel="noopener">Next.js çš„æ–‡æ¡£</a>ï¼Œæ·±å…¥å­¦ä¹  RSCã€‚React å®˜æ–¹çš„<a href="https://github.com/reactwg/server-components/discussions" target="_blank" rel="noopener">è®¨è®ºç»„</a>ä¹Ÿæ˜¯ä¸é”™çš„ä¸€æ‰‹å­¦ä¹ åœºåœ°ã€‚</p><p><br><br><br></p><p><strong>é‚£ä¹ˆç›¸æ¯”å²›å±¿æ¶æ„å‘¢ï¼Ÿ</strong></p><p>ä¼˜ç‚¹</p><ul><li>Server Component å’Œ Client Component éƒ½æ˜¯ React æ¡†æ¶çš„ç»„ä»¶ï¼Œå°½ç®¡æœ‰äº›åŒºåˆ«ï¼Œä½†æ˜¯å¿ƒæ™ºæ¨¡å‹æ˜¯ç»Ÿä¸€çš„ã€‚</li><li>React Server Component æ˜¯ React æ¡†æ¶ä¸‹ä¸€ä½“åŒ–çš„åŸç”Ÿè§£å†³æ–¹æ¡ˆï¼Œæ”¯æŒå’Œ Selective Hydration é…åˆä½¿ç”¨ã€‚å²›å±¿æ¶æ„åªæ˜¯ä¸€ä¸ªæ¶æ„æ¨¡å¼ã€‚</li><li>å¯ä»¥è¿›è¡Œæ›´ç»†ç²’åº¦å’Œæ›´çµæ´»çš„ç»„åˆã€‚</li></ul><p>ç¼ºç‚¹</p><ul><li>Server Component å’Œ Client Component è¿˜æ˜¯æœ‰è¾ƒå¤§å·®åˆ«ï¼Œåœ¨ç»„åˆã€é€šä¿¡ä¸Šä¹Ÿæœ‰è¾ƒå¤šé™åˆ¶ï¼Œéœ€è¦å¼€å‘è€…è§„åˆ’å¥½æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯çš„è¾¹ç•Œã€‚åˆæœŸæœ‰ä¸€å®šä¸Šæ‰‹é—¨æ§›ã€‚<br>å½“ç„¶ï¼ŒIslands å¯èƒ½ä¹Ÿæœ‰ç±»ä¼¼çš„é—®é¢˜ã€‚</li></ul><p><br><br><br><br><br></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æœ¬æ–‡ç¯‡å¹…è¾ƒé•¿ï¼Œæˆ‘ç»™å¤§å®¶æ•´ç†äº†è¿™äº›æ¸²æŸ“æ¨¡å¼çš„å‘å±•å†ç¨‹å’Œå…³ç³»è„‰ç»œ</p><p><img src="/images/render-patterns/Untitled%2018.png" alt="Untitled"></p><p>ä»»ä½•æŠ€æœ¯çš„è¿­ä»£éƒ½æ˜¯æœ‰å…¶åŠ¨æœºå’Œè„‰ç»œã€‚ä¸æ¨èå¤§å®¶é¢å‘çƒ­åº¦ç¼–ç¨‹ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œåšåˆ°â€˜çŸ¥å…¶ç„¶ï¼Œä¹ŸçŸ¥å…¶æ‰€ä»¥ç„¶â€™ï¼Œå°±è¶³å¤Ÿäº†ã€‚</p><p><br><br><br><br><br></p><h2 id="æ‰©å±•é˜…è¯»"><a href="#æ‰©å±•é˜…è¯»" class="headerlink" title="æ‰©å±•é˜…è¯»"></a>æ‰©å±•é˜…è¯»</h2><ul><li><a href="https://www.patterns.dev/posts/react-selective-hydration" target="_blank" rel="noopener">Pattern dev</a></li><li><a href="https://nextjs.org/docs/getting-started/react-essentials" target="_blank" rel="noopener">Next.js</a></li><li><a href="https://nextjs.org/docs/pages/building-your-application/data-fetching/incremental-static-regeneration" target="_blank" rel="noopener">Next.js Incremental Static RegenerationExamples</a></li><li><a href="https://github.com/reactwg/server-components/discussions" target="_blank" rel="noopener">reactwg/<strong>server-components</strong></a></li><li><strong><a href="https://dev.to/this-is-learning/is-0kb-of-javascript-in-your-future-48og" target="_blank" rel="noopener">Is 0kb of JavaScript in your Future?</a></strong></li><li><a href="https://jasonformat.com/islands-architecture/" target="_blank" rel="noopener">Islands Architecture</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;æœ¬æ–‡ä¸»è¦å‚è€ƒçš„å†…å®¹æ¥æºæ˜¯&lt;a href=&quot;https://www.patterns.dev/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;patterns.dev&lt;/a&gt;ã€‚è¿™ä¸ªç½‘ç«™æ”¶å½•äº†è®¸å¤šå®ç”¨çš„å‰ç«¯è®¾è®¡æ¨¡å¼ï¼Œå¤§å®¶èµ¶ç´§æ”¶è—èµ·æ¥ï¼
      
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://bobi.ink/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>å²›å±¿æ¶æ„</title>
    <link href="https://bobi.ink/2023/06/01/island-pattern/"/>
    <id>https://bobi.ink/2023/06/01/island-pattern/</id>
    <published>2023-05-31T16:00:00.000Z</published>
    <updated>2023-06-01T10:07:58.113Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://images.unsplash.com/photo-1516091877740-fde016699f2c?ixlib=rb-4.0.3&amp;q=85&amp;fm=jpg&amp;crop=entropy&amp;cs=srgb&amp;w=6000" alt="https://images.unsplash.com/photo-1516091877740-fde016699f2c?ixlib=rb-4.0.3&amp;q=85&amp;fm=jpg&amp;crop=entropy&amp;cs=srgb&amp;w=6000"></p><p>å¥½ä¹…æ²¡è·Ÿå¤§å®¶è§é¢äº†ã€‚è¿™ä¸¤ä¸‰å¹´ä¸€ç›´ä¸“æ³¨äºå…¬å¸çš„å¼€å‘å·¥ä½œï¼Œåšäº†å¾ˆå¤šäº‹æƒ…ï¼Œä½†å›å¤´çœ‹çœ‹ï¼Œæ„Ÿè§‰è¿™ä¸¤å¹´ä¸€ç›´åœ¨åƒ â€™è€æœ¬â€˜ï¼Œå‰ç«¯ç›¸å…³çš„æŠ€æœ¯ä¹Ÿæ²¡æ€ä¹ˆè¿½äº†ã€‚</p><p>ç°åœ¨é‡æ–°æ¡èµ·ç¬”å§ï¼è¡¥è¡¥è¯¾ï¼Œè®°å½•ä¸€äº›æœ€è¿‘å­¦åˆ°çš„æ–°ä¸œè¥¿ï¼Œä»¥åŠè¿‡å»å‡ å¹´æ€»ç»“ã€‚</p><p>é¦–å…ˆä»å²›å±¿æ¶æ„å¼€å§‹å§ã€‚</p><h2 id="å²›å±¿æ¶æ„"><a href="#å²›å±¿æ¶æ„" class="headerlink" title="å²›å±¿æ¶æ„"></a>å²›å±¿æ¶æ„</h2><p>å²›å±¿æ¶æ„(<a href="https://www.patterns.dev/posts/islands-architecture" target="_blank" rel="noopener">Islands Architecture</a>) å¦‚ä»Šå·²ç»ä¸æ˜¯æ–°é²œçš„æ¦‚å¿µäº†ï¼Œç¤¾åŒºä¸Šå·²ç»æœ‰äº†è¾ƒå¤šæˆç†Ÿçš„æ–¹æ¡ˆã€‚</p><p>æ¦‚è§ˆå›¾ï¼š</p><p><img src="/images/island-pattern/Untitled.png" alt="Untitled"></p><p><br><br><br><br><br></p><p>è¿™å…¶ä¸­çš„å…¸å‹ä»£è¡¨æ˜¯ <a href="https://docs.astro.build/zh-cn/concepts/islands/" target="_blank" rel="noopener">Astro</a>ã€‚Astro å¯¹å²›å±¿æ¶æ„çš„è§£é‡Šï¼Œä¹Ÿéå¸¸ç›´è§‚ï¼š</p><blockquote><p>â€œAstro ç¾¤å²›â€œæŒ‡çš„æ˜¯<code>é™æ€ HTML</code> ä¸­çš„<code>äº¤äº’æ€§çš„ UI ç»„ä»¶</code>ã€‚ä¸€ä¸ªé¡µé¢ä¸Šå¯ä»¥æœ‰å¤šä¸ªå²›å±¿ï¼Œå¹¶ä¸”æ¯ä¸ªå²›å±¿éƒ½è¢«<code>ç‹¬ç«‹å‘ˆç°</code>ã€‚<strong>ä½ å¯ä»¥å°†å®ƒä»¬æƒ³è±¡æˆåœ¨ä¸€ç‰‡ç”±é™æ€ï¼ˆä¸å¯äº¤äº’ï¼‰çš„ HTML é¡µé¢ä¸­çš„åŠ¨æ€å²›å±¿</strong>ã€‚</p></blockquote><p>ä»ä¸Šé¢è¿™å¥è¯çš„å®šä¹‰ä¸­å¯ä»¥æç‚¼ä¸€äº›è¦ç‚¹ï¼š</p><ul><li>é™æ€ HTMLã€‚</li><li>äº¤äº’æ€§çš„ UI ç»„ä»¶ã€‚</li><li>å¤šä¸ªå²›å±¿ï¼Œæ”¯æŒç‹¬ç«‹å‘ˆç°ã€‚</li></ul><p><br><br><br></p><p>ä¸ºäº†è§£æè¿™äº›è¦ç‚¹ï¼Œæˆ‘ä»¬è¿˜æ˜¯å¾—ç®€å•äº†è§£ä¸€ä¸‹ Astro è¿™ä¸ªæ¡†æ¶çš„ç‰¹æ€§ã€‚</p><p>Astro å®£ç§°è‡ªå·±æ˜¯ â€˜<strong><code>zero-JS frontend architecture</code></strong>â€™ï¼Œå³ Astro åœ¨æœåŠ¡ç«¯æ¸²æŸ“é™æ€ HTMLï¼Œå®¢æˆ·ç«¯ä¸­ä¸éœ€è¦åŠ è½½é¢å¤–çš„ JS å°±èƒ½å®Œæ•´å‘ˆç°å†…å®¹ã€‚</p><p><br><br><br><br><br><br><br></p><hr><p>å†™ä¸€ä¸ªç®€å• DEMO è¯•è¯•ï¼š</p><p>React ç»„ä»¶ï¼š</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import &#123; useState &#125; from &apos;react&apos;</span><br><span class="line"></span><br><span class="line">export const Counter = () =&gt; &#123;</span><br><span class="line">  const [count, setCount] = useState(0)</span><br><span class="line"></span><br><span class="line">  return &lt;div onClick=&#123;() =&gt; setCount((i) =&gt; i + 1)&#125;&gt;click me to increment: &#123;count&#125;&lt;/div&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Astro æ–‡ä»¶ï¼š</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">---</span><br><span class="line">import Layout from '../layouts/Layout.astro';</span><br><span class="line">import Card from '../components/Card.astro';</span><br><span class="line">import &#123; Counter &#125; from '../components/Counter';</span><br><span class="line">---</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">Layout</span> <span class="attr">title</span>=<span class="string">"Welcome to Astro."</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">main</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Counter</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span> <span class="attr">role</span>=<span class="string">"list"</span> <span class="attr">class</span>=<span class="string">"link-card-grid"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">Card</span></span></span><br><span class="line"><span class="tag">        <span class="attr">href</span>=<span class="string">"https://docs.astro.build/"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">title</span>=<span class="string">"Documentation"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">body</span>=<span class="string">"Learn how Astro works and explore the official API docs."</span></span></span><br><span class="line"><span class="tag">      /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">Card</span></span></span><br><span class="line"><span class="tag">        <span class="attr">href</span>=<span class="string">"https://astro.build/integrations/"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">title</span>=<span class="string">"Integrations"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">body</span>=<span class="string">"Supercharge your project with new frameworks and libraries."</span></span></span><br><span class="line"><span class="tag">      /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">main</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Layout</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">  ...;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™è¯­æ³•ï¼Œastro é›†å¤§å®¶ä¹‹æ‰€é•¿ï¼Œå¸å–äº† Vue SFC å’Œ React çš„ JSX, è¿˜æœ‰ MDXã€‚</p><p><img src="/images/island-pattern/Untitled%201.png" alt="Untitled"></p><p>è¿è¡Œåï¼Œ æœåŠ¡ç«¯ç›´å‡º HTMLï¼Œé™¤äº† HMR ï¼Œæ²¡æœ‰å¼•å…¥é¢å¤–çš„ JavaScriptã€‚çœŸ Zero JS!</p><p><br><br><br><br><br></p><hr><p>ç„¶è€Œï¼Œè¿™ä¸ªæœ‰åˆ«äºå…¸å‹çš„ SSR æ¡†æ¶ã€‚SSR ä¹Ÿæ˜¯åœ¨æœåŠ¡ç«¯æ¸²æŸ“å®Œæ•´ HTML æ ‘ï¼Œä½†æ˜¯åœ¨å®¢æˆ·ç«¯ä¾ç„¶éœ€è¦åŠ è½½å®Œæ•´çš„è§†å›¾æ¡†æ¶ä»£ç ï¼Œç„¶åè¿›è¡Œæ°´åˆ(Hydration)ï¼Œæ‰èƒ½è®©é¡µé¢å˜å¾—å¯äº¤äº’:</p><p><img src="/images/island-pattern/Untitled%202.png" alt="Untitled"></p><p>é‚£ Astro æ²¡æœ‰ JSï¼Œæ˜¾ç„¶æ˜¯æ— æ³•ä¸ç”¨æˆ·è¿›è¡ŒåŠ¨æ€äº¤äº’çš„ã€‚Astro çš„è§£å†³åŠæ³•å°±æ˜¯ <code>å²›å±¿æ¶æ„</code>, æˆ‘ä»¬åªéœ€å°†éœ€è¦åŠ¨æ€äº¤äº’çš„é¡µé¢æ¨¡å—å£°æ˜ä¸ºå²›å±¿ï¼Œå¦‚ä¸‹å›¾ï¼Œé¡µå¤´å’Œå›¾ç‰‡è½®æ’­å°±æ˜¯å¯äº¤äº’çš„å²›å±¿ã€‚</p><p><img src="/images/island-pattern/Untitled%203.png" width="400px"></p><p>æ¥æºï¼šastro æ–‡æ¡£</p><p><br><br><br><br><br><br><br></p><hr><p>ç°åœ¨å°† React ç»„ä»¶å£°æ˜ä¸ºå²›å±¿ï¼š</p><figure class="highlight diff"><table><tr><td class="code"><pre><span class="line"><span class="comment">---</span></span><br><span class="line">import Layout from '../layouts/Layout.astro';</span><br><span class="line">import Card from '../components/Card.astro';</span><br><span class="line">import &#123; Counter &#125; from '../components/Counter';</span><br><span class="line"><span class="comment">---</span></span><br><span class="line"></span><br><span class="line">&lt;Layout title="Welcome to Astro."&gt;</span><br><span class="line">  &lt;main&gt;</span><br><span class="line"><span class="deletion">-    &lt;Counter/&gt;</span></span><br><span class="line"><span class="addition">+    &lt;Counter client:load /&gt;</span></span><br><span class="line">    &lt;ul role="list" class="link-card-grid"&gt;</span><br><span class="line">      &lt;Card</span><br><span class="line">        href="https://docs.astro.build/"</span><br><span class="line">        title="Documentation"</span><br><span class="line">        body="Learn how Astro works and explore the official API docs."</span><br><span class="line">      /&gt;</span><br><span class="line">      &lt;Card</span><br><span class="line">        href="https://astro.build/integrations/"</span><br><span class="line">        title="Integrations"</span><br><span class="line">        body="Supercharge your project with new frameworks and libraries."</span><br><span class="line">      /&gt;</span><br><span class="line">    &lt;/ul&gt;</span><br><span class="line">  &lt;/main&gt;</span><br><span class="line">&lt;/Layout&gt;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬åªéœ€å°†å¯¹åº”çš„ React ç»„ä»¶åŠ ä¸Š <code>client:load</code> æŒ‡ä»¤ï¼ŒAstro å°±æ˜¯å°†å…¶è¯†åˆ«ä¸ºå²›å±¿ï¼Œè¯¥ React ç»„ä»¶çš„ä»£ç åŠå…¶ç›¸å…³ä¾èµ–ä¼šè¢«æ‰“åŒ…åˆ°ä¸€èµ·ï¼Œåœ¨å®¢æˆ·ç«¯ç«¯åŠ è½½å’Œæ°´åˆã€‚</p><p><img src="/images/island-pattern/Untitled%204.png" alt="Untitled"></p><p>ç°åœ¨æˆ‘ä»¬çš„ Counter ç»„ä»¶åœ¨å®¢æˆ·ç«¯å°±æ˜¯ä¸€ä¸ªå¯äº¤äº’çš„çŠ¶æ€äº†ã€‚Astro åŸºæœ¬ä¸Šæ²¡æœ‰ä»€ä¹ˆä¸Šæ‰‹é—¨æ§›ï¼Œå»ºè®®è¯»è€…è‡ªå·±ç©ä¸€ä¸‹ã€‚æœ‰æœºä¼šå†å±•å¼€è®²ä¸€ä¸‹å®ƒçš„å®ç°åŸç†ã€‚</p><hr><p><br><br><br><br><br></p><p>æœ‰äº†â€˜å²›å±¿â€™èµ‹èƒ½çš„ Astro æ¶æ„ï¼š</p><p><img src="/images/island-pattern/Untitled%205.png" alt="Untitled"></p><p>Astro åœ¨æœåŠ¡ç«¯æ¸²æŸ“å®Œæ•´çš„ HTML æ ‘ï¼Œç„¶ååœ¨å®¢æˆ·ç«¯ä¸­æŒ‰éœ€åŠ è½½å²›å±¿ä»£ç ï¼Œå¹¶è¿›è¡Œæ°´åˆã€‚çœ‹èµ·æ¥æœ‰ç‚¹åƒå¾®å‰ç«¯ã€æˆ–è€… iframe è¿™æ ·çš„æœºåˆ¶ã€‚</p><p>ç°åœ¨æ¥å›é¡¾ä¸€ä¸‹å¼€å¤´æåˆ°çš„ <code>â€˜è¦ç‚¹â€™</code>ï¼š</p><table><thead><tr><th></th><th>å²›å±¿æ¶æ„</th><th>SSR + CSR</th><th>CSR</th></tr></thead><tbody><tr><td>é™æ€ HTML</td><td>é™æ€ HTML ä¼˜å…ˆï¼Œæ—  JavaScript</td><td>æœåŠ¡ç«¯æ¸²æŸ“ HTML åˆå§‹å†…å®¹, åŒ…å«å®Œæ•´çš„å®¢æˆ·ç«¯å‰¯æœ¬</td><td>å®Œå…¨åœ¨å®¢æˆ·ç«¯åŠ è½½æ¸²æŸ“</td></tr><tr><td>äº¤äº’æ€§çš„ UI ç»„ä»¶</td><td>é»˜è®¤å®Œå…¨é™æ€ï¼Œé€šè¿‡å²›å±¿å±€éƒ¨å¢å¼ºå¯äº¤äº’æ€§</td><td>å…¨å±€å¯äº¤äº’</td><td>å…¨å±€å¯äº¤äº’</td></tr><tr><td>å¤šä¸ªå²›å±¿ï¼Œæ”¯æŒç‹¬ç«‹å‘ˆç°</td><td>å²›å±¿ä¹‹é—´äº’ç›¸ç‹¬ç«‹ï¼Œå¯ä»¥ç‹¬ç«‹åŠ è½½å’Œäº¤äº’</td><td>å®Œæ•´åŠ è½½ã€‚å¯ä»¥é€šè¿‡ä»£ç åˆ†å— + <a href="https://www.patterns.dev/posts/progressive-hydration" target="_blank" rel="noopener">https://www.patterns.dev/posts/progressive-hydration</a> å®ç°æŒ‰éœ€åŠ è½½</td><td>å®Œæ•´åŠ è½½ã€‚å¯ä»¥é€šè¿‡ä»£ç åˆ†å—å®ç°æŒ‰éœ€åŠ è½½</td></tr></tbody></table><p><br><br><br><br><br></p><h2 id="å²›å±¿æ¶æ„çš„ä¼˜åŠ¿"><a href="#å²›å±¿æ¶æ„çš„ä¼˜åŠ¿" class="headerlink" title="å²›å±¿æ¶æ„çš„ä¼˜åŠ¿"></a>å²›å±¿æ¶æ„çš„ä¼˜åŠ¿</h2><p>å²›å±¿æ¶æ„éå¸¸é€‚åˆ<code>ä»¥å†…å®¹ä¸ºä¸­å¿ƒ</code>çš„ç½‘ç«™ï¼Œæ¯”å¦‚åšå®¢ï¼Œæ–‡æ¡£ç½‘ç«™ï¼Œæ–°é—»ç½‘ç«™ç­‰ç­‰ã€‚åœ¨ Astro çš„å®šä½éå¸¸æ¸…æ™°ï¼Œå®ƒæŠŠç«™ç‚¹ç±»å‹åˆ†ä¸ºä¸¤ç§ï¼š</p><ul><li>å†…å®¹ä¸ºä¸­å¿ƒ â†’ ä¹Ÿç§°ä¸º ç½‘ç«™ â†’ Astro æ“…é•¿</li><li>äº¤äº’ä¸ºä¸­å¿ƒçš„ â†’ ä¹Ÿç§°ä¸º Web åº”ç”¨ç¨‹åº â†’ åº”è¯¥ä½¿ç”¨ Next.js æˆ–è€… Nuxt.js è¿™æ ·çš„æ¡†æ¶</li></ul><p>åœ¨å²›å±¿æ¶æ„æ“…é•¿çš„åœºæ™¯ä¸­ï¼ŒAstro ç»™å‡ºäº†æ¯”è¾ƒï¼š</p><ul><li><a href="https://twitter.com/t3dotgg/status/1437195415439360003" target="_blank" rel="noopener">Astro vs. SPA (Next.js)</a> - 94% less JavaScript</li><li><a href="https://twitter.com/jlengstorf/status/1442707241627385860?lang=en" target="_blank" rel="noopener">Astro vs. SPA (Next.js)</a> - 34% æ›´å¿«åœ°åŠ è½½</li><li><a href="https://vanntile.com/blog/next-to-astro" target="_blank" rel="noopener">Astro vs. SPA (Next.js)</a> â€“ 65% ç½‘ç»œä½¿ç”¨å‡å°‘</li><li><a href="https://www.youtube.com/watch?v=2ZEMb_H-LYE&amp;t=8163s" target="_blank" rel="noopener">Astro vs. SPA (Remix, SvelteKit)</a> - â€œè¿™ä»¤äººç½®ä¿¡çš„ Google Lighthouse åˆ†æ•°â€</li><li><a href="https://www.youtube.com/watch?v=2ZEMb_H-LYE&amp;t=8504s" target="_blank" rel="noopener">Astro vs. Qwik</a> - 43% æ›´å¿«çš„ TTI</li></ul><p><br><br><br><br><br></p><h1 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h1><p>å²›å±¿æ¶æ„æœ¬èº«æ¦‚å¿µå¹¶ä¸å¤æ‚ï¼Œæ˜¯å‰ç«¯æ¡†æ¶å’Œå·¥ç¨‹åŒ–å‘å±•çš„ä¸€ä¸ªé˜¶æ®µæ€§è´¨å˜ç»“æœã€‚</p><p>å‰åç«¯åˆ†ç¦»(åˆ†å·¥ä¸Š)è¿˜æ˜¯ä¸å˜çš„è¶‹åŠ¿ï¼Œç›¸æ¯”ä¼ ç»Ÿçš„ MPA ï¼Œå²›å±¿æ¶æ„æ›´åŠ ç°ä»£åŒ–ï¼Œæ‹¥æœ‰æ›´å¥½çš„å¼€å‘ä½“éªŒã€‚</p><p>ç›¸æ¯” SPAï¼Œå²›å±¿æ¶æ„åœ¨<code>ä»¥å†…å®¹ä¸ºä¸­å¿ƒ</code>çš„åœºæ™¯ä¸‹ï¼Œä¼˜åŠ¿ä¹Ÿéå¸¸æ˜æ˜¾ã€‚</p><p><br><br><br><br><br></p><h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><ul><li><a href="https://www.patterns.dev/posts/islands-architecture" target="_blank" rel="noopener">Islands Architecture</a></li><li><a href="https://jasonformat.com/islands-architecture/" target="_blank" rel="noopener">Islands Architecture</a></li><li><a href="https://www.youtube.com/watch?v=k-A2VfuUROg" target="_blank" rel="noopener">Rendering on the Web: Performance Implications of Application Architecture</a></li><li><a href="https://dev.to/this-is-learning/is-0kb-of-javascript-in-your-future-48og" target="_blank" rel="noopener">Is 0kb of JavaScript in your Future?</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;img src=&quot;https://images.unsplash.com/photo-1516091877740-fde016699f2c?ixlib=rb-4.0.3&amp;amp;q=85&amp;amp;fm=jpg&amp;amp;crop=entropy&amp;amp;cs=srgb&amp;am
      
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://bobi.ink/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>Electron ä½å»¶è¿Ÿè§†é¢‘æµæ’­æ”¾æ–¹æ¡ˆæ¢ç´¢</title>
    <link href="https://bobi.ink/2020/04/05/video-stream/"/>
    <id>https://bobi.ink/2020/04/05/video-stream/</id>
    <published>2020-04-04T16:00:00.000Z</published>
    <updated>2023-06-01T09:55:14.331Z</updated>
    
    <content type="html"><![CDATA[<p>å¥½ä¹…ä¸è§ï¼Œæ¥è¿‘å››ä¸ªæœˆæ²¡æ›´æ–°åšå®¢äº†! </p><p>å»å¹´<a href="https://juejin.im/post/5e0010866fb9a015fd69c645#comment" target="_blank" rel="noopener">æœ€åä¸€ç¯‡</a>æ–‡ç« ä»‹ç»äº†æˆ‘ä»¬çš„ Electron æ¡Œé¢å®¢æˆ·ç«¯çš„ä¸€äº›ä¼˜åŒ–æªæ–½ï¼Œè¿™ç¯‡æ–‡ç« ä¹Ÿè·Ÿæˆ‘ä»¬æ­£åœ¨å¼€å‘çš„ Electron å®¢æˆ·ç«¯æœ‰ä¸€å®šå…³ç³»ã€‚æœ€è¿‘æˆ‘ä»¬æ­£åœ¨é¢„ç ”åœ¨ Electron é¡µé¢ä¸­å®æ—¶æ’­æ”¾ä¼šè®®è§†é¢‘æµçš„æ–¹æ¡ˆã€‚</p><p><br></p><p><img src="/images/video-push/conf.jpeg" alt></p><p><br></p><p>è§†é¢‘ä¼šè®®ç•Œé¢æ˜¯æœ€åä¸€å—æ²¡æœ‰è¢« Web å–ä»£çš„é¡µé¢, å®ƒå®Œå…¨ç”¨åŸç”Ÿå¼€å‘çš„ï¼Œæ‰€ä»¥å¼€å‘æ•ˆç‡æ¯”è¾ƒä½ï¼Œæ¯”å¦‚è¦åšä¸€äº›åŠ¨ç”»æ•ˆæœå¼€å‘å¾ˆç—›è‹¦ï¼Œéš¾ä»¥å“åº”å¤šå˜çš„äº§å“éœ€æ±‚ã€‚æ‰€ä»¥æˆ‘ä»¬åœ¨æƒ³: <strong>èƒ½ä¸èƒ½å°† Web é¡µé¢ç«¯æ¥æ’­æ”¾åº•å±‚åº“ WebRTC æ¥æ”¶åˆ°çš„è§†é¢‘æµ</strong>? <strong>æˆ–è€…ä¸ºä»€ä¹ˆä¸ç›´æ¥é€šè¿‡æµè§ˆå™¨çš„ WebRTC API æ¥è¿›è¡Œé€šè®¯å‘¢</strong>ï¼Ÿ</p><p>å…ˆå›ç­”åè€…ï¼Œå› ä¸ºæˆ‘ä»¬è§†é¢‘ä¼šè®®è¿™å—çš„é€»è¾‘å¤„ç†ã€éŸ³è§†é¢‘å¤„ç†å·²ç»è¢«æŠ½å–æˆç‹¬ç«‹çš„ã€è·¨å¹³å°çš„æ¨¡å—ï¼Œç»Ÿä¸€è¿›è¡Œç»´æŠ¤ï¼›å¦å¤–æµè§ˆå™¨çš„ WebRTC API æä¾›çš„æ¥å£éå¸¸é«˜çº§ï¼Œå°±åƒä¸€ä¸ªé»‘ç›’ä¸€æ ·ï¼Œæ— æ³•å®šåˆ¶åŒ–ã€æ‰©å±•ï¼Œé‡åˆ°é—®é¢˜ä¹Ÿå¾ˆéš¾è¯Šæ–­å’Œå¤„ç†, å—é™äºæµè§ˆå™¨ã€‚æœ€å¤§çš„åŸå› è¿˜æ˜¯å˜åŠ¨æœ‰ç‚¹å¤§ï¼Œæ—¶é—´ä¸Šä¸å…è®¸ã€‚</p><p>å› æ­¤ç›®å‰åªèƒ½é€‰å‰è€…ï¼Œå³åº•å±‚åº“ç»™ Electron é¡µé¢æ¨é€è§†é¢‘æµï¼Œåœ¨é¡µé¢å®æ—¶æ’­æ”¾ã€‚ å†æ­¤ä¹‹å‰ï¼Œç¬”è€…å‡ ä¹æ²¡æœ‰æ¥è§¦è¿‡éŸ³è§†é¢‘å¼€å‘ï¼Œæˆ‘èƒ½æƒ³åˆ°çš„æ˜¯é€šè¿‡ç±»ä¼¼ç›´æ’­çš„æ–¹å¼ï¼Œåº•å±‚åº“ä½œä¸ºâ€ä¸»æ’­ç«¯â€, Web é¡µé¢ä½œä¸ºâ€è§‚ä¼—ç«¯â€ã€‚</p><p><img src="/images/video-push/overall.png" alt></p><p><br></p><p>å› ä¸ºè§†é¢‘æµåªæ˜¯åœ¨æœ¬åœ°è¿›è¡Œè½¬å‘ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦è€ƒè™‘å„ç§å¤æ‚çš„ç½‘ç»œæƒ…å†µã€å¸¦å®½é™åˆ¶ã€‚å”¯ä¸€çš„è¦æ±‚æ˜¯ä½å»¶è¿Ÿï¼Œä½èµ„æºæ¶ˆè€—ï¼š</p><ul><li>æˆ‘ä»¬è§†é¢‘ä¼šè®®è¯­éŸ³å’Œè§†é¢‘æ˜¯åˆ†ç¦»çš„ã€‚ åªæœ‰ä¸€è·¯æ··åˆè¯­éŸ³ï¼Œé€šè¿‡ SIP ä¼ è¾“ã€‚è€Œä¼šè®®è§†é¢‘åˆ™å¯èƒ½å­˜åœ¨å¤šè·¯ï¼Œä½¿ç”¨ WebRTC è¿›è¡Œä¼ è¾“ã€‚æˆ‘ä»¬ä¸éœ€è¦å¤„ç†è¯­éŸ³(ç”±åº•å±‚åº“ç›´æ¥æ’­æ”¾), è¿™å°±è¦æ±‚æˆ‘ä»¬çš„è§†é¢‘æ’­æ”¾å»¶è¿Ÿä¸èƒ½å¤ªé«˜, å‡ºç°è¯­éŸ³å’Œè§†é¢‘ä¸åŒæ­¥ã€‚</li><li>ä¸éœ€è¦è€ƒè™‘æµè§ˆå™¨å…¼å®¹æ€§ã€‚Electron æµè§ˆå™¨ç‰ˆæœ¬ä¸º Chrome 80</li><li>æœ¬åœ°è½¬å‘ï¼Œä¸éœ€è¦è€ƒè™‘ç½‘ç»œæƒ…å†µã€å¸¦å®½é™åˆ¶</li></ul><p><br><br><br></p><p><strong>æœ€è¿‘å› ä¸ºå·¥ä½œéœ€è¦æ‰æœ‰æœºä¼šæ¥è§¦åˆ°éŸ³è§†é¢‘ç›¸å…³çš„çŸ¥è¯†ï¼Œæˆ‘çŸ¥é“çš„åªæ˜¯çš®æ¯›ï¼Œæ‰€ä»¥æ–‡ç« è‚¯å®šå­˜åœ¨ä¸å°‘é—®é¢˜ï¼Œæ•¬è¯·æ–§æ­£</strong>ã€‚ä¸‹é¢ï¼Œè·Ÿç€éŸ³è§†é¢‘å°ç™½çš„æˆ‘ï¼Œä¸€èµ·æ¢ç´¢æ¢ç´¢æœ‰å“ªäº›æ–¹æ¡ˆã€‚</p><p><br><br><br></p><p><strong>ç›®å½•</strong></p><!-- TOC --><ul><li><a href="#â‘ -å…¸å‹çš„webç›´æ’­æ–¹æ¡ˆ">â‘  å…¸å‹çš„Webç›´æ’­æ–¹æ¡ˆ</a><ul><li><a href="#rtmp-æ¨æµ">RTMP æ¨æµ</a></li><li><a href="#rtmp-æ‹‰æµ">RTMP æ‹‰æµ</a></li><li><a href="#rtmp-ä½å»¶è¿Ÿä¼˜åŒ–">RTMP ä½å»¶è¿Ÿä¼˜åŒ–</a></li></ul></li><li><a href="#â‘¡-jsmpeg--broadwayjs">â‘¡ JSMpeg &amp; BroadwayJS</a><ul><li><a href="#relay-æœåŠ¡å™¨">Relay æœåŠ¡å™¨</a></li><li><a href="#æ¨é€">æ¨é€</a></li><li><a href="#è§†é¢‘æ’­æ”¾">è§†é¢‘æ’­æ”¾</a></li><li><a href="#å¤šè¿›ç¨‹ä¼˜åŒ–">å¤šè¿›ç¨‹ä¼˜åŒ–</a></li><li><a href="#ç®€å•è¯´ä¸€ä¸‹-broadwayjs">ç®€å•è¯´ä¸€ä¸‹ Broadway.js</a></li></ul></li><li><a href="#â‘¢-ç›´æ¥æ¸²æŸ“-yuv">â‘¢ ç›´æ¥æ¸²æŸ“ YUV</a></li><li><a href="#æ‰©å±•é˜…è¯»">æ‰©å±•é˜…è¯»</a></li></ul><!-- /TOC --><p><br><br><br></p><h2 id="â‘ -å…¸å‹çš„webç›´æ’­æ–¹æ¡ˆ"><a href="#â‘ -å…¸å‹çš„webç›´æ’­æ–¹æ¡ˆ" class="headerlink" title="â‘  å…¸å‹çš„Webç›´æ’­æ–¹æ¡ˆ"></a>â‘  å…¸å‹çš„Webç›´æ’­æ–¹æ¡ˆ</h2><p>Web ç›´æ’­æœ‰å¾ˆå¤šæ–¹æ¡ˆ(å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼š<a href="https://imweb.io/topic/5a542e43a192c3b460fce3a8" target="_blank" rel="noopener">ã€ŠWeb ç›´æ’­ï¼Œä½ éœ€è¦å…ˆçŸ¥é“è¿™äº›ã€‹</a>):</p><ul><li><strong>RTMP (Real Time Messaging Protocol)</strong> å±äº Adobeã€‚å»¶æ—¶ä½ï¼Œå®æ—¶æ€§è¾ƒå¥½ã€‚ä¸è¿‡æµè§ˆå™¨éœ€è¦å€ŸåŠ© Flash æ‰èƒ½æ’­æ”¾; ä½†æ˜¯æˆ‘ä»¬ä¹Ÿå¯ä»¥è½¬æ¢æˆ HTTP/Websocket æµå–‚ç»™ <a href="https://github.com/bilibili/flv.js/tree/master/docs" target="_blank" rel="noopener"><code>flv.js</code></a> å®ç°æ’­æ”¾ã€‚</li><li><strong>RTP (Real-time Transport Protocol)</strong> <a href="https://www.jianshu.com/p/17997567d828" target="_blank" rel="noopener">WebRTC åº•å±‚å°±åŸºäº RTP/RTCP</a>ã€‚å®æ—¶æ€§éå¸¸å¥½ï¼Œé€‚ç”¨äºè§†é¢‘ç›‘æ§ã€è§†é¢‘ä¼šè®®ã€IP ç”µè¯ã€‚</li><li><strong>HLS (Http Live Streaming)</strong> è‹¹æœæå‡ºçš„åŸºäº HTTP çš„æµåª’ä½“ä¼ è¾“åè®®ã€‚Safari æ”¯æŒè¾ƒå¥½ï¼Œé«˜ç‰ˆæœ¬ Chrome ä¹Ÿæ”¯æŒï¼Œä¹Ÿæœ‰ä¸€äº›æ¯”è¾ƒæˆç†Ÿçš„ç¬¬ä¸‰æ–¹æ–¹æ¡ˆã€‚</li></ul><p><br></p><p>HLS å»¶è¿Ÿå¤ªé«˜ï¼Œä¸ç¬¦åˆæˆ‘ä»¬çš„è¦æ±‚ï¼Œæ‰€ä»¥ä¸€å¼€å§‹å°±æ”¾å¼ƒäº†ã€‚æœäº†å¾ˆå¤šèµ„æ–™ï¼Œå¾ˆå¤šéƒ½æ˜¯ä»‹ç» RTMP çš„ï¼Œå¯è§ RTMP åœ¨å›½å†…é‡‡ç”¨æœ‰å¤šå¹¿æ³›, å› æ­¤æˆ‘ä»¬æ‰“ç®—è¯•è¯•:</p><p><br></p><p>é¦–å…ˆæ˜¯æ­å»º RMTP æœåŠ¡å™¨ï¼Œå¯ä»¥ç›´æ¥åŸºäº <a href="https://github.com/illuspas/Node-Media-Server" target="_blank" rel="noopener">Node-Media-Server</a>ï¼Œä»£ç å¾ˆç®€å•:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> NodeMediaServer = <span class="built_in">require</span>(<span class="string">'node-media-server'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> config = &#123;</span><br><span class="line">  <span class="comment">// RMTP æœåŠ¡å™¨, ç”¨äºRTMP æ¨æµå’Œæ‹‰æµ</span></span><br><span class="line">  rtmp: &#123;</span><br><span class="line">    port: <span class="number">1935</span>, <span class="comment">// 1935 æ˜¯RTMPçš„æ ‡å‡†ç«¯å£</span></span><br><span class="line">    chunk_size: <span class="number">0</span>,</span><br><span class="line">    gop_cache: <span class="literal">false</span>,</span><br><span class="line">    ping: <span class="number">30</span>,</span><br><span class="line">    ping_timeout: <span class="number">60</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// HTTP / WebSocket æµï¼Œæš´éœ²ç»™ flv.js</span></span><br><span class="line">  http: &#123;</span><br><span class="line">    port: <span class="number">8000</span>,</span><br><span class="line">    allow_origin: <span class="string">'*'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> nms = <span class="keyword">new</span> NodeMediaServer(config)</span><br><span class="line">nms.run()</span><br></pre></td></tr></table></figure><p><br><br><br></p><h3 id="rtmp-æ¨æµ"><a href="#rtmp-æ¨æµ" class="headerlink" title="RTMP æ¨æµ"></a>RTMP æ¨æµ</h3><p><a href="http://www.ffmpeg.org" target="_blank" rel="noopener"><code>ffmpeg</code></a> æ˜¯éŸ³è§†é¢‘å¼€å‘çš„å¿…å¤‡ç¥å™¨ï¼Œæœ¬æ–‡å°†é€šè¿‡å®ƒæ¥æ•è·æ‘„åƒå¤´ï¼Œè¿›è¡Œå„ç§è½¬æ¢å’Œå¤„ç†ï¼Œæœ€åè¿›è¡Œè§†é¢‘æµæ¨é€ã€‚ ä¸‹é¢çœ‹çœ‹æ€ä¹ˆç”¨ ffmpeg è¿›è¡Œ RTMP æ¨æµã€‚</p><p>é¦–å…ˆè¿›è¡Œè§†é¢‘é‡‡é›†ï¼Œä¸‹é¢å‘½ä»¤åˆ—ä¸¾æ‰€æœ‰æ”¯æŒçš„è®¾å¤‡ç±»å‹ï¼š</p><blockquote><p>æœ¬æ–‡çš„æ‰€æœ‰å‘½ä»¤éƒ½åœ¨ macOS ä¸‹é¢æ‰§è¡Œ, å…¶ä»–å¹³å°ç”¨æ³•å·®ä¸å¤šï¼Œè‡ªè¡Œæœç´¢</p></blockquote><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ffmpeg -devices</span></span><br><span class="line">Devices:</span><br><span class="line"> D. = Demuxing supported</span><br><span class="line"> .E = Muxing supported</span><br><span class="line"> --</span><br><span class="line"> D  avfoundation    AVFoundation input device</span><br><span class="line"> D  lavfi           Libavfilter virtual input device</span><br><span class="line">  E sdl,sdl2        SDL2 output device</span><br></pre></td></tr></table></figure><p><br></p><p><code>macOS</code> ä¸‹é€šå¸¸ä½¿ç”¨ <code>avfoundation</code> è¿›è¡Œè®¾å¤‡é‡‡é›†, ä¸‹é¢åˆ—ä¸¾å½“å‰ç»ˆç«¯æ‰€æœ‰æ”¯æŒçš„è¾“å…¥è®¾å¤‡:</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> fmpeg -f avfoundation -list_devices <span class="literal">true</span> -i <span class="string">""</span></span></span><br><span class="line">[AVFoundation input device @ 0x7f8487425400] AVFoundation video devices:</span><br><span class="line">[AVFoundation input device @ 0x7f8487425400] [0] FaceTime HD Camera</span><br><span class="line">[AVFoundation input device @ 0x7f8487425400] [1] Capture screen 0</span><br><span class="line">[AVFoundation input device @ 0x7f8487425400] AVFoundation audio devices:</span><br><span class="line">[AVFoundation input device @ 0x7f8487425400] [0] Built-in Microphone</span><br><span class="line">[AVFoundation input device @ 0x7f8487425400] [1] Boom2Device</span><br></pre></td></tr></table></figure><p><br></p><p>æˆ‘ä»¬å°†ä½¿ç”¨ <code>FaceTime HD Camera</code> è¿™ä¸ªè¾“å…¥è®¾å¤‡æ¥é‡‡é›†è§†é¢‘ï¼Œå¹¶æ¨é€ RTMP æµï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ffmpeg -f avfoundation -r 30 -i <span class="string">"FaceTime HD Camera"</span> -c:v libx264 -preset superfast -tune zerolatency -an -f flv rtmp://localhost/live/<span class="built_in">test</span></span></span><br></pre></td></tr></table></figure><p><br></p><p>ç¨å¾®è§£é‡Šä¸€ä¸‹ä¸Šé¢çš„å‘½ä»¤:</p><ul><li><code>-f avfoundation -r 30 -i &quot;FaceTime HD Camera&quot;</code> è¡¨ç¤ºä» <code>FaceTime HD Camera</code> ä¸­ä»¥ 30 fps çš„å¸§ç‡é‡‡é›†è§†é¢‘</li><li><code>-c:v libx264</code> è¾“å‡ºè§†é¢‘çš„ç¼–ç æ ¼å¼æ˜¯ H.264,  RTMP é€šå¸¸é‡‡ç”¨H.264 ç¼–ç </li><li><code>-f flv</code> æŒ‡çš„è§†é¢‘çš„å°åŒ…æ ¼å¼, RTMP ä¸€èˆ¬é‡‡ç”¨ flv å°åŒ…æ ¼å¼ã€‚</li><li><code>-an</code> å¿½ç•¥éŸ³é¢‘æµ</li><li><code>-preset superfast -tune zerolatency</code> H.264 çš„è½¬ç é¢„è®¾å‚æ•°å’Œè°ƒä¼˜å‚æ•°ã€‚ä¼šå½±å“è§†é¢‘è´¨é‡å’Œå‹ç¼©ç‡</li></ul><p><br></p><blockquote><p><strong>å°åŒ…æ ¼å¼(format)</strong>å’Œ<strong>ç¼–ç (codec)</strong>æ˜¯éŸ³è§†é¢‘å¼€å‘ä¸­æœ€åŸºç¡€çš„æ¦‚å¿µã€‚<br><br><br><strong>å°åŒ…æ ¼å¼</strong>: ç›¸å½“äºä¸€ç§å‚¨å­˜è§†é¢‘ä¿¡æ¯çš„å®¹å™¨ï¼Œå°†ç¼–ç å¥½çš„éŸ³é¢‘ã€è§†é¢‘ã€æˆ–è€…æ˜¯å­—å¹•ã€è„šæœ¬ä¹‹ç±»çš„æ–‡ä»¶æ ¹æ®ç›¸åº”çš„è§„èŒƒç»„åˆåœ¨ä¸€èµ·ï¼Œä»è€Œç”Ÿæˆä¸€ä¸ªå°è£…æ ¼å¼çš„æ–‡ä»¶ã€‚å¸¸è§çš„å°åŒ…æ ¼å¼æœ‰ aviã€mpegã€flvã€mov ç­‰<br><br><br><strong>ç¼–ç æ ¼å¼</strong>: ç¼–ç ä¸»è¦çš„ç›®çš„æ˜¯ä¸ºäº†å‹ç¼©ã€‚ä»è®¾å¤‡é‡‡é›†åˆ°çš„éŸ³è§†é¢‘æµç§°ä¸ºè£¸ç æµ(rawvideo æ ¼å¼, å³æ²¡æœ‰ç»è¿‡ç¼–ç å‹ç¼©å¤„ç†çš„æ•°æ®)ã€‚ä¸¾ä¾‹ï¼šä¸€ä¸ª 720pï¼Œ30fpsï¼Œ60min çš„ç”µå½±ï¼Œè£¸æµå¤§å°ä¸ºï¼š12Bx1280x720x30x60x100 = 1.9Tã€‚è¿™ä¸ç®¡åœ¨æ–‡ä»¶ç³»ç»Ÿä¸Šå­˜å‚¨ã€è¿˜æ˜¯åœ¨ç½‘ç»œä¸Šä¼ è¾“ï¼Œæˆæœ¬éƒ½å¤ªé«˜äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ç¼–ç å‹ç¼©ã€‚ H264 æ˜¯ç›®å‰æœ€å¸¸è§çš„ç¼–ç æ ¼å¼ä¹‹ä¸€ã€‚</p></blockquote><p><br><br><br></p><h3 id="rtmp-æ‹‰æµ"><a href="#rtmp-æ‹‰æµ" class="headerlink" title="RTMP æ‹‰æµ"></a>RTMP æ‹‰æµ</h3><p>æœ€ç®€å•çš„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <a href="http://www.ffmpeg.org/ffplay.html" target="_blank" rel="noopener"><code>ffplay</code></a> (ffmpeg æä¾›çš„å·¥å…·å¥—ä»¶ä¹‹ä¸€) æ’­æ”¾å™¨æ¥æµ‹è¯•æ¨æµå’Œæ‹‰æµæ˜¯å¦æ­£å¸¸:</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ffplay rtmp://localhost/live/<span class="built_in">test</span></span></span><br></pre></td></tr></table></figure><p><br></p><p>Flash å·²ç»è¿‡æ—¶ï¼Œ ä¸ºäº†åœ¨ Web é¡µé¢ä¸­å®ç° RTMP æµæ’­æ”¾ï¼Œæˆ‘ä»¬è¿˜è¦å€ŸåŠ© <a href="https://github.com/bilibili/flv.js" target="_blank" rel="noopener"><code>flv.js</code></a>ã€‚ flvjs ä¼°è®¡å¤§å®¶éƒ½å¾ˆç†Ÿæ‚‰(èŠ±è¾¹ï¼šå¦‚ä½•çœ‹å¾…å“”å“©å“”å“©çš„ flv.js ä½œè€…æœˆè–ªä¸åˆ° 5000 å…ƒï¼Ÿ)ï¼Œå®ƒæ˜¯ B ç«™å¼€æºçš„ flv æ’­æ”¾å™¨ã€‚æŒ‰ç…§å®˜æ–¹çš„ä»‹ç»ï¼š</p><blockquote><p>flv.js works by transmuxing FLV file stream into ISO BMFF (Fragmented MP4) segments, followed by feeding mp4 segments into an HTML5 <code>&lt;video&gt;</code> element through <code>Media Source Extensions API</code>.</p></blockquote><p><br></p><p>ä¸Šé¢æåˆ°ï¼Œflv(Flash Video) æ˜¯ä¸€ä¸ªè§†é¢‘å°åŒ…æ ¼å¼ï¼Œ<code>flvjs</code> åšçš„å°±æ˜¯<strong>æŠŠ flv è½¬æ¢æˆ Fragmented MP4(ISO BMFF) å°åŒ…æ ¼å¼</strong>ï¼Œç„¶åå–‚ç»™<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Media_Source_Extensions_API" target="_blank" rel="noopener">Media Source Extension API, MSE</a>, æ¥ç€æˆ‘ä»¬å°† MSE æŒ‚è½½åˆ° <code>&lt;video&gt;</code> å°±å¯ä»¥ç›´æ¥æ’­æ”¾äº†, å®ƒçš„æ¶æ„å¦‚ä¸‹:</p><p><br></p><p><img src="/images/video-push/flv-arch.png" alt></p><p><br><br><br></p><p>flvjs æ”¯æŒé€šè¿‡ HTTP Streamingã€ WebSocket æˆ–è€…è‡ªå®šä¹‰æ•°æ®æºç­‰å¤šç§å½¢å¼æ‹‰å–äºŒè¿›åˆ¶è§†é¢‘æµã€‚ä¸‹é¢ç¤ºä¾‹é€šè¿‡ flvjs æ¥æ‹‰å– <code>node-media-server</code> çš„è§†é¢‘æµ:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;script src=<span class="string">"https://cdn.bootcss.com/flv.js/1.5.0/flv.min.js"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line">&lt;video id=<span class="string">"video"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">video</span>&gt;</span></span></span><br><span class="line">&lt;button id=<span class="string">"play"</span>&gt;play&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">&lt;script&gt;</span></span><br><span class="line"><span class="regexp">  if (flvjs.isSupported()) &#123;</span></span><br><span class="line"><span class="regexp">    const videoElement = document.getElementById('video');</span></span><br><span class="line"><span class="regexp">    const play = document.getElementById('play');</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">    const flvPlayer = flvjs.createPlayer(</span></span><br><span class="line"><span class="regexp">      &#123;</span></span><br><span class="line"><span class="regexp">        type: 'flv',</span></span><br><span class="line"><span class="regexp">        isLive: true,</span></span><br><span class="line"><span class="regexp">        hasAudio: false,</span></span><br><span class="line"><span class="regexp">        url: 'ws:/</span><span class="regexp">/localhost:8000/</span>live/test.flv<span class="string">',</span></span><br><span class="line"><span class="string">      &#125;,</span></span><br><span class="line"><span class="string">      &#123;</span></span><br><span class="line"><span class="string">        enableStashBuffer: true,</span></span><br><span class="line"><span class="string">      &#125;,</span></span><br><span class="line"><span class="string">    );</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    flvPlayer.attachMediaElement(videoElement);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    play.onclick = () =&gt; &#123;</span></span><br><span class="line"><span class="string">      flvPlayer.load();</span></span><br><span class="line"><span class="string">      flvPlayer.play();</span></span><br><span class="line"><span class="string">    &#125;;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&lt;/script&gt;</span></span><br></pre></td></tr></table></figure><p><br></p><blockquote><p>å®Œæ•´ç¤ºä¾‹ä»£ç åœ¨<a href="https://github.com/ivan-94/video-push/tree/master/rtmp" target="_blank" rel="noopener">è¿™é‡Œ</a></p></blockquote><p><br><br><br></p><h3 id="rtmp-ä½å»¶è¿Ÿä¼˜åŒ–"><a href="#rtmp-ä½å»¶è¿Ÿä¼˜åŒ–" class="headerlink" title="RTMP ä½å»¶è¿Ÿä¼˜åŒ–"></a>RTMP ä½å»¶è¿Ÿä¼˜åŒ–</h3><p><strong>æ¨æµç«¯</strong></p><p><code>ffmpeg</code> æ¨æµç«¯å¯ä»¥é€šè¿‡ä¸€äº›æ§åˆ¶å‚æ•°æ¥é™ä½æ¨æµçš„å»¶è¿Ÿï¼Œä¸»è¦ä¼˜åŒ–æ–¹å‘æ˜¯æé«˜ç¼–ç çš„æ•ˆç‡ã€å‡å°‘ç¼“å†²å¤§å°ï¼Œå½“ç„¶æœ‰æ—¶å€™è¦ç‰ºç‰²ä¸€äº›ä»£ç è´¨é‡å’Œå¸¦å®½ã€‚ è¿™ç¯‡æ–‡ç«  <a href="https://blog.csdn.net/fireroll/article/details/51902018" target="_blank" rel="noopener">ffmpeg çš„è½¬ç å»¶æ—¶æµ‹è¯•ä¸è®¾ç½®ä¼˜åŒ–</a> æ€»ç»“äº†ä¸€äº›ä¼˜åŒ–æªæ–½å¯ä»¥å‚è€ƒä¸€ä¸‹:</p><ul><li>å…³é—­ sync-lookahead</li><li>é™ä½ rc-lookaheadï¼Œä½†åˆ«å°äº 10,é»˜è®¤æ˜¯-1</li><li>é™ä½ threads(æ¯”å¦‚ä» 12 é™åˆ° 6)</li><li>ç¦ç”¨ rc-lookahead</li><li>ç¦ç”¨ b-frames</li><li>ç¼©å° GOP</li><li>å¼€å¯ x264 çš„ -preset fast/faster/verfast/superfast/ultrafast å‚æ•°</li><li>ä½¿ç”¨-tune zerolatency å‚æ•°</li></ul><p><br></p><p><strong>node-media-server</strong></p><p>NMS ä¹Ÿå¯ä»¥é€šè¿‡é™ä½ç¼“å†²å¤§å°å’Œ<a href="https://github.com/ossrs/srs/wiki/v1_CN_LowLatency" target="_blank" rel="noopener">å…³é—­ GOP Cache</a> æ¥ä¼˜åŒ–å»¶è¿Ÿã€‚</p><p><br></p><p><strong>flvjs ç«¯</strong></p><p>flvjs å¯ä»¥å¼€å¯ <code>enableStashBuffer</code> æ¥æé«˜å®æ—¶æ€§ã€‚ å®é™…æµ‹è¯•ä¸­ï¼Œflvjs å¯èƒ½ä¼šå‡ºç°â€™ç´¯ç§¯å»¶è¿Ÿâ€™ç°è±¡ï¼Œå¯ä»¥é€šè¿‡<a href="https://github.com/bilibili/flv.js/issues/258" target="_blank" rel="noopener">æ‰‹åŠ¨ seek</a>æ¥çº æ­£ã€‚</p><p><br><br><br></p><p>ç»è¿‡ä¸€ç•ªæŠ˜è…¾ï¼Œä¼˜åŒ–åˆ°æœ€å¥½çš„å»¶è¿Ÿæ˜¯ 400msï¼Œå¾€ä¸‹å°±æŸæ‰‹æ— ç­–äº†(å¯¹è¿™å—ç†Ÿæ‚‰çš„åŒå­¦å¯ä»¥è¯·æ•™ä¸€ä¸‹)ã€‚è€Œä¸”åœ¨å¯¹æ¥åˆ°åº•å±‚åº“å®é™…æ¨é€æ—¶ï¼Œæ’­æ”¾æ•ˆæœå¹¶ä¸ç†æƒ³ï¼Œå‡ºç°å„ç§å¡é¡¿ã€å»¶è¿Ÿã€‚ç”±äºæ—¶é—´å’ŒçŸ¥è¯†æœ‰é™ï¼Œæˆ‘ä»¬å¾ˆéš¾å®šä½åˆ°å…·ä½“çš„é—®é¢˜åœ¨å“ªï¼Œ æ‰€ä»¥æˆ‘ä»¬æš‚æ—¶æ”¾å¼ƒäº†è¿™ä¸ªæ–¹æ¡ˆã€‚</p><p><br><br><br></p><h2 id="â‘¡-jsmpeg-amp-broadwayjs"><a href="#â‘¡-jsmpeg-amp-broadwayjs" class="headerlink" title="â‘¡ JSMpeg &amp; BroadwayJS"></a>â‘¡ JSMpeg &amp; BroadwayJS</h2><p>Jerry Qu å†™å¾— <a href="https://imququ.com/post/html5-live-player-2.html" target="_blank" rel="noopener">ã€ŠHTML5 è§†é¢‘ç›´æ’­ï¼ˆäºŒï¼‰ã€‹</a> ç»™äº†æˆ‘ä¸å°‘å¯å‘ï¼Œå¾—çŸ¥äº† <a href="https://github.com/phoboslab/jsmpeg" target="_blank" rel="noopener"><code>JSMpeg</code></a> å’Œ <a href="https://github.com/mbebenita/Broadway" target="_blank" rel="noopener"><code>Broadwayjs</code></a> è¿™äº›æ–¹æ¡ˆ</p><p><strong>è¿™ä¸¤ä¸ªåº“ä¸ä¾èµ–äºæµè§ˆå™¨çš„ video çš„æ’­æ”¾æœºåˆ¶ï¼Œä½¿ç”¨çº¯ JS/WASM å®ç°è§†é¢‘è§£ç å™¨ï¼Œç„¶åç›´æ¥é€šè¿‡ Canvas2d æˆ– WebGL ç»˜åˆ¶å‡ºæ¥</strong>ã€‚Broadwayjs ç›®å‰ä¸æ”¯æŒè¯­éŸ³ï¼ŒJSMpeg æ”¯æŒè¯­éŸ³(åŸºäº WebAudio)ã€‚</p><p><br></p><p>ç»è¿‡ç®€å•çš„æµ‹è¯•, ç›¸æ¯” RTMPï¼Œ JSMpeg å’Œ BroadwayJS å»¶è¿Ÿéƒ½éå¸¸ä½ï¼ŒåŸºæœ¬ç¬¦åˆæˆ‘ä»¬çš„è¦æ±‚ã€‚ä¸‹é¢ç®€å•ä»‹ç»ä¸€ä¸‹ JSMpeg ç”¨æ³•ã€‚Broadwayjs ç”¨æ³•å·®ä¸å¤š, ä¸‹æ–‡ä¼šç®€å•å¸¦è¿‡ã€‚å®ƒä»¬çš„åŸºæœ¬å¤„ç†è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><p><br></p><p><img src="/images/video-push/jsmpeg.png" alt></p><p><br></p><h3 id="relay-æœåŠ¡å™¨"><a href="#relay-æœåŠ¡å™¨" class="headerlink" title="Relay æœåŠ¡å™¨"></a>Relay æœåŠ¡å™¨</h3><p>å› ä¸º ffmpeg æ— æ³•å‘ Web ç›´æ¥æ¨æµï¼Œå› æ­¤æˆ‘ä»¬è¿˜æ˜¯éœ€è¦åˆ›å»ºä¸€ä¸ªä¸­è½¬ï¼ˆrelayï¼‰æœåŠ¡å™¨æ¥æ¥æ”¶è§†é¢‘æ¨æµï¼Œå†é€šè¿‡ WebSocket è½¬å‘ç»™é¡µé¢æ’­æ”¾å™¨ã€‚</p><p>ffmpeg æ”¯æŒ HTTPã€TCPã€UDP ç­‰å„ç§æ¨æµæ–¹å¼ã€‚HTTP æ¨æµæ›´æ–¹ä¾¿æˆ‘ä»¬å¤„ç†, å› ä¸ºæ˜¯æœ¬åœ°ç¯å¢ƒï¼Œè¿™äº›ç½‘ç»œåè®®ä¸ä¼šæœ‰æ˜æ˜¾çš„æ€§èƒ½å·®åˆ«ã€‚</p><p>ä¸‹é¢åˆ›å»ºä¸€ä¸ª HTTP æœåŠ¡å™¨æ¥æ¥æ”¶æ¨æµï¼Œæ¨é€è·¯å¾„æ˜¯ <code>/push/:id</code>:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">this</span>.server = http</span><br><span class="line">  .createServer(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> url = req.url || <span class="string">'/'</span></span><br><span class="line">    <span class="keyword">if</span> (!url.startsWith(<span class="string">'/push/'</span>)) &#123;</span><br><span class="line">      res.statusCode = <span class="number">404</span></span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> id = url.slice(<span class="number">6</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç¦æ­¢è¶…æ—¶</span></span><br><span class="line">    res.connection.setTimeout(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è½¬å‘å‡ºå»</span></span><br><span class="line">    req.on(<span class="string">'data'</span>, (c) =&gt; &#123;</span><br><span class="line">      <span class="keyword">this</span>.broadcast(id, c)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    req.on(<span class="string">'end'</span>, () =&gt; &#123;</span><br><span class="line">      <span class="comment">/* ... */</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">  .listen(port)</span><br></pre></td></tr></table></figure><p><br><br><br></p><p>æ¥ç€é€šè¿‡ <code>WebSocket</code> å°†æµè½¬å‘å‡ºå», é¡µé¢å¯ä»¥é€šè¿‡ <code>ws://localhost:PORT/pull/{id}</code> æ‹‰å–è§†é¢‘æµ:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä½¿ç”¨ webSocket æ‹‰å–æµ</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">this</span>.wss = <span class="keyword">new</span> ws.Server(&#123;</span><br><span class="line">  server: <span class="keyword">this</span>.server,</span><br><span class="line">  <span class="comment">// é€šè¿‡ /pull/&#123;id&#125; æ‹‰æµ</span></span><br><span class="line">  verifyClient: <span class="function">(<span class="params">info, cb</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (info.req.url &amp;&amp; info.req.url.startsWith(<span class="string">'/pull'</span>)) &#123;</span><br><span class="line">      cb(<span class="literal">true</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      cb(<span class="literal">false</span>, <span class="literal">undefined</span>, <span class="string">''</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">this</span>.wss.on(<span class="string">'connection'</span>, (client, req) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> url = req.url</span><br><span class="line">  <span class="keyword">const</span> id = url.slice(<span class="number">6</span>)</span><br><span class="line"></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;prefix&#125;</span>new player attached: <span class="subst">$&#123;id&#125;</span>`</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> buzy = <span class="literal">false</span></span><br><span class="line">  <span class="keyword">const</span> listener = &#123;</span><br><span class="line">    id,</span><br><span class="line">    onMessage: <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// æ¨é€</span></span><br><span class="line">      <span class="keyword">if</span> (buzy) &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      buzy = <span class="literal">true</span></span><br><span class="line">      client.send(data, &#123; <span class="attr">binary</span>: <span class="literal">true</span> &#125;, <span class="function"><span class="keyword">function</span> <span class="title">ack</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        buzy = <span class="literal">false</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">this</span>.attachListener(listener)</span><br><span class="line"></span><br><span class="line">  client.on(<span class="string">'close'</span>, () =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;prefix&#125;</span> player dettached: <span class="subst">$&#123;id&#125;</span>`</span>)</span><br><span class="line">    <span class="keyword">this</span>.detachListener(listener)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><br><br><br></p><h3 id="æ¨é€"><a href="#æ¨é€" class="headerlink" title="æ¨é€"></a>æ¨é€</h3><p>è¿™é‡ŒåŒæ ·ä½¿ç”¨ ffmpeg ä½œä¸ºæ¨é€ç¤ºä¾‹:</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ffmpeg -f avfoundation -r 30 -i <span class="string">"FaceTime HD Camera"</span> -f mpegts -codec:v mpeg1video -an  -bf 0 -b:v 1500k -maxrate 2500k http://localhost:9999/push/<span class="built_in">test</span></span></span><br></pre></td></tr></table></figure><p>ç¨å¾®è§£é‡Šä¸€ä¸‹ ffmpeg å‘½ä»¤</p><ul><li><code>-f mpegts -codec:v mpeg1video -an</code> æŒ‡å®šä½¿ç”¨ MPEG-TS å°åŒ…æ ¼å¼ï¼Œ å¹¶ä½¿ç”¨ mpeg1 è§†é¢‘ç¼–ç ï¼Œå¿½ç•¥éŸ³é¢‘</li><li><code>-bf 0</code> JSMpeg è§£ç å™¨æš‚æ—¶ä¸èƒ½æ­£ç¡®åœ°å¤„ç† B å¸§ã€‚æ‰€ä»¥è¿™äº›å°† B å¸§ç¦ç”¨ã€‚å…³äºä»€ä¹ˆæ˜¯ I/B/P å¸§, å‚è€ƒè¿™ç¯‡<a href="https://www.jianshu.com/p/b3d1004229db" target="_blank" rel="noopener">æ–‡ç« </a></li><li><code>-b:v 1500k -maxrate 2500k</code> è®¾ç½®æ¨æµçš„å¹³å‡ç ç‡å’Œæœ€å¤§ç ç‡ã€‚ç»è¿‡æµ‹è¯•ï¼ŒJSMpeg ç ç‡è¿‡é«˜å®¹æ˜“å‡ºç°èŠ±å±å’Œæ•°ç»„è¶Šç•Œå´©æºƒã€‚</li></ul><p>å¦å¤– JSMpeg è¿˜è¦æ±‚ï¼Œè§†é¢‘çš„å®½åº¦å¿…é¡»æ˜¯ 2 çš„å€æ•°ã€‚ffmpeg å¯ä»¥é€šè¿‡æ»¤é•œ(filter)æˆ–è®¾ç½®è§†é¢‘å°ºå¯¸(-s)æ¥è§£å†³è¿™ä¸ªé—®é¢˜, ä¸è¿‡å¤šä½™è½¬æ¢éƒ½è¦æ¶ˆè€—ä¸€å®š CPU èµ„æºçš„ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ffmpeg -i in.mp4 -f mpeg1video -vf "crop=iw-mod(iw\,2):ih-mod(ih\,2)" -bf 0 out.mpg</span><br></pre></td></tr></table></figure><p><br><br><br></p><h3 id="è§†é¢‘æ’­æ”¾"><a href="#è§†é¢‘æ’­æ”¾" class="headerlink" title="è§†é¢‘æ’­æ”¾"></a>è§†é¢‘æ’­æ”¾</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">"video-canvas"</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"jsmpeg.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> canvas = <span class="built_in">document</span>.getElementById(<span class="string">'video-canvas'</span>)</span></span><br><span class="line"><span class="javascript">  <span class="keyword">const</span> url = <span class="string">'ws://localhost:9999/pull/test'</span></span></span><br><span class="line"><span class="javascript">  <span class="keyword">var</span> player = <span class="keyword">new</span> JSMpeg.Player(url, &#123;</span></span><br><span class="line"><span class="undefined">    canvas: canvas,</span></span><br><span class="line"><span class="javascript">    audio: <span class="literal">false</span>,</span></span><br><span class="line"><span class="javascript">    pauseWhenHidden: <span class="literal">false</span>,</span></span><br><span class="line"><span class="undefined">    videoBufferSize: 8 * 1024 * 1024,</span></span><br><span class="line"><span class="undefined">  &#125;)</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>API å¾ˆç®€å•ï¼Œä¸Šé¢æˆ‘ä»¬ä¼ é€’ä¸€ä¸ªç”»å¸ƒç»™ JSMpegï¼Œç¦ç”¨äº† Audio, å¹¶è®¾ç½®äº†ä¸€ä¸ªè¾ƒå¤§çš„ç¼“å†²åŒºå¤§å°, æ¥åº”å¯¹ä¸€äº›ç ç‡æ³¢åŠ¨ã€‚</p><p><br></p><blockquote><p>å®Œæ•´ä»£ç è§<a href="https://github.com/ivan-94/video-push/tree/master/jsmpeg" target="_blank" rel="noopener">è¿™é‡Œ</a></p></blockquote><p><br><br><br></p><h3 id="å¤šè¿›ç¨‹ä¼˜åŒ–"><a href="#å¤šè¿›ç¨‹ä¼˜åŒ–" class="headerlink" title="å¤šè¿›ç¨‹ä¼˜åŒ–"></a>å¤šè¿›ç¨‹ä¼˜åŒ–</h3><p>å®é™…æµ‹è¯•ä¸‹æ¥ï¼ŒJSMpeg è§†é¢‘å»¶è¿Ÿåœ¨ 100ms - 200ms ä¹‹é—´ã€‚å½“ç„¶è¿™è¿˜å–å†³äºè§†é¢‘çš„è´¨é‡ã€ç»ˆç«¯çš„æ€§èƒ½ç­‰å› ç´ ã€‚</p><p>å—é™äºç»ˆç«¯æ€§èƒ½ä»¥åŠè§£ç å™¨æ•ˆç‡, å¯¹äºå¹³å‡ç ç‡(ç¬”è€…ç²—ç•¥æµ‹è¯•å¤§æ¦‚ä¸º 2000k)è¾ƒé«˜çš„è§†é¢‘æµï¼ŒJSMpeg æœ‰å¾ˆå¤§æ¦‚ç‡ä¼šå‡ºç°èŠ±å±æˆ–è€…å†…å­˜è®¿é—®è¶Šç•Œé—®é¢˜(memory access out of bounds)ã€‚</p><p><img src="/images/video-push/jsmpeg-problems.png" alt></p><p><br></p><p>å› æ­¤æˆ‘ä»¬ä¸å¾—ä¸é€šè¿‡å‹ç¼©è§†é¢‘çš„è´¨é‡ã€é™ä½è§†é¢‘åˆ†è¾¨ç‡ç­‰æ‰‹æ®µæ¥é™ä½è§†é¢‘ç ç‡ã€‚ç„¶è€Œè¿™å¹¶ä¸èƒ½æ ¹æœ¬è§£å†³é—®é¢˜ï¼Œè¿™æ˜¯ä½¿ç”¨ JSMpeg çš„ç—›ç‚¹ä¹‹ä¸€ã€‚è¯¦è§<a href="https://github.com/phoboslab/jsmpeg#performance-considerations" target="_blank" rel="noopener">JSMpeg çš„æ€§èƒ½è¯´æ˜</a></p><p><br></p><p>å› ä¸ºè§£ç æœ¬èº«æ˜¯ä¸€ä¸ª CPU å¯†é›†å‹çš„æ“ä½œï¼Œä¸”ç”±æµè§ˆå™¨æ¥æ‰§è¡Œï¼ŒCPU å ç”¨è¿˜æ˜¯æŒºé«˜çš„(ç¬”è€…æœºå™¨å•ä¸ªé¡µé¢å•ä¸ªæ’­æ”¾å™¨, CPU å ç”¨ç‡åœ¨ 16%å·¦å³)ï¼Œè€Œä¸” JSMpeg æ’­æ”¾å™¨ä¸€æ—¦å¼‚å¸¸å´©æºƒä¼šéš¾ä»¥æ¢å¤ã€‚</p><p>åœ¨æˆ‘ä»¬çš„å®é™…åº”ç”¨åœºæ™¯ä¸­ï¼Œä¸€ä¸ªé¡µé¢å¯èƒ½ä¼šæ’­æ”¾å¤šè·¯è§†é¢‘, å¦‚æœæ‰€æœ‰è§†é¢‘éƒ½åœ¨æµè§ˆå™¨ä¸»è¿›ç¨‹ä¸­è¿›è¡Œè§£ç æ¸²æŸ“ï¼Œé¡µé¢æ“ä½œä½“éªŒä¼šå¾ˆå·®ã€‚ æ‰€ä»¥æœ€å¥½æ˜¯å°† JSMpeg åˆ†ç¦»åˆ° Worker ä¸­, <strong>ä¸€æ¥ä¿è¯ä¸»è¿›ç¨‹å¯ä»¥å“åº”ç”¨æˆ·çš„äº¤äº’ï¼ŒäºŒæ¥ JSMpeg å´©æºƒä¸ä¼šè¿ç´¯ä¸»è¿›ç¨‹</strong>ã€‚</p><p>å¥½åœ¨å°† JSMpeg æ”¾åœ¨ Worker ä¸­æ‰§è¡Œå®¹æ˜“: Worker ä¸­æ”¯æŒç‹¬ç«‹ WebSocket è¯·æ±‚ï¼Œå¦å¤– Canvas é€šè¿‡ <code>transferControlToOffscreen()</code> æ–¹æ³•åˆ›å»º <code>OffscreenCanvas</code> å¯¹è±¡å¹¶ä¼ é€’ç»™ Workerï¼Œå®ç° canvas ç¦»å±æ¸²æŸ“ã€‚</p><p>å…ˆæ¥çœ‹çœ‹ <code>worker.js</code>, å’Œä¸Šé¢çš„ä»£ç å·®ä¸å¤šï¼Œä¸»è¦æ˜¯æ–°å¢äº† worker é€šè®¯:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">importScripts(<span class="string">'./jsmpeg.js'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">this</span>.window = <span class="keyword">this</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">this</span>.addEventListener(<span class="string">'message'</span>, (evt) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> data = evt.data</span><br><span class="line"></span><br><span class="line">  <span class="keyword">switch</span> (data.type) &#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºæ’­æ”¾å™¨</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">'create'</span>:</span><br><span class="line">      <span class="keyword">const</span> &#123; url, canvas, ...config &#125; = data.data</span><br><span class="line">      <span class="keyword">this</span>.id = url</span><br><span class="line">      <span class="keyword">this</span>.player = <span class="keyword">new</span> JSMpeg.Player(url, &#123;</span><br><span class="line">        canvas,</span><br><span class="line">        audio: <span class="literal">false</span>,</span><br><span class="line">        pauseWhenHidden: <span class="literal">false</span>,</span><br><span class="line">        videoBufferSize: <span class="number">10</span> * <span class="number">1024</span> * <span class="number">1024</span>,</span><br><span class="line">        ...config,</span><br><span class="line">      &#125;)</span><br><span class="line"></span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// é”€æ¯æ’­æ”¾å™¨</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">'destroy'</span>:</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.player) &#123;</span><br><span class="line">          <span class="keyword">this</span>.player.destroy()</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.postMessage(&#123; <span class="attr">type</span>: <span class="string">'destroyed'</span> &#125;)</span><br><span class="line">      &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(LOGGER_FREFIX + <span class="string">'é”€æ¯å¤±è´¥: '</span>, global.id, err)</span><br><span class="line">        <span class="keyword">this</span>.postMessage(&#123;</span><br><span class="line">          type: <span class="string">'fatal'</span>,</span><br><span class="line">          data: err,</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°±ç»ª</span></span><br><span class="line"><span class="keyword">this</span>.postMessage(&#123; <span class="attr">type</span>: <span class="string">'ready'</span>, <span class="attr">data</span>: &#123;&#125; &#125;)</span><br></pre></td></tr></table></figure><p><br><br><br></p><p>å†æ¥çœ‹çœ‹ä¸»è¿›ç¨‹, é€šè¿‡ <code>transferControlToOffscreen()</code> ç”Ÿæˆç¦»å±æ¸²æŸ“ç”»å¸ƒï¼Œè®© JSMpeg å¯ä»¥æ— ç¼è¿ç§»åˆ° Worker:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> video = <span class="built_in">document</span>.getElementById(<span class="string">'video'</span>)</span><br><span class="line"><span class="keyword">const</span> wk = <span class="keyword">new</span> Worker(<span class="string">'./jsmpeg.worker.js'</span>)</span><br><span class="line"></span><br><span class="line">wk.onmessage = <span class="function">(<span class="params">evt</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> data = evt.data</span><br><span class="line">  <span class="keyword">switch</span> (data.type) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'ready'</span>:</span><br><span class="line">      <span class="comment">// åˆ›å»º OffscreenCanvas å¯¹è±¡</span></span><br><span class="line">      <span class="keyword">const</span> oc = video.transferControlToOffscreen()</span><br><span class="line"></span><br><span class="line">      wk.postMessage(</span><br><span class="line">        &#123;</span><br><span class="line">          type: <span class="string">'create'</span>,</span><br><span class="line">          data: &#123;</span><br><span class="line">            canvas: oc,</span><br><span class="line">            url: <span class="string">'ws://localhost:9999/pull/test'</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">        [oc] <span class="comment">// æ³¨æ„è¿™é‡Œ</span></span><br><span class="line">      )</span><br><span class="line"></span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br><br><br></p><h3 id="ç®€å•è¯´ä¸€ä¸‹-broadway-js"><a href="#ç®€å•è¯´ä¸€ä¸‹-broadway-js" class="headerlink" title="ç®€å•è¯´ä¸€ä¸‹ Broadway.js"></a>ç®€å•è¯´ä¸€ä¸‹ Broadway.js</h3><p>è¿˜æœ‰ä¸€ä¸ªç±»ä¼¼ JSMpeg çš„è§£å†³æ–¹æ¡ˆ â€”â€”â€”â€” <a href="https://github.com/mbebenita/Broadway" target="_blank" rel="noopener">Broadwayjs</a>ã€‚ å®ƒæ˜¯ä¸€ä¸ª <code>H.264</code> è§£ç å™¨, é€šè¿‡ <a href="https://github.com/emscripten-core/emscripten" target="_blank" rel="noopener"><code>Emscripten</code></a> å·¥å…·ä» Android çš„ H.264 è§£ç å™¨è½¬åŒ–è€Œæˆã€‚å®ƒæ”¯æŒæ¥æ”¶ H.264 è£¸æµï¼Œä¸è¿‡ä¹Ÿæœ‰ä¸€äº›é™åˆ¶ï¼šä¸æ”¯æŒ <a href="https://github.com/mbebenita/Broadway#encoding-video" target="_blank" rel="noopener"><code>weighted prediction for P-frames</code> &amp; <code>CABAC entropy encoding</code></a>ã€‚</p><p><br></p><p>æ¨é€ç¤ºä¾‹ï¼š</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ffmpeg -f avfoundation  -r 30 -i <span class="string">"FaceTime HD Camera"</span>  -f rawvideo -c:v libx264 -pix_fmt yuv420p -vprofile baseline -tune zerolatency -coder 0 -bf 0 -flags -loop -wpredp 0 -an  http://localhost:9999/push/<span class="built_in">test</span></span></span><br></pre></td></tr></table></figure><p><br><br><br></p><p>å®¢æˆ·ç«¯ç¤ºä¾‹ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> video = <span class="built_in">document</span>.getElementById(<span class="string">'video'</span>)</span><br><span class="line"><span class="keyword">const</span> url = <span class="string">`ws://localhost:9999/pull/test`</span></span><br><span class="line"><span class="keyword">const</span> player = <span class="keyword">new</span> Player(&#123;</span><br><span class="line">  canvas: video,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> ws = <span class="keyword">new</span> WebSocket(url)</span><br><span class="line">ws.binaryType = <span class="string">'arraybuffer'</span></span><br><span class="line"></span><br><span class="line">ws.onmessage = <span class="function"><span class="keyword">function</span> (<span class="params">evt</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> data = evt.data</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> data !== <span class="string">'string'</span>) &#123;</span><br><span class="line">    player.decode(<span class="keyword">new</span> <span class="built_in">Uint8Array</span>(data))</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'get command from server: '</span>, data)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å®Œæ•´ä»£ç çœ‹<a href="https://github.com/ivan-94/video-push/tree/master/broadway" target="_blank" rel="noopener">è¿™é‡Œ</a></p></blockquote><p>ç»è¿‡æµ‹è¯•ï¼ŒåŒç­‰è´¨é‡å’Œå°ºå¯¸çš„è§†é¢‘æµ JSMpeg å’Œ Broadway CPU æ¶ˆè€—å·®ä¸å¤šã€‚ä½†æ˜¯ Broadway è§†é¢‘æµä¸å—ç ç‡é™åˆ¶ï¼Œæ²¡æœ‰èŠ±å±å’Œå´©æºƒç°è±¡ã€‚å½“ç„¶, å¯¹äºé«˜è´¨é‡è§†é¢‘, ffmpeg è½¬æ¢å’Œ Broadway æ’­æ”¾, èµ„æºæ¶ˆè€—éƒ½éå¸¸æƒŠäººã€‚</p><p><br></p><p>å…¶ä»–ç±»ä¼¼çš„æ–¹æ¡ˆ:</p><ul><li><a href="https://github.com/ChihChengYang/wfs.js" target="_blank" rel="noopener">wfs</a> html5 player for raw h.264 streams.</li></ul><p><br><br><br></p><h2 id="â‘¢-ç›´æ¥æ¸²æŸ“-yuv"><a href="#â‘¢-ç›´æ¥æ¸²æŸ“-yuv" class="headerlink" title="â‘¢ ç›´æ¥æ¸²æŸ“ YUV"></a>â‘¢ ç›´æ¥æ¸²æŸ“ YUV</h2><p><strong>å›åˆ°æ–‡ç« å¼€å§‹ï¼Œå…¶å®åº•å±‚åº“ä» WebRTC ä¸­æ‹¿åˆ°çš„æ˜¯ YUV çš„åŸå§‹è§†é¢‘æµ, ä¹Ÿå°±æ˜¯æ²¡æœ‰ç»è¿‡ç¼–ç å‹ç¼©çš„ä¸€å¸§ä¸€å¸§çš„å›¾åƒã€‚ä¸Šæ–‡ä»‹ç»çš„æ–¹æ¡ˆéƒ½æœ‰é¢å¤–çš„è§£å°åŒ…ã€è§£ç¼–ç çš„è¿‡ç¨‹ï¼Œæœ€ç»ˆè¾“å‡ºçš„ä¹Ÿæ˜¯ YUV æ ¼å¼çš„è§†é¢‘å¸§ï¼Œå®ƒä»¬çš„æœ€åä¸€æ­¥éƒ½æ˜¯å°†è¿™äº› YUV æ ¼å¼è§†é¢‘å¸§è½¬æ¢æˆ RGB æ ¼å¼ï¼Œæ¸²æŸ“åˆ° Canvas ä¸­</strong>ã€‚</p><p><strong>é‚£èƒ½ä¸èƒ½å°†åŸå§‹çš„ YUV è§†é¢‘å¸§ç›´æ¥è½¬å‘è¿‡æ¥ï¼Œç›´æ¥åœ¨ Cavans ä¸Šæ¸²æŸ“ä¸å°±å¾—äº†</strong>ï¼Ÿ å°†å»æ‰ä¸­é—´çš„è§£ç¼–ç è¿‡ç¨‹, æ•ˆæœæ€æ ·ï¼Ÿè¯•ä¸€è¯•ã€‚</p><p><br></p><blockquote><p>æ­¤å‰å·²ç»æœ‰æ–‡ç« åšè¿‡è¿™æ–¹é¢çš„å°è¯•: <a href="https://juejin.im/post/5de29d7be51d455f9b335efa" target="_blank" rel="noopener">ã€ŠIVWEB ç©è½¬ WASM ç³»åˆ—-WEBGL YUV æ¸²æŸ“å›¾åƒå®è·µã€‹</a>ã€‚æˆ‘ä»¬å‚è€ƒå®ƒæä¸€ä¸ªã€‚</p></blockquote><p>è‡³äºä»€ä¹ˆæ˜¯ <code>YUV</code>ï¼Œæˆ‘å°±ä¸ç§‘æ™®, è‡ªè¡Œæœç´¢ã€‚ YUV å¸§çš„å¤§å°å¯ä»¥æ ¹æ®è¿™ä¸ªå…¬å¼è®¡ç®—å‡ºæ¥ï¼š <code>(width * height * 3) &gt;&gt; 1</code>,<br><strong>å³ <code>YUV420p</code> çš„æ¯ä¸ªåƒç´ å ç”¨ 1.5 bytes</strong>ã€‚</p><p>å› æ­¤æˆ‘ä»¬åªéœ€è¦çŸ¥é“è§†é¢‘çš„å¤§å°, å°±å¯ä»¥åˆ‡å‰²è§†é¢‘æµï¼Œå°†è§†é¢‘å¸§åˆ†ç¦»å‡ºæ¥äº†ã€‚ ä¸‹é¢æ–°å»ºä¸€ä¸ªä¸­è½¬æœåŠ¡å™¨æ¥æ¥æ”¶æ¨æµ, åœ¨è¿™é‡Œå°† YUV è£¸æµåˆ‡å‰²æˆä¸€å¸§ä¸€å¸§å›¾åƒæ•°æ®ï¼Œä¸‹å‘ç»™æµè§ˆå™¨ï¼š</p><p><br></p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">this</span>.server = http.createServer(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="keyword">const</span> parsed = <span class="keyword">new</span> URL(<span class="string">'http://host'</span> + url)</span><br><span class="line">  <span class="keyword">let</span> id = parsed.searchParams.get(<span class="string">'id'</span>),</span><br><span class="line">    width = parsed.searchParams.get(<span class="string">'width'</span>),</span><br><span class="line">    height = parsed.searchParams.get(<span class="string">'height'</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> nwidth = <span class="built_in">parseInt</span>(width)</span><br><span class="line">  <span class="keyword">const</span> nheight = <span class="built_in">parseInt</span>(height)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> frameSize = (nwidth * nheight * <span class="number">3</span>) &gt;&gt; <span class="number">1</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// æŒ‰ç…§å­—èŠ‚å¤§å°åˆ‡å‰²æµ</span></span><br><span class="line">  <span class="keyword">const</span> stream = req.pipe(<span class="keyword">new</span> Splitter(frameSize))</span><br><span class="line"></span><br><span class="line">  stream.on(<span class="string">'data'</span>, (c) =&gt; &#123;</span><br><span class="line">    <span class="keyword">this</span>.broadcast(id, c)</span><br><span class="line">  &#125;)</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><a href="https://github.com/ivan-94/video-push/blob/master/yuv/size-split.js" target="_blank" rel="noopener"><code>Splitter</code></a> æ ¹æ®å›ºå®šå­—èŠ‚å¤§å°åˆ‡å‰² Bufferã€‚ </p><p><br></p><p>å¦‚æœæ¸²æŸ“ YUV ï¼Ÿ å¯ä»¥å‚è€ƒ <a href="https://github.com/phoboslab/jsmpeg/blob/master/src/webgl.js" target="_blank" rel="noopener">JSMpeg WebGL æ¸²æŸ“å™¨</a>, <a href="https://github.com/mbebenita/Broadway/blob/master/Player/YUVCanvas.js" target="_blank" rel="noopener">Broadway.js WebGL æ¸²æŸ“å™¨</a>ã€‚ å…·ä½“å¦‚ä½•æ¸²æŸ“å°±ä¸å±•å¼€äº†ï¼Œ ä¸‹é¢ç›´æ¥å°† Broadway.js çš„ <a href="https://github.com/mbebenita/Broadway/blob/master/Player/YUVCanvas.js" target="_blank" rel="noopener"><code>YUVCanvas.js</code></a> ç›´æ¥æ‹¿è¿‡æ¥ç”¨ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> renderer = <span class="keyword">new</span> YUVCanvas(&#123;</span><br><span class="line">  canvas: video,</span><br><span class="line">  type: <span class="string">'yuv420'</span>,</span><br><span class="line">  width: width,</span><br><span class="line">  height: height,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// é€šè¿‡ WebSocket æ¥æ”¶ YUV å¸§. å¹¶æŠ½å–å‡º YUV åˆ†é‡</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">onData</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> ylen = width * height</span><br><span class="line">  <span class="keyword">const</span> uvlen = (width / <span class="number">2</span>) * (height / <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">  renderer.render(</span><br><span class="line">    buff.subarray(<span class="number">0</span>, ylen),</span><br><span class="line">    buff.subarray(ylen, ylen + uvlen),</span><br><span class="line">    buff.subarray(ylen + uvlen, ylen + uvlen + uvlen),</span><br><span class="line">    <span class="literal">true</span></span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br><br><br></p><blockquote><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼šJSMpeg å’Œ Broadway çš„ Canvas æ¸²æŸ“éƒ½è¦æ±‚è§†é¢‘çš„å®½åº¦å¿…é¡»æ˜¯ 8 çš„å€æ•°ã€‚ä¸ç¬¦åˆè¿™ä¸ªè¦æ±‚çš„ä¼šæŠ¥é”™ï¼Œ<a href="https://juejin.im/post/5de29d7be51d455f9b335efa" target="_blank" rel="noopener">ã€ŠIVWEB ç©è½¬ WASM ç³»åˆ—-WEBGL YUV æ¸²æŸ“å›¾åƒå®è·µã€‹</a> å¤„ç†äº†è¿™ä¸ªé—®é¢˜ã€‚</p></blockquote><p><br></p><p>æœ€åçœ‹çœ‹ ffmpeg æ¨é€ç¤ºä¾‹:</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ffmpeg -f avfoundation -r 30 -i <span class="string">"FaceTime HD Camera"</span> -f rawvideo -c:v rawvideo -pix_fmt yuv420p <span class="string">"http://localhost:9999/push?id=test&amp;width=320&amp;height=240"</span></span></span><br></pre></td></tr></table></figure><p><br></p><blockquote><p>å®Œæ•´ä»£ç çœ‹<a href="https://github.com/ivan-94/video-push/tree/master/yuv" target="_blank" rel="noopener">è¿™é‡Œ</a></p></blockquote><p><br><br><br></p><p>ä¸‹é¢çœ‹çœ‹ç®€å•èµ„æºæ¶ˆè€—å¯¹æ¯”ã€‚ ç¬”è€…è®¾å¤‡æ˜¯ 15 æ¬¾ Macboook pro, è§†é¢‘æºé‡‡é›†è‡ªæ‘„åƒå¤´ï¼Œåˆ†è¾¨ç‡ 320x240ã€åƒç´ æ ¼å¼ uyvy422ã€å¸§ç‡ 30ã€‚</p><p><em>ä¸‹è¡¨ <code>J</code> è¡¨ç¤º <code>JSMpeg</code>ã€<code>B</code> è¡¨ç¤º <code>Broadway</code>ã€<code>Y</code> è¡¨ç¤º <code>YUV</code></em></p><table><thead><tr><th></th><th>CPU (J/B/Y)</th><th>å†…å­˜ (J/B/Y)</th><th>å¹³å‡ç ç‡ (J/B/Y)</th></tr></thead><tbody><tr><td>ffmpeg</td><td>9% / 9% / 5%</td><td>12MB / 12MB / 9MB</td><td>1600k / 200k / 27000k</td></tr><tr><td>æœåŠ¡å™¨</td><td>0.6% / 0.6% /1.4%</td><td>18MB / 18MB / 42MB</td><td>N/A</td></tr><tr><td>æ’­æ”¾å™¨</td><td>16% / 13% / 8%</td><td>70MB / 200MB / 50MB</td><td>N/A</td></tr></tbody></table><p><br></p><p>ä»ç»“æœæ¥çœ‹ï¼Œç›´æ¥æ¸²æŸ“ YUV ç»¼åˆå ç”¨çš„èµ„æºæœ€å°‘ã€‚å› ä¸ºæ²¡æœ‰ç»è¿‡å‹ç¼©ï¼Œç ç‡ä¹Ÿæ˜¯éå¸¸é«˜çš„ï¼Œä¸è¿‡æœ¬åœ°ç¯å¢ƒä¸å—å¸¦å®½é™åˆ¶ï¼Œè¿™ä¸ªé—®é¢˜ä¹Ÿä¸å¤§ã€‚æˆ‘ä»¬è¿˜å¯ä»¥åˆ©ç”¨<code>requestAnimationFrame</code> ç”±æµè§ˆå™¨æ¥è°ƒåº¦æ’­æ”¾çš„é€Ÿç‡ï¼Œä¸¢æ‰ç§¯ç´¯çš„å¸§ï¼Œä¿æŒä½å»¶è¿Ÿæ’­æ”¾ã€‚</p><p><br><br><br></p><p>æœ¬æ–‡å®Œ</p><h2 id="æ‰©å±•é˜…è¯»"><a href="#æ‰©å±•é˜…è¯»" class="headerlink" title="æ‰©å±•é˜…è¯»"></a>æ‰©å±•é˜…è¯»</h2><ul><li><a href="https://juejin.im/post/5ab851b6f265da23826df601" target="_blank" rel="noopener">ç›´æ’­åŸç†ä¸ web ç›´æ’­å®æˆ˜</a></li><li><a href="https://juejin.im/post/5de29d7be51d455f9b335efa" target="_blank" rel="noopener">IVWEB ç©è½¬ WASM ç³»åˆ—-WEBGL YUV æ¸²æŸ“å›¾åƒå®è·µ</a></li><li><a href="https://github.com/ossrs/srs/wiki/v1_CN_LowLatency" target="_blank" rel="noopener">ä½å»¶æ—¶ç›´æ’­åº”ç”¨</a></li><li><a href="https://zhuanlan.zhihu.com/p/100519553" target="_blank" rel="noopener">åŸºäº H5 çš„ç›´æ’­åè®®å’Œè§†é¢‘ç›‘æ§æ–¹æ¡ˆ</a></li><li><a href="https://imququ.com/post/html5-live-player-2.html" target="_blank" rel="noopener">HTML5 è§†é¢‘ç›´æ’­ï¼ˆäºŒï¼‰</a> </li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;å¥½ä¹…ä¸è§ï¼Œæ¥è¿‘å››ä¸ªæœˆæ²¡æ›´æ–°åšå®¢äº†! &lt;/p&gt;
&lt;p&gt;å»å¹´&lt;a href=&quot;https://juejin.im/post/5e0010866fb9a015fd69c645#comment&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;æœ€åä¸€ç¯‡&lt;/a&gt;æ–‡ç« ä»‹ç»
      
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://bobi.ink/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>åˆ†äº«è¿™åŠå¹´çš„ Electron åº”ç”¨å¼€å‘å’Œä¼˜åŒ–ç»éªŒ</title>
    <link href="https://bobi.ink/2019/12/16/electron/"/>
    <id>https://bobi.ink/2019/12/16/electron/</id>
    <published>2019-12-15T16:00:00.000Z</published>
    <updated>2023-06-01T09:55:14.328Z</updated>
    
    <content type="html"><![CDATA[<p>2019 å¹´æœ€åä¸€å‘ï¼Œè°ˆè°ˆè¿™åŠå¹´ Electron åº”ç”¨å¼€å‘å’Œä¼˜åŒ–å¿ƒå¾—ã€‚å¹²è´§ä¹ŸæŒºå¤šï¼Œå¸Œæœ›èƒ½ç»™ä½ å¸¦æ¥ä¸€ç‚¹å¯å‘ã€‚</p><p>ä¸‹åŠå¹´å¯ä»¥æ‹¿å‡ºæ¥è¯´ä¸€è¯´çš„é¡¹ç›®ï¼Œä¼°è®¡å°±æ˜¯æˆ‘ä»¬ç”¨ Electron é‡æ„äº†ä¸€ä¸ªæ¡Œé¢ç«¯åº”ç”¨ã€‚è¿™ä¸ªåº”ç”¨ç±»ä¼¼äº<code>é’‰é’‰</code>æˆ–è€…<code>ä¼ä¸šå¾®ä¿¡</code>ï¼Œä¸»è¦åŠŸèƒ½æœ‰å³æ—¶é€šä¿¡ã€è¯­éŸ³/è§†é¢‘ã€ä¼šè®®ï¼ŒåŸºæœ¬åŠŸèƒ½å’Œäº¤äº’ä½“éªŒå’Œ PC ç«¯å¾®ä¿¡å·®ä¸å¤š(å…¶å®å°±æ˜¯æ¨¡ä»¿)ï¼Œå…·ä½“ç»†èŠ‚å°±ä¸å±•å¼€äº†, è¿™äº›å¯¹æœ¬æ–‡ä¸é‡è¦ã€‚å¦‚ä¸‹å›¾</p><p><br></p><p><img src="/images/electron/mygzb.jpeg" alt></p><p><br></p><p><strong>æ–‡ç« å¤§çº²</strong></p><!-- TOC --><ul><li><a href="#ä¸ºä»€ä¹ˆé€‰æ‹©-electron">ä¸ºä»€ä¹ˆé€‰æ‹© Electron?</a></li><li><a href="#è¿›ç¨‹æ¨¡å‹">è¿›ç¨‹æ¨¡å‹</a></li><li><a href="#æŠ€æœ¯é€‰å‹ä¸ä»£ç ç»„ç»‡">æŠ€æœ¯é€‰å‹ä¸ä»£ç ç»„ç»‡</a></li><li><a href="#æ€§èƒ½ä¼˜åŒ–ç¡¬è´§">æ€§èƒ½ä¼˜åŒ–(ç¡¬è´§)</a><ul><li><a href="#1-æ€§èƒ½åˆ†æ">1. æ€§èƒ½åˆ†æ</a></li><li><a href="#2-ä¼˜åŒ–ç­–ç•¥">2. ä¼˜åŒ–ç­–ç•¥</a><ul><li><a href="#21-ç»§ç»­å’Œç™½å±ä½œæ–—äº‰">2.1 ç»§ç»­å’Œç™½å±ä½œæ–—äº‰</a></li><li><a href="#22-è¿½èµ¶åŸç”Ÿçš„äº¤äº’ä½“éªŒ">2.2 è¿½èµ¶åŸç”Ÿçš„äº¤äº’ä½“éªŒ</a></li><li><a href="#23-ä¼˜åŒ–è¿›ç¨‹é€šä¿¡">2.3 ä¼˜åŒ–è¿›ç¨‹é€šä¿¡</a></li></ul></li></ul></li><li><a href="#å‘è¿˜æ˜¯ä¼šæœ‰çš„">å‘è¿˜æ˜¯ä¼šæœ‰çš„</a></li><li><a href="#æ‰©å±•èµ„æ–™">æ‰©å±•èµ„æ–™</a></li></ul><!-- /TOC --><p><br></p><h2 id="ä¸ºä»€ä¹ˆé€‰æ‹©-electron"><a href="#ä¸ºä»€ä¹ˆé€‰æ‹©-electron" class="headerlink" title="ä¸ºä»€ä¹ˆé€‰æ‹© Electron?"></a>ä¸ºä»€ä¹ˆé€‰æ‹© Electron?</h2><p>åŸå› ä¹Ÿå¾ˆç®€å•: <strong>æˆ‘ä»¬çš„åº”ç”¨è¦å…¼å®¹å¤šä¸ªå¹³å°ï¼ŒåŸç”Ÿå¼€å‘æ•ˆç‡ä½ï¼Œæˆ‘ä»¬æ²¡æœ‰èµ„æº</strong>ã€‚</p><p>è¯´äº†è·Ÿç™½è¯´ä¸€æ ·ï¼Œå¤§éƒ¨åˆ†é€‰æ‹© Electron æ¡†æ¶çš„åŠ¨æœºéƒ½æ˜¯å·®ä¸å¤šçš„ï¼Œæ— éå°±æ˜¯ç©·ï¼Œå°¤å…¶æ˜¯åœ¨å¤¹ç¼ä¸­ç”Ÿå­˜çš„ä¼ä¸šã€‚</p><p>ä¸ºäº†ä¼˜åŒ–å®¢æˆ·ç«¯å¼€å‘èµ„æºï¼Œ<strong>â€˜æ··åˆåŒ–â€™æˆä¸ºäº†æˆ‘ä»¬ä»Šå¹´å®¢æˆ·ç«¯é‡æ„çš„ä¸»é¢˜</strong>ã€‚</p><p>å…ˆæ¥çœ‹ä¸€ä¸‹æˆ‘ä»¬ç°åœ¨çš„å®¢æˆ·ç«¯åŸºæœ¬æ¶æ„:</p><p><img src="/images/electron/client-arch.png" alt></p><p><br></p><p>æ··åˆåŒ–å¯¹æˆ‘ä»¬æ¥è¯´æœ‰ä¸¤å±‚æ„æ€:</p><ol><li>æˆ‘ä»¬çš„åº”ç”¨æ¶æ„â€™æ··åˆâ€™äº†å¤šç§æŠ€æœ¯ã€‚é€šç”¨åº•å±‚ C/C++, å¹³å°åŸç”Ÿ(iOS, Android, PC, MacOS)ï¼ŒWeb æŠ€æœ¯</li><li>è·¨å¹³å°</li></ol><p><br></p><p>åŸºäºæˆ‘ä»¬åŸæœ‰çš„å®¢æˆ·ç«¯åŸºç¡€å’Œæƒ…å†µï¼Œæ··åˆåŒ–é‡æ„è‡ªç„¶è€Œç„¶åˆ†åŒ–ä¸ºäº†ä¸¤ä¸ªæ–¹å‘:</p><ol><li><strong>ä¸šåŠ¡ä¸‹æ²‰</strong>ã€‚å°†é€šç”¨çš„ã€æ ¸å¿ƒçš„ä¸šåŠ¡ä¸‹æ²‰ã€‚ä¾‹å¦‚æ¶ˆæ¯å¤„ç†ã€è¯­éŸ³/è§†é¢‘ã€ä¼šè®®ã€æ•°æ®å­˜å‚¨ç­‰æ ¸å¿ƒæ¨¡å—, æ ¸å¿ƒåè®®æ˜¯ XMPPã€SIPã€‚è¿™äº›æ¨¡å—å˜åŠ¨é¢‘ç‡è¾ƒä½ã€å¯¹æ€§èƒ½è¦æ±‚ä¹Ÿæ¯”è¾ƒé«˜ï¼Œè€Œä¸”æœ‰è·¨å¹³å°éœ€æ±‚ï¼Œå› æ­¤é€‚åˆç”¨ C/C++ æ¥å®ç°ã€‚</li><li><strong>UI æ··åˆ</strong>ã€‚è§†å›¾å±‚æ··åˆåŒ–ç›®å‰ä¹Ÿæœ‰è¾ƒå¤šçš„è§£å†³æ–¹æ¡ˆï¼Œä¾‹å¦‚ Electronã€React Nativeã€Flutterã€æˆ–è€…æ˜¯ HTML Hybridã€‚æˆ‘ä»¬é€‰æ‹©å…ˆä» Electron å¼€å§‹ï¼Œå› ä¸ºå®ƒåœ¨æ¡Œé¢ç«¯å¼€å‘ä¸­å·²ç»æœ‰éå¸¸æˆç†Ÿçš„è¡¨ç°ï¼Œå¸‚åœºä¸Šä¹Ÿæœ‰å¾ˆå¤šå¤§å‹çš„ Electron åº”ç”¨ï¼Œä¾‹å¦‚ VSCodeã€Atomã€Slackã€‚åœ¨ç§»åŠ¨ç«¯ï¼Œæˆ‘ä»¬å¯¹ React Native å’Œ Flutter è¿˜æ¯”è¾ƒä¿å®ˆï¼Œåç»­å¯èƒ½ä¼šè¿›è¡Œå°è¯•ã€‚</li></ol><p><br></p><p>ç†è§£äº†æˆ‘ä»¬çš„åŠ¨æœºï¼Œç°åœ¨å†çœ‹ä¸Šé¢çš„å›¾, åº”è¯¥å°±å¥½ç†è§£å¤šäº†, è¿™æ˜¯å…¸å‹çš„ä¸‰å±‚ç»“æ„, å’Œ MVC éå¸¸ç›¸ä¼¼ï¼š</p><ul><li><strong>M â€“ é€šç”¨æ··åˆå±‚</strong>ã€‚ C/C++ å°è£…æ ¸å¿ƒã€é€šç”¨çš„ä¸šåŠ¡æ¨¡å—ä»¥åŠä¸šåŠ¡æ•°æ®å­˜å‚¨ã€‚</li><li><strong>V â€“ UI å±‚</strong>ã€‚è§†å›¾å±‚ï¼Œä½¿ç”¨è·¨å¹³å°è§†å›¾è§£å†³æ–¹æ¡ˆï¼Œå¯¹äºæ€§èƒ½è¦æ±‚è¾ƒé«˜çš„éƒ¨åˆ†ä½¿ç”¨åŸç”Ÿå®ç°ã€‚æ¯”å¦‚ Electron</li><li><strong>C â€“ å¹³å°æ¡¥æ¥å±‚</strong>ã€‚ä»‹äº M å’Œ V ä¹‹é—´ï¼Œæ¡¥æ¥<code>é€šç”¨æ··åˆå±‚</code>æ¥å£ï¼ŒåŒæ—¶ä¹Ÿä¸º UI å±‚æš´éœ²ä¸€äº›<strong>å¹³å°ç›¸å…³</strong>çš„ç‰¹æ€§ã€‚æ¯”å¦‚åœ¨æ¡Œé¢ç«¯ï¼Œè¿™é‡Œä¼šé€šè¿‡ Node åŸç”Ÿæ¨¡å—æ¡¥æ¥é€šç”¨æ··åˆå±‚, åŒæ—¶ä¹Ÿè¡¥å……ä¸€äº› Electron ç¼ºå¤±æˆ–ä¸å®Œç¾çš„åŠŸèƒ½ã€‚</li></ul><p><br><br><br></p><h2 id="è¿›ç¨‹æ¨¡å‹"><a href="#è¿›ç¨‹æ¨¡å‹" class="headerlink" title="è¿›ç¨‹æ¨¡å‹"></a>è¿›ç¨‹æ¨¡å‹</h2><p>Electron çš„ä¸»ä»è¿›ç¨‹æ¨¡å‹æ˜¯åŸºæœ¬çš„å¸¸è¯†ã€‚æ¯ä¸ª Electron åº”ç”¨æœ‰ä¸”åªè¦ä¸€ä¸ªä¸»è¿›ç¨‹(Main Process)ã€ä»¥åŠä¸€ä¸ªæˆ–å¤šä¸ªæ¸²æŸ“è¿›ç¨‹(Renderer Process), å¯¹åº”å¤šä¸ª Web é¡µé¢ã€‚é™¤æ­¤ä¹‹å¤–è¿˜æœ‰ GPU è¿›ç¨‹ã€æ‰©å±•è¿›ç¨‹ç­‰ç­‰ã€‚å¯ä»¥é€šè¿‡ <a href="https://electronjs.org/docs/tutorial/application-architecture#main-and-renderer-processes" target="_blank" rel="noopener">Electron Application Architecture</a> äº†è§£ Electron çš„åŸºæœ¬æ¶æ„ã€‚</p><p>ä¸»è¿›ç¨‹è´Ÿè´£åˆ›å»ºé¡µé¢çª—å£ã€åè°ƒè¿›ç¨‹é—´é€šä¿¡ã€äº‹ä»¶åˆ†å‘ã€‚ä¸ºäº†å®‰å…¨è€ƒè™‘ï¼ŒåŸç”Ÿ GUI ç›¸å…³çš„ API æ˜¯æ— æ³•åœ¨æ¸²æŸ“è¿›ç¨‹ç›´æ¥è®¿é—®çš„ï¼Œå®ƒä»¬å¿…é¡»é€šè¿‡ IPC è°ƒç”¨ä¸»è¿›ç¨‹ã€‚<strong>è¿™ç§ä¸»ä»è¿›ç¨‹æ¨¡å‹ç¼ºç‚¹ä¹Ÿéå¸¸æ˜æ˜¾ï¼Œå³ä¸»è¿›ç¨‹å•ç‚¹æ•…éšœã€‚ä¸»è¿›ç¨‹å´©æºƒæˆ–è€…é˜»å¡ï¼Œä¼šå½±å“æ•´ä¸ªåº”ç”¨çš„å“åº”</strong>ã€‚æ¯”å¦‚ä¸»è¿›ç¨‹è·‘é•¿æ—¶é—´çš„ CPU ä»»åŠ¡ï¼Œå°†é˜»å¡æ¸²æŸ“è¿›ç¨‹çš„ç”¨æˆ·äº¤äº’äº‹ä»¶ã€‚</p><p><br></p><p>å¯¹æˆ‘ä»¬çš„åº”ç”¨æ¥è¯´ï¼Œç›®å‰æœ‰ä»¥ä¸‹è¿›ç¨‹, ä»¥åŠå®ƒä»¬çš„èŒè´£:</p><p><strong>â‘  ä¸»è¿›ç¨‹</strong></p><ul><li>è¿›ç¨‹é—´é€šä¿¡ã€çª—å£ç®¡ç†</li><li>å…¨å±€é€šç”¨æœåŠ¡ã€‚</li><li>ä¸€äº›åªèƒ½æˆ–é€‚åˆåœ¨ä¸»è¿›ç¨‹åšçš„äº‹æƒ…ã€‚ä¾‹å¦‚æµè§ˆå™¨ä¸‹è½½ã€å…¨å±€å¿«æ·é”®å¤„ç†ã€æ‰˜ç›˜ã€sessionã€‚</li><li>ç»´æŠ¤ä¸€äº›å¿…è¦çš„å…¨å±€çŠ¶æ€</li><li>ä¸Šé¢è¯´çš„<code>é€šç”¨æ··åˆå±‚</code>ä¹Ÿè·‘åœ¨è¿™ä¸ªè¿›ç¨‹ã€‚é€šè¿‡ Node C++ æ’ä»¶æš´éœ²æ¥å£ã€‚</li></ul><p><br></p><p><strong>â‘¡ æ¸²æŸ“è¿›ç¨‹</strong></p><p>è´Ÿè´£ Web é¡µé¢çš„æ¸²æŸ“, å…·ä½“é¡µé¢çš„ä¸šåŠ¡å¤„ç†ã€‚</p><p><br></p><p><strong>â‘¢ Service Worker</strong></p><p>è´Ÿè´£é™æ€èµ„æºç¼“å­˜ã€‚ç¼“å­˜ä¸€äº›ç½‘ç»œå›¾ç‰‡ã€éŸ³é¢‘ã€‚ä¿è¯é™æ€èµ„æºçš„ç¨³å®šåŠ è½½ã€‚</p><p><br><br><br></p><h2 id="æŠ€æœ¯é€‰å‹ä¸ä»£ç ç»„ç»‡"><a href="#æŠ€æœ¯é€‰å‹ä¸ä»£ç ç»„ç»‡" class="headerlink" title="æŠ€æœ¯é€‰å‹ä¸ä»£ç ç»„ç»‡"></a>æŠ€æœ¯é€‰å‹ä¸ä»£ç ç»„ç»‡</h2><p>è¯´è¯´æˆ‘ä»¬çš„æŠ€æœ¯é€‰å‹ã€‚</p><ul><li>UI æ¡†æ¶ - <code>React</code></li><li>çŠ¶æ€ç®¡ç† - <code>Mobx</code></li><li>å›½é™…åŒ– - <code>i18next</code></li><li>æ‰“åŒ… - <code>è‡ªç ” CLI</code></li></ul><p><br></p><p>æºç ç»„ç»‡</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">bridge/                  # æ¡¥æ¥å±‚ä»£ç </span><br><span class="line">resources/               # æ„å»ºèµ„æºï¼Œä»¥åŠç¬¬ä¸‰æ–¹DLL</span><br><span class="line">src/</span><br><span class="line"></span><br><span class="line">  main/                  # ğŸ”´ä¸»è¿›ç¨‹ä»£ç </span><br><span class="line">    services/            # ğŸ“¡**é€šè¿‡ RPC æš´éœ²ç»™æ¸²æŸ“è¿›ç¨‹çš„å…¨å±€æœåŠ¡**</span><br><span class="line">      tray.ts            # æ‰˜ç›˜çŠ¶æ€ç®¡ç†</span><br><span class="line">      shortcut.ts        # å…¨å±€å¿«æ·é”®åˆ†å‘</span><br><span class="line">      preferences.ts     # ç”¨æˆ·é…ç½®ç®¡ç†</span><br><span class="line">      windows.ts         # çª—å£ç®¡ç†</span><br><span class="line">      screen-capture.ts  # æˆªå±</span><br><span class="line">      bridge.ts          # æ¡¥æ¥å±‚æ¥å£å°è£…</span><br><span class="line">      context-menu.ts    # å³é”®èœå•</span><br><span class="line">      state.ts           # å…¨å±€çŠ¶æ€ç®¡ç†, ä¿å­˜ä¸€äº›å¿…è¦çš„å…¨å±€çŠ¶æ€ï¼Œä¾‹å¦‚ä¸»é¢˜ã€å½“å‰è¯­è¨€ã€å½“å‰ç”¨æˆ·</span><br><span class="line">      ...</span><br><span class="line">    lib/                 # å°è£…åº“</span><br><span class="line">      bridge.ts          # æ¡¥æ¥å±‚API åˆ†è£…</span><br><span class="line">      logger.ts          # æ—¥å¿—</span><br><span class="line">      ...</span><br><span class="line">    bootstrap.ts         # å¯åŠ¨ç¨‹åº</span><br><span class="line">    index.ts             # ğŸ”´å…¥å£æ–‡ä»¶</span><br><span class="line"></span><br><span class="line">  renderer/              # ğŸ”´æ¸²æŸ“è¿›ç¨‹</span><br><span class="line">    services/            # ğŸ“¡ä¸»è¿›ç¨‹çš„å…¨å±€æœåŠ¡çš„å®¢æˆ·ç«¯</span><br><span class="line">      windows.ts         # çª—å£ç®¡ç†å®¢æˆ·ç«¯</span><br><span class="line">      tray.ts</span><br><span class="line">      ...</span><br><span class="line">    assets/              # é™æ€èµ„æº</span><br><span class="line">    hooks/               # React Hooks</span><br><span class="line">    components/          # é€šç”¨ç»„ä»¶</span><br><span class="line">      Webview</span><br><span class="line">      Editor</span><br><span class="line">      toast</span><br><span class="line">      ...</span><br><span class="line">    pages/               # ğŸ”´é¡µé¢</span><br><span class="line">      Home</span><br><span class="line">        ui/              # ğŸ”´è§†å›¾ä»£ç ï¼Œç”±å‰ç«¯å›¢é˜Ÿç»´æŠ¤</span><br><span class="line">        store/           # ğŸ”´çŠ¶æ€ä»£ç ï¼Œç”±å®¢æˆ·ç«¯å›¢é˜Ÿç»´æŠ¤ï¼Œå‰ç«¯Storeçš„å…¬å¼€çŠ¶æ€</span><br><span class="line">        translation/     # å›½é™…åŒ–ç¿»è¯‘æ–‡ä»¶</span><br><span class="line">        index.tsx        # é¡µé¢å…¥å£</span><br><span class="line">      Settings</span><br><span class="line">      Login</span><br><span class="line">    page.json            # ğŸ”´å£°æ˜æ‰€æœ‰é¡µé¢åŠé¡µé¢é…ç½®ã€‚ç±»ä¼¼å°ç¨‹åº</span><br></pre></td></tr></table></figure><p><br></p><p>çœ¼å°–çš„è¯»è€…ä¼šå‘ç°æ¯ä¸ªé¡µé¢ä¸‹æœ‰ <code>ui</code> å’Œ <code>store</code> ç›®å½•ï¼Œåˆ†åˆ«å¯¹åº”è§†å›¾å’ŒçŠ¶æ€ã€‚ä¸ºä»€ä¹ˆè¿™ä¹ˆåˆ’åˆ†ï¼Ÿ</p><p>é¦–å…ˆè¿™æ˜¯å› ä¸ºè¿™ä¸ªé¡¹ç›®ç”±ä¸¤ä¸ªå›¢é˜Ÿå…±åŒæ¥å¼€å‘çš„ï¼Œå³åŸæœ‰çš„åŸç”Ÿå®¢æˆ·ç«¯å›¢é˜Ÿå’Œæˆ‘ä»¬çš„å‰ç«¯å›¢é˜Ÿã€‚åˆ†ç¦»è§†å›¾å’ŒçŠ¶æ€æœ‰ä¸¤ä¸ªå¥½å¤„:</p><ul><li>å‰ç«¯å‰æœŸä¸éœ€è¦å…³å¿ƒå®¢æˆ·ç«¯åº•å±‚ä¸šåŠ¡ï¼Œè€Œå®¢æˆ·ç«¯ä¹Ÿä¸éœ€è¦å…³å¿ƒå‰ç«¯çš„é¡µé¢å®ç°ã€‚èŒè´£æ˜ç¡®ï¼Œå„è‡ªå¹²å¥½è‡ªå·±äº‹æƒ…ã€‚</li><li>é™ä½å­¦ä¹ æˆæœ¬ã€‚æˆ‘ä»¬çŠ¶æ€ç®¡ç†é€‰ç”¨äº† Mobxï¼Œå¯¹äºå®¢æˆ·ç«¯åŒå­¦ï¼Œåªéœ€è¦æŒæ¡å°‘é‡çš„ Typescript è¯­è¨€çŸ¥è¯†å°±å¯ä»¥é©¬ä¸Šä¸Šæ‰‹ã€‚å¦‚æœç†Ÿæ‚‰ Javaã€C# é‚£å°±æ›´æ²¡ä»€ä¹ˆé—®é¢˜äº†ã€‚æ¯ä¸ª Store åªæ˜¯ä¸€ä¸ªç®€å•çš„ç±»ï¼š</li></ul><figure class="highlight ts"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> CounterStore <span class="keyword">extends</span> MobxStore &#123;</span><br><span class="line">  <span class="meta">@observable</span></span><br><span class="line">  <span class="keyword">public</span> count: <span class="built_in">number</span> = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">  <span class="meta">@action</span></span><br><span class="line">  <span class="keyword">public</span> incr = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.count++</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> pageReady() &#123;</span><br><span class="line">    <span class="comment">// é¡µé¢å°±ç»ªï¼Œå¯ä»¥åœ¨è¿™é‡Œåšä¸€äº›å‡†å¤‡å·¥ä½œ</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// äº‹ä»¶ç›‘å¬</span></span><br><span class="line">    <span class="comment">// addDisposer å°†é‡Šæ”¾å‡½æ•°æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­ï¼Œåœ¨é¡µé¢é€€å‡ºæ—¶é‡Šæ”¾</span></span><br><span class="line">    <span class="keyword">this</span>.addDisposer(</span><br><span class="line">      addListener(<span class="string">'someevent'</span>, <span class="function"><span class="params">evt</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.dosomething(evt)</span><br><span class="line">      &#125;)</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">this</span>.initial()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> pageWillClose() &#123;</span><br><span class="line">    <span class="comment">// é¡µé¢é‡Šæ”¾ï¼Œå¯ä»¥åœ¨è¿™é‡Œåšä¸€äº›èµ„æºé‡Šæ”¾</span></span><br><span class="line">    releaseSomeResource()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ....</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p>ä½¿ç”¨ Mobx ä½œä¸ºçŠ¶æ€ç®¡ç†ï¼Œç›¸æ¯” Reduxï¼Œé¢å‘å¯¹è±¡æ€æƒ³å¯¹ä»–ä»¬æ›´å¥½ç†è§£ã€‚åœ¨è¿™ç§åœºæ™¯ï¼Œç®€å•æ‰æ˜¯çœŸç†ï¼›</p><p>åˆ†ç¦»äº†çŠ¶æ€å’Œä¸šåŠ¡é€»è¾‘ï¼Œå‰ç«¯é¡µé¢å®ç°ä¹Ÿç®€åŒ–äº†ï¼Œè§†å›¾åªæ˜¯çŠ¶æ€çš„æ˜ å°„ï¼Œè¿™è®©æˆ‘ä»¬çš„é¡µé¢å’Œç»„ä»¶æ›´å¥½è¢«ç»´æŠ¤å’Œå¤ç”¨ã€‚</p><p><br><br><br></p><h2 id="æ€§èƒ½ä¼˜åŒ–-ç¡¬è´§"><a href="#æ€§èƒ½ä¼˜åŒ–-ç¡¬è´§" class="headerlink" title="æ€§èƒ½ä¼˜åŒ–(ç¡¬è´§)"></a>æ€§èƒ½ä¼˜åŒ–(ç¡¬è´§)</h2><p>å‰æˆå®Œäº†ï¼Œå…³äº Electron çš„ä¸€äº›æ€§èƒ½ä¼˜åŒ–æ‰æ˜¯æœ¬ç¯‡æ–‡ç« çš„é‡å¤´æˆã€‚</p><p>Electron ä¸æ˜¯é“¶å¼¹ï¼Œé±¼å’Œç†ŠæŒä¸å¯å…¼å¾—ã€‚Electron å¸¦æ¥å¼€å‘æ•ˆç‡çš„æå‡ï¼Œå…¶æœ¬èº«ä¹Ÿæœ‰å¾ˆå¤šç¡¬ä¼¤ï¼Œè­¬å¦‚å¸¸è¢«äººåæ§½çš„å†…å­˜å ç”¨é«˜ï¼Œå’ŒåŸç”Ÿå®¢æˆ·ç«¯æ€§èƒ½å·®å¼‚ç­‰ç­‰ã€‚ä¸ºäº†ä¼˜åŒ– Electron åº”ç”¨ï¼Œæˆ‘ä»¬ä¹Ÿåšäº†å¾ˆå¤šå·¥ä½œã€‚</p><p>æ€§èƒ½ä¼˜åŒ–ä¸€èˆ¬éƒ½åˆ†ä¸¤æ­¥èµ°ï¼š</p><ul><li>â‘  åˆ†æã€æ‰¾å‡ºé—®é¢˜ã€‚å‚è€ƒ<a href="https://juejin.im/post/5d06bf0a51882528194a9736" target="_blank" rel="noopener">ã€ŠReact æ€§èƒ½æµ‹é‡å’Œåˆ†æã€‹</a></li><li>â‘¡ é’ˆå¯¹é—®é¢˜è§£å†³é—®é¢˜ã€‚æ— å¤–ä¹ä¸‰ä¸ªæ–¹å‘, å‚è€ƒ <a href="https://juejin.im/post/5d045350f265da1b695d5bf2" target="_blank" rel="noopener">ã€Šæµ…è°ˆ React æ€§èƒ½ä¼˜åŒ–çš„æ–¹å‘ã€‹</a></li></ul><p><br></p><h3 id="1-æ€§èƒ½åˆ†æ"><a href="#1-æ€§èƒ½åˆ†æ" class="headerlink" title="1. æ€§èƒ½åˆ†æ"></a>1. æ€§èƒ½åˆ†æ</h3><p>æœ€å¥½çš„åˆ†æå·¥å…·æ˜¯ Chrome å¼€å‘è€…å·¥å…·çš„ <code>Performance</code>ã€‚é€šè¿‡ç«ç„°å›¾, JavaScript æ‰§è¡Œè¿‡ç¨‹çš„ä»»ä½•è››ä¸é©¬è¿¹éƒ½å¯ä»¥ç›´è§‚çš„çœ‹åˆ°ã€‚</p><p><img src="/images/electron/chrome-perf.png" alt></p><p><br></p><p>å¯¹äºä¸»è¿›ç¨‹ï¼Œå¼€å¯è°ƒè¯•åä¹Ÿå¯ä»¥é€šè¿‡ <code>Profile</code> å·¥å…·æ”¶é›† JavaScript æ‰§è¡Œä¿¡æ¯ã€‚</p><p>å¦‚æœä½ è¦åˆ†ææŸæ®µä»£ç çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ä¸‹é¢å‘½ä»¤ç”Ÿæˆåˆ†ææ–‡ä»¶ï¼Œç„¶åå¯¼å…¥åˆ° Chrome Performance ä¸­åˆ†æ:</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> è¾“å‡º cpu å’Œ å †åˆ†ææ–‡ä»¶</span></span><br><span class="line">node --cpu-prof --heap-prof -e "require('requestâ€™)â€â€œ</span><br></pre></td></tr></table></figure><p><br><br><br></p><h3 id="2-ä¼˜åŒ–ç­–ç•¥"><a href="#2-ä¼˜åŒ–ç­–ç•¥" class="headerlink" title="2. ä¼˜åŒ–ç­–ç•¥"></a>2. ä¼˜åŒ–ç­–ç•¥</h3><h4 id="2-1-ç»§ç»­å’Œç™½å±ä½œæ–—äº‰"><a href="#2-1-ç»§ç»­å’Œç™½å±ä½œæ–—äº‰" class="headerlink" title="2.1 ç»§ç»­å’Œç™½å±ä½œæ–—äº‰"></a>2.1 ç»§ç»­å’Œç™½å±ä½œæ–—äº‰</h4><p>å³ä½¿ Electron é€šå¸¸ä»æœ¬åœ°æ–‡ä»¶ç³»ç»ŸåŠ è½½ JavaScript ä»£ç ï¼Œæ²¡æœ‰ç½‘ç»œåŠ è½½å»¶è¿Ÿï¼Œæˆ‘ä»¬è¿˜æ˜¯éœ€è¦ç»§ç»­å’Œé¡µé¢ç™½å±åšæ–—äº‰ï¼Œå› ä¸º JavaScript ç­‰èµ„æºçš„åŠ è½½ã€è§£æå’Œæ‰§è¡Œè¿˜æ˜¯æœ‰ç›¸å½“å¤§çš„ä»£ä»·(å‚è€ƒ<a href="https://v8.dev/blog/cost-of-javascript-2019" target="_blank" rel="noopener">The cost of JavaScript in 2019</a>)ã€‚ä½œä¸ºä¸€ä¸ªæ¡Œé¢ç«¯åº”ç”¨ï¼Œç»†å¾®çš„ç™½å±å»¶è¿Ÿç”¨æˆ·éƒ½å¯ä»¥æ„Ÿè§‰çš„åˆ°ã€‚æˆ‘ä»¬è¦å°½é‡è®©ç”¨æˆ·æ„Ÿè§‰ä¸åˆ°è¿™æ˜¯ä¸€ä¸ª Web é¡µé¢ã€‚</p><p><strong>å½±å“ Electron ç™½å±çš„ä¸»è¦å› ç´ æœ‰ï¼šé¡µé¢çª—å£çš„åˆ›å»ºã€é™æ€èµ„æºçš„åŠ è½½ã€JavaScript è§£æå’Œæ‰§è¡Œ</strong>ã€‚</p><p>è§æ‹›æ‹†æ‹›ï¼Œé’ˆå¯¹é¡µé¢ç™½å±æˆ‘ä»¬åšäº†è¿™äº›ä¼˜åŒ–:</p><p><br></p><p><strong>â‘  éª¨æ¶å±</strong></p><p>æœ€ç®€å•çš„æ–¹å¼ã€‚åœ¨èµ„æºæœªåŠ è½½å®Œæ¯•ä¹‹å‰ï¼Œå…ˆå±•ç¤ºé¡µé¢çš„éª¨æ¶ã€‚é¿å…ç”¨æˆ·çœ‹åˆ°ç™½èŒ«èŒ«çš„å±å¹•ã€‚</p><p>å¦å¤–éœ€è¦è®¾ç½®èƒŒæ™¯è‰²æˆ–è€…å»¶è¿Ÿæ˜¾ç¤ºçª—å£ï¼Œæ¥é¿å…é—ªçƒã€‚</p><p><img src="/images/electron/shell.png" alt><br><em>VSCodeéª¨æ¶å±</em></p><p><br></p><p><strong>â‘¡ æƒ°æ€§åŠ è½½</strong></p><p>ä¼˜å…ˆåŠ è½½æ ¸å¿ƒçš„åŠŸèƒ½ï¼Œä¿è¯åˆæ¬¡åŠ è½½æ•ˆç‡ï¼Œè®©ç”¨æˆ·å¯ä»¥å°½å¿«è¿›è¡Œäº¤äº’ã€‚</p><p><br></p><p><img src="/images/electron/load-order.gif" alt></p><p><br></p><ul><li><strong>ä»£ç åˆ†å‰² + é¢„åŠ è½½</strong>ï¼š ä»£ç åˆ†å‰²æ˜¯æœ€å¸¸è§ä¼˜åŒ–æ–¹å¼ã€‚æˆ‘ä»¬æŠŠéšè—çš„å†…å®¹ã€æˆ–è€…æ¬¡ä¼˜å…ˆçº§çš„æ¨¡å—æ‹†åˆ†å‡ºå»ï¼Œå¯åŠ¨æ¨¡å—ä¸­åªä¿ç•™å…³é”®è·¯å¾„ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨æµè§ˆå™¨ç©ºé—²æ—¶é¢„åŠ è½½è¿™äº›æ¨¡å—ã€‚</li><li><p><strong>å»¶ååŠ è½½ Node æ¨¡å—</strong>ï¼š Nodejs æ¨¡å—çš„åŠ è½½å’Œæ‰§è¡Œéœ€è¦èŠ±è´¹è¾ƒå¤§çš„ä»£ä»·, ä¾‹å¦‚æ¨¡å—æŸ¥æ‰¾ã€æ¨¡å—æ–‡ä»¶è¯»å–ã€æ¥ç€æ‰æ˜¯æ¨¡å—è§£æå’Œæ‰§è¡Œã€‚è¿™äº›æ“ä½œéƒ½æ˜¯åŒæ­¥äº†ï¼Œåˆ«å¿˜äº†ï¼Œnode_modules é»‘æ´ï¼ŒæŸå—æ¨¡å—å¯èƒ½ä¼šå¼•ç”¨å¤§é‡çš„ä¾èµ–â€¦.</p><p>Node åº”ç”¨å’Œ Electron åº”ç”¨ä¸å¤ªä¸€æ ·ï¼Œé€šå¸¸ Node æœåŠ¡å™¨åº”ç”¨éƒ½ä¼šå°†æ¨¡å—æ”¾ç½®åœ¨æ–‡ä»¶é¡¶éƒ¨, ç„¶ååŒæ­¥åŠ è½½è¿›æ¥ã€‚è¿™ä¸ªæ”¾åˆ° Electron ç”¨æˆ·ç•Œé¢ä¸Šå°±æ— æ³•å¿å—äº†ã€‚ ç”¨æˆ·ç•Œé¢çš„å¯åŠ¨é€Ÿåº¦å’Œäº¤äº’é˜»å¡, ç”¨æˆ·æ˜¯å¯ä»¥æ„ŸçŸ¥åˆ°çš„ï¼Œè€Œä¸”å¿è€ç¨‹åº¦ä¼šè¾ƒä½ã€‚</p><p>æ‰€ä»¥è¦å……åˆ†è¯„ä¼°æ¨¡å—çš„å¤§å°å’Œä¾èµ–ã€‚æˆ–è€…å¯ä»¥é€‰æ‹©ä½¿ç”¨æ‰“åŒ…å·¥å…·ä¼˜åŒ–å’Œåˆå¹¶ Node æ¨¡å—ã€‚</p></li><li><p><strong>åˆ’åˆ†åŠ è½½ä¼˜å…ˆçº§</strong>ï¼šæ—¢ç„¶æˆ‘ä»¬æ²¡åŠæ³•ä¸€å¼€å§‹å°†æ‰€æœ‰ä¸œè¥¿éƒ½åŠ è½½å‡ºæ¥ï¼Œé‚£å°±æŒ‰ç…§ä¼˜å…ˆçº§æ¸è¿›å¼åœ°å°†åœ¨å®ƒä»¬ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨ VSCode æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶æ—¶ï¼ŒVScode ä¼šå…ˆå±•ç¤ºä»£ç é¢æ¿ã€æ¥ç€æ˜¯ç›®å½•æ ‘ã€ä¾§è¾¹æ ã€ä»£ç é«˜äº®ã€é—®é¢˜é¢æ¿ã€åˆå§‹åŒ–å„ç§æ’ä»¶â€¦</p></li></ul><p><br></p><p><strong>â‘¢ ä½¿ç”¨ç°ä»£çš„ JavaScript/CSS ä»£ç </strong></p><p>Electron æ¯ä¸ªç‰ˆæœ¬éƒ½ä¼šé¢„è£…å½“æ—¶æœ€æ–°çš„ Chromeï¼Œå¯¹äºå‰ç«¯æ¥è¯´ï¼Œè¿™æ˜¯æœ€çˆ½çš„ä¸€ä»¶äº‹æƒ…:</p><ul><li>æ²¡æœ‰è´Ÿæ‹…åœ°ä½¿ç”¨æœ€æ–°çš„ JavaScript ç‰¹æ€§</li><li>æ²¡æœ‰ Polyfillã€æ²¡æœ‰ runtime-helperã€‚ç›¸æ¯”è€æ—§æµè§ˆå™¨ï¼Œä»£ç é‡æ›´å°‘ï¼Œæ€§èƒ½ä¹Ÿæ›´å¥½</li><li>æˆ‘ä»¬éœ€è¦ä¸»åŠ¨æŠ›å¼ƒä¸€äº›è€æ—§çš„ä¾èµ–ã€‚ä¿æŒä½¿ç”¨æœ€æ–°çš„åº“</li></ul><p><br></p><p><strong>â‘£ æ‰“åŒ…ä¼˜åŒ–</strong></p><p>å³ä½¿ä½¿ç”¨æœ€æ–°æœ€ç‰›é€¼çš„æµè§ˆå™¨ï¼Œæ‰“åŒ…å·¥å…·è¿˜æ˜¯å¾ˆæœ‰ç”¨ã€‚</p><ul><li><strong>å‡å°‘ä»£ç ä½“ç§¯</strong>: ç°ä»£æ‰“åŒ…å·¥å…·æœ‰éå¸¸å¤šä¼˜åŒ–æ‰‹æ®µï¼Œä¾‹å¦‚ Webpack æ”¯æŒä½œç”¨åŸŸæå‡ã€æ‘‡æ ‘ï¼Œè¿˜æœ‰ä»£ç å‹ç¼©ã€é¢„æ‰§è¡Œâ€¦ è¿™å¯ä»¥åˆå¹¶ä»£ç ã€å‹ç¼©ä»£ç ä½“ç§¯ï¼Œè£å‰ªå¤šä½™çš„ä»£ç , å‡å°‘è¿è¡Œæ—¶è´Ÿæ‹…ã€‚</li><li><strong>ä¼˜åŒ–I/O</strong>: æˆ‘ä»¬å°†æ¨¡å—åˆå¹¶ä¹‹åï¼Œå¯ä»¥å‡å°‘æ¨¡å—æŸ¥æ‰¾å’ŒåŠ è½½çš„I/Oå¾€è¿”ã€‚</li></ul><p><br></p><p><strong>â‘¤ <a href="https://v8project.blogspot.it/2015/09/custom-startup-snapshots.html" target="_blank" rel="noopener">v8 Snapshot</a> or <a href="https://v8.dev/blog/code-caching" target="_blank" rel="noopener">v8 Code Cache</a></strong></p><p>Atom æœ‰å¾ˆå¤šä¼˜è´¨çš„æ–‡ç« ï¼Œåˆ†äº«äº†ä»–ä»¬ä¼˜åŒ–Atomçš„ç»å†ã€‚ä¾‹å¦‚å®ƒä»¬ä½¿ç”¨äº† <a href="https://blog.atom.io/2017/04/18/improving-startup-time.html" target="_blank" rel="noopener">V8 çš„snapshot æ¥ä¼˜åŒ–å¯åŠ¨æ—¶é—´</a>ã€‚</p><p>è¿™æ˜¯ä¸€ç§ <code>AOT</code> ä¼˜åŒ–ç­–ç•¥ï¼Œç®€å•è¯´ Snapshot æ˜¯å †å¿«ç…§ï¼Œä½ å¯ä»¥è®¤ä¸ºå®ƒæ˜¯ JavaScript ä»£ç åœ¨V8ä¸­çš„å†…å­˜è¡¨ç¤ºå½¢æ€ã€‚</p><p>å®ƒæœ‰ä¸¤ä¸ªå¥½å¤„: ä¸€æ˜¯ç›¸æ¯”æ™®é€š JavaScript åŠ è½½æ›´å¿«ï¼ŒäºŒæ˜¯å®ƒæ˜¯äºŒè¿›åˆ¶çš„ï¼Œå¦‚æœä½ ä¸ºäº†â€˜å®‰å…¨â€™è€ƒè™‘ï¼Œå¯ä»¥å°†æ¨¡å—è½¬æ¢æˆsnapshotï¼Œè¿™æ ·æ›´éš¾è¢«â€˜ç ´è§£â€™ã€‚</p><p>ä¸è¿‡å®ƒä¹Ÿæœ‰è¾ƒå¤šé™åˆ¶ã€‚å¯¹æ¶æ„çš„å½±å“æ¯”è¾ƒå¤§ã€‚æ¯”å¦‚è¦æ±‚åœ¨åˆå§‹åŒ–çš„è¿‡ç¨‹ä¸­ä¸è¦æœ‰â€˜å‰¯ä½œç”¨â€™ï¼Œä¾‹å¦‚DOMè®¿é—®ã€‚å› ä¸ºåœ¨â€˜ç¼–è¯‘æ—¶â€˜è¿™äº›ä¸œè¥¿ä¸å­˜åœ¨ã€‚</p><p>è¿™ç¯‡æ–‡ç« è¯¦ç»†ä»‹ç»äº†å¦‚ä½•åœ¨ Electron ä¸­åº”ç”¨ v8 snapshot: <a href="https://flight-manual.atom.io/behind-atom/sections/how-atom-uses-chromium-snapshots/" target="_blank" rel="noopener">How Atom Uses Chromium Snapshots</a></p><p><br></p><p>è¿˜æœ‰ä¸€ä¸ªæ›´åŠ å¹¿æ³›ä½¿ç”¨çš„æ–¹æ¡ˆæ˜¯ <a href="https://v8.dev/blog/code-caching" target="_blank" rel="noopener">v8 Code Cache</a>ã€‚NodeJS 12 <a href="https://www.yuque.com/egg/nodejs/nodejs-12#2e3ceb28" target="_blank" rel="noopener">å¼€å§‹</a>åœ¨æ„å»ºæ—¶æå‰ä¸ºå†…ç½®åº“ç”Ÿæˆä»£ç ç¼“å­˜ï¼Œä»è€Œæå‡ 30% çš„å¯åŠ¨è€—æ—¶ã€‚</p><p>é€šè¿‡è¿™äº›æ–‡ç« ï¼Œæ·±å…¥äº†è§£ Code Cache æ‰©å±•é˜…è¯»:</p><ul><li><a href="https://v8.dev/blog/code-caching-for-devs" target="_blank" rel="noopener">Code caching for JavaScript developers</a></li><li><a href="https://medium.com/reloading/javascript-start-up-performance-69200f43b201" target="_blank" rel="noopener">JavaScript Start-up Performance</a></li><li><a href="https://v8.dev/blog/improved-code-caching" target="_blank" rel="noopener">Improved code caching</a></li><li><a href="https://fed.taobao.org/blog/taofed/do71ct/speed-node-start-time/" target="_blank" rel="noopener">å¦‚ä½•åŠ å¿« Node.js åº”ç”¨çš„å¯åŠ¨é€Ÿåº¦</a></li></ul><p><br><br><br></p><p><strong>â‘¥ çª—å£é¢„çƒ­ ä¸ çª—å£æ± ã€çª—å£å¸¸é©»</strong></p><p>ä¸ºäº†è¿½èµ¶åŸç”Ÿçª—å£çš„æ‰“å¼€å’Œå±•ç¤ºé€Ÿåº¦ï¼Œæˆ‘ä»¬è¿ç”¨äº†å¾ˆå¤šæŠ€å·§ï¼Œç”¨ç©ºé—´æ¥æ¢å–æ—¶é—´ã€‚</p><p>ä¾‹å¦‚æˆ‘ä»¬çš„åº”ç”¨é¦–é¡µï¼Œç”¨æˆ·åœ¨æ‰“å¼€ç™»å½•é¡µé¢æ—¶ï¼Œæˆ‘ä»¬å°±ä¼šåœ¨<strong>åå°é¢„çƒ­</strong>ï¼Œå°†è¯¥åŠ è½½çš„èµ„æºéƒ½å‡†å¤‡å¥½ï¼Œåœ¨ç™»å½•æˆåŠŸåï¼Œå°±å¯ä»¥ç«‹å³æ¸²æŸ“æ˜¾ç¤ºã€‚çª—å£æ‰“å¼€çš„å»¶æ—¶å¾ˆçŸ­ï¼ŒåŸºæœ¬æ¥è¿‘åŸç”Ÿçš„çª—å£ä½“éªŒã€‚</p><p>è¿™é‡Œç”¨åˆ°äº†ä¸€äº› Hack æ‰‹æ®µï¼Œæˆ‘ä»¬å°†è¿™äº›çª—å£æ”¾åˆ°äº†å±å¹•ä¹‹å¤–ï¼Œå¹¶è®¾ç½® <code>skipTaskBar</code> æ¥å®ç°éšè—æˆ–è€…å…³é—­çš„æ•ˆæœã€‚</p><p><br></p><p>å¯¹äºé¢‘ç¹å¼€å¯/å…³é—­çš„çª—å£ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨<strong>çª—å£æ± </strong>æ¥ä¼˜åŒ–ã€‚æ¯”å¦‚ Webview é¡µé¢ï¼Œæ‰“å¼€çš„ä¸€ä¸ª Webview é¡µé¢æ—¶ï¼Œä¼šä¼˜å…ˆä»çª—å£æ± ä¸­é€‰å–ï¼Œå½“çª—å£æ± ä¸ºç©ºæ—¶æ‰åˆ›å»ºæ–°çš„çª—å£, åé¢é¡µé¢å…³é—­åä¼šå†æ”¾å›çª—å£æ± ä¸­ï¼Œæ–¹ä¾¿åç»­å¤ç”¨ã€‚</p><p>å¦å¤–ï¼Œå¯¹äºä¸šåŠ¡æ— å…³çš„ã€é€šç”¨çš„çª—å£ï¼Œä¹Ÿå¯ä»¥é‡‡ç”¨<strong>å¸¸é©»æ¨¡å¼</strong>ï¼Œä¾‹å¦‚é€šçŸ¥ï¼Œå›¾ç‰‡æŸ¥çœ‹å™¨ã€‚è¿™äº›çª—å£ä¸€æ—¦åˆ›å»ºå°±ä¸ä¼šé‡Šæ”¾ï¼Œæ‰“å¼€æ•ˆæœä¼šæ›´å¥½ã€‚</p><p><br></p><p><strong>â‘¦ è·Ÿè¿› Electron æœ€æ–°ç‰ˆæœ¬</strong></p><p>ä¿æŒç‰ˆæœ¬çš„æ›´æ–°ã€‚</p><p><br></p><h4 id="2-2-è¿½èµ¶åŸç”Ÿçš„äº¤äº’ä½“éªŒ"><a href="#2-2-è¿½èµ¶åŸç”Ÿçš„äº¤äº’ä½“éªŒ" class="headerlink" title="2.2 è¿½èµ¶åŸç”Ÿçš„äº¤äº’ä½“éªŒ"></a>2.2 è¿½èµ¶åŸç”Ÿçš„äº¤äº’ä½“éªŒ</h4><p>ç™½å±æ—¶é—´çš„ä¼˜åŒ–åªæ˜¯ä¸€ä¸ªå¼€å§‹ï¼Œåº”ç”¨ä½¿ç”¨è¿‡ç¨‹ä¸­çš„äº¤äº’ä½“éªŒä¹Ÿæ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„éƒ¨åˆ†ã€‚ä¸‹é¢è®²è®²æˆ‘ä»¬çš„ä¸€äº›ä¼˜åŒ–æ‰‹æ®µï¼š</p><p><br></p><p><strong>â‘  é™æ€èµ„æºç¼“å­˜</strong></p><p>å¯¹äºä¸€äº›ç½‘ç»œèµ„æºï¼Œæˆ‘ä»¬é‡‡å–äº†ä¸€äº›ç¼“å­˜æ‰‹æ®µï¼Œä¿è¯å®ƒä»¬å±•ç¤ºçš„é€Ÿåº¦ã€‚æˆ‘ä»¬ç›®å‰é‡‡ç”¨çš„æ˜¯ Service-Worker + Workbox çš„æ–¹å¼ï¼Œåˆ©ç”¨ Service-Worker å¯ä»¥æ‹¦æˆªå¤šä¸ªé¡µé¢çš„ç½‘ç»œè¯·æ±‚ï¼Œä»è€Œå®ç°è·¨é¡µé¢çš„é™æ€èµ„æºç¼“å­˜ï¼Œè¿™ç§æ–¹å¼å®ç°æ¯”è¾ƒç®€å•ã€‚</p><p>é™¤äº† Service Workerï¼Œä¹Ÿå¯ä»¥é€šè¿‡åè®®æ‹¦æˆªæ–¹å¼æ¥å®ç°ã€‚è¯¦è§: <a href="https://electronjs.org/docs/api/protocol" target="_blank" rel="noopener">protocol</a>ã€‚åé¢æœ‰æ—¶é—´å†å°è¯•ä¸€ä¸‹ï¼Œçœ‹æ•ˆæœæ€ä¹ˆæ ·ã€‚</p><p><br></p><p><strong>â‘¡ é¢„åŠ è½½æœºåˆ¶</strong></p><p>å¦‚æœä½ çœ‹è¿‡æˆ‘çš„ <a href="https://juejin.im/post/5dadc6045188255a270a0f85" target="_blank" rel="noopener">ã€Šè¿™å¯èƒ½æ˜¯æœ€é€šä¿—çš„ React Fiber(æ—¶é—´åˆ†ç‰‡) æ‰“å¼€æ–¹å¼ã€‹</a>, åº”è¯¥è§è¯†åˆ° <code>requestIdleCallback</code> çš„å¼ºå¤§ï¼ŒReact åˆ©ç”¨å®ƒæ¥è°ƒåº¦ä¸€äº›æ¸²æŸ“ä»»åŠ¡ï¼Œä¿è¯æµè§ˆå™¨å“åº”ç”¨æˆ·çš„äº¤äº’ã€‚</p><p>è¿™ä¸ª API å¯¹äºæˆ‘ä»¬çš„åº”ç”¨ä¼˜åŒ–ä¹Ÿæœ‰é‡è¦çš„æ„ä¹‰ã€‚é€šè¿‡å®ƒæˆ‘ä»¬å¯ä»¥çŸ¥é“æµè§ˆå™¨çš„èµ„æºåˆ©ç”¨æƒ…å†µï¼Œåˆ©ç”¨æµè§ˆå™¨ç©ºé—²æ—¶é—´æ¥é¢„æ‰§è¡Œä¸€äº›ä½ä¼˜å…ˆçº§çš„ä»»åŠ¡ã€‚æ¯”å¦‚ï¼š</p><ul><li>æ¸²æŸ“éšè—çš„ Tab</li><li>å»¶ååŠ è½½çš„æ¨¡å—ä»£ç </li><li>æƒ°æ€§åŠ è½½çš„å›¾ç‰‡</li><li>æœªæ¿€æ´»çš„ä¼šè¯</li><li>æ‰§è¡Œä½ä¼˜å…ˆçº§çš„ä»»åŠ¡</li><li>â€¦</li></ul><p><br></p><p>ä¾‹å¦‚ React ä»£ç åˆ†å‰²ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">lazy</span>(<span class="params">factory, Fallback</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> Comp = l(factory)</span><br><span class="line">  <span class="comment">// é¢„åŠ è½½è°ƒåº¦</span></span><br><span class="line">  scheduleIdle(&#123;</span><br><span class="line">    name: <span class="string">'LazyComponent'</span>,</span><br><span class="line">    size: TaskSize.Heavy,</span><br><span class="line">    task: factory,</span><br><span class="line">    timeout: <span class="number">2000</span>,</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">LazyComponent</span>(<span class="params">props</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;Suspense fallback=&#123;Fallback ? <span class="xml"><span class="tag">&lt;<span class="name">Fallback</span> /&gt;</span> : null&#125;&gt;</span></span><br><span class="line">        &lt;Comp &#123;...props&#125; /&gt;</span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">Suspense</span>&gt;</span></span></span><br><span class="line"><span class="xml">    )</span></span><br><span class="line"><span class="xml">  &#125; as typeof Comp</span></span><br><span class="line"><span class="xml">&#125;</span></span><br></pre></td></tr></table></figure><p><br></p><p>ä½¿ç”¨:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> List = lazy(<span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">import</span>(<span class="string">'./List'</span>))</span><br></pre></td></tr></table></figure><p><br></p><p><strong>â‘¢ é¿å…åŒæ­¥æ“ä½œ</strong></p><p>Electron å¯ä»¥é€šè¿‡ NodeJS è¿›è¡Œ I/O æ“ä½œï¼Œä½†æ˜¯æˆ‘ä»¬ä¸€å®šè¦å°½é‡é¿å…åŒæ­¥ I/Oã€‚ä¾‹å¦‚åŒæ­¥çš„æ–‡ä»¶æ“ä½œã€åŒæ­¥çš„è¿›ç¨‹é—´é€šä¿¡ã€‚å®ƒä»¬ä¼šé˜»å¡é¡µé¢çš„æ¸²æŸ“å’Œäº‹ä»¶äº¤äº’ã€‚</p><p><br></p><p><strong>â‘£ å‡å°‘ä¸»è¿›ç¨‹è´Ÿè·</strong></p><p>Electron çš„ä¸»è¿›ç¨‹éå¸¸é‡è¦ã€‚å®ƒæ˜¯æ‰€æœ‰çª—å£çš„çˆ¶è¿›ç¨‹ï¼Œå®ƒè´Ÿè´£è°ƒåº¦å„ç§èµ„æºã€‚å¦‚æœä¸»è¿›ç¨‹è¢«é˜»å¡ï¼Œå°†å½±å“æ•´ä¸ªåº”ç”¨å“åº”æ€§èƒ½ã€‚</p><p>ä½ å¯ä»¥åšä¸€ä¸ªç®€å•çš„å®éªŒï¼Œåœ¨ä¸»è¿›ç¨‹ä¸Šæ‰“ä¸€ä¸ªæ–­ç‚¹ï¼Œä½ ä¼šå‘ç°æ‰€æœ‰çš„é¡µé¢çª—å£éƒ½ä¼šå¤±å»å“åº”ï¼Œå°½ç®¡å®ƒä»¬åœ¨å„è‡ªä¸åŒçš„è¿›ç¨‹ã€‚è¿™æ˜¯å› ä¸ºæ‰€æœ‰ç”¨æˆ·äº¤äº’éƒ½æ˜¯ç”±ä¸»è¿›ç¨‹åˆ†å‘ç»™æ¸²æŸ“è¿›ç¨‹çš„ï¼Œä¸»è¿›ç¨‹é˜»å¡äº†ï¼Œæ¸²æŸ“è¿›ç¨‹å½“ç„¶æ— æ³•æ¥æ”¶ç”¨æˆ·äº‹ä»¶å•¦ã€‚</p><p>æ‰€ä»¥ä¸è¦è®©ä¸»è¿›ç¨‹å¹²è„æ´»ç´¯æ´»ï¼Œèƒ½åœ¨æ¸²æŸ“è¿›ç¨‹åšçš„ï¼Œå°±åœ¨æ¸²æŸ“è¿›ç¨‹åšã€‚<strong>åƒä¸‡é¿å…åœ¨ä¸»è¿›ç¨‹ä¸­è·‘è®¡ç®—å¯†é›†ä»»åŠ¡å’ŒåŒæ­¥I/O</strong>ã€‚</p><p><br></p><p><strong>â‘¤ åˆ†ç¦»CPUå¯†é›†å‹æ“ä½œåˆ°å•ç‹¬è¿›ç¨‹æˆ–Worker, é¿å…é˜»å¡UI</strong></p><p><br></p><p><strong>â‘¥ React ä¼˜åŒ–</strong></p><p>è§ <a href="https://juejin.im/post/5d045350f265da1b695d5bf2" target="_blank" rel="noopener">ã€ŠReact æ€§èƒ½ä¼˜åŒ–çš„æ–¹å‘ã€‹</a></p><p><br></p><p><strong>â‘¦ æ”¾å¼ƒCSS-in-js</strong></p><p>æˆ‘ä»¬ä¸ºäº†å‹ç¼©è¿è¡Œæ—¶æ€§èƒ½ï¼Œèƒ½åœ¨ç¼–è¯‘æ—¶åšçš„å°±åœ¨ç¼–è¯‘æ—¶åšï¼Œæ”¾å¼ƒäº† CSS-in-js æ–¹æ¡ˆï¼Œä½¿ç”¨çº¯ CSS + BEM æ¥ç¼–å†™æ ·å¼ã€‚ä¸»è¦æœ‰ä¸¤ä¸ªåŸå› :</p><ul><li>Electron ä½¿ç”¨è¾ƒæ–°çš„ Chromeï¼Œç°ä»£ CSS å·²ç»å¾ˆå¼ºå¤§</li><li>æˆ‘ä»¬ä½¿ç”¨äº†çª—å£é¢„çƒ­æœºåˆ¶ï¼Œå¯ä»¥ç‡å…ˆè§£æè¿™éƒ¨åˆ† CSS ä»£ç ã€‚è€Œ CSS-in-js æ–¹æ¡ˆåˆ™æ˜¯ç»„ä»¶æ¸²æŸ“æ—¶ï¼ŒåŠ¨æ€ç”Ÿæˆçš„ã€‚</li></ul><p><br></p><p><strong>â‘§ æ²¡æœ‰é€€è·¯äº†ï¼Œé‚£å°±åªèƒ½ä¸Š Node åŸç”Ÿæ¨¡å—äº†</strong></p><p>çœŸå¥½ï¼Œè¿˜æœ‰é€€è·¯</p><p><br><br><br></p><h4 id="2-3-ä¼˜åŒ–è¿›ç¨‹é€šä¿¡"><a href="#2-3-ä¼˜åŒ–è¿›ç¨‹é€šä¿¡" class="headerlink" title="2.3 ä¼˜åŒ–è¿›ç¨‹é€šä¿¡"></a>2.3 ä¼˜åŒ–è¿›ç¨‹é€šä¿¡</h4><p>æ¶‰åŠåˆ°å¤šé¡µé¢/çª—å£çš„ Electron åº”ç”¨ï¼ŒIPC ä¼šéå¸¸é¢‘ç¹ï¼Œæä¸å¥½ä¼šæˆä¸ºæ€§èƒ½ç“¶é¢ˆã€‚</p><p><br></p><p><strong>â‘  å·¨å‘ remote</strong></p><p><a href="https://electronjs.org/docs/api/remote" target="_blank" rel="noopener">remote</a> æä¾›äº†ä¸€ç§ç®€ä¾¿çš„ã€æ— ä¾µå…¥çš„å½¢å¼æ¥è®¿é—®ä¸»è¿›ç¨‹çš„APIå’Œæ•°æ®ã€‚<strong>å…¶åº•å±‚åŸºäºåŒæ­¥çš„ IPC</strong>ã€‚ä½ å¯ä»¥é€šè¿‡æˆ‘<a href="https://juejin.im/post/5d4b79a3e51d4561b072dcb0" target="_blank" rel="noopener">è¿™ç¯‡æ–‡ç« </a>æ¥äº†è§£å®ƒçš„åŸç†ã€‚</p><p>å‘åœ¨å“ªé‡Œå‘¢ï¼Ÿ</p><p>â‘  å®ƒæ˜¯åŒæ­¥çš„<br>â‘¡ å±æ€§åŠ¨æ€è·å–ã€‚ä¸ºäº†ç¡®ä¿ä½ èƒ½å¤Ÿè·å–åˆ°æœ€æ–°çš„å€¼ï¼Œremoteåº•å±‚å¹¶ä¸ä¼šè¿›è¡Œç¼“å­˜ï¼Œè€Œæ˜¯æ¯æ¬¡è·å–ä¸€ä¸ªå±æ€§å°±åŠ¨æ€åˆ°ä¸»è¿›ç¨‹ä¸­å–ã€‚</p><p>æ¯”å¦‚è·å–ä¸€ä¸ªä¸»è¿›ç¨‹ä¸­çš„å¯¹è±¡:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ä¸»è¿›ç¨‹</span></span><br><span class="line">global.foo = &#123;</span><br><span class="line">  foo: <span class="number">1</span>,</span><br><span class="line">  bar: &#123;</span><br><span class="line">    baz: <span class="number">2</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¸²æŸ“è¿›ç¨‹è®¿é—®:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;remote&#125; <span class="keyword">from</span> <span class="string">'electron'</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">JSON</span>.stringify(remote.getGlobal(<span class="string">'foo'</span>))</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä¼šè§¦å‘ 4 æ¬¡ åŒæ­¥ IPC: getGlobalã€fooã€barã€bar.bazã€‚å¯¹äºå¤æ‚çš„æ•°æ®ï¼Œè¿™ä¸ªæ¶ˆè€—å°±å¾ˆéš¾å¿å—äº†ã€‚</p><p>ä¸è¦ä½¿ç”¨ remoteï¼Œé™¤éä½ çŸ¥é“ä½ è‡ªå·±åœ¨å¹²ä»€ä¹ˆã€‚</p><p><br><br><br></p><p><strong>â‘¡ å°è£…IPC åº“</strong></p><p>ä¸ºäº†ä¼˜åŒ– IPC é€šä¿¡ï¼Œæˆ‘ä»¬è‡ªå·±åŸºäºElectron çš„IPCæ¥å£, å°è£…äº†è‡ªå·±çš„ä¸€å¥— RPC åº“ã€‚ä¸»è¦ç‰¹å¾æœ‰:</p><ul><li>å¼‚æ­¥çš„ã€‚æ²¡æœ‰åŒæ­¥çš„é€‰é¡¹ã€‚é¿å…å¹²è ¢äº‹</li><li>æ¶ˆæ¯åˆå¹¶ã€‚åˆå¹¶äº‹ä»¶æ¨é€ï¼Œæ‰¹é‡ä¼ é€’</li><li>åºåˆ—åŒ–ã€‚ç›´æ¥ä¼ é€’ JSON å­—ç¬¦ä¸²ï¼Œä¸è®© Electron å¹²æ¶‰åºåˆ—åŒ–ã€‚Electron å†…éƒ¨åºåˆ—åŒ–ç¨å¾®æœ‰ç‚¹å¤æ‚ï¼Œæ¯”å¦‚ä¼šå¤„ç† Buffer ç­‰ç‰¹æ®Šç±»å‹ã€‚</li><li>ä¸€è‡´åŒ–çš„ã€ç®€å•æ˜“ç”¨çš„ APIã€‚ä½¿ç”¨ä¸€æ ·åœ¨æ¥å£æ”¯æŒä¸»è¿›ç¨‹ä¸æ¸²æŸ“è¿›ç¨‹ï¼Œä»¥åŠæ¸²æŸ“è¿›ç¨‹ä¸æ¸²æŸ“è¿›ç¨‹ä¹‹é—´åŒå‘é€šä¿¡ã€‚</li></ul><p>ä¸¾ä¸ªä¾‹å­:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> rpc <span class="keyword">from</span> <span class="string">'myrpc'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ³¨å†Œæ–¹æ³•</span></span><br><span class="line">rpc.registerHandler(<span class="string">'echo'</span>, <span class="keyword">async</span> data =&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> data</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// äº‹ä»¶ç›‘å¬</span></span><br><span class="line">rpc.on(<span class="string">'some-event'</span>, (data, source) =&gt; &#123;</span><br><span class="line">  <span class="comment">// dosomething</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>å®¢æˆ·ç«¯:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> rpc <span class="keyword">from</span> <span class="string">'myrpc'</span></span><br><span class="line"></span><br><span class="line">rpc.emit(target, <span class="string">'some-event'</span>) <span class="comment">// target ä¸ºæ¥æ”¶çš„çª—å£æˆ–è€…ä¸»è¿›ç¨‹ã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–¹æ³•è°ƒç”¨</span></span><br><span class="line"><span class="keyword">const</span> res = <span class="keyword">await</span> rpc.callHandler(target, <span class="string">'echo'</span>, <span class="string">'hello-world'</span>)</span><br></pre></td></tr></table></figure><p><br></p><p>è¿˜ä¸å¤Ÿï¼Œæˆ‘ä»¬è¿˜åœ¨ä¼˜åŒ–ï¼Œåç»­å†åˆ†äº«ç»™å¤§å®¶ã€‚</p><p><br><br><br></p><h2 id="å‘è¿˜æ˜¯ä¼šæœ‰çš„"><a href="#å‘è¿˜æ˜¯ä¼šæœ‰çš„" class="headerlink" title="å‘è¿˜æ˜¯ä¼šæœ‰çš„"></a>å‘è¿˜æ˜¯ä¼šæœ‰çš„</h2><p>ä¸€è·¯èµ°æ¥ä¹Ÿé‡åˆ°å¾ˆå¤šå‘ã€‚ç—›å¹¶å¿«ä¹ç€ã€‚</p><ul><li>çª—å£é˜´å½±ã€åœ†è§’</li><li>å‰ªåˆ‡æ¿ä¸å¤Ÿå¼ºå¤§</li><li>remote å·¨å‘</li><li>ä¸€äº›å…¼å®¹é—®é¢˜</li><li>ä¸»è¿›ç¨‹å´©æºƒï¼Œæ¸²æŸ“è¿›ç¨‹ä¸ä¼šé€€å‡ºï¼Œå¯¼è‡´è¿›ç¨‹â€˜æº¢å‡ºâ€™</li><li>æˆªå±ã€‚åˆšå¼€å§‹ç”¨ Electron å®ç°ï¼Œæ•ˆæœä¸å¥½ï¼Œç°åœ¨æ˜¯åŸç”Ÿå®ç°</li><li>â€¦</li></ul><p><br><br><br></p><h2 id="æ‰©å±•èµ„æ–™"><a href="#æ‰©å±•èµ„æ–™" class="headerlink" title="æ‰©å±•èµ„æ–™"></a>æ‰©å±•èµ„æ–™</h2><ul><li><a href="https://zhuanlan.zhihu.com/p/96041706" target="_blank" rel="noopener">ä» VSCode çœ‹å¤§å‹ IDE æŠ€æœ¯æ¶æ„</a></li><li><a href="https://electronjs.org/docs/tutorial/performance" target="_blank" rel="noopener">Electron Performance</a></li><li><a href="https://www.youtube.com/watch?v=r0OeHRUCCb4" target="_blank" rel="noopener">CovalenceConf 2019: Visual Studio Code â€“ The First Second</a></li><li><a href="https://developers.google.com/web/tools/chrome-devtools/evaluate-performance/" target="_blank" rel="noopener">Get Started With Analyzing Runtime Performance</a></li><li><a href="https://github.com/atom/electron-link" target="_blank" rel="noopener">electron-link</a></li><li><a href="http://peterforgacs.github.io/2018/09/12/How-to-create-a-V8-snapshot-of-your-javascript-file/" target="_blank" rel="noopener">How to Create a V8 Heap Snapshot of a Javascript File and Use It in Electron</a></li><li><a href="https://blog.atom.io/2018/01/10/the-state-of-atoms-performance.html" target="_blank" rel="noopener">The State of Atomâ€™s Performance</a></li><li><a href="https://blog.atom.io/2017/04/18/improving-startup-time.html" target="_blank" rel="noopener">Improving Startup Time</a></li></ul><p><br><br><br></p><p><img src="/images/group.jpeg" alt><br><em>å›å¤: <code>ivan</code> è¿›ç¾¤</em></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;2019 å¹´æœ€åä¸€å‘ï¼Œè°ˆè°ˆè¿™åŠå¹´ Electron åº”ç”¨å¼€å‘å’Œä¼˜åŒ–å¿ƒå¾—ã€‚å¹²è´§ä¹ŸæŒºå¤šï¼Œå¸Œæœ›èƒ½ç»™ä½ å¸¦æ¥ä¸€ç‚¹å¯å‘ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹åŠå¹´å¯ä»¥æ‹¿å‡ºæ¥è¯´ä¸€è¯´çš„é¡¹ç›®ï¼Œä¼°è®¡å°±æ˜¯æˆ‘ä»¬ç”¨ Electron é‡æ„äº†ä¸€ä¸ªæ¡Œé¢ç«¯åº”ç”¨ã€‚è¿™ä¸ªåº”ç”¨ç±»ä¼¼äº&lt;code&gt;é’‰é’‰&lt;/code&gt;æˆ–è€…&lt;code&gt;ä¼ä¸š
      
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://bobi.ink/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>if æˆ‘æ˜¯å‰ç«¯Leaderï¼Œè°ˆè°ˆå‰ç«¯æ¡†æ¶ä½“ç³»å»ºè®¾</title>
    <link href="https://bobi.ink/2019/12/06/fe-framework/"/>
    <id>https://bobi.ink/2019/12/06/fe-framework/</id>
    <published>2019-12-05T16:00:00.000Z</published>
    <updated>2023-06-01T09:55:14.328Z</updated>
    
    <content type="html"><![CDATA[<p>è¿™æœŸæ¥èŠä¸€èŠå‰ç«¯æ¡†æ¶ã€‚</p><p>â€œif æˆ‘æ˜¯å‰ç«¯ Leaderâ€ æ˜¯æˆ‘çš„ä¸€ä¸ªæ–‡ç« ç³»åˆ—ï¼Œè¯´è¯´æˆ‘äººåœ¨å…¶ä½ï¼Œæ¬²è°‹å…¶èŒçš„ä¸€äº›ç‚¹ç‚¹æ»´æ»´æ„Ÿæ‚Ÿã€‚è·Ÿå‰ç«¯ Leader åªæœ‰é‚£ä¹ˆä¸€ä¸¢ä¸¢å…³ç³»ï¼Œå¹²è´§ä¸å¤šï¼Œä½†è€å°‘çš†å®œï¼Œä¸è¦è¢«æ ‡é¢˜ç»™å”¬ä½äº†ã€‚</p><p><br></p><p><strong>æ–‡ç« å¤§çº²</strong></p><p><br></p><!-- TOC --><ul><li><a href="#ä»€ä¹ˆæ˜¯æ¡†æ¶">ä»€ä¹ˆæ˜¯æ¡†æ¶?</a></li><li><a href="#å‰ç«¯æ¡†æ¶çš„å‘å±•å†ç¨‹">å‰ç«¯â€˜æ¡†æ¶â€™çš„å‘å±•å†ç¨‹</a><ul><li><a href="#å‰ç«¯æ¡†æ¶å¯è’™é˜¶æ®µ">å‰ç«¯æ¡†æ¶å¯è’™é˜¶æ®µ</a></li><li><a href="#é‡è›®ç”Ÿé•¿æœŸ">é‡è›®ç”Ÿé•¿æœŸ</a></li><li><a href="#å‰ç«¯æ¡†æ¶æ•´åˆæœŸ">å‰ç«¯æ¡†æ¶æ•´åˆæœŸ</a></li></ul></li><li><a href="#ç°æœ‰çš„æ¡†æ¶éƒ½æœ‰ä»€ä¹ˆ">ç°æœ‰çš„æ¡†æ¶éƒ½æœ‰ä»€ä¹ˆï¼Ÿ</a></li><li><a href="#è°ˆè°ˆå‰ç«¯å›¢é˜Ÿæ¡†æ¶ä½“ç³»çš„å»ºè®¾">è°ˆè°ˆå‰ç«¯å›¢é˜Ÿæ¡†æ¶ä½“ç³»çš„å»ºè®¾</a><ul><li><a href="#ç¬¬ä¸€é˜¶æ®µ-å‰ç«¯å·¥ç¨‹åŒ–--åŸºç¡€è®¾æ–½">ç¬¬ä¸€é˜¶æ®µ: å‰ç«¯å·¥ç¨‹åŒ– / åŸºç¡€è®¾æ–½</a></li><li><a href="#ç¬¬äºŒé˜¶æ®µ-åº”ç”¨å¼€å‘æ–¹æ¡ˆæ•´åˆ">ç¬¬äºŒé˜¶æ®µ: åº”ç”¨å¼€å‘æ–¹æ¡ˆæ•´åˆ</a></li><li><a href="#ç¬¬ä¸‰é˜¶æ®µ-ç»„ä»¶ä½“ç³»">ç¬¬ä¸‰é˜¶æ®µ: ç»„ä»¶ä½“ç³»</a></li><li><a href="#ç¬¬å››é˜¶æ®µæ‰“é€šä¸Šä¸‹æ¸¸">ç¬¬å››é˜¶æ®µï¼šæ‰“é€šä¸Šä¸‹æ¸¸</a></li><li><a href="#æœªæ¥-ai">æœªæ¥: AI?</a></li></ul></li><li><a href="#æ‰©å±•èµ„æ–™">æ‰©å±•èµ„æ–™</a></li></ul><!-- /TOC --><p><br><br><br></p><h2 id="ä»€ä¹ˆæ˜¯æ¡†æ¶"><a href="#ä»€ä¹ˆæ˜¯æ¡†æ¶" class="headerlink" title="ä»€ä¹ˆæ˜¯æ¡†æ¶?"></a>ä»€ä¹ˆæ˜¯æ¡†æ¶?</h2><p>è¿™åº”è¯¥ä¸æ˜¯æˆ‘ç¬¬ä¸€æ¬¡è°ˆâ€˜æ¡†æ¶â€˜äº†ã€‚React æ˜¯ä¸€ä¸ªæ¡†æ¶å—ï¼Ÿ Vue æ˜¯ä¸€ä¸ªæ¡†æ¶å—ï¼Ÿ ä¸¥æ ¼æ¥è¯´ä¸æ˜¯ï¼Œå®ƒä»¬åªæ˜¯ä¸€ä¸ªè§†å›¾è§£å†³æ–¹æ¡ˆï¼Œè¿™é‡Œé¢ç®—å¾—ä¸Šæ˜¯æ¡†æ¶çš„ä¼°è®¡åªæœ‰ Angularã€‚</p><p>å¦‚æœè¯´åç«¯æ¡†æ¶å›´ç»•ç€<code>æ•°æ®å­˜å‚¨</code>å»ºç«‹èµ·æ¥ï¼Œé‚£ä¹ˆå‰ç«¯æ¡†æ¶çš„åŸºç¡€å°±æ˜¯è§†å›¾åº“ï¼Œæ¯•ç«Ÿå‰ç«¯çš„æœ¬è´¨å·¥ä½œå°±æ˜¯è§†å›¾ã€‚è¿™æ˜¯ä¸ºä»€ä¹ˆå‰ç«¯ç”Ÿæ€åœˆä¸€èˆ¬æ˜¯å›´ç»•ç€è§†å›¾åº“å±•å¼€çš„ã€‚æ‰€ä»¥è¯´ï¼Œ<strong>å‰ç«¯æ¡†æ¶çš„åŸºç¡€æ˜¯â€˜è§†å›¾â€™åº“</strong>ã€‚</p><p>å¦‚æœè·Ÿåç«¯æ¡†æ¶æ¯”èµ·æ¥ï¼Œæˆç†Ÿçš„å‰ç«¯æ¡†æ¶å…¶å®ä¸å¤šã€‚</p><p><br></p><p><strong>ä»€ä¹ˆæ˜¯æ¡†æ¶ï¼Ÿ</strong></p><p><br></p><p>çœ‹ä¸ªä¾‹å­ã€‚æ‰“å¼€ <a href="https://umijs.org" target="_blank" rel="noopener">UmiJS</a>, å®ƒå¯¹è‡ªå·±çš„æè¿°æ˜¯:</p><blockquote><p><strong>å¯æ’æ‹”çš„ä¼ä¸šçº§ react åº”ç”¨æ¡†æ¶</strong></p></blockquote><p>å…³é”®å­—æ˜¯<strong>ä¼ä¸šçº§</strong>ã€‚ä»€ä¹ˆæ˜¯ä¼ä¸šçº§ï¼Œæˆ‘è‡ªå·±ä¹Ÿè¯´ä¸æ¸…æ¥šã€‚æˆ‘åªçŸ¥é“ React æ²¡æœ‰è¯´è‡ªå·±æ˜¯ä¼ä¸šçº§ï¼ŒKoaã€Express ä¹Ÿæ²¡æœ‰ï¼Œç„¶è€Œ <a href="https://eggjs.org" target="_blank" rel="noopener">Eggjs</a> å’Œ <a href="https://umijs.org" target="_blank" rel="noopener">Umijs</a> éƒ½è¯´å®ƒä»¬æ˜¯<strong>ä¼ä¸šçº§æ¡†æ¶</strong>ï¼›Angular é€šå¸¸ä¹Ÿå¸¸å¸¸è·Ÿä¼ä¸šçº§è¿™ä¸ªæ¦‚å¿µè”ç³»åœ¨ä¸€èµ·ï¼›è¯­è¨€å±‚é¢æœ‰ Javaã€‚</p><p>å¯¹æ¯”ä¸€ä¸‹ä»–ä»¬å°±çŸ¥é“äº†ï¼Œæˆ‘è§‰å¾—ä¼ä¸šçº§è¡¨ç¤ºå®ƒæ˜¯ <strong>é¢å‘ä¼ä¸šç”Ÿäº§ï¼Œç›®çš„æ˜¯æé«˜ä¼ä¸šçš„ç”Ÿäº§åŠ›</strong>ã€‚æ€»ç»“ä¸€ä¸‹æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p><p><br></p><ul><li>æ˜¯é«˜æ•ˆ + æˆç†Ÿæ–¹æ¡ˆçš„æ•´åˆ</li><li>å…³æ³¨ç”Ÿäº§çš„æ•´ä¸ªé“¾è·¯ï¼Œè€Œä¸æ˜¯æŸä¸ªç¯èŠ‚</li><li>æœ‰æ›´å¼ºçš„çº¦æŸå’Œé™åˆ¶</li><li>æ›´ä¸¥è‹›çš„è¦æ±‚ã€‚æ€§èƒ½ã€å¯æ‰©å±•æ€§(ä»¥åº”å¯¹ä¸åŒçš„éœ€æ±‚)ã€å¥å£®æ€§ã€ç¨³å®šæ€§ã€å¯ç”¨æ€§ã€å®‰å…¨æ€§</li><li>æ ‡å‡†åŒ–</li><li>ç»è¿‡ç”Ÿäº§ç¯å¢ƒéªŒè¯, æœ‰è¾ƒå¤šç”¨ä¾‹ä¿è¯</li></ul><p><br></p><p>å½’æ ¹åˆ°åº•è¿˜æ˜¯æˆæœ¬é—®é¢˜ï¼Œæ¡†æ¶æœ€æœ¬è´¨çš„ç›®çš„å°±æ˜¯è¦å‡ä½å„ç±»æˆæœ¬ã€‚è®©æ›´å°‘çš„äººå¯ä»¥åšæ›´å¤šçš„äº‹æƒ…ã€ä¸”èƒ½ä¿è¯è´¨é‡ã€é™ä½ç»´æŠ¤æˆæœ¬ï¼Œä¸”èƒ½ä¿è¯ä¸æ–­ä¼˜åŒ–å’Œæ¼”è¿›ã€‚</p><p><br></p><p><strong>ç»™ä¸ªå®šä¹‰å§ã€‚</strong></p><p><br></p><p><strong>å‰ç«¯æ¡†æ¶ä½“ç³»çš„å»ºç«‹ç¦»ä¸å¼€å‰ç«¯å·¥ç¨‹åŒ–æˆç†Ÿå’Œâ€˜æœ€ä½³å®è·µâ€˜çš„æ²‰æ·€â€™ã€‚ä½ å¯ä»¥è®¤ä¸ºæ¡†æ¶å°±æ˜¯ä¸€ä¸ªæ•´åˆçš„æ–¹æ¡ˆï¼Œæä¾›ä¸€ä¸ªå‰ç«¯â€˜æœ€ä½³â€˜çš„ç»„åˆé…ç½®ã€‚å¼€å‘è€…éœ€è¦åšçš„å°±æ˜¯åœ¨è¿™ä¸ªæ¡†æ¶çº¦æŸä¸‹å¡«å……è‡ªå·±ä¸šåŠ¡ä»£ç ã€‚</strong></p><p><br></p><p>å¥½å¤„ï¼š</p><ul><li>æ•ˆç‡æå‡ã€‚è®©å¼€å‘è€…å…³æ³¨ä¸šåŠ¡å¼€å‘</li><li>å­¦ä¹ æˆæœ¬é™ä½ã€‚æ¡†æ¶å°è£…äº†å¾ˆå¤šåº•å±‚å¤æ‚æ€§</li><li>æ›´å¼ºçš„çº¦æŸã€‚æ‰€æœ‰åŠ¨ä½œå¿…é¡»æŒ‰ç…§æ¡†æ¶è§„å®šçš„æ‰§è¡Œ, é¿å…å¹²åäº‹ã€è ¢äº‹ã€‚æ›´å¼ºçš„çº¦æŸä¹Ÿæ„å‘³ç€æ¡†æ¶é›†æˆåº¦æ›´é«˜ã€æ¡†æ¶å†…éƒ¨å¯ä»¥åšæ›´å¤šäº‹æƒ…ï¼Œä½†çµæ´»æ€§ä¹Ÿæ›´ä½ã€‚</li><li>äº§å“è´¨é‡ã€‚æ¡†æ¶å†…éƒ¨ä¼šè‡ªåŠ¨å¤„ç†å¾ˆå¤šäº‹æƒ…ï¼Œä¾‹å¦‚æ€§èƒ½ä¼˜åŒ–ã€å®‰å…¨æ€§å¤„ç†</li><li>å¯ç»´æŠ¤æ€§ã€‚æ‰€æœ‰é¡¹ç›®éƒ½æŒ‰ç…§ä¸€è‡´çš„ã€æ ‡å‡†åŒ–çš„è§„èŒƒå¼€å‘ï¼Œå‡çº§è¿­ä»£æ–¹ä¾¿ã€‚è¿™ä¸€ç‚¹å¯¹å›¢é˜Ÿé¡¹ç›®çš„å¯ç»´æŠ¤æ€§å¾ˆé‡è¦ã€‚</li></ul><p><br></p><p>åå¤„:</p><ul><li>çµæ´»æ€§ã€‚ä¸èƒ½æ»¡è¶³æ‰€æœ‰äººçš„éœ€æ±‚ï¼Œæœ€ä½³å®è·µè¿™ç§ä¸œè¥¿æœ‰ç‚¹æ­¦æ–­</li><li>æ»åæ€§ã€‚å…·ä½“æ–¹æ¡ˆå¯èƒ½ä¼šæ»åã€‚</li><li>å¤§è€Œå…¨ã€‚å¯¹äºæŸäº›é¡¹ç›®å¯èƒ½è¿‡é‡ã€‚</li></ul><p><br><br><br></p><h2 id="å‰ç«¯â€˜æ¡†æ¶â€™çš„å‘å±•å†ç¨‹"><a href="#å‰ç«¯â€˜æ¡†æ¶â€™çš„å‘å±•å†ç¨‹" class="headerlink" title="å‰ç«¯â€˜æ¡†æ¶â€™çš„å‘å±•å†ç¨‹"></a>å‰ç«¯â€˜æ¡†æ¶â€™çš„å‘å±•å†ç¨‹</h2><h3 id="å‰ç«¯æ¡†æ¶å¯è’™é˜¶æ®µ"><a href="#å‰ç«¯æ¡†æ¶å¯è’™é˜¶æ®µ" class="headerlink" title="å‰ç«¯æ¡†æ¶å¯è’™é˜¶æ®µ"></a>å‰ç«¯æ¡†æ¶å¯è’™é˜¶æ®µ</h3><p>åœ¨ Reactã€Vue æµè¡Œä¹‹å‰å·²ç»æœ‰è®¸å¤šâ€˜å‰ç«¯æ¡†æ¶â€˜ï¼Œä¾‹å¦‚ Angularã€Emberã€Backboneâ€¦</p><p>å®ƒä»¬å¤§éƒ¨åˆ†éƒ½å—åˆ°åç«¯æ¡†æ¶çš„å¯å‘ï¼Œå› ä¸ºå½“å¹´ä¹Ÿæ­£æ˜¯åç«¯æ¡†æ¶æœ€ç«çš„æ—¶å€™ï¼Œä¾‹å¦‚ Railsã€‚æ‰€ä»¥åœ¨å®ƒä»¬èº«ä¸Šä¼šçœ‹åˆ°å¾ˆå¤šåç«¯æ¡†æ¶çš„å½±å­ã€‚</p><p>ä½†æ˜¯å¾ˆå¤šåç«¯çš„å¼€å‘æ¨¡å¼ï¼Œåœ¨å‰ç«¯æœ‰ç‚¹åƒä¸å¼€ã€‚æ›´æœ¬è´¨çš„åŸå› æ˜¯å‰ç«¯å·¥ç¨‹åŒ–è¿˜ä¸æˆç†Ÿï¼ŒåŸºç¡€ç›¸å¯¹è–„å¼±ï¼Œéš¾ä»¥æ”¯æ’‘ä¸Šå±‚å»ºç­‘çš„å‘å±•ã€‚</p><p><br><br><br></p><h3 id="é‡è›®ç”Ÿé•¿æœŸ"><a href="#é‡è›®ç”Ÿé•¿æœŸ" class="headerlink" title="é‡è›®ç”Ÿé•¿æœŸ"></a>é‡è›®ç”Ÿé•¿æœŸ</h3><p>éšç€ NodeJS çš„æ™®åŠã€JavaScript è¯­è¨€æ—¥ç›Šå¼ºå¤§ï¼Œå‰ç«¯å·¥ç¨‹åŒ–é€æ­¥æ·±åŒ–ã€‚ React è¿™ç±»è§†å›¾åº“å‡ºæ¥åï¼Œå¾ˆå¤šä¸œè¥¿è¢«æ‰“ç¢é‡æ„, æ­£æ‰€è°“ç™¾èŠ±é½æ”¾ï¼Œæ¬£æ¬£å‘è£ã€‚</p><p>å›´ç»•ç€ä¸‰å¤§è§†å›¾åº“å„ç§å„æ ·çš„åº“ç™¾èŠ±é½æ”¾ï¼Œå‰ç«¯ä¹Ÿæ‹“å±•åˆ°äº†æµè§ˆå™¨ä»¥å¤–çš„é¢†åŸŸã€‚äººä»¬éƒ½ä¹äºé€ è½®å­ï¼Œä½¿ç”¨æœ€æ–°çš„æŠ€æœ¯ã€‚</p><p>ç”±äºå‘å±•å¾—å¤ªå¿«ï¼Œæ‰€è°“çš„æ¡†æ¶/æœ€ä½³å®è·µå¾ˆéš¾è¢«å¹¿æ³›æ¥å—ï¼Œæˆ–è€…å¾ˆå®¹æ˜“å°±è¿‡æ—¶äº†ï¼Œæ¯ä¸ªäººæ¯ä¸ªå›¢é˜Ÿæ›´çƒ­è¡·äºåˆ›é€ è‡ªå·±çš„ç»„åˆæ–¹æ¡ˆï¼Œå¾€å¾€ä¹Ÿåªé™äºå›¢é˜Ÿå†…éƒ¨ã€‚</p><p><br><br><br></p><h3 id="å‰ç«¯æ¡†æ¶æ•´åˆæœŸ"><a href="#å‰ç«¯æ¡†æ¶æ•´åˆæœŸ" class="headerlink" title="å‰ç«¯æ¡†æ¶æ•´åˆæœŸ"></a>å‰ç«¯æ¡†æ¶æ•´åˆæœŸ</h3><p>å‡ ä¹æ¯ä¸ªå›¢é˜Ÿéƒ½ä¼šé‡å¤èµ°è¿™æ ·çš„è·¯å­ï¼š<em>ç¨³å®šæŠ€æœ¯æ ˆã€å·¥ç¨‹åŒ–å»ºè®¾ã€åŸºç¡€åº“/ç»„ä»¶åº“å»ºè®¾ã€æ²‰æ·€è‡ªå·±çš„æœ€ä½³å®è·µ</em>ã€‚</p><p>å›¢é˜Ÿæ²¡æœ‰ä¸€å®šçš„å·¥ç¨‹èƒ½åŠ›å’Œèµ„æºå…¶å®æ˜¯å¾ˆéš¾å°†è¿™äº›é›¶æ•£çš„å®è·µä½“ç³»åŒ–ã€æœ‰æœºåœ°ç²˜åˆèµ·æ¥, é•¿æœŸæœ‰æ•ˆçš„ç»´æŠ¤æ›´æ–°æ›´æ˜¯ä¸€ä»¶éš¾äº‹, åŠé€”è€ŒåºŸçš„å±…å¤šã€‚</p><p>ç°åœ¨å‰ç«¯å‘å±•å¼€å§‹è¿›å…¥å¹³ç¨³é˜¶æ®µã€‚æ‰€ä»¥å¤§ä¸€ç»Ÿçš„å‰ç«¯â€˜æ¡†æ¶â€™å†ä¸€æ¬¡è¿›å…¥äººä»¬çš„è§†é‡ã€‚å°±åƒ Umi çš„ä½œè€… <a href="https://www.zhihu.com/people/chenchengpro/activities" target="_blank" rel="noopener">äº‘è°¦</a> è¯´çš„: <em>ç°åœ¨æ˜¯å·¥ä¸šåŒ–æ—¶ä»£, æ¡†æ¶åƒæ˜¯ä¸€ä¸ªé­”æ³•çƒï¼ŒæŠŠå„ç§æŠ€æœ¯æ ˆå¸åˆ°ä¸€èµ·ï¼ŒåŠ å·¥ååç»™ç”¨æˆ·ï¼Œä»¥æ­¤æ¥æ”¯æ’‘ä¸šåŠ¡</em>ã€‚</p><p><img src="/images/fe-framework/bigfish.jpg" alt><br><em>ä¸Šå›¾æ¥æºäº&lt;èš‚èšå‰ç«¯ç ”å‘æœ€ä½³å®è·µ&gt; PPT</em></p><p><br></p><p>æ¡†æ¶å°±æ˜¯å°†å„ç§æŠ€æœ¯æ ˆæ–¹æ¡ˆã€åŸºç¡€è®¾æ–½æ•´åˆèµ·æ¥, æš´éœ²æ ‡å‡†çš„ã€ä¸€è‡´æ€§çš„æ¥å£, è®©å¼€å‘è€…ä¸“æ³¨ä¸šåŠ¡å¼€å‘ã€‚</p><p><br><br><br></p><h2 id="ç°æœ‰çš„æ¡†æ¶éƒ½æœ‰ä»€ä¹ˆï¼Ÿ"><a href="#ç°æœ‰çš„æ¡†æ¶éƒ½æœ‰ä»€ä¹ˆï¼Ÿ" class="headerlink" title="ç°æœ‰çš„æ¡†æ¶éƒ½æœ‰ä»€ä¹ˆï¼Ÿ"></a>ç°æœ‰çš„æ¡†æ¶éƒ½æœ‰ä»€ä¹ˆï¼Ÿ</h2><p><strong>ä¸€ä¸ªå‰ç«¯å¼€å‘æ¡†æ¶åº”è¯¥æ¶µç›–å‰ç«¯å¼€å‘é“¾è·¯çš„å„ä¸ªç¯èŠ‚ã€‚ä¸ºçº¦æŸå’Œç®€åŒ–ä¸šåŠ¡å¼€å‘ã€æä¾›æœ‰ç”¨çš„æŒ‡å¯¼</strong>ã€‚</p><p>çœ‹çœ‹ç°æœ‰â€˜å‰ç«¯æ¡†æ¶â€˜å§ï¼Œç°åœ¨ç¤¾åŒºä¸Šæ¯”è¾ƒæµè¡Œçš„â€˜æ¡†æ¶â€™æœ‰ Angularã€Next.jsã€Nuxtã€Umiã€‚æˆ‘ä»¬æ¨ªå‘å¯¹æ¯”ä¸€ä¸‹å®ƒä»¬çš„ä¸€äº›ç‰¹æ€§ï¼Œå‘ç°åŸºæœ¬ä¸ŠåŒ…å«è¿™äº›ä¸œè¥¿ï¼š</p><p><img src="/images/fe-framework/framework-content.png" alt></p><p><br></p><p>è·Ÿè¡£æœçš„æ ‡å‡†ç ä¸€æ ·ã€‚ç¤¾åŒºå¼€æºçš„éƒ½æ˜¯é€šç”¨ç±»å‹æ¡†æ¶ï¼Œå¯ä»¥é¢„çŸ¥çš„æ˜¯å®ƒä»¬æ²¡æœ‰åŠæ³•æ»¡è¶³æ‰€æœ‰å›¢é˜Ÿçš„è¦æ±‚ã€‚æˆ‘ä»¬å¾€å¾€éœ€è¦æ ¹æ®è‡ªå·±ä¸šåŠ¡æƒ…å†µé‡èº«å®šåˆ¶æ¡†æ¶ã€‚</p><p>ä¸ºäº†åº”å¯¹è¿™äº›éœ€æ±‚ï¼Œä¸åŒçš„æ¡†æ¶ä¹Ÿæœ‰ä¸åŒçš„åº”å¯¹ç­–ç•¥:</p><ul><li><strong>æ›´å¼€æ”¾</strong>ã€‚æ¡†æ¶åªæä¾›æ ¸å¿ƒåŠŸèƒ½ï¼Œé™„åŠ å‡ ä¹ä»€ä¹ˆäº‹æƒ…éƒ½èƒ½å¹²çš„<strong>æ’ä»¶æœºåˆ¶</strong>ã€‚æ’ä»¶å¯ä»¥å¹²é¢„æ¡†æ¶çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸï¼Œä¸æ»¡è¶³çš„éœ€æ±‚å¯ä»¥è‡ªå·±å®šåˆ¶è‡ªå·±çš„æ’ä»¶</li><li><strong>æ›´å†³æ–­</strong>ã€‚æˆ‘ç»™ä½ æä¾›çš„å°±æ˜¯æœ€å¥½çš„ï¼Œèƒ½æ»¡è¶³ä½ çš„å°½é‡æ»¡è¶³ä½ ï¼Œå…¶ä»–çš„ä½ ä¸è¦ç®¡å¤ªå¤šï¼Œä¹Ÿæ²¡æœ‰å¿…è¦ç®¡, ä¸“æ³¨ä½ çš„ä¸šåŠ¡ã€‚</li></ul><p><br></p><p>æˆ‘ä»¬ä¹Ÿæœ‰è‡ªå·±çš„é€‰æ‹©ç­–ç•¥:</p><ul><li>è‡ªå·±æã€‚ä¾‹å¦‚å¤§å‚å›¢é˜Ÿï¼Œæœ‰èµ„æºã€æœ‰ä¸°å¯Œçš„å®è·µç»éªŒã€‚ä»–ä»¬æœ‰èƒ½åŠ›å°†è‡ªå·±çš„â€˜æœ€ä½³å®è·µâ€™ä½“ç³»åŒ–ã€‚ä»–ä»¬ä¼šé€‰æ‹©åˆ›å»ºè‡ªå·±çš„æ¡†æ¶ã€‚åŒæ—¶ä»–ä»¬ä¹Ÿä¹äºå°†ç»éªŒåˆ†äº«å‡ºæ¥ï¼Œä¹Ÿå¯ä»¥åˆ©ç”¨ç¤¾åŒºå®Œå–„è‡ªå·±çš„ä½œå“ã€‚ä¸ªäººï¼ŒåŸºäºå­¦ä¹ å’ŒæŠ˜è…¾çš„ç›®çš„, ä¹Ÿå¯ä»¥æä¸€å¥—ã€‚</li><li>åŸºäºå¼€æºæ¡†æ¶æ‰©å±•ã€‚å¯ä»¥å°†å¼€æºæ¡†æ¶ä½œä¸ºåŸºç¡€ï¼Œæ ¹æ®è‡ªå·±å›¢é˜Ÿæƒ…å†µè¿›è¡Œæ‰©å±•å¼€å‘ã€‚</li><li>å®Œå…¨ä½¿ç”¨å¼€æºæ¡†æ¶ã€‚å¼€æºæ¡†æ¶å¯ä»¥æ»¡è¶³è®¸å¤šé€šç”¨çš„éœ€æ±‚, é€‚åˆç®€å•çš„åº”ç”¨åœºæ™¯ã€‚<strong>æˆ‘ä»¬é€‰æ‹©ä¸€ä¸ªæ¡†æ¶ä¸»è¦æœ‰ä¸¤ä¸ªåŸå› ï¼šâ‘  æˆ‘ä»¬è¦æé«˜å·¥ä½œæ•ˆç‡ï¼›â‘¡ æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ ‡å‡†</strong>ã€‚ ä¸ºäº†æ ‡å‡†ï¼Œå…¶å®å¯å¦¥åä¸€äº›äº‹æƒ…ã€‚æ›´é‡è¦çš„æ˜¯è¿™äº›æ¡†æ¶æ˜¯åœ¨ä¸æ–­å‘å±•å’Œæ¼”è¿›çš„, ä»è€Œæˆ‘ä»¬å›¢é˜Ÿçš„æŠ€æœ¯ä¹Ÿå¯ä»¥å…è´¹åœ°è·Ÿéšä»–ä»¬æ¼”è¿›å’Œå‘å±•ã€‚å°†å¼€æºæ¡†æ¶çš„é»˜è®¤æœ€ä½³å®è·µå¼€å‘è§†ä¸ºæ ‡å‡†ã€‚</li></ul><p><br></p><p>æˆ‘ä¸€ç›´åšä¿¡<strong>ä¸“ä¸šçš„äººåšä¸“ä¸šçš„äº‹ã€‚è¦å–„äºå°†äº‹æƒ…å¤–åŒ…å‡ºå»ï¼Œè…¾ç©ºè‡ªå·±å»åšé‡è¦çš„äº‹æƒ…</strong>ã€‚å¤§å‚æœ‰ä¸“é—¨çš„å›¢é˜Ÿåœ¨åšå·¥å…·ã€å»ºè®¾åŸºç¡€è®¾æ–½ï¼Œç¤¾åŒºä¸Šå¼€æºçš„æ¡†æ¶ä¹Ÿç”±ä¸€å¤§å¸®ç‰›äººåœ¨ç»´æŠ¤ï¼Œè€Œä¸”é€šå¸¸å¼€å‘è¿­ä»£å¾ˆæ´»è·ƒã€‚æ‰€ä»¥è¯´ç¤¾åŒºå·²ç»æœ‰çš„æ–¹æ¡ˆï¼Œå¯ä»¥ç›´æ¥æ‹¿æ¥ç”¨ï¼Œä¸è¦è‡ªå·±å»é€ è½®å­ï¼Œå› ä¸ºä½ ä¸€èˆ¬æ²¡é‚£ä¹ˆå¤šç²¾åŠ›ã€‚</p><p><br><br><br></p><h2 id="è°ˆè°ˆå‰ç«¯å›¢é˜Ÿæ¡†æ¶ä½“ç³»çš„å»ºè®¾"><a href="#è°ˆè°ˆå‰ç«¯å›¢é˜Ÿæ¡†æ¶ä½“ç³»çš„å»ºè®¾" class="headerlink" title="è°ˆè°ˆå‰ç«¯å›¢é˜Ÿæ¡†æ¶ä½“ç³»çš„å»ºè®¾"></a>è°ˆè°ˆå‰ç«¯å›¢é˜Ÿæ¡†æ¶ä½“ç³»çš„å»ºè®¾</h2><p>å‰ç«¯å¼€å‘çš„æ—¶é—´éƒ½èŠ±åœ¨äº†å“ªé‡Œ?</p><p><img src="/images/fe-framework/time.jpg" alt><br><em>ä¸Šå›¾æ¥æºäº&lt;èš‚èšå‰ç«¯ç ”å‘æœ€ä½³å®è·µ&gt; PPT</em></p><p><br></p><p>å¯¹äºå‰ç«¯å›¢é˜Ÿæ¥è¯´ï¼Œå¼€æºå‰ç«¯æ¡†æ¶åªæ˜¯ä¸€ä¸ªåŸºç¡€ï¼Œåªæ˜¯æ¶‰åŠå‰ç«¯å¼€å‘çš„æŸä¸ªå¾ˆå°çš„éƒ¨åˆ†ï¼Œå®ƒå°±åƒä¸€è‰˜èˆ¹ã€‚ä½ è¦èˆªçº¿ç©¿è¶Šå¤§è¥¿æ´‹ï¼Œè¿˜æœ‰åšå¾ˆå¤šå·¥ä½œã€éœ€è¦ç´§å¯†é«˜æ•ˆçš„åä½œã€å¯é çš„åå‹¤ä¿éšœã€ç›®æ ‡å’Œæ–¹å‘ã€åšå®šçš„é¢†å¯¼â€¦ è·¯è¿˜å¾ˆé•¿ã€‚</p><p><strong>ç°åœ¨æ¥èŠèŠâ€˜å¹¿ä¹‰çš„â€˜æ¡†æ¶ä½“ç³»ï¼Œå®ƒé›†æˆè‡ªèº«ä¸šåŠ¡ï¼Œæ¶‰åŠå‰ç«¯å¼€å‘å®Œæ•´é“¾è·¯ï¼Œå…³æ³¨ç‚¹ä»å‰ç«¯åº”ç”¨ä¸Šå‡åˆ°äº†å‰ç«¯å›¢é˜Ÿç ”å‘ä½“ç³»</strong>ã€‚</p><p><br></p><p><img src="/images/fe-framework/framework-order.png" alt></p><p><br></p><p>ä¹å±‚ä¹‹å°ï¼Œèµ·äºç´¯åœŸã€‚ å‰ç«¯å›¢é˜Ÿæ¡†æ¶ä½“ç³»çš„å»ºè®¾æ˜¯ä¸€ä¸ªæ¸è¿›å¼çš„è¿‡ç¨‹ï¼Œé¦–å…ˆä»åŸºç¡€è®¾æ–½å¼€å§‹ã€æ¥ç€å°±æ˜¯åº”ç”¨å¼€å‘æŠ€æœ¯æ ˆç»„åˆï¼Œå†åˆ°ç»„ä»¶ä½“ç³»ï¼Œåé¢æ˜¯ä¸Šå±‚çš„ä¸šåŠ¡å¼€å‘æ–¹æ¡ˆâ€¦ ä¸Šå±‚ä»¥ä¸‹å±‚ä¸ºåŸºç¡€ï¼Œå…±åŒæ„å»ºå‡ºå®Œæ•´çš„æ¡†æ¶ä½“ç³»ã€‚</p><p>æˆ‘è§‰å¾—å‰ç«¯å›¢é˜Ÿå¯ä»¥æŒ‰ç…§è¿™æ ·çš„åˆ†å±‚ç»“æ„ï¼Œåˆ†é˜¶æ®µæ¥å®Œæˆè¿™äº›å»ºè®¾ä»»åŠ¡ã€‚</p><p><br></p><h3 id="ç¬¬ä¸€é˜¶æ®µ-å‰ç«¯å·¥ç¨‹åŒ–-åŸºç¡€è®¾æ–½"><a href="#ç¬¬ä¸€é˜¶æ®µ-å‰ç«¯å·¥ç¨‹åŒ–-åŸºç¡€è®¾æ–½" class="headerlink" title="ç¬¬ä¸€é˜¶æ®µ: å‰ç«¯å·¥ç¨‹åŒ– / åŸºç¡€è®¾æ–½"></a>ç¬¬ä¸€é˜¶æ®µ: å‰ç«¯å·¥ç¨‹åŒ– / åŸºç¡€è®¾æ–½</h3><p>æœ€åŸºç¡€çš„é˜¶æ®µï¼Œå…³æ³¨å‰ç«¯çš„åŸºç¡€è®¾æ–½å»ºè®¾ã€‚è¿™ä¸ªé˜¶æ®µå·²ç»æ¯”è¾ƒæˆç†Ÿï¼Œç¤¾åŒºä¸Šæœ‰å¾ˆå¤šå¼€ç®±å³ç”¨çš„æ–¹æ¡ˆï¼Œä¾‹å¦‚ Umiã€Next.jsã€Vue-CLIã€Create-React-App ç­‰ç­‰ã€‚ä¸»è¦å†…å®¹æœ‰:</p><p><img src="/images/fe-framework/base.png" alt></p><p><br></p><h3 id="ç¬¬äºŒé˜¶æ®µ-åº”ç”¨å¼€å‘æ–¹æ¡ˆæ•´åˆ"><a href="#ç¬¬äºŒé˜¶æ®µ-åº”ç”¨å¼€å‘æ–¹æ¡ˆæ•´åˆ" class="headerlink" title="ç¬¬äºŒé˜¶æ®µ: åº”ç”¨å¼€å‘æ–¹æ¡ˆæ•´åˆ"></a>ç¬¬äºŒé˜¶æ®µ: åº”ç”¨å¼€å‘æ–¹æ¡ˆæ•´åˆ</h3><p>åœ¨å®Œå–„åŸºç¡€è®¾æ–½çš„åŒæ—¶ï¼Œå›¢é˜Ÿçš„åº”ç”¨å¼€å‘æŠ€æœ¯æ ˆç»„åˆæ–¹æ¡ˆä¹Ÿåº”è¯¥ç¨³å®šä¸‹æ¥ï¼Œæˆä¸ºæ¡†æ¶çš„ä¸€éƒ¨åˆ†ã€‚è¿™äº›ç»„åˆä¹Ÿéå¸¸é‡è¦ï¼Œå®ƒä¼šå½±å“ä¸Šå±‚çš„ç»„ä»¶å»ºè®¾å’Œä¸šåŠ¡å¼€å‘ã€‚ä¸»è¦å†…å®¹æœ‰:</p><p><img src="/images/fe-framework/app-dev.png" alt></p><p><br></p><h3 id="ç¬¬ä¸‰é˜¶æ®µ-ç»„ä»¶ä½“ç³»"><a href="#ç¬¬ä¸‰é˜¶æ®µ-ç»„ä»¶ä½“ç³»" class="headerlink" title="ç¬¬ä¸‰é˜¶æ®µ: ç»„ä»¶ä½“ç³»"></a>ç¬¬ä¸‰é˜¶æ®µ: ç»„ä»¶ä½“ç³»</h3><p>ç»„ä»¶åŒ–ç°åœ¨æ˜¯å‰ç«¯ä¸»æµå¼€å‘æ¨¡å¼ï¼Œè¿™é‡Œè¿˜æœ‰å¾ˆå¤šå·¥ä½œå¯ä»¥åšï¼Œè¿˜æœ‰å¾ˆå¤§çš„ææ•ˆç©ºé—´ã€‚</p><p>æ•´ä¸ªç»„ä»¶ä½“ç³»ä¹Ÿæ˜¯ä¸€ä¸ªåˆ†å±‚å¼çš„ç»“æ„ï¼š</p><p><img src="/images/fe-framework/component.png" alt></p><ul><li>åŸºç¡€ç»„ä»¶ã€‚è¶Šåº•å±‚ï¼Œå°±è¯´æ˜å¯å¤ç”¨çš„ç¨‹åº¦è¶Šé«˜ã€è¶Šé€šç”¨ã€‚Ant-Designã€Element-UIã€iViewã€Material-UI è¿™äº›å°±å±äºåŸºç¡€ç»„ä»¶åº“ï¼Œæœ‰èƒ½åŠ›çš„å›¢é˜Ÿä¹Ÿå¯ä»¥å¼€å‘ä¸€å¥—ç¬¦åˆè‡ªå·±è®¾è®¡é£æ ¼çš„ç»„ä»¶åº“ã€‚</li><li>ä¸šåŠ¡ç»„ä»¶ã€‚åœ¨åŸºç¡€ç»„ä»¶ä¹‹ä¸Šå°è£…çš„ã€è€¦åˆè‡ªå·±ä¸šåŠ¡çš„ç»„ä»¶ã€‚å®ƒä»¬ä¸€èˆ¬ä»é‡å¤çš„ä¸šåŠ¡åœºæ™¯ä¸­æŠ½è±¡å‡ºæ¥ã€‚</li><li>åŒºå—ã€‚å†å¾€ä¸Šï¼Œå°±å¾ˆéš¾ç”¨æ¨¡å—åŒ–çš„ç»„ä»¶å»ç»„ç»‡äº†ã€‚äºæ˜¯æœ‰äºº(é˜¿é‡Œå‰ç«¯)æå‡ºäº†â€˜åŒºå—â€™çš„æ¦‚å¿µï¼Œ<strong>ä½ å¯ä»¥è®¤ä¸ºâ€˜åŒºå—â€™æ˜¯ï¼šä»£ç ç‰‡æ®µã€ä»£ç ç¤ºä¾‹ã€ä»£ç æ¨¡æ¿â€¦</strong> è¿™ä¹ˆçœ‹æ¥ï¼Œè¿™å¹¶ä¸æ˜¯ä¸€ç§æ–°çš„æ¦‚å¿µ? è¿˜æ²¡å®Œ! <strong>åŒºå—è¿˜è¦é…å¥—â€˜åŒºå—å¸‚åœºâ€™æ‰èƒ½å±•ç°å®ƒçš„ç”¨å¤„ã€‚åŒºå—å¸‚åœºæ˜¯ä¸€ä¸ªä»£ç ç‰‡æ®µåˆ†äº«å¹³å°ï¼Œç»´æŠ¤ç€å¤§é‡çš„åŒºå—ï¼Œè¯•å›¾è¦†ç›–å¤§éƒ¨åˆ†å¸¸è§çš„ä½¿ç”¨åœºæ™¯ã€‚å¯¹äºå¼€å‘è€…æ¥è¯´å°±æ˜¯æ‰¾åˆ°å°½é‡åŒ¹é…è‡ªå·±åœºæ™¯çš„åŒºå—ï¼Œæ‹·è´è¿‡æ¥ï¼Œç¨å¾®æ”¹æ”¹å°±è¡Œäº†ã€‚è¿™æ˜¯ä¸€ç§ â€˜Ctrl+Cï¼ŒCtrl+Vâ€™ ç¼–ç¨‹å“²å­¦çš„å®Œç¾å®è·µå•Š</strong>ã€‚</li><li>é¡µé¢ã€‚å’ŒåŒºå—å·®ä¸å¤šï¼Œå¿«é€Ÿç”Ÿæˆé¡µé¢å’Œè·¯ç”±ã€‚çº¦å®šå¼çš„è·¯ç”±å¯ä»¥ç»™é¡µé¢è‡ªåŠ¨åŒ–åˆ›å»ºå¸¦æ¥ä¸€äº›ä¾¿åˆ©ã€‚</li><li>å¸ƒå±€ã€‚ä¾‹å¦‚åå°çš„æ•´ä½“å¸ƒå±€ã€‚</li><li>é¡¹ç›®ã€‚é¡¹ç›®çš„æ•´ä½“ç»“æ„ã€‚å¯ä»¥é€šè¿‡â€˜è„šæ‰‹æ¶â€˜ æ¥å¿«é€Ÿç”Ÿæˆé¡¹ç›®æ¨¡æ¿ã€‚</li></ul><p><br></p><p><img src="/images/fe-framework/icework.png" alt></p><p><br></p><p>åƒåŒºå—ã€é¡µé¢ç”Ÿæˆè¿™äº›æ“ä½œéœ€è¦ä¸€äº›å·¥å…·è¾…åŠ©ã€‚ä¾‹å¦‚ï¼š</p><ul><li>ç”Ÿæˆå™¨ã€‚ç”Ÿæˆä¸åŒçº§åˆ«çš„å…ƒä»¶<ul><li>é¡¹ç›®(é¡¹ç›®æ¨¡æ¿)ã€‚ ä¿—ç§°è„šæ‰‹æ¶, æ”¯æŒä¸åŒçš„é¡¹ç›®ç±»å‹ï¼šåº”ç”¨ã€ç»„ä»¶åº“ã€ç¨‹åºåº“ã€ æ’ä»¶</li><li>é¡µé¢/è·¯ç”±</li><li>åŒºå—</li><li>ç»„ä»¶</li><li>æ•°æ®æ¨¡å‹</li></ul></li><li>å¯è§†åŒ–å·¥å…·ã€‚å¯è§†åŒ–çš„é¡¹ç›®ç¼–æ’å·¥å…·, å¦‚é£å†°ã€‚</li></ul><p><br></p><h3 id="ç¬¬å››é˜¶æ®µï¼šæ‰“é€šä¸Šä¸‹æ¸¸"><a href="#ç¬¬å››é˜¶æ®µï¼šæ‰“é€šä¸Šä¸‹æ¸¸" class="headerlink" title="ç¬¬å››é˜¶æ®µï¼šæ‰“é€šä¸Šä¸‹æ¸¸"></a>ç¬¬å››é˜¶æ®µï¼šæ‰“é€šä¸Šä¸‹æ¸¸</h3><p>å‰ç«¯åªæ˜¯ç ”å‘æµç¨‹çš„ä¸€ç¯ï¼Œåªæ˜¯å‰ç«¯è‡ªå—¨ï¼Œä¸Šä¸‹æ¸¸æ²¡æœ‰èµ„æºæ”¯æŒï¼Œæ˜¯å¾ˆéš¾èµ°è¿œçš„ã€‚</p><p>å¯¹äºå‰ç«¯æ¥è¯´ï¼Œé€šå¸¸ä¸Šæ¸¸æŒ‡çš„æ˜¯ UIã€ä¸‹æ¸¸æŒ‡çš„æ˜¯åç«¯ã€‚</p><p>å¯¹äº UIã€‚ä¸Šé¢è¯´çš„ç»„ä»¶ä½“ç³»ï¼Œå…¶å®æ˜¯å»ºç«‹åœ¨ç¨³å®šçš„ã€ä¸€è‡´çš„ã€ç»Ÿä¸€çš„ UI è®¾è®¡è¯­è¨€ä¹‹ä¸Šçš„ã€‚å¦åˆ™ä¸€åˆ‡éƒ½æ˜¯ç©ºè°ˆã€‚æ‰€ä»¥æˆ‘ä»¬è¦æ±‚ UI è®¾è®¡å›¢é˜Ÿè¦æœ‰è‰¯å¥½çš„è®¾è®¡è§„èŒƒã€èƒ½å’Œå‰ç«¯ç»„ä»¶ä½“ç³»ç»‘å®šå¹¶è‰¯æ€§è¿­ä»£ã€‚</p><p>å¯¹äº åç«¯ã€‚å¯ä»¥ä¿ƒè¿›å»ºç«‹æ›´æ ‡å‡†çš„æ¥å£èŒƒå¼ã€å°è£…é€šç”¨çš„æœåŠ¡(æœ‰åˆ©äºä¸šåŠ¡ç»„ä»¶å¤ç”¨)ã€æ›´æ·±çš„æœ‰ä¸šåŠ¡ä¸­å°ã€BFFâ€¦</p><p>ä¸Šä¸‹æ¸¸çš„æ‰“é€šï¼Œå¯¹å‰ç«¯ç”Ÿäº§åŠ›çš„è§£æ”¾ä¹Ÿæœ‰éå¸¸å¤§çš„ä¿ƒè¿›ä½œç”¨ã€‚</p><p><br></p><h3 id="æœªæ¥-ai"><a href="#æœªæ¥-ai" class="headerlink" title="æœªæ¥: AI?"></a>æœªæ¥: AI?</h3><p>AI è‡ªåŠ¨ç”Ÿæˆå‰ç«¯ä»£ç ï¼Ÿ å¤ªé«˜å¤§ä¸Šäº†ï¼Œè¿˜æ˜¯æŠŠè¯ç­’äº¤ç»™å®ƒå§ï¼š <a href="https://mp.weixin.qq.com/s/EktHbvCnghkywZE8rOvMhw" target="_blank" rel="noopener">ã€ŠåŒ 11 æ¨¡å— 79.34% çš„ä»£ç æ˜¯æ€æ ·æ™ºèƒ½ç”Ÿæˆçš„ï¼Ÿã€‹</a>ï¼Œ æºœäº†</p><p><br><br><br></p><h2 id="æ‰©å±•èµ„æ–™"><a href="#æ‰©å±•èµ„æ–™" class="headerlink" title="æ‰©å±•èµ„æ–™"></a>æ‰©å±•èµ„æ–™</h2><ul><li><a href="https://zhuanlan.zhihu.com/p/94949118" target="_blank" rel="noopener">ã€Šèš‚èšå‰ç«¯ç ”å‘æœ€ä½³å®è·µã€‹æ–‡å­—ç¨¿</a> å¥½æ–‡</li><li><a href="https://mp.weixin.qq.com/s/EktHbvCnghkywZE8rOvMhw" target="_blank" rel="noopener">åŒ 11 æ¨¡å— 79.34% çš„ä»£ç æ˜¯æ€æ ·æ™ºèƒ½ç”Ÿæˆçš„ï¼Ÿ</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;è¿™æœŸæ¥èŠä¸€èŠå‰ç«¯æ¡†æ¶ã€‚&lt;/p&gt;
&lt;p&gt;â€œif æˆ‘æ˜¯å‰ç«¯ Leaderâ€ æ˜¯æˆ‘çš„ä¸€ä¸ªæ–‡ç« ç³»åˆ—ï¼Œè¯´è¯´æˆ‘äººåœ¨å…¶ä½ï¼Œæ¬²è°‹å…¶èŒçš„ä¸€äº›ç‚¹ç‚¹æ»´æ»´æ„Ÿæ‚Ÿã€‚è·Ÿå‰ç«¯ Leader åªæœ‰é‚£ä¹ˆä¸€ä¸¢ä¸¢å…³ç³»ï¼Œå¹²è´§ä¸å¤šï¼Œä½†è€å°‘çš†å®œï¼Œä¸è¦è¢«æ ‡é¢˜ç»™å”¬ä½äº†ã€‚&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong
      
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://bobi.ink/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>JSX AS DSL? å†™ä¸ª Mock API æœåŠ¡å™¨çœ‹çœ‹</title>
    <link href="https://bobi.ink/2019/11/29/jsx-as-dsl/"/>
    <id>https://bobi.ink/2019/11/29/jsx-as-dsl/</id>
    <published>2019-11-28T16:00:00.000Z</published>
    <updated>2023-06-01T09:55:14.329Z</updated>
    
    <content type="html"><![CDATA[<p>è¿™å‡ å¤©æ‰“ç®—å†™ä¸€ä¸ªç®€å•çš„ API Mock æœåŠ¡å™¨ï¼Œè€ç”Ÿå¸¸è°ˆå“ˆï¼Ÿå…¶å®æˆ‘æ˜¯æƒ³è®² JSX, Mock æœåŠ¡å™¨åªæ˜¯ä¸€ä¸ªå¹Œå­ã€‚æˆ‘åœ¨å¯»æ‰¾ä¸€ç§æ›´ç®€æ´ã€æ–¹ä¾¿ã€åŒæ—¶åˆå¯ä»¥çµæ´»æ‰©å±•çš„ã€å’Œåˆ«äººä¸å¤ªä¸€æ ·çš„æ–¹å¼ï¼Œæ¥å®šä¹‰å„ç§ Mock APIã€‚åæ¥æˆ‘å‘ç°äº† JSX åœ¨é¢†åŸŸé—®é¢˜æè¿°çš„ä¼˜åŠ¿å’Œæ½œåŠ›ï¼Œå½“ç„¶è¿™å¯ä¸æ˜¯ç©ºè°ˆï¼Œæˆ‘ä»¬ä¼šå®é™…å†™ä¸€ä¸ªé¡¹ç›®æ¥è¯å®è¿™ä¸ªåˆ¤æ–­ã€‚</p><p><br></p><p><strong>æ–‡ç« å¤§çº²</strong></p><!-- TOC --><ul><li><a href="#1-é¢†åŸŸé—®é¢˜çš„æè¿°">1. é¢†åŸŸé—®é¢˜çš„æè¿°</a><ul><li><a href="#11-é…ç½®æ–‡ä»¶å½¢å¼">1.1 é…ç½®æ–‡ä»¶å½¢å¼</a></li><li><a href="#12-ç¼–ç¨‹è¯­è¨€ä¸å†…éƒ¨-dsl">1.2 ç¼–ç¨‹è¯­è¨€ä¸å†…éƒ¨ DSL</a></li></ul></li><li><a href="#2-javascript-å†…éƒ¨-dsl">2. JavaScript å†…éƒ¨ DSL</a><ul><li><a href="#21-å¯¹è±¡å½¢å¼">2.1 å¯¹è±¡å½¢å¼</a></li><li><a href="#22-é“¾å¼è°ƒç”¨å½¢å¼">2.2 é“¾å¼è°ƒç”¨å½¢å¼</a></li><li><a href="#23-es2015-template-tag">2.3 ES2015 Template Tag</a></li><li><a href="#24-è¦ä¸è¯•è¯•-jsx">2.4 è¦ä¸è¯•è¯• JSXï¼Ÿ</a></li></ul></li><li><a href="#3-jsx-å…¥é—¨">3. JSX å…¥é—¨</a><ul><li><a href="#31-è‡ªå®šä¹‰å·¥å‚">3.1 è‡ªå®šä¹‰å·¥å‚</a></li><li><a href="#32-host-component-vs-custom-component">3.2 Host Component vs Custom Component</a></li><li><a href="#33-ç®€å•å®ç°-createelement-å·¥å‚æ–¹æ³•">3.3 ç®€å•å®ç° createElement å·¥å‚æ–¹æ³•</a></li></ul></li><li><a href="#4-åŸºç¡€ç»„ä»¶çš„è®¾è®¡">4. åŸºç¡€ç»„ä»¶çš„è®¾è®¡</a><ul><li><a href="#41-æ¥æºäº-koa-çš„çµæ„Ÿ">4.1 æ¥æºäº Koa çš„çµæ„Ÿ</a></li><li><a href="#42-use-åŸºç¡€ç»„ä»¶">4.2 use åŸºç¡€ç»„ä»¶</a></li><li><a href="#43-é«˜å±‚ç»„ä»¶çš„å°è£…">4.3 é«˜å±‚ç»„ä»¶çš„å°è£…</a></li></ul></li><li><a href="#5-æµ…è°ˆå®ç°åŸç†">5. æµ…è°ˆå®ç°åŸç†</a><ul><li><a href="#51-æ¸²æŸ“">5.1 â€˜æ¸²æŸ“â€™</a></li><li><a href="#52-è¿è¡Œ">5.2 è¿è¡Œ</a></li></ul></li><li><a href="#6-æ€»ç»“ç»ˆäºå®Œäº‹äº†">6. æ€»ç»“ï¼Œç»ˆäºå®Œäº‹äº†</a></li><li><a href="#7-æ‰©å±•">7. æ‰©å±•</a></li></ul><!-- /TOC --><p><br></p><h2 id="1-é¢†åŸŸé—®é¢˜çš„æè¿°"><a href="#1-é¢†åŸŸé—®é¢˜çš„æè¿°" class="headerlink" title="1. é¢†åŸŸé—®é¢˜çš„æè¿°"></a>1. é¢†åŸŸé—®é¢˜çš„æè¿°</h2><p>ä¸€ä¸Šæ¥å°±è¯´è¿™ä¹ˆæŠ½è±¡çš„åè¯ï¼Œâ€™é¢†åŸŸé—®é¢˜â€™ æ˜¯ä»€ä¹ˆé¬¼ï¼Ÿä»€ä¹ˆæ˜¯é¢†åŸŸï¼ŒWiki ä¸Šè§£é‡Šçš„éå¸¸å¥½ï¼Œ<strong>é¢†åŸŸå°±æ˜¯æŒ‡æŸä¸€ä¸“ä¸šæˆ–äº‹ç‰©æ–¹é¢èŒƒå›´çš„æ¶µç›–</strong>ã€‚é‚£ä¹ˆæ‰€è°“é¢†åŸŸé—®é¢˜å°±å¯ä»¥ç†è§£ä¸ºï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡ç¨‹åºæˆ–è€…å…¶ä»–æ–¹å¼å»è§£å†³çš„éœ€æ±‚ã€‚</p><p>æ¯”å¦‚æåˆ° API Mock æœåŠ¡å™¨ï¼Œæˆ‘ä»¬éœ€è¦è§£å†³çš„å°±æ˜¯è¯·æ±‚åŒ¹é…å’Œæ•°æ®æ¨¡æ‹Ÿè¿™äº›é—®é¢˜ï¼›Nginx è§£å†³çš„èµ„æºä¼ºæœå’Œä»£ç†é—®é¢˜ï¼›HTML + CSS è§£å†³çš„æ˜¯é¡µé¢ UI å±•ç¤ºé—®é¢˜â€¦</p><p>æˆ‘ä»¬è¿™é‡Œé‡ç‚¹å…³æ³¨â€™<strong>æè¿°</strong>â€˜ã€‚<strong>è¿™äº›æè¿°æ˜¯æä¾›ç»™é¢†åŸŸä¸“å®¶çš„â€˜å‰ç«¯â€˜ æˆ–è€… ç”¨æˆ·ç•Œé¢(UI)</strong>ã€‚ä¸¾ä¸ªä¾‹å­ï¼š</p><p><br></p><p><img src="/images/jsx-as-dsl/dq-fe.png" alt></p><p><br></p><p>æè¿°çš„å½¢å¼æœ‰å¾ˆå¤šï¼Œä¾‹å¦‚é…ç½®æ–‡ä»¶ã€ç¼–ç¨‹è¯­è¨€ã€å›¾å½¢ç•Œé¢ã€‚ å…ˆæ¥çœ‹çœ‹ç°åœ¨å¸¸è§çš„å·¥å…·æ˜¯æ€ä¹ˆåšçš„ï¼š</p><p><br></p><h3 id="1-1-é…ç½®æ–‡ä»¶å½¢å¼"><a href="#1-1-é…ç½®æ–‡ä»¶å½¢å¼" class="headerlink" title="1.1 é…ç½®æ–‡ä»¶å½¢å¼"></a>1.1 é…ç½®æ–‡ä»¶å½¢å¼</h3><p><strong>JSON?</strong></p><p>JSON æ˜¯ä¸€ç§éå¸¸ç®€å•çš„æ•°æ®è¡¨è¿°, æ²¡æœ‰ä»»ä½•å­¦ä¹ æˆæœ¬ï¼Œè§£æä¹Ÿéå¸¸æ–¹ä¾¿ã€‚ä½†æ˜¯å®ƒæœ‰éå¸¸å¤šè‡´å‘½çš„ç¼ºé™·ï¼Œæ¯”å¦‚ä¸æ”¯æŒæ³¨é‡Šã€å†—ä½™ã€æ•°æ®ç»“æ„å•ä¸€ã€‚</p><p><strong>YAML?</strong></p><p>ç›¸æ¯” JSON è¯­æ³•è¦ç®€æ´å¾ˆå¤šã€å¯è¯»æ€§ä¹Ÿæ¯”è¾ƒå¼ºã€‚ä½œä¸ºä¸€ä¸ªé…ç½®æ–‡ä»¶å½¢å¼éå¸¸ä¼˜ç§€</p><p><strong>è¿˜æ˜¯å…¶ä»–é…ç½®æ–‡ä»¶å½¢å¼â€¦</strong></p><p>é€šå¸¸è¿™äº›é…ç½®æ–‡ä»¶éƒ½æ˜¯è¯­è¨€æ— å…³çš„ï¼Œå› æ­¤ä¸ä¼šåŒ…å«ç‰¹å®šè¯­è¨€çš„å…ƒç´ ã€‚æ¢å¥è¯è¯´é…ç½®æ–‡ä»¶å½¢å¼æ•°æ®æ˜¯ç›¸å¯¹é™æ€çš„, æ‰€ä»¥çµæ´»æ€§ã€æ‰©å±•æ€§æ¯”è¾ƒå·®ã€‚åªé€‚åˆç®€å•çš„é…ç½®åœºæ™¯ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œè¿™äº›é…ç½®æ–‡ä»¶ä¸æ”¯æŒå‡½æ•°ã€‚æˆ‘ä»¬çš„ Mock æœåŠ¡å™¨å¯èƒ½éœ€è¦é€šè¿‡ä¸€ä¸ªå‡½æ•°æ¥åŠ¨æ€å¤„ç†è¯·æ±‚ï¼Œæ‰€ä»¥é…ç½®æ–‡ä»¶åœ¨è¿™é‡Œå¹¶ä¸é€‚ç”¨ã€‚</p><blockquote><p>å½“ç„¶ä½ å¯ä»¥é€šè¿‡å…¶ä»–æ–¹å¼æ¥å–ä»£â€˜å‡½æ•°â€™ï¼Œä¾‹å¦‚æ¨¡æ¿ã€æˆ–è€…è„šæœ¬æ”¯æŒ</p></blockquote><p><br><br><br></p><h3 id="1-2-ç¼–ç¨‹è¯­è¨€ä¸å†…éƒ¨-dsl"><a href="#1-2-ç¼–ç¨‹è¯­è¨€ä¸å†…éƒ¨-dsl" class="headerlink" title="1.2 ç¼–ç¨‹è¯­è¨€ä¸å†…éƒ¨ DSL"></a>1.2 ç¼–ç¨‹è¯­è¨€ä¸å†…éƒ¨ DSL</h3><p>æˆ‘ä»¬éœ€è¦å›åˆ°ç¼–ç¨‹è¯­è¨€æœ¬èº«ï¼Œåˆ©ç”¨å®ƒçš„ç¼–ç¨‹èƒ½åŠ›ï¼Œå®ç°é…ç½®æ–‡ä»¶æ— æ³•å®ç°çš„æ›´å¼ºå¤§çš„åŠŸèƒ½ã€‚</p><p>ä¸è¿‡å•çº¯ä½¿ç”¨é€šç”¨ç±»å‹ç¼–ç¨‹è¯­è¨€ï¼Œå‘½ä»¤å¼çš„è¿‡ç¨‹æè¿°å¯èƒ½è¿‡äºç¹çã€‚<strong>æˆ‘ä»¬æœ€å¥½é’ˆå¯¹å…·ä½“é¢†åŸŸé—®é¢˜è¿›è¡Œç®€åŒ–å’ŒæŠ½è±¡ï¼Œç»™ç”¨æˆ·æä¾›ä¸€ä¸ªå‹å¥½çš„ç”¨æˆ·ç•Œé¢ï¼Œè®©ä»–ä»¬å£°æ˜å¼åœ°æè¿°ä»–ä»¬çš„é¢†åŸŸé—®é¢˜ã€‚æˆ‘ä»¬è¦å°½å¯èƒ½å‡å°‘ç”¨æˆ·å¯¹åº•å±‚ç»†èŠ‚çš„ä¾èµ–ï¼Œä¸æ­¤åŒæ—¶æœ€å¥½èƒ½ä¿æŒçµæ´»çš„æ‰©å±•èƒ½åŠ›</strong>ã€‚</p><p>æˆ‘è¯´çš„å¯èƒ½å°±æ˜¯<a href="https://zh.wikipedia.org/wiki/é¢†åŸŸç‰¹å®šè¯­è¨€" target="_blank" rel="noopener"><strong>DSL(Domain-specific languages)</strong></a>:</p><blockquote><p>DSL æ˜¯ä¸€ç§ç”¨äºæè¿°ç‰¹å®šåº”ç”¨é¢†åŸŸçš„è®¡ç®—æœºè¯­è¨€ã€‚DSL åœ¨è®¡ç®—æœºé¢†åŸŸæœ‰éå¸¸å¹¿æ³›çš„åº”ç”¨ï¼Œä¾‹å¦‚æè¿° Web é¡µé¢çš„ HTMLã€æ•°æ®åº“æŸ¥è¯¢è¯­è¨€ SQLã€æ­£åˆ™è¡¨è¾¾å¼ã€‚<br>ç›¸å¯¹åº”çš„æ˜¯<strong>é€šç”¨ç±»å‹è¯­è¨€</strong>(GPL, General-Purpose Language)ï¼Œä¾‹å¦‚ Javaã€C++ã€JavaScriptã€‚å®ƒä»¬å¯ä»¥ç”¨äºæè¿°ä»»æ„çš„é¢†åŸŸé€»è¾‘ï¼Œå®ƒä»¬é€šå¸¸æ˜¯<a href="https://en.wikipedia.org/wiki/Turing_completeness" target="_blank" rel="noopener">å›¾çµå®Œå¤‡</a>çš„ã€‚<br>å¯ä»¥è¿™ä¹ˆè®¤ä¸ºï¼Œè™½ç„¶ä¸ä¸¥è°¨ï¼šé™¤äº†é€šç”¨ç±»å‹è¯­è¨€ã€å…¶ä»–è¯­è¨€éƒ½ç®—æ˜¯ DSLã€‚</p></blockquote><p><br></p><p><strong>æ€ä¹ˆåˆ›å»º DSLï¼Ÿ</strong></p><p>ä»å¤´å¼€å‘ä¸€é—¨æ–°è¯­è¨€ï¼ŸNo! æˆæœ¬å¤ªé«˜äº†</p><p>ä¸€ç§æ›´ä¼˜é›…çš„æ–¹å¼æ˜¯åœ¨é€šç”¨ç¼–ç¨‹è¯­è¨€çš„åŸºç¡€ä¸Šè¿›è¡Œå‡æ³•æˆ–è€…å°è£…æŠ½è±¡ã€‚å½“ç„¶ä¸æ˜¯æ‰€æœ‰ç±»å‹è¯­è¨€éƒ½æœ‰è¿™ä¸ªâ€™èƒ½åŠ›â€™, æ¯”å¦‚ Javaã€C/C++ å°±ä¸è¡Œï¼Œå®ƒä»¬çš„è¯­æ³•å¤ª Verbose æˆ–è€…å·¥å…·é“¾å¤ªé‡äº†ã€‚ä½†æ˜¯ Groovyã€Rubyã€Scalaã€è¿˜æœ‰ Elixir è¿™äº›è¯­è¨€å°±å¯ä»¥æ–¹ä¾¿åœ°åˆ›å»ºå‡ºâ€˜DSLâ€™, è€Œä¸”å®ƒä»¬å¤§éƒ¨åˆ†æ˜¯åŠ¨æ€è¯­è¨€ã€‚</p><p>å®ƒä»¬æœ‰çš„å€ŸåŠ©å®ã€æœ‰çš„å¤©ç”Ÿè¯­æ³•å°±éå¸¸é€‚åˆä½œä¸º DSLã€æœ‰çš„å…·å¤‡éå¸¸å¼ºçš„åŠ¨æ€ç¼–ç¨‹èƒ½åŠ›â€¦ è¿™äº›å› ç´ ä¿ƒå°±äº†å®ƒä»¬é€‚åˆä½œä¸º DSL çš„æ¯ä½“(å®¿ä¸»)ã€‚</p><p><strong>æˆ‘ä»¬é€šå¸¸ä¹Ÿå°†è¿™ç§ DSL ç§°ä¸º <code>Embedded DSL(åµŒå…¥å¼ DSL)</code> æˆ–è€… <code>å†…éƒ¨ DSL</code>ï¼Œå› ä¸ºå®ƒä»¬å¯„ç”Ÿåœ¨é€šç”¨ç±»å‹ç¼–ç¨‹è¯­è¨€ä¸­ã€‚è€Œç‹¬ç«‹çš„ DSLï¼Œå¦‚ JSONã€HTMLï¼Œç§°ä¸º<code>å¤–éƒ¨DSL</code></strong>ã€‚</p><p>å†…éƒ¨ DSL å¥½å¤„æ˜¯çœå»äº†å®ç°ä¸€é—¨è¯­è¨€çš„å¤æ‚æ€§(Parse-&gt;Transform-&gt;Generate)ã€‚</p><p><br></p><p>ä¸¾ä¸¤ä¸ªéå¸¸å…¸å‹çš„ä¾‹å­:</p><p>Java å¼€å‘è€…å¸¸ç”¨çš„ <a href="https://gradle.org" target="_blank" rel="noopener">Gradle</a>ï¼ŒåŸºäº Groovy:</p><figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line">plugins &#123;</span><br><span class="line">    id <span class="string">'java-library'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">repositories &#123;</span><br><span class="line">    jcenter()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dependencies &#123;</span><br><span class="line">    api <span class="string">'org.apache.commons:commons-math3:3.6.1'</span></span><br><span class="line"></span><br><span class="line">    implementation <span class="string">'com.google.guava:guava:27.0.1-jre'</span></span><br><span class="line"></span><br><span class="line">    testImplementation <span class="string">'junit:junit:4.12'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p>è¿˜æœ‰ CocoaPods, åŸºäº Ruby:</p><figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line">source <span class="string">'http://source.git'</span></span><br><span class="line">platform <span class="symbol">:ios</span>, <span class="string">'8.0'</span></span><br><span class="line"></span><br><span class="line">target <span class="string">'Demo'</span> <span class="keyword">do</span></span><br><span class="line">    pod <span class="string">'AFNetworking'</span></span><br><span class="line">    pod <span class="string">'SDWebImage'</span></span><br><span class="line">    pod <span class="string">'Masonry'</span></span><br><span class="line">    pod <span class="string">"Typeset"</span></span><br><span class="line">    pod <span class="string">'BlocksKit'</span></span><br><span class="line">    pod <span class="string">'Mantle'</span></span><br><span class="line">    pod <span class="string">'IQKeyboardManager'</span></span><br><span class="line">    pod <span class="string">'IQDropDownTextField'</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p><br></p><p>å…·ä½“çš„å®ç°ç»†èŠ‚ä¸åœ¨æœ¬æ–‡çš„èŒƒå›´ä¹‹å†…ï¼Œè¿˜æ˜¯èŠå› JavaScriptã€‚</p><p><br></p><p><strong>æˆ‘ä¸ªäººè¦æ±‚ DSL åº”è¯¥å…·å¤‡è¿™äº›ç‰¹æ€§</strong>ï¼š</p><ul><li><strong>ä¸“æ³¨äºç‰¹å®šé¢†åŸŸ</strong>ã€‚ä¹Ÿå°±æ˜¯è¯´å®ƒçš„ç›®çš„éå¸¸æ˜ç¡®ï¼Œå› æ­¤æ¯”é€šç”¨ç±»å‹è¯­è¨€è¦ç®€å•å¾ˆå¤šï¼Œä½†æ˜¯å®ƒçš„è¾¹ç•Œæœ‰æ—¶å€™å¹¶ä¸å¥½æŠŠæ¡ã€‚</li><li><strong>ç»„ç»‡æ€§</strong>ã€‚å®ƒåº”è¯¥æ–¹ä¾¿ç»„ç»‡å’Œæè¿°é¢†åŸŸé—®é¢˜, <strong>æˆ–è€…è¯´è¿™æ˜¯ä¸€ç§çº¦æŸèƒ½åŠ›</strong>ã€‚é…ç½®æ–‡ä»¶ç»„ç»‡æ€§å°±éå¸¸å¥½ï¼Œæ¯”å¦‚ JSONï¼Œå®ƒå¯ä»¥å¾ˆå®¹æ˜“åœ°æè¿°æ•°æ®ç»“æ„ï¼Œæ²¡æœ‰ä»€ä¹ˆå¿ƒæ™ºè´Ÿæ‹…ã€‚å¦ä¸€ä¸ªå…¸å‹çš„ä¾‹å­æ˜¯å•å…ƒæµ‹è¯•æ¡†æ¶(ä¾‹å¦‚ jest)ï¼Œå®ƒä»¬ä½¿ç”¨ describeã€itã€expect è¿™äº›å…ƒä»¶ï¼Œè®©å•å…ƒæµ‹è¯•æ›´å¥½çš„ç»„ç»‡èµ·æ¥ã€‚</li><li><strong>å¯è¯»æ€§</strong>ã€‚å®ƒå¿…é¡»æ˜¯äººç±»å¯è¯»çš„ã€å®¹æ˜“ç†è§£çš„ã€‚</li><li><strong>å£°æ˜å¼</strong>ã€‚å£°æ˜å¼ä¼˜äºè¿‡ç¨‹å¼ã€æè¿° What è€Œä¸æ˜¯ Howã€‚</li><li><strong>æ‰©å±•æ€§</strong>ã€‚å¾ˆå¤š DSL ä¸€å¼€å§‹å¹¶ä¸å…³æ³¨è¿™ä¸€ç‚¹ï¼Œå› ä¸ºä¸€å¼€å§‹é—®é¢˜å¯èƒ½å¹¶ä¸å¤æ‚ã€‚<strong>é—®é¢˜çš„é¢†åŸŸä¸æ˜¯é™æ€ä¸å˜çš„ï¼Œå®ƒå¯èƒ½ä¼šå˜å¤§ï¼Œè¿™æ—¶å€™ DSL çš„æ‰©å±•èƒ½åŠ›å°±å¾ˆå…³é”®äº†</strong>ã€‚ å°±æ¯”å¦‚ HTMLï¼Œéšç€å‰ç«¯å¼€å‘è¶Šæ¥è¶Šå¤æ‚ï¼ŒåŸæœ‰çš„å…ƒç´ å’ŒåŠŸèƒ½é›†åˆå·²ç»æ— æ³•æ»¡è¶³éœ€æ±‚ï¼Œæ‰€ä»¥è¡ç”Ÿé™¤äº†å¾ˆå¤šç»„ä»¶æˆ–è€…è‡ªå®šä¹‰å…ƒç´ æ–¹æ¡ˆã€‚å¦‚æœåŸæœ¬çš„ DSL æ— æ³•æ‰©å±•ï¼Œå¯ä»¥åœ¨è¿™ä¸ªåŸºç¡€ä¹‹ä¸Šå†å¥—ä¸€å±‚ DSLï¼ŒCSS vs SASSã€HTML vs React å°±æ˜¯è¿™æ ·çš„ä¾‹å­ã€‚</li></ul><p><br><br><br></p><h2 id="2-javascript-å†…éƒ¨-dsl"><a href="#2-javascript-å†…éƒ¨-dsl" class="headerlink" title="2. JavaScript å†…éƒ¨ DSL"></a>2. JavaScript å†…éƒ¨ DSL</h2><p>ä¸ŠèŠ‚æåˆ°äº† Groovyã€Ruby â€˜é€‚åˆâ€˜ ç”¨ä½œ DSL æ¯ä½“ï¼Œå¹¶ä¸ä»£è¡¨ä¸€å®šè¦ç”¨å®ƒä»¬å®ç°ï¼Œè¿™åªæ˜¯è¯´æ˜å®ƒä»¬å¤©ç”Ÿå…·å¤‡çš„ä¸€äº›è¯­è¨€ç‰¹æ€§è®©å®ç°æ›´åŠ ä¾¿æ·ï¼Œæˆ–è€…è¯´å¤–è§‚æ›´åŠ ç®€æ´ã€‚</p><p>Google ä¸€æŠŠ â€˜JavaScript DSLâ€˜ åŒ¹é…çš„æœ‰æ•ˆèµ„æ–™å¾ˆå°‘ã€‚ å¦‚æœä½ è§‰å¾—å›°æƒ‘é‚£å°±åº”è¯¥å›åˆ°é—®é¢˜æœ¬èº«, æœ€é‡è¦çš„æ˜¯è§£å†³é¢†åŸŸé—®é¢˜ï¼Œè‡³äºæ€ä¹ˆç»„ç»‡å’Œæè¿°åˆ™æ˜¯ç›¸å¯¹æ¬¡è¦çš„ã€‚æ‰€ä»¥ä¸è¦å»çº ç»“ JavaScript é€‚ä¸é€‚åˆã€‚</p><p><br></p><p>é‚£æˆ‘ä»¬å°±é’ˆå¯¹ Mock Server è¿™ä¸ªå…·ä½“é¢†åŸŸï¼ŒèŠä¸€èŠ JavaScript å†…éƒ¨ DSL çš„å…¸å‹ç»„ç»‡æ–¹å¼:</p><p><br></p><h3 id="2-1-å¯¹è±¡å½¢å¼"><a href="#2-1-å¯¹è±¡å½¢å¼" class="headerlink" title="2.1 å¯¹è±¡å½¢å¼"></a>2.1 å¯¹è±¡å½¢å¼</h3><p>æœ€ç®€å•çš„æ–¹å¼æ˜¯ç›´æ¥åŸºäºå¯¹è±¡æˆ–è€…æ•°ç»„è¿›è¡Œå£°æ˜ï¼Œå®ç°ç®€å•åˆä¿æŒç»„ç»‡æ€§ã€‚ä¾‹å¦‚ <a href="https://umijs.org/zh/guide/mock-data.html#ä½¿ç”¨-umi-çš„-mock-åŠŸèƒ½" target="_blank" rel="noopener">Umi Mock</a> è¿˜æœ‰ <a href="https://ice.work" target="_blank" rel="noopener">é£å†°</a> Mock, å°±æ˜¯åŸºäºå¯¹è±¡ç»„ç»‡çš„:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">// æ”¯æŒå€¼ä¸º Object å’Œ Array</span></span><br><span class="line">  <span class="string">'GET /api/users'</span>: &#123; <span class="attr">users</span>: [<span class="number">1</span>, <span class="number">2</span>] &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// GET POST å¯çœç•¥</span></span><br><span class="line">  <span class="string">'/api/users/1'</span>: &#123; <span class="attr">id</span>: <span class="number">1</span> &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ”¯æŒè‡ªå®šä¹‰å‡½æ•°ï¼ŒAPI å‚è€ƒ express@4</span></span><br><span class="line">  <span class="string">'POST /api/users/create'</span>: <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.end(<span class="string">'OK'</span>)</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ä½¿ç”¨ mockjs ç­‰ä¸‰æ–¹åº“</span></span><br><span class="line">  <span class="string">'GET /api/tags'</span>: mockjs.mock(&#123;</span><br><span class="line">    <span class="string">'list|100'</span>: [&#123; <span class="attr">name</span>: <span class="string">'@city'</span>, <span class="string">'value|1-100'</span>: <span class="number">50</span>, <span class="string">'type|0-2'</span>: <span class="number">1</span> &#125;],</span><br><span class="line">  &#125;),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p>å’Œé…ç½®æ–‡ä»¶å·®ä¸å¤š, å®ç°å’Œä½¿ç”¨éƒ½éå¸¸ç®€å• ï¼Œç®€å•çš„ API Mock åœºæ™¯å¼€ç®±å³ç”¨ï¼Œå¯¹äºå¤æ‚çš„ç”¨æ³•å’Œ API åè®®ï¼Œä¹Ÿå¯ä»¥é€šè¿‡è‡ªå®šä¹‰å‡½æ•°è¿›ä¸€æ­¥å°è£…ã€‚<strong>ä½†æ˜¯æœ‰æ—¶å€™æˆ‘ä»¬å¸Œæœ›åº“å¯ä»¥æ‰¿æ‹…å¤šä¸€ç‚¹äº‹æƒ…</strong>ã€‚</p><p><br><br><br></p><h3 id="2-2-é“¾å¼è°ƒç”¨å½¢å¼"><a href="#2-2-é“¾å¼è°ƒç”¨å½¢å¼" class="headerlink" title="2.2 é“¾å¼è°ƒç”¨å½¢å¼"></a>2.2 é“¾å¼è°ƒç”¨å½¢å¼</h3><p>JavaScript ä½œä¸ºå†…éƒ¨ DSL çš„å¦å¤–ä¸€ç§å…¸å‹çš„å½¢å¼æ˜¯é“¾å¼è°ƒç”¨ã€‚</p><p>å…¶ä¸­æœ€å‡ºåçš„æ˜¯ JQuery, å®ƒè®©é“¾å¼è°ƒç”¨è¿™ç§æ¨¡å¼å¹¿ä¸ºäººçŸ¥ã€‚ç›¸æ¯”å•°å—¦çš„åŸç”Ÿ DOM æ“ä½œä»£ç ï¼ŒJQuery ç¡®å®è®©äººçœ¼å‰ä¸€äº®, å®ƒæš´éœ²ç²¾ç®€çš„ API, å¸®æˆ‘ä»¬å±è”½äº†è®¸å¤šåº•å±‚ DOM æ“ä½œç»†èŠ‚ï¼ŒæŠšå¹³å¹³å°å·®å¼‚ï¼ŒåŒæ—¶è¿˜èƒ½ä¿æŒçµæ´»æ€§å’Œæ‰©å±•æ€§ã€‚è¿™æ‰æ˜¯å®ƒçœŸæ­£æµè¡Œçš„åŸå› ï¼Œå¤§ä¼—å–œé—»ä¹è§çš„éƒ½æ˜¯ç®€å•çš„ä¸œè¥¿ã€‚</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">$(<span class="string">'.awesome'</span>)</span><br><span class="line">  .addClass(<span class="string">'flash'</span>)</span><br><span class="line">  .draggable()</span><br><span class="line">  .css(<span class="string">'color'</span>, <span class="string">'red'</span>)</span><br></pre></td></tr></table></figure><p><br></p><p>JQuery è¿™ç§ API æ¨¡å¼ä¹Ÿå½±å“åˆ°äº†å…¶ä»–é¢†åŸŸï¼Œæ¯”å¦‚ Iot é¢†åŸŸçš„ <a href="https://ruff.io/zh-cn/docs/getting-started.html" target="_blank" rel="noopener"><code>Ruff</code></a>:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">$.ready(<span class="function"><span class="keyword">function</span>(<span class="params">error</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (error) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(error)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ç‚¹äº®ç¯</span></span><br><span class="line">  $(<span class="string">'#led-r'</span>).turnOn()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><br></p><p>jest</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">expect(z).not.toBeNull()</span><br><span class="line">expect(z).toBeDefined()</span><br><span class="line">expect(value).toBeGreaterThan(<span class="number">3</span>)</span><br><span class="line">expect(value).toBeGreaterThanOrEqual(<span class="number">3.5</span>)</span><br></pre></td></tr></table></figure><p><br></p><p>API Mock æœåŠ¡å™¨é¢†åŸŸä¹Ÿæœ‰ä¸¤ä¸ªè¿™æ ·çš„ä¾‹å­:</p><p><a href="https://github.com/nock/nock" target="_blank" rel="noopener">Nock</a>:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> scope = nock(<span class="string">'http://myapp.iriscouch.com'</span>)</span><br><span class="line">  .get(<span class="string">'/users/1'</span>)</span><br><span class="line">  .reply(<span class="number">404</span>)</span><br><span class="line">  .post(<span class="string">'/users'</span>, &#123;</span><br><span class="line">    username: <span class="string">'pgte'</span>,</span><br><span class="line">    email: <span class="string">'pedro.teixeira@gmail.com'</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">  .reply(<span class="number">201</span>, &#123;</span><br><span class="line">    ok: <span class="literal">true</span>,</span><br><span class="line">    id: <span class="string">'123ABC'</span>,</span><br><span class="line">    rev: <span class="string">'946B7D1C'</span>,</span><br><span class="line">  &#125;)</span><br><span class="line">  .get(<span class="string">'/users/123ABC'</span>)</span><br><span class="line">  .reply(<span class="number">200</span>, &#123;</span><br><span class="line">    _id: <span class="string">'123ABC'</span>,</span><br><span class="line">    _rev: <span class="string">'946B7D1C'</span>,</span><br><span class="line">    username: <span class="string">'pgte'</span>,</span><br><span class="line">    email: <span class="string">'pedro.teixeira@gmail.com'</span>,</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure><p><br></p><p>è¿˜æœ‰ç½‘æ˜“äº‘å›¢é˜Ÿçš„ <a href="https://docs.svrx.io/zh/guide/route.html" target="_blank" rel="noopener">Srvx</a></p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">get</span>('/handle(.*)').to.handle(ctx =&gt; &#123;</span><br><span class="line">  ctx.body = <span class="string">'handle'</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">get</span>('/blog(.*)').to.json(&#123; code: <span class="number">200</span> &#125;)</span><br><span class="line"><span class="keyword">get</span>('/code(.*)').to.send('code', 201)</span><br><span class="line"><span class="keyword">get</span>('/json(.*)').to.send(&#123; json: <span class="literal">true</span> &#125;)</span><br><span class="line"><span class="keyword">get</span>('/text(.*)').to.send('haha')</span><br><span class="line"><span class="keyword">get</span>('/html(.*)').to.send('&lt;html&gt;haha&lt;/html&gt;')</span><br><span class="line"><span class="keyword">get</span>('/rewrite:path(.*)').to.rewrite('/query&#123;path&#125;<span class="string">')</span></span><br><span class="line"><span class="string">get('</span>/redirect:path(.*)<span class="string">').to.redirect('</span>localhost:<span class="number">9002</span>/proxy&#123;path&#125;<span class="string">')</span></span><br><span class="line"><span class="string">get('</span>/api(.*)<span class="string">').to.proxy('</span>http:<span class="comment">//mock.server.com/')</span></span><br><span class="line"><span class="keyword">get</span>('/test(.*)').to.proxy('http://mock.server.com/', &#123;</span><br><span class="line">  secure: <span class="literal">false</span>,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">get</span>('/test/:id').to.proxy('http://&#123;id&#125;.dynamic.server.com/<span class="string">')</span></span><br><span class="line"><span class="string">get('</span>/query(.*)<span class="string">').to.handle(ctx =&gt; &#123;</span></span><br><span class="line"><span class="string">  ctx.body = ctx.query</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string">get('</span>/header(.*)<span class="string">')</span></span><br><span class="line"><span class="string">  .to.header(&#123; '</span>X-From<span class="string">': '</span>svrx<span class="string">' &#125;)</span></span><br><span class="line"><span class="string">  .json(&#123; user: '</span>svrx<span class="string">' &#125;)</span></span><br><span class="line"><span class="string">get('</span>/user<span class="string">').to.json(&#123; user: '</span>svrx<span class="string">' &#125;)</span></span><br><span class="line"><span class="string">get('</span>/sendFile/:path(.*)<span class="string">').to.sendFile('</span>./&#123;path&#125;<span class="string">')</span></span><br></pre></td></tr></table></figure><p><br></p><p>é“¾å¼è°ƒç”¨æ¨¡å¼ç›®å‰æ˜¯ä¸»æµçš„ JavaScript å†…éƒ¨ DSL å½¢å¼ã€‚è€Œä¸”å®ç°ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œ<strong>æ›´é‡è¦çš„æ˜¯å®ƒæ¥è¿‘è‡ªç„¶è¯­è¨€</strong>ã€‚</p><p><br><br><br></p><h3 id="2-3-es2015-template-tag"><a href="#2-3-es2015-template-tag" class="headerlink" title="2.3 ES2015 Template Tag"></a>2.3 ES2015 Template Tag</h3><p>è¿‘å¹´åŸºäº <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/template_strings" target="_blank" rel="noopener">ES6 Template Tag</a> ç‰¹æ€§å¼•å…¥â€˜æ–°è¯­è¨€â€˜åˆ° JavaScript çš„åº“å±‚å‡ºä¸ç©·ã€‚</p><p><strong>ä¸è¿‡å› ä¸º ES6 Template Tag æœ¬è´¨ä¸Šæ˜¯å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥éœ€è¦è§£æå’Œè½¬æ¢ï¼Œå› æ­¤æ›´åƒæ˜¯å¤–éƒ¨ DSLã€‚åˆ«å¿˜äº† Compiler as Framework! é€šå¸¸æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ Babel æ’ä»¶åœ¨ç¼–è¯‘æ—¶æå‰å°†å®ƒä»¬è½¬æ¢ä¸º JavaScript ä»£ç ã€‚</strong></p><p><br></p><p>ä¸¾å‡ ä¸ªæµè¡Œçš„ä¾‹å­:</p><p><a href="https://github.com/modernserf/zebu" target="_blank" rel="noopener">Zebu</a>: è¿™æ˜¯ä¸€ä¸ªä¸“é—¨ç”¨äºè§£æ Template Tag çš„å°å‹ç¼–è¯‘å™¨, çœ‹çœ‹å®ƒçš„ä¸€äº›å†…ç½®ä¾‹å­:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// èŒƒå›´</span></span><br><span class="line">range<span class="string">`1,3 ... (10)`</span> <span class="comment">// [1, 3, 5, 7, 9]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// çŠ¶æ€æœº, ç‰›é€¼</span></span><br><span class="line"><span class="keyword">const</span> traffic = machine<span class="string">`</span></span><br><span class="line"><span class="string">  initState: #green</span></span><br><span class="line"><span class="string">  states: #green | #yellow | #red</span></span><br><span class="line"><span class="string">  events: #timer</span></span><br><span class="line"><span class="string">  onTransition: <span class="subst">$&#123;state =&gt; <span class="built_in">console</span>.log(state)&#125;</span></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  #green  @ #timer -&gt; #yellow</span></span><br><span class="line"><span class="string">  #yellow @ #timer -&gt; #red</span></span><br><span class="line"><span class="string">  #red    @ #timer -&gt; #green</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line">traffic.start() <span class="comment">// log &#123; type: "green" &#125;</span></span><br><span class="line">traffic.send(&#123; <span class="attr">type</span>: <span class="string">'timer'</span> &#125;) <span class="comment">// log &#123; type: "yellow" &#125;</span></span><br></pre></td></tr></table></figure><p><br></p><p>Jest è¡¨æ ¼æµ‹è¯•:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">describe.each<span class="string">`</span></span><br><span class="line"><span class="string">  a    | b    | expected</span></span><br><span class="line"><span class="string">  <span class="subst">$&#123;<span class="number">1</span>&#125;</span> | <span class="subst">$&#123;<span class="number">1</span>&#125;</span> | <span class="subst">$&#123;<span class="number">2</span>&#125;</span></span></span><br><span class="line"><span class="string">  <span class="subst">$&#123;<span class="number">1</span>&#125;</span> | <span class="subst">$&#123;<span class="number">2</span>&#125;</span> | <span class="subst">$&#123;<span class="number">3</span>&#125;</span></span></span><br><span class="line"><span class="string">  <span class="subst">$&#123;<span class="number">2</span>&#125;</span> | <span class="subst">$&#123;<span class="number">1</span>&#125;</span> | <span class="subst">$&#123;<span class="number">3</span>&#125;</span></span></span><br><span class="line"><span class="string">`</span>(<span class="string">'$a + $b'</span>, (&#123; a, b, expected &#125;) =&gt; &#123;</span><br><span class="line">  test(<span class="string">`returns <span class="subst">$&#123;expected&#125;</span>`</span>, () =&gt; &#123;</span><br><span class="line">    expect(a + b).toBe(expected)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  test(<span class="string">`returned value not be greater than <span class="subst">$&#123;expected&#125;</span>`</span>, () =&gt; &#123;</span><br><span class="line">    expect(a + b).not.toBeGreaterThan(expected)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  test(<span class="string">`returned value not be less than <span class="subst">$&#123;expected&#125;</span>`</span>, () =&gt; &#123;</span><br><span class="line">    expect(a + b).not.toBeLessThan(expected)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><br></p><p>é™¤æ­¤ä¹‹å¤–è¿˜æœ‰:</p><ul><li><a href="https://github.com/developit/htm" target="_blank" rel="noopener">htm</a></li><li><a href="https://github.com/apollographql/graphql-tag" target="_blank" rel="noopener">graphql-tag</a></li><li><a href="http://styled-components.com" target="_blank" rel="noopener">styled-components</a></li></ul><p><br></p><p>Template Tag è¿™äº›æ–¹æ¡ˆç»™æˆ‘ä»¬å¼€äº†å¾ˆå¤šè„‘æ´ã€‚å°½ç®¡å¦‚æ­¤ï¼Œå®ƒä¹Ÿå¸¦æ¥äº†ä¸€äº›å¤æ‚æ€§ï¼Œå°±åƒå¼€å¤´è¯´çš„ï¼Œå®ƒä»¬æ˜¯å­—ç¬¦ä¸²ï¼Œéœ€è¦è§£æã€è¯­æ³•æ£€æŸ¥å’Œè½¬æ¢ï¼Œä¸” JavaScript æœ¬èº«çš„è¯­è¨€æœºåˆ¶å¹¶æ²¡æœ‰ç»™å®ƒä»¬å¸¦æ¥å¤šå°‘ä¾¿åˆ©(å¦‚è¯­æ³•é«˜äº®ã€ç±»å‹æ£€æŸ¥)ã€‚</p><p><br><br><br></p><h3 id="2-4-è¦ä¸è¯•è¯•-jsxï¼Ÿ"><a href="#2-4-è¦ä¸è¯•è¯•-jsxï¼Ÿ" class="headerlink" title="2.4 è¦ä¸è¯•è¯• JSXï¼Ÿ"></a>2.4 è¦ä¸è¯•è¯• JSXï¼Ÿ</h3><p>é“ºå«äº†è¿™ä¹ˆå¤šï¼Œåªæ˜¯å‰æˆã€‚ä¸Šé¢æåˆ°è¿™äº›æ–¹æ¡ˆï¼Œè¦ä¹ˆè¿‡äºç®€å•ã€è¦ä¹ˆè¿‡äºå¤æ‚ã€è¦ä¹ˆå¹³æ·¡æ— å¥‡ã€‚æˆ‘å°†ç›®å…‰æŠ•å‘äº† JSXï¼Œæˆ‘å‘ç°å®ƒå¯ä»¥æ»¡è¶³æˆ‘çš„å¤§éƒ¨åˆ†éœ€æ±‚ã€‚</p><p>å…ˆæ¥çœ‹çœ‹ä¸€ä¸‹æˆ‘ä»¬çš„ Mock æœåŠ¡å™¨çš„åŸå‹è®¾è®¡:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Get, Post, mock &#125; <span class="keyword">from</span> <span class="string">'jsxmock'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (</span><br><span class="line">  &lt;server port=<span class="string">"4321"</span>&gt;</span><br><span class="line">    &#123;<span class="comment">/* é¦–é¡µ */</span>&#125;</span><br><span class="line">    &lt;Get&gt;hello world&lt;<span class="regexp">/Get&gt;</span></span><br><span class="line"><span class="regexp">    &#123;/</span>* ç™»å½• *<span class="regexp">/&#125;</span></span><br><span class="line"><span class="regexp">    &lt;Post path="/</span>login<span class="string">"&gt;login success&lt;/Post&gt;</span></span><br><span class="line"><span class="string">    &#123;/* è¿”å› JSON */&#125;</span></span><br><span class="line"><span class="string">    &lt;Get path="</span>/json<span class="string">"&gt;&#123;&#123; id: 1 &#125;&#125;&lt;/Get&gt;</span></span><br><span class="line"><span class="string">    &#123;/* mockjs */&#125;</span></span><br><span class="line"><span class="string">    &lt;Get path="</span>/mockjs<span class="string">"&gt;&#123;mock(&#123; 'id|+1': 1, name: '@name' &#125;)&#125;&lt;/Get&gt;</span></span><br><span class="line"><span class="string">    &#123;/*è‡ªå®šä¹‰é€»è¾‘*/&#125;</span></span><br><span class="line"><span class="string">    &lt;Get path="</span>/user/:id<span class="string">"&gt;&#123;(req, res) =&gt; res.send('hello')&#125;&lt;/Get&gt;</span></span><br><span class="line"><span class="string">  &lt;/server&gt;</span></span><br><span class="line"><span class="string">)</span></span><br></pre></td></tr></table></figure><p><br></p><p>åµŒå¥—åŒ¹é…åœºæ™¯</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (</span><br><span class="line">  &lt;server&gt;</span><br><span class="line">    &lt;Get path=<span class="string">"/api"</span>&gt;</span><br><span class="line">      &#123;<span class="comment">/* åŒ¹é… /api?method=foo */</span>&#125;</span><br><span class="line">      &lt;MatchBySearch key=<span class="string">"method"</span> value=<span class="string">"foo"</span>&gt;</span><br><span class="line">        foo</span><br><span class="line">      &lt;<span class="regexp">/MatchBySearch&gt;</span></span><br><span class="line"><span class="regexp">      &#123;/</span>* åŒ¹é… /api?method=bar *<span class="regexp">/&#125;</span></span><br><span class="line"><span class="regexp">      &lt;MatchBySearch key="method" value="bar"&gt;</span></span><br><span class="line"><span class="regexp">        bar</span></span><br><span class="line"><span class="regexp">      &lt;/</span>MatchBySearch&gt;</span><br><span class="line">      &lt;BlackHole&gt;æˆ‘ä¼šåƒæ‰ä»»ä½•è¯·æ±‚&lt;<span class="regexp">/BlackHole&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>Get&gt;</span><br><span class="line">  &lt;<span class="regexp">/server&gt;</span></span><br><span class="line"><span class="regexp">)</span></span><br></pre></td></tr></table></figure><p><br></p><p>æœ‰ç‚¹ Verbose? è¿›ä¸€æ­¥å°è£…ç»„ä»¶:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> MyAwesomeAPI = <span class="function"><span class="params">props</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; path = <span class="string">'/api'</span>, children &#125; = props</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Get path=&#123;path&#125;&gt;</span><br><span class="line">      &#123;<span class="built_in">Object</span>.keys(children).map(<span class="function"><span class="params">name</span> =&gt;</span> (</span><br><span class="line">        &lt;MatchBySearch key=<span class="string">"method"</span> value=&#123;name&#125;&gt;</span><br><span class="line">          &#123;children[name]&#125;</span><br><span class="line">        &lt;<span class="regexp">/MatchBySearch&gt;</span></span><br><span class="line"><span class="regexp">      ))&#125;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>Get&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (</span><br><span class="line">  &lt;server&gt;</span><br><span class="line">    &lt;MyAwesomeAPI&gt;&#123;&#123; <span class="attr">foo</span>: <span class="string">'foo'</span>, <span class="attr">bar</span>: <span class="string">'bar'</span> &#125;&#125;&lt;<span class="regexp">/MyAwesomeAPI&gt;</span></span><br><span class="line"><span class="regexp">    &lt;MyAwesomeAPI path="/</span>api<span class="number">-2</span><span class="string">"&gt;&#123;&#123; hello: 'foo', world: 'bar' &#125;&#125;&lt;/MyAwesomeAPI&gt;</span></span><br><span class="line"><span class="string">  &lt;/server&gt;</span></span><br><span class="line"><span class="string">)</span></span><br></pre></td></tr></table></figure><p><br></p><p>çœ‹èµ·æ¥ä¸é”™å“ˆï¼Ÿæˆ‘ä»¬çœ‹åˆ°äº† JSX ä½œä¸º DSL çš„æ½œåŠ›ï¼Œä¹ŸæŠŠ React çš„ç»„ä»¶æ€ç»´æ¬åˆ°äº† GUI ä¹‹å¤–çš„é¢†åŸŸã€‚</p><p><br></p><hr><p><br></p><p>ä½ çŸ¥é“æˆ‘çš„é£æ ¼ï¼Œç¯‡å¹…è¾ƒé•¿ â˜•ï¸ ä¼‘æ¯ä¸€ä¼šï¼Œå†å¾€ä¸‹çœ‹ã€‚</p><p><br><br><br></p><h2 id="3-jsx-å…¥é—¨"><a href="#3-jsx-å…¥é—¨" class="headerlink" title="3. JSX å…¥é—¨"></a>3. JSX å…¥é—¨</h2><p>å¦‚æœä½ æ˜¯ React çš„å¼€å‘è€…ï¼ŒJSX åº”è¯¥å†ç†Ÿæ‚‰ä¸è¿‡äº†ã€‚å®ƒä¸è¿‡æ˜¯ä¸€ä¸ªè¯­æ³•ç³–ï¼Œä½†æ˜¯å®ƒç›®å‰ä¸æ˜¯ JavaScript æ ‡å‡†çš„ä¸€éƒ¨åˆ†ã€‚Babelã€Typescript éƒ½æ”¯æŒè½¬è¯‘ JSXã€‚</p><p>ä¾‹å¦‚</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> jsx = (</span><br><span class="line">  &lt;div foo=<span class="string">"bar"</span>&gt;</span><br><span class="line">    &lt;span&gt;<span class="number">1</span>&lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">    &lt;span&gt;2&lt;/</span>span&gt;</span><br><span class="line">    &lt;Custom&gt;custom element&lt;<span class="regexp">/Custom&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>div&gt;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>ä¼šè½¬è¯‘ä¸º:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> jsx = React.createElement(</span><br><span class="line">  <span class="string">'div'</span>,</span><br><span class="line">  &#123;</span><br><span class="line">    foo: <span class="string">'bar'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  React.createElement(<span class="string">'span'</span>, <span class="literal">null</span>, <span class="string">'1'</span>),</span><br><span class="line">  React.createElement(<span class="string">'span'</span>, <span class="literal">null</span>, <span class="string">'2'</span>),</span><br><span class="line">  React.createElement(Custom, <span class="literal">null</span>, <span class="string">'custom element'</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p><br></p><h3 id="3-1-è‡ªå®šä¹‰å·¥å‚"><a href="#3-1-è‡ªå®šä¹‰å·¥å‚" class="headerlink" title="3.1 è‡ªå®šä¹‰å·¥å‚"></a>3.1 è‡ªå®šä¹‰å·¥å‚</h3><p>JSX éœ€è¦ä¸€ä¸ª<strong>å·¥å‚æ–¹æ³•</strong>æ¥åˆ›å»ºåˆ›å»ºâ€™èŠ‚ç‚¹å®ä¾‹â€™ã€‚é»˜è®¤æ˜¯ <code>React.createElement</code>ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡æ³¨é‡Šé…ç½®æ¥æç¤ºè½¬è¯‘æ’ä»¶ã€‚æŒ‰ç…§ä¹ æƒ¯ï¼Œè‡ªå®šä¹‰å·¥å‚éƒ½å‘½åä¸º <code>h</code>:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* @jsx h */</span></span><br><span class="line"><span class="comment">/* @jsxFrag 'fragment' */</span></span><br><span class="line"><span class="keyword">import</span> &#123; h &#125; <span class="keyword">from</span> <span class="string">'somelib'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> jsx = (</span><br><span class="line">  &lt;div foo=<span class="string">"bar"</span>&gt;</span><br><span class="line">    &lt;span&gt;<span class="number">1</span>&lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">    &lt;span&gt;2&lt;/</span>span&gt;</span><br><span class="line">    &lt;&gt;fragement&lt;<span class="regexp">/&gt;</span></span><br><span class="line"><span class="regexp">  &lt;/</span>div&gt;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>å°†è½¬è¯‘ä¸º:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; h &#125; <span class="keyword">from</span> <span class="string">'somelib'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> jsx = h(</span><br><span class="line">  <span class="string">'div'</span>,</span><br><span class="line">  &#123;</span><br><span class="line">    foo: <span class="string">'bar'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  h(<span class="string">'span'</span>, <span class="literal">null</span>, <span class="string">'1'</span>),</span><br><span class="line">  h(<span class="string">'span'</span>, <span class="literal">null</span>, <span class="string">'2'</span>),</span><br><span class="line">  h(<span class="string">'fragment'</span>, <span class="literal">null</span>, <span class="string">'fragement'</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p><br></p><h3 id="3-2-host-component-vs-custom-component"><a href="#3-2-host-component-vs-custom-component" class="headerlink" title="3.2 Host Component vs Custom Component"></a>3.2 Host Component vs Custom Component</h3><p>JSX ä¼šåŒºåˆ†ä¸¤ç§ç»„ä»¶ç±»å‹ã€‚å°å†™å¼€å¤´çš„ä¸ºå†…ç½®ç»„ä»¶ï¼Œå®ƒä»¬ä»¥å­—ç¬¦ä¸²çš„å½¢å¼ä¼ å…¥ createElement; å¤§å†™å¼€å¤´çš„è¡¨ç¤ºè‡ªå®šä¹‰ç»„ä»¶, ä½œç”¨åŸŸå†…å¿…é¡»å­˜åœ¨è¯¥å˜é‡, å¦åˆ™ä¼šæŠ¥é”™ã€‚</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å†…ç½®ç»„ä»¶</span></span><br><span class="line">;<span class="xml"><span class="tag">&lt;<span class="name">div</span> /&gt;</span></span></span><br><span class="line"><span class="xml">// è‡ªå®šä¹‰ç»„ä»¶</span></span><br><span class="line"><span class="xml">;<span class="tag">&lt;<span class="name">Custom</span> /&gt;</span></span></span><br></pre></td></tr></table></figure><p><br></p><h3 id="3-3-ç®€å•å®ç°-createelement-å·¥å‚æ–¹æ³•"><a href="#3-3-ç®€å•å®ç°-createelement-å·¥å‚æ–¹æ³•" class="headerlink" title="3.3 ç®€å•å®ç° createElement å·¥å‚æ–¹æ³•"></a>3.3 ç®€å•å®ç° createElement å·¥å‚æ–¹æ³•</h3><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">createElement</span>(<span class="params">type, props, ...children</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> copy = &#123; ...(props || EMPTY_OBJECT) &#125;</span><br><span class="line">  copy.children = copy.children || (children.length &gt; <span class="number">1</span> ? children : children[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    _vnode: <span class="literal">true</span>,</span><br><span class="line">    type,</span><br><span class="line">    props: copy,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br><br><br></p><h2 id="4-åŸºç¡€ç»„ä»¶çš„è®¾è®¡"><a href="#4-åŸºç¡€ç»„ä»¶çš„è®¾è®¡" class="headerlink" title="4. åŸºç¡€ç»„ä»¶çš„è®¾è®¡"></a>4. åŸºç¡€ç»„ä»¶çš„è®¾è®¡</h2><h3 id="4-1-æ¥æºäº-koa-çš„çµæ„Ÿ"><a href="#4-1-æ¥æºäº-koa-çš„çµæ„Ÿ" class="headerlink" title="4.1 æ¥æºäº Koa çš„çµæ„Ÿ"></a>4.1 æ¥æºäº Koa çš„çµæ„Ÿ</h3><p>å¤§å®¶åº”è¯¥æ¯”è¾ƒç†Ÿæ‚‰ koa ä¸­é—´ä»¶æœºåˆ¶ã€‚</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// logger</span></span><br><span class="line">app.use(<span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">  <span class="keyword">await</span> next()</span><br><span class="line">  <span class="keyword">const</span> rt = ctx.response.get(<span class="string">'X-Response-Time'</span>)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;ctx.method&#125;</span> <span class="subst">$&#123;ctx.url&#125;</span> - <span class="subst">$&#123;rt&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// x-response-time</span></span><br><span class="line">app.use(<span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> start = <span class="built_in">Date</span>.now()</span><br><span class="line">  <span class="keyword">await</span> next()</span><br><span class="line">  <span class="keyword">const</span> ms = <span class="built_in">Date</span>.now() - start</span><br><span class="line">  ctx.set(<span class="string">'X-Response-Time'</span>, <span class="string">`<span class="subst">$&#123;ms&#125;</span>ms`</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// response</span></span><br><span class="line">app.use(<span class="keyword">async</span> ctx =&gt; &#123;</span><br><span class="line">  ctx.body = <span class="string">'Hello World'</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><br></p><p>å½¢è±¡çš„è¯´ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ªæ´‹è‘±æ¨¡å‹:</p><p><img src="/images/jsx-as-dsl/koa.png" alt></p><p><br></p><p>ä¸­é—´ä»¶è°ƒç”¨ nextï¼Œå°±ä¼šè¿›å…¥ä¸‹ä¸€çº§ã€‚ å¦‚æœæŠŠå‡½æ•°çš„è¾¹ç•Œæ‰“ç ´ã€‚å®ƒçš„æ ·å­ç¡®å®åƒæ´‹è‘±:</p><p><img src="/images/jsx-as-dsl/koa-2.png" alt></p><p><br></p><p>âœ¨<strong>æˆ‘å‘ç°ä½¿ç”¨ JSX å¯ä»¥æ›´ç›´è§‚åœ°è¡¨ç¤ºè¿™ç§æ´‹è‘±ç»“æ„</strong></p><p><br></p><p><img src="/images/jsx-as-dsl/koa-3.png" alt></p><p><br><br><br></p><h3 id="4-2-use-åŸºç¡€ç»„ä»¶"><a href="#4-2-use-åŸºç¡€ç»„ä»¶" class="headerlink" title="4.2 use åŸºç¡€ç»„ä»¶"></a>4.2 use åŸºç¡€ç»„ä»¶</h3><p>äºæ˜¯ä¹ï¼Œæœ‰äº† <code>&lt;use /&gt;</code> è¿™ä¸ªåŸºç¡€ç»„ä»¶ã€‚å®ƒç±»ä¼¼äº Koa çš„ <code>app.use</code>, ç”¨äºæ‹¦æˆªè¯·æ±‚ï¼Œå¯ä»¥è¿›è¡Œå“åº”, ä¹Ÿå¯ä»¥é€‰æ‹©è¿›å…¥ä¸‹ä¸€å±‚ã€‚</p><p><strong>â‘  æ¥çœ‹çœ‹æ•´ä½“è®¾è®¡</strong>ã€‚</p><p>use æ­£æ˜¯åŸºäºä¸Šé¢è¯´çš„ï¼Œä½¿ç”¨ JSX æ¥æè¿°ä¸­é—´ä»¶åŒ…è£¹å±‚æ¬¡çš„åŸºç¡€ç»„ä»¶ã€‚å› ä¸ºä½¿ç”¨çš„æ˜¯ä¸€ç§æ ‘çŠ¶ç»“æ„ï¼Œæ‰€ä»¥è¦åŒºåˆ†<strong>å…„å¼Ÿä¸­é—´ä»¶</strong>å’Œ<strong>å­ä¸­é—´ä»¶</strong>:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;server&gt;</span><br><span class="line">  &lt;use m=&#123;A&#125;&gt;</span><br><span class="line">    &lt;use m=&#123;Aa&#125; /&gt;</span><br><span class="line">    &lt;use m=&#123;Ab&#125; /&gt;</span><br><span class="line">  &lt;<span class="regexp">/use&gt;</span></span><br><span class="line"><span class="regexp">  &lt;use m=&#123;B&#125; /</span>&gt;</span><br><span class="line">  &lt;use m=&#123;C&#125; /&gt;</span><br><span class="line">&lt;<span class="regexp">/server&gt;</span></span><br></pre></td></tr></table></figure><p>å…¶ä¸­ <code>Aa</code>ã€<code>Ab</code> å°±æ˜¯ <code>A</code> çš„<strong>å­ä¸­é—´ä»¶</strong>ã€‚åœ¨ A ä¸­å¯ä»¥è°ƒç”¨ç±»ä¼¼ koa çš„ <code>next</code> å‡½æ•°ï¼Œè¿›å…¥ä¸‹çº§ä¸­é—´ä»¶ã€‚</p><p><code>A</code>ã€<code>B</code>ã€<code>C</code>ä¹‹é—´å°±æ˜¯<strong>å…„å¼Ÿä¸­é—´ä»¶</strong>ã€‚å½“å‰ç»§ä¸­é—´ä»¶æœªåŒ¹é…æ—¶ï¼Œå°±ä¼šæ‰§è¡Œä¸‹ä¸€ä¸ªç›¸é‚»ä¸­é—´ä»¶ã€‚</p><p>ä¹ä¸€çœ‹ï¼Œè¿™å°±æ˜¯ koa å’Œ express çš„ç»“åˆå•Š!</p><p><br></p><p><strong>â‘¡ å†çœ‹çœ‹ Props è®¾è®¡</strong></p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">interface UseProps &#123;</span><br><span class="line">  m: <span class="function">(<span class="params">req, res, recurse: (</span>) =&gt;</span> <span class="built_in">Promise</span>&lt;boolean&gt;) =&gt; <span class="built_in">Promise</span>&lt;boolean&gt;;</span><br><span class="line">  skip?: boolean;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p><code>m</code></p><ul><li><p><code>req</code>ã€<code>res</code>ï¼šExpress çš„è¯·æ±‚å¯¹è±¡å’Œå“åº”å¯¹è±¡</p></li><li><p><code>recurse</code>ï¼šé€’å½’æ‰§è¡Œå­çº§ä¸­é—´ä»¶, ç±»ä¼¼ koa çš„ nextã€‚è¿”å›ä¸€ä¸ª<code>Promise&lt;boolean&gt;</code>, å®ƒå°†åœ¨ä¸‹çº§ä¸­é—´ä»¶æ‰§è¡Œå®Œæˆå resolveï¼Œboolean è¡¨ç¤ºä¸‹çº§ä¸­é—´ä»¶æ˜¯å¦åŒ¹é…æ‹¦æˆªäº†è¯·æ±‚ã€‚</p></li><li><p>è¿”å›å€¼ï¼šè¿”å›ä¸€ä¸ª <code>Promise&lt;boolean&gt;</code> è¡¨ç¤ºå½“å‰ä¸­é—´ä»¶æ˜¯å¦åŒ¹é…(æ‹¦æˆªè¯·æ±‚)ã€‚å¦‚æœåŒ¹é…ï¼Œåç»­çš„å…„å¼Ÿä¸­é—´ä»¶å°†ä¸ä¼šè¢«æ‰§è¡Œã€‚</p></li></ul></li><li><p><code>skip</code>ï¼šå¼ºåˆ¶è·³è¿‡ï¼Œæˆ‘ä»¬åœ¨å¼€å‘æ—¶å¯èƒ½ä¼šä¸´æ—¶è·³è¿‡åŒ¹é…è¯·æ±‚ï¼Œè¿™ä¸ªæœ‰ç‚¹åƒå•å…ƒæµ‹è¯•ä¸­çš„ skip</p></li></ul><p><br></p><p><strong>â‘¢ çœ‹ä¸€ä¸‹è¿è¡Œå®ä¾‹</strong></p><p>å‡è®¾ä»£ç ä¸º:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> cb = <span class="function"><span class="params">name</span> =&gt;</span> () =&gt; &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(name)</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> (</span><br><span class="line">  &lt;server&gt;</span><br><span class="line">    &lt;use</span><br><span class="line">      m=&#123;<span class="keyword">async</span> (req, res, rec) =&gt; &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'A'</span>)</span><br><span class="line">        <span class="keyword">if</span> (req.path === <span class="string">'/user'</span>) <span class="keyword">await</span> rec() <span class="comment">// å¦‚æœåŒ¹é…ï¼Œåˆ™æ”¾è¡Œï¼Œè®©å…¶é€’å½’è¿›å…¥å†…éƒ¨</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'end A'</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">      &#125;&#125;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;use m=&#123;cb(<span class="string">'A-1'</span>)&#125;&gt;å¦‚æœçˆ¶çº§åŒ¹é…ï¼Œåˆ™è¿™é‡Œä¼šè¢«æ‰§è¡Œ&lt;<span class="regexp">/use&gt;</span></span><br><span class="line"><span class="regexp">      &lt;use m=&#123;cb('A-2')&#125;&gt;...&lt;/u</span>se&gt;</span><br><span class="line">    &lt;<span class="regexp">/use&gt;</span></span><br><span class="line"><span class="regexp">    &lt;use m=&#123;cb('B')&#125; /</span>&gt;</span><br><span class="line">    &lt;use m=&#123;cb(<span class="string">'C'</span>)&#125; /&gt;</span><br><span class="line">  &lt;<span class="regexp">/server&gt;</span></span><br><span class="line"><span class="regexp">)</span></span><br></pre></td></tr></table></figure><p>å¦‚æœè¯·æ±‚çš„æ˜¯ â€˜/â€˜ï¼Œé‚£ä¹ˆæ‰“å°çš„æ˜¯ <code>A -&gt; end A -&gt; B -&gt; C</code>ï¼›<br>å¦‚æœè¯·æ±‚ä¸º â€˜/userâ€™, é‚£ä¹ˆæ‰“å°çš„æ˜¯ <code>A -&gt; A-1 -&gt; A-2 -&gt; end A -&gt; B -&gt; C</code></p><p><br></p><p>æˆ‘ä»¬çš„åŸºç¡€ç»„ä»¶å’Œ Koa / Express ä¸€æ ·ï¼Œæ ¸å¿ƒä¿æŒéå¸¸å°è€Œç®€æ´ï¼Œå½“ç„¶å®ƒä¹Ÿæ¯”è¾ƒä½çº§ï¼Œè¿™æ ·èƒ½å¤Ÿä¿è¯çµæ´»æ€§ã€‚</p><p><strong>è¿™ä¸ªç®€å•çš„åŸºç¡€ç»„ä»¶è®¾è®¡å°±æ˜¯æ•´ä¸ªæ¡†æ¶çš„â€˜åŸºçŸ³â€™</strong>ã€‚ å¦‚æœä½ äº†è§£ Koa å’Œ Expressï¼Œè¿™é‡Œæ²¡æœ‰æ–°çš„ä¸œè¥¿ã€‚åªæ˜¯æ¢äº†ä¸€ç§è¡¨ç°æ–¹å¼ã€‚</p><p><br><br><br></p><h3 id="4-3-é«˜å±‚ç»„ä»¶çš„å°è£…"><a href="#4-3-é«˜å±‚ç»„ä»¶çš„å°è£…" class="headerlink" title="4.3 é«˜å±‚ç»„ä»¶çš„å°è£…"></a>4.3 é«˜å±‚ç»„ä»¶çš„å°è£…</h3><p>Ok, æœ‰äº† <code>use</code> è¿™ä¸ªåŸºç¡€åŸè¯­, æˆ‘å¯ä»¥åšå¾ˆå¤šæœ‰æ„æ€çš„äº‹æƒ…ï¼Œä½¿ç”¨ç»„ä»¶åŒ–çš„æ€ç»´å°è£…å‡ºæ›´é«˜çº§çš„ APIã€‚</p><p><br></p><p><strong>â‘  <code>&lt;Log&gt;</code>ï¼šæ‰“æ—¥å¿—</strong></p><p>å°è£…ä¸€ä¸ªæœ€ç®€å•çš„ç»„ä»¶:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> Log: Component = <span class="function"><span class="params">props</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;use</span><br><span class="line">      m=&#123;<span class="keyword">async</span> (req, res, rec) =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> start = <span class="built_in">Date</span>.now()</span><br><span class="line">        <span class="comment">// è¿›å…¥ä¸‹ä¸€çº§</span></span><br><span class="line">        <span class="keyword">const</span> rtn = <span class="keyword">await</span> rec()</span><br><span class="line">        <span class="built_in">console</span>.log(</span><br><span class="line">          <span class="string">`<span class="subst">$&#123;req.method&#125;</span> <span class="subst">$&#123;req.path&#125;</span>: <span class="subst">$&#123;<span class="built_in">Date</span>.now() - start&#125;</span>ms`</span></span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">return</span> rtn</span><br><span class="line">      &#125;&#125;</span><br><span class="line">    &gt;</span><br><span class="line">      &#123;props.children&#125;</span><br><span class="line">    &lt;<span class="regexp">/use&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p>ç”¨æ³•:</p><figure class="highlight jsx"><table><tr><td class="code"><pre><span class="line">&lt;server&gt;</span><br><span class="line">  &lt;Log&gt;</span><br><span class="line">    &lt;Get&gt;hello world&lt;<span class="regexp">/Get&gt;</span></span><br><span class="line"><span class="regexp">    &lt;Post path="/</span>login<span class="string">"&gt;login sucess&lt;/Post&gt;</span></span><br><span class="line"><span class="string">    ...</span></span><br><span class="line"><span class="string">  &lt;/Log&gt;</span></span><br><span class="line"><span class="string">&lt;/server&gt;</span></span><br></pre></td></tr></table></figure><p><br><br><br></p><p><strong>â‘¡ <code>&lt;NotFound&gt;</code>: 404</strong></p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> NotFound = <span class="function"><span class="params">props</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; children &#125; = props</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;use</span><br><span class="line">      m=&#123;<span class="keyword">async</span> (req, res, rec) =&gt; &#123;</span><br><span class="line">        <span class="keyword">const</span> found = <span class="keyword">await</span> rec()</span><br><span class="line">        <span class="keyword">if</span> (!found) &#123;</span><br><span class="line">          <span class="comment">// ä¸‹çº§æœªåŒ¹é…</span></span><br><span class="line">          res.status(<span class="number">404</span>)</span><br><span class="line">          res.send(<span class="string">'Not Found'</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">      &#125;&#125;</span><br><span class="line">    &gt;</span><br><span class="line">      &#123;children&#125;</span><br><span class="line">    &lt;<span class="regexp">/use&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p>ç”¨æ³•å’Œ Log ä¸€æ ·ã€‚<code>recurse</code> è¿”å› false æ—¶ï¼Œè¡¨ç¤ºä¸‹çº§æ²¡æœ‰åŒ¹é…åˆ°è¯·æ±‚ã€‚</p><p><br><br><br></p><p><strong>â‘¢ <code>&lt;Catch&gt;</code>: å¼‚å¸¸å¤„ç†</strong></p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> Catch: Component = <span class="function"><span class="params">props</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;use</span><br><span class="line">      m=&#123;<span class="keyword">async</span> (req, res, rec) =&gt; &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="keyword">await</span> rec()</span><br><span class="line">        &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">          res.status(<span class="number">500</span>)</span><br><span class="line">          res.send(err.message)</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;&#125;</span><br><span class="line">    &gt;</span><br><span class="line">      &#123;props.children&#125;</span><br><span class="line">    &lt;<span class="regexp">/use&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p>ç”¨æ³•å’Œ Log ä¸€æ ·ã€‚æ•è·ä¸‹çº§ä¸­é—´ä»¶çš„å¼‚å¸¸ã€‚</p><p><br><br><br></p><p><strong>â‘£ <code>&lt;Match&gt;</code>: è¯·æ±‚åŒ¹é…</strong></p><p>Match ç»„ä»¶ä¹Ÿæ˜¯ä¸€ä¸ªéå¸¸åŸºç¡€çš„ç»„ä»¶ï¼Œå…¶ä»–é«˜å±‚ç»„ä»¶éƒ½æ˜¯åŸºäºå®ƒæ¥å®ç°ã€‚å®ƒç”¨äºåŒ¹é…è¯·æ±‚ï¼Œå¹¶ä½œå‡ºå“åº”ã€‚å…ˆæ¥çœ‹çœ‹ Props è®¾è®¡ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> type CustomResponder =</span><br><span class="line">  | MiddlewareMatcher</span><br><span class="line">  | MockType</span><br><span class="line">  | boolean</span><br><span class="line">  | string</span><br><span class="line">  | number</span><br><span class="line">  | object</span><br><span class="line">  | <span class="literal">null</span></span><br><span class="line">  | <span class="literal">undefined</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> interface MatchProps &#123;</span><br><span class="line">  match?: <span class="function">(<span class="params">req: Request, res: Response</span>) =&gt;</span> boolean <span class="comment">// è¯·æ±‚åŒ¹é…</span></span><br><span class="line">  headers?: StringRecord <span class="comment">// é»˜è®¤å“åº”æŠ¥å¤´</span></span><br><span class="line">  code?: number | string <span class="comment">// é»˜è®¤å“åº”ç </span></span><br><span class="line">  <span class="comment">// children ç±»å‹åˆ™æ¯”è¾ƒå¤æ‚, å¯ä»¥æ˜¯åŸå§‹ç±»å‹ã€å¯¹è±¡ã€Mockå¯¹è±¡ã€è‡ªå®šä¹‰å“åº”å‡½æ•°ï¼Œä»¥åŠä¸‹çº§ä¸­é—´ä»¶</span></span><br><span class="line">  children?: ComponentChildren | CustomResponder</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p>Match ç»„ä»¶ä¸»ä½“:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> Match = <span class="function">(<span class="params">props: MatchProps</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; match, skip, children &#125; = props</span><br><span class="line">  <span class="comment">// å¯¹ children è¿›è¡Œè½¬æ¢</span></span><br><span class="line">  <span class="keyword">let</span> response = generateCustomResponder(children, props)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;use</span><br><span class="line">      skip=&#123;skip&#125;</span><br><span class="line">      m=&#123;<span class="keyword">async</span> (req, res, rec) =&gt; &#123;</span><br><span class="line">        <span class="comment">// æ£€æŸ¥æ˜¯å¦åŒ¹é…</span></span><br><span class="line">        <span class="keyword">if</span> (match ? match(req, res) : <span class="literal">true</span>) &#123;</span><br><span class="line">          <span class="keyword">if</span> (response) &#123;</span><br><span class="line">            <span class="keyword">return</span> response(req, res, rec)</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="comment">// å¦‚æœæ²¡æœ‰å“åº”å™¨ï¼Œåˆ™å°†æ§åˆ¶æƒäº¤ç»™ä¸‹çº§ç»„ä»¶</span></span><br><span class="line">          <span class="keyword">return</span> rec()</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">      &#125;&#125;</span><br><span class="line">    &gt;</span><br><span class="line">      &#123;children&#125;</span><br><span class="line">    &lt;<span class="regexp">/use&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p>é™äºç¯‡å¹…ï¼ŒMatch çš„å…·ä½“ç»†èŠ‚å¯ä»¥çœ‹<a href="https://github.com/ivan-94/jsxmock/blob/master/src/components/Match.tsx" target="_blank" rel="noopener">è¿™é‡Œ</a></p><p>å‰è¿›ï¼Œå‰è¿›ã€‚ <code>Get</code>ã€<code>Post</code>ã€<code>Delete</code>ã€<code>MatchByJSON</code>ã€<code>MatchBySearch</code> éƒ½æ˜¯åœ¨ <code>Match</code> åŸºç¡€ä¸Šå°è£…äº†ï¼Œè¿™é‡Œå°±ä¸å±•å¼€äº†ã€‚</p><p><br><br><br></p><p><strong>â‘¤ <code>&lt;Delay&gt;</code>: å»¶è¿Ÿå“åº”</strong></p><p>å¤ªå…´å¥‹äº†ï¼Œä¸€ä¸å°å¿ƒåˆå†™å¾—è€é•¿ï¼Œæˆ‘å¯ä»¥å»å†™å°å†Œäº†ã€‚Ok, æœ€åä¸€ä¸ªä¾‹å­, åœ¨ Mock API ä¼šæœ‰æ¨¡æ‹Ÿå»¶è¿Ÿå“åº”çš„åœºæ™¯, å®ç°å¾ˆç®€å•:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> Delay = <span class="function">(<span class="params">props: DelayProps</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; timeout = <span class="number">3000</span>, ...other &#125; = props</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;use</span><br><span class="line">      m=&#123;<span class="keyword">async</span> (req, res, rec) =&gt; &#123;</span><br><span class="line">        <span class="keyword">await</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">res</span> =&gt;</span> setTimeout(res, timeout))</span><br><span class="line">        <span class="keyword">return</span> rec()</span><br><span class="line">      &#125;&#125;</span><br><span class="line">    &gt;</span><br><span class="line">      &lt;Match &#123;...other&#125; /&gt;</span><br><span class="line">    &lt;<span class="regexp">/use&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p><br></p><p>ç”¨æ³•ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;Get path=<span class="string">"/delay"</span>&gt;</span><br><span class="line">  &#123;<span class="comment">/* å»¶è¿Ÿ 5s è¿”å› */</span>&#125;</span><br><span class="line">  &lt;Delay timeout=&#123;<span class="number">5000</span>&#125;&gt;Delay Delay...&lt;<span class="regexp">/Delay&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>Get&gt;</span><br></pre></td></tr></table></figure><p>æ›´å¤šä½¿ç”¨æ¡ˆä¾‹ï¼Œè¯·çœ‹ <a href="https://github.com/ivan-94/jsxmock" target="_blank" rel="noopener">jsxmock æ–‡æ¡£</a>)</p><p>åšæŒåˆ°è¿™é‡Œä¸å®¹æ˜“ï¼Œä½ å¯¹å®ƒçš„åŸç†å¯èƒ½æ„Ÿå…´è¶£ï¼Œé‚£ä¸å¦¨ç»§ç»­çœ‹ä¸‹å»ã€‚</p><p><br><br><br></p><h2 id="5-æµ…è°ˆå®ç°åŸç†"><a href="#5-æµ…è°ˆå®ç°åŸç†" class="headerlink" title="5. æµ…è°ˆå®ç°åŸç†"></a>5. æµ…è°ˆå®ç°åŸç†</h2><p>ç®€å•çœ‹ä¸€ä¸‹å®ç°ã€‚å¦‚æœäº†è§£è¿‡ React æˆ–è€… Virtual-DOM çš„å®ç°åŸç†ã€‚è¿™ä¸€åˆ‡å°±å¾ˆå¥½ç†è§£äº†ã€‚</p><p><br></p><h3 id="5-1-â€˜æ¸²æŸ“â€™"><a href="#5-1-â€˜æ¸²æŸ“â€™" class="headerlink" title="5.1 â€˜æ¸²æŸ“â€™"></a>5.1 â€˜æ¸²æŸ“â€™</h3><p>è¿™æ˜¯æ‰“äº†å¼•å·çš„â€™æ¸²æŸ“â€™ã€‚è¿™åªæ˜¯ä¸€ç§ä¹ æƒ¯çš„ç§°è°“ï¼Œå¹¶ä¸æ˜¯æŒ‡å®ƒä¼šæ¸²æŸ“æˆ GUIã€‚å®ƒç”¨æ¥å±•å¼€æ•´é¢— JSX æ ‘ã€‚å¯¹äºæˆ‘ä»¬æ¥è¯´å¾ˆç®€å•ï¼Œæˆ‘ä»¬æ²¡æœ‰æ‰€è°“çš„æ›´æ–°æˆ–è€… UI æ¸²æŸ“ç›¸å…³çš„ä¸œè¥¿ã€‚åªéœ€é€’å½’è¿™ä¸ªæ ‘ã€æ”¶é›†æˆ‘ä»¬éœ€è¦çš„ä¸œè¥¿å³å¯ã€‚</p><p>æˆ‘ä»¬çš„ç›®çš„æ˜¯æ”¶é›†åˆ°æ‰€æœ‰çš„ä¸­é—´ä»¶ï¼Œä»¥åŠå®ƒä»¬çš„åµŒå¥—å…³ç³»ã€‚æˆ‘ä»¬ç”¨ MiddlewareNode è¿™ä¸ªæ ‘å½¢æ•°æ®ç»“æ„æ¥å­˜å‚¨å®ƒä»¬ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> type Middleware = (</span><br><span class="line">  req: Request,</span><br><span class="line">  res: Response,</span><br><span class="line">  <span class="comment">// é€’å½’</span></span><br><span class="line">  recurse: <span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">Promise</span>&lt;boolean&gt;,</span><br><span class="line">) =&gt; <span class="built_in">Promise</span>&lt;boolean&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> interface MiddlewareNode &#123;</span><br><span class="line">  m: Middleware           <span class="comment">// ä¸­é—´ä»¶å‡½æ•°</span></span><br><span class="line">  skip: boolean           <span class="comment">// æ˜¯å¦è·³è¿‡</span></span><br><span class="line">  children: MiddlewareNode[] <span class="comment">// å­çº§ä¸­é—´ä»¶</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¸²æŸ“å‡½æ•°:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> currentMiddlewareNode</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">render</span>(<span class="params">vnode</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="comment">// ğŸ”´ åˆ›å»ºæ ¹ä¸­é—´ä»¶</span></span><br><span class="line">  <span class="keyword">const</span> middlewares = (currentMiddlewareNode = createMiddlewareNode())</span><br><span class="line">  <span class="comment">// ğŸ”´ æŒ‚è½½</span></span><br><span class="line">  <span class="keyword">const</span> tree = mount(vnode)</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p>æŒ‚è½½æ˜¯ä¸€ä¸ªé€’å½’çš„è¿‡ç¨‹ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œé‡åˆ°<code>è‡ªå®šä¹‰ç»„ä»¶</code>æˆ‘ä»¬å°±å±•å¼€ï¼Œé‡åˆ° use ç»„ä»¶å°±å°†å®ƒä»¬æ”¶é›†åˆ° <code>currentMiddlewareNode</code> ä¸­:</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mount</span>(<span class="params">vnode</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> prevMiddlewareNode</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> vnode.type === <span class="string">'function'</span>) &#123;</span><br><span class="line">    <span class="comment">// ğŸ”´è‡ªå®šä¹‰ç»„ä»¶å±•å¼€</span></span><br><span class="line">    <span class="keyword">const</span> rtn = vnode.type(vnode.props)</span><br><span class="line">    <span class="keyword">if</span> (rtn != <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="comment">// é€’å½’æŒ‚è½½è‡ªå®šä¹‰ç»„ä»¶çš„æ¸²æŸ“ç»“æœ</span></span><br><span class="line">      mount(rtn, inst)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> vnode.type === <span class="string">'string'</span>) &#123;</span><br><span class="line">    <span class="comment">// å†…ç½®ç»„ä»¶</span></span><br><span class="line">    <span class="keyword">if</span> (vnode.type === <span class="string">'use'</span>) &#123;</span><br><span class="line">      <span class="comment">// ğŸ”´æ”¶é›†ä¸­é—´ä»¶</span></span><br><span class="line">      <span class="keyword">const</span> md = createMiddlewareNode(inst.props.m)</span><br><span class="line">      md.skip = !!inst.props.skip</span><br><span class="line">      currentMiddlewareNode.children.push(md)</span><br><span class="line"></span><br><span class="line">      <span class="comment">// ä¿å­˜çˆ¶çº§ä¸­é—´ä»¶</span></span><br><span class="line">      prevMiddlewareNode = currentMiddlewareNode</span><br><span class="line">      currentMiddlewareNode = md <span class="comment">// â¬‡ï¸æ¨å…¥æ ˆï¼Œä¸‹çº§çš„ä¸­é—´ä»¶å°†åŠ å…¥è¿™ä¸ªåˆ—è¡¨</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// ... å…¶ä»–å†…ç½®ç»„ä»¶</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ğŸ”´é€’å½’æŒ‚è½½å­çº§èŠ‚ç‚¹</span></span><br><span class="line">    mountChilren(inst.props.children, inst)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (vnode.type === <span class="string">'use'</span>) &#123;</span><br><span class="line">      currentMiddlewareNode = prevMiddlewareNode <span class="comment">// â¬†ï¸å¼¹å‡ºæ ˆ</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ğŸ”´ å­èŠ‚ç‚¹åˆ—è¡¨æŒ‚è½½</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mountChilren</span>(<span class="params">children: any, parent: Instance</span>) </span>&#123;</span><br><span class="line">  childrenToArray(children).forEach(mount)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br><br><br></p><h3 id="5-2-è¿è¡Œ"><a href="#5-2-è¿è¡Œ" class="headerlink" title="5.2 è¿è¡Œ"></a>5.2 è¿è¡Œ</h3><p>ç°åœ¨çœ‹çœ‹æ€ä¹ˆè¿è¡Œèµ·æ¥ã€‚æˆ‘ä»¬å®ç°äº†ä¸€ä¸ªç®€å•çš„ä¸­é—´ä»¶æœºåˆ¶ï¼Œç›¸å¯¹ Koa å¥½ç†è§£ä¸€ç‚¹ï¼š</p><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">runMiddlewares</span>(<span class="params">req, res, current</span>): <span class="title">Promise</span>&lt;<span class="title">boolean</span>&gt; </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; m, skip, children &#125; = current</span><br><span class="line">  <span class="keyword">if</span> (skip) &#123;</span><br><span class="line">    <span class="comment">// è·³è¿‡, ç›´æ¥è¿”å› false</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// è°ƒç”¨ä¸­é—´ä»¶</span></span><br><span class="line">  <span class="keyword">return</span> m(req, res, <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="comment">// recurse å›è°ƒ</span></span><br><span class="line">    <span class="comment">// ğŸ”´ å¦‚æœæœ‰ä¸‹çº§ä¸­é—´ä»¶ï¼Œåˆ™é€’å½’è°ƒç”¨å­çº§ä¸­é—´ä»¶</span></span><br><span class="line">    <span class="keyword">if</span> (children &amp;&amp; children.length) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">const</span> child <span class="keyword">of</span> children) &#123;</span><br><span class="line">        <span class="keyword">const</span> matched = <span class="keyword">await</span> runMiddlewares(req, res, child)</span><br><span class="line">        <span class="keyword">if</span> (matched) &#123;</span><br><span class="line">          <span class="comment">// ğŸ”´ å¦‚æœå…¶ä¸­ä¸€ä¸ªå…„å¼Ÿä¸­é—´ä»¶åŒ¹é…ï¼Œåç»­çš„ä¸­é—´ä»¶éƒ½ä¸ä¼šè¢«æ‰§è¡Œ</span></span><br><span class="line">          <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span> <span class="comment">// ğŸ”´ æ²¡æœ‰ä¸‹çº§ä¸­é—´ä»¶ï¼Œæˆ–è€…æ²¡æœ‰ä»»ä½•ä¸‹çº§ä¸­é—´ä»¶åŒ¹é…</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><p>å¾ˆç®€å•å“ˆï¼Ÿ å°±æ˜¯é€’å½’é€’å½’é€’å½’</p><p><br><br><br></p><h2 id="6-æ€»ç»“ï¼Œç»ˆäºå®Œäº‹äº†"><a href="#6-æ€»ç»“ï¼Œç»ˆäºå®Œäº‹äº†" class="headerlink" title="6. æ€»ç»“ï¼Œç»ˆäºå®Œäº‹äº†"></a>6. æ€»ç»“ï¼Œç»ˆäºå®Œäº‹äº†</h2><p>æœ¬æ–‡ä»é…ç½®æ–‡ä»¶è®²åˆ° DSLï¼Œåˆè®²åˆ°äº† JavaScript å†…éƒ¨ DSL è¡¨è¾¾å½¢å¼å’Œèƒ½åŠ›ã€‚æœ€åå°†ç„¦ç‚¹èšé›†åœ¨äº† JSX ä¸Šé¢ã€‚</p><p>æˆ‘é€šè¿‡ä¸€ä¸ªå®æˆ˜çš„æ¡ˆä¾‹å±•ç¤ºäº† JSX å’Œ React çš„ç»„ä»¶åŒ–æ€ç»´ï¼Œå®ƒä¸ä»…ä»…é€‚ç”¨äºæè¿°ç”¨æˆ·ç•Œé¢ï¼Œæˆ‘ä»¬ä¹Ÿçœ‹åˆ° JSX ä½œä¸ºä¸€ç§ DSL çš„æ½œåŠ›å’Œçµæ´»æ€§ã€‚</p><p>æœ€åæ€»ç»“ä¸€ä¸‹ä¼˜ç¼ºç‚¹ã€‚</p><p><br></p><p><strong>âœ… ä¼˜ç‚¹</strong></p><ul><li><strong>æ›´å¥½çš„ç±»å‹æ¨æ–­å’Œçº¦æŸ</strong>ã€‚ Typescript å‹å¥½</li><li><strong>å¯ç»„åˆ</strong>ã€‚å…·æœ‰ç»„ä»¶å°è£…å’Œç»„åˆèƒ½åŠ›, å¯ä»¥è½»æ˜“å°è£…é«˜çº§ã€æ˜“äºä½¿ç”¨çš„æ¥å£</li><li><strong>Just Javascript</strong>ã€‚ æœ¬èº«å°±æ˜¯ JavaScript ä»£ç ï¼Œå¾ˆçµæ´»</li><li><strong>æ›´å¥½çš„ç»„ç»‡æ€§ã€åª²ç¾é…ç½®æ–‡ä»¶</strong>ã€‚JSX è¯­æ³•ç±»ä¼¼äº XMLï¼Œæœ‰è‰¯å¥½çš„ç»„ç»‡æ€§ã€‚</li><li><strong>ä¹ æƒ¯</strong>ã€‚ å¦‚æœä½ ä¹ æƒ¯ Reactï¼ŒVue è¿™ç±»å‰ç«¯æ¡†æ¶ï¼ŒJSX é…ç½®æ–¹å¼å¾ˆå®¹æ˜“è¢«æ¥å—å’Œä¸Šæ‰‹</li><li><strong>å®ç°ç®€å•</strong>ã€‚</li><li><strong>æ›´èƒ½ç›´è§‚åœ°è¡¨ç°å±‚çº§ç»“æ„</strong>ã€‚æ¯”å¦‚è¡¨ç¤ºä¸­é—´ä»¶çš„æ´‹è‘±ç»“æ„</li><li><strong>æ¨¡å—åŒ–</strong>ã€‚ä¸ç”Ÿä¿±æ¥ï¼Œå¯ä»¥å°†æ¥å£åˆ†å‘åˆ°ä¸åŒçš„æ–‡ä»¶ä¸­ï¼Œç„¶åå¯è½»æ˜“åœ°ç»„åˆèµ·æ¥ã€‚</li></ul><p><br></p><p><strong>âš ï¸ ç¼ºç‚¹</strong></p><ul><li>ä»£ç éœ€è¦è½¬è¯‘ã€‚éœ€è¦ Babel å’Œ Typescript è½¬è¯‘ã€‚</li><li>æœ‰ç‚¹ Verboseã€‚</li></ul><p><br></p><p><strong>çµæ´»å´æœ‰ç»„ç»‡æ€§</strong>ã€‚çµæ´»é€šå¸¸å®¹æ˜“å¯¼è‡´æ‚ä¹±æ— ç« ï¼Œç»„ç»‡æ€§åˆ™å¯èƒ½æ„å‘³ç€ç‰ºç‰²çµæ´»æ€§ï¼Œä¸¤è€…åœ¨æŸç§æ„ä¹‰ä¸Šé¢çœ‹æ˜¯çŸ›ç›¾çš„ã€‚èƒ½å¤Ÿå°†ä¸¤è€…å¹³è¡¡æ¡ˆä¾‹å…¶å®å¾ˆå°‘è§ï¼ŒJSX å¯èƒ½æ˜¯ä¸€ä¸ªã€‚ï¼ˆæˆ‘å¥½åƒåœ¨å¹ ğŸ‚ï¼‰</p><p><br></p><p><strong>ğŸ‰ğŸ‰ä»£ç å·²ç»åœ¨ Github, ç›®å‰æ­£å¤„äºåŸå‹é˜¶æ®µ: <a href="https://github.com/ivan-94/jsxmock" target="_blank" rel="noopener">ivan-94/jsxmock</a> æ¬¢è¿ â­ï¸ å’Œè´¡çŒ®ã€‚</strong></p><p><br><br><br></p><h2 id="7-æ‰©å±•"><a href="#7-æ‰©å±•" class="headerlink" title="7. æ‰©å±•"></a>7. æ‰©å±•</h2><ul><li><a href="https://www.yinwang.org/blog-cn/2017/05/25/dsl" target="_blank" rel="noopener">DSL çš„è¯¯åŒº</a></li><li><a href="https://draveness.me/dsl" target="_blank" rel="noopener">è°ˆè°ˆ DSL ä»¥åŠ DSL çš„åº”ç”¨ï¼ˆä»¥ CocoaPods ä¸ºä¾‹ï¼‰</a></li><li><a href="https://www.phodal.com/blog/javascript-dsl-example/" target="_blank" rel="noopener">JavaScript DSL ç¤ºä¾‹</a></li><li><a href="https://www.zhihu.com/question/35436669" target="_blank" rel="noopener">ä½ æ˜¯å¦‚ä½•æ„å»º Web å‰ç«¯ Mock Server çš„ï¼Ÿ</a></li><li><a href="https://docs.svrx.io/zh/blog/mock.html" target="_blank" rel="noopener">ä½¿ç”¨ svrx å®ç°æ›´ä¼˜é›…çš„æ¥å£ Mock</a></li></ul><p><br></p><p>ä¹Ÿå­¦åˆ«äººå»ºä¸ªç¾¤(å¥½å¤šè¯»è€…é—®è¿‡)ï¼Œè¯•è¯•æ°´å§â€¦</p><p><img src="/images/group.png" alt></p><p><br></p><p><img src="/images/sponsor.jpg" alt></p><p><br></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;è¿™å‡ å¤©æ‰“ç®—å†™ä¸€ä¸ªç®€å•çš„ API Mock æœåŠ¡å™¨ï¼Œè€ç”Ÿå¸¸è°ˆå“ˆï¼Ÿå…¶å®æˆ‘æ˜¯æƒ³è®² JSX, Mock æœåŠ¡å™¨åªæ˜¯ä¸€ä¸ªå¹Œå­ã€‚æˆ‘åœ¨å¯»æ‰¾ä¸€ç§æ›´ç®€æ´ã€æ–¹ä¾¿ã€åŒæ—¶åˆå¯ä»¥çµæ´»æ‰©å±•çš„ã€å’Œåˆ«äººä¸å¤ªä¸€æ ·çš„æ–¹å¼ï¼Œæ¥å®šä¹‰å„ç§ Mock APIã€‚åæ¥æˆ‘å‘ç°äº† JSX åœ¨é¢†åŸŸé—®é¢˜æè¿°çš„ä¼˜åŠ¿å’Œæ½œåŠ›ï¼Œå½“ç„¶è¿™å¯
      
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://bobi.ink/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>å¦‚ä½•å­¦ä¸€é—¨æ–°è¯­è¨€ï¼Œä»¥ Dart ä¸ºä¾‹</title>
    <link href="https://bobi.ink/2019/11/23/learn-lang/"/>
    <id>https://bobi.ink/2019/11/23/learn-lang/</id>
    <published>2019-11-22T16:00:00.000Z</published>
    <updated>2023-06-01T09:55:14.329Z</updated>
    
    <content type="html"><![CDATA[<p>ä¸–ç•Œä¸Šæ²¡æœ‰ä¸€ç§å¯ä»¥å„ä¸ªé¢†åŸŸé€šåƒçš„è¯­è¨€ï¼Œä¸ºäº†åº”å¯¹ä¸åŒçš„åœºæ™¯å’Œéœ€æ±‚ï¼Œæˆ‘ä»¬æ‘†è„±ä¸äº†è¦å­¦ä¹ ä¸€é—¨æ–°çš„è¯­è¨€ã€‚æœ€è¿‘å‡†å¤‡å…¥å‘ <code>Flutter</code>(æŠ€æœ¯å‚¨å¤‡)ï¼Œå­¦äº†ç‚¹ Dart, ä¸€ç‚¹å¿ƒå¾—åˆ†äº«ç»™å¤§å®¶ã€‚</p><p><br></p><p><strong>å¤§çº²</strong></p><!-- TOC --><ul><li><a href="#ä»‹ç»">ä»‹ç»</a><ul><li><a href="#1-å‡å®šå‰æ">1. å‡å®šå‰æ</a></li><li><a href="#2-åŸºæœ¬åŸåˆ™">2. åŸºæœ¬åŸåˆ™</a></li><li><a href="#3-åŸºæœ¬å§¿åŠ¿">3. åŸºæœ¬å§¿åŠ¿</a></li></ul></li><li><a href="#å·²æœ‰çš„è¯­è¨€è®¤çŸ¥">å·²æœ‰çš„è¯­è¨€è®¤çŸ¥</a></li><li><a href="#å»ºç«‹æ ‡ç­¾äº‘">å»ºç«‹æ ‡ç­¾äº‘</a></li><li><a href="#åˆ»æ„å­¦ä¹ ä»¥-dart-ä¸ºä¾‹">åˆ»æ„å­¦ä¹ ï¼Œä»¥ Dart ä¸ºä¾‹</a><ul><li><a href="#â‘ -2018-æœ€å‘äººè¯­è¨€">â‘  2018 æœ€å‘äººè¯­è¨€?</a></li><li><a href="#â‘¡-é’ˆå¯¹å®¢æˆ·ç«¯ä¼˜åŒ–">â‘¡ é’ˆå¯¹å®¢æˆ·ç«¯ä¼˜åŒ–</a></li><li><a href="#â‘¢-é¢å‘å¯¹è±¡">â‘¢ é¢å‘å¯¹è±¡</a></li><li><a href="#â‘£-æ“ä½œç¬¦">â‘£ æ“ä½œç¬¦</a></li><li><a href="#â‘¤-constfinal-ä¸é™æ€æ•°æ®">â‘¤ const/final ä¸é™æ€æ•°æ®</a></li><li><a href="#â‘¥-ç±»å‹ç³»ç»Ÿ">â‘¥ ç±»å‹ç³»ç»Ÿ</a></li><li><a href="#â‘¦-å¼‚æ­¥å¼‚æ­¥">â‘¦ å¼‚æ­¥å¼‚æ­¥</a></li><li><a href="#â‘§-å…ƒç¼–ç¨‹">â‘§ å…ƒç¼–ç¨‹</a></li></ul></li><li><a href="#å®è·µ">å®è·µ</a></li><li><a href="#æ·±å…¥äº†è§£è¿™é—¨è¯­è¨€">æ·±å…¥äº†è§£è¿™é—¨è¯­è¨€</a></li><li><a href="#æ€»ç»“">æ€»ç»“</a></li><li><a href="#æ‰©å±•">æ‰©å±•</a></li></ul><!-- /TOC --><p><br></p><h2 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><h3 id="1-å‡å®šå‰æ"><a href="#1-å‡å®šå‰æ" class="headerlink" title="1. å‡å®šå‰æ"></a>1. å‡å®šå‰æ</h3><p>æˆ‘æƒ³çœ‹è¿™ç¯‡æ–‡ç« çš„åº”è¯¥éƒ½æ˜¯ç¨‹åºå‘˜äº†å§ï¼Ÿéƒ½æœ‰è‡ªå·±ç†Ÿæ‚‰çš„è¯­è¨€ï¼Œè¿™å°±å¥½åŠäº†ï¼Œæˆ‘ä»¬å¯ä»¥å¤ç”¨å·²æœ‰çš„è®¤çŸ¥å»å¿«é€Ÿå­¦ä¹ ä¸€é—¨æ–°è¯­è¨€ã€‚å¦‚æœä½ æ˜¯å°ç™½ï¼Œè¿™ç¯‡æ–‡ç« å¯èƒ½ä¸é€‚åˆä½ </p><p><br></p><h3 id="2-åŸºæœ¬åŸåˆ™"><a href="#2-åŸºæœ¬åŸåˆ™" class="headerlink" title="2. åŸºæœ¬åŸåˆ™"></a>2. åŸºæœ¬åŸåˆ™</h3><ul><li><p><strong>ç¡®å®šè¯­è¨€çš„å®šä½å’Œåœºæ™¯</strong>ã€‚åˆ«å†è¯´ PHP æ˜¯æœ€å¥½çš„è¯­è¨€äº†ï¼Œå¤§å®¶éƒ½çŸ¥é“ã€‚æ¯ä¸€é—¨è¯­è¨€éƒ½æœ‰è‡ªå·±å®šä½å’Œé€‚ç”¨åœºæ™¯ï¼Œä¸ºäº†è§£å†³ä¸åŒçš„é—®é¢˜ã€‚<strong>æ‰€ä»¥å­¦ä¹ ä¸€é—¨è¯­è¨€çš„æ—¶å€™ï¼Œé¦–å…ˆè¦äº†è§£è¯­è¨€çš„å®šä½å’Œé¢†åŸŸï¼Œè¿™æ ·ä½ æ‰èƒ½æ˜ç™½ä¸ºä»€ä¹ˆè¯­è¨€è®¾è®¡è€…è®¾è®¡æŸä¸ªç‰¹æ€§çš„åŠ¨æœº</strong>ã€‚ä¾‹å¦‚:</p><ul><li><code>JavaScript</code>ï¼šæµè§ˆå™¨è„šæœ¬è¯­è¨€éœ¸ä¸», å†™å‰ç«¯è‚¯å®šç»•ä¸å¼€ JavaScript å•¦ã€‚ä¸€é—¨åå‡ å¤©æå‡ºæ¥çš„è¯­è¨€ï¼Œå°±ä¸è¦é—® <code>[] == ![] // true</code> æ˜¯ä»€ä¹ˆåŠ¨æœºäº†, ä¸è¦å­¦è¿™äº›ç³Ÿç²•ã€‚</li><li><code>Dart</code>ï¼š é’ˆå¯¹å®¢æˆ·ç«¯(â€˜Flutterâ€™)ä¼˜åŒ–è¯­è¨€, å½“åˆå·ç§°è¦å–ä»£ JavaScript, å®˜æ–¹è‡ªå·±çš„å®šä½å°±æ˜¯å®¢æˆ·ç«¯</li><li><code>Go</code>ï¼š æ®è¯´æ˜¯ <code>C++</code> ç¼–è¯‘é€Ÿåº¦æ…¢å€’é€¼å‡ºæ¥çš„è¯­è¨€ã€‚æ‰€ä»¥ä½ å¯ä»¥ç«™åœ¨ C++ çš„å¯¹ç«‹é¢å»æ€è€ƒå®ƒçš„è®¾è®¡ï¼šä¾‹å¦‚ ç®€å•çš„è¯­æ³•ã€é«˜é€Ÿç¼–è¯‘ã€åƒåœ¾å›æ”¶ã€é«˜æ€§èƒ½ã€é«˜å¹¶å‘ã€‚åŠæ•°æ˜¯ä¸ºäº†è§£å†³ C++ çš„é—®é¢˜ã€‚é€‚ç”¨äºæœåŠ¡å™¨ç¼–ç¨‹ã€åˆ†å¸ƒå¼ã€ç½‘ç»œç¼–ç¨‹ã€äº‘å¹³å°ã€‚</li><li><code>Rust</code>ï¼š ç³»ç»Ÿç¼–ç¨‹è¯­è¨€ï¼Œ<code>C/C++</code> æœ€æœ‰åŠ›çš„æŒ‘æˆ˜è€…</li></ul><p><br></p><p>å½“ç„¶ï¼Œä¹Ÿæœ‰ä¸€äº›è¯­è¨€åªæœ‰åœ¨ç‰¹å®šå¹³å°æˆ–åœºæ™¯æ‰èƒ½ä½¿ç”¨ï¼Œè¿™ç§æ²¡åŠæ³•ï¼Œè¿™å±äº<strong>å•†ä¸šå£å’</strong>ã€‚ä¾‹å¦‚</p><ul><li><code>Swift/Objective-C</code> åŸºæœ¬åªèƒ½ç”¨äº Apple å¹³å°ï¼Œå°½ç®¡ Swift å¼€æºï¼Œä¹Ÿå¯ä»¥è·‘åœ¨ Linux ä¸Šï¼Œä½†é™¤äº† Apple åº”ç”¨å¼€å‘ï¼Œå¾ˆå°‘çœ‹åˆ° Swift çš„èº«å½±</li><li><code>C#</code> å’Œ Swift ç±»ä¼¼</li></ul><p><br></p></li><li><p><strong>ä¸è¦é™·å…¥è¯­è¨€çš„è¯­æ³•ç»†èŠ‚ï¼Œå‰¥ç¦»æ‰è¯­æ³•ç³–</strong>ã€‚å­¦ä¹ æ–°è¯­è¨€ï¼Œå¯ä»¥æš‚æ—¶å¿½ç•¥æ‰è¯­æ³•çš„ç»†èŠ‚, åˆ‡æ¢åˆ°ä¸Šå¸è§†è§’</p></li><li><p><strong>åŸºäºåŸæœ‰çš„è®¤çŸ¥ï¼Œæ¨ªå‘è¿›è¡Œæ¯”è¾ƒ</strong>ã€‚æ­£å¸¸æ¥è¯´ç¼–ç¨‹è¯­è¨€ 80% æ¦‚å¿µæˆ–èŒƒå¼æ˜¯é€šç”¨çš„ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆä½ ç†Ÿæ‚‰ä¸€é—¨è¯­è¨€ï¼Œå¯ä»¥å¿«é€Ÿå…¥é—¨å…¶ä»–è¯­è¨€ã€‚</p></li><li><p><strong>æ‰“ç ´è®¤çŸ¥</strong>ã€‚å¦å¤– 20% åŒ…å«è¯¥é—¨è¯­è¨€ç‹¬æœ‰çš„ç‰¹æ€§å’Œæ€æƒ³, è¿™æ‰æ˜¯æˆ‘ä»¬éœ€è¦å…³æ³¨çš„æ ¸å¿ƒã€‚</p></li></ul><p><br></p><h3 id="3-åŸºæœ¬å§¿åŠ¿"><a href="#3-åŸºæœ¬å§¿åŠ¿" class="headerlink" title="3. åŸºæœ¬å§¿åŠ¿"></a>3. åŸºæœ¬å§¿åŠ¿</h3><ul><li><strong>ç¡®å®šè‡ªå·±è¦è§£å†³çš„é—®é¢˜/åœºæ™¯</strong>ã€‚ æˆ‘ä»¬å­¦ä¸€é—¨è¯­è¨€ä¸€èˆ¬ä¸æ˜¯ä¸ºäº†å­¦ä¹ è¯­è¨€è€Œå­¦ä¹ ã€‚é¦–å…ˆä½ åº”è¯¥æœ‰éœ€è¦è§£å†³åœºæ™¯å’Œé—®é¢˜ï¼Œæ¥ç€å¸¦ç€è¿™äº›é—®é¢˜å¯¹ç¼–ç¨‹è¯­è¨€è¿›è¡Œé€‰å‹ï¼Œç¡®å®šå¤šä¸ªè¯­è¨€å€™é€‰è€…ã€‚</li><li><strong>æ€è€ƒè¿™äº›è¯­è¨€æ˜¯æ€ä¹ˆè§£å†³ä½ çš„é—®é¢˜çš„ï¼Ÿ</strong> è¿™å°±æ˜¯â€™æ‰“ç ´è®¤çŸ¥â€™çš„è¿‡ç¨‹, åˆ†æä¸€ä¸‹è¿™äº›å€™é€‰è€…ä¼˜ç¼ºç‚¹</li><li><strong>ç¡®å®šè¦å­¦ä¹ è¿™é—¨è¯­è¨€äº†ï¼Ÿ</strong> ä¸‹æ–‡ä¼šæŒ‰ç…§è¿™ä¸ªæ­¥éª¤å±•å¼€<ul><li><strong>å»ºç«‹æ ‡ç­¾äº‘</strong>ã€‚æ”¶é›†è¿™é—¨è¯­è¨€çš„ 20% ç‹¬æœ‰ç‰¹æ€§/æ€æƒ³, ä¾‹å¦‚ Killer Featureã€æ§½ç‚¹ã€å¹ç‚¹ï¼Œé’ˆå¯¹æ€§åˆ»æ„è¿›è¡Œå­¦ä¹ ã€‚</li><li><strong>ç²—ç•¥è¿‡ä¸€ä¸‹å®˜æ–¹æ–‡æ¡£</strong>ã€‚ ä¹Ÿå°±æ˜¯é‚£80%ï¼Œå¯¹åŸºæœ¬è¯­æ³•æœ‰ä¸ªåŸºæœ¬çš„å°è±¡ï¼Œç±»æ¯”è‡ªå·±ç†Ÿæ‚‰çš„è¯­è¨€ï¼Œå¯ä»¥å¿«é€Ÿç†è§£ã€‚</li><li><strong>å¼€å§‹å®è·µ</strong>ã€‚ç°åœ¨ä½ è¿™é—¨è¯­è¨€å»ºç«‹åˆæ­¥çš„å°è±¡äº†ã€‚è¶çƒ­å¼€å§‹å®è·µï¼Œæ¯”å¦‚å¯ä»¥è·Ÿç€å®˜æ–¹å…¥é—¨æ•™ç¨‹ã€‚ä¸€è¾¹å®è·µä¸€è¾¹æŸ¥é˜…æ–‡æ¡£ï¼Œå¾ˆå¿«å°±èƒ½ç†Ÿç»ƒèµ·æ¥</li><li><strong>æ·±å…¥äº†è§£è¿™é—¨è¯­è¨€</strong></li></ul></li></ul><p><br><br><br></p><h2 id="å·²æœ‰çš„è¯­è¨€è®¤çŸ¥"><a href="#å·²æœ‰çš„è¯­è¨€è®¤çŸ¥" class="headerlink" title="å·²æœ‰çš„è¯­è¨€è®¤çŸ¥"></a>å·²æœ‰çš„è¯­è¨€è®¤çŸ¥</h2><p>ä¸‹é¢æ˜¯å¸¸è§ç¼–ç¨‹è¯­è¨€çš„æ„æˆå›¾è°±ï¼Œå¯¹ç…§ä¸€ä¸‹ï¼Œè¿™äº›æ¦‚å¿µæ˜¯å¦éƒ½çŸ¥é“? æ˜¯å¦çœŸçš„äº†è§£ä½ ç”¨æ¥åƒé¥­çš„å®¶ä¼™?</p><p><br></p><p><img src="/images/learn-lang/langmind.png" alt></p><p><br></p><p>æ²¡çœ‹æ‡‚ï¼Ÿçœ‹æ¥ä½ æ²¡å­¦è¿‡ä¸€é—¨çœŸæ­£(å¤æ‚)çš„è¯­è¨€ï¼Œå¦‚ <code>Scala</code>ã€<code>Cå˜å˜</code>ï¼Œ<code>Rust</code>ã€‚ğŸ˜º ç¿»è¿‡è¿™äº›å¤§å±±ï¼Œå…¶ä»–çš„å°±æ˜¯ä¸€è§ˆä¼—å±±å°äº†ã€‚å¤ªéš¾äº†</p><p>å°å­©å­æ‰åšé€‰æ‹©ï¼Œç‰›é€¼(æœ‰ç²¾åŠ›)çš„äººæ˜¯å…¨éƒ½è¦ã€‚ä½ ä¹Ÿå¯ä»¥å­¦å‡ é—¨æ¯”è¾ƒæœ‰ä»£è¡¨æ€§è¯­è¨€ã€‚å‚è€ƒ<a href="https://book.douban.com/subject/10555435/" target="_blank" rel="noopener">ã€Šä¸ƒå¤©ä¸ƒè¯­è¨€ã€‹</a>å¼€å§‹ç‚¹æŠ€èƒ½æ ‘:</p><ul><li><p><strong>æŒ‰å¸‚åœºåˆ’åˆ†</strong>:</p><ul><li>é€šç”¨ç±»å‹è¯­è¨€(ç”¨æ¥åƒé¥­çš„)ã€‚ ä¾‹å¦‚ Javaã€JavaScriptã€Pythonã€C/C++ã€Goã€PHPã€Objective-C/Swift(iOSå¼€å‘è€…, ä¸¥æ ¼è¯´ä¸ç®—â€˜é€šç”¨â€™)</li><li>ç¬¦åˆè‡ªå·±å£å‘³çš„å°ä¼—è¯­è¨€ã€‚Rustã€Elixirã€Rubyã€Kotlinã€Clojureã€OCamlâ€¦</li></ul></li><li><p><strong>æŒ‰èŒƒå¼åˆ’åˆ†</strong>:</p><ul><li>é¢å‘å¯¹è±¡: ä¾‹å¦‚ Rubyã€Javaã€Pythonâ€¦</li><li>å¤šèŒƒå¼: ä¾‹å¦‚ JavaScriptã€Scalaã€Rustâ€¦</li><li>å‡½æ•°å¼: ä¾‹å¦‚ Lisp(ä¾‹å¦‚Clojure)ã€Erlangã€Haskellâ€¦</li><li>è¿‡ç¨‹å¼: ä¾‹å¦‚ Cã€Go(å¯ä»¥ç®—æ˜¯é¢å‘å¯¹è±¡ã€Whatever)</li><li>åŸå‹è¯­è¨€: Ioï¼Œå¥½å°ä¼—</li></ul></li><li><p><strong>å…¶ä»–åˆ’åˆ†æ–¹å¼</strong>:</p><ul><li>ç±»å‹: å¼ºç±»å‹ã€å¼±ç±»å‹; é™æ€ç±»å‹ã€åŠ¨æ€ç±»å‹</li><li>æ‰§è¡Œæ–¹å¼: é™æ€è¯­è¨€ã€è„šæœ¬è¯­è¨€</li><li>ç³»ç»Ÿå±‚æ¬¡: ç³»ç»Ÿç¼–ç¨‹è¯­è¨€ã€åº”ç”¨è¯­è¨€</li></ul></li></ul><p><br><br><br></p><h2 id="å»ºç«‹æ ‡ç­¾äº‘"><a href="#å»ºç«‹æ ‡ç­¾äº‘" class="headerlink" title="å»ºç«‹æ ‡ç­¾äº‘"></a>å»ºç«‹æ ‡ç­¾äº‘</h2><p>ä¸Šæ–‡è¯´äº†ï¼Œ80% çš„çŸ¥è¯†æ˜¯å¯ä»¥å¤ç”¨çš„ï¼Œæˆ‘ä»¬è¦é’ˆå¯¹å¦å¤– 20% è¯¥è¯­è¨€ç‹¬æœ‰çš„ç‰¹æ€§å’Œæ€æƒ³è¿›è¡Œåˆ»æ„å­¦ä¹ ã€‚æˆ‘è¿™é‡Œä»‹ç»ä¸€ä¸ªæ–¹æ³•æ˜¯å»ºç«‹ä¸€ä¸ªæ ‡ç­¾äº‘ã€‚<strong>è¿™ä¸ªæ ‡ç­¾äº‘æ˜¯å¯¹è¿™é—¨è¯­è¨€çš„ä¸€äº›å…³é”®æè¿°</strong>ã€‚ ä¾‹å¦‚å®ƒçš„ä¸»è¦ç‰¹æ€§ã€ä¼˜ç‚¹ã€åæ§½ç‚¹ã€‚</p><p>è¿™äº›å…³é”®æè¿°å¯¹æˆ‘ä»¬å¿«é€Ÿäº†è§£ä¸€é—¨è¯­è¨€æœ‰å¾ˆå¤§çš„å¸®åŠ©, <strong>è¿™ä¸ªæ ‡ç­¾äº‘å…¶å®ä»£è¡¨çš„å°±æ˜¯ä½ å¯¹è¿™é—¨è¯­è¨€çš„åŸºæœ¬å°è±¡</strong>ã€‚ æ¢å¥è¯è¯´ï¼Œä½ å­¦äº†ä¸€é—¨è¯­è¨€ï¼Œä½†æ²¡æ€ä¹ˆç”¨ï¼Œè¿‡ä¸€æ®µæ—¶é—´å°±å¿˜å…‰äº†æ‰€æœ‰è¯­æ³•ç»†èŠ‚ï¼Œä½†æ˜¯è¿™é—¨è¯­è¨€çš„åŸºæœ¬å°è±¡ä¼šé•¿ä¹…åœç•™åœ¨ä½ è„‘æµ·ä¸­ã€‚æˆ‘æƒ³è¿™äº›å°è±¡å°±æ˜¯è¿™é—¨è¯­è¨€çš„ç²¾é«“æ‰€åœ¨å§ï¼</p><p>é‚£ä¹ˆæ€ä¹ˆæ”¶é›†è¿™ä¸ªæ ‡ç­¾äº‘?</p><ul><li>æ‰“å¼€å®˜ç½‘ã€‚çœ‹å®˜æ–¹æ€ä¹ˆæè¿°è‡ªå·±çš„è¯­è¨€ã€æœ‰å“ªäº›ä¸»è¦ç‰¹æ€§ã€å®šä½æ˜¯ä»€ä¹ˆã€‚</li><li>ä¹Ÿå¯ä»¥é€šè¿‡ Wiki çœ‹çœ‹è¿™é—¨è¯­è¨€çš„ç³»ç»Ÿçš„æè¿°å’Œå®šä¹‰</li><li>çŸ¥ä¹ã€‚çœ‹åˆ«äººæ€ä¹ˆå¹æˆ–è€…åæ§½è¿™é—¨è¯­è¨€çš„</li><li>é“å¬é€”è¯´</li><li>å¿«é€Ÿé¢„è§ˆå®˜æ–¹æŒ‡å—ã€‚æ‰¾äº®ç‚¹</li></ul><p>éšä¾¿ä¸¾å‡ ä¸ªä¾‹å­ã€‚ Dart è¯­è¨€:</p><p><img src="/images/learn-lang/dart.png" alt></p><blockquote><p>æ ‡ç­¾äº‘ä½¿ç”¨ <a href="https://www.wordclouds.com" target="_blank" rel="noopener">WordClouds</a> ç”Ÿæˆ</p></blockquote><p><br></p><p>Go è¯­è¨€ï¼š</p><p><img src="/images/learn-lang/go.png" alt></p><p><br></p><p>Javascript:</p><p><img src="/images/learn-lang/javascript.png" alt></p><p><br></p><p>Elixir:</p><p><img src="/images/learn-lang/elixir.png" alt></p><p><br><br><br></p><h2 id="åˆ»æ„å­¦ä¹ ï¼Œä»¥-dart-ä¸ºä¾‹"><a href="#åˆ»æ„å­¦ä¹ ï¼Œä»¥-dart-ä¸ºä¾‹" class="headerlink" title="åˆ»æ„å­¦ä¹ ï¼Œä»¥ Dart ä¸ºä¾‹"></a>åˆ»æ„å­¦ä¹ ï¼Œä»¥ Dart ä¸ºä¾‹</h2><p>æ¥ç€å¸¦ç€è¿™äº›é—®é¢˜é’ˆå¯¹æ€§åœ°å»å­¦ä¹ è¿™é—¨è¯­è¨€, è¿™é‡Œä»¥Dart ä¸ºä¾‹ï¼Œå› ä¸ºè¿™ä¸¤å¤©æ­£å¥½åœ¨å­¦ Dartï¼Œå‡†å¤‡å…¥å‘ Flutterï¼Œæˆ‘è‡ªå·±å¯¹ Dart æ²¡ä»€ä¹ˆå¥½æ„Ÿã€‚</p><p>å­¦ä¹ æ–¹æ³•, æ°¸è¿œæ˜¯ <strong>What / Why / How</strong>: æ˜¯ä»€ä¹ˆï¼Œä¸ºä»€ä¹ˆè¿™ä¹ˆè®¾è®¡ï¼Œå…·ä½“æ€ä¹ˆåš?</p><h3 id="â‘ -2018-æœ€å‘äººè¯­è¨€"><a href="#â‘ -2018-æœ€å‘äººè¯­è¨€" class="headerlink" title="â‘  2018 æœ€å‘äººè¯­è¨€?"></a>â‘  2018 æœ€å‘äººè¯­è¨€?</h3><p>æ²¡æœ‰ Flutter è¿™é—¨è¯­è¨€ç¡®å®è¦æŒ‚äº†ã€‚ç¼–ç¨‹è¯­è¨€ä¹Ÿè¦çœ‹çˆ¹</p><p><br></p><h3 id="â‘¡-é’ˆå¯¹å®¢æˆ·ç«¯ä¼˜åŒ–"><a href="#â‘¡-é’ˆå¯¹å®¢æˆ·ç«¯ä¼˜åŒ–" class="headerlink" title="â‘¡ é’ˆå¯¹å®¢æˆ·ç«¯ä¼˜åŒ–"></a>â‘¡ é’ˆå¯¹å®¢æˆ·ç«¯ä¼˜åŒ–</h3><p>è¿™æ˜¯å®˜æ–¹è‡ªå·±çš„å®šä½ã€‚</p><p>é’ˆå¯¹å®¢æˆ·ç«¯ä¼˜åŒ–ä¸»è¦ä½“ç°åœ¨<code>å¼€å‘ä½“éªŒ</code>å’Œ<code>è¿è¡Œæ€§èƒ½</code>ä¸Šé¢</p><ul><li><code>JIT</code>(Just in Time) å¿«é€Ÿç¼–è¯‘ç”Ÿæ•ˆï¼Œè¿™æ˜¯ Hot reload åŸºç¡€ã€‚<strong>Hot reload å¯ä»¥è®© Flutter æ¥è¿‘ Web çš„å¼€å‘ä½“éªŒ</strong></li><li><code>AOT</code>(Ahead of Time) ç”Ÿæˆé«˜æ•ˆåŸç”Ÿä»£ç ã€‚å¯ä»¥å¾—åˆ°æ›´å¿«çš„è¿è¡Œé€Ÿåº¦å’Œå¯åŠ¨é€Ÿåº¦</li><li>å¦å¤–ä¸€å±‚æ„æ€æ˜¯ï¼ŒDart è¿™é—¨è¯­è¨€å’Œ JavaScript éå¸¸ç›¸ä¼¼ã€‚æ¯”å¦‚è¯­æ³•ã€å•çº¿ç¨‹/äº‹ä»¶å¾ªç¯ã€äº‹ä»¶é©±åŠ¨ã€async/awaitã€Isolateã€Generatorã€Future/Streamã€collection if/for å¯ä»¥åª²ç¾JSX</li><li>æ”¯æŒç¼–è¯‘åˆ°JavaScriptã€‚æµè§ˆå™¨æ˜¯é‡è¦çš„å®¢æˆ·ç«¯ï¼Œä¸æ”¯æŒ JavaScript è¿˜æ•¢è¯´å®¢æˆ·ç«¯ä¼˜åŒ–ï¼Ÿ</li></ul><p><br></p><h3 id="â‘¢-é¢å‘å¯¹è±¡"><a href="#â‘¢-é¢å‘å¯¹è±¡" class="headerlink" title="â‘¢ é¢å‘å¯¹è±¡"></a>â‘¢ é¢å‘å¯¹è±¡</h3><p>è¯­æ³•å’Œ Java å¾ˆåƒï¼Œæœ‰ä¸€äº›è¯­æ³•ç³–æŒºç”œçš„ã€‚</p><ul><li><p>æ²¡æœ‰å…³é”®å­—åŒºåˆ† class å’Œ interfaceï¼Œå¯ä»¥è¯´ class å°±æ˜¯ interface</p></li><li><p><code>Mixins</code>ã€‚å‰ç«¯å¯¹ Mixin çš„æ¦‚å¿µåº”è¯¥éƒ½ä¸é™Œç”Ÿï¼Œæ¯•ç«Ÿè¿™ä¹ˆå¤šäººç”¨ Vue?</p></li><li><p>æ“ä½œç¬¦é‡è½½ã€‚Javascript ä¸æ”¯æŒæ“ä½œç¬¦é‡è½½ã€‚æ‰€ä»¥å¯¹å‰ç«¯æ¥è¯´ç®—æ˜¯ä¸€ä¸ªæ–°ä¸œè¥¿ã€‚ ä¸è¿‡ä¸ªäººä¸æ¨èï¼ŒJavaScript æ²¡æœ‰æ“ä½œç¬¦é‡è½½ä¸ä¹Ÿç”¨å¾—æŒºçˆ½ï¼Ÿ è€Œä¸”æ“ä½œç¬¦çš„è¯­ä¹‰ä¸æ˜ç¡®ï¼Œä¼šå¾’å¢å¿ƒæ™ºè´Ÿæ‹…ï¼Œè¿™æ—¶å€™è¿˜ä¸å¦‚ä½¿ç”¨å®šä¹‰è‰¯å¥½çš„æ–¹æ³•ã€‚<strong>æœ‰æ„ä¹‰çš„åç§°æ¯”ç¬¦å·è¦å¥½è®°å¿†</strong>ã€‚</p></li><li><p><code>new</code> å¯é€‰ã€‚åœ¨æŸäº›åœºæ™¯è®©ä»£ç æ›´ç®€æ´ï¼Œæ¯”å¦‚ Flutter ç»„ä»¶å£°æ˜ã€‚ç®—æ˜¯å¼¥è¡¥æ²¡æœ‰ JSX ä¹‹ç—›å§ã€‚</p><figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="keyword">void</span> main() &#123;</span><br><span class="line">  runApp(</span><br><span class="line">    Center(</span><br><span class="line">      child: Text(</span><br><span class="line">        <span class="string">'Hello, world!'</span>,</span><br><span class="line">        textDirection: TextDirection.ltr,</span><br><span class="line">      ),</span><br><span class="line">    ),</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><code>Callable Classes</code>ã€‚è¯­æ³•ç³–ï¼Œæ²¡æƒ³åˆ°æœ‰ä»€ä¹ˆåº”ç”¨åœºæ™¯ã€‚</p><figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WannabeFunction</span> </span>&#123;</span><br><span class="line">  call(<span class="built_in">String</span> a, <span class="built_in">String</span> b, <span class="built_in">String</span> c) =&gt; <span class="string">'<span class="subst">$a</span> <span class="subst">$b</span> <span class="subst">$c</span>!'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> wf = <span class="keyword">new</span> WannabeFunction();</span><br><span class="line"><span class="keyword">var</span> out = wf(<span class="string">"Hi"</span>,<span class="string">"there,"</span>,<span class="string">"gang"</span>); <span class="comment">// ğŸ¬</span></span><br></pre></td></tr></table></figure><p>æˆ‘ç›´æ¥ <code>wf.call</code> ä¹Ÿä¸éº»çƒ¦å§? çµæ„Ÿæ¥è‡ªJavaScriptï¼Ÿ JavaScript çš„å‡½æ•°ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¯ä»¥æœ‰è‡ªå·±å±æ€§</p></li></ul><p><br></p><h3 id="â‘£-æ“ä½œç¬¦"><a href="#â‘£-æ“ä½œç¬¦" class="headerlink" title="â‘£ æ“ä½œç¬¦"></a>â‘£ æ“ä½œç¬¦</h3><p>Dart ä¹Ÿæœ‰ä¸€äº›æœ‰è¶£çš„æ“ä½œç¬¦/è¡¨è¾¾å¼ï¼Œæ¥çœ‹çœ‹æœ‰å¤šç”œï¼š</p><ul><li><p><strong>çº§è”æ“ä½œç¬¦(Cascade Notation)</strong>ã€‚çº§è”æ“ä½œç¬¦æ˜¯ä¸€ä¸ªå¾ˆç”œçš„è¯­æ³•ç³–ã€‚ä¸è¯´åºŸè¯ï¼Œçœ‹ä»£ç :</p><figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="built_in">querySelector</span>(<span class="string">'#confirm'</span>) <span class="comment">// Get an object.</span></span><br><span class="line">..text = <span class="string">'Confirm'</span> <span class="comment">// ğŸ¬ ç”œç‚¹ï¼Œè¿™æ˜¯ç±» jQuery çš„ä¸²è¡Œè°ƒç”¨çš„å¢å¼ºç‰ˆ</span></span><br><span class="line">..classes.add(<span class="string">'important'</span>)</span><br><span class="line">..onClick.listen((e) =&gt; <span class="built_in">window</span>.alert(<span class="string">'Confirmed!'</span>));</span><br></pre></td></tr></table></figure><p>ç­‰ä»·äº:</p><figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> button = <span class="built_in">querySelector</span>(<span class="string">'#confirm'</span>);</span><br><span class="line">button.text = <span class="string">'Confirm'</span>;</span><br><span class="line">button.classes.add(<span class="string">'important'</span>);</span><br><span class="line">button.onClick.listen((e) =&gt; <span class="built_in">window</span>.alert(<span class="string">'Confirmed!'</span>));</span><br></pre></td></tr></table></figure></li></ul><p><br></p><ul><li><p><strong>å®¹å™¨æ“ä½œç¬¦(Collection Operators)</strong>ã€‚è¿™ä¸ªè¯­æ³•ç³–ä¹Ÿä¼šæ¯”è¾ƒç”œï¼Œå‰æœŸç”¨ Dart æ¥æè¿° Flutter çš„è§†å›¾æ˜¯ä¸€ä»¶å¾ˆç—›è‹¦çš„äº‹æƒ…ã€‚Dart é™†ç»­æ·»åŠ äº†ä¸€äº›ç”œç‚¹ï¼Œå¦‚<code>å±•å¼€æ“ä½œç¬¦</code>ã€<code>Collection if/for</code>, å†åŠ ä¸Š<code>å‘½åå‡½æ•°å‚æ•°</code>å’Œ <code>newå¯é€‰</code>ï¼Œè¡¨è¾¾åŠ›å·²ç»å¾ˆæ¥è¿‘ JSX äº†</p><figure class="highlight dart"><table><tr><td class="code"><pre><span class="line">[<span class="number">0</span>, ...list];</span><br><span class="line">[<span class="number">0</span>, ...?list]; <span class="comment">// æ”¯æŒè¯†åˆ«nullçš„å±•å¼€æ“ä½œç¬¦</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// collection if</span></span><br><span class="line"><span class="keyword">var</span> nav = [</span><br><span class="line">  <span class="string">'Home'</span>,</span><br><span class="line">  <span class="string">'Furniture'</span>,</span><br><span class="line">  <span class="string">'Plants'</span>,</span><br><span class="line">  <span class="keyword">if</span> (promoActive) <span class="string">'Outlet'</span></span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="comment">// collection for</span></span><br><span class="line"><span class="keyword">var</span> listOfStrings = [</span><br><span class="line">  <span class="string">'#0'</span>,</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i <span class="keyword">in</span> listOfInts) <span class="string">'#<span class="subst">$i</span>'</span></span><br><span class="line">];</span><br></pre></td></tr></table></figure><p><br></p><p><img src="/images/learn-lang/flutter-code.png" alt></p></li></ul><p><br></p><h3 id="â‘¤-const-final-ä¸é™æ€æ•°æ®"><a href="#â‘¤-const-final-ä¸é™æ€æ•°æ®" class="headerlink" title="â‘¤ const/final ä¸é™æ€æ•°æ®"></a>â‘¤ const/final ä¸é™æ€æ•°æ®</h3><p>åœ¨ dart ä¸­ const/final ä½¿ç”¨çš„åœ°æ–¹éå¸¸å¤šï¼Œå¯ä»¥ç”¨äºä¿®é¥°å˜é‡ã€å®ä¾‹å˜é‡ã€å¯¹è±¡åˆ›å»ºã€‚</p><blockquote><p>æ³¨æ„ï¼šé™æ€æ•°æ®å’Œä¸å¯å˜æ•°æ®æ˜¯ä¸åŒçš„æ¦‚å¿µ</p></blockquote><ul><li>å˜é‡ä¿®é¥°</li></ul><figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="keyword">final</span> name = <span class="string">'Bob'</span>;</span><br><span class="line"><span class="keyword">const</span> bar = <span class="number">100000</span>;</span><br><span class="line"><span class="keyword">const</span> foo = [];</span><br><span class="line"><span class="keyword">const</span> baz = [];</span><br><span class="line"></span><br><span class="line">console.log(foo == baz); <span class="comment">// true ç¼–è¯‘æ—¶å¸¸é‡</span></span><br></pre></td></tr></table></figure><p>const å°†è¢«è§†ä¸ºâ€™ç¼–è¯‘æ—¶â€™å¸¸é‡ã€‚ç›¸å¯¹final æœ‰æ‰€ä¼˜åŒ–</p><p><br></p><ul><li>ä¿®é¥°å¯¹è±¡åˆ›å»º</li></ul><figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> foo = <span class="keyword">const</span> [];</span><br></pre></td></tr></table></figure><p>const ä¿®é¥°å˜é‡åˆ›å»ºï¼ŒDart ä¼šé»˜è®¤ä»¥ const çš„ä¸Šä¸‹æ–‡æ¥å®ä¾‹åŒ–å¯¹è±¡:</p><figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> primaryColors = [</span><br><span class="line">  Color(<span class="string">"red"</span>, [<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>]),</span><br><span class="line">  Color(<span class="string">"green"</span>, [<span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>]),</span><br><span class="line">  Color(<span class="string">"blue"</span>, [<span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>]),</span><br><span class="line">];</span><br></pre></td></tr></table></figure><p>primaryColorè¢«ä¿®é¥° const ä¿®é¥°ï¼Œé‚£ä¹ˆå…¶ä¸‹çš„å¯¹è±¡åˆ›å»ºéƒ½éšå¼ä½¿ç”¨ const ä¿®é¥°ã€‚ä¸Šé¢çš„ä»£ç ç­‰ä»·äº:</p><figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> primaryColors = <span class="keyword">const</span> [</span><br><span class="line">  <span class="keyword">const</span> Color(<span class="string">"red"</span>, <span class="keyword">const</span> [<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>]),</span><br><span class="line">  <span class="keyword">const</span> Color(<span class="string">"green"</span>, <span class="keyword">const</span> [<span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>]),</span><br><span class="line">  <span class="keyword">const</span> Color(<span class="string">"blue"</span>, <span class="keyword">const</span> [<span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>]),</span><br><span class="line">];</span><br></pre></td></tr></table></figure><p><strong>Dart å†…ç½®çš„å®¹å™¨å¯¹è±¡é»˜è®¤æ”¯æŒconst</strong>ã€‚ å¯¹äºè‡ªå®šä¹‰ç±»ï¼Œéœ€è¦ç±»æä¾›<strong>constæ„é€ æ–¹æ³•</strong>, è€Œä¸”æ‰€æœ‰å®ä¾‹éƒ½å¿…é¡»ä½¿ç”¨finalä¿®é¥°ã€‚</p><figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ImmutablePoint</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="keyword">final</span> ImmutablePoint origin =</span><br><span class="line">      <span class="keyword">const</span> ImmutablePoint(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="comment">// æ‰€æœ‰å®ä¾‹å˜é‡éƒ½å¿…é¡»ç”¨finalä¿®é¥°</span></span><br><span class="line">  <span class="keyword">final</span> <span class="built_in">num</span> x, y;</span><br><span class="line">  <span class="comment">// const æ„é€ æ–¹æ³•</span></span><br><span class="line">  <span class="keyword">const</span> ImmutablePoint(<span class="keyword">this</span>.x, <span class="keyword">this</span>.y);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><br></p><h3 id="â‘¥-ç±»å‹ç³»ç»Ÿ"><a href="#â‘¥-ç±»å‹ç³»ç»Ÿ" class="headerlink" title="â‘¥ ç±»å‹ç³»ç»Ÿ"></a>â‘¥ ç±»å‹ç³»ç»Ÿ</h3><ul><li><p>åä¹‰ç±»å‹ã€‚æ²¡æœ‰Duck Duck Duck ğŸ¦†ğŸ¦†ğŸ¦†</p></li><li><p>Sound Type System(soundnessï¼Œä¸¥æ ¼ç±»å‹ç³»ç»Ÿ)ã€‚å³<strong>é™æ€ç±»å‹+è¿è¡Œæ—¶æ£€æŸ¥</strong>, æ¯”å¦‚ä¸€ä¸ªå˜é‡é™æ€ç±»å‹ä¸º Stringï¼Œå¦‚æœå°†intèµ‹å€¼ç»™å®ƒï¼Œç¼–è¯‘å™¨ä¼šæŠ¥é”™ã€‚ä½†æ˜¯é€šè¿‡æŸäº›æ‰‹æ®µï¼Œæˆ‘ä»¬å¯ä»¥ç»•è¿‡ç¼–è¯‘å™¨æ£€æŸ¥ï¼Œä¾‹å¦‚å¼ºåˆ¶ç±»å‹è½¬æ¢ã€‚Sound Type System å¯ä»¥åœ¨è¿è¡Œæ—¶è¿›è¡Œç±»å‹æ£€æŸ¥ï¼Œä¸ä¼šæ”¾è¿‡è¿™äº›é”™è¯¯ã€‚</p><figure class="highlight dart"><table><tr><td class="code"><pre><span class="line">main(<span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt; args) &#123;</span><br><span class="line">  <span class="built_in">int</span> a;</span><br><span class="line">  a = <span class="string">"1"</span> <span class="keyword">as</span> <span class="built_in">int</span>; <span class="comment">// ç»•è¿‡äº†é™æ€ç±»å‹æ£€æŸ¥, ä½†æ˜¯è¿è¡Œä¼šæŠ¥é”™</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¥½å¤„:</p><ul><li>ä»£ç æ›´å¥å£®</li><li>æœ‰åˆ©äºAOT</li><li>å°½å¯èƒ½æ¶ˆç­bugï¼Œç¼–è¯‘é˜¶æ®µçš„æ¼ç½‘ä¹‹é±¼ï¼Œä¹Ÿä¼šè¢«æ£€æµ‹å‡ºæ¥ï¼Œä¸è¦æŠ±ç€ä¾¥å¹¸å¿ƒç†ã€‚</li></ul></li><li><p>dynamicï¼šå¯ä»¥è§†ä½œæ˜¯anyç±»å‹å§ï¼Ÿå°½é‡é¿å…ä½¿ç”¨</p></li></ul><p><br></p><h3 id="â‘¦-å¼‚æ­¥å¼‚æ­¥"><a href="#â‘¦-å¼‚æ­¥å¼‚æ­¥" class="headerlink" title="â‘¦ å¼‚æ­¥å¼‚æ­¥"></a>â‘¦ å¼‚æ­¥å¼‚æ­¥</h3><p>Future/Streamã€async/awaitã€Generatorã€‚ä¸å¿…å¤šè¯´ï¼Œç†Ÿæ‚‰ JavaScript ä¸€çœ‹å°±æ‡‚</p><p><br></p><h3 id="â‘§-å…ƒç¼–ç¨‹"><a href="#â‘§-å…ƒç¼–ç¨‹" class="headerlink" title="â‘§ å…ƒç¼–ç¨‹"></a>â‘§ å…ƒç¼–ç¨‹</h3><ul><li><p>MetaDataã€‚å’ŒJavaçš„æ³¨è§£å·®ä¸å¤šã€‚é¡¾åæ€ä¹‰ï¼ŒMetaDataå°±æ˜¯ç»™ä½ çš„ä»£ç æä¾›æ›´å¤šçš„ä¿¡æ¯ã€‚å¯ä»¥ç”¨äºæç¤ºç¼–è¯‘å™¨ï¼Œåœ¨è¿è¡Œæ—¶é€šè¿‡åå°„åº“ä¹Ÿå¯ä»¥è·å–åˆ°MetaDataä¿¡æ¯ã€‚</p><figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SmartTelevision</span> <span class="keyword">extends</span> <span class="title">Television</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> turnOn() &#123;...&#125;</span><br><span class="line">  <span class="comment">// Â·Â·Â·</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><code>noSuchMethod()</code>ã€‚ç±»ä¼¼äº Ruby çš„ method_missingã€‚ å½“æœªæ‰¾åˆ°å±æ€§æˆ–è€…æ–¹æ³•æ—¶è¢«è°ƒç”¨ï¼Œå¯ä»¥å®ç°ä¸€äº›åŠ¨æ€å±æ€§æˆ–æ–¹æ³•ã€‚å…ƒç¼–ç¨‹ç¥å™¨ã€‚åœ¨ JavaScript ä¸­å¯ä»¥é€šè¿‡Proxy å®ç°ç›¸åŒçš„æ•ˆæœã€‚</p></li></ul><p><br><br><br></p><p>è¯´å®è¯ï¼ŒDart æ²¡æœ‰ä»€ä¹ˆå¤šå°‘è®©äººçœ¼å‰ä¸€äº®çš„ç‰¹æ€§ã€‚åœ¨å®ƒèº«ä¸Šä½ å¯ä»¥çœ‹åˆ°è®¸å¤šå…¶ä»–è¯­è¨€çš„å½±å­ã€ä¾‹å¦‚Javaã€JavaScriptã€Swiftâ€¦ è¿™ä¹Ÿæ— å¯åšéï¼Œç°ä»£ç¼–ç¨‹è¯­è¨€ç¡®å®é•¿å¾—è¶Šæ¥è¶Šåƒã€‚</p><p>å¥½å¤„æ˜¯å®ƒç‰¹åˆ«å®¹æ˜“ä¸Šæ‰‹ï¼Œåå¤„æ˜¯é™¤äº† Flutter ç»‘å®šä¹‹å¤–ï¼Œæˆ‘æ‰¾ä¸åˆ°å…¶ä»–å¯ä»¥ç”¨å®ƒçš„ç†ç”±ã€‚</p><p><br><br><br></p><h2 id="å®è·µ"><a href="#å®è·µ" class="headerlink" title="å®è·µ"></a>å®è·µ</h2><p>å€ŸåŠ©å·²æœ‰çš„ç»éªŒï¼Œå¾ˆå¿«å°±å¯ä»¥å…¥é—¨ï¼Œè¿™æ—¶å€™èƒ½é©¬ä¸Šä¸Šæ‰‹å»å†™æ˜¯æœ€å¥½çš„ã€‚</p><p>å¯ä»¥ä»Hello World å¼€å§‹, æˆ–è€…ä¹Ÿå¯ä»¥ä»å®˜æ–¹çš„å…¥é—¨æ•™ç¨‹å¼€å§‹ã€‚Dart çš„è¯ã€‚</p><p>hello world !</p><figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="keyword">void</span> main(<span class="built_in">List</span>&lt;<span class="built_in">String</span>&gt; args) &#123;</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">'Hello, World!'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡æœ€ç®€å•çš„ hello world ä¹Ÿå¯ä»¥è·çŸ¥ä¸€äº›å…³é”®ä¿¡æ¯:</p><ul><li>ç±»ä¼¼ C çš„å‰ç¼€å¼ç±»å‹å£°æ˜ã€‚</li><li>main ç¨‹åºå…¥å£</li><li>åˆ†å·ä¸èƒ½çœç•¥</li><li>æ ‡å‡†åº“ã€‚print æ¥æºäº <code>dart:core</code> è¿™ä¸ªåŒ…æ˜¯å…¨å±€çš„</li><li>List æ•°ç»„</li><li>æ³›å‹</li><li>â€¦</li></ul><p><br></p><p>Flutter æèµ·æ¥ï¼</p><p><br><br><br></p><h2 id="æ·±å…¥äº†è§£è¿™é—¨è¯­è¨€"><a href="#æ·±å…¥äº†è§£è¿™é—¨è¯­è¨€" class="headerlink" title="æ·±å…¥äº†è§£è¿™é—¨è¯­è¨€"></a>æ·±å…¥äº†è§£è¿™é—¨è¯­è¨€</h2><p>å¦‚æœä½ å–œæ¬¢è¿™é—¨è¯­è¨€ï¼Œæƒ³è¦è®©ä½ ä»¬çš„å…³ç³»è¿›ä¸€æ­¥å‘å±•ï¼Œä½ å°±è¦æ·±å…¥äº†è§£å®ƒï¼š</p><ul><li>äº†è§£å®ƒçš„æœ€ä½³å®è·µ</li><li>é˜…è¯»å®ƒçš„è¯­è¨€è§„èŒƒ</li><li>é€ è½®å­ã€‚æ¯”å¦‚å†™ä¸ªé™æ€ç½‘é¡µç”Ÿæˆå™¨; å¦‚æœæ˜¯é¢å‘å¯¹è±¡è¯­è¨€ï¼Œå¯ä»¥å®ç°å‡ ä¸ªå¸¸è§çš„è®¾è®¡æ¨¡å¼</li><li>å­¦ä¹ æ ‡å‡†åº“</li><li>äº†è§£å®ç°åŸç†</li><li>äº†è§£æ€§èƒ½åˆ†æå’Œä¼˜åŒ–</li></ul><p><br><br><br></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ç¼–ç¨‹è¯­è¨€ä¹Ÿæœ‰ä¸‰é‡å¢ƒç•Œ:</p><p><strong>çœ‹å±±æ˜¯å±±ï¼Œçœ‹å±±ä¸æ˜¯å±±ï¼Œçœ‹å±±è¿˜æ˜¯å±±</strong></p><ul><li>â‘  æˆ‘ç”¨çš„è¯­è¨€å°±æ˜¯æœ€å¥½çš„è¯­è¨€ï¼Œå¦‚ PHPï¼Œå¾ˆç‰›é€¼</li><li>â‘¡ æ‰€æœ‰è¯­è¨€éƒ½å·®ä¸å¤šï¼Œæœ¬è´¨éƒ½æ˜¯ä¸€æ ·</li><li>â‘¢ å›å½’åˆ°è¯­è¨€ï¼Œè¯­è¨€ä¸è¿‡æ˜¯ä¸ªå·¥å…·ã€‚å°±åƒç”»å®¶çš„ç”»ç¬”ï¼Œä¸è¿‡æ˜¯å®ç°è‡ªå·±æƒ³æ³•çš„ä¸€ä¸ªå·¥å…·ã€‚è¿™ä¸ªé˜¶æ®µï¼Œæˆ‘ä»¬ä¸å†äº‰æ‰§ä»€ä¹ˆæ˜¯æœ€å¥½çš„è¯­è¨€ï¼Œè€Œä¸”ä¸ºäº†ä¸åŒçš„ç»˜åˆ¶æ•ˆæœé€‰æ‹©ä¸åŒçš„ç”»ç¬”ã€‚</li></ul><p>åªè¦èƒ½è§£å†³æˆ‘ä»¬éœ€è¦è§£å†³çš„é—®é¢˜ï¼Œç¼–ç¨‹è¯­è¨€ä»æ¥ä¸æ˜¯é—¨æ§›ï¼Œæˆ–è€…è¯´å®ƒæ˜¯æœ€å®¹æ˜“è¢«å…‹æœçš„é—®é¢˜ã€‚å°±åƒåˆ«äººåæ§½ Flutter ç”¨ Dart è€Œä¸ç”¨JavaScriptä¸€æ ·ã€‚</p><p><br><br><br></p><h2 id="æ‰©å±•"><a href="#æ‰©å±•" class="headerlink" title="æ‰©å±•"></a>æ‰©å±•</h2><ul><li><a href="https://book.douban.com/subject/10555435/" target="_blank" rel="noopener">ä¸ƒå‘¨ä¸ƒè¯­è¨€</a></li><li><a href="https://en.wikipedia.org/wiki/Comparison_of_programming_languages" target="_blank" rel="noopener">Wiki: Comparison of programming languages</a></li><li><a href="https://dart.dev/guides/language/language-tour#libraries-and-visibility" target="_blank" rel="noopener">Dart å®˜æ–¹æ–‡æ¡£</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ä¸–ç•Œä¸Šæ²¡æœ‰ä¸€ç§å¯ä»¥å„ä¸ªé¢†åŸŸé€šåƒçš„è¯­è¨€ï¼Œä¸ºäº†åº”å¯¹ä¸åŒçš„åœºæ™¯å’Œéœ€æ±‚ï¼Œæˆ‘ä»¬æ‘†è„±ä¸äº†è¦å­¦ä¹ ä¸€é—¨æ–°çš„è¯­è¨€ã€‚æœ€è¿‘å‡†å¤‡å…¥å‘ &lt;code&gt;Flutter&lt;/code&gt;(æŠ€æœ¯å‚¨å¤‡)ï¼Œå­¦äº†ç‚¹ Dart, ä¸€ç‚¹å¿ƒå¾—åˆ†äº«ç»™å¤§å®¶ã€‚&lt;/p&gt;
&lt;p&gt;&lt;br&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;å¤§çº²&lt;/str
      
    
    </summary>
    
      <category term="å‰ç«¯" scheme="https://bobi.ink/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
  </entry>
  
</feed>
