---
title: "这半年的 Electron 应用开发和优化总结, 干货"
date: 2019/12/16
categories: 前端
---

今年可以拿出来说一说的项目估计就是我们用 Electron 重构了一个桌面端应用。简单介绍一下这个应用的，这个应用类似于钉钉或者企业微信，主要功能有即时通信、语音、会议，基本功能和 PC 端微信差不多，具体细节就不展开了, 这些不重要。

![](/images/electron/mygzb.png)

<br>

## 为什么选择 Electron?

原因也很简单: **我们的应用要兼容多个平台，原生开发效率低，我们没有资源**。

根据这个说了跟白说一样，大部分选择 Electron 的动机都是差不多的，无非就是穷，尤其是在夹缝中生存的企业。

**'混合化'成为了我们今年客户端重构的主题**。

先来看一下我们的客户端架构:

![](/images/electron/client-arch.png)

<br>

混合化对我们来说有两个意思:

1. 我们的架构混合了多种技术。通用底层 C/C++, 平台原生，Web
2. 跨平台

<br>

基于原有的客户端基础和情况，混合化重构自然而然分化为了两个方向:

1. 业务下沉。将通用的、核心的业务下沉。例如消息处理、语音/视频、会议、数据存储等核心模块, 封装一些底层库，如XMPP、SIP。这些业务变动频率较低、对性能要求也比较高，而且需要跨平台，因此适合用 C/C++ 来实现。
2. UI 混合。视图层混合化目前也有较多的解决方案，例如 Electron、React Native、Flutter、或者是 HTML Hybrid。我们选择先从 Electron 开始，因为它在桌面端开发中已经有非常成熟的表现，市场上也有很多大型的 Electron 应用，例如 VSCode、Atom、Slack。在移动端，我们对 React Native 和 Flutter 我们还比较保守，后续可能会进行尝试。

<br>

现在再看上面的图, 应该就好理解了, 典型的三层结构, 和 MVC 非常相似：

- **M -- 通用混合层**。 C/C++ 封装核心、通用的业务以及业务数据存储。
- **V -- UI 层**。视图层，使用跨平台视图解决方案，对于性能要求较高的部分使用原生实现。比如 Electron
- **C -- 平台桥接层**。介于 M 和 V 之间，桥接`通用混合层`接口，同时也为 UI 层暴露一些平台相关的特性。比如在桌面端，这里会通过 Node 原生模块桥接通用混合层, 同时也补充一些 Electron 缺失或不完美的功能。

<br>
<br>

## 进程模型

<br>